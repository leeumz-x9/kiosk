var hF=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var LJ=hF((GJ,OP)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function yN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var K0={exports:{}},yf={};var XC;function fF(){if(XC)return yf;XC=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,a){var o=null;if(a!==void 0&&(o=""+a),i.key!==void 0&&(o=""+i.key),"key"in i){a={};for(var u in i)u!=="key"&&(a[u]=i[u])}else a=i;return i=a.ref,{$$typeof:n,type:r,key:o,ref:i!==void 0?i:null,props:a}}return yf.Fragment=e,yf.jsx=t,yf.jsxs=t,yf}var YC;function dF(){return YC||(YC=1,K0.exports=fF()),K0.exports}var S=dF(),X0={exports:{}},rt={};var $C;function pF(){if($C)return rt;$C=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function v(W){return W===null||typeof W!="object"?null:(W=g&&W[g]||W["@@iterator"],typeof W=="function"?W:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,E={};function T(W,Q,ce){this.props=W,this.context=Q,this.refs=E,this.updater=ce||b}T.prototype.isReactComponent={},T.prototype.setState=function(W,Q){if(typeof W!="object"&&typeof W!="function"&&W!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,W,Q,"setState")},T.prototype.forceUpdate=function(W){this.updater.enqueueForceUpdate(this,W,"forceUpdate")};function R(){}R.prototype=T.prototype;function I(W,Q,ce){this.props=W,this.context=Q,this.refs=E,this.updater=ce||b}var C=I.prototype=new R;C.constructor=I,w(C,T.prototype),C.isPureReactComponent=!0;var k=Array.isArray;function L(){}var O={H:null,A:null,T:null,S:null},N=Object.prototype.hasOwnProperty;function D(W,Q,ce){var ve=ce.ref;return{$$typeof:n,type:W,key:Q,ref:ve!==void 0?ve:null,props:ce}}function P(W,Q){return D(W.type,Q,W.props)}function F(W){return typeof W=="object"&&W!==null&&W.$$typeof===n}function j(W){var Q={"=":"=0",":":"=2"};return"$"+W.replace(/[=:]/g,function(ce){return Q[ce]})}var B=/\/+/g;function J(W,Q){return typeof W=="object"&&W!==null&&W.key!=null?j(""+W.key):Q.toString(36)}function ne(W){switch(W.status){case"fulfilled":return W.value;case"rejected":throw W.reason;default:switch(typeof W.status=="string"?W.then(L,L):(W.status="pending",W.then(function(Q){W.status==="pending"&&(W.status="fulfilled",W.value=Q)},function(Q){W.status==="pending"&&(W.status="rejected",W.reason=Q)})),W.status){case"fulfilled":return W.value;case"rejected":throw W.reason}}throw W}function q(W,Q,ce,ve,Te){var Ae=typeof W;(Ae==="undefined"||Ae==="boolean")&&(W=null);var xe=!1;if(W===null)xe=!0;else switch(Ae){case"bigint":case"string":case"number":xe=!0;break;case"object":switch(W.$$typeof){case n:case e:xe=!0;break;case d:return xe=W._init,q(xe(W._payload),Q,ce,ve,Te)}}if(xe)return Te=Te(W),xe=ve===""?"."+J(W,0):ve,k(Te)?(ce="",xe!=null&&(ce=xe.replace(B,"$&/")+"/"),q(Te,Q,ce,"",function(qe){return qe})):Te!=null&&(F(Te)&&(Te=P(Te,ce+(Te.key==null||W&&W.key===Te.key?"":(""+Te.key).replace(B,"$&/")+"/")+xe)),Q.push(Te)),1;xe=0;var ke=ve===""?".":ve+":";if(k(W))for(var Ie=0;Ie<W.length;Ie++)ve=W[Ie],Ae=ke+J(ve,Ie),xe+=q(ve,Q,ce,Ae,Te);else if(Ie=v(W),typeof Ie=="function")for(W=Ie.call(W),Ie=0;!(ve=W.next()).done;)ve=ve.value,Ae=ke+J(ve,Ie++),xe+=q(ve,Q,ce,Ae,Te);else if(Ae==="object"){if(typeof W.then=="function")return q(ne(W),Q,ce,ve,Te);throw Q=String(W),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(W).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return xe}function Y(W,Q,ce){if(W==null)return W;var ve=[],Te=0;return q(W,ve,"","",function(Ae){return Q.call(ce,Ae,Te++)}),ve}function ee(W){if(W._status===-1){var Q=W._result;Q=Q(),Q.then(function(ce){(W._status===0||W._status===-1)&&(W._status=1,W._result=ce)},function(ce){(W._status===0||W._status===-1)&&(W._status=2,W._result=ce)}),W._status===-1&&(W._status=0,W._result=Q)}if(W._status===1)return W._result.default;throw W._result}var ue=typeof reportError=="function"?reportError:function(W){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof W=="object"&&W!==null&&typeof W.message=="string"?String(W.message):String(W),error:W});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",W);return}console.error(W)},fe={map:Y,forEach:function(W,Q,ce){Y(W,function(){Q.apply(this,arguments)},ce)},count:function(W){var Q=0;return Y(W,function(){Q++}),Q},toArray:function(W){return Y(W,function(Q){return Q})||[]},only:function(W){if(!F(W))throw Error("React.Children.only expected to receive a single React element child.");return W}};return rt.Activity=p,rt.Children=fe,rt.Component=T,rt.Fragment=t,rt.Profiler=i,rt.PureComponent=I,rt.StrictMode=r,rt.Suspense=c,rt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,rt.__COMPILER_RUNTIME={__proto__:null,c:function(W){return O.H.useMemoCache(W)}},rt.cache=function(W){return function(){return W.apply(null,arguments)}},rt.cacheSignal=function(){return null},rt.cloneElement=function(W,Q,ce){if(W==null)throw Error("The argument must be a React element, but you passed "+W+".");var ve=w({},W.props),Te=W.key;if(Q!=null)for(Ae in Q.key!==void 0&&(Te=""+Q.key),Q)!N.call(Q,Ae)||Ae==="key"||Ae==="__self"||Ae==="__source"||Ae==="ref"&&Q.ref===void 0||(ve[Ae]=Q[Ae]);var Ae=arguments.length-2;if(Ae===1)ve.children=ce;else if(1<Ae){for(var xe=Array(Ae),ke=0;ke<Ae;ke++)xe[ke]=arguments[ke+2];ve.children=xe}return D(W.type,Te,ve)},rt.createContext=function(W){return W={$$typeof:o,_currentValue:W,_currentValue2:W,_threadCount:0,Provider:null,Consumer:null},W.Provider=W,W.Consumer={$$typeof:a,_context:W},W},rt.createElement=function(W,Q,ce){var ve,Te={},Ae=null;if(Q!=null)for(ve in Q.key!==void 0&&(Ae=""+Q.key),Q)N.call(Q,ve)&&ve!=="key"&&ve!=="__self"&&ve!=="__source"&&(Te[ve]=Q[ve]);var xe=arguments.length-2;if(xe===1)Te.children=ce;else if(1<xe){for(var ke=Array(xe),Ie=0;Ie<xe;Ie++)ke[Ie]=arguments[Ie+2];Te.children=ke}if(W&&W.defaultProps)for(ve in xe=W.defaultProps,xe)Te[ve]===void 0&&(Te[ve]=xe[ve]);return D(W,Ae,Te)},rt.createRef=function(){return{current:null}},rt.forwardRef=function(W){return{$$typeof:u,render:W}},rt.isValidElement=F,rt.lazy=function(W){return{$$typeof:d,_payload:{_status:-1,_result:W},_init:ee}},rt.memo=function(W,Q){return{$$typeof:h,type:W,compare:Q===void 0?null:Q}},rt.startTransition=function(W){var Q=O.T,ce={};O.T=ce;try{var ve=W(),Te=O.S;Te!==null&&Te(ce,ve),typeof ve=="object"&&ve!==null&&typeof ve.then=="function"&&ve.then(L,ue)}catch(Ae){ue(Ae)}finally{Q!==null&&ce.types!==null&&(Q.types=ce.types),O.T=Q}},rt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},rt.use=function(W){return O.H.use(W)},rt.useActionState=function(W,Q,ce){return O.H.useActionState(W,Q,ce)},rt.useCallback=function(W,Q){return O.H.useCallback(W,Q)},rt.useContext=function(W){return O.H.useContext(W)},rt.useDebugValue=function(){},rt.useDeferredValue=function(W,Q){return O.H.useDeferredValue(W,Q)},rt.useEffect=function(W,Q){return O.H.useEffect(W,Q)},rt.useEffectEvent=function(W){return O.H.useEffectEvent(W)},rt.useId=function(){return O.H.useId()},rt.useImperativeHandle=function(W,Q,ce){return O.H.useImperativeHandle(W,Q,ce)},rt.useInsertionEffect=function(W,Q){return O.H.useInsertionEffect(W,Q)},rt.useLayoutEffect=function(W,Q){return O.H.useLayoutEffect(W,Q)},rt.useMemo=function(W,Q){return O.H.useMemo(W,Q)},rt.useOptimistic=function(W,Q){return O.H.useOptimistic(W,Q)},rt.useReducer=function(W,Q,ce){return O.H.useReducer(W,Q,ce)},rt.useRef=function(W){return O.H.useRef(W)},rt.useState=function(W){return O.H.useState(W)},rt.useSyncExternalStore=function(W,Q,ce){return O.H.useSyncExternalStore(W,Q,ce)},rt.useTransition=function(){return O.H.useTransition()},rt.version="19.2.3",rt}var QC;function O1(){return QC||(QC=1,X0.exports=pF()),X0.exports}var oe=O1();const mF=yN(oe);var Y0={exports:{}},_f={},$0={exports:{}},Q0={};var ZC;function gF(){return ZC||(ZC=1,(function(n){function e(q,Y){var ee=q.length;q.push(Y);e:for(;0<ee;){var ue=ee-1>>>1,fe=q[ue];if(0<i(fe,Y))q[ue]=Y,q[ee]=fe,ee=ue;else break e}}function t(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var Y=q[0],ee=q.pop();if(ee!==Y){q[0]=ee;e:for(var ue=0,fe=q.length,W=fe>>>1;ue<W;){var Q=2*(ue+1)-1,ce=q[Q],ve=Q+1,Te=q[ve];if(0>i(ce,ee))ve<fe&&0>i(Te,ce)?(q[ue]=Te,q[ve]=ee,ue=ve):(q[ue]=ce,q[Q]=ee,ue=Q);else if(ve<fe&&0>i(Te,ee))q[ue]=Te,q[ve]=ee,ue=ve;else break e}}return Y}function i(q,Y){var ee=q.sortIndex-Y.sortIndex;return ee!==0?ee:q.id-Y.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,u=o.now();n.unstable_now=function(){return o.now()-u}}var c=[],h=[],d=1,p=null,g=3,v=!1,b=!1,w=!1,E=!1,T=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function C(q){for(var Y=t(h);Y!==null;){if(Y.callback===null)r(h);else if(Y.startTime<=q)r(h),Y.sortIndex=Y.expirationTime,e(c,Y);else break;Y=t(h)}}function k(q){if(w=!1,C(q),!b)if(t(c)!==null)b=!0,L||(L=!0,j());else{var Y=t(h);Y!==null&&ne(k,Y.startTime-q)}}var L=!1,O=-1,N=5,D=-1;function P(){return E?!0:!(n.unstable_now()-D<N)}function F(){if(E=!1,L){var q=n.unstable_now();D=q;var Y=!0;try{e:{b=!1,w&&(w=!1,R(O),O=-1),v=!0;var ee=g;try{t:{for(C(q),p=t(c);p!==null&&!(p.expirationTime>q&&P());){var ue=p.callback;if(typeof ue=="function"){p.callback=null,g=p.priorityLevel;var fe=ue(p.expirationTime<=q);if(q=n.unstable_now(),typeof fe=="function"){p.callback=fe,C(q),Y=!0;break t}p===t(c)&&r(c),C(q)}else r(c);p=t(c)}if(p!==null)Y=!0;else{var W=t(h);W!==null&&ne(k,W.startTime-q),Y=!1}}break e}finally{p=null,g=ee,v=!1}Y=void 0}}finally{Y?j():L=!1}}}var j;if(typeof I=="function")j=function(){I(F)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,J=B.port2;B.port1.onmessage=F,j=function(){J.postMessage(null)}}else j=function(){T(F,0)};function ne(q,Y){O=T(function(){q(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(q){q.callback=null},n.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<q?Math.floor(1e3/q):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_next=function(q){switch(g){case 1:case 2:case 3:var Y=3;break;default:Y=g}var ee=g;g=Y;try{return q()}finally{g=ee}},n.unstable_requestPaint=function(){E=!0},n.unstable_runWithPriority=function(q,Y){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ee=g;g=q;try{return Y()}finally{g=ee}},n.unstable_scheduleCallback=function(q,Y,ee){var ue=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?ue+ee:ue):ee=ue,q){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=ee+fe,q={id:d++,callback:Y,priorityLevel:q,startTime:ee,expirationTime:fe,sortIndex:-1},ee>ue?(q.sortIndex=ee,e(h,q),t(c)===null&&q===t(h)&&(w?(R(O),O=-1):w=!0,ne(k,ee-ue))):(q.sortIndex=fe,e(c,q),b||v||(b=!0,L||(L=!0,j()))),q},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(q){var Y=g;return function(){var ee=g;g=Y;try{return q.apply(this,arguments)}finally{g=ee}}}})(Q0)),Q0}var JC;function vF(){return JC||(JC=1,$0.exports=gF()),$0.exports}var Z0={exports:{}},_r={};var eS;function yF(){if(eS)return _r;eS=1;var n=O1();function e(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(c,h,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:c,containerInfo:h,implementation:d}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(c,h){if(c==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return _r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,_r.createPortal=function(c,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return a(c,h,null,d)},_r.flushSync=function(c){var h=o.T,d=r.p;try{if(o.T=null,r.p=2,c)return c()}finally{o.T=h,r.p=d,r.d.f()}},_r.preconnect=function(c,h){typeof c=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(c,h))},_r.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},_r.preinit=function(c,h){if(typeof c=="string"&&h&&typeof h.as=="string"){var d=h.as,p=u(d,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?r.d.S(c,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:v}):d==="script"&&r.d.X(c,{crossOrigin:p,integrity:g,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},_r.preinitModule=function(c,h){if(typeof c=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=u(h.as,h.crossOrigin);r.d.M(c,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(c)},_r.preload=function(c,h){if(typeof c=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,p=u(d,h.crossOrigin);r.d.L(c,d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},_r.preloadModule=function(c,h){if(typeof c=="string")if(h){var d=u(h.as,h.crossOrigin);r.d.m(c,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(c)},_r.requestFormReset=function(c){r.d.r(c)},_r.unstable_batchedUpdates=function(c,h){return c(h)},_r.useFormState=function(c,h,d){return o.H.useFormState(c,h,d)},_r.useFormStatus=function(){return o.H.useHostTransitionStatus()},_r.version="19.2.3",_r}var tS;function _F(){if(tS)return Z0.exports;tS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Z0.exports=yF(),Z0.exports}var nS;function bF(){if(nS)return _f;nS=1;var n=vF(),e=O1(),t=_F();function r(s){var l="https://react.dev/errors/"+s;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+s+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function a(s){var l=s,f=s;if(s.alternate)for(;l.return;)l=l.return;else{s=l;do l=s,(l.flags&4098)!==0&&(f=l.return),s=l.return;while(s)}return l.tag===3?f:null}function o(s){if(s.tag===13){var l=s.memoizedState;if(l===null&&(s=s.alternate,s!==null&&(l=s.memoizedState)),l!==null)return l.dehydrated}return null}function u(s){if(s.tag===31){var l=s.memoizedState;if(l===null&&(s=s.alternate,s!==null&&(l=s.memoizedState)),l!==null)return l.dehydrated}return null}function c(s){if(a(s)!==s)throw Error(r(188))}function h(s){var l=s.alternate;if(!l){if(l=a(s),l===null)throw Error(r(188));return l!==s?null:s}for(var f=s,m=l;;){var _=f.return;if(_===null)break;var x=_.alternate;if(x===null){if(m=_.return,m!==null){f=m;continue}break}if(_.child===x.child){for(x=_.child;x;){if(x===f)return c(_),s;if(x===m)return c(_),l;x=x.sibling}throw Error(r(188))}if(f.return!==m.return)f=_,m=x;else{for(var M=!1,U=_.child;U;){if(U===f){M=!0,f=_,m=x;break}if(U===m){M=!0,m=_,f=x;break}U=U.sibling}if(!M){for(U=x.child;U;){if(U===f){M=!0,f=x,m=_;break}if(U===m){M=!0,m=x,f=_;break}U=U.sibling}if(!M)throw Error(r(189))}}if(f.alternate!==m)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?s:l}function d(s){var l=s.tag;if(l===5||l===26||l===27||l===6)return s;for(s=s.child;s!==null;){if(l=d(s),l!==null)return l;s=s.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),I=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),D=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=F&&s[F]||s["@@iterator"],typeof s=="function"?s:null)}var B=Symbol.for("react.client.reference");function J(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===B?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case w:return"Fragment";case T:return"Profiler";case E:return"StrictMode";case k:return"Suspense";case L:return"SuspenseList";case D:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case b:return"Portal";case I:return s.displayName||"Context";case R:return(s._context.displayName||"Context")+".Consumer";case C:var l=s.render;return s=s.displayName,s||(s=l.displayName||l.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case O:return l=s.displayName||null,l!==null?l:J(s.type)||"Memo";case N:l=s._payload,s=s._init;try{return J(s(l))}catch{}}return null}var ne=Array.isArray,q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},ue=[],fe=-1;function W(s){return{current:s}}function Q(s){0>fe||(s.current=ue[fe],ue[fe]=null,fe--)}function ce(s,l){fe++,ue[fe]=s.current,s.current=l}var ve=W(null),Te=W(null),Ae=W(null),xe=W(null);function ke(s,l){switch(ce(Ae,l),ce(Te,s),ce(ve,null),l.nodeType){case 9:case 11:s=(s=l.documentElement)&&(s=s.namespaceURI)?vC(s):0;break;default:if(s=l.tagName,l=l.namespaceURI)l=vC(l),s=yC(l,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Q(ve),ce(ve,s)}function Ie(){Q(ve),Q(Te),Q(Ae)}function qe(s){s.memoizedState!==null&&ce(xe,s);var l=ve.current,f=yC(l,s.type);l!==f&&(ce(Te,s),ce(ve,f))}function Je(s){Te.current===s&&(Q(ve),Q(Te)),xe.current===s&&(Q(xe),pf._currentValue=ee)}var Ze,Xe;function ot(s){if(Ze===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);Ze=l&&l[1]||"",Xe=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ze+s+Xe}var $e=!1;function lt(s,l){if(!s||$e)return"";$e=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var be=function(){throw Error()};if(Object.defineProperty(be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(be,[])}catch(de){var se=de}Reflect.construct(s,[],be)}else{try{be.call()}catch(de){se=de}s.call(be.prototype)}}else{try{throw Error()}catch(de){se=de}(be=s())&&typeof be.catch=="function"&&be.catch(function(){})}}catch(de){if(de&&se&&typeof de.stack=="string")return[de.stack,se.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=m.DetermineComponentFrameRoot(),M=x[0],U=x[1];if(M&&U){var K=M.split(`
`),ae=U.split(`
`);for(_=m=0;m<K.length&&!K[m].includes("DetermineComponentFrameRoot");)m++;for(;_<ae.length&&!ae[_].includes("DetermineComponentFrameRoot");)_++;if(m===K.length||_===ae.length)for(m=K.length-1,_=ae.length-1;1<=m&&0<=_&&K[m]!==ae[_];)_--;for(;1<=m&&0<=_;m--,_--)if(K[m]!==ae[_]){if(m!==1||_!==1)do if(m--,_--,0>_||K[m]!==ae[_]){var me=`
`+K[m].replace(" at new "," at ");return s.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",s.displayName)),me}while(1<=m&&0<=_);break}}}finally{$e=!1,Error.prepareStackTrace=f}return(f=s?s.displayName||s.name:"")?ot(f):""}function Kn(s,l){switch(s.tag){case 26:case 27:case 5:return ot(s.type);case 16:return ot("Lazy");case 13:return s.child!==l&&l!==null?ot("Suspense Fallback"):ot("Suspense");case 19:return ot("SuspenseList");case 0:case 15:return lt(s.type,!1);case 11:return lt(s.type.render,!1);case 1:return lt(s.type,!0);case 31:return ot("Activity");default:return""}}function xn(s){try{var l="",f=null;do l+=Kn(s,f),f=s,s=s.return;while(s);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var et=Object.prototype.hasOwnProperty,Vt=n.unstable_scheduleCallback,Xn=n.unstable_cancelCallback,_i=n.unstable_shouldYield,Lr=n.unstable_requestPaint,ln=n.unstable_now,ar=n.unstable_getCurrentPriorityLevel,ao=n.unstable_ImmediatePriority,bi=n.unstable_UserBlockingPriority,Fn=n.unstable_NormalPriority,ou=n.unstable_LowPriority,ml=n.unstable_IdlePriority,gl=n.log,vl=n.unstable_setDisableYieldValue,Mr=null,pn=null;function yr(s){if(typeof gl=="function"&&vl(s),pn&&typeof pn.setStrictMode=="function")try{pn.setStrictMode(Mr,s)}catch{}}var mn=Math.clz32?Math.clz32:Jd,Zd=Math.log,yl=Math.LN2;function Jd(s){return s>>>=0,s===0?32:31-(Zd(s)/yl|0)|0}var pa=256,su=262144,wn=4194304;function ma(s){var l=s&42;if(l!==0)return l;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ga(s,l,f){var m=s.pendingLanes;if(m===0)return 0;var _=0,x=s.suspendedLanes,M=s.pingedLanes;s=s.warmLanes;var U=m&134217727;return U!==0?(m=U&~x,m!==0?_=ma(m):(M&=U,M!==0?_=ma(M):f||(f=U&~s,f!==0&&(_=ma(f))))):(U=m&~x,U!==0?_=ma(U):M!==0?_=ma(M):f||(f=m&~s,f!==0&&(_=ma(f)))),_===0?0:l!==0&&l!==_&&(l&x)===0&&(x=_&-_,f=l&-l,x>=f||x===32&&(f&4194048)!==0)?l:_}function Hi(s,l){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&l)===0}function Qv(s,l){switch(s){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ep(){var s=wn;return wn<<=1,(wn&62914560)===0&&(wn=4194304),s}function va(s){for(var l=[],f=0;31>f;f++)l.push(s);return l}function uu(s,l){s.pendingLanes|=l,l!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Zv(s,l,f,m,_,x){var M=s.pendingLanes;s.pendingLanes=f,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=f,s.entangledLanes&=f,s.errorRecoveryDisabledLanes&=f,s.shellSuspendCounter=0;var U=s.entanglements,K=s.expirationTimes,ae=s.hiddenUpdates;for(f=M&~f;0<f;){var me=31-mn(f),be=1<<me;U[me]=0,K[me]=-1;var se=ae[me];if(se!==null)for(ae[me]=null,me=0;me<se.length;me++){var de=se[me];de!==null&&(de.lane&=-536870913)}f&=~be}m!==0&&lu(s,m,0),x!==0&&_===0&&s.tag!==0&&(s.suspendedLanes|=x&~(M&~l))}function lu(s,l,f){s.pendingLanes|=l,s.suspendedLanes&=~l;var m=31-mn(l);s.entangledLanes|=l,s.entanglements[m]=s.entanglements[m]|1073741824|f&261930}function yh(s,l){var f=s.entangledLanes|=l;for(s=s.entanglements;f;){var m=31-mn(f),_=1<<m;_&l|s[m]&l&&(s[m]|=l),f&=~_}}function _h(s,l){var f=l&-l;return f=(f&42)!==0?1:cu(f),(f&(s.suspendedLanes|l))!==0?0:f}function cu(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function oo(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function tp(){var s=Y.p;return s!==0?s:(s=window.event,s===void 0?32:UC(s.type))}function Wi(s,l){var f=Y.p;try{return Y.p=s,l()}finally{Y.p=f}}var qi=Math.random().toString(36).slice(2),En="__reactFiber$"+qi,Yn="__reactProps$"+qi,ya="__reactContainer$"+qi,_l="__reactEvents$"+qi,Jv="__reactListeners$"+qi,np="__reactHandles$"+qi,rp="__reactResources$"+qi,_a="__reactMarker$"+qi;function bl(s){delete s[En],delete s[Yn],delete s[_l],delete s[Jv],delete s[np]}function ba(s){var l=s[En];if(l)return l;for(var f=s.parentNode;f;){if(l=f[ya]||f[En]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(s=CC(s);s!==null;){if(f=s[En])return f;s=CC(s)}return l}s=f,f=s.parentNode}return null}function xi(s){if(s=s[En]||s[ya]){var l=s.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return s}return null}function ti(s){var l=s.tag;if(l===5||l===26||l===27||l===6)return s.stateNode;throw Error(r(33))}function xa(s){var l=s[rp];return l||(l=s[rp]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Tn(s){s[_a]=!0}var bh=new Set,xh={};function wa(s,l){Ea(s,l),Ea(s+"Capture",l)}function Ea(s,l){for(xh[s]=l,s=0;s<l.length;s++)bh.add(l[s])}var wh=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Eh={},Th={};function ip(s){return et.call(Th,s)?!0:et.call(Eh,s)?!1:wh.test(s)?Th[s]=!0:(Eh[s]=!0,!1)}function xl(s,l,f){if(ip(l))if(f===null)s.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":s.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(l);return}}s.setAttribute(l,""+f)}}function ni(s,l,f){if(f===null)s.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttribute(l,""+f)}}function Cn(s,l,f,m){if(m===null)s.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(f);return}s.setAttributeNS(l,f,""+m)}}function $n(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ko(s){var l=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Ch(s,l,f){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,l);if(!s.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var _=m.get,x=m.set;return Object.defineProperty(s,l,{configurable:!0,get:function(){return _.call(this)},set:function(M){f=""+M,x.call(this,M)}}),Object.defineProperty(s,l,{enumerable:m.enumerable}),{getValue:function(){return f},setValue:function(M){f=""+M},stopTracking:function(){s._valueTracker=null,delete s[l]}}}}function Ft(s){if(!s._valueTracker){var l=Ko(s)?"checked":"value";s._valueTracker=Ch(s,l,""+s[l])}}function hu(s){if(!s)return!1;var l=s._valueTracker;if(!l)return!0;var f=l.getValue(),m="";return s&&(m=Ko(s)?s.checked?"true":"false":s.value),s=m,s!==f?(l.setValue(s),!0):!1}function Ta(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var fu=/[\n"\\]/g;function Br(s){return s.replace(fu,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function wl(s,l,f,m,_,x,M,U){s.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?s.type=M:s.removeAttribute("type"),l!=null?M==="number"?(l===0&&s.value===""||s.value!=l)&&(s.value=""+$n(l)):s.value!==""+$n(l)&&(s.value=""+$n(l)):M!=="submit"&&M!=="reset"||s.removeAttribute("value"),l!=null?Sh(s,M,$n(l)):f!=null?Sh(s,M,$n(f)):m!=null&&s.removeAttribute("value"),_==null&&x!=null&&(s.defaultChecked=!!x),_!=null&&(s.checked=_&&typeof _!="function"&&typeof _!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?s.name=""+$n(U):s.removeAttribute("name")}function ap(s,l,f,m,_,x,M,U){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.type=x),l!=null||f!=null){if(!(x!=="submit"&&x!=="reset"||l!=null)){Ft(s);return}f=f!=null?""+$n(f):"",l=l!=null?""+$n(l):f,U||l===s.value||(s.value=l),s.defaultValue=l}m=m??_,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=U?s.checked:!!m,s.defaultChecked=!!m,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(s.name=M),Ft(s)}function Sh(s,l,f){l==="number"&&Ta(s.ownerDocument)===s||s.defaultValue===""+f||(s.defaultValue=""+f)}function Xo(s,l,f,m){if(s=s.options,l){l={};for(var _=0;_<f.length;_++)l["$"+f[_]]=!0;for(f=0;f<s.length;f++)_=l.hasOwnProperty("$"+s[f].value),s[f].selected!==_&&(s[f].selected=_),_&&m&&(s[f].defaultSelected=!0)}else{for(f=""+$n(f),l=null,_=0;_<s.length;_++){if(s[_].value===f){s[_].selected=!0,m&&(s[_].defaultSelected=!0);return}l!==null||s[_].disabled||(l=s[_])}l!==null&&(l.selected=!0)}}function op(s,l,f){if(l!=null&&(l=""+$n(l),l!==s.value&&(s.value=l),f==null)){s.defaultValue!==l&&(s.defaultValue=l);return}s.defaultValue=f!=null?""+$n(f):""}function Yo(s,l,f,m){if(l==null){if(m!=null){if(f!=null)throw Error(r(92));if(ne(m)){if(1<m.length)throw Error(r(93));m=m[0]}f=m}f==null&&(f=""),l=f}f=$n(l),s.defaultValue=f,m=s.textContent,m===f&&m!==""&&m!==null&&(s.value=m),Ft(s)}function jr(s,l){if(l){var f=s.firstChild;if(f&&f===s.lastChild&&f.nodeType===3){f.nodeValue=l;return}}s.textContent=l}var sp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ah(s,l,f){var m=l.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?s.setProperty(l,""):l==="float"?s.cssFloat="":s[l]="":m?s.setProperty(l,f):typeof f!="number"||f===0||sp.has(l)?l==="float"?s.cssFloat=f:s[l]=(""+f).trim():s[l]=f+"px"}function Rh(s,l,f){if(l!=null&&typeof l!="object")throw Error(r(62));if(s=s.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var _ in l)m=l[_],l.hasOwnProperty(_)&&f[_]!==m&&Ah(s,_,m)}else for(var x in l)l.hasOwnProperty(x)&&Ah(s,x,l[x])}function El(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var up=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$o=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tl(s){return $o.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Ki(){}var Ih=null;function wi(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Qo=null,Ca=null;function du(s){var l=xi(s);if(l&&(s=l.stateNode)){var f=s[Yn]||null;e:switch(s=l.stateNode,l.type){case"input":if(wl(s,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),l=f.name,f.type==="radio"&&l!=null){for(f=s;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Br(""+l)+'"][type="radio"]'),l=0;l<f.length;l++){var m=f[l];if(m!==s&&m.form===s.form){var _=m[Yn]||null;if(!_)throw Error(r(90));wl(m,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(l=0;l<f.length;l++)m=f[l],m.form===s.form&&hu(m)}break e;case"textarea":op(s,f.value,f.defaultValue);break e;case"select":l=f.value,l!=null&&Xo(s,!!f.multiple,l,!1)}}}var Cl=!1;function Zo(s,l,f){if(Cl)return s(l,f);Cl=!0;try{var m=s(l);return m}finally{if(Cl=!1,(Qo!==null||Ca!==null)&&(tm(),Qo&&(l=Qo,s=Ca,Ca=Qo=null,du(l),s)))for(l=0;l<s.length;l++)du(s[l])}}function Xi(s,l){var f=s.stateNode;if(f===null)return null;var m=f[Yn]||null;if(m===null)return null;f=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(f&&typeof f!="function")throw Error(r(231,l,typeof f));return f}var Ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pu=!1;if(Ei)try{var jt={};Object.defineProperty(jt,"passive",{get:function(){pu=!0}}),window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,jt)}catch{pu=!1}var Sa=null,Nh=null,mu=null;function Dh(){if(mu)return mu;var s,l=Nh,f=l.length,m,_="value"in Sa?Sa.value:Sa.textContent,x=_.length;for(s=0;s<f&&l[s]===_[s];s++);var M=f-s;for(m=1;m<=M&&l[f-m]===_[x-m];m++);return mu=_.slice(s,1<m?1-m:void 0)}function gu(s){var l=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&l===13&&(s=13)):s=l,s===10&&(s=13),32<=s||s===13?s:0}function so(){return!0}function Yi(){return!1}function or(s){function l(f,m,_,x,M){this._reactName=f,this._targetInst=_,this.type=m,this.nativeEvent=x,this.target=M,this.currentTarget=null;for(var U in s)s.hasOwnProperty(U)&&(f=s[U],this[U]=f?f(x):x[U]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?so:Yi,this.isPropagationStopped=Yi,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=so)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=so)},persist:function(){},isPersistent:so}),l}var uo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Aa=or(uo),Jo=p({},uo,{view:0,detail:0}),kh=or(Jo),es,Sl,Ra,Al=p({},Jo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ts,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ra&&(Ra&&s.type==="mousemove"?(es=s.screenX-Ra.screenX,Sl=s.screenY-Ra.screenY):Sl=es=0,Ra=s),es)},movementY:function(s){return"movementY"in s?s.movementY:Sl}}),Mh=or(Al),vu=p({},Al,{dataTransfer:0}),lp=or(vu),cp=p({},Jo,{relatedTarget:0}),yu=or(cp),Oh=p({},uo,{animationName:0,elapsedTime:0,pseudoElement:0}),hp=or(Oh),Rl=p({},uo,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),fp=or(Rl),dp=p({},uo,{data:0}),Ia=or(dp),pp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vp(s){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(s):(s=gp[s])?!!l[s]:!1}function ts(){return vp}var Or=p({},Jo,{key:function(s){if(s.key){var l=pp[s.key]||s.key;if(l!=="Unidentified")return l}return s.type==="keypress"?(s=gu(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?mp[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ts,charCode:function(s){return s.type==="keypress"?gu(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?gu(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),yp=or(Or),_p=p({},Al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lo=or(_p),y=p({},Jo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ts}),A=or(y),V=p({},uo,{propertyName:0,elapsedTime:0,pseudoElement:0}),G=or(V),re=p({},Al,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),he=or(re),Se=p({},uo,{newState:0,oldState:0}),st=or(Se),gn=[9,13,27,32],It=Ei&&"CompositionEvent"in window,tn=null;Ei&&"documentMode"in document&&(tn=document.documentMode);var Ti=Ei&&"TextEvent"in window&&!tn,Na=Ei&&(!It||tn&&8<tn&&11>=tn),$i=" ",Qi=!1;function _u(s,l){switch(s){case"keyup":return gn.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Il(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Nl=!1;function PP(s,l){switch(s){case"compositionend":return Il(l);case"keypress":return l.which!==32?null:(Qi=!0,$i);case"textInput":return s=l.data,s===$i&&Qi?null:s;default:return null}}function VP(s,l){if(Nl)return s==="compositionend"||!It&&_u(s,l)?(s=Dh(),mu=Nh=Sa=null,Nl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return Na&&l.locale!=="ko"?null:l.data;default:return null}}var FP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RE(s){var l=s&&s.nodeName&&s.nodeName.toLowerCase();return l==="input"?!!FP[s.type]:l==="textarea"}function IE(s,l,f,m){Qo?Ca?Ca.push(m):Ca=[m]:Qo=m,l=um(l,"onChange"),0<l.length&&(f=new Aa("onChange","change",null,f,m),s.push({event:f,listeners:l}))}var Ph=null,Vh=null;function LP(s){hC(s,0)}function bp(s){var l=ti(s);if(hu(l))return s}function NE(s,l){if(s==="change")return l}var DE=!1;if(Ei){var ey;if(Ei){var ty="oninput"in document;if(!ty){var kE=document.createElement("div");kE.setAttribute("oninput","return;"),ty=typeof kE.oninput=="function"}ey=ty}else ey=!1;DE=ey&&(!document.documentMode||9<document.documentMode)}function ME(){Ph&&(Ph.detachEvent("onpropertychange",OE),Vh=Ph=null)}function OE(s){if(s.propertyName==="value"&&bp(Vh)){var l=[];IE(l,Vh,s,wi(s)),Zo(LP,l)}}function BP(s,l,f){s==="focusin"?(ME(),Ph=l,Vh=f,Ph.attachEvent("onpropertychange",OE)):s==="focusout"&&ME()}function jP(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return bp(Vh)}function UP(s,l){if(s==="click")return bp(l)}function zP(s,l){if(s==="input"||s==="change")return bp(l)}function GP(s,l){return s===l&&(s!==0||1/s===1/l)||s!==s&&l!==l}var ri=typeof Object.is=="function"?Object.is:GP;function Fh(s,l){if(ri(s,l))return!0;if(typeof s!="object"||s===null||typeof l!="object"||l===null)return!1;var f=Object.keys(s),m=Object.keys(l);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var _=f[m];if(!et.call(l,_)||!ri(s[_],l[_]))return!1}return!0}function PE(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function VE(s,l){var f=PE(s);s=0;for(var m;f;){if(f.nodeType===3){if(m=s+f.textContent.length,s<=l&&m>=l)return{node:f,offset:l-s};s=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=PE(f)}}function FE(s,l){return s&&l?s===l?!0:s&&s.nodeType===3?!1:l&&l.nodeType===3?FE(s,l.parentNode):"contains"in s?s.contains(l):s.compareDocumentPosition?!!(s.compareDocumentPosition(l)&16):!1:!1}function LE(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var l=Ta(s.document);l instanceof s.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)s=l.contentWindow;else break;l=Ta(s.document)}return l}function ny(s){var l=s&&s.nodeName&&s.nodeName.toLowerCase();return l&&(l==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||l==="textarea"||s.contentEditable==="true")}var HP=Ei&&"documentMode"in document&&11>=document.documentMode,Dl=null,ry=null,Lh=null,iy=!1;function BE(s,l,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;iy||Dl==null||Dl!==Ta(m)||(m=Dl,"selectionStart"in m&&ny(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Lh&&Fh(Lh,m)||(Lh=m,m=um(ry,"onSelect"),0<m.length&&(l=new Aa("onSelect","select",null,l,f),s.push({event:l,listeners:m}),l.target=Dl)))}function bu(s,l){var f={};return f[s.toLowerCase()]=l.toLowerCase(),f["Webkit"+s]="webkit"+l,f["Moz"+s]="moz"+l,f}var kl={animationend:bu("Animation","AnimationEnd"),animationiteration:bu("Animation","AnimationIteration"),animationstart:bu("Animation","AnimationStart"),transitionrun:bu("Transition","TransitionRun"),transitionstart:bu("Transition","TransitionStart"),transitioncancel:bu("Transition","TransitionCancel"),transitionend:bu("Transition","TransitionEnd")},ay={},jE={};Ei&&(jE=document.createElement("div").style,"AnimationEvent"in window||(delete kl.animationend.animation,delete kl.animationiteration.animation,delete kl.animationstart.animation),"TransitionEvent"in window||delete kl.transitionend.transition);function xu(s){if(ay[s])return ay[s];if(!kl[s])return s;var l=kl[s],f;for(f in l)if(l.hasOwnProperty(f)&&f in jE)return ay[s]=l[f];return s}var UE=xu("animationend"),zE=xu("animationiteration"),GE=xu("animationstart"),WP=xu("transitionrun"),qP=xu("transitionstart"),KP=xu("transitioncancel"),HE=xu("transitionend"),WE=new Map,oy="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");oy.push("scrollEnd");function Zi(s,l){WE.set(s,l),wa(l,[s])}var xp=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Ci=[],Ml=0,sy=0;function wp(){for(var s=Ml,l=sy=Ml=0;l<s;){var f=Ci[l];Ci[l++]=null;var m=Ci[l];Ci[l++]=null;var _=Ci[l];Ci[l++]=null;var x=Ci[l];if(Ci[l++]=null,m!==null&&_!==null){var M=m.pending;M===null?_.next=_:(_.next=M.next,M.next=_),m.pending=_}x!==0&&qE(f,_,x)}}function Ep(s,l,f,m){Ci[Ml++]=s,Ci[Ml++]=l,Ci[Ml++]=f,Ci[Ml++]=m,sy|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function uy(s,l,f,m){return Ep(s,l,f,m),Tp(s)}function wu(s,l){return Ep(s,null,null,l),Tp(s)}function qE(s,l,f){s.lanes|=f;var m=s.alternate;m!==null&&(m.lanes|=f);for(var _=!1,x=s.return;x!==null;)x.childLanes|=f,m=x.alternate,m!==null&&(m.childLanes|=f),x.tag===22&&(s=x.stateNode,s===null||s._visibility&1||(_=!0)),s=x,x=x.return;return s.tag===3?(x=s.stateNode,_&&l!==null&&(_=31-mn(f),s=x.hiddenUpdates,m=s[_],m===null?s[_]=[l]:m.push(l),l.lane=f|536870912),x):null}function Tp(s){if(50<sf)throw sf=0,v0=null,Error(r(185));for(var l=s.return;l!==null;)s=l,l=s.return;return s.tag===3?s.stateNode:null}var Ol={};function XP(s,l,f,m){this.tag=s,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ii(s,l,f,m){return new XP(s,l,f,m)}function ly(s){return s=s.prototype,!(!s||!s.isReactComponent)}function co(s,l){var f=s.alternate;return f===null?(f=ii(s.tag,l,s.key,s.mode),f.elementType=s.elementType,f.type=s.type,f.stateNode=s.stateNode,f.alternate=s,s.alternate=f):(f.pendingProps=l,f.type=s.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=s.flags&65011712,f.childLanes=s.childLanes,f.lanes=s.lanes,f.child=s.child,f.memoizedProps=s.memoizedProps,f.memoizedState=s.memoizedState,f.updateQueue=s.updateQueue,l=s.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=s.sibling,f.index=s.index,f.ref=s.ref,f.refCleanup=s.refCleanup,f}function KE(s,l){s.flags&=65011714;var f=s.alternate;return f===null?(s.childLanes=0,s.lanes=l,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=f.childLanes,s.lanes=f.lanes,s.child=f.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=f.memoizedProps,s.memoizedState=f.memoizedState,s.updateQueue=f.updateQueue,s.type=f.type,l=f.dependencies,s.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),s}function Cp(s,l,f,m,_,x){var M=0;if(m=s,typeof s=="function")ly(s)&&(M=1);else if(typeof s=="string")M=JV(s,f,ve.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case D:return s=ii(31,f,l,_),s.elementType=D,s.lanes=x,s;case w:return Eu(f.children,_,x,l);case E:M=8,_|=24;break;case T:return s=ii(12,f,l,_|2),s.elementType=T,s.lanes=x,s;case k:return s=ii(13,f,l,_),s.elementType=k,s.lanes=x,s;case L:return s=ii(19,f,l,_),s.elementType=L,s.lanes=x,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:M=10;break e;case R:M=9;break e;case C:M=11;break e;case O:M=14;break e;case N:M=16,m=null;break e}M=29,f=Error(r(130,s===null?"null":typeof s,"")),m=null}return l=ii(M,f,l,_),l.elementType=s,l.type=m,l.lanes=x,l}function Eu(s,l,f,m){return s=ii(7,s,m,l),s.lanes=f,s}function cy(s,l,f){return s=ii(6,s,null,l),s.lanes=f,s}function XE(s){var l=ii(18,null,null,0);return l.stateNode=s,l}function hy(s,l,f){return l=ii(4,s.children!==null?s.children:[],s.key,l),l.lanes=f,l.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},l}var YE=new WeakMap;function Si(s,l){if(typeof s=="object"&&s!==null){var f=YE.get(s);return f!==void 0?f:(l={value:s,source:l,stack:xn(l)},YE.set(s,l),l)}return{value:s,source:l,stack:xn(l)}}var Pl=[],Vl=0,Sp=null,Bh=0,Ai=[],Ri=0,ns=null,Da=1,ka="";function ho(s,l){Pl[Vl++]=Bh,Pl[Vl++]=Sp,Sp=s,Bh=l}function $E(s,l,f){Ai[Ri++]=Da,Ai[Ri++]=ka,Ai[Ri++]=ns,ns=s;var m=Da;s=ka;var _=32-mn(m)-1;m&=~(1<<_),f+=1;var x=32-mn(l)+_;if(30<x){var M=_-_%5;x=(m&(1<<M)-1).toString(32),m>>=M,_-=M,Da=1<<32-mn(l)+_|f<<_|m,ka=x+s}else Da=1<<x|f<<_|m,ka=s}function fy(s){s.return!==null&&(ho(s,1),$E(s,1,0))}function dy(s){for(;s===Sp;)Sp=Pl[--Vl],Pl[Vl]=null,Bh=Pl[--Vl],Pl[Vl]=null;for(;s===ns;)ns=Ai[--Ri],Ai[Ri]=null,ka=Ai[--Ri],Ai[Ri]=null,Da=Ai[--Ri],Ai[Ri]=null}function QE(s,l){Ai[Ri++]=Da,Ai[Ri++]=ka,Ai[Ri++]=ns,Da=l.id,ka=l.overflow,ns=s}var sr=null,Xt=null,bt=!1,rs=null,Ii=!1,py=Error(r(519));function is(s){var l=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw jh(Si(l,s)),py}function ZE(s){var l=s.stateNode,f=s.type,m=s.memoizedProps;switch(l[En]=s,l[Yn]=m,f){case"dialog":pt("cancel",l),pt("close",l);break;case"iframe":case"object":case"embed":pt("load",l);break;case"video":case"audio":for(f=0;f<lf.length;f++)pt(lf[f],l);break;case"source":pt("error",l);break;case"img":case"image":case"link":pt("error",l),pt("load",l);break;case"details":pt("toggle",l);break;case"input":pt("invalid",l),ap(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":pt("invalid",l);break;case"textarea":pt("invalid",l),Yo(l,m.value,m.defaultValue,m.children)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||l.textContent===""+f||m.suppressHydrationWarning===!0||mC(l.textContent,f)?(m.popover!=null&&(pt("beforetoggle",l),pt("toggle",l)),m.onScroll!=null&&pt("scroll",l),m.onScrollEnd!=null&&pt("scrollend",l),m.onClick!=null&&(l.onclick=Ki),l=!0):l=!1,l||is(s,!0)}function JE(s){for(sr=s.return;sr;)switch(sr.tag){case 5:case 31:case 13:Ii=!1;return;case 27:case 3:Ii=!0;return;default:sr=sr.return}}function Fl(s){if(s!==sr)return!1;if(!bt)return JE(s),bt=!0,!1;var l=s.tag,f;if((f=l!==3&&l!==27)&&((f=l===5)&&(f=s.type,f=!(f!=="form"&&f!=="button")||k0(s.type,s.memoizedProps)),f=!f),f&&Xt&&is(s),JE(s),l===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Xt=TC(s)}else if(l===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Xt=TC(s)}else l===27?(l=Xt,ys(s.type)?(s=F0,F0=null,Xt=s):Xt=l):Xt=sr?Di(s.stateNode.nextSibling):null;return!0}function Tu(){Xt=sr=null,bt=!1}function my(){var s=rs;return s!==null&&(Hr===null?Hr=s:Hr.push.apply(Hr,s),rs=null),s}function jh(s){rs===null?rs=[s]:rs.push(s)}var gy=W(null),Cu=null,fo=null;function as(s,l,f){ce(gy,l._currentValue),l._currentValue=f}function po(s){s._currentValue=gy.current,Q(gy)}function vy(s,l,f){for(;s!==null;){var m=s.alternate;if((s.childLanes&l)!==l?(s.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),s===f)break;s=s.return}}function yy(s,l,f,m){var _=s.child;for(_!==null&&(_.return=s);_!==null;){var x=_.dependencies;if(x!==null){var M=_.child;x=x.firstContext;e:for(;x!==null;){var U=x;x=_;for(var K=0;K<l.length;K++)if(U.context===l[K]){x.lanes|=f,U=x.alternate,U!==null&&(U.lanes|=f),vy(x.return,f,s),m||(M=null);break e}x=U.next}}else if(_.tag===18){if(M=_.return,M===null)throw Error(r(341));M.lanes|=f,x=M.alternate,x!==null&&(x.lanes|=f),vy(M,f,s),M=null}else M=_.child;if(M!==null)M.return=_;else for(M=_;M!==null;){if(M===s){M=null;break}if(_=M.sibling,_!==null){_.return=M.return,M=_;break}M=M.return}_=M}}function Ll(s,l,f,m){s=null;for(var _=l,x=!1;_!==null;){if(!x){if((_.flags&524288)!==0)x=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var M=_.alternate;if(M===null)throw Error(r(387));if(M=M.memoizedProps,M!==null){var U=_.type;ri(_.pendingProps.value,M.value)||(s!==null?s.push(U):s=[U])}}else if(_===xe.current){if(M=_.alternate,M===null)throw Error(r(387));M.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(s!==null?s.push(pf):s=[pf])}_=_.return}s!==null&&yy(l,s,f,m),l.flags|=262144}function Ap(s){for(s=s.firstContext;s!==null;){if(!ri(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Su(s){Cu=s,fo=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function ur(s){return e2(Cu,s)}function Rp(s,l){return Cu===null&&Su(s),e2(s,l)}function e2(s,l){var f=l._currentValue;if(l={context:l,memoizedValue:f,next:null},fo===null){if(s===null)throw Error(r(308));fo=l,s.dependencies={lanes:0,firstContext:l},s.flags|=524288}else fo=fo.next=l;return f}var YP=typeof AbortController<"u"?AbortController:function(){var s=[],l=this.signal={aborted:!1,addEventListener:function(f,m){s.push(m)}};this.abort=function(){l.aborted=!0,s.forEach(function(f){return f()})}},$P=n.unstable_scheduleCallback,QP=n.unstable_NormalPriority,Sn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _y(){return{controller:new YP,data:new Map,refCount:0}}function Uh(s){s.refCount--,s.refCount===0&&$P(QP,function(){s.controller.abort()})}var zh=null,by=0,Bl=0,jl=null;function ZP(s,l){if(zh===null){var f=zh=[];by=0,Bl=E0(),jl={status:"pending",value:void 0,then:function(m){f.push(m)}}}return by++,l.then(t2,t2),l}function t2(){if(--by===0&&zh!==null){jl!==null&&(jl.status="fulfilled");var s=zh;zh=null,Bl=0,jl=null;for(var l=0;l<s.length;l++)(0,s[l])()}}function JP(s,l){var f=[],m={status:"pending",value:null,reason:null,then:function(_){f.push(_)}};return s.then(function(){m.status="fulfilled",m.value=l;for(var _=0;_<f.length;_++)(0,f[_])(l)},function(_){for(m.status="rejected",m.reason=_,_=0;_<f.length;_++)(0,f[_])(void 0)}),m}var n2=q.S;q.S=function(s,l){BT=ln(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&ZP(s,l),n2!==null&&n2(s,l)};var Au=W(null);function xy(){var s=Au.current;return s!==null?s:Wt.pooledCache}function Ip(s,l){l===null?ce(Au,Au.current):ce(Au,l.pool)}function r2(){var s=xy();return s===null?null:{parent:Sn._currentValue,pool:s}}var Ul=Error(r(460)),wy=Error(r(474)),Np=Error(r(542)),Dp={then:function(){}};function i2(s){return s=s.status,s==="fulfilled"||s==="rejected"}function a2(s,l,f){switch(f=s[f],f===void 0?s.push(l):f!==l&&(l.then(Ki,Ki),l=f),l.status){case"fulfilled":return l.value;case"rejected":throw s=l.reason,s2(s),s;default:if(typeof l.status=="string")l.then(Ki,Ki);else{if(s=Wt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=l,s.status="pending",s.then(function(m){if(l.status==="pending"){var _=l;_.status="fulfilled",_.value=m}},function(m){if(l.status==="pending"){var _=l;_.status="rejected",_.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw s=l.reason,s2(s),s}throw Iu=l,Ul}}function Ru(s){try{var l=s._init;return l(s._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(Iu=f,Ul):f}}var Iu=null;function o2(){if(Iu===null)throw Error(r(459));var s=Iu;return Iu=null,s}function s2(s){if(s===Ul||s===Np)throw Error(r(483))}var zl=null,Gh=0;function kp(s){var l=Gh;return Gh+=1,zl===null&&(zl=[]),a2(zl,s,l)}function Hh(s,l){l=l.props.ref,s.ref=l!==void 0?l:null}function Mp(s,l){throw l.$$typeof===g?Error(r(525)):(s=Object.prototype.toString.call(l),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":s)))}function u2(s){function l(te,$){if(s){var ie=te.deletions;ie===null?(te.deletions=[$],te.flags|=16):ie.push($)}}function f(te,$){if(!s)return null;for(;$!==null;)l(te,$),$=$.sibling;return null}function m(te){for(var $=new Map;te!==null;)te.key!==null?$.set(te.key,te):$.set(te.index,te),te=te.sibling;return $}function _(te,$){return te=co(te,$),te.index=0,te.sibling=null,te}function x(te,$,ie){return te.index=ie,s?(ie=te.alternate,ie!==null?(ie=ie.index,ie<$?(te.flags|=67108866,$):ie):(te.flags|=67108866,$)):(te.flags|=1048576,$)}function M(te){return s&&te.alternate===null&&(te.flags|=67108866),te}function U(te,$,ie,ye){return $===null||$.tag!==6?($=cy(ie,te.mode,ye),$.return=te,$):($=_($,ie),$.return=te,$)}function K(te,$,ie,ye){var He=ie.type;return He===w?me(te,$,ie.props.children,ye,ie.key):$!==null&&($.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===N&&Ru(He)===$.type)?($=_($,ie.props),Hh($,ie),$.return=te,$):($=Cp(ie.type,ie.key,ie.props,null,te.mode,ye),Hh($,ie),$.return=te,$)}function ae(te,$,ie,ye){return $===null||$.tag!==4||$.stateNode.containerInfo!==ie.containerInfo||$.stateNode.implementation!==ie.implementation?($=hy(ie,te.mode,ye),$.return=te,$):($=_($,ie.children||[]),$.return=te,$)}function me(te,$,ie,ye,He){return $===null||$.tag!==7?($=Eu(ie,te.mode,ye,He),$.return=te,$):($=_($,ie),$.return=te,$)}function be(te,$,ie){if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return $=cy(""+$,te.mode,ie),$.return=te,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case v:return ie=Cp($.type,$.key,$.props,null,te.mode,ie),Hh(ie,$),ie.return=te,ie;case b:return $=hy($,te.mode,ie),$.return=te,$;case N:return $=Ru($),be(te,$,ie)}if(ne($)||j($))return $=Eu($,te.mode,ie,null),$.return=te,$;if(typeof $.then=="function")return be(te,kp($),ie);if($.$$typeof===I)return be(te,Rp(te,$),ie);Mp(te,$)}return null}function se(te,$,ie,ye){var He=$!==null?$.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return He!==null?null:U(te,$,""+ie,ye);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case v:return ie.key===He?K(te,$,ie,ye):null;case b:return ie.key===He?ae(te,$,ie,ye):null;case N:return ie=Ru(ie),se(te,$,ie,ye)}if(ne(ie)||j(ie))return He!==null?null:me(te,$,ie,ye,null);if(typeof ie.then=="function")return se(te,$,kp(ie),ye);if(ie.$$typeof===I)return se(te,$,Rp(te,ie),ye);Mp(te,ie)}return null}function de(te,$,ie,ye,He){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return te=te.get(ie)||null,U($,te,""+ye,He);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case v:return te=te.get(ye.key===null?ie:ye.key)||null,K($,te,ye,He);case b:return te=te.get(ye.key===null?ie:ye.key)||null,ae($,te,ye,He);case N:return ye=Ru(ye),de(te,$,ie,ye,He)}if(ne(ye)||j(ye))return te=te.get(ie)||null,me($,te,ye,He,null);if(typeof ye.then=="function")return de(te,$,ie,kp(ye),He);if(ye.$$typeof===I)return de(te,$,ie,Rp($,ye),He);Mp($,ye)}return null}function Ve(te,$,ie,ye){for(var He=null,At=null,Be=$,ct=$=0,vt=null;Be!==null&&ct<ie.length;ct++){Be.index>ct?(vt=Be,Be=null):vt=Be.sibling;var Rt=se(te,Be,ie[ct],ye);if(Rt===null){Be===null&&(Be=vt);break}s&&Be&&Rt.alternate===null&&l(te,Be),$=x(Rt,$,ct),At===null?He=Rt:At.sibling=Rt,At=Rt,Be=vt}if(ct===ie.length)return f(te,Be),bt&&ho(te,ct),He;if(Be===null){for(;ct<ie.length;ct++)Be=be(te,ie[ct],ye),Be!==null&&($=x(Be,$,ct),At===null?He=Be:At.sibling=Be,At=Be);return bt&&ho(te,ct),He}for(Be=m(Be);ct<ie.length;ct++)vt=de(Be,te,ct,ie[ct],ye),vt!==null&&(s&&vt.alternate!==null&&Be.delete(vt.key===null?ct:vt.key),$=x(vt,$,ct),At===null?He=vt:At.sibling=vt,At=vt);return s&&Be.forEach(function(Es){return l(te,Es)}),bt&&ho(te,ct),He}function Ke(te,$,ie,ye){if(ie==null)throw Error(r(151));for(var He=null,At=null,Be=$,ct=$=0,vt=null,Rt=ie.next();Be!==null&&!Rt.done;ct++,Rt=ie.next()){Be.index>ct?(vt=Be,Be=null):vt=Be.sibling;var Es=se(te,Be,Rt.value,ye);if(Es===null){Be===null&&(Be=vt);break}s&&Be&&Es.alternate===null&&l(te,Be),$=x(Es,$,ct),At===null?He=Es:At.sibling=Es,At=Es,Be=vt}if(Rt.done)return f(te,Be),bt&&ho(te,ct),He;if(Be===null){for(;!Rt.done;ct++,Rt=ie.next())Rt=be(te,Rt.value,ye),Rt!==null&&($=x(Rt,$,ct),At===null?He=Rt:At.sibling=Rt,At=Rt);return bt&&ho(te,ct),He}for(Be=m(Be);!Rt.done;ct++,Rt=ie.next())Rt=de(Be,te,ct,Rt.value,ye),Rt!==null&&(s&&Rt.alternate!==null&&Be.delete(Rt.key===null?ct:Rt.key),$=x(Rt,$,ct),At===null?He=Rt:At.sibling=Rt,At=Rt);return s&&Be.forEach(function(cF){return l(te,cF)}),bt&&ho(te,ct),He}function Gt(te,$,ie,ye){if(typeof ie=="object"&&ie!==null&&ie.type===w&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case v:e:{for(var He=ie.key;$!==null;){if($.key===He){if(He=ie.type,He===w){if($.tag===7){f(te,$.sibling),ye=_($,ie.props.children),ye.return=te,te=ye;break e}}else if($.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===N&&Ru(He)===$.type){f(te,$.sibling),ye=_($,ie.props),Hh(ye,ie),ye.return=te,te=ye;break e}f(te,$);break}else l(te,$);$=$.sibling}ie.type===w?(ye=Eu(ie.props.children,te.mode,ye,ie.key),ye.return=te,te=ye):(ye=Cp(ie.type,ie.key,ie.props,null,te.mode,ye),Hh(ye,ie),ye.return=te,te=ye)}return M(te);case b:e:{for(He=ie.key;$!==null;){if($.key===He)if($.tag===4&&$.stateNode.containerInfo===ie.containerInfo&&$.stateNode.implementation===ie.implementation){f(te,$.sibling),ye=_($,ie.children||[]),ye.return=te,te=ye;break e}else{f(te,$);break}else l(te,$);$=$.sibling}ye=hy(ie,te.mode,ye),ye.return=te,te=ye}return M(te);case N:return ie=Ru(ie),Gt(te,$,ie,ye)}if(ne(ie))return Ve(te,$,ie,ye);if(j(ie)){if(He=j(ie),typeof He!="function")throw Error(r(150));return ie=He.call(ie),Ke(te,$,ie,ye)}if(typeof ie.then=="function")return Gt(te,$,kp(ie),ye);if(ie.$$typeof===I)return Gt(te,$,Rp(te,ie),ye);Mp(te,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint"?(ie=""+ie,$!==null&&$.tag===6?(f(te,$.sibling),ye=_($,ie),ye.return=te,te=ye):(f(te,$),ye=cy(ie,te.mode,ye),ye.return=te,te=ye),M(te)):f(te,$)}return function(te,$,ie,ye){try{Gh=0;var He=Gt(te,$,ie,ye);return zl=null,He}catch(Be){if(Be===Ul||Be===Np)throw Be;var At=ii(29,Be,null,te.mode);return At.lanes=ye,At.return=te,At}}}var Nu=u2(!0),l2=u2(!1),os=!1;function Ey(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ty(s,l){s=s.updateQueue,l.updateQueue===s&&(l.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function ss(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function us(s,l,f){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Nt&2)!==0){var _=m.pending;return _===null?l.next=l:(l.next=_.next,_.next=l),m.pending=l,l=Tp(s),qE(s,null,f),l}return Ep(s,m,l,f),Tp(s)}function Wh(s,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194048)!==0)){var m=l.lanes;m&=s.pendingLanes,f|=m,l.lanes=f,yh(s,f)}}function Cy(s,l){var f=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var _=null,x=null;if(f=f.firstBaseUpdate,f!==null){do{var M={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};x===null?_=x=M:x=x.next=M,f=f.next}while(f!==null);x===null?_=x=l:x=x.next=l}else _=x=l;f={baseState:m.baseState,firstBaseUpdate:_,lastBaseUpdate:x,shared:m.shared,callbacks:m.callbacks},s.updateQueue=f;return}s=f.lastBaseUpdate,s===null?f.firstBaseUpdate=l:s.next=l,f.lastBaseUpdate=l}var Sy=!1;function qh(){if(Sy){var s=jl;if(s!==null)throw s}}function Kh(s,l,f,m){Sy=!1;var _=s.updateQueue;os=!1;var x=_.firstBaseUpdate,M=_.lastBaseUpdate,U=_.shared.pending;if(U!==null){_.shared.pending=null;var K=U,ae=K.next;K.next=null,M===null?x=ae:M.next=ae,M=K;var me=s.alternate;me!==null&&(me=me.updateQueue,U=me.lastBaseUpdate,U!==M&&(U===null?me.firstBaseUpdate=ae:U.next=ae,me.lastBaseUpdate=K))}if(x!==null){var be=_.baseState;M=0,me=ae=K=null,U=x;do{var se=U.lane&-536870913,de=se!==U.lane;if(de?(gt&se)===se:(m&se)===se){se!==0&&se===Bl&&(Sy=!0),me!==null&&(me=me.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var Ve=s,Ke=U;se=l;var Gt=f;switch(Ke.tag){case 1:if(Ve=Ke.payload,typeof Ve=="function"){be=Ve.call(Gt,be,se);break e}be=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ke.payload,se=typeof Ve=="function"?Ve.call(Gt,be,se):Ve,se==null)break e;be=p({},be,se);break e;case 2:os=!0}}se=U.callback,se!==null&&(s.flags|=64,de&&(s.flags|=8192),de=_.callbacks,de===null?_.callbacks=[se]:de.push(se))}else de={lane:se,tag:U.tag,payload:U.payload,callback:U.callback,next:null},me===null?(ae=me=de,K=be):me=me.next=de,M|=se;if(U=U.next,U===null){if(U=_.shared.pending,U===null)break;de=U,U=de.next,de.next=null,_.lastBaseUpdate=de,_.shared.pending=null}}while(!0);me===null&&(K=be),_.baseState=K,_.firstBaseUpdate=ae,_.lastBaseUpdate=me,x===null&&(_.shared.lanes=0),ds|=M,s.lanes=M,s.memoizedState=be}}function c2(s,l){if(typeof s!="function")throw Error(r(191,s));s.call(l)}function h2(s,l){var f=s.callbacks;if(f!==null)for(s.callbacks=null,s=0;s<f.length;s++)c2(f[s],l)}var Gl=W(null),Op=W(0);function f2(s,l){s=Eo,ce(Op,s),ce(Gl,l),Eo=s|l.baseLanes}function Ay(){ce(Op,Eo),ce(Gl,Gl.current)}function Ry(){Eo=Op.current,Q(Gl),Q(Op)}var ai=W(null),Ni=null;function ls(s){var l=s.alternate;ce(vn,vn.current&1),ce(ai,s),Ni===null&&(l===null||Gl.current!==null||l.memoizedState!==null)&&(Ni=s)}function Iy(s){ce(vn,vn.current),ce(ai,s),Ni===null&&(Ni=s)}function d2(s){s.tag===22?(ce(vn,vn.current),ce(ai,s),Ni===null&&(Ni=s)):cs()}function cs(){ce(vn,vn.current),ce(ai,ai.current)}function oi(s){Q(ai),Ni===s&&(Ni=null),Q(vn)}var vn=W(0);function Pp(s){for(var l=s;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||P0(f)||V0(f)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var mo=0,ut=null,Ut=null,An=null,Vp=!1,Hl=!1,Du=!1,Fp=0,Xh=0,Wl=null,eV=0;function cn(){throw Error(r(321))}function Ny(s,l){if(l===null)return!1;for(var f=0;f<l.length&&f<s.length;f++)if(!ri(s[f],l[f]))return!1;return!0}function Dy(s,l,f,m,_,x){return mo=x,ut=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,q.H=s===null||s.memoizedState===null?$2:qy,Du=!1,x=f(m,_),Du=!1,Hl&&(x=m2(l,f,m,_)),p2(s),x}function p2(s){q.H=Qh;var l=Ut!==null&&Ut.next!==null;if(mo=0,An=Ut=ut=null,Vp=!1,Xh=0,Wl=null,l)throw Error(r(300));s===null||Rn||(s=s.dependencies,s!==null&&Ap(s)&&(Rn=!0))}function m2(s,l,f,m){ut=s;var _=0;do{if(Hl&&(Wl=null),Xh=0,Hl=!1,25<=_)throw Error(r(301));if(_+=1,An=Ut=null,s.updateQueue!=null){var x=s.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}q.H=Q2,x=l(f,m)}while(Hl);return x}function tV(){var s=q.H,l=s.useState()[0];return l=typeof l.then=="function"?Yh(l):l,s=s.useState()[0],(Ut!==null?Ut.memoizedState:null)!==s&&(ut.flags|=1024),l}function ky(){var s=Fp!==0;return Fp=0,s}function My(s,l,f){l.updateQueue=s.updateQueue,l.flags&=-2053,s.lanes&=~f}function Oy(s){if(Vp){for(s=s.memoizedState;s!==null;){var l=s.queue;l!==null&&(l.pending=null),s=s.next}Vp=!1}mo=0,An=Ut=ut=null,Hl=!1,Xh=Fp=0,Wl=null}function Pr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return An===null?ut.memoizedState=An=s:An=An.next=s,An}function yn(){if(Ut===null){var s=ut.alternate;s=s!==null?s.memoizedState:null}else s=Ut.next;var l=An===null?ut.memoizedState:An.next;if(l!==null)An=l,Ut=s;else{if(s===null)throw ut.alternate===null?Error(r(467)):Error(r(310));Ut=s,s={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},An===null?ut.memoizedState=An=s:An=An.next=s}return An}function Lp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yh(s){var l=Xh;return Xh+=1,Wl===null&&(Wl=[]),s=a2(Wl,s,l),l=ut,(An===null?l.memoizedState:An.next)===null&&(l=l.alternate,q.H=l===null||l.memoizedState===null?$2:qy),s}function Bp(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Yh(s);if(s.$$typeof===I)return ur(s)}throw Error(r(438,String(s)))}function Py(s){var l=null,f=ut.updateQueue;if(f!==null&&(l=f.memoCache),l==null){var m=ut.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(_){return _.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),f===null&&(f=Lp(),ut.updateQueue=f),f.memoCache=l,f=l.data[l.index],f===void 0)for(f=l.data[l.index]=Array(s),m=0;m<s;m++)f[m]=P;return l.index++,f}function go(s,l){return typeof l=="function"?l(s):l}function jp(s){var l=yn();return Vy(l,Ut,s)}function Vy(s,l,f){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=f;var _=s.baseQueue,x=m.pending;if(x!==null){if(_!==null){var M=_.next;_.next=x.next,x.next=M}l.baseQueue=_=x,m.pending=null}if(x=s.baseState,_===null)s.memoizedState=x;else{l=_.next;var U=M=null,K=null,ae=l,me=!1;do{var be=ae.lane&-536870913;if(be!==ae.lane?(gt&be)===be:(mo&be)===be){var se=ae.revertLane;if(se===0)K!==null&&(K=K.next={lane:0,revertLane:0,gesture:null,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null}),be===Bl&&(me=!0);else if((mo&se)===se){ae=ae.next,se===Bl&&(me=!0);continue}else be={lane:0,revertLane:ae.revertLane,gesture:null,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},K===null?(U=K=be,M=x):K=K.next=be,ut.lanes|=se,ds|=se;be=ae.action,Du&&f(x,be),x=ae.hasEagerState?ae.eagerState:f(x,be)}else se={lane:be,revertLane:ae.revertLane,gesture:ae.gesture,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},K===null?(U=K=se,M=x):K=K.next=se,ut.lanes|=be,ds|=be;ae=ae.next}while(ae!==null&&ae!==l);if(K===null?M=x:K.next=U,!ri(x,s.memoizedState)&&(Rn=!0,me&&(f=jl,f!==null)))throw f;s.memoizedState=x,s.baseState=M,s.baseQueue=K,m.lastRenderedState=x}return _===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function Fy(s){var l=yn(),f=l.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=s;var m=f.dispatch,_=f.pending,x=l.memoizedState;if(_!==null){f.pending=null;var M=_=_.next;do x=s(x,M.action),M=M.next;while(M!==_);ri(x,l.memoizedState)||(Rn=!0),l.memoizedState=x,l.baseQueue===null&&(l.baseState=x),f.lastRenderedState=x}return[x,m]}function g2(s,l,f){var m=ut,_=yn(),x=bt;if(x){if(f===void 0)throw Error(r(407));f=f()}else f=l();var M=!ri((Ut||_).memoizedState,f);if(M&&(_.memoizedState=f,Rn=!0),_=_.queue,jy(_2.bind(null,m,_,s),[s]),_.getSnapshot!==l||M||An!==null&&An.memoizedState.tag&1){if(m.flags|=2048,ql(9,{destroy:void 0},y2.bind(null,m,_,f,l),null),Wt===null)throw Error(r(349));x||(mo&127)!==0||v2(m,l,f)}return f}function v2(s,l,f){s.flags|=16384,s={getSnapshot:l,value:f},l=ut.updateQueue,l===null?(l=Lp(),ut.updateQueue=l,l.stores=[s]):(f=l.stores,f===null?l.stores=[s]:f.push(s))}function y2(s,l,f,m){l.value=f,l.getSnapshot=m,b2(l)&&x2(s)}function _2(s,l,f){return f(function(){b2(l)&&x2(s)})}function b2(s){var l=s.getSnapshot;s=s.value;try{var f=l();return!ri(s,f)}catch{return!0}}function x2(s){var l=wu(s,2);l!==null&&Wr(l,s,2)}function Ly(s){var l=Pr();if(typeof s=="function"){var f=s;if(s=f(),Du){yr(!0);try{f()}finally{yr(!1)}}}return l.memoizedState=l.baseState=s,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:s},l}function w2(s,l,f,m){return s.baseState=f,Vy(s,Ut,typeof m=="function"?m:go)}function nV(s,l,f,m,_){if(Gp(s))throw Error(r(485));if(s=l.action,s!==null){var x={payload:_,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){x.listeners.push(M)}};q.T!==null?f(!0):x.isTransition=!1,m(x),f=l.pending,f===null?(x.next=l.pending=x,E2(l,x)):(x.next=f.next,l.pending=f.next=x)}}function E2(s,l){var f=l.action,m=l.payload,_=s.state;if(l.isTransition){var x=q.T,M={};q.T=M;try{var U=f(_,m),K=q.S;K!==null&&K(M,U),T2(s,l,U)}catch(ae){By(s,l,ae)}finally{x!==null&&M.types!==null&&(x.types=M.types),q.T=x}}else try{x=f(_,m),T2(s,l,x)}catch(ae){By(s,l,ae)}}function T2(s,l,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){C2(s,l,m)},function(m){return By(s,l,m)}):C2(s,l,f)}function C2(s,l,f){l.status="fulfilled",l.value=f,S2(l),s.state=f,l=s.pending,l!==null&&(f=l.next,f===l?s.pending=null:(f=f.next,l.next=f,E2(s,f)))}function By(s,l,f){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=f,S2(l),l=l.next;while(l!==m)}s.action=null}function S2(s){s=s.listeners;for(var l=0;l<s.length;l++)(0,s[l])()}function A2(s,l){return l}function R2(s,l){if(bt){var f=Wt.formState;if(f!==null){e:{var m=ut;if(bt){if(Xt){t:{for(var _=Xt,x=Ii;_.nodeType!==8;){if(!x){_=null;break t}if(_=Di(_.nextSibling),_===null){_=null;break t}}x=_.data,_=x==="F!"||x==="F"?_:null}if(_){Xt=Di(_.nextSibling),m=_.data==="F!";break e}}is(m)}m=!1}m&&(l=f[0])}}return f=Pr(),f.memoizedState=f.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:A2,lastRenderedState:l},f.queue=m,f=K2.bind(null,ut,m),m.dispatch=f,m=Ly(!1),x=Wy.bind(null,ut,!1,m.queue),m=Pr(),_={state:l,dispatch:null,action:s,pending:null},m.queue=_,f=nV.bind(null,ut,_,x,f),_.dispatch=f,m.memoizedState=s,[l,f,!1]}function I2(s){var l=yn();return N2(l,Ut,s)}function N2(s,l,f){if(l=Vy(s,l,A2)[0],s=jp(go)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=Yh(l)}catch(M){throw M===Ul?Np:M}else m=l;l=yn();var _=l.queue,x=_.dispatch;return f!==l.memoizedState&&(ut.flags|=2048,ql(9,{destroy:void 0},rV.bind(null,_,f),null)),[m,x,s]}function rV(s,l){s.action=l}function D2(s){var l=yn(),f=Ut;if(f!==null)return N2(l,f,s);yn(),l=l.memoizedState,f=yn();var m=f.queue.dispatch;return f.memoizedState=s,[l,m,!1]}function ql(s,l,f,m){return s={tag:s,create:f,deps:m,inst:l,next:null},l=ut.updateQueue,l===null&&(l=Lp(),ut.updateQueue=l),f=l.lastEffect,f===null?l.lastEffect=s.next=s:(m=f.next,f.next=s,s.next=m,l.lastEffect=s),s}function k2(){return yn().memoizedState}function Up(s,l,f,m){var _=Pr();ut.flags|=s,_.memoizedState=ql(1|l,{destroy:void 0},f,m===void 0?null:m)}function zp(s,l,f,m){var _=yn();m=m===void 0?null:m;var x=_.memoizedState.inst;Ut!==null&&m!==null&&Ny(m,Ut.memoizedState.deps)?_.memoizedState=ql(l,x,f,m):(ut.flags|=s,_.memoizedState=ql(1|l,x,f,m))}function M2(s,l){Up(8390656,8,s,l)}function jy(s,l){zp(2048,8,s,l)}function iV(s){ut.flags|=4;var l=ut.updateQueue;if(l===null)l=Lp(),ut.updateQueue=l,l.events=[s];else{var f=l.events;f===null?l.events=[s]:f.push(s)}}function O2(s){var l=yn().memoizedState;return iV({ref:l,nextImpl:s}),function(){if((Nt&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}function P2(s,l){return zp(4,2,s,l)}function V2(s,l){return zp(4,4,s,l)}function F2(s,l){if(typeof l=="function"){s=s();var f=l(s);return function(){typeof f=="function"?f():l(null)}}if(l!=null)return s=s(),l.current=s,function(){l.current=null}}function L2(s,l,f){f=f!=null?f.concat([s]):null,zp(4,4,F2.bind(null,l,s),f)}function Uy(){}function B2(s,l){var f=yn();l=l===void 0?null:l;var m=f.memoizedState;return l!==null&&Ny(l,m[1])?m[0]:(f.memoizedState=[s,l],s)}function j2(s,l){var f=yn();l=l===void 0?null:l;var m=f.memoizedState;if(l!==null&&Ny(l,m[1]))return m[0];if(m=s(),Du){yr(!0);try{s()}finally{yr(!1)}}return f.memoizedState=[m,l],m}function zy(s,l,f){return f===void 0||(mo&1073741824)!==0&&(gt&261930)===0?s.memoizedState=l:(s.memoizedState=f,s=UT(),ut.lanes|=s,ds|=s,f)}function U2(s,l,f,m){return ri(f,l)?f:Gl.current!==null?(s=zy(s,f,m),ri(s,l)||(Rn=!0),s):(mo&42)===0||(mo&1073741824)!==0&&(gt&261930)===0?(Rn=!0,s.memoizedState=f):(s=UT(),ut.lanes|=s,ds|=s,l)}function z2(s,l,f,m,_){var x=Y.p;Y.p=x!==0&&8>x?x:8;var M=q.T,U={};q.T=U,Wy(s,!1,l,f);try{var K=_(),ae=q.S;if(ae!==null&&ae(U,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var me=JP(K,m);$h(s,l,me,li(s))}else $h(s,l,m,li(s))}catch(be){$h(s,l,{then:function(){},status:"rejected",reason:be},li())}finally{Y.p=x,M!==null&&U.types!==null&&(M.types=U.types),q.T=M}}function aV(){}function Gy(s,l,f,m){if(s.tag!==5)throw Error(r(476));var _=G2(s).queue;z2(s,_,l,ee,f===null?aV:function(){return H2(s),f(m)})}function G2(s){var l=s.memoizedState;if(l!==null)return l;l={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:ee},next:null};var f={};return l.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:f},next:null},s.memoizedState=l,s=s.alternate,s!==null&&(s.memoizedState=l),l}function H2(s){var l=G2(s);l.next===null&&(l=s.alternate.memoizedState),$h(s,l.next.queue,{},li())}function Hy(){return ur(pf)}function W2(){return yn().memoizedState}function q2(){return yn().memoizedState}function oV(s){for(var l=s.return;l!==null;){switch(l.tag){case 24:case 3:var f=li();s=ss(f);var m=us(l,s,f);m!==null&&(Wr(m,l,f),Wh(m,l,f)),l={cache:_y()},s.payload=l;return}l=l.return}}function sV(s,l,f){var m=li();f={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Gp(s)?X2(l,f):(f=uy(s,l,f,m),f!==null&&(Wr(f,s,m),Y2(f,l,m)))}function K2(s,l,f){var m=li();$h(s,l,f,m)}function $h(s,l,f,m){var _={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(Gp(s))X2(l,_);else{var x=s.alternate;if(s.lanes===0&&(x===null||x.lanes===0)&&(x=l.lastRenderedReducer,x!==null))try{var M=l.lastRenderedState,U=x(M,f);if(_.hasEagerState=!0,_.eagerState=U,ri(U,M))return Ep(s,l,_,0),Wt===null&&wp(),!1}catch{}if(f=uy(s,l,_,m),f!==null)return Wr(f,s,m),Y2(f,l,m),!0}return!1}function Wy(s,l,f,m){if(m={lane:2,revertLane:E0(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Gp(s)){if(l)throw Error(r(479))}else l=uy(s,f,m,2),l!==null&&Wr(l,s,2)}function Gp(s){var l=s.alternate;return s===ut||l!==null&&l===ut}function X2(s,l){Hl=Vp=!0;var f=s.pending;f===null?l.next=l:(l.next=f.next,f.next=l),s.pending=l}function Y2(s,l,f){if((f&4194048)!==0){var m=l.lanes;m&=s.pendingLanes,f|=m,l.lanes=f,yh(s,f)}}var Qh={readContext:ur,use:Bp,useCallback:cn,useContext:cn,useEffect:cn,useImperativeHandle:cn,useLayoutEffect:cn,useInsertionEffect:cn,useMemo:cn,useReducer:cn,useRef:cn,useState:cn,useDebugValue:cn,useDeferredValue:cn,useTransition:cn,useSyncExternalStore:cn,useId:cn,useHostTransitionStatus:cn,useFormState:cn,useActionState:cn,useOptimistic:cn,useMemoCache:cn,useCacheRefresh:cn};Qh.useEffectEvent=cn;var $2={readContext:ur,use:Bp,useCallback:function(s,l){return Pr().memoizedState=[s,l===void 0?null:l],s},useContext:ur,useEffect:M2,useImperativeHandle:function(s,l,f){f=f!=null?f.concat([s]):null,Up(4194308,4,F2.bind(null,l,s),f)},useLayoutEffect:function(s,l){return Up(4194308,4,s,l)},useInsertionEffect:function(s,l){Up(4,2,s,l)},useMemo:function(s,l){var f=Pr();l=l===void 0?null:l;var m=s();if(Du){yr(!0);try{s()}finally{yr(!1)}}return f.memoizedState=[m,l],m},useReducer:function(s,l,f){var m=Pr();if(f!==void 0){var _=f(l);if(Du){yr(!0);try{f(l)}finally{yr(!1)}}}else _=l;return m.memoizedState=m.baseState=_,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:_},m.queue=s,s=s.dispatch=sV.bind(null,ut,s),[m.memoizedState,s]},useRef:function(s){var l=Pr();return s={current:s},l.memoizedState=s},useState:function(s){s=Ly(s);var l=s.queue,f=K2.bind(null,ut,l);return l.dispatch=f,[s.memoizedState,f]},useDebugValue:Uy,useDeferredValue:function(s,l){var f=Pr();return zy(f,s,l)},useTransition:function(){var s=Ly(!1);return s=z2.bind(null,ut,s.queue,!0,!1),Pr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,l,f){var m=ut,_=Pr();if(bt){if(f===void 0)throw Error(r(407));f=f()}else{if(f=l(),Wt===null)throw Error(r(349));(gt&127)!==0||v2(m,l,f)}_.memoizedState=f;var x={value:f,getSnapshot:l};return _.queue=x,M2(_2.bind(null,m,x,s),[s]),m.flags|=2048,ql(9,{destroy:void 0},y2.bind(null,m,x,f,l),null),f},useId:function(){var s=Pr(),l=Wt.identifierPrefix;if(bt){var f=ka,m=Da;f=(m&~(1<<32-mn(m)-1)).toString(32)+f,l="_"+l+"R_"+f,f=Fp++,0<f&&(l+="H"+f.toString(32)),l+="_"}else f=eV++,l="_"+l+"r_"+f.toString(32)+"_";return s.memoizedState=l},useHostTransitionStatus:Hy,useFormState:R2,useActionState:R2,useOptimistic:function(s){var l=Pr();l.memoizedState=l.baseState=s;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=f,l=Wy.bind(null,ut,!0,f),f.dispatch=l,[s,l]},useMemoCache:Py,useCacheRefresh:function(){return Pr().memoizedState=oV.bind(null,ut)},useEffectEvent:function(s){var l=Pr(),f={impl:s};return l.memoizedState=f,function(){if((Nt&2)!==0)throw Error(r(440));return f.impl.apply(void 0,arguments)}}},qy={readContext:ur,use:Bp,useCallback:B2,useContext:ur,useEffect:jy,useImperativeHandle:L2,useInsertionEffect:P2,useLayoutEffect:V2,useMemo:j2,useReducer:jp,useRef:k2,useState:function(){return jp(go)},useDebugValue:Uy,useDeferredValue:function(s,l){var f=yn();return U2(f,Ut.memoizedState,s,l)},useTransition:function(){var s=jp(go)[0],l=yn().memoizedState;return[typeof s=="boolean"?s:Yh(s),l]},useSyncExternalStore:g2,useId:W2,useHostTransitionStatus:Hy,useFormState:I2,useActionState:I2,useOptimistic:function(s,l){var f=yn();return w2(f,Ut,s,l)},useMemoCache:Py,useCacheRefresh:q2};qy.useEffectEvent=O2;var Q2={readContext:ur,use:Bp,useCallback:B2,useContext:ur,useEffect:jy,useImperativeHandle:L2,useInsertionEffect:P2,useLayoutEffect:V2,useMemo:j2,useReducer:Fy,useRef:k2,useState:function(){return Fy(go)},useDebugValue:Uy,useDeferredValue:function(s,l){var f=yn();return Ut===null?zy(f,s,l):U2(f,Ut.memoizedState,s,l)},useTransition:function(){var s=Fy(go)[0],l=yn().memoizedState;return[typeof s=="boolean"?s:Yh(s),l]},useSyncExternalStore:g2,useId:W2,useHostTransitionStatus:Hy,useFormState:D2,useActionState:D2,useOptimistic:function(s,l){var f=yn();return Ut!==null?w2(f,Ut,s,l):(f.baseState=s,[s,f.queue.dispatch])},useMemoCache:Py,useCacheRefresh:q2};Q2.useEffectEvent=O2;function Ky(s,l,f,m){l=s.memoizedState,f=f(m,l),f=f==null?l:p({},l,f),s.memoizedState=f,s.lanes===0&&(s.updateQueue.baseState=f)}var Xy={enqueueSetState:function(s,l,f){s=s._reactInternals;var m=li(),_=ss(m);_.payload=l,f!=null&&(_.callback=f),l=us(s,_,m),l!==null&&(Wr(l,s,m),Wh(l,s,m))},enqueueReplaceState:function(s,l,f){s=s._reactInternals;var m=li(),_=ss(m);_.tag=1,_.payload=l,f!=null&&(_.callback=f),l=us(s,_,m),l!==null&&(Wr(l,s,m),Wh(l,s,m))},enqueueForceUpdate:function(s,l){s=s._reactInternals;var f=li(),m=ss(f);m.tag=2,l!=null&&(m.callback=l),l=us(s,m,f),l!==null&&(Wr(l,s,f),Wh(l,s,f))}};function Z2(s,l,f,m,_,x,M){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,x,M):l.prototype&&l.prototype.isPureReactComponent?!Fh(f,m)||!Fh(_,x):!0}function J2(s,l,f,m){s=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,m),l.state!==s&&Xy.enqueueReplaceState(l,l.state,null)}function ku(s,l){var f=l;if("ref"in l){f={};for(var m in l)m!=="ref"&&(f[m]=l[m])}if(s=s.defaultProps){f===l&&(f=p({},f));for(var _ in s)f[_]===void 0&&(f[_]=s[_])}return f}function eT(s){xp(s)}function tT(s){console.error(s)}function nT(s){xp(s)}function Hp(s,l){try{var f=s.onUncaughtError;f(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function rT(s,l,f){try{var m=s.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Yy(s,l,f){return f=ss(f),f.tag=3,f.payload={element:null},f.callback=function(){Hp(s,l)},f}function iT(s){return s=ss(s),s.tag=3,s}function aT(s,l,f,m){var _=f.type.getDerivedStateFromError;if(typeof _=="function"){var x=m.value;s.payload=function(){return _(x)},s.callback=function(){rT(l,f,m)}}var M=f.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(s.callback=function(){rT(l,f,m),typeof _!="function"&&(ps===null?ps=new Set([this]):ps.add(this));var U=m.stack;this.componentDidCatch(m.value,{componentStack:U!==null?U:""})})}function uV(s,l,f,m,_){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=f.alternate,l!==null&&Ll(l,f,_,!0),f=ai.current,f!==null){switch(f.tag){case 31:case 13:return Ni===null?nm():f.alternate===null&&hn===0&&(hn=3),f.flags&=-257,f.flags|=65536,f.lanes=_,m===Dp?f.flags|=16384:(l=f.updateQueue,l===null?f.updateQueue=new Set([m]):l.add(m),b0(s,m,_)),!1;case 22:return f.flags|=65536,m===Dp?f.flags|=16384:(l=f.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=l):(f=l.retryQueue,f===null?l.retryQueue=new Set([m]):f.add(m)),b0(s,m,_)),!1}throw Error(r(435,f.tag))}return b0(s,m,_),nm(),!1}if(bt)return l=ai.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=_,m!==py&&(s=Error(r(422),{cause:m}),jh(Si(s,f)))):(m!==py&&(l=Error(r(423),{cause:m}),jh(Si(l,f))),s=s.current.alternate,s.flags|=65536,_&=-_,s.lanes|=_,m=Si(m,f),_=Yy(s.stateNode,m,_),Cy(s,_),hn!==4&&(hn=2)),!1;var x=Error(r(520),{cause:m});if(x=Si(x,f),of===null?of=[x]:of.push(x),hn!==4&&(hn=2),l===null)return!0;m=Si(m,f),f=l;do{switch(f.tag){case 3:return f.flags|=65536,s=_&-_,f.lanes|=s,s=Yy(f.stateNode,m,s),Cy(f,s),!1;case 1:if(l=f.type,x=f.stateNode,(f.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(ps===null||!ps.has(x))))return f.flags|=65536,_&=-_,f.lanes|=_,_=iT(_),aT(_,s,f,m),Cy(f,_),!1}f=f.return}while(f!==null);return!1}var $y=Error(r(461)),Rn=!1;function lr(s,l,f,m){l.child=s===null?l2(l,null,f,m):Nu(l,s.child,f,m)}function oT(s,l,f,m,_){f=f.render;var x=l.ref;if("ref"in m){var M={};for(var U in m)U!=="ref"&&(M[U]=m[U])}else M=m;return Su(l),m=Dy(s,l,f,M,x,_),U=ky(),s!==null&&!Rn?(My(s,l,_),vo(s,l,_)):(bt&&U&&fy(l),l.flags|=1,lr(s,l,m,_),l.child)}function sT(s,l,f,m,_){if(s===null){var x=f.type;return typeof x=="function"&&!ly(x)&&x.defaultProps===void 0&&f.compare===null?(l.tag=15,l.type=x,uT(s,l,x,m,_)):(s=Cp(f.type,null,m,l,l.mode,_),s.ref=l.ref,s.return=l,l.child=s)}if(x=s.child,!i0(s,_)){var M=x.memoizedProps;if(f=f.compare,f=f!==null?f:Fh,f(M,m)&&s.ref===l.ref)return vo(s,l,_)}return l.flags|=1,s=co(x,m),s.ref=l.ref,s.return=l,l.child=s}function uT(s,l,f,m,_){if(s!==null){var x=s.memoizedProps;if(Fh(x,m)&&s.ref===l.ref)if(Rn=!1,l.pendingProps=m=x,i0(s,_))(s.flags&131072)!==0&&(Rn=!0);else return l.lanes=s.lanes,vo(s,l,_)}return Qy(s,l,f,m,_)}function lT(s,l,f,m){var _=m.children,x=s!==null?s.memoizedState:null;if(s===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(x=x!==null?x.baseLanes|f:f,s!==null){for(m=l.child=s.child,_=0;m!==null;)_=_|m.lanes|m.childLanes,m=m.sibling;m=_&~x}else m=0,l.child=null;return cT(s,l,x,f,m)}if((f&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ip(l,x!==null?x.cachePool:null),x!==null?f2(l,x):Ay(),d2(l);else return m=l.lanes=536870912,cT(s,l,x!==null?x.baseLanes|f:f,f,m)}else x!==null?(Ip(l,x.cachePool),f2(l,x),cs(),l.memoizedState=null):(s!==null&&Ip(l,null),Ay(),cs());return lr(s,l,_,f),l.child}function Zh(s,l){return s!==null&&s.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function cT(s,l,f,m,_){var x=xy();return x=x===null?null:{parent:Sn._currentValue,pool:x},l.memoizedState={baseLanes:f,cachePool:x},s!==null&&Ip(l,null),Ay(),d2(l),s!==null&&Ll(s,l,m,!0),l.childLanes=_,null}function Wp(s,l){return l=Kp({mode:l.mode,children:l.children},s.mode),l.ref=s.ref,s.child=l,l.return=s,l}function hT(s,l,f){return Nu(l,s.child,null,f),s=Wp(l,l.pendingProps),s.flags|=2,oi(l),l.memoizedState=null,s}function lV(s,l,f){var m=l.pendingProps,_=(l.flags&128)!==0;if(l.flags&=-129,s===null){if(bt){if(m.mode==="hidden")return s=Wp(l,m),l.lanes=536870912,Zh(null,s);if(Iy(l),(s=Xt)?(s=EC(s,Ii),s=s!==null&&s.data==="&"?s:null,s!==null&&(l.memoizedState={dehydrated:s,treeContext:ns!==null?{id:Da,overflow:ka}:null,retryLane:536870912,hydrationErrors:null},f=XE(s),f.return=l,l.child=f,sr=l,Xt=null)):s=null,s===null)throw is(l);return l.lanes=536870912,null}return Wp(l,m)}var x=s.memoizedState;if(x!==null){var M=x.dehydrated;if(Iy(l),_)if(l.flags&256)l.flags&=-257,l=hT(s,l,f);else if(l.memoizedState!==null)l.child=s.child,l.flags|=128,l=null;else throw Error(r(558));else if(Rn||Ll(s,l,f,!1),_=(f&s.childLanes)!==0,Rn||_){if(m=Wt,m!==null&&(M=_h(m,f),M!==0&&M!==x.retryLane))throw x.retryLane=M,wu(s,M),Wr(m,s,M),$y;nm(),l=hT(s,l,f)}else s=x.treeContext,Xt=Di(M.nextSibling),sr=l,bt=!0,rs=null,Ii=!1,s!==null&&QE(l,s),l=Wp(l,m),l.flags|=4096;return l}return s=co(s.child,{mode:m.mode,children:m.children}),s.ref=l.ref,l.child=s,s.return=l,s}function qp(s,l){var f=l.ref;if(f===null)s!==null&&s.ref!==null&&(l.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(s===null||s.ref!==f)&&(l.flags|=4194816)}}function Qy(s,l,f,m,_){return Su(l),f=Dy(s,l,f,m,void 0,_),m=ky(),s!==null&&!Rn?(My(s,l,_),vo(s,l,_)):(bt&&m&&fy(l),l.flags|=1,lr(s,l,f,_),l.child)}function fT(s,l,f,m,_,x){return Su(l),l.updateQueue=null,f=m2(l,m,f,_),p2(s),m=ky(),s!==null&&!Rn?(My(s,l,x),vo(s,l,x)):(bt&&m&&fy(l),l.flags|=1,lr(s,l,f,x),l.child)}function dT(s,l,f,m,_){if(Su(l),l.stateNode===null){var x=Ol,M=f.contextType;typeof M=="object"&&M!==null&&(x=ur(M)),x=new f(m,x),l.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Xy,l.stateNode=x,x._reactInternals=l,x=l.stateNode,x.props=m,x.state=l.memoizedState,x.refs={},Ey(l),M=f.contextType,x.context=typeof M=="object"&&M!==null?ur(M):Ol,x.state=l.memoizedState,M=f.getDerivedStateFromProps,typeof M=="function"&&(Ky(l,f,M,m),x.state=l.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(M=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),M!==x.state&&Xy.enqueueReplaceState(x,x.state,null),Kh(l,m,x,_),qh(),x.state=l.memoizedState),typeof x.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(s===null){x=l.stateNode;var U=l.memoizedProps,K=ku(f,U);x.props=K;var ae=x.context,me=f.contextType;M=Ol,typeof me=="object"&&me!==null&&(M=ur(me));var be=f.getDerivedStateFromProps;me=typeof be=="function"||typeof x.getSnapshotBeforeUpdate=="function",U=l.pendingProps!==U,me||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(U||ae!==M)&&J2(l,x,m,M),os=!1;var se=l.memoizedState;x.state=se,Kh(l,m,x,_),qh(),ae=l.memoizedState,U||se!==ae||os?(typeof be=="function"&&(Ky(l,f,be,m),ae=l.memoizedState),(K=os||Z2(l,f,K,m,se,ae,M))?(me||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(l.flags|=4194308)):(typeof x.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=ae),x.props=m,x.state=ae,x.context=M,m=K):(typeof x.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{x=l.stateNode,Ty(s,l),M=l.memoizedProps,me=ku(f,M),x.props=me,be=l.pendingProps,se=x.context,ae=f.contextType,K=Ol,typeof ae=="object"&&ae!==null&&(K=ur(ae)),U=f.getDerivedStateFromProps,(ae=typeof U=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(M!==be||se!==K)&&J2(l,x,m,K),os=!1,se=l.memoizedState,x.state=se,Kh(l,m,x,_),qh();var de=l.memoizedState;M!==be||se!==de||os||s!==null&&s.dependencies!==null&&Ap(s.dependencies)?(typeof U=="function"&&(Ky(l,f,U,m),de=l.memoizedState),(me=os||Z2(l,f,me,m,se,de,K)||s!==null&&s.dependencies!==null&&Ap(s.dependencies))?(ae||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(m,de,K),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(m,de,K)),typeof x.componentDidUpdate=="function"&&(l.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof x.componentDidUpdate!="function"||M===s.memoizedProps&&se===s.memoizedState||(l.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||M===s.memoizedProps&&se===s.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=de),x.props=m,x.state=de,x.context=K,m=me):(typeof x.componentDidUpdate!="function"||M===s.memoizedProps&&se===s.memoizedState||(l.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||M===s.memoizedProps&&se===s.memoizedState||(l.flags|=1024),m=!1)}return x=m,qp(s,l),m=(l.flags&128)!==0,x||m?(x=l.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:x.render(),l.flags|=1,s!==null&&m?(l.child=Nu(l,s.child,null,_),l.child=Nu(l,null,f,_)):lr(s,l,f,_),l.memoizedState=x.state,s=l.child):s=vo(s,l,_),s}function pT(s,l,f,m){return Tu(),l.flags|=256,lr(s,l,f,m),l.child}var Zy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Jy(s){return{baseLanes:s,cachePool:r2()}}function e0(s,l,f){return s=s!==null?s.childLanes&~f:0,l&&(s|=ui),s}function mT(s,l,f){var m=l.pendingProps,_=!1,x=(l.flags&128)!==0,M;if((M=x)||(M=s!==null&&s.memoizedState===null?!1:(vn.current&2)!==0),M&&(_=!0,l.flags&=-129),M=(l.flags&32)!==0,l.flags&=-33,s===null){if(bt){if(_?ls(l):cs(),(s=Xt)?(s=EC(s,Ii),s=s!==null&&s.data!=="&"?s:null,s!==null&&(l.memoizedState={dehydrated:s,treeContext:ns!==null?{id:Da,overflow:ka}:null,retryLane:536870912,hydrationErrors:null},f=XE(s),f.return=l,l.child=f,sr=l,Xt=null)):s=null,s===null)throw is(l);return V0(s)?l.lanes=32:l.lanes=536870912,null}var U=m.children;return m=m.fallback,_?(cs(),_=l.mode,U=Kp({mode:"hidden",children:U},_),m=Eu(m,_,f,null),U.return=l,m.return=l,U.sibling=m,l.child=U,m=l.child,m.memoizedState=Jy(f),m.childLanes=e0(s,M,f),l.memoizedState=Zy,Zh(null,m)):(ls(l),t0(l,U))}var K=s.memoizedState;if(K!==null&&(U=K.dehydrated,U!==null)){if(x)l.flags&256?(ls(l),l.flags&=-257,l=n0(s,l,f)):l.memoizedState!==null?(cs(),l.child=s.child,l.flags|=128,l=null):(cs(),U=m.fallback,_=l.mode,m=Kp({mode:"visible",children:m.children},_),U=Eu(U,_,f,null),U.flags|=2,m.return=l,U.return=l,m.sibling=U,l.child=m,Nu(l,s.child,null,f),m=l.child,m.memoizedState=Jy(f),m.childLanes=e0(s,M,f),l.memoizedState=Zy,l=Zh(null,m));else if(ls(l),V0(U)){if(M=U.nextSibling&&U.nextSibling.dataset,M)var ae=M.dgst;M=ae,m=Error(r(419)),m.stack="",m.digest=M,jh({value:m,source:null,stack:null}),l=n0(s,l,f)}else if(Rn||Ll(s,l,f,!1),M=(f&s.childLanes)!==0,Rn||M){if(M=Wt,M!==null&&(m=_h(M,f),m!==0&&m!==K.retryLane))throw K.retryLane=m,wu(s,m),Wr(M,s,m),$y;P0(U)||nm(),l=n0(s,l,f)}else P0(U)?(l.flags|=192,l.child=s.child,l=null):(s=K.treeContext,Xt=Di(U.nextSibling),sr=l,bt=!0,rs=null,Ii=!1,s!==null&&QE(l,s),l=t0(l,m.children),l.flags|=4096);return l}return _?(cs(),U=m.fallback,_=l.mode,K=s.child,ae=K.sibling,m=co(K,{mode:"hidden",children:m.children}),m.subtreeFlags=K.subtreeFlags&65011712,ae!==null?U=co(ae,U):(U=Eu(U,_,f,null),U.flags|=2),U.return=l,m.return=l,m.sibling=U,l.child=m,Zh(null,m),m=l.child,U=s.child.memoizedState,U===null?U=Jy(f):(_=U.cachePool,_!==null?(K=Sn._currentValue,_=_.parent!==K?{parent:K,pool:K}:_):_=r2(),U={baseLanes:U.baseLanes|f,cachePool:_}),m.memoizedState=U,m.childLanes=e0(s,M,f),l.memoizedState=Zy,Zh(s.child,m)):(ls(l),f=s.child,s=f.sibling,f=co(f,{mode:"visible",children:m.children}),f.return=l,f.sibling=null,s!==null&&(M=l.deletions,M===null?(l.deletions=[s],l.flags|=16):M.push(s)),l.child=f,l.memoizedState=null,f)}function t0(s,l){return l=Kp({mode:"visible",children:l},s.mode),l.return=s,s.child=l}function Kp(s,l){return s=ii(22,s,null,l),s.lanes=0,s}function n0(s,l,f){return Nu(l,s.child,null,f),s=t0(l,l.pendingProps.children),s.flags|=2,l.memoizedState=null,s}function gT(s,l,f){s.lanes|=l;var m=s.alternate;m!==null&&(m.lanes|=l),vy(s.return,l,f)}function r0(s,l,f,m,_,x){var M=s.memoizedState;M===null?s.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:_,treeForkCount:x}:(M.isBackwards=l,M.rendering=null,M.renderingStartTime=0,M.last=m,M.tail=f,M.tailMode=_,M.treeForkCount=x)}function vT(s,l,f){var m=l.pendingProps,_=m.revealOrder,x=m.tail;m=m.children;var M=vn.current,U=(M&2)!==0;if(U?(M=M&1|2,l.flags|=128):M&=1,ce(vn,M),lr(s,l,m,f),m=bt?Bh:0,!U&&s!==null&&(s.flags&128)!==0)e:for(s=l.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&gT(s,f,l);else if(s.tag===19)gT(s,f,l);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===l)break e;for(;s.sibling===null;){if(s.return===null||s.return===l)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(_){case"forwards":for(f=l.child,_=null;f!==null;)s=f.alternate,s!==null&&Pp(s)===null&&(_=f),f=f.sibling;f=_,f===null?(_=l.child,l.child=null):(_=f.sibling,f.sibling=null),r0(l,!1,_,f,x,m);break;case"backwards":case"unstable_legacy-backwards":for(f=null,_=l.child,l.child=null;_!==null;){if(s=_.alternate,s!==null&&Pp(s)===null){l.child=_;break}s=_.sibling,_.sibling=f,f=_,_=s}r0(l,!0,f,null,x,m);break;case"together":r0(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function vo(s,l,f){if(s!==null&&(l.dependencies=s.dependencies),ds|=l.lanes,(f&l.childLanes)===0)if(s!==null){if(Ll(s,l,f,!1),(f&l.childLanes)===0)return null}else return null;if(s!==null&&l.child!==s.child)throw Error(r(153));if(l.child!==null){for(s=l.child,f=co(s,s.pendingProps),l.child=f,f.return=l;s.sibling!==null;)s=s.sibling,f=f.sibling=co(s,s.pendingProps),f.return=l;f.sibling=null}return l.child}function i0(s,l){return(s.lanes&l)!==0?!0:(s=s.dependencies,!!(s!==null&&Ap(s)))}function cV(s,l,f){switch(l.tag){case 3:ke(l,l.stateNode.containerInfo),as(l,Sn,s.memoizedState.cache),Tu();break;case 27:case 5:qe(l);break;case 4:ke(l,l.stateNode.containerInfo);break;case 10:as(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Iy(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(ls(l),l.flags|=128,null):(f&l.child.childLanes)!==0?mT(s,l,f):(ls(l),s=vo(s,l,f),s!==null?s.sibling:null);ls(l);break;case 19:var _=(s.flags&128)!==0;if(m=(f&l.childLanes)!==0,m||(Ll(s,l,f,!1),m=(f&l.childLanes)!==0),_){if(m)return vT(s,l,f);l.flags|=128}if(_=l.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ce(vn,vn.current),m)break;return null;case 22:return l.lanes=0,lT(s,l,f,l.pendingProps);case 24:as(l,Sn,s.memoizedState.cache)}return vo(s,l,f)}function yT(s,l,f){if(s!==null)if(s.memoizedProps!==l.pendingProps)Rn=!0;else{if(!i0(s,f)&&(l.flags&128)===0)return Rn=!1,cV(s,l,f);Rn=(s.flags&131072)!==0}else Rn=!1,bt&&(l.flags&1048576)!==0&&$E(l,Bh,l.index);switch(l.lanes=0,l.tag){case 16:e:{var m=l.pendingProps;if(s=Ru(l.elementType),l.type=s,typeof s=="function")ly(s)?(m=ku(s,m),l.tag=1,l=dT(null,l,s,m,f)):(l.tag=0,l=Qy(null,l,s,m,f));else{if(s!=null){var _=s.$$typeof;if(_===C){l.tag=11,l=oT(null,l,s,m,f);break e}else if(_===O){l.tag=14,l=sT(null,l,s,m,f);break e}}throw l=J(s)||s,Error(r(306,l,""))}}return l;case 0:return Qy(s,l,l.type,l.pendingProps,f);case 1:return m=l.type,_=ku(m,l.pendingProps),dT(s,l,m,_,f);case 3:e:{if(ke(l,l.stateNode.containerInfo),s===null)throw Error(r(387));m=l.pendingProps;var x=l.memoizedState;_=x.element,Ty(s,l),Kh(l,m,null,f);var M=l.memoizedState;if(m=M.cache,as(l,Sn,m),m!==x.cache&&yy(l,[Sn],f,!0),qh(),m=M.element,x.isDehydrated)if(x={element:m,isDehydrated:!1,cache:M.cache},l.updateQueue.baseState=x,l.memoizedState=x,l.flags&256){l=pT(s,l,m,f);break e}else if(m!==_){_=Si(Error(r(424)),l),jh(_),l=pT(s,l,m,f);break e}else for(s=l.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,Xt=Di(s.firstChild),sr=l,bt=!0,rs=null,Ii=!0,f=l2(l,null,m,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Tu(),m===_){l=vo(s,l,f);break e}lr(s,l,m,f)}l=l.child}return l;case 26:return qp(s,l),s===null?(f=IC(l.type,null,l.pendingProps,null))?l.memoizedState=f:bt||(f=l.type,s=l.pendingProps,m=lm(Ae.current).createElement(f),m[En]=l,m[Yn]=s,cr(m,f,s),Tn(m),l.stateNode=m):l.memoizedState=IC(l.type,s.memoizedProps,l.pendingProps,s.memoizedState),null;case 27:return qe(l),s===null&&bt&&(m=l.stateNode=SC(l.type,l.pendingProps,Ae.current),sr=l,Ii=!0,_=Xt,ys(l.type)?(F0=_,Xt=Di(m.firstChild)):Xt=_),lr(s,l,l.pendingProps.children,f),qp(s,l),s===null&&(l.flags|=4194304),l.child;case 5:return s===null&&bt&&((_=m=Xt)&&(m=jV(m,l.type,l.pendingProps,Ii),m!==null?(l.stateNode=m,sr=l,Xt=Di(m.firstChild),Ii=!1,_=!0):_=!1),_||is(l)),qe(l),_=l.type,x=l.pendingProps,M=s!==null?s.memoizedProps:null,m=x.children,k0(_,x)?m=null:M!==null&&k0(_,M)&&(l.flags|=32),l.memoizedState!==null&&(_=Dy(s,l,tV,null,null,f),pf._currentValue=_),qp(s,l),lr(s,l,m,f),l.child;case 6:return s===null&&bt&&((s=f=Xt)&&(f=UV(f,l.pendingProps,Ii),f!==null?(l.stateNode=f,sr=l,Xt=null,s=!0):s=!1),s||is(l)),null;case 13:return mT(s,l,f);case 4:return ke(l,l.stateNode.containerInfo),m=l.pendingProps,s===null?l.child=Nu(l,null,m,f):lr(s,l,m,f),l.child;case 11:return oT(s,l,l.type,l.pendingProps,f);case 7:return lr(s,l,l.pendingProps,f),l.child;case 8:return lr(s,l,l.pendingProps.children,f),l.child;case 12:return lr(s,l,l.pendingProps.children,f),l.child;case 10:return m=l.pendingProps,as(l,l.type,m.value),lr(s,l,m.children,f),l.child;case 9:return _=l.type._context,m=l.pendingProps.children,Su(l),_=ur(_),m=m(_),l.flags|=1,lr(s,l,m,f),l.child;case 14:return sT(s,l,l.type,l.pendingProps,f);case 15:return uT(s,l,l.type,l.pendingProps,f);case 19:return vT(s,l,f);case 31:return lV(s,l,f);case 22:return lT(s,l,f,l.pendingProps);case 24:return Su(l),m=ur(Sn),s===null?(_=xy(),_===null&&(_=Wt,x=_y(),_.pooledCache=x,x.refCount++,x!==null&&(_.pooledCacheLanes|=f),_=x),l.memoizedState={parent:m,cache:_},Ey(l),as(l,Sn,_)):((s.lanes&f)!==0&&(Ty(s,l),Kh(l,null,null,f),qh()),_=s.memoizedState,x=l.memoizedState,_.parent!==m?(_={parent:m,cache:m},l.memoizedState=_,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=_),as(l,Sn,m)):(m=x.cache,as(l,Sn,m),m!==_.cache&&yy(l,[Sn],f,!0))),lr(s,l,l.pendingProps.children,f),l.child;case 29:throw l.pendingProps}throw Error(r(156,l.tag))}function yo(s){s.flags|=4}function a0(s,l,f,m,_){if((l=(s.mode&32)!==0)&&(l=!1),l){if(s.flags|=16777216,(_&335544128)===_)if(s.stateNode.complete)s.flags|=8192;else if(WT())s.flags|=8192;else throw Iu=Dp,wy}else s.flags&=-16777217}function _T(s,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!OC(l))if(WT())s.flags|=8192;else throw Iu=Dp,wy}function Xp(s,l){l!==null&&(s.flags|=4),s.flags&16384&&(l=s.tag!==22?ep():536870912,s.lanes|=l,$l|=l)}function Jh(s,l){if(!bt)switch(s.tailMode){case"hidden":l=s.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?s.tail=null:f.sibling=null;break;case"collapsed":f=s.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?l||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function Yt(s){var l=s.alternate!==null&&s.alternate.child===s.child,f=0,m=0;if(l)for(var _=s.child;_!==null;)f|=_.lanes|_.childLanes,m|=_.subtreeFlags&65011712,m|=_.flags&65011712,_.return=s,_=_.sibling;else for(_=s.child;_!==null;)f|=_.lanes|_.childLanes,m|=_.subtreeFlags,m|=_.flags,_.return=s,_=_.sibling;return s.subtreeFlags|=m,s.childLanes=f,l}function hV(s,l,f){var m=l.pendingProps;switch(dy(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(l),null;case 1:return Yt(l),null;case 3:return f=l.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),po(Sn),Ie(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(s===null||s.child===null)&&(Fl(l)?yo(l):s===null||s.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,my())),Yt(l),null;case 26:var _=l.type,x=l.memoizedState;return s===null?(yo(l),x!==null?(Yt(l),_T(l,x)):(Yt(l),a0(l,_,null,m,f))):x?x!==s.memoizedState?(yo(l),Yt(l),_T(l,x)):(Yt(l),l.flags&=-16777217):(s=s.memoizedProps,s!==m&&yo(l),Yt(l),a0(l,_,s,m,f)),null;case 27:if(Je(l),f=Ae.current,_=l.type,s!==null&&l.stateNode!=null)s.memoizedProps!==m&&yo(l);else{if(!m){if(l.stateNode===null)throw Error(r(166));return Yt(l),null}s=ve.current,Fl(l)?ZE(l):(s=SC(_,m,f),l.stateNode=s,yo(l))}return Yt(l),null;case 5:if(Je(l),_=l.type,s!==null&&l.stateNode!=null)s.memoizedProps!==m&&yo(l);else{if(!m){if(l.stateNode===null)throw Error(r(166));return Yt(l),null}if(x=ve.current,Fl(l))ZE(l);else{var M=lm(Ae.current);switch(x){case 1:x=M.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:x=M.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":x=M.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":x=M.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":x=M.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof m.is=="string"?M.createElement("select",{is:m.is}):M.createElement("select"),m.multiple?x.multiple=!0:m.size&&(x.size=m.size);break;default:x=typeof m.is=="string"?M.createElement(_,{is:m.is}):M.createElement(_)}}x[En]=l,x[Yn]=m;e:for(M=l.child;M!==null;){if(M.tag===5||M.tag===6)x.appendChild(M.stateNode);else if(M.tag!==4&&M.tag!==27&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===l)break e;for(;M.sibling===null;){if(M.return===null||M.return===l)break e;M=M.return}M.sibling.return=M.return,M=M.sibling}l.stateNode=x;e:switch(cr(x,_,m),_){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&yo(l)}}return Yt(l),a0(l,l.type,s===null?null:s.memoizedProps,l.pendingProps,f),null;case 6:if(s&&l.stateNode!=null)s.memoizedProps!==m&&yo(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(r(166));if(s=Ae.current,Fl(l)){if(s=l.stateNode,f=l.memoizedProps,m=null,_=sr,_!==null)switch(_.tag){case 27:case 5:m=_.memoizedProps}s[En]=l,s=!!(s.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||mC(s.nodeValue,f)),s||is(l,!0)}else s=lm(s).createTextNode(m),s[En]=l,l.stateNode=s}return Yt(l),null;case 31:if(f=l.memoizedState,s===null||s.memoizedState!==null){if(m=Fl(l),f!==null){if(s===null){if(!m)throw Error(r(318));if(s=l.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[En]=l}else Tu(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Yt(l),s=!1}else f=my(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=f),s=!0;if(!s)return l.flags&256?(oi(l),l):(oi(l),null);if((l.flags&128)!==0)throw Error(r(558))}return Yt(l),null;case 13:if(m=l.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(_=Fl(l),m!==null&&m.dehydrated!==null){if(s===null){if(!_)throw Error(r(318));if(_=l.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));_[En]=l}else Tu(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Yt(l),_=!1}else _=my(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=_),_=!0;if(!_)return l.flags&256?(oi(l),l):(oi(l),null)}return oi(l),(l.flags&128)!==0?(l.lanes=f,l):(f=m!==null,s=s!==null&&s.memoizedState!==null,f&&(m=l.child,_=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(_=m.alternate.memoizedState.cachePool.pool),x=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(x=m.memoizedState.cachePool.pool),x!==_&&(m.flags|=2048)),f!==s&&f&&(l.child.flags|=8192),Xp(l,l.updateQueue),Yt(l),null);case 4:return Ie(),s===null&&A0(l.stateNode.containerInfo),Yt(l),null;case 10:return po(l.type),Yt(l),null;case 19:if(Q(vn),m=l.memoizedState,m===null)return Yt(l),null;if(_=(l.flags&128)!==0,x=m.rendering,x===null)if(_)Jh(m,!1);else{if(hn!==0||s!==null&&(s.flags&128)!==0)for(s=l.child;s!==null;){if(x=Pp(s),x!==null){for(l.flags|=128,Jh(m,!1),s=x.updateQueue,l.updateQueue=s,Xp(l,s),l.subtreeFlags=0,s=f,f=l.child;f!==null;)KE(f,s),f=f.sibling;return ce(vn,vn.current&1|2),bt&&ho(l,m.treeForkCount),l.child}s=s.sibling}m.tail!==null&&ln()>Jp&&(l.flags|=128,_=!0,Jh(m,!1),l.lanes=4194304)}else{if(!_)if(s=Pp(x),s!==null){if(l.flags|=128,_=!0,s=s.updateQueue,l.updateQueue=s,Xp(l,s),Jh(m,!0),m.tail===null&&m.tailMode==="hidden"&&!x.alternate&&!bt)return Yt(l),null}else 2*ln()-m.renderingStartTime>Jp&&f!==536870912&&(l.flags|=128,_=!0,Jh(m,!1),l.lanes=4194304);m.isBackwards?(x.sibling=l.child,l.child=x):(s=m.last,s!==null?s.sibling=x:l.child=x,m.last=x)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=ln(),s.sibling=null,f=vn.current,ce(vn,_?f&1|2:f&1),bt&&ho(l,m.treeForkCount),s):(Yt(l),null);case 22:case 23:return oi(l),Ry(),m=l.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(f&536870912)!==0&&(l.flags&128)===0&&(Yt(l),l.subtreeFlags&6&&(l.flags|=8192)):Yt(l),f=l.updateQueue,f!==null&&Xp(l,f.retryQueue),f=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(f=s.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==f&&(l.flags|=2048),s!==null&&Q(Au),null;case 24:return f=null,s!==null&&(f=s.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),po(Sn),Yt(l),null;case 25:return null;case 30:return null}throw Error(r(156,l.tag))}function fV(s,l){switch(dy(l),l.tag){case 1:return s=l.flags,s&65536?(l.flags=s&-65537|128,l):null;case 3:return po(Sn),Ie(),s=l.flags,(s&65536)!==0&&(s&128)===0?(l.flags=s&-65537|128,l):null;case 26:case 27:case 5:return Je(l),null;case 31:if(l.memoizedState!==null){if(oi(l),l.alternate===null)throw Error(r(340));Tu()}return s=l.flags,s&65536?(l.flags=s&-65537|128,l):null;case 13:if(oi(l),s=l.memoizedState,s!==null&&s.dehydrated!==null){if(l.alternate===null)throw Error(r(340));Tu()}return s=l.flags,s&65536?(l.flags=s&-65537|128,l):null;case 19:return Q(vn),null;case 4:return Ie(),null;case 10:return po(l.type),null;case 22:case 23:return oi(l),Ry(),s!==null&&Q(Au),s=l.flags,s&65536?(l.flags=s&-65537|128,l):null;case 24:return po(Sn),null;case 25:return null;default:return null}}function bT(s,l){switch(dy(l),l.tag){case 3:po(Sn),Ie();break;case 26:case 27:case 5:Je(l);break;case 4:Ie();break;case 31:l.memoizedState!==null&&oi(l);break;case 13:oi(l);break;case 19:Q(vn);break;case 10:po(l.type);break;case 22:case 23:oi(l),Ry(),s!==null&&Q(Au);break;case 24:po(Sn)}}function ef(s,l){try{var f=l.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var _=m.next;f=_;do{if((f.tag&s)===s){m=void 0;var x=f.create,M=f.inst;m=x(),M.destroy=m}f=f.next}while(f!==_)}}catch(U){Bt(l,l.return,U)}}function hs(s,l,f){try{var m=l.updateQueue,_=m!==null?m.lastEffect:null;if(_!==null){var x=_.next;m=x;do{if((m.tag&s)===s){var M=m.inst,U=M.destroy;if(U!==void 0){M.destroy=void 0,_=l;var K=f,ae=U;try{ae()}catch(me){Bt(_,K,me)}}}m=m.next}while(m!==x)}}catch(me){Bt(l,l.return,me)}}function xT(s){var l=s.updateQueue;if(l!==null){var f=s.stateNode;try{h2(l,f)}catch(m){Bt(s,s.return,m)}}}function wT(s,l,f){f.props=ku(s.type,s.memoizedProps),f.state=s.memoizedState;try{f.componentWillUnmount()}catch(m){Bt(s,l,m)}}function tf(s,l){try{var f=s.ref;if(f!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof f=="function"?s.refCleanup=f(m):f.current=m}}catch(_){Bt(s,l,_)}}function Ma(s,l){var f=s.ref,m=s.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(_){Bt(s,l,_)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(_){Bt(s,l,_)}else f.current=null}function ET(s){var l=s.type,f=s.memoizedProps,m=s.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(_){Bt(s,s.return,_)}}function o0(s,l,f){try{var m=s.stateNode;OV(m,s.type,f,l),m[Yn]=l}catch(_){Bt(s,s.return,_)}}function TT(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ys(s.type)||s.tag===4}function s0(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||TT(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ys(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function u0(s,l,f){var m=s.tag;if(m===5||m===6)s=s.stateNode,l?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(s,l):(l=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,l.appendChild(s),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=Ki));else if(m!==4&&(m===27&&ys(s.type)&&(f=s.stateNode,l=null),s=s.child,s!==null))for(u0(s,l,f),s=s.sibling;s!==null;)u0(s,l,f),s=s.sibling}function Yp(s,l,f){var m=s.tag;if(m===5||m===6)s=s.stateNode,l?f.insertBefore(s,l):f.appendChild(s);else if(m!==4&&(m===27&&ys(s.type)&&(f=s.stateNode),s=s.child,s!==null))for(Yp(s,l,f),s=s.sibling;s!==null;)Yp(s,l,f),s=s.sibling}function CT(s){var l=s.stateNode,f=s.memoizedProps;try{for(var m=s.type,_=l.attributes;_.length;)l.removeAttributeNode(_[0]);cr(l,m,f),l[En]=s,l[Yn]=f}catch(x){Bt(s,s.return,x)}}var _o=!1,In=!1,l0=!1,ST=typeof WeakSet=="function"?WeakSet:Set,Qn=null;function dV(s,l){if(s=s.containerInfo,N0=gm,s=LE(s),ny(s)){if("selectionStart"in s)var f={start:s.selectionStart,end:s.selectionEnd};else e:{f=(f=s.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var _=m.anchorOffset,x=m.focusNode;m=m.focusOffset;try{f.nodeType,x.nodeType}catch{f=null;break e}var M=0,U=-1,K=-1,ae=0,me=0,be=s,se=null;t:for(;;){for(var de;be!==f||_!==0&&be.nodeType!==3||(U=M+_),be!==x||m!==0&&be.nodeType!==3||(K=M+m),be.nodeType===3&&(M+=be.nodeValue.length),(de=be.firstChild)!==null;)se=be,be=de;for(;;){if(be===s)break t;if(se===f&&++ae===_&&(U=M),se===x&&++me===m&&(K=M),(de=be.nextSibling)!==null)break;be=se,se=be.parentNode}be=de}f=U===-1||K===-1?null:{start:U,end:K}}else f=null}f=f||{start:0,end:0}}else f=null;for(D0={focusedElem:s,selectionRange:f},gm=!1,Qn=l;Qn!==null;)if(l=Qn,s=l.child,(l.subtreeFlags&1028)!==0&&s!==null)s.return=l,Qn=s;else for(;Qn!==null;){switch(l=Qn,x=l.alternate,s=l.flags,l.tag){case 0:if((s&4)!==0&&(s=l.updateQueue,s=s!==null?s.events:null,s!==null))for(f=0;f<s.length;f++)_=s[f],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&x!==null){s=void 0,f=l,_=x.memoizedProps,x=x.memoizedState,m=f.stateNode;try{var Ve=ku(f.type,_);s=m.getSnapshotBeforeUpdate(Ve,x),m.__reactInternalSnapshotBeforeUpdate=s}catch(Ke){Bt(f,f.return,Ke)}}break;case 3:if((s&1024)!==0){if(s=l.stateNode.containerInfo,f=s.nodeType,f===9)O0(s);else if(f===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":O0(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=l.sibling,s!==null){s.return=l.return,Qn=s;break}Qn=l.return}}function AT(s,l,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:xo(s,f),m&4&&ef(5,f);break;case 1:if(xo(s,f),m&4)if(s=f.stateNode,l===null)try{s.componentDidMount()}catch(M){Bt(f,f.return,M)}else{var _=ku(f.type,l.memoizedProps);l=l.memoizedState;try{s.componentDidUpdate(_,l,s.__reactInternalSnapshotBeforeUpdate)}catch(M){Bt(f,f.return,M)}}m&64&&xT(f),m&512&&tf(f,f.return);break;case 3:if(xo(s,f),m&64&&(s=f.updateQueue,s!==null)){if(l=null,f.child!==null)switch(f.child.tag){case 27:case 5:l=f.child.stateNode;break;case 1:l=f.child.stateNode}try{h2(s,l)}catch(M){Bt(f,f.return,M)}}break;case 27:l===null&&m&4&&CT(f);case 26:case 5:xo(s,f),l===null&&m&4&&ET(f),m&512&&tf(f,f.return);break;case 12:xo(s,f);break;case 31:xo(s,f),m&4&&NT(s,f);break;case 13:xo(s,f),m&4&&DT(s,f),m&64&&(s=f.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(f=wV.bind(null,f),zV(s,f))));break;case 22:if(m=f.memoizedState!==null||_o,!m){l=l!==null&&l.memoizedState!==null||In,_=_o;var x=In;_o=m,(In=l)&&!x?wo(s,f,(f.subtreeFlags&8772)!==0):xo(s,f),_o=_,In=x}break;case 30:break;default:xo(s,f)}}function RT(s){var l=s.alternate;l!==null&&(s.alternate=null,RT(l)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(l=s.stateNode,l!==null&&bl(l)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var nn=null,Ur=!1;function bo(s,l,f){for(f=f.child;f!==null;)IT(s,l,f),f=f.sibling}function IT(s,l,f){if(pn&&typeof pn.onCommitFiberUnmount=="function")try{pn.onCommitFiberUnmount(Mr,f)}catch{}switch(f.tag){case 26:In||Ma(f,l),bo(s,l,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:In||Ma(f,l);var m=nn,_=Ur;ys(f.type)&&(nn=f.stateNode,Ur=!1),bo(s,l,f),hf(f.stateNode),nn=m,Ur=_;break;case 5:In||Ma(f,l);case 6:if(m=nn,_=Ur,nn=null,bo(s,l,f),nn=m,Ur=_,nn!==null)if(Ur)try{(nn.nodeType===9?nn.body:nn.nodeName==="HTML"?nn.ownerDocument.body:nn).removeChild(f.stateNode)}catch(x){Bt(f,l,x)}else try{nn.removeChild(f.stateNode)}catch(x){Bt(f,l,x)}break;case 18:nn!==null&&(Ur?(s=nn,xC(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,f.stateNode),ic(s)):xC(nn,f.stateNode));break;case 4:m=nn,_=Ur,nn=f.stateNode.containerInfo,Ur=!0,bo(s,l,f),nn=m,Ur=_;break;case 0:case 11:case 14:case 15:hs(2,f,l),In||hs(4,f,l),bo(s,l,f);break;case 1:In||(Ma(f,l),m=f.stateNode,typeof m.componentWillUnmount=="function"&&wT(f,l,m)),bo(s,l,f);break;case 21:bo(s,l,f);break;case 22:In=(m=In)||f.memoizedState!==null,bo(s,l,f),In=m;break;default:bo(s,l,f)}}function NT(s,l){if(l.memoizedState===null&&(s=l.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{ic(s)}catch(f){Bt(l,l.return,f)}}}function DT(s,l){if(l.memoizedState===null&&(s=l.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{ic(s)}catch(f){Bt(l,l.return,f)}}function pV(s){switch(s.tag){case 31:case 13:case 19:var l=s.stateNode;return l===null&&(l=s.stateNode=new ST),l;case 22:return s=s.stateNode,l=s._retryCache,l===null&&(l=s._retryCache=new ST),l;default:throw Error(r(435,s.tag))}}function $p(s,l){var f=pV(s);l.forEach(function(m){if(!f.has(m)){f.add(m);var _=EV.bind(null,s,m);m.then(_,_)}})}function zr(s,l){var f=l.deletions;if(f!==null)for(var m=0;m<f.length;m++){var _=f[m],x=s,M=l,U=M;e:for(;U!==null;){switch(U.tag){case 27:if(ys(U.type)){nn=U.stateNode,Ur=!1;break e}break;case 5:nn=U.stateNode,Ur=!1;break e;case 3:case 4:nn=U.stateNode.containerInfo,Ur=!0;break e}U=U.return}if(nn===null)throw Error(r(160));IT(x,M,_),nn=null,Ur=!1,x=_.alternate,x!==null&&(x.return=null),_.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)kT(l,s),l=l.sibling}var Ji=null;function kT(s,l){var f=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:zr(l,s),Gr(s),m&4&&(hs(3,s,s.return),ef(3,s),hs(5,s,s.return));break;case 1:zr(l,s),Gr(s),m&512&&(In||f===null||Ma(f,f.return)),m&64&&_o&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(f=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var _=Ji;if(zr(l,s),Gr(s),m&512&&(In||f===null||Ma(f,f.return)),m&4){var x=f!==null?f.memoizedState:null;if(m=s.memoizedState,f===null)if(m===null)if(s.stateNode===null){e:{m=s.type,f=s.memoizedProps,_=_.ownerDocument||_;t:switch(m){case"title":x=_.getElementsByTagName("title")[0],(!x||x[_a]||x[En]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=_.createElement(m),_.head.insertBefore(x,_.querySelector("head > title"))),cr(x,m,f),x[En]=s,Tn(x),m=x;break e;case"link":var M=kC("link","href",_).get(m+(f.href||""));if(M){for(var U=0;U<M.length;U++)if(x=M[U],x.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&x.getAttribute("rel")===(f.rel==null?null:f.rel)&&x.getAttribute("title")===(f.title==null?null:f.title)&&x.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){M.splice(U,1);break t}}x=_.createElement(m),cr(x,m,f),_.head.appendChild(x);break;case"meta":if(M=kC("meta","content",_).get(m+(f.content||""))){for(U=0;U<M.length;U++)if(x=M[U],x.getAttribute("content")===(f.content==null?null:""+f.content)&&x.getAttribute("name")===(f.name==null?null:f.name)&&x.getAttribute("property")===(f.property==null?null:f.property)&&x.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&x.getAttribute("charset")===(f.charSet==null?null:f.charSet)){M.splice(U,1);break t}}x=_.createElement(m),cr(x,m,f),_.head.appendChild(x);break;default:throw Error(r(468,m))}x[En]=s,Tn(x),m=x}s.stateNode=m}else MC(_,s.type,s.stateNode);else s.stateNode=DC(_,m,s.memoizedProps);else x!==m?(x===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):x.count--,m===null?MC(_,s.type,s.stateNode):DC(_,m,s.memoizedProps)):m===null&&s.stateNode!==null&&o0(s,s.memoizedProps,f.memoizedProps)}break;case 27:zr(l,s),Gr(s),m&512&&(In||f===null||Ma(f,f.return)),f!==null&&m&4&&o0(s,s.memoizedProps,f.memoizedProps);break;case 5:if(zr(l,s),Gr(s),m&512&&(In||f===null||Ma(f,f.return)),s.flags&32){_=s.stateNode;try{jr(_,"")}catch(Ve){Bt(s,s.return,Ve)}}m&4&&s.stateNode!=null&&(_=s.memoizedProps,o0(s,_,f!==null?f.memoizedProps:_)),m&1024&&(l0=!0);break;case 6:if(zr(l,s),Gr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,f=s.stateNode;try{f.nodeValue=m}catch(Ve){Bt(s,s.return,Ve)}}break;case 3:if(fm=null,_=Ji,Ji=cm(l.containerInfo),zr(l,s),Ji=_,Gr(s),m&4&&f!==null&&f.memoizedState.isDehydrated)try{ic(l.containerInfo)}catch(Ve){Bt(s,s.return,Ve)}l0&&(l0=!1,MT(s));break;case 4:m=Ji,Ji=cm(s.stateNode.containerInfo),zr(l,s),Gr(s),Ji=m;break;case 12:zr(l,s),Gr(s);break;case 31:zr(l,s),Gr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,$p(s,m)));break;case 13:zr(l,s),Gr(s),s.child.flags&8192&&s.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Zp=ln()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,$p(s,m)));break;case 22:_=s.memoizedState!==null;var K=f!==null&&f.memoizedState!==null,ae=_o,me=In;if(_o=ae||_,In=me||K,zr(l,s),In=me,_o=ae,Gr(s),m&8192)e:for(l=s.stateNode,l._visibility=_?l._visibility&-2:l._visibility|1,_&&(f===null||K||_o||In||Mu(s)),f=null,l=s;;){if(l.tag===5||l.tag===26){if(f===null){K=f=l;try{if(x=K.stateNode,_)M=x.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{U=K.stateNode;var be=K.memoizedProps.style,se=be!=null&&be.hasOwnProperty("display")?be.display:null;U.style.display=se==null||typeof se=="boolean"?"":(""+se).trim()}}catch(Ve){Bt(K,K.return,Ve)}}}else if(l.tag===6){if(f===null){K=l;try{K.stateNode.nodeValue=_?"":K.memoizedProps}catch(Ve){Bt(K,K.return,Ve)}}}else if(l.tag===18){if(f===null){K=l;try{var de=K.stateNode;_?wC(de,!0):wC(K.stateNode,!1)}catch(Ve){Bt(K,K.return,Ve)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===s)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break e;for(;l.sibling===null;){if(l.return===null||l.return===s)break e;f===l&&(f=null),l=l.return}f===l&&(f=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=s.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,$p(s,f))));break;case 19:zr(l,s),Gr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,$p(s,m)));break;case 30:break;case 21:break;default:zr(l,s),Gr(s)}}function Gr(s){var l=s.flags;if(l&2){try{for(var f,m=s.return;m!==null;){if(TT(m)){f=m;break}m=m.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var _=f.stateNode,x=s0(s);Yp(s,x,_);break;case 5:var M=f.stateNode;f.flags&32&&(jr(M,""),f.flags&=-33);var U=s0(s);Yp(s,U,M);break;case 3:case 4:var K=f.stateNode.containerInfo,ae=s0(s);u0(s,ae,K);break;default:throw Error(r(161))}}catch(me){Bt(s,s.return,me)}s.flags&=-3}l&4096&&(s.flags&=-4097)}function MT(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var l=s;MT(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),s=s.sibling}}function xo(s,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)AT(s,l.alternate,l),l=l.sibling}function Mu(s){for(s=s.child;s!==null;){var l=s;switch(l.tag){case 0:case 11:case 14:case 15:hs(4,l,l.return),Mu(l);break;case 1:Ma(l,l.return);var f=l.stateNode;typeof f.componentWillUnmount=="function"&&wT(l,l.return,f),Mu(l);break;case 27:hf(l.stateNode);case 26:case 5:Ma(l,l.return),Mu(l);break;case 22:l.memoizedState===null&&Mu(l);break;case 30:Mu(l);break;default:Mu(l)}s=s.sibling}}function wo(s,l,f){for(f=f&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,_=s,x=l,M=x.flags;switch(x.tag){case 0:case 11:case 15:wo(_,x,f),ef(4,x);break;case 1:if(wo(_,x,f),m=x,_=m.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ae){Bt(m,m.return,ae)}if(m=x,_=m.updateQueue,_!==null){var U=m.stateNode;try{var K=_.shared.hiddenCallbacks;if(K!==null)for(_.shared.hiddenCallbacks=null,_=0;_<K.length;_++)c2(K[_],U)}catch(ae){Bt(m,m.return,ae)}}f&&M&64&&xT(x),tf(x,x.return);break;case 27:CT(x);case 26:case 5:wo(_,x,f),f&&m===null&&M&4&&ET(x),tf(x,x.return);break;case 12:wo(_,x,f);break;case 31:wo(_,x,f),f&&M&4&&NT(_,x);break;case 13:wo(_,x,f),f&&M&4&&DT(_,x);break;case 22:x.memoizedState===null&&wo(_,x,f),tf(x,x.return);break;case 30:break;default:wo(_,x,f)}l=l.sibling}}function c0(s,l){var f=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(f=s.memoizedState.cachePool.pool),s=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(s=l.memoizedState.cachePool.pool),s!==f&&(s!=null&&s.refCount++,f!=null&&Uh(f))}function h0(s,l){s=null,l.alternate!==null&&(s=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==s&&(l.refCount++,s!=null&&Uh(s))}function ea(s,l,f,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)OT(s,l,f,m),l=l.sibling}function OT(s,l,f,m){var _=l.flags;switch(l.tag){case 0:case 11:case 15:ea(s,l,f,m),_&2048&&ef(9,l);break;case 1:ea(s,l,f,m);break;case 3:ea(s,l,f,m),_&2048&&(s=null,l.alternate!==null&&(s=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==s&&(l.refCount++,s!=null&&Uh(s)));break;case 12:if(_&2048){ea(s,l,f,m),s=l.stateNode;try{var x=l.memoizedProps,M=x.id,U=x.onPostCommit;typeof U=="function"&&U(M,l.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(K){Bt(l,l.return,K)}}else ea(s,l,f,m);break;case 31:ea(s,l,f,m);break;case 13:ea(s,l,f,m);break;case 23:break;case 22:x=l.stateNode,M=l.alternate,l.memoizedState!==null?x._visibility&2?ea(s,l,f,m):nf(s,l):x._visibility&2?ea(s,l,f,m):(x._visibility|=2,Kl(s,l,f,m,(l.subtreeFlags&10256)!==0||!1)),_&2048&&c0(M,l);break;case 24:ea(s,l,f,m),_&2048&&h0(l.alternate,l);break;default:ea(s,l,f,m)}}function Kl(s,l,f,m,_){for(_=_&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var x=s,M=l,U=f,K=m,ae=M.flags;switch(M.tag){case 0:case 11:case 15:Kl(x,M,U,K,_),ef(8,M);break;case 23:break;case 22:var me=M.stateNode;M.memoizedState!==null?me._visibility&2?Kl(x,M,U,K,_):nf(x,M):(me._visibility|=2,Kl(x,M,U,K,_)),_&&ae&2048&&c0(M.alternate,M);break;case 24:Kl(x,M,U,K,_),_&&ae&2048&&h0(M.alternate,M);break;default:Kl(x,M,U,K,_)}l=l.sibling}}function nf(s,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var f=s,m=l,_=m.flags;switch(m.tag){case 22:nf(f,m),_&2048&&c0(m.alternate,m);break;case 24:nf(f,m),_&2048&&h0(m.alternate,m);break;default:nf(f,m)}l=l.sibling}}var rf=8192;function Xl(s,l,f){if(s.subtreeFlags&rf)for(s=s.child;s!==null;)PT(s,l,f),s=s.sibling}function PT(s,l,f){switch(s.tag){case 26:Xl(s,l,f),s.flags&rf&&s.memoizedState!==null&&eF(f,Ji,s.memoizedState,s.memoizedProps);break;case 5:Xl(s,l,f);break;case 3:case 4:var m=Ji;Ji=cm(s.stateNode.containerInfo),Xl(s,l,f),Ji=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=rf,rf=16777216,Xl(s,l,f),rf=m):Xl(s,l,f));break;default:Xl(s,l,f)}}function VT(s){var l=s.alternate;if(l!==null&&(s=l.child,s!==null)){l.child=null;do l=s.sibling,s.sibling=null,s=l;while(s!==null)}}function af(s){var l=s.deletions;if((s.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Qn=m,LT(m,s)}VT(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)FT(s),s=s.sibling}function FT(s){switch(s.tag){case 0:case 11:case 15:af(s),s.flags&2048&&hs(9,s,s.return);break;case 3:af(s);break;case 12:af(s);break;case 22:var l=s.stateNode;s.memoizedState!==null&&l._visibility&2&&(s.return===null||s.return.tag!==13)?(l._visibility&=-3,Qp(s)):af(s);break;default:af(s)}}function Qp(s){var l=s.deletions;if((s.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Qn=m,LT(m,s)}VT(s)}for(s=s.child;s!==null;){switch(l=s,l.tag){case 0:case 11:case 15:hs(8,l,l.return),Qp(l);break;case 22:f=l.stateNode,f._visibility&2&&(f._visibility&=-3,Qp(l));break;default:Qp(l)}s=s.sibling}}function LT(s,l){for(;Qn!==null;){var f=Qn;switch(f.tag){case 0:case 11:case 15:hs(8,f,l);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Uh(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,Qn=m;else e:for(f=s;Qn!==null;){m=Qn;var _=m.sibling,x=m.return;if(RT(m),m===f){Qn=null;break e}if(_!==null){_.return=x,Qn=_;break e}Qn=x}}}var mV={getCacheForType:function(s){var l=ur(Sn),f=l.data.get(s);return f===void 0&&(f=s(),l.data.set(s,f)),f},cacheSignal:function(){return ur(Sn).controller.signal}},gV=typeof WeakMap=="function"?WeakMap:Map,Nt=0,Wt=null,dt=null,gt=0,Lt=0,si=null,fs=!1,Yl=!1,f0=!1,Eo=0,hn=0,ds=0,Ou=0,d0=0,ui=0,$l=0,of=null,Hr=null,p0=!1,Zp=0,BT=0,Jp=1/0,em=null,ps=null,Ln=0,ms=null,Ql=null,To=0,m0=0,g0=null,jT=null,sf=0,v0=null;function li(){return(Nt&2)!==0&&gt!==0?gt&-gt:q.T!==null?E0():tp()}function UT(){if(ui===0)if((gt&536870912)===0||bt){var s=su;su<<=1,(su&3932160)===0&&(su=262144),ui=s}else ui=536870912;return s=ai.current,s!==null&&(s.flags|=32),ui}function Wr(s,l,f){(s===Wt&&(Lt===2||Lt===9)||s.cancelPendingCommit!==null)&&(Zl(s,0),gs(s,gt,ui,!1)),uu(s,f),((Nt&2)===0||s!==Wt)&&(s===Wt&&((Nt&2)===0&&(Ou|=f),hn===4&&gs(s,gt,ui,!1)),Oa(s))}function zT(s,l,f){if((Nt&6)!==0)throw Error(r(327));var m=!f&&(l&127)===0&&(l&s.expiredLanes)===0||Hi(s,l),_=m?_V(s,l):_0(s,l,!0),x=m;do{if(_===0){Yl&&!m&&gs(s,l,0,!1);break}else{if(f=s.current.alternate,x&&!vV(f)){_=_0(s,l,!1),x=!1;continue}if(_===2){if(x=l,s.errorRecoveryDisabledLanes&x)var M=0;else M=s.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){l=M;e:{var U=s;_=of;var K=U.current.memoizedState.isDehydrated;if(K&&(Zl(U,M).flags|=256),M=_0(U,M,!1),M!==2){if(f0&&!K){U.errorRecoveryDisabledLanes|=x,Ou|=x,_=4;break e}x=Hr,Hr=_,x!==null&&(Hr===null?Hr=x:Hr.push.apply(Hr,x))}_=M}if(x=!1,_!==2)continue}}if(_===1){Zl(s,0),gs(s,l,0,!0);break}e:{switch(m=s,x=_,x){case 0:case 1:throw Error(r(345));case 4:if((l&4194048)!==l)break;case 6:gs(m,l,ui,!fs);break e;case 2:Hr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((l&62914560)===l&&(_=Zp+300-ln(),10<_)){if(gs(m,l,ui,!fs),ga(m,0,!0)!==0)break e;To=l,m.timeoutHandle=_C(GT.bind(null,m,f,Hr,em,p0,l,ui,Ou,$l,fs,x,"Throttled",-0,0),_);break e}GT(m,f,Hr,em,p0,l,ui,Ou,$l,fs,x,null,-0,0)}}break}while(!0);Oa(s)}function GT(s,l,f,m,_,x,M,U,K,ae,me,be,se,de){if(s.timeoutHandle=-1,be=l.subtreeFlags,be&8192||(be&16785408)===16785408){be={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ki},PT(l,x,be);var Ve=(x&62914560)===x?Zp-ln():(x&4194048)===x?BT-ln():0;if(Ve=tF(be,Ve),Ve!==null){To=x,s.cancelPendingCommit=Ve(QT.bind(null,s,l,x,f,m,_,M,U,K,me,be,null,se,de)),gs(s,x,M,!ae);return}}QT(s,l,x,f,m,_,M,U,K)}function vV(s){for(var l=s;;){var f=l.tag;if((f===0||f===11||f===15)&&l.flags&16384&&(f=l.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var _=f[m],x=_.getSnapshot;_=_.value;try{if(!ri(x(),_))return!1}catch{return!1}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function gs(s,l,f,m){l&=~d0,l&=~Ou,s.suspendedLanes|=l,s.pingedLanes&=~l,m&&(s.warmLanes|=l),m=s.expirationTimes;for(var _=l;0<_;){var x=31-mn(_),M=1<<x;m[x]=-1,_&=~M}f!==0&&lu(s,f,l)}function tm(){return(Nt&6)===0?(uf(0),!1):!0}function y0(){if(dt!==null){if(Lt===0)var s=dt.return;else s=dt,fo=Cu=null,Oy(s),zl=null,Gh=0,s=dt;for(;s!==null;)bT(s.alternate,s),s=s.return;dt=null}}function Zl(s,l){var f=s.timeoutHandle;f!==-1&&(s.timeoutHandle=-1,FV(f)),f=s.cancelPendingCommit,f!==null&&(s.cancelPendingCommit=null,f()),To=0,y0(),Wt=s,dt=f=co(s.current,null),gt=l,Lt=0,si=null,fs=!1,Yl=Hi(s,l),f0=!1,$l=ui=d0=Ou=ds=hn=0,Hr=of=null,p0=!1,(l&8)!==0&&(l|=l&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=l;0<m;){var _=31-mn(m),x=1<<_;l|=s[_],m&=~x}return Eo=l,wp(),f}function HT(s,l){ut=null,q.H=Qh,l===Ul||l===Np?(l=o2(),Lt=3):l===wy?(l=o2(),Lt=4):Lt=l===$y?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,si=l,dt===null&&(hn=1,Hp(s,Si(l,s.current)))}function WT(){var s=ai.current;return s===null?!0:(gt&4194048)===gt?Ni===null:(gt&62914560)===gt||(gt&536870912)!==0?s===Ni:!1}function qT(){var s=q.H;return q.H=Qh,s===null?Qh:s}function KT(){var s=q.A;return q.A=mV,s}function nm(){hn=4,fs||(gt&4194048)!==gt&&ai.current!==null||(Yl=!0),(ds&134217727)===0&&(Ou&134217727)===0||Wt===null||gs(Wt,gt,ui,!1)}function _0(s,l,f){var m=Nt;Nt|=2;var _=qT(),x=KT();(Wt!==s||gt!==l)&&(em=null,Zl(s,l)),l=!1;var M=hn;e:do try{if(Lt!==0&&dt!==null){var U=dt,K=si;switch(Lt){case 8:y0(),M=6;break e;case 3:case 2:case 9:case 6:ai.current===null&&(l=!0);var ae=Lt;if(Lt=0,si=null,Jl(s,U,K,ae),f&&Yl){M=0;break e}break;default:ae=Lt,Lt=0,si=null,Jl(s,U,K,ae)}}yV(),M=hn;break}catch(me){HT(s,me)}while(!0);return l&&s.shellSuspendCounter++,fo=Cu=null,Nt=m,q.H=_,q.A=x,dt===null&&(Wt=null,gt=0,wp()),M}function yV(){for(;dt!==null;)XT(dt)}function _V(s,l){var f=Nt;Nt|=2;var m=qT(),_=KT();Wt!==s||gt!==l?(em=null,Jp=ln()+500,Zl(s,l)):Yl=Hi(s,l);e:do try{if(Lt!==0&&dt!==null){l=dt;var x=si;t:switch(Lt){case 1:Lt=0,si=null,Jl(s,l,x,1);break;case 2:case 9:if(i2(x)){Lt=0,si=null,YT(l);break}l=function(){Lt!==2&&Lt!==9||Wt!==s||(Lt=7),Oa(s)},x.then(l,l);break e;case 3:Lt=7;break e;case 4:Lt=5;break e;case 7:i2(x)?(Lt=0,si=null,YT(l)):(Lt=0,si=null,Jl(s,l,x,7));break;case 5:var M=null;switch(dt.tag){case 26:M=dt.memoizedState;case 5:case 27:var U=dt;if(M?OC(M):U.stateNode.complete){Lt=0,si=null;var K=U.sibling;if(K!==null)dt=K;else{var ae=U.return;ae!==null?(dt=ae,rm(ae)):dt=null}break t}}Lt=0,si=null,Jl(s,l,x,5);break;case 6:Lt=0,si=null,Jl(s,l,x,6);break;case 8:y0(),hn=6;break e;default:throw Error(r(462))}}bV();break}catch(me){HT(s,me)}while(!0);return fo=Cu=null,q.H=m,q.A=_,Nt=f,dt!==null?0:(Wt=null,gt=0,wp(),hn)}function bV(){for(;dt!==null&&!_i();)XT(dt)}function XT(s){var l=yT(s.alternate,s,Eo);s.memoizedProps=s.pendingProps,l===null?rm(s):dt=l}function YT(s){var l=s,f=l.alternate;switch(l.tag){case 15:case 0:l=fT(f,l,l.pendingProps,l.type,void 0,gt);break;case 11:l=fT(f,l,l.pendingProps,l.type.render,l.ref,gt);break;case 5:Oy(l);default:bT(f,l),l=dt=KE(l,Eo),l=yT(f,l,Eo)}s.memoizedProps=s.pendingProps,l===null?rm(s):dt=l}function Jl(s,l,f,m){fo=Cu=null,Oy(l),zl=null,Gh=0;var _=l.return;try{if(uV(s,_,l,f,gt)){hn=1,Hp(s,Si(f,s.current)),dt=null;return}}catch(x){if(_!==null)throw dt=_,x;hn=1,Hp(s,Si(f,s.current)),dt=null;return}l.flags&32768?(bt||m===1?s=!0:Yl||(gt&536870912)!==0?s=!1:(fs=s=!0,(m===2||m===9||m===3||m===6)&&(m=ai.current,m!==null&&m.tag===13&&(m.flags|=16384))),$T(l,s)):rm(l)}function rm(s){var l=s;do{if((l.flags&32768)!==0){$T(l,fs);return}s=l.return;var f=hV(l.alternate,l,Eo);if(f!==null){dt=f;return}if(l=l.sibling,l!==null){dt=l;return}dt=l=s}while(l!==null);hn===0&&(hn=5)}function $T(s,l){do{var f=fV(s.alternate,s);if(f!==null){f.flags&=32767,dt=f;return}if(f=s.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!l&&(s=s.sibling,s!==null)){dt=s;return}dt=s=f}while(s!==null);hn=6,dt=null}function QT(s,l,f,m,_,x,M,U,K){s.cancelPendingCommit=null;do im();while(Ln!==0);if((Nt&6)!==0)throw Error(r(327));if(l!==null){if(l===s.current)throw Error(r(177));if(x=l.lanes|l.childLanes,x|=sy,Zv(s,f,x,M,U,K),s===Wt&&(dt=Wt=null,gt=0),Ql=l,ms=s,To=f,m0=x,g0=_,jT=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,TV(Fn,function(){return nC(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=q.T,q.T=null,_=Y.p,Y.p=2,M=Nt,Nt|=4;try{dV(s,l,f)}finally{Nt=M,Y.p=_,q.T=m}}Ln=1,ZT(),JT(),eC()}}function ZT(){if(Ln===1){Ln=0;var s=ms,l=Ql,f=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||f){f=q.T,q.T=null;var m=Y.p;Y.p=2;var _=Nt;Nt|=4;try{kT(l,s);var x=D0,M=LE(s.containerInfo),U=x.focusedElem,K=x.selectionRange;if(M!==U&&U&&U.ownerDocument&&FE(U.ownerDocument.documentElement,U)){if(K!==null&&ny(U)){var ae=K.start,me=K.end;if(me===void 0&&(me=ae),"selectionStart"in U)U.selectionStart=ae,U.selectionEnd=Math.min(me,U.value.length);else{var be=U.ownerDocument||document,se=be&&be.defaultView||window;if(se.getSelection){var de=se.getSelection(),Ve=U.textContent.length,Ke=Math.min(K.start,Ve),Gt=K.end===void 0?Ke:Math.min(K.end,Ve);!de.extend&&Ke>Gt&&(M=Gt,Gt=Ke,Ke=M);var te=VE(U,Ke),$=VE(U,Gt);if(te&&$&&(de.rangeCount!==1||de.anchorNode!==te.node||de.anchorOffset!==te.offset||de.focusNode!==$.node||de.focusOffset!==$.offset)){var ie=be.createRange();ie.setStart(te.node,te.offset),de.removeAllRanges(),Ke>Gt?(de.addRange(ie),de.extend($.node,$.offset)):(ie.setEnd($.node,$.offset),de.addRange(ie))}}}}for(be=[],de=U;de=de.parentNode;)de.nodeType===1&&be.push({element:de,left:de.scrollLeft,top:de.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<be.length;U++){var ye=be[U];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}gm=!!N0,D0=N0=null}finally{Nt=_,Y.p=m,q.T=f}}s.current=l,Ln=2}}function JT(){if(Ln===2){Ln=0;var s=ms,l=Ql,f=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||f){f=q.T,q.T=null;var m=Y.p;Y.p=2;var _=Nt;Nt|=4;try{AT(s,l.alternate,l)}finally{Nt=_,Y.p=m,q.T=f}}Ln=3}}function eC(){if(Ln===4||Ln===3){Ln=0,Lr();var s=ms,l=Ql,f=To,m=jT;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Ln=5:(Ln=0,Ql=ms=null,tC(s,s.pendingLanes));var _=s.pendingLanes;if(_===0&&(ps=null),oo(f),l=l.stateNode,pn&&typeof pn.onCommitFiberRoot=="function")try{pn.onCommitFiberRoot(Mr,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=q.T,_=Y.p,Y.p=2,q.T=null;try{for(var x=s.onRecoverableError,M=0;M<m.length;M++){var U=m[M];x(U.value,{componentStack:U.stack})}}finally{q.T=l,Y.p=_}}(To&3)!==0&&im(),Oa(s),_=s.pendingLanes,(f&261930)!==0&&(_&42)!==0?s===v0?sf++:(sf=0,v0=s):sf=0,uf(0)}}function tC(s,l){(s.pooledCacheLanes&=l)===0&&(l=s.pooledCache,l!=null&&(s.pooledCache=null,Uh(l)))}function im(){return ZT(),JT(),eC(),nC()}function nC(){if(Ln!==5)return!1;var s=ms,l=m0;m0=0;var f=oo(To),m=q.T,_=Y.p;try{Y.p=32>f?32:f,q.T=null,f=g0,g0=null;var x=ms,M=To;if(Ln=0,Ql=ms=null,To=0,(Nt&6)!==0)throw Error(r(331));var U=Nt;if(Nt|=4,FT(x.current),OT(x,x.current,M,f),Nt=U,uf(0,!1),pn&&typeof pn.onPostCommitFiberRoot=="function")try{pn.onPostCommitFiberRoot(Mr,x)}catch{}return!0}finally{Y.p=_,q.T=m,tC(s,l)}}function rC(s,l,f){l=Si(f,l),l=Yy(s.stateNode,l,2),s=us(s,l,2),s!==null&&(uu(s,2),Oa(s))}function Bt(s,l,f){if(s.tag===3)rC(s,s,f);else for(;l!==null;){if(l.tag===3){rC(l,s,f);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ps===null||!ps.has(m))){s=Si(f,s),f=iT(2),m=us(l,f,2),m!==null&&(aT(f,m,l,s),uu(m,2),Oa(m));break}}l=l.return}}function b0(s,l,f){var m=s.pingCache;if(m===null){m=s.pingCache=new gV;var _=new Set;m.set(l,_)}else _=m.get(l),_===void 0&&(_=new Set,m.set(l,_));_.has(f)||(f0=!0,_.add(f),s=xV.bind(null,s,l,f),l.then(s,s))}function xV(s,l,f){var m=s.pingCache;m!==null&&m.delete(l),s.pingedLanes|=s.suspendedLanes&f,s.warmLanes&=~f,Wt===s&&(gt&f)===f&&(hn===4||hn===3&&(gt&62914560)===gt&&300>ln()-Zp?(Nt&2)===0&&Zl(s,0):d0|=f,$l===gt&&($l=0)),Oa(s)}function iC(s,l){l===0&&(l=ep()),s=wu(s,l),s!==null&&(uu(s,l),Oa(s))}function wV(s){var l=s.memoizedState,f=0;l!==null&&(f=l.retryLane),iC(s,f)}function EV(s,l){var f=0;switch(s.tag){case 31:case 13:var m=s.stateNode,_=s.memoizedState;_!==null&&(f=_.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(l),iC(s,f)}function TV(s,l){return Vt(s,l)}var am=null,ec=null,x0=!1,om=!1,w0=!1,vs=0;function Oa(s){s!==ec&&s.next===null&&(ec===null?am=ec=s:ec=ec.next=s),om=!0,x0||(x0=!0,SV())}function uf(s,l){if(!w0&&om){w0=!0;do for(var f=!1,m=am;m!==null;){if(s!==0){var _=m.pendingLanes;if(_===0)var x=0;else{var M=m.suspendedLanes,U=m.pingedLanes;x=(1<<31-mn(42|s)+1)-1,x&=_&~(M&~U),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(f=!0,uC(m,x))}else x=gt,x=ga(m,m===Wt?x:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(x&3)===0||Hi(m,x)||(f=!0,uC(m,x));m=m.next}while(f);w0=!1}}function CV(){aC()}function aC(){om=x0=!1;var s=0;vs!==0&&VV()&&(s=vs);for(var l=ln(),f=null,m=am;m!==null;){var _=m.next,x=oC(m,l);x===0?(m.next=null,f===null?am=_:f.next=_,_===null&&(ec=f)):(f=m,(s!==0||(x&3)!==0)&&(om=!0)),m=_}Ln!==0&&Ln!==5||uf(s),vs!==0&&(vs=0)}function oC(s,l){for(var f=s.suspendedLanes,m=s.pingedLanes,_=s.expirationTimes,x=s.pendingLanes&-62914561;0<x;){var M=31-mn(x),U=1<<M,K=_[M];K===-1?((U&f)===0||(U&m)!==0)&&(_[M]=Qv(U,l)):K<=l&&(s.expiredLanes|=U),x&=~U}if(l=Wt,f=gt,f=ga(s,s===l?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,f===0||s===l&&(Lt===2||Lt===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&Xn(m),s.callbackNode=null,s.callbackPriority=0;if((f&3)===0||Hi(s,f)){if(l=f&-f,l===s.callbackPriority)return l;switch(m!==null&&Xn(m),oo(f)){case 2:case 8:f=bi;break;case 32:f=Fn;break;case 268435456:f=ml;break;default:f=Fn}return m=sC.bind(null,s),f=Vt(f,m),s.callbackPriority=l,s.callbackNode=f,l}return m!==null&&m!==null&&Xn(m),s.callbackPriority=2,s.callbackNode=null,2}function sC(s,l){if(Ln!==0&&Ln!==5)return s.callbackNode=null,s.callbackPriority=0,null;var f=s.callbackNode;if(im()&&s.callbackNode!==f)return null;var m=gt;return m=ga(s,s===Wt?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(zT(s,m,l),oC(s,ln()),s.callbackNode!=null&&s.callbackNode===f?sC.bind(null,s):null)}function uC(s,l){if(im())return null;zT(s,l,!0)}function SV(){LV(function(){(Nt&6)!==0?Vt(ao,CV):aC()})}function E0(){if(vs===0){var s=Bl;s===0&&(s=pa,pa<<=1,(pa&261888)===0&&(pa=256)),vs=s}return vs}function lC(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Tl(""+s)}function cC(s,l){var f=l.ownerDocument.createElement("input");return f.name=l.name,f.value=l.value,s.id&&f.setAttribute("form",s.id),l.parentNode.insertBefore(f,l),s=new FormData(s),f.parentNode.removeChild(f),s}function AV(s,l,f,m,_){if(l==="submit"&&f&&f.stateNode===_){var x=lC((_[Yn]||null).action),M=m.submitter;M&&(l=(l=M[Yn]||null)?lC(l.formAction):M.getAttribute("formAction"),l!==null&&(x=l,M=null));var U=new Aa("action","action",null,m,_);s.push({event:U,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(vs!==0){var K=M?cC(_,M):new FormData(_);Gy(f,{pending:!0,data:K,method:_.method,action:x},null,K)}}else typeof x=="function"&&(U.preventDefault(),K=M?cC(_,M):new FormData(_),Gy(f,{pending:!0,data:K,method:_.method,action:x},x,K))},currentTarget:_}]})}}for(var T0=0;T0<oy.length;T0++){var C0=oy[T0],RV=C0.toLowerCase(),IV=C0[0].toUpperCase()+C0.slice(1);Zi(RV,"on"+IV)}Zi(UE,"onAnimationEnd"),Zi(zE,"onAnimationIteration"),Zi(GE,"onAnimationStart"),Zi("dblclick","onDoubleClick"),Zi("focusin","onFocus"),Zi("focusout","onBlur"),Zi(WP,"onTransitionRun"),Zi(qP,"onTransitionStart"),Zi(KP,"onTransitionCancel"),Zi(HE,"onTransitionEnd"),Ea("onMouseEnter",["mouseout","mouseover"]),Ea("onMouseLeave",["mouseout","mouseover"]),Ea("onPointerEnter",["pointerout","pointerover"]),Ea("onPointerLeave",["pointerout","pointerover"]),wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),wa("onBeforeInput",["compositionend","keypress","textInput","paste"]),wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),NV=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(lf));function hC(s,l){l=(l&4)!==0;for(var f=0;f<s.length;f++){var m=s[f],_=m.event;m=m.listeners;e:{var x=void 0;if(l)for(var M=m.length-1;0<=M;M--){var U=m[M],K=U.instance,ae=U.currentTarget;if(U=U.listener,K!==x&&_.isPropagationStopped())break e;x=U,_.currentTarget=ae;try{x(_)}catch(me){xp(me)}_.currentTarget=null,x=K}else for(M=0;M<m.length;M++){if(U=m[M],K=U.instance,ae=U.currentTarget,U=U.listener,K!==x&&_.isPropagationStopped())break e;x=U,_.currentTarget=ae;try{x(_)}catch(me){xp(me)}_.currentTarget=null,x=K}}}}function pt(s,l){var f=l[_l];f===void 0&&(f=l[_l]=new Set);var m=s+"__bubble";f.has(m)||(fC(l,s,2,!1),f.add(m))}function S0(s,l,f){var m=0;l&&(m|=4),fC(f,s,m,l)}var sm="_reactListening"+Math.random().toString(36).slice(2);function A0(s){if(!s[sm]){s[sm]=!0,bh.forEach(function(f){f!=="selectionchange"&&(NV.has(f)||S0(f,!1,s),S0(f,!0,s))});var l=s.nodeType===9?s:s.ownerDocument;l===null||l[sm]||(l[sm]=!0,S0("selectionchange",!1,l))}}function fC(s,l,f,m){switch(UC(l)){case 2:var _=iF;break;case 8:_=aF;break;default:_=z0}f=_.bind(null,l,f,s),_=void 0,!pu||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(_=!0),m?_!==void 0?s.addEventListener(l,f,{capture:!0,passive:_}):s.addEventListener(l,f,!0):_!==void 0?s.addEventListener(l,f,{passive:_}):s.addEventListener(l,f,!1)}function R0(s,l,f,m,_){var x=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var M=m.tag;if(M===3||M===4){var U=m.stateNode.containerInfo;if(U===_)break;if(M===4)for(M=m.return;M!==null;){var K=M.tag;if((K===3||K===4)&&M.stateNode.containerInfo===_)return;M=M.return}for(;U!==null;){if(M=ba(U),M===null)return;if(K=M.tag,K===5||K===6||K===26||K===27){m=x=M;continue e}U=U.parentNode}}m=m.return}Zo(function(){var ae=x,me=wi(f),be=[];e:{var se=WE.get(s);if(se!==void 0){var de=Aa,Ve=s;switch(s){case"keypress":if(gu(f)===0)break e;case"keydown":case"keyup":de=yp;break;case"focusin":Ve="focus",de=yu;break;case"focusout":Ve="blur",de=yu;break;case"beforeblur":case"afterblur":de=yu;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=Mh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=lp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=A;break;case UE:case zE:case GE:de=hp;break;case HE:de=G;break;case"scroll":case"scrollend":de=kh;break;case"wheel":de=he;break;case"copy":case"cut":case"paste":de=fp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=lo;break;case"toggle":case"beforetoggle":de=st}var Ke=(l&4)!==0,Gt=!Ke&&(s==="scroll"||s==="scrollend"),te=Ke?se!==null?se+"Capture":null:se;Ke=[];for(var $=ae,ie;$!==null;){var ye=$;if(ie=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||ie===null||te===null||(ye=Xi($,te),ye!=null&&Ke.push(cf($,ye,ie))),Gt)break;$=$.return}0<Ke.length&&(se=new de(se,Ve,null,f,me),be.push({event:se,listeners:Ke}))}}if((l&7)===0){e:{if(se=s==="mouseover"||s==="pointerover",de=s==="mouseout"||s==="pointerout",se&&f!==Ih&&(Ve=f.relatedTarget||f.fromElement)&&(ba(Ve)||Ve[ya]))break e;if((de||se)&&(se=me.window===me?me:(se=me.ownerDocument)?se.defaultView||se.parentWindow:window,de?(Ve=f.relatedTarget||f.toElement,de=ae,Ve=Ve?ba(Ve):null,Ve!==null&&(Gt=a(Ve),Ke=Ve.tag,Ve!==Gt||Ke!==5&&Ke!==27&&Ke!==6)&&(Ve=null)):(de=null,Ve=ae),de!==Ve)){if(Ke=Mh,ye="onMouseLeave",te="onMouseEnter",$="mouse",(s==="pointerout"||s==="pointerover")&&(Ke=lo,ye="onPointerLeave",te="onPointerEnter",$="pointer"),Gt=de==null?se:ti(de),ie=Ve==null?se:ti(Ve),se=new Ke(ye,$+"leave",de,f,me),se.target=Gt,se.relatedTarget=ie,ye=null,ba(me)===ae&&(Ke=new Ke(te,$+"enter",Ve,f,me),Ke.target=ie,Ke.relatedTarget=Gt,ye=Ke),Gt=ye,de&&Ve)t:{for(Ke=DV,te=de,$=Ve,ie=0,ye=te;ye;ye=Ke(ye))ie++;ye=0;for(var He=$;He;He=Ke(He))ye++;for(;0<ie-ye;)te=Ke(te),ie--;for(;0<ye-ie;)$=Ke($),ye--;for(;ie--;){if(te===$||$!==null&&te===$.alternate){Ke=te;break t}te=Ke(te),$=Ke($)}Ke=null}else Ke=null;de!==null&&dC(be,se,de,Ke,!1),Ve!==null&&Gt!==null&&dC(be,Gt,Ve,Ke,!0)}}e:{if(se=ae?ti(ae):window,de=se.nodeName&&se.nodeName.toLowerCase(),de==="select"||de==="input"&&se.type==="file")var At=NE;else if(RE(se))if(DE)At=zP;else{At=jP;var Be=BP}else de=se.nodeName,!de||de.toLowerCase()!=="input"||se.type!=="checkbox"&&se.type!=="radio"?ae&&El(ae.elementType)&&(At=NE):At=UP;if(At&&(At=At(s,ae))){IE(be,At,f,me);break e}Be&&Be(s,se,ae),s==="focusout"&&ae&&se.type==="number"&&ae.memoizedProps.value!=null&&Sh(se,"number",se.value)}switch(Be=ae?ti(ae):window,s){case"focusin":(RE(Be)||Be.contentEditable==="true")&&(Dl=Be,ry=ae,Lh=null);break;case"focusout":Lh=ry=Dl=null;break;case"mousedown":iy=!0;break;case"contextmenu":case"mouseup":case"dragend":iy=!1,BE(be,f,me);break;case"selectionchange":if(HP)break;case"keydown":case"keyup":BE(be,f,me)}var ct;if(It)e:{switch(s){case"compositionstart":var vt="onCompositionStart";break e;case"compositionend":vt="onCompositionEnd";break e;case"compositionupdate":vt="onCompositionUpdate";break e}vt=void 0}else Nl?_u(s,f)&&(vt="onCompositionEnd"):s==="keydown"&&f.keyCode===229&&(vt="onCompositionStart");vt&&(Na&&f.locale!=="ko"&&(Nl||vt!=="onCompositionStart"?vt==="onCompositionEnd"&&Nl&&(ct=Dh()):(Sa=me,Nh="value"in Sa?Sa.value:Sa.textContent,Nl=!0)),Be=um(ae,vt),0<Be.length&&(vt=new Ia(vt,s,null,f,me),be.push({event:vt,listeners:Be}),ct?vt.data=ct:(ct=Il(f),ct!==null&&(vt.data=ct)))),(ct=Ti?PP(s,f):VP(s,f))&&(vt=um(ae,"onBeforeInput"),0<vt.length&&(Be=new Ia("onBeforeInput","beforeinput",null,f,me),be.push({event:Be,listeners:vt}),Be.data=ct)),AV(be,s,ae,f,me)}hC(be,l)})}function cf(s,l,f){return{instance:s,listener:l,currentTarget:f}}function um(s,l){for(var f=l+"Capture",m=[];s!==null;){var _=s,x=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||x===null||(_=Xi(s,f),_!=null&&m.unshift(cf(s,_,x)),_=Xi(s,l),_!=null&&m.push(cf(s,_,x))),s.tag===3)return m;s=s.return}return[]}function DV(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function dC(s,l,f,m,_){for(var x=l._reactName,M=[];f!==null&&f!==m;){var U=f,K=U.alternate,ae=U.stateNode;if(U=U.tag,K!==null&&K===m)break;U!==5&&U!==26&&U!==27||ae===null||(K=ae,_?(ae=Xi(f,x),ae!=null&&M.unshift(cf(f,ae,K))):_||(ae=Xi(f,x),ae!=null&&M.push(cf(f,ae,K)))),f=f.return}M.length!==0&&s.push({event:l,listeners:M})}var kV=/\r\n?/g,MV=/\u0000|\uFFFD/g;function pC(s){return(typeof s=="string"?s:""+s).replace(kV,`
`).replace(MV,"")}function mC(s,l){return l=pC(l),pC(s)===l}function zt(s,l,f,m,_,x){switch(f){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||jr(s,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&jr(s,""+m);break;case"className":ni(s,"class",m);break;case"tabIndex":ni(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":ni(s,f,m);break;case"style":Rh(s,m,x);break;case"data":if(l!=="object"){ni(s,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||f!=="href")){s.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(f);break}m=Tl(""+m),s.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(f==="formAction"?(l!=="input"&&zt(s,l,"name",_.name,_,null),zt(s,l,"formEncType",_.formEncType,_,null),zt(s,l,"formMethod",_.formMethod,_,null),zt(s,l,"formTarget",_.formTarget,_,null)):(zt(s,l,"encType",_.encType,_,null),zt(s,l,"method",_.method,_,null),zt(s,l,"target",_.target,_,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(f);break}m=Tl(""+m),s.setAttribute(f,m);break;case"onClick":m!=null&&(s.onclick=Ki);break;case"onScroll":m!=null&&pt("scroll",s);break;case"onScrollEnd":m!=null&&pt("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(f=m.__html,f!=null){if(_.children!=null)throw Error(r(60));s.innerHTML=f}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}f=Tl(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(f,""+m):s.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(f,""):s.removeAttribute(f);break;case"capture":case"download":m===!0?s.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(f,m):s.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(f,m):s.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(f):s.setAttribute(f,m);break;case"popover":pt("beforetoggle",s),pt("toggle",s),xl(s,"popover",m);break;case"xlinkActuate":Cn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Cn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Cn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Cn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Cn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Cn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Cn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Cn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Cn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":xl(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=up.get(f)||f,xl(s,f,m))}}function I0(s,l,f,m,_,x){switch(f){case"style":Rh(s,m,x);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(f=m.__html,f!=null){if(_.children!=null)throw Error(r(60));s.innerHTML=f}}break;case"children":typeof m=="string"?jr(s,m):(typeof m=="number"||typeof m=="bigint")&&jr(s,""+m);break;case"onScroll":m!=null&&pt("scroll",s);break;case"onScrollEnd":m!=null&&pt("scrollend",s);break;case"onClick":m!=null&&(s.onclick=Ki);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xh.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(_=f.endsWith("Capture"),l=f.slice(2,_?f.length-7:void 0),x=s[Yn]||null,x=x!=null?x[f]:null,typeof x=="function"&&s.removeEventListener(l,x,_),typeof m=="function")){typeof x!="function"&&x!==null&&(f in s?s[f]=null:s.hasAttribute(f)&&s.removeAttribute(f)),s.addEventListener(l,m,_);break e}f in s?s[f]=m:m===!0?s.setAttribute(f,""):xl(s,f,m)}}}function cr(s,l,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pt("error",s),pt("load",s);var m=!1,_=!1,x;for(x in f)if(f.hasOwnProperty(x)){var M=f[x];if(M!=null)switch(x){case"src":m=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,l));default:zt(s,l,x,M,f,null)}}_&&zt(s,l,"srcSet",f.srcSet,f,null),m&&zt(s,l,"src",f.src,f,null);return;case"input":pt("invalid",s);var U=x=M=_=null,K=null,ae=null;for(m in f)if(f.hasOwnProperty(m)){var me=f[m];if(me!=null)switch(m){case"name":_=me;break;case"type":M=me;break;case"checked":K=me;break;case"defaultChecked":ae=me;break;case"value":x=me;break;case"defaultValue":U=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,l));break;default:zt(s,l,m,me,f,null)}}ap(s,x,U,K,ae,M,_,!1);return;case"select":pt("invalid",s),m=M=x=null;for(_ in f)if(f.hasOwnProperty(_)&&(U=f[_],U!=null))switch(_){case"value":x=U;break;case"defaultValue":M=U;break;case"multiple":m=U;default:zt(s,l,_,U,f,null)}l=x,f=M,s.multiple=!!m,l!=null?Xo(s,!!m,l,!1):f!=null&&Xo(s,!!m,f,!0);return;case"textarea":pt("invalid",s),x=_=m=null;for(M in f)if(f.hasOwnProperty(M)&&(U=f[M],U!=null))switch(M){case"value":m=U;break;case"defaultValue":_=U;break;case"children":x=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(r(91));break;default:zt(s,l,M,U,f,null)}Yo(s,m,_,x);return;case"option":for(K in f)f.hasOwnProperty(K)&&(m=f[K],m!=null)&&(K==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":zt(s,l,K,m,f,null));return;case"dialog":pt("beforetoggle",s),pt("toggle",s),pt("cancel",s),pt("close",s);break;case"iframe":case"object":pt("load",s);break;case"video":case"audio":for(m=0;m<lf.length;m++)pt(lf[m],s);break;case"image":pt("error",s),pt("load",s);break;case"details":pt("toggle",s);break;case"embed":case"source":case"link":pt("error",s),pt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ae in f)if(f.hasOwnProperty(ae)&&(m=f[ae],m!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,l));default:zt(s,l,ae,m,f,null)}return;default:if(El(l)){for(me in f)f.hasOwnProperty(me)&&(m=f[me],m!==void 0&&I0(s,l,me,m,f,void 0));return}}for(U in f)f.hasOwnProperty(U)&&(m=f[U],m!=null&&zt(s,l,U,m,f,null))}function OV(s,l,f,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,x=null,M=null,U=null,K=null,ae=null,me=null;for(de in f){var be=f[de];if(f.hasOwnProperty(de)&&be!=null)switch(de){case"checked":break;case"value":break;case"defaultValue":K=be;default:m.hasOwnProperty(de)||zt(s,l,de,null,m,be)}}for(var se in m){var de=m[se];if(be=f[se],m.hasOwnProperty(se)&&(de!=null||be!=null))switch(se){case"type":x=de;break;case"name":_=de;break;case"checked":ae=de;break;case"defaultChecked":me=de;break;case"value":M=de;break;case"defaultValue":U=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,l));break;default:de!==be&&zt(s,l,se,de,m,be)}}wl(s,M,U,K,ae,me,x,_);return;case"select":de=M=U=se=null;for(x in f)if(K=f[x],f.hasOwnProperty(x)&&K!=null)switch(x){case"value":break;case"multiple":de=K;default:m.hasOwnProperty(x)||zt(s,l,x,null,m,K)}for(_ in m)if(x=m[_],K=f[_],m.hasOwnProperty(_)&&(x!=null||K!=null))switch(_){case"value":se=x;break;case"defaultValue":U=x;break;case"multiple":M=x;default:x!==K&&zt(s,l,_,x,m,K)}l=U,f=M,m=de,se!=null?Xo(s,!!f,se,!1):!!m!=!!f&&(l!=null?Xo(s,!!f,l,!0):Xo(s,!!f,f?[]:"",!1));return;case"textarea":de=se=null;for(U in f)if(_=f[U],f.hasOwnProperty(U)&&_!=null&&!m.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:zt(s,l,U,null,m,_)}for(M in m)if(_=m[M],x=f[M],m.hasOwnProperty(M)&&(_!=null||x!=null))switch(M){case"value":se=_;break;case"defaultValue":de=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(r(91));break;default:_!==x&&zt(s,l,M,_,m,x)}op(s,se,de);return;case"option":for(var Ve in f)se=f[Ve],f.hasOwnProperty(Ve)&&se!=null&&!m.hasOwnProperty(Ve)&&(Ve==="selected"?s.selected=!1:zt(s,l,Ve,null,m,se));for(K in m)se=m[K],de=f[K],m.hasOwnProperty(K)&&se!==de&&(se!=null||de!=null)&&(K==="selected"?s.selected=se&&typeof se!="function"&&typeof se!="symbol":zt(s,l,K,se,m,de));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in f)se=f[Ke],f.hasOwnProperty(Ke)&&se!=null&&!m.hasOwnProperty(Ke)&&zt(s,l,Ke,null,m,se);for(ae in m)if(se=m[ae],de=f[ae],m.hasOwnProperty(ae)&&se!==de&&(se!=null||de!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(r(137,l));break;default:zt(s,l,ae,se,m,de)}return;default:if(El(l)){for(var Gt in f)se=f[Gt],f.hasOwnProperty(Gt)&&se!==void 0&&!m.hasOwnProperty(Gt)&&I0(s,l,Gt,void 0,m,se);for(me in m)se=m[me],de=f[me],!m.hasOwnProperty(me)||se===de||se===void 0&&de===void 0||I0(s,l,me,se,m,de);return}}for(var te in f)se=f[te],f.hasOwnProperty(te)&&se!=null&&!m.hasOwnProperty(te)&&zt(s,l,te,null,m,se);for(be in m)se=m[be],de=f[be],!m.hasOwnProperty(be)||se===de||se==null&&de==null||zt(s,l,be,se,m,de)}function gC(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function PV(){if(typeof performance.getEntriesByType=="function"){for(var s=0,l=0,f=performance.getEntriesByType("resource"),m=0;m<f.length;m++){var _=f[m],x=_.transferSize,M=_.initiatorType,U=_.duration;if(x&&U&&gC(M)){for(M=0,U=_.responseEnd,m+=1;m<f.length;m++){var K=f[m],ae=K.startTime;if(ae>U)break;var me=K.transferSize,be=K.initiatorType;me&&gC(be)&&(K=K.responseEnd,M+=me*(K<U?1:(U-ae)/(K-ae)))}if(--m,l+=8*(x+M)/(_.duration/1e3),s++,10<s)break}}if(0<s)return l/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var N0=null,D0=null;function lm(s){return s.nodeType===9?s:s.ownerDocument}function vC(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yC(s,l){if(s===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&l==="foreignObject"?0:s}function k0(s,l){return s==="textarea"||s==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var M0=null;function VV(){var s=window.event;return s&&s.type==="popstate"?s===M0?!1:(M0=s,!0):(M0=null,!1)}var _C=typeof setTimeout=="function"?setTimeout:void 0,FV=typeof clearTimeout=="function"?clearTimeout:void 0,bC=typeof Promise=="function"?Promise:void 0,LV=typeof queueMicrotask=="function"?queueMicrotask:typeof bC<"u"?function(s){return bC.resolve(null).then(s).catch(BV)}:_C;function BV(s){setTimeout(function(){throw s})}function ys(s){return s==="head"}function xC(s,l){var f=l,m=0;do{var _=f.nextSibling;if(s.removeChild(f),_&&_.nodeType===8)if(f=_.data,f==="/$"||f==="/&"){if(m===0){s.removeChild(_),ic(l);return}m--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")m++;else if(f==="html")hf(s.ownerDocument.documentElement);else if(f==="head"){f=s.ownerDocument.head,hf(f);for(var x=f.firstChild;x;){var M=x.nextSibling,U=x.nodeName;x[_a]||U==="SCRIPT"||U==="STYLE"||U==="LINK"&&x.rel.toLowerCase()==="stylesheet"||f.removeChild(x),x=M}}else f==="body"&&hf(s.ownerDocument.body);f=_}while(f);ic(l)}function wC(s,l){var f=s;s=0;do{var m=f.nextSibling;if(f.nodeType===1?l?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(l?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),m&&m.nodeType===8)if(f=m.data,f==="/$"){if(s===0)break;s--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||s++;f=m}while(f)}function O0(s){var l=s.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var f=l;switch(l=l.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":O0(f),bl(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}s.removeChild(f)}}function jV(s,l,f,m){for(;s.nodeType===1;){var _=f;if(s.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[_a])switch(l){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(x=s.getAttribute("rel"),x==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(x!==_.rel||s.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||s.getAttribute("title")!==(_.title==null?null:_.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(x=s.getAttribute("src"),(x!==(_.src==null?null:_.src)||s.getAttribute("type")!==(_.type==null?null:_.type)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&x&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(l==="input"&&s.type==="hidden"){var x=_.name==null?null:""+_.name;if(_.type==="hidden"&&s.getAttribute("name")===x)return s}else return s;if(s=Di(s.nextSibling),s===null)break}return null}function UV(s,l,f){if(l==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!f||(s=Di(s.nextSibling),s===null))return null;return s}function EC(s,l){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=Di(s.nextSibling),s===null))return null;return s}function P0(s){return s.data==="$?"||s.data==="$~"}function V0(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function zV(s,l){var f=s.ownerDocument;if(s.data==="$~")s._reactRetry=l;else if(s.data!=="$?"||f.readyState!=="loading")l();else{var m=function(){l(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function Di(s){for(;s!=null;s=s.nextSibling){var l=s.nodeType;if(l===1||l===3)break;if(l===8){if(l=s.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return s}var F0=null;function TC(s){s=s.nextSibling;for(var l=0;s;){if(s.nodeType===8){var f=s.data;if(f==="/$"||f==="/&"){if(l===0)return Di(s.nextSibling);l--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||l++}s=s.nextSibling}return null}function CC(s){s=s.previousSibling;for(var l=0;s;){if(s.nodeType===8){var f=s.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(l===0)return s;l--}else f!=="/$"&&f!=="/&"||l++}s=s.previousSibling}return null}function SC(s,l,f){switch(l=lm(f),s){case"html":if(s=l.documentElement,!s)throw Error(r(452));return s;case"head":if(s=l.head,!s)throw Error(r(453));return s;case"body":if(s=l.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function hf(s){for(var l=s.attributes;l.length;)s.removeAttributeNode(l[0]);bl(s)}var ki=new Map,AC=new Set;function cm(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Co=Y.d;Y.d={f:GV,r:HV,D:WV,C:qV,L:KV,m:XV,X:$V,S:YV,M:QV};function GV(){var s=Co.f(),l=tm();return s||l}function HV(s){var l=xi(s);l!==null&&l.tag===5&&l.type==="form"?H2(l):Co.r(s)}var tc=typeof document>"u"?null:document;function RC(s,l,f){var m=tc;if(m&&typeof l=="string"&&l){var _=Br(l);_='link[rel="'+s+'"][href="'+_+'"]',typeof f=="string"&&(_+='[crossorigin="'+f+'"]'),AC.has(_)||(AC.add(_),s={rel:s,crossOrigin:f,href:l},m.querySelector(_)===null&&(l=m.createElement("link"),cr(l,"link",s),Tn(l),m.head.appendChild(l)))}}function WV(s){Co.D(s),RC("dns-prefetch",s,null)}function qV(s,l){Co.C(s,l),RC("preconnect",s,l)}function KV(s,l,f){Co.L(s,l,f);var m=tc;if(m&&s&&l){var _='link[rel="preload"][as="'+Br(l)+'"]';l==="image"&&f&&f.imageSrcSet?(_+='[imagesrcset="'+Br(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(_+='[imagesizes="'+Br(f.imageSizes)+'"]')):_+='[href="'+Br(s)+'"]';var x=_;switch(l){case"style":x=nc(s);break;case"script":x=rc(s)}ki.has(x)||(s=p({rel:"preload",href:l==="image"&&f&&f.imageSrcSet?void 0:s,as:l},f),ki.set(x,s),m.querySelector(_)!==null||l==="style"&&m.querySelector(ff(x))||l==="script"&&m.querySelector(df(x))||(l=m.createElement("link"),cr(l,"link",s),Tn(l),m.head.appendChild(l)))}}function XV(s,l){Co.m(s,l);var f=tc;if(f&&s){var m=l&&typeof l.as=="string"?l.as:"script",_='link[rel="modulepreload"][as="'+Br(m)+'"][href="'+Br(s)+'"]',x=_;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=rc(s)}if(!ki.has(x)&&(s=p({rel:"modulepreload",href:s},l),ki.set(x,s),f.querySelector(_)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(df(x)))return}m=f.createElement("link"),cr(m,"link",s),Tn(m),f.head.appendChild(m)}}}function YV(s,l,f){Co.S(s,l,f);var m=tc;if(m&&s){var _=xa(m).hoistableStyles,x=nc(s);l=l||"default";var M=_.get(x);if(!M){var U={loading:0,preload:null};if(M=m.querySelector(ff(x)))U.loading=5;else{s=p({rel:"stylesheet",href:s,"data-precedence":l},f),(f=ki.get(x))&&L0(s,f);var K=M=m.createElement("link");Tn(K),cr(K,"link",s),K._p=new Promise(function(ae,me){K.onload=ae,K.onerror=me}),K.addEventListener("load",function(){U.loading|=1}),K.addEventListener("error",function(){U.loading|=2}),U.loading|=4,hm(M,l,m)}M={type:"stylesheet",instance:M,count:1,state:U},_.set(x,M)}}}function $V(s,l){Co.X(s,l);var f=tc;if(f&&s){var m=xa(f).hoistableScripts,_=rc(s),x=m.get(_);x||(x=f.querySelector(df(_)),x||(s=p({src:s,async:!0},l),(l=ki.get(_))&&B0(s,l),x=f.createElement("script"),Tn(x),cr(x,"link",s),f.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},m.set(_,x))}}function QV(s,l){Co.M(s,l);var f=tc;if(f&&s){var m=xa(f).hoistableScripts,_=rc(s),x=m.get(_);x||(x=f.querySelector(df(_)),x||(s=p({src:s,async:!0,type:"module"},l),(l=ki.get(_))&&B0(s,l),x=f.createElement("script"),Tn(x),cr(x,"link",s),f.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},m.set(_,x))}}function IC(s,l,f,m){var _=(_=Ae.current)?cm(_):null;if(!_)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(l=nc(f.href),f=xa(_).hoistableStyles,m=f.get(l),m||(m={type:"style",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){s=nc(f.href);var x=xa(_).hoistableStyles,M=x.get(s);if(M||(_=_.ownerDocument||_,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(s,M),(x=_.querySelector(ff(s)))&&!x._p&&(M.instance=x,M.state.loading=5),ki.has(s)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},ki.set(s,f),x||ZV(_,s,f,M.state))),l&&m===null)throw Error(r(528,""));return M}if(l&&m!==null)throw Error(r(529,""));return null;case"script":return l=f.async,f=f.src,typeof f=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=rc(f),f=xa(_).hoistableScripts,m=f.get(l),m||(m={type:"script",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function nc(s){return'href="'+Br(s)+'"'}function ff(s){return'link[rel="stylesheet"]['+s+"]"}function NC(s){return p({},s,{"data-precedence":s.precedence,precedence:null})}function ZV(s,l,f,m){s.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=s.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),cr(l,"link",f),Tn(l),s.head.appendChild(l))}function rc(s){return'[src="'+Br(s)+'"]'}function df(s){return"script[async]"+s}function DC(s,l,f){if(l.count++,l.instance===null)switch(l.type){case"style":var m=s.querySelector('style[data-href~="'+Br(f.href)+'"]');if(m)return l.instance=m,Tn(m),m;var _=p({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),Tn(m),cr(m,"style",_),hm(m,f.precedence,s),l.instance=m;case"stylesheet":_=nc(f.href);var x=s.querySelector(ff(_));if(x)return l.state.loading|=4,l.instance=x,Tn(x),x;m=NC(f),(_=ki.get(_))&&L0(m,_),x=(s.ownerDocument||s).createElement("link"),Tn(x);var M=x;return M._p=new Promise(function(U,K){M.onload=U,M.onerror=K}),cr(x,"link",m),l.state.loading|=4,hm(x,f.precedence,s),l.instance=x;case"script":return x=rc(f.src),(_=s.querySelector(df(x)))?(l.instance=_,Tn(_),_):(m=f,(_=ki.get(x))&&(m=p({},f),B0(m,_)),s=s.ownerDocument||s,_=s.createElement("script"),Tn(_),cr(_,"link",m),s.head.appendChild(_),l.instance=_);case"void":return null;default:throw Error(r(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,hm(m,f.precedence,s));return l.instance}function hm(s,l,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=m.length?m[m.length-1]:null,x=_,M=0;M<m.length;M++){var U=m[M];if(U.dataset.precedence===l)x=U;else if(x!==_)break}x?x.parentNode.insertBefore(s,x.nextSibling):(l=f.nodeType===9?f.head:f,l.insertBefore(s,l.firstChild))}function L0(s,l){s.crossOrigin==null&&(s.crossOrigin=l.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=l.referrerPolicy),s.title==null&&(s.title=l.title)}function B0(s,l){s.crossOrigin==null&&(s.crossOrigin=l.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=l.referrerPolicy),s.integrity==null&&(s.integrity=l.integrity)}var fm=null;function kC(s,l,f){if(fm===null){var m=new Map,_=fm=new Map;_.set(f,m)}else _=fm,m=_.get(f),m||(m=new Map,_.set(f,m));if(m.has(s))return m;for(m.set(s,null),f=f.getElementsByTagName(s),_=0;_<f.length;_++){var x=f[_];if(!(x[_a]||x[En]||s==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var M=x.getAttribute(l)||"";M=s+M;var U=m.get(M);U?U.push(x):m.set(M,[x])}}return m}function MC(s,l,f){s=s.ownerDocument||s,s.head.insertBefore(f,l==="title"?s.querySelector("head > title"):null)}function JV(s,l,f){if(f===1||l.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;return l.rel==="stylesheet"?(s=l.disabled,typeof l.precedence=="string"&&s==null):!0;case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function OC(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function eF(s,l,f,m){if(f.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var _=nc(m.href),x=l.querySelector(ff(_));if(x){l=x._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(s.count++,s=dm.bind(s),l.then(s,s)),f.state.loading|=4,f.instance=x,Tn(x);return}x=l.ownerDocument||l,m=NC(m),(_=ki.get(_))&&L0(m,_),x=x.createElement("link"),Tn(x);var M=x;M._p=new Promise(function(U,K){M.onload=U,M.onerror=K}),cr(x,"link",m),f.instance=x}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(s.count++,f=dm.bind(s),l.addEventListener("load",f),l.addEventListener("error",f))}}var j0=0;function tF(s,l){return s.stylesheets&&s.count===0&&mm(s,s.stylesheets),0<s.count||0<s.imgCount?function(f){var m=setTimeout(function(){if(s.stylesheets&&mm(s,s.stylesheets),s.unsuspend){var x=s.unsuspend;s.unsuspend=null,x()}},6e4+l);0<s.imgBytes&&j0===0&&(j0=62500*PV());var _=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&mm(s,s.stylesheets),s.unsuspend)){var x=s.unsuspend;s.unsuspend=null,x()}},(s.imgBytes>j0?50:800)+l);return s.unsuspend=f,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(_)}}:null}function dm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mm(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var pm=null;function mm(s,l){s.stylesheets=null,s.unsuspend!==null&&(s.count++,pm=new Map,l.forEach(nF,s),pm=null,dm.call(s))}function nF(s,l){if(!(l.state.loading&4)){var f=pm.get(s);if(f)var m=f.get(null);else{f=new Map,pm.set(s,f);for(var _=s.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<_.length;x++){var M=_[x];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(f.set(M.dataset.precedence,M),m=M)}m&&f.set(null,m)}_=l.instance,M=_.getAttribute("data-precedence"),x=f.get(M)||m,x===m&&f.set(null,_),f.set(M,_),this.count++,m=dm.bind(this),_.addEventListener("load",m),_.addEventListener("error",m),x?x.parentNode.insertBefore(_,x.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(_,s.firstChild)),l.state.loading|=4}}var pf={$$typeof:I,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function rF(s,l,f,m,_,x,M,U,K){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=va(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=va(0),this.hiddenUpdates=va(null),this.identifierPrefix=m,this.onUncaughtError=_,this.onCaughtError=x,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function PC(s,l,f,m,_,x,M,U,K,ae,me,be){return s=new rF(s,l,f,M,K,ae,me,be,U),l=1,x===!0&&(l|=24),x=ii(3,null,null,l),s.current=x,x.stateNode=s,l=_y(),l.refCount++,s.pooledCache=l,l.refCount++,x.memoizedState={element:m,isDehydrated:f,cache:l},Ey(x),s}function VC(s){return s?(s=Ol,s):Ol}function FC(s,l,f,m,_,x){_=VC(_),m.context===null?m.context=_:m.pendingContext=_,m=ss(l),m.payload={element:f},x=x===void 0?null:x,x!==null&&(m.callback=x),f=us(s,m,l),f!==null&&(Wr(f,s,l),Wh(f,s,l))}function LC(s,l){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var f=s.retryLane;s.retryLane=f!==0&&f<l?f:l}}function U0(s,l){LC(s,l),(s=s.alternate)&&LC(s,l)}function BC(s){if(s.tag===13||s.tag===31){var l=wu(s,67108864);l!==null&&Wr(l,s,67108864),U0(s,67108864)}}function jC(s){if(s.tag===13||s.tag===31){var l=li();l=cu(l);var f=wu(s,l);f!==null&&Wr(f,s,l),U0(s,l)}}var gm=!0;function iF(s,l,f,m){var _=q.T;q.T=null;var x=Y.p;try{Y.p=2,z0(s,l,f,m)}finally{Y.p=x,q.T=_}}function aF(s,l,f,m){var _=q.T;q.T=null;var x=Y.p;try{Y.p=8,z0(s,l,f,m)}finally{Y.p=x,q.T=_}}function z0(s,l,f,m){if(gm){var _=G0(m);if(_===null)R0(s,l,m,vm,f),zC(s,m);else if(sF(_,s,l,f,m))m.stopPropagation();else if(zC(s,m),l&4&&-1<oF.indexOf(s)){for(;_!==null;){var x=xi(_);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var M=ma(x.pendingLanes);if(M!==0){var U=x;for(U.pendingLanes|=2,U.entangledLanes|=2;M;){var K=1<<31-mn(M);U.entanglements[1]|=K,M&=~K}Oa(x),(Nt&6)===0&&(Jp=ln()+500,uf(0))}}break;case 31:case 13:U=wu(x,2),U!==null&&Wr(U,x,2),tm(),U0(x,2)}if(x=G0(m),x===null&&R0(s,l,m,vm,f),x===_)break;_=x}_!==null&&m.stopPropagation()}else R0(s,l,m,null,f)}}function G0(s){return s=wi(s),H0(s)}var vm=null;function H0(s){if(vm=null,s=ba(s),s!==null){var l=a(s);if(l===null)s=null;else{var f=l.tag;if(f===13){if(s=o(l),s!==null)return s;s=null}else if(f===31){if(s=u(l),s!==null)return s;s=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;s=null}else l!==s&&(s=null)}}return vm=s,null}function UC(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ar()){case ao:return 2;case bi:return 8;case Fn:case ou:return 32;case ml:return 268435456;default:return 32}default:return 32}}var W0=!1,_s=null,bs=null,xs=null,mf=new Map,gf=new Map,ws=[],oF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zC(s,l){switch(s){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":bs=null;break;case"mouseover":case"mouseout":xs=null;break;case"pointerover":case"pointerout":mf.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":gf.delete(l.pointerId)}}function vf(s,l,f,m,_,x){return s===null||s.nativeEvent!==x?(s={blockedOn:l,domEventName:f,eventSystemFlags:m,nativeEvent:x,targetContainers:[_]},l!==null&&(l=xi(l),l!==null&&BC(l)),s):(s.eventSystemFlags|=m,l=s.targetContainers,_!==null&&l.indexOf(_)===-1&&l.push(_),s)}function sF(s,l,f,m,_){switch(l){case"focusin":return _s=vf(_s,s,l,f,m,_),!0;case"dragenter":return bs=vf(bs,s,l,f,m,_),!0;case"mouseover":return xs=vf(xs,s,l,f,m,_),!0;case"pointerover":var x=_.pointerId;return mf.set(x,vf(mf.get(x)||null,s,l,f,m,_)),!0;case"gotpointercapture":return x=_.pointerId,gf.set(x,vf(gf.get(x)||null,s,l,f,m,_)),!0}return!1}function GC(s){var l=ba(s.target);if(l!==null){var f=a(l);if(f!==null){if(l=f.tag,l===13){if(l=o(f),l!==null){s.blockedOn=l,Wi(s.priority,function(){jC(f)});return}}else if(l===31){if(l=u(f),l!==null){s.blockedOn=l,Wi(s.priority,function(){jC(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){s.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}s.blockedOn=null}function ym(s){if(s.blockedOn!==null)return!1;for(var l=s.targetContainers;0<l.length;){var f=G0(s.nativeEvent);if(f===null){f=s.nativeEvent;var m=new f.constructor(f.type,f);Ih=m,f.target.dispatchEvent(m),Ih=null}else return l=xi(f),l!==null&&BC(l),s.blockedOn=f,!1;l.shift()}return!0}function HC(s,l,f){ym(s)&&f.delete(l)}function uF(){W0=!1,_s!==null&&ym(_s)&&(_s=null),bs!==null&&ym(bs)&&(bs=null),xs!==null&&ym(xs)&&(xs=null),mf.forEach(HC),gf.forEach(HC)}function _m(s,l){s.blockedOn===l&&(s.blockedOn=null,W0||(W0=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,uF)))}var bm=null;function WC(s){bm!==s&&(bm=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){bm===s&&(bm=null);for(var l=0;l<s.length;l+=3){var f=s[l],m=s[l+1],_=s[l+2];if(typeof m!="function"){if(H0(m||f)===null)continue;break}var x=xi(f);x!==null&&(s.splice(l,3),l-=3,Gy(x,{pending:!0,data:_,method:f.method,action:m},m,_))}}))}function ic(s){function l(K){return _m(K,s)}_s!==null&&_m(_s,s),bs!==null&&_m(bs,s),xs!==null&&_m(xs,s),mf.forEach(l),gf.forEach(l);for(var f=0;f<ws.length;f++){var m=ws[f];m.blockedOn===s&&(m.blockedOn=null)}for(;0<ws.length&&(f=ws[0],f.blockedOn===null);)GC(f),f.blockedOn===null&&ws.shift();if(f=(s.ownerDocument||s).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var _=f[m],x=f[m+1],M=_[Yn]||null;if(typeof x=="function")M||WC(f);else if(M){var U=null;if(x&&x.hasAttribute("formAction")){if(_=x,M=x[Yn]||null)U=M.formAction;else if(H0(_)!==null)continue}else U=M.action;typeof U=="function"?f[m+1]=U:(f.splice(m,3),m-=3),WC(f)}}}function qC(){function s(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(M){return _=M})},focusReset:"manual",scroll:"manual"})}function l(){_!==null&&(_(),_=null),m||setTimeout(f,20)}function f(){if(!m&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,_=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(f,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),_!==null&&(_(),_=null)}}}function q0(s){this._internalRoot=s}xm.prototype.render=q0.prototype.render=function(s){var l=this._internalRoot;if(l===null)throw Error(r(409));var f=l.current,m=li();FC(f,m,s,l,null,null)},xm.prototype.unmount=q0.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var l=s.containerInfo;FC(s.current,2,null,s,null,null),tm(),l[ya]=null}};function xm(s){this._internalRoot=s}xm.prototype.unstable_scheduleHydration=function(s){if(s){var l=tp();s={blockedOn:null,target:s,priority:l};for(var f=0;f<ws.length&&l!==0&&l<ws[f].priority;f++);ws.splice(f,0,s),f===0&&GC(s)}};var KC=e.version;if(KC!=="19.2.3")throw Error(r(527,KC,"19.2.3"));Y.findDOMNode=function(s){var l=s._reactInternals;if(l===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=h(l),s=s!==null?d(s):null,s=s===null?null:s.stateNode,s};var lF={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wm.isDisabled&&wm.supportsFiber)try{Mr=wm.inject(lF),pn=wm}catch{}}return _f.createRoot=function(s,l){if(!i(s))throw Error(r(299));var f=!1,m="",_=eT,x=tT,M=nT;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(_=l.onUncaughtError),l.onCaughtError!==void 0&&(x=l.onCaughtError),l.onRecoverableError!==void 0&&(M=l.onRecoverableError)),l=PC(s,1,!1,null,null,f,m,null,_,x,M,qC),s[ya]=l.current,A0(s),new q0(l)},_f.hydrateRoot=function(s,l,f){if(!i(s))throw Error(r(299));var m=!1,_="",x=eT,M=tT,U=nT,K=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(_=f.identifierPrefix),f.onUncaughtError!==void 0&&(x=f.onUncaughtError),f.onCaughtError!==void 0&&(M=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError),f.formState!==void 0&&(K=f.formState)),l=PC(s,1,!0,l,f??null,m,_,K,x,M,U,qC),l.context=VC(null),f=l.current,m=li(),m=cu(m),_=ss(m),_.callback=null,us(f,_,m),f=m,l.current.lanes=f,uu(l,f),Oa(l),s[ya]=l.current,A0(s),new xm(l)},_f.version="19.2.3",_f}var rS;function xF(){if(rS)return Y0.exports;rS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Y0.exports=bF(),Y0.exports}var wF=xF();const EF=yN(wF),P1=oe.createContext({});function V1(n){const e=oe.useRef(null);return e.current===null&&(e.current=n()),e.current}const F1=typeof window<"u",_N=F1?oe.useLayoutEffect:oe.useEffect,ov=oe.createContext(null);function L1(n,e){n.indexOf(e)===-1&&n.push(e)}function B1(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const Mo=(n,e,t)=>t>e?e:t<n?n:t;let j1=()=>{};const Oo={},bN=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function xN(n){return typeof n=="object"&&n!==null}const wN=n=>/^0[^.\s]+$/u.test(n);function U1(n){let e;return()=>(e===void 0&&(e=n()),e)}const ji=n=>n,TF=(n,e)=>t=>e(n(t)),Cd=(...n)=>n.reduce(TF),$f=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class z1{constructor(){this.subscriptions=[]}add(e){return L1(this.subscriptions,e),()=>B1(this.subscriptions,e)}notify(e,t,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,r);else for(let a=0;a<i;a++){const o=this.subscriptions[a];o&&o(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ha=n=>n*1e3,Fi=n=>n/1e3;function EN(n,e){return e?n*(1e3/e):0}const TN=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,CF=1e-7,SF=12;function AF(n,e,t,r,i){let a,o,u=0;do o=e+(t-e)/2,a=TN(o,r,i)-n,a>0?t=o:e=o;while(Math.abs(a)>CF&&++u<SF);return o}function Sd(n,e,t,r){if(n===e&&t===r)return ji;const i=a=>AF(a,0,1,n,t);return a=>a===0||a===1?a:TN(i(a),e,r)}const CN=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,SN=n=>e=>1-n(1-e),AN=Sd(.33,1.53,.69,.99),G1=SN(AN),RN=CN(G1),IN=n=>(n*=2)<1?.5*G1(n):.5*(2-Math.pow(2,-10*(n-1))),H1=n=>1-Math.sin(Math.acos(n)),NN=SN(H1),DN=CN(H1),RF=Sd(.42,0,1,1),IF=Sd(0,0,.58,1),kN=Sd(.42,0,.58,1),NF=n=>Array.isArray(n)&&typeof n[0]!="number",MN=n=>Array.isArray(n)&&typeof n[0]=="number",DF={linear:ji,easeIn:RF,easeInOut:kN,easeOut:IF,circIn:H1,circInOut:DN,circOut:NN,backIn:G1,backInOut:RN,backOut:AN,anticipate:IN},kF=n=>typeof n=="string",iS=n=>{if(MN(n)){j1(n.length===4);const[e,t,r,i]=n;return Sd(e,t,r,i)}else if(kF(n))return DF[n];return n},Em=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function MF(n,e){let t=new Set,r=new Set,i=!1,a=!1;const o=new WeakSet;let u={delta:0,timestamp:0,isProcessing:!1};function c(d){o.has(d)&&(h.schedule(d),n()),d(u)}const h={schedule:(d,p=!1,g=!1)=>{const b=g&&i?t:r;return p&&o.add(d),b.has(d)||b.add(d),d},cancel:d=>{r.delete(d),o.delete(d)},process:d=>{if(u=d,i){a=!0;return}i=!0,[t,r]=[r,t],t.forEach(c),t.clear(),i=!1,a&&(a=!1,h.process(d))}};return h}const OF=40;function ON(n,e){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>t=!0,o=Em.reduce((I,C)=>(I[C]=MF(a),I),{}),{setup:u,read:c,resolveKeyframes:h,preUpdate:d,update:p,preRender:g,render:v,postRender:b}=o,w=()=>{const I=Oo.useManualTiming?i.timestamp:performance.now();t=!1,Oo.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(I-i.timestamp,OF),1)),i.timestamp=I,i.isProcessing=!0,u.process(i),c.process(i),h.process(i),d.process(i),p.process(i),g.process(i),v.process(i),b.process(i),i.isProcessing=!1,t&&e&&(r=!1,n(w))},E=()=>{t=!0,r=!0,i.isProcessing||n(w)};return{schedule:Em.reduce((I,C)=>{const k=o[C];return I[C]=(L,O=!1,N=!1)=>(t||E(),k.schedule(L,O,N)),I},{}),cancel:I=>{for(let C=0;C<Em.length;C++)o[Em[C]].cancel(I)},state:i,steps:o}}const{schedule:rn,cancel:Us,state:hr,steps:J0}=ON(typeof requestAnimationFrame<"u"?requestAnimationFrame:ji,!0);let $m;function PF(){$m=void 0}const $r={now:()=>($m===void 0&&$r.set(hr.isProcessing||Oo.useManualTiming?hr.timestamp:performance.now()),$m),set:n=>{$m=n,queueMicrotask(PF)}},PN=n=>e=>typeof e=="string"&&e.startsWith(n),VN=PN("--"),VF=PN("var(--"),W1=n=>VF(n)?FF.test(n.split("/*")[0].trim()):!1,FF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,nh={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Qf={...nh,transform:n=>Mo(0,1,n)},Tm={...nh,default:1},Of=n=>Math.round(n*1e5)/1e5,q1=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function LF(n){return n==null}const BF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,K1=(n,e)=>t=>!!(typeof t=="string"&&BF.test(t)&&t.startsWith(n)||e&&!LF(t)&&Object.prototype.hasOwnProperty.call(t,e)),FN=(n,e,t)=>r=>{if(typeof r!="string")return r;const[i,a,o,u]=r.match(q1);return{[n]:parseFloat(i),[e]:parseFloat(a),[t]:parseFloat(o),alpha:u!==void 0?parseFloat(u):1}},jF=n=>Mo(0,255,n),e_={...nh,transform:n=>Math.round(jF(n))},Gu={test:K1("rgb","red"),parse:FN("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+e_.transform(n)+", "+e_.transform(e)+", "+e_.transform(t)+", "+Of(Qf.transform(r))+")"};function UF(n){let e="",t="",r="",i="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),i=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),i=n.substring(4,5),e+=e,t+=t,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const ob={test:K1("#"),parse:UF,transform:Gu.transform},Ad=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Ss=Ad("deg"),Wa=Ad("%"),Pe=Ad("px"),zF=Ad("vh"),GF=Ad("vw"),aS={...Wa,parse:n=>Wa.parse(n)/100,transform:n=>Wa.transform(n*100)},_c={test:K1("hsl","hue"),parse:FN("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+Wa.transform(Of(e))+", "+Wa.transform(Of(t))+", "+Of(Qf.transform(r))+")"},Dn={test:n=>Gu.test(n)||ob.test(n)||_c.test(n),parse:n=>Gu.test(n)?Gu.parse(n):_c.test(n)?_c.parse(n):ob.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Gu.transform(n):_c.transform(n),getAnimatableNone:n=>{const e=Dn.parse(n);return e.alpha=0,Dn.transform(e)}},HF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function WF(n){return isNaN(n)&&typeof n=="string"&&(n.match(q1)?.length||0)+(n.match(HF)?.length||0)>0}const LN="number",BN="color",qF="var",KF="var(",oS="${}",XF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Zf(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},i=[];let a=0;const u=e.replace(XF,c=>(Dn.test(c)?(r.color.push(a),i.push(BN),t.push(Dn.parse(c))):c.startsWith(KF)?(r.var.push(a),i.push(qF),t.push(c)):(r.number.push(a),i.push(LN),t.push(parseFloat(c))),++a,oS)).split(oS);return{values:t,split:u,indexes:r,types:i}}function jN(n){return Zf(n).values}function UN(n){const{split:e,types:t}=Zf(n),r=e.length;return i=>{let a="";for(let o=0;o<r;o++)if(a+=e[o],i[o]!==void 0){const u=t[o];u===LN?a+=Of(i[o]):u===BN?a+=Dn.transform(i[o]):a+=i[o]}return a}}const YF=n=>typeof n=="number"?0:Dn.test(n)?Dn.getAnimatableNone(n):n;function $F(n){const e=jN(n);return UN(n)(e.map(YF))}const zs={test:WF,parse:jN,createTransformer:UN,getAnimatableNone:$F};function t_(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function QF({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let i=0,a=0,o=0;if(!e)i=a=o=t;else{const u=t<.5?t*(1+e):t+e-t*e,c=2*t-u;i=t_(c,u,n+1/3),a=t_(c,u,n),o=t_(c,u,n-1/3)}return{red:Math.round(i*255),green:Math.round(a*255),blue:Math.round(o*255),alpha:r}}function ug(n,e){return t=>t>0?e:n}const on=(n,e,t)=>n+(e-n)*t,n_=(n,e,t)=>{const r=n*n,i=t*(e*e-r)+r;return i<0?0:Math.sqrt(i)},ZF=[ob,Gu,_c],JF=n=>ZF.find(e=>e.test(n));function sS(n){const e=JF(n);if(!e)return!1;let t=e.parse(n);return e===_c&&(t=QF(t)),t}const uS=(n,e)=>{const t=sS(n),r=sS(e);if(!t||!r)return ug(n,e);const i={...t};return a=>(i.red=n_(t.red,r.red,a),i.green=n_(t.green,r.green,a),i.blue=n_(t.blue,r.blue,a),i.alpha=on(t.alpha,r.alpha,a),Gu.transform(i))},sb=new Set(["none","hidden"]);function eL(n,e){return sb.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function tL(n,e){return t=>on(n,e,t)}function X1(n){return typeof n=="number"?tL:typeof n=="string"?W1(n)?ug:Dn.test(n)?uS:iL:Array.isArray(n)?zN:typeof n=="object"?Dn.test(n)?uS:nL:ug}function zN(n,e){const t=[...n],r=t.length,i=n.map((a,o)=>X1(a)(a,e[o]));return a=>{for(let o=0;o<r;o++)t[o]=i[o](a);return t}}function nL(n,e){const t={...n,...e},r={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(r[i]=X1(n[i])(n[i],e[i]));return i=>{for(const a in r)t[a]=r[a](i);return t}}function rL(n,e){const t=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const a=e.types[i],o=n.indexes[a][r[a]],u=n.values[o]??0;t[i]=u,r[a]++}return t}const iL=(n,e)=>{const t=zs.createTransformer(e),r=Zf(n),i=Zf(e);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?sb.has(n)&&!i.values.length||sb.has(e)&&!r.values.length?eL(n,e):Cd(zN(rL(r,i),i.values),t):ug(n,e)};function GN(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?on(n,e,t):X1(n)(n,e)}const aL=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>rn.update(e,t),stop:()=>Us(e),now:()=>hr.isProcessing?hr.timestamp:$r.now()}},HN=(n,e,t=10)=>{let r="";const i=Math.max(Math.round(e/t),2);for(let a=0;a<i;a++)r+=Math.round(n(a/(i-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},lg=2e4;function Y1(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<lg;)e+=t,r=n.next(e);return e>=lg?1/0:e}function oL(n,e=100,t){const r=t({...n,keyframes:[0,e]}),i=Math.min(Y1(r),lg);return{type:"keyframes",ease:a=>r.next(i*a).value/e,duration:Fi(i)}}const sL=5;function WN(n,e,t){const r=Math.max(e-sL,0);return EN(t-n(r),e-r)}const dn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},r_=.001;function uL({duration:n=dn.duration,bounce:e=dn.bounce,velocity:t=dn.velocity,mass:r=dn.mass}){let i,a,o=1-e;o=Mo(dn.minDamping,dn.maxDamping,o),n=Mo(dn.minDuration,dn.maxDuration,Fi(n)),o<1?(i=h=>{const d=h*o,p=d*n,g=d-t,v=ub(h,o),b=Math.exp(-p);return r_-g/v*b},a=h=>{const p=h*o*n,g=p*t+t,v=Math.pow(o,2)*Math.pow(h,2)*n,b=Math.exp(-p),w=ub(Math.pow(h,2),o);return(-i(h)+r_>0?-1:1)*((g-v)*b)/w}):(i=h=>{const d=Math.exp(-h*n),p=(h-t)*n+1;return-r_+d*p},a=h=>{const d=Math.exp(-h*n),p=(t-h)*(n*n);return d*p});const u=5/n,c=cL(i,a,u);if(n=Ha(n),isNaN(c))return{stiffness:dn.stiffness,damping:dn.damping,duration:n};{const h=Math.pow(c,2)*r;return{stiffness:h,damping:o*2*Math.sqrt(r*h),duration:n}}}const lL=12;function cL(n,e,t){let r=t;for(let i=1;i<lL;i++)r=r-n(r)/e(r);return r}function ub(n,e){return n*Math.sqrt(1-e*e)}const hL=["duration","bounce"],fL=["stiffness","damping","mass"];function lS(n,e){return e.some(t=>n[t]!==void 0)}function dL(n){let e={velocity:dn.velocity,stiffness:dn.stiffness,damping:dn.damping,mass:dn.mass,isResolvedFromDuration:!1,...n};if(!lS(n,fL)&&lS(n,hL))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),i=r*r,a=2*Mo(.05,1,1-(n.bounce||0))*Math.sqrt(i);e={...e,mass:dn.mass,stiffness:i,damping:a}}else{const t=uL(n);e={...e,...t,mass:dn.mass},e.isResolvedFromDuration=!0}return e}function cg(n=dn.visualDuration,e=dn.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:i}=t;const a=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],u={done:!1,value:a},{stiffness:c,damping:h,mass:d,duration:p,velocity:g,isResolvedFromDuration:v}=dL({...t,velocity:-Fi(t.velocity||0)}),b=g||0,w=h/(2*Math.sqrt(c*d)),E=o-a,T=Fi(Math.sqrt(c/d)),R=Math.abs(E)<5;r||(r=R?dn.restSpeed.granular:dn.restSpeed.default),i||(i=R?dn.restDelta.granular:dn.restDelta.default);let I;if(w<1){const k=ub(T,w);I=L=>{const O=Math.exp(-w*T*L);return o-O*((b+w*T*E)/k*Math.sin(k*L)+E*Math.cos(k*L))}}else if(w===1)I=k=>o-Math.exp(-T*k)*(E+(b+T*E)*k);else{const k=T*Math.sqrt(w*w-1);I=L=>{const O=Math.exp(-w*T*L),N=Math.min(k*L,300);return o-O*((b+w*T*E)*Math.sinh(N)+k*E*Math.cosh(N))/k}}const C={calculatedDuration:v&&p||null,next:k=>{const L=I(k);if(v)u.done=k>=p;else{let O=k===0?b:0;w<1&&(O=k===0?Ha(b):WN(I,k,L));const N=Math.abs(O)<=r,D=Math.abs(o-L)<=i;u.done=N&&D}return u.value=u.done?o:L,u},toString:()=>{const k=Math.min(Y1(C),lg),L=HN(O=>C.next(k*O).value,k,30);return k+"ms "+L},toTransition:()=>{}};return C}cg.applyToOptions=n=>{const e=oL(n,100,cg);return n.ease=e.ease,n.duration=Ha(e.duration),n.type="keyframes",n};function lb({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:o,min:u,max:c,restDelta:h=.5,restSpeed:d}){const p=n[0],g={done:!1,value:p},v=N=>u!==void 0&&N<u||c!==void 0&&N>c,b=N=>u===void 0?c:c===void 0||Math.abs(u-N)<Math.abs(c-N)?u:c;let w=t*e;const E=p+w,T=o===void 0?E:o(E);T!==E&&(w=T-p);const R=N=>-w*Math.exp(-N/r),I=N=>T+R(N),C=N=>{const D=R(N),P=I(N);g.done=Math.abs(D)<=h,g.value=g.done?T:P};let k,L;const O=N=>{v(g.value)&&(k=N,L=cg({keyframes:[g.value,b(g.value)],velocity:WN(I,N,g.value),damping:i,stiffness:a,restDelta:h,restSpeed:d}))};return O(0),{calculatedDuration:null,next:N=>{let D=!1;return!L&&k===void 0&&(D=!0,C(N),O(N)),k!==void 0&&N>=k?L.next(N-k):(!D&&C(N),g)}}}function pL(n,e,t){const r=[],i=t||Oo.mix||GN,a=n.length-1;for(let o=0;o<a;o++){let u=i(n[o],n[o+1]);if(e){const c=Array.isArray(e)?e[o]||ji:e;u=Cd(c,u)}r.push(u)}return r}function mL(n,e,{clamp:t=!0,ease:r,mixer:i}={}){const a=n.length;if(j1(a===e.length),a===1)return()=>e[0];if(a===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[a-1]&&(n=[...n].reverse(),e=[...e].reverse());const u=pL(e,r,i),c=u.length,h=d=>{if(o&&d<n[0])return e[0];let p=0;if(c>1)for(;p<n.length-2&&!(d<n[p+1]);p++);const g=$f(n[p],n[p+1],d);return u[p](g)};return t?d=>h(Mo(n[0],n[a-1],d)):h}function gL(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const i=$f(0,e,r);n.push(on(t,1,i))}}function vL(n){const e=[0];return gL(e,n.length-1),e}function yL(n,e){return n.map(t=>t*e)}function _L(n,e){return n.map(()=>e||kN).splice(0,n.length-1)}function Pf({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const i=NF(r)?r.map(iS):iS(r),a={done:!1,value:e[0]},o=yL(t&&t.length===e.length?t:vL(e),n),u=mL(o,e,{ease:Array.isArray(i)?i:_L(e,i)});return{calculatedDuration:n,next:c=>(a.value=u(c),a.done=c>=n,a)}}const bL=n=>n!==null;function $1(n,{repeat:e,repeatType:t="loop"},r,i=1){const a=n.filter(bL),u=i<0||e&&t!=="loop"&&e%2===1?0:a.length-1;return!u||r===void 0?a[u]:r}const xL={decay:lb,inertia:lb,tween:Pf,keyframes:Pf,spring:cg};function qN(n){typeof n.type=="string"&&(n.type=xL[n.type])}class Q1{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const wL=n=>n/100;class Z1 extends Q1{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==$r.now()&&this.tick($r.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;qN(e);const{type:t=Pf,repeat:r=0,repeatDelay:i=0,repeatType:a,velocity:o=0}=e;let{keyframes:u}=e;const c=t||Pf;c!==Pf&&typeof u[0]!="number"&&(this.mixKeyframes=Cd(wL,GN(u[0],u[1])),u=[0,100]);const h=c({...e,keyframes:u});a==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...u].reverse(),velocity:-o})),h.calculatedDuration===null&&(h.calculatedDuration=Y1(h));const{calculatedDuration:d}=h;this.calculatedDuration=d,this.resolvedDuration=d+i,this.totalDuration=this.resolvedDuration*(r+1)-i,this.generator=h}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:i,mixKeyframes:a,mirroredGenerator:o,resolvedDuration:u,calculatedDuration:c}=this;if(this.startTime===null)return r.next(0);const{delay:h=0,keyframes:d,repeat:p,repeatType:g,repeatDelay:v,type:b,onUpdate:w,finalKeyframe:E}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const T=this.currentTime-h*(this.playbackSpeed>=0?1:-1),R=this.playbackSpeed>=0?T<0:T>i;this.currentTime=Math.max(T,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let I=this.currentTime,C=r;if(p){const N=Math.min(this.currentTime,i)/u;let D=Math.floor(N),P=N%1;!P&&N>=1&&(P=1),P===1&&D--,D=Math.min(D,p+1),D%2&&(g==="reverse"?(P=1-P,v&&(P-=v/u)):g==="mirror"&&(C=o)),I=Mo(0,1,P)*u}const k=R?{done:!1,value:d[0]}:C.next(I);a&&(k.value=a(k.value));let{done:L}=k;!R&&c!==null&&(L=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const O=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&L);return O&&b!==lb&&(k.value=$1(d,this.options,E,this.speed)),w&&w(k.value),O&&this.finish(),k}then(e,t){return this.finished.then(e,t)}get duration(){return Fi(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Fi(e)}get time(){return Fi(this.currentTime)}set time(e){e=Ha(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime($r.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Fi(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=aL,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime($r.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function EL(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const Hu=n=>n*180/Math.PI,cb=n=>{const e=Hu(Math.atan2(n[1],n[0]));return hb(e)},TL={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:cb,rotateZ:cb,skewX:n=>Hu(Math.atan(n[1])),skewY:n=>Hu(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},hb=n=>(n=n%360,n<0&&(n+=360),n),cS=cb,hS=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),fS=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),CL={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:hS,scaleY:fS,scale:n=>(hS(n)+fS(n))/2,rotateX:n=>hb(Hu(Math.atan2(n[6],n[5]))),rotateY:n=>hb(Hu(Math.atan2(-n[2],n[0]))),rotateZ:cS,rotate:cS,skewX:n=>Hu(Math.atan(n[4])),skewY:n=>Hu(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function fb(n){return n.includes("scale")?1:0}function db(n,e){if(!n||n==="none")return fb(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(t)r=CL,i=t;else{const u=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=TL,i=u}if(!i)return fb(e);const a=r[e],o=i[1].split(",").map(AL);return typeof a=="function"?a(o):o[a]}const SL=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return db(t,e)};function AL(n){return parseFloat(n.trim())}const rh=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ih=new Set(rh),dS=n=>n===nh||n===Pe,RL=new Set(["x","y","z"]),IL=rh.filter(n=>!RL.has(n));function NL(n){const e=[];return IL.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Yu={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>db(e,"x"),y:(n,{transform:e})=>db(e,"y")};Yu.translateX=Yu.x;Yu.translateY=Yu.y;const $u=new Set;let pb=!1,mb=!1,gb=!1;function KN(){if(mb){const n=Array.from($u).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const i=NL(r);i.length&&(t.set(r,i),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const i=t.get(r);i&&i.forEach(([a,o])=>{r.getValue(a)?.set(o)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}mb=!1,pb=!1,$u.forEach(n=>n.complete(gb)),$u.clear()}function XN(){$u.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(mb=!0)})}function DL(){gb=!0,XN(),KN(),gb=!1}class J1{constructor(e,t,r,i,a,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=i,this.element=a,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?($u.add(this),pb||(pb=!0,rn.read(XN),rn.resolveKeyframes(KN))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:i}=this;if(e[0]===null){const a=i?.get(),o=e[e.length-1];if(a!==void 0)e[0]=a;else if(r&&t){const u=r.readValue(t,o);u!=null&&(e[0]=u)}e[0]===void 0&&(e[0]=o),i&&a===void 0&&i.set(e[0])}EL(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),$u.delete(this)}cancel(){this.state==="scheduled"&&($u.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const kL=n=>n.startsWith("--");function ML(n,e,t){kL(e)?n.style.setProperty(e,t):n.style[e]=t}const OL=U1(()=>window.ScrollTimeline!==void 0),PL={};function VL(n,e){const t=U1(n);return()=>PL[e]??t()}const YN=VL(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Nf=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,pS={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Nf([0,.65,.55,1]),circOut:Nf([.55,0,1,.45]),backIn:Nf([.31,.01,.66,-.59]),backOut:Nf([.33,1.53,.69,.99])};function $N(n,e){if(n)return typeof n=="function"?YN()?HN(n,e):"ease-out":MN(n)?Nf(n):Array.isArray(n)?n.map(t=>$N(t,e)||pS.easeOut):pS[n]}function FL(n,e,t,{delay:r=0,duration:i=300,repeat:a=0,repeatType:o="loop",ease:u="easeOut",times:c}={},h=void 0){const d={[e]:t};c&&(d.offset=c);const p=$N(u,i);Array.isArray(p)&&(d.easing=p);const g={delay:r,duration:i,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:a+1,direction:o==="reverse"?"alternate":"normal"};return h&&(g.pseudoElement=h),n.animate(d,g)}function QN(n){return typeof n=="function"&&"applyToOptions"in n}function LL({type:n,...e}){return QN(n)&&YN()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class BL extends Q1{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:i,pseudoElement:a,allowFlatten:o=!1,finalKeyframe:u,onComplete:c}=e;this.isPseudoElement=!!a,this.allowFlatten=o,this.options=e,j1(typeof e.type!="string");const h=LL(e);this.animation=FL(t,r,i,h,a),h.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const d=$1(i,this.options,u,this.speed);this.updateMotionValue?this.updateMotionValue(d):ML(t,r,d),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Fi(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Fi(e)}get time(){return Fi(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Ha(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&OL()?(this.animation.timeline=e,ji):t(this)}}const ZN={anticipate:IN,backInOut:RN,circInOut:DN};function jL(n){return n in ZN}function UL(n){typeof n.ease=="string"&&jL(n.ease)&&(n.ease=ZN[n.ease])}const mS=10;class zL extends BL{constructor(e){UL(e),qN(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:i,element:a,...o}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const u=new Z1({...o,autoplay:!1}),c=Ha(this.finishedTime??this.time);t.setWithVelocity(u.sample(c-mS).value,u.sample(c).value,mS),u.stop()}}const gS=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(zs.test(n)||n==="0")&&!n.startsWith("url("));function GL(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function HL(n,e,t,r){const i=n[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const a=n[n.length-1],o=gS(i,e),u=gS(a,e);return!o||!u?!1:GL(n)||(t==="spring"||QN(t))&&r}function vb(n){n.duration=0,n.type="keyframes"}const WL=new Set(["opacity","clipPath","filter","transform"]),qL=U1(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function KL(n){const{motionValue:e,name:t,repeatDelay:r,repeatType:i,damping:a,type:o}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:h}=e.owner.getProps();return qL()&&t&&WL.has(t)&&(t!=="transform"||!h)&&!c&&!r&&i!=="mirror"&&a!==0&&o!=="inertia"}const XL=40;class YL extends Q1{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:o="loop",keyframes:u,name:c,motionValue:h,element:d,...p}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=$r.now();const g={autoplay:e,delay:t,type:r,repeat:i,repeatDelay:a,repeatType:o,name:c,motionValue:h,element:d,...p},v=d?.KeyframeResolver||J1;this.keyframeResolver=new v(u,(b,w,E)=>this.onKeyframesResolved(b,w,g,!E),c,h,d),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,i){this.keyframeResolver=void 0;const{name:a,type:o,velocity:u,delay:c,isHandoff:h,onUpdate:d}=r;this.resolvedAt=$r.now(),HL(e,a,o,u)||((Oo.instantAnimations||!c)&&d?.($1(e,r,t)),e[0]=e[e.length-1],vb(r),r.repeat=0);const g={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>XL?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},v=!h&&KL(g)?new zL({...g,element:g.motionValue.owner.current}):new Z1(g);v.finished.then(()=>this.notifyFinished()).catch(ji),this.pendingTimeline&&(this.stopTimeline=v.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=v}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),DL()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const $L=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function QL(n){const e=$L.exec(n);if(!e)return[,];const[,t,r,i]=e;return[`--${t??r}`,i]}function JN(n,e,t=1){const[r,i]=QL(n);if(!r)return;const a=window.getComputedStyle(e).getPropertyValue(r);if(a){const o=a.trim();return bN(o)?parseFloat(o):o}return W1(i)?JN(i,e,t+1):i}function ex(n,e){return n?.[e]??n?.default??n}const eD=new Set(["width","height","top","left","right","bottom",...rh]),ZL={test:n=>n==="auto",parse:n=>n},tD=n=>e=>e.test(n),nD=[nh,Pe,Wa,Ss,GF,zF,ZL],vS=n=>nD.find(tD(n));function JL(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||wN(n):!0}const eB=new Set(["brightness","contrast","saturate","opacity"]);function tB(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(q1)||[];if(!r)return n;const i=t.replace(r,"");let a=eB.has(e)?1:0;return r!==t&&(a*=100),e+"("+a+i+")"}const nB=/\b([a-z-]*)\(.*?\)/gu,yb={...zs,getAnimatableNone:n=>{const e=n.match(nB);return e?e.map(tB).join(" "):n}},yS={...nh,transform:Math.round},rB={rotate:Ss,rotateX:Ss,rotateY:Ss,rotateZ:Ss,scale:Tm,scaleX:Tm,scaleY:Tm,scaleZ:Tm,skew:Ss,skewX:Ss,skewY:Ss,distance:Pe,translateX:Pe,translateY:Pe,translateZ:Pe,x:Pe,y:Pe,z:Pe,perspective:Pe,transformPerspective:Pe,opacity:Qf,originX:aS,originY:aS,originZ:Pe},tx={borderWidth:Pe,borderTopWidth:Pe,borderRightWidth:Pe,borderBottomWidth:Pe,borderLeftWidth:Pe,borderRadius:Pe,radius:Pe,borderTopLeftRadius:Pe,borderTopRightRadius:Pe,borderBottomRightRadius:Pe,borderBottomLeftRadius:Pe,width:Pe,maxWidth:Pe,height:Pe,maxHeight:Pe,top:Pe,right:Pe,bottom:Pe,left:Pe,inset:Pe,insetBlock:Pe,insetBlockStart:Pe,insetBlockEnd:Pe,insetInline:Pe,insetInlineStart:Pe,insetInlineEnd:Pe,padding:Pe,paddingTop:Pe,paddingRight:Pe,paddingBottom:Pe,paddingLeft:Pe,paddingBlock:Pe,paddingBlockStart:Pe,paddingBlockEnd:Pe,paddingInline:Pe,paddingInlineStart:Pe,paddingInlineEnd:Pe,margin:Pe,marginTop:Pe,marginRight:Pe,marginBottom:Pe,marginLeft:Pe,marginBlock:Pe,marginBlockStart:Pe,marginBlockEnd:Pe,marginInline:Pe,marginInlineStart:Pe,marginInlineEnd:Pe,backgroundPositionX:Pe,backgroundPositionY:Pe,...rB,zIndex:yS,fillOpacity:Qf,strokeOpacity:Qf,numOctaves:yS},iB={...tx,color:Dn,backgroundColor:Dn,outlineColor:Dn,fill:Dn,stroke:Dn,borderColor:Dn,borderTopColor:Dn,borderRightColor:Dn,borderBottomColor:Dn,borderLeftColor:Dn,filter:yb,WebkitFilter:yb},rD=n=>iB[n];function iD(n,e){let t=rD(n);return t!==yb&&(t=zs),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const aB=new Set(["auto","none","0"]);function oB(n,e,t){let r=0,i;for(;r<n.length&&!i;){const a=n[r];typeof a=="string"&&!aB.has(a)&&Zf(a).values.length&&(i=n[r]),r++}if(i&&t)for(const a of e)n[a]=iD(t,i)}class sB extends J1{constructor(e,t,r,i,a){super(e,t,r,i,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let h=e[c];if(typeof h=="string"&&(h=h.trim(),W1(h))){const d=JN(h,t.current);d!==void 0&&(e[c]=d),c===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!eD.has(r)||e.length!==2)return;const[i,a]=e,o=vS(i),u=vS(a);if(o!==u)if(dS(o)&&dS(u))for(let c=0;c<e.length;c++){const h=e[c];typeof h=="string"&&(e[c]=parseFloat(h))}else Yu[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let i=0;i<e.length;i++)(e[i]===null||JL(e[i]))&&r.push(i);r.length&&oB(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Yu[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(r,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const a=r.length-1,o=r[a];r[a]=Yu[t](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([u,c])=>{e.getValue(u).set(c)}),this.resolveNoneKeyframes()}}function uB(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const i=t?.[n]??r.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const aD=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function oD(n){return xN(n)&&"offsetHeight"in n}const _S=30,lB=n=>!isNaN(parseFloat(n));class cB{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const i=$r.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=$r.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=lB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new z1);const r=this.events[e].add(t);return e==="change"?()=>{r(),rn.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=$r.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>_S)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,_S);return EN(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function jc(n,e){return new cB(n,e)}const{schedule:nx}=ON(queueMicrotask,!1),na={x:!1,y:!1};function sD(){return na.x||na.y}function hB(n){return n==="x"||n==="y"?na[n]?null:(na[n]=!0,()=>{na[n]=!1}):na.x||na.y?null:(na.x=na.y=!0,()=>{na.x=na.y=!1})}function uD(n,e){const t=uB(n),r=new AbortController,i={passive:!0,...e,signal:r.signal};return[t,i,()=>r.abort()]}function bS(n){return!(n.pointerType==="touch"||sD())}function fB(n,e,t={}){const[r,i,a]=uD(n,t),o=u=>{if(!bS(u))return;const{target:c}=u,h=e(c,u);if(typeof h!="function"||!c)return;const d=p=>{bS(p)&&(h(p),c.removeEventListener("pointerleave",d))};c.addEventListener("pointerleave",d,i)};return r.forEach(u=>{u.addEventListener("pointerenter",o,i)}),a}const lD=(n,e)=>e?n===e?!0:lD(n,e.parentElement):!1,rx=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,dB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function pB(n){return dB.has(n.tagName)||n.tabIndex!==-1}const Qm=new WeakSet;function xS(n){return e=>{e.key==="Enter"&&n(e)}}function i_(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const mB=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=xS(()=>{if(Qm.has(t))return;i_(t,"down");const i=xS(()=>{i_(t,"up")}),a=()=>i_(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",a,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function wS(n){return rx(n)&&!sD()}function gB(n,e,t={}){const[r,i,a]=uD(n,t),o=u=>{const c=u.currentTarget;if(!wS(u))return;Qm.add(c);const h=e(c,u),d=(v,b)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",g),Qm.has(c)&&Qm.delete(c),wS(v)&&typeof h=="function"&&h(v,{success:b})},p=v=>{d(v,c===window||c===document||t.useGlobalTarget||lD(c,v.target))},g=v=>{d(v,!1)};window.addEventListener("pointerup",p,i),window.addEventListener("pointercancel",g,i)};return r.forEach(u=>{(t.useGlobalTarget?window:u).addEventListener("pointerdown",o,i),oD(u)&&(u.addEventListener("focus",h=>mB(h,i)),!pB(u)&&!u.hasAttribute("tabindex")&&(u.tabIndex=0))}),a}function cD(n){return xN(n)&&"ownerSVGElement"in n}function vB(n){return cD(n)&&n.tagName==="svg"}const Ir=n=>!!(n&&n.getVelocity),yB=[...nD,Dn,zs],_B=n=>yB.find(tD(n)),ix=oe.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function ES(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function bB(...n){return e=>{let t=!1;const r=n.map(i=>{const a=ES(i,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let i=0;i<r.length;i++){const a=r[i];typeof a=="function"?a():ES(n[i],null)}}}}function xB(...n){return oe.useCallback(bB(...n),n)}class wB extends oe.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,i=oD(r)&&r.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=i-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function EB({children:n,isPresent:e,anchorX:t,root:r}){const i=oe.useId(),a=oe.useRef(null),o=oe.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=oe.useContext(ix),c=n.props?.ref??n?.ref,h=xB(a,c);return oe.useInsertionEffect(()=>{const{width:d,height:p,top:g,left:v,right:b}=o.current;if(e||!a.current||!d||!p)return;const w=t==="left"?`left: ${v}`:`right: ${b}`;a.current.dataset.motionPopId=i;const E=document.createElement("style");u&&(E.nonce=u);const T=r??document.head;return T.appendChild(E),E.sheet&&E.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${p}px !important;
            ${w}px !important;
            top: ${g}px !important;
          }
        `),()=>{T.contains(E)&&T.removeChild(E)}},[e]),S.jsx(wB,{isPresent:e,childRef:a,sizeRef:o,children:oe.cloneElement(n,{ref:h})})}const TB=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:a,mode:o,anchorX:u,root:c})=>{const h=V1(CB),d=oe.useId();let p=!0,g=oe.useMemo(()=>(p=!1,{id:d,initial:e,isPresent:t,custom:i,onExitComplete:v=>{h.set(v,!0);for(const b of h.values())if(!b)return;r&&r()},register:v=>(h.set(v,!1),()=>h.delete(v))}),[t,h,r]);return a&&p&&(g={...g}),oe.useMemo(()=>{h.forEach((v,b)=>h.set(b,!1))},[t]),oe.useEffect(()=>{!t&&!h.size&&r&&r()},[t]),o==="popLayout"&&(n=S.jsx(EB,{isPresent:t,anchorX:u,root:c,children:n})),S.jsx(ov.Provider,{value:g,children:n})};function CB(){return new Map}function hD(n=!0){const e=oe.useContext(ov);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=e,a=oe.useId();oe.useEffect(()=>{if(n)return i(a)},[n]);const o=oe.useCallback(()=>n&&r&&r(a),[a,r,n]);return!t&&r?[!1,o]:[!0]}const Cm=n=>n.key||"";function TS(n){const e=[];return oe.Children.forEach(n,t=>{oe.isValidElement(t)&&e.push(t)}),e}const sa=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:a="sync",propagate:o=!1,anchorX:u="left",root:c})=>{const[h,d]=hD(o),p=oe.useMemo(()=>TS(n),[n]),g=o&&!h?[]:p.map(Cm),v=oe.useRef(!0),b=oe.useRef(p),w=V1(()=>new Map),E=oe.useRef(new Set),[T,R]=oe.useState(p),[I,C]=oe.useState(p);_N(()=>{v.current=!1,b.current=p;for(let O=0;O<I.length;O++){const N=Cm(I[O]);g.includes(N)?(w.delete(N),E.current.delete(N)):w.get(N)!==!0&&w.set(N,!1)}},[I,g.length,g.join("-")]);const k=[];if(p!==T){let O=[...p];for(let N=0;N<I.length;N++){const D=I[N],P=Cm(D);g.includes(P)||(O.splice(N,0,D),k.push(D))}return a==="wait"&&k.length&&(O=k),C(TS(O)),R(p),null}const{forceRender:L}=oe.useContext(P1);return S.jsx(S.Fragment,{children:I.map(O=>{const N=Cm(O),D=o&&!h?!1:p===I||g.includes(N),P=()=>{if(E.current.has(N))return;if(E.current.add(N),w.has(N))w.set(N,!0);else return;let F=!0;w.forEach(j=>{j||(F=!1)}),F&&(L?.(),C(b.current),o&&d?.(),r&&r())};return S.jsx(TB,{isPresent:D,initial:!v.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:a,root:c,onExitComplete:D?void 0:P,anchorX:u,children:O},N)})})},fD=oe.createContext({strict:!1}),CS={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Uc={};for(const n in CS)Uc[n]={isEnabled:e=>CS[n].some(t=>!!e[t])};function SB(n){for(const e in n)Uc[e]={...Uc[e],...n[e]}}const AB=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function hg(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||AB.has(n)}let dD=n=>!hg(n);function RB(n){typeof n=="function"&&(dD=e=>e.startsWith("on")?!hg(e):n(e))}try{RB(require("@emotion/is-prop-valid").default)}catch{}function IB(n,e,t){const r={};for(const i in n)i==="values"&&typeof n.values=="object"||(dD(i)||t===!0&&hg(i)||!e&&!hg(i)||n.draggable&&i.startsWith("onDrag"))&&(r[i]=n[i]);return r}const sv=oe.createContext({});function uv(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Jf(n){return typeof n=="string"||Array.isArray(n)}const ax=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ox=["initial",...ax];function lv(n){return uv(n.animate)||ox.some(e=>Jf(n[e]))}function pD(n){return!!(lv(n)||n.variants)}function NB(n,e){if(lv(n)){const{initial:t,animate:r}=n;return{initial:t===!1||Jf(t)?t:void 0,animate:Jf(r)?r:void 0}}return n.inherit!==!1?e:{}}function DB(n){const{initial:e,animate:t}=NB(n,oe.useContext(sv));return oe.useMemo(()=>({initial:e,animate:t}),[SS(e),SS(t)])}function SS(n){return Array.isArray(n)?n.join(" "):n}function AS(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const bf={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Pe.test(n))n=parseFloat(n);else return n;const t=AS(n,e.target.x),r=AS(n,e.target.y);return`${t}% ${r}%`}},kB={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,i=zs.parse(n);if(i.length>5)return r;const a=zs.createTransformer(n),o=typeof i[0]!="number"?1:0,u=t.x.scale*e.x,c=t.y.scale*e.y;i[0+o]/=u,i[1+o]/=c;const h=on(u,c,.5);return typeof i[2+o]=="number"&&(i[2+o]/=h),typeof i[3+o]=="number"&&(i[3+o]/=h),a(i)}},_b={borderRadius:{...bf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:bf,borderTopRightRadius:bf,borderBottomLeftRadius:bf,borderBottomRightRadius:bf,boxShadow:kB};function mD(n,{layout:e,layoutId:t}){return ih.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!_b[n]||n==="opacity")}const MB={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},OB=rh.length;function PB(n,e,t){let r="",i=!0;for(let a=0;a<OB;a++){const o=rh[a],u=n[o];if(u===void 0)continue;let c=!0;if(typeof u=="number"?c=u===(o.startsWith("scale")?1:0):c=parseFloat(u)===0,!c||t){const h=aD(u,tx[o]);if(!c){i=!1;const d=MB[o]||o;r+=`${d}(${h}) `}t&&(e[o]=h)}}return r=r.trim(),t?r=t(e,i?"":r):i&&(r="none"),r}function sx(n,e,t){const{style:r,vars:i,transformOrigin:a}=n;let o=!1,u=!1;for(const c in e){const h=e[c];if(ih.has(c)){o=!0;continue}else if(VN(c)){i[c]=h;continue}else{const d=aD(h,tx[c]);c.startsWith("origin")?(u=!0,a[c]=d):r[c]=d}}if(e.transform||(o||t?r.transform=PB(e,n.transform,t):r.transform&&(r.transform="none")),u){const{originX:c="50%",originY:h="50%",originZ:d=0}=a;r.transformOrigin=`${c} ${h} ${d}`}}const ux=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function gD(n,e,t){for(const r in e)!Ir(e[r])&&!mD(r,t)&&(n[r]=e[r])}function VB({transformTemplate:n},e){return oe.useMemo(()=>{const t=ux();return sx(t,e,n),Object.assign({},t.vars,t.style)},[e])}function FB(n,e){const t=n.style||{},r={};return gD(r,t,n),Object.assign(r,VB(n,e)),r}function LB(n,e){const t={},r=FB(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const BB={offset:"stroke-dashoffset",array:"stroke-dasharray"},jB={offset:"strokeDashoffset",array:"strokeDasharray"};function UB(n,e,t=1,r=0,i=!0){n.pathLength=1;const a=i?BB:jB;n[a.offset]=Pe.transform(-r);const o=Pe.transform(e),u=Pe.transform(t);n[a.array]=`${o} ${u}`}const zB=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function vD(n,{attrX:e,attrY:t,attrScale:r,pathLength:i,pathSpacing:a=1,pathOffset:o=0,...u},c,h,d){if(sx(n,u,h),c){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:p,style:g}=n;p.transform&&(g.transform=p.transform,delete p.transform),(g.transform||p.transformOrigin)&&(g.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),g.transform&&(g.transformBox=d?.transformBox??"fill-box",delete p.transformBox);for(const v of zB)p[v]!==void 0&&(g[v]=p[v],delete p[v]);e!==void 0&&(p.x=e),t!==void 0&&(p.y=t),r!==void 0&&(p.scale=r),i!==void 0&&UB(p,i,a,o,!1)}const yD=()=>({...ux(),attrs:{}}),_D=n=>typeof n=="string"&&n.toLowerCase()==="svg";function GB(n,e,t,r){const i=oe.useMemo(()=>{const a=yD();return vD(a,e,_D(r),n.transformTemplate,n.style),{...a.attrs,style:{...a.style}}},[e]);if(n.style){const a={};gD(a,n.style,n),i.style={...a,...i.style}}return i}const HB=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function lx(n){return typeof n!="string"||n.includes("-")?!1:!!(HB.indexOf(n)>-1||/[A-Z]/u.test(n))}function WB(n,e,t,{latestValues:r},i,a=!1,o){const c=(o??lx(n)?GB:LB)(e,r,i,n),h=IB(e,typeof n=="string",a),d=n!==oe.Fragment?{...h,...c,ref:t}:{},{children:p}=e,g=oe.useMemo(()=>Ir(p)?p.get():p,[p]);return oe.createElement(n,{...d,children:g})}function RS(n){const e=[{},{}];return n?.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function cx(n,e,t,r){if(typeof e=="function"){const[i,a]=RS(r);e=e(t!==void 0?t:n.custom,i,a)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[i,a]=RS(r);e=e(t!==void 0?t:n.custom,i,a)}return e}function Zm(n){return Ir(n)?n.get():n}function qB({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,i){return{latestValues:KB(t,r,i,n),renderState:e()}}function KB(n,e,t,r){const i={},a=r(n,{});for(const g in a)i[g]=Zm(a[g]);let{initial:o,animate:u}=n;const c=lv(n),h=pD(n);e&&h&&!c&&n.inherit!==!1&&(o===void 0&&(o=e.initial),u===void 0&&(u=e.animate));let d=t?t.initial===!1:!1;d=d||o===!1;const p=d?u:o;if(p&&typeof p!="boolean"&&!uv(p)){const g=Array.isArray(p)?p:[p];for(let v=0;v<g.length;v++){const b=cx(n,g[v]);if(b){const{transitionEnd:w,transition:E,...T}=b;for(const R in T){let I=T[R];if(Array.isArray(I)){const C=d?I.length-1:0;I=I[C]}I!==null&&(i[R]=I)}for(const R in w)i[R]=w[R]}}}return i}const bD=n=>(e,t)=>{const r=oe.useContext(sv),i=oe.useContext(ov),a=()=>qB(n,e,r,i);return t?a():V1(a)};function hx(n,e,t){const{style:r}=n,i={};for(const a in r)(Ir(r[a])||e.style&&Ir(e.style[a])||mD(a,n)||t?.getValue(a)?.liveStyle!==void 0)&&(i[a]=r[a]);return i}const XB=bD({scrapeMotionValuesFromProps:hx,createRenderState:ux});function xD(n,e,t){const r=hx(n,e,t);for(const i in n)if(Ir(n[i])||Ir(e[i])){const a=rh.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[a]=n[i]}return r}const YB=bD({scrapeMotionValuesFromProps:xD,createRenderState:yD}),$B=Symbol.for("motionComponentSymbol");function bc(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function IS(n,e){if(typeof n=="function")return n(e);bc(n)&&(n.current=e)}function QB(n,e,t){const r=oe.useRef(null);return oe.useCallback(i=>{if(i&&n.onMount&&n.onMount(i),e&&(i?e.mount(i):e.unmount()),t)if(i){const a=IS(t,i);typeof a=="function"&&(r.current=a)}else r.current?(r.current(),r.current=null):IS(t,i)},[e,n,t])}const fx=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ZB="framerAppearId",wD="data-"+fx(ZB),ED=oe.createContext({});function JB(n,e,t,r,i,a){const{visualElement:o}=oe.useContext(sv),u=oe.useContext(fD),c=oe.useContext(ov),h=oe.useContext(ix).reducedMotion,d=oe.useRef(null);r=r||u.renderer,!d.current&&r&&(d.current=r(n,{visualState:e,parent:o,props:t,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:h,isSVG:a}));const p=d.current,g=oe.useContext(ED);p&&!p.projection&&i&&(p.type==="html"||p.type==="svg")&&e6(d.current,t,i,g);const v=oe.useRef(!1);oe.useInsertionEffect(()=>{p&&v.current&&p.update(t,c)});const b=t[wD],w=oe.useRef(!!b&&!window.MotionHandoffIsComplete?.(b)&&window.MotionHasOptimisedAnimation?.(b));return _N(()=>{p&&(v.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),p.scheduleRenderMicrotask(),w.current&&p.animationState&&p.animationState.animateChanges())}),oe.useEffect(()=>{p&&(!w.current&&p.animationState&&p.animationState.animateChanges(),w.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(b)}),w.current=!1),p.enteringChildren=void 0)}),p}function e6(n,e,t,r){const{layoutId:i,layout:a,drag:o,dragConstraints:u,layoutScroll:c,layoutRoot:h,layoutCrossfade:d}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:TD(n.parent)),n.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:!!o||u&&bc(u),visualElement:n,animationType:typeof a=="string"?a:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:c,layoutRoot:h})}function TD(n){if(n)return n.options.allowProjection!==!1?n.projection:TD(n.parent)}function a_(n,{forwardMotionProps:e=!1,type:t}={},r,i){r&&SB(r);const a=t?t==="svg":lx(n),o=a?YB:XB;function u(h,d){let p;const g={...oe.useContext(ix),...h,layoutId:t6(h)},{isStatic:v}=g,b=DB(h),w=o(h,v);if(!v&&F1){n6();const E=r6(g);p=E.MeasureLayout,b.visualElement=JB(n,w,g,i,E.ProjectionNode,a)}return S.jsxs(sv.Provider,{value:b,children:[p&&b.visualElement?S.jsx(p,{visualElement:b.visualElement,...g}):null,WB(n,h,QB(w,b.visualElement,d),w,v,e,a)]})}u.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const c=oe.forwardRef(u);return c[$B]=n,c}function t6({layoutId:n}){const e=oe.useContext(P1).id;return e&&n!==void 0?e+"-"+n:n}function n6(n,e){oe.useContext(fD).strict}function r6(n){const{drag:e,layout:t}=Uc;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function i6(n,e){if(typeof Proxy>"u")return a_;const t=new Map,r=(a,o)=>a_(a,o,n,e),i=(a,o)=>r(a,o);return new Proxy(i,{get:(a,o)=>o==="create"?r:(t.has(o)||t.set(o,a_(o,void 0,n,e)),t.get(o))})}function CD({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function a6({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function o6(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function o_(n){return n===void 0||n===1}function bb({scale:n,scaleX:e,scaleY:t}){return!o_(n)||!o_(e)||!o_(t)}function Fu(n){return bb(n)||SD(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function SD(n){return NS(n.x)||NS(n.y)}function NS(n){return n&&n!=="0%"}function fg(n,e,t){const r=n-t,i=e*r;return t+i}function DS(n,e,t,r,i){return i!==void 0&&(n=fg(n,i,r)),fg(n,t,r)+e}function xb(n,e=0,t=1,r,i){n.min=DS(n.min,e,t,r,i),n.max=DS(n.max,e,t,r,i)}function AD(n,{x:e,y:t}){xb(n.x,e.translate,e.scale,e.originPoint),xb(n.y,t.translate,t.scale,t.originPoint)}const kS=.999999999999,MS=1.0000000000001;function s6(n,e,t,r=!1){const i=t.length;if(!i)return;e.x=e.y=1;let a,o;for(let u=0;u<i;u++){a=t[u],o=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&wc(n,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,AD(n,o)),r&&Fu(a.latestValues)&&wc(n,a.latestValues))}e.x<MS&&e.x>kS&&(e.x=1),e.y<MS&&e.y>kS&&(e.y=1)}function xc(n,e){n.min=n.min+e,n.max=n.max+e}function OS(n,e,t,r,i=.5){const a=on(n.min,n.max,i);xb(n,e,t,a,r)}function wc(n,e){OS(n.x,e.x,e.scaleX,e.scale,e.originX),OS(n.y,e.y,e.scaleY,e.scale,e.originY)}function RD(n,e){return CD(o6(n.getBoundingClientRect(),e))}function u6(n,e,t){const r=RD(n,t),{scroll:i}=e;return i&&(xc(r.x,i.offset.x),xc(r.y,i.offset.y)),r}const PS=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ec=()=>({x:PS(),y:PS()}),VS=()=>({min:0,max:0}),jn=()=>({x:VS(),y:VS()}),wb={current:null},ID={current:!1};function l6(){if(ID.current=!0,!!F1)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>wb.current=n.matches;n.addEventListener("change",e),e()}else wb.current=!1}const c6=new WeakMap;function h6(n,e,t){for(const r in e){const i=e[r],a=t[r];if(Ir(i))n.addValue(r,i);else if(Ir(a))n.addValue(r,jc(i,{owner:n}));else if(a!==i)if(n.hasValue(r)){const o=n.getValue(r);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=n.getStaticValue(r);n.addValue(r,jc(o!==void 0?o:i,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const FS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class f6{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:a,visualState:o},u={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=J1,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=$r.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,rn.render(this.render,!1,!0))};const{latestValues:c,renderState:h}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=t.initial?{...c}:{},this.renderState=h,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=u,this.blockInitialAnimation=!!a,this.isControllingVariants=lv(t),this.isVariantNode=pD(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...p}=this.scrapeMotionValuesFromProps(t,{},this);for(const g in p){const v=p[g];c[g]!==void 0&&Ir(v)&&v.set(c[g])}}mount(e){this.current=e,c6.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(ID.current||l6(),this.shouldReduceMotion=wb.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Us(this.notifyUpdate),Us(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=ih.has(e);r&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&rn.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Uc){const t=Uc[e];if(!t)continue;const{isEnabled:r,Feature:i}=t;if(!this.features[e]&&i&&r(this.props)&&(this.features[e]=new i(this)),this.features[e]){const a=this.features[e];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):jn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<FS.length;r++){const i=FS[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const a="on"+i,o=e[a];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=h6(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=jc(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(bN(r)||wN(r))?r=parseFloat(r):!_B(r)&&zs.test(t)&&(r=iD(e,t)),this.setBaseTarget(e,Ir(r)?r.get():r)),Ir(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const a=cx(this.props,t,this.presenceContext?.custom);a&&(r=a[e])}if(t&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Ir(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new z1),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){nx.render(this.render)}}class ND extends f6{constructor(){super(...arguments),this.KeyframeResolver=sB}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ir(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function DD(n,{style:e,vars:t},r,i){const a=n.style;let o;for(o in e)a[o]=e[o];i?.applyProjectionStyles(a,r);for(o in t)a.setProperty(o,t[o])}function d6(n){return window.getComputedStyle(n)}class p6 extends ND{constructor(){super(...arguments),this.type="html",this.renderInstance=DD}readValueFromInstance(e,t){if(ih.has(t))return this.projection?.isProjecting?fb(t):SL(e,t);{const r=d6(e),i=(VN(t)?r.getPropertyValue(t):r[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return RD(e,t)}build(e,t,r){sx(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return hx(e,t,r)}}const kD=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function m6(n,e,t,r){DD(n,e,void 0,r);for(const i in e.attrs)n.setAttribute(kD.has(i)?i:fx(i),e.attrs[i])}class g6 extends ND{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=jn}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(ih.has(t)){const r=rD(t);return r&&r.default||0}return t=kD.has(t)?t:fx(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return xD(e,t,r)}build(e,t,r){vD(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,i){m6(e,t,r,i)}mount(e){this.isSVGTag=_D(e.tagName),super.mount(e)}}const v6=(n,e)=>e.isSVG??lx(n)?new g6(e):new p6(e,{allowProjection:n!==oe.Fragment});function Sc(n,e,t){const r=n.getProps();return cx(r,e,t!==void 0?t:r.custom,n)}const Eb=n=>Array.isArray(n);function y6(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,jc(t))}function _6(n){return Eb(n)?n[n.length-1]||0:n}function b6(n,e){const t=Sc(n,e);let{transitionEnd:r={},transition:i={},...a}=t||{};a={...a,...r};for(const o in a){const u=_6(a[o]);y6(n,o,u)}}function x6(n){return!!(Ir(n)&&n.add)}function Tb(n,e){const t=n.getValue("willChange");if(x6(t))return t.add(e);if(!t&&Oo.WillChange){const r=new Oo.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function MD(n){return n.props[wD]}const w6=n=>n!==null;function E6(n,{repeat:e,repeatType:t="loop"},r){const i=n.filter(w6),a=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[a]}const T6={type:"spring",stiffness:500,damping:25,restSpeed:10},C6=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),S6={type:"keyframes",duration:.8},A6={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},R6=(n,{keyframes:e})=>e.length>2?S6:ih.has(n)?n.startsWith("scale")?C6(e[1]):T6:A6;function I6({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:a,repeatType:o,repeatDelay:u,from:c,elapsed:h,...d}){return!!Object.keys(d).length}const dx=(n,e,t,r={},i,a)=>o=>{const u=ex(r,n)||{},c=u.delay||r.delay||0;let{elapsed:h=0}=r;h=h-Ha(c);const d={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...u,delay:-h,onUpdate:g=>{e.set(g),u.onUpdate&&u.onUpdate(g)},onComplete:()=>{o(),u.onComplete&&u.onComplete()},name:n,motionValue:e,element:a?void 0:i};I6(u)||Object.assign(d,R6(n,d)),d.duration&&(d.duration=Ha(d.duration)),d.repeatDelay&&(d.repeatDelay=Ha(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let p=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(vb(d),d.delay===0&&(p=!0)),(Oo.instantAnimations||Oo.skipAnimations)&&(p=!0,vb(d),d.delay=0),d.allowFlatten=!u.type&&!u.ease,p&&!a&&e.get()!==void 0){const g=E6(d.keyframes,u);if(g!==void 0){rn.update(()=>{d.onUpdate(g),d.onComplete()});return}}return u.isSync?new Z1(d):new YL(d)};function N6({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function OD(n,e,{delay:t=0,transitionOverride:r,type:i}={}){let{transition:a=n.getDefaultTransition(),transitionEnd:o,...u}=e;r&&(a=r);const c=[],h=i&&n.animationState&&n.animationState.getState()[i];for(const d in u){const p=n.getValue(d,n.latestValues[d]??null),g=u[d];if(g===void 0||h&&N6(h,d))continue;const v={delay:t,...ex(a||{},d)},b=p.get();if(b!==void 0&&!p.isAnimating&&!Array.isArray(g)&&g===b&&!v.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const T=MD(n);if(T){const R=window.MotionHandoffAnimation(T,d,rn);R!==null&&(v.startTime=R,w=!0)}}Tb(n,d),p.start(dx(d,p,g,n.shouldReduceMotion&&eD.has(d)?{type:!1}:v,n,w));const E=p.animation;E&&c.push(E)}return o&&Promise.all(c).then(()=>{rn.update(()=>{o&&b6(n,o)})}),c}function PD(n,e,t,r=0,i=1){const a=Array.from(n).sort((h,d)=>h.sortNodePosition(d)).indexOf(e),o=n.size,u=(o-1)*r;return typeof t=="function"?t(a,o):i===1?a*r:u-a*r}function Cb(n,e,t={}){const r=Sc(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(i=t.transitionOverride);const a=r?()=>Promise.all(OD(n,r,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:h=0,staggerChildren:d,staggerDirection:p}=i;return D6(n,e,c,h,d,p,t)}:()=>Promise.resolve(),{when:u}=i;if(u){const[c,h]=u==="beforeChildren"?[a,o]:[o,a];return c().then(()=>h())}else return Promise.all([a(),o(t.delay)])}function D6(n,e,t=0,r=0,i=0,a=1,o){const u=[];for(const c of n.variantChildren)c.notify("AnimationStart",e),u.push(Cb(c,e,{...o,delay:t+(typeof r=="function"?0:r)+PD(n.variantChildren,c,r,i,a)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(u)}function k6(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(a=>Cb(n,a,t));r=Promise.all(i)}else if(typeof e=="string")r=Cb(n,e,t);else{const i=typeof e=="function"?Sc(n,e,t.custom):e;r=Promise.all(OD(n,i,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function VD(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const M6=ox.length;function FD(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?FD(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<M6;t++){const r=ox[t],i=n.props[r];(Jf(i)||i===!1)&&(e[r]=i)}return e}const O6=[...ax].reverse(),P6=ax.length;function V6(n){return e=>Promise.all(e.map(({animation:t,options:r})=>k6(n,t,r)))}function F6(n){let e=V6(n),t=LS(),r=!0;const i=c=>(h,d)=>{const p=Sc(n,d,c==="exit"?n.presenceContext?.custom:void 0);if(p){const{transition:g,transitionEnd:v,...b}=p;h={...h,...b,...v}}return h};function a(c){e=c(n)}function o(c){const{props:h}=n,d=FD(n.parent)||{},p=[],g=new Set;let v={},b=1/0;for(let E=0;E<P6;E++){const T=O6[E],R=t[T],I=h[T]!==void 0?h[T]:d[T],C=Jf(I),k=T===c?R.isActive:null;k===!1&&(b=E);let L=I===d[T]&&I!==h[T]&&C;if(L&&r&&n.manuallyAnimateOnMount&&(L=!1),R.protectedKeys={...v},!R.isActive&&k===null||!I&&!R.prevProp||uv(I)||typeof I=="boolean")continue;const O=L6(R.prevProp,I);let N=O||T===c&&R.isActive&&!L&&C||E>b&&C,D=!1;const P=Array.isArray(I)?I:[I];let F=P.reduce(i(T),{});k===!1&&(F={});const{prevResolvedValues:j={}}=R,B={...j,...F},J=Y=>{N=!0,g.has(Y)&&(D=!0,g.delete(Y)),R.needsAnimating[Y]=!0;const ee=n.getValue(Y);ee&&(ee.liveStyle=!1)};for(const Y in B){const ee=F[Y],ue=j[Y];if(v.hasOwnProperty(Y))continue;let fe=!1;Eb(ee)&&Eb(ue)?fe=!VD(ee,ue):fe=ee!==ue,fe?ee!=null?J(Y):g.add(Y):ee!==void 0&&g.has(Y)?J(Y):R.protectedKeys[Y]=!0}R.prevProp=I,R.prevResolvedValues=F,R.isActive&&(v={...v,...F}),r&&n.blockInitialAnimation&&(N=!1);const ne=L&&O;N&&(!ne||D)&&p.push(...P.map(Y=>{const ee={type:T};if(typeof Y=="string"&&r&&!ne&&n.manuallyAnimateOnMount&&n.parent){const{parent:ue}=n,fe=Sc(ue,Y);if(ue.enteringChildren&&fe){const{delayChildren:W}=fe.transition||{};ee.delay=PD(ue.enteringChildren,n,W)}}return{animation:Y,options:ee}}))}if(g.size){const E={};if(typeof h.initial!="boolean"){const T=Sc(n,Array.isArray(h.initial)?h.initial[0]:h.initial);T&&T.transition&&(E.transition=T.transition)}g.forEach(T=>{const R=n.getBaseTarget(T),I=n.getValue(T);I&&(I.liveStyle=!0),E[T]=R??null}),p.push({animation:E})}let w=!!p.length;return r&&(h.initial===!1||h.initial===h.animate)&&!n.manuallyAnimateOnMount&&(w=!1),r=!1,w?e(p):Promise.resolve()}function u(c,h){if(t[c].isActive===h)return Promise.resolve();n.variantChildren?.forEach(p=>p.animationState?.setActive(c,h)),t[c].isActive=h;const d=o(c);for(const p in t)t[p].protectedKeys={};return d}return{animateChanges:o,setActive:u,setAnimateFunction:a,getState:()=>t,reset:()=>{t=LS()}}}function L6(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!VD(e,n):!1}function Pu(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function LS(){return{animate:Pu(!0),whileInView:Pu(),whileHover:Pu(),whileTap:Pu(),whileDrag:Pu(),whileFocus:Pu(),exit:Pu()}}class Zs{constructor(e){this.isMounted=!1,this.node=e}update(){}}class B6 extends Zs{constructor(e){super(e),e.animationState||(e.animationState=F6(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();uv(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let j6=0;class U6 extends Zs{constructor(){super(...arguments),this.id=j6++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const z6={animation:{Feature:B6},exit:{Feature:U6}};function ed(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function Rd(n){return{point:{x:n.pageX,y:n.pageY}}}const G6=n=>e=>rx(e)&&n(e,Rd(e));function Vf(n,e,t,r){return ed(n,e,G6(t),r)}const LD=1e-4,H6=1-LD,W6=1+LD,BD=.01,q6=0-BD,K6=0+BD;function Vr(n){return n.max-n.min}function X6(n,e,t){return Math.abs(n-e)<=t}function BS(n,e,t,r=.5){n.origin=r,n.originPoint=on(e.min,e.max,n.origin),n.scale=Vr(t)/Vr(e),n.translate=on(t.min,t.max,n.origin)-n.originPoint,(n.scale>=H6&&n.scale<=W6||isNaN(n.scale))&&(n.scale=1),(n.translate>=q6&&n.translate<=K6||isNaN(n.translate))&&(n.translate=0)}function Ff(n,e,t,r){BS(n.x,e.x,t.x,r?r.originX:void 0),BS(n.y,e.y,t.y,r?r.originY:void 0)}function jS(n,e,t){n.min=t.min+e.min,n.max=n.min+Vr(e)}function Y6(n,e,t){jS(n.x,e.x,t.x),jS(n.y,e.y,t.y)}function US(n,e,t){n.min=e.min-t.min,n.max=n.min+Vr(e)}function dg(n,e,t){US(n.x,e.x,t.x),US(n.y,e.y,t.y)}function Mi(n){return[n("x"),n("y")]}const jD=({current:n})=>n?n.ownerDocument.defaultView:null,zS=(n,e)=>Math.abs(n-e);function $6(n,e){const t=zS(n.x,e.x),r=zS(n.y,e.y);return Math.sqrt(t**2+r**2)}class UD{constructor(e,t,{transformPagePoint:r,contextWindow:i=window,dragSnapToOrigin:a=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=u_(this.lastMoveEventInfo,this.history),v=this.startEvent!==null,b=$6(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!v&&!b)return;const{point:w}=g,{timestamp:E}=hr;this.history.push({...w,timestamp:E});const{onStart:T,onMove:R}=this.handlers;v||(T&&T(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),R&&R(this.lastMoveEvent,g)},this.handlePointerMove=(g,v)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=s_(v,this.transformPagePoint),rn.update(this.updatePoint,!0)},this.handlePointerUp=(g,v)=>{this.end();const{onEnd:b,onSessionEnd:w,resumeAnimation:E}=this.handlers;if(this.dragSnapToOrigin&&E&&E(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const T=u_(g.type==="pointercancel"?this.lastMoveEventInfo:s_(v,this.transformPagePoint),this.history);this.startEvent&&b&&b(g,T),w&&w(g,T)},!rx(e))return;this.dragSnapToOrigin=a,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=i||window;const u=Rd(e),c=s_(u,this.transformPagePoint),{point:h}=c,{timestamp:d}=hr;this.history=[{...h,timestamp:d}];const{onSessionStart:p}=t;p&&p(e,u_(c,this.history)),this.removeListeners=Cd(Vf(this.contextWindow,"pointermove",this.handlePointerMove),Vf(this.contextWindow,"pointerup",this.handlePointerUp),Vf(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Us(this.updatePoint)}}function s_(n,e){return e?{point:e(n.point)}:n}function GS(n,e){return{x:n.x-e.x,y:n.y-e.y}}function u_({point:n},e){return{point:n,delta:GS(n,zD(e)),offset:GS(n,Q6(e)),velocity:Z6(e,.1)}}function Q6(n){return n[0]}function zD(n){return n[n.length-1]}function Z6(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const i=zD(n);for(;t>=0&&(r=n[t],!(i.timestamp-r.timestamp>Ha(e)));)t--;if(!r)return{x:0,y:0};const a=Fi(i.timestamp-r.timestamp);if(a===0)return{x:0,y:0};const o={x:(i.x-r.x)/a,y:(i.y-r.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function J6(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?on(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?on(t,n,r.max):Math.min(n,t)),n}function HS(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function ej(n,{top:e,left:t,bottom:r,right:i}){return{x:HS(n.x,t,i),y:HS(n.y,e,r)}}function WS(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function tj(n,e){return{x:WS(n.x,e.x),y:WS(n.y,e.y)}}function nj(n,e){let t=.5;const r=Vr(n),i=Vr(e);return i>r?t=$f(e.min,e.max-r,n.min):r>i&&(t=$f(n.min,n.max-i,e.min)),Mo(0,1,t)}function rj(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Sb=.35;function ij(n=Sb){return n===!1?n=0:n===!0&&(n=Sb),{x:qS(n,"left","right"),y:qS(n,"top","bottom")}}function qS(n,e,t){return{min:KS(n,e),max:KS(n,t)}}function KS(n,e){return typeof n=="number"?n:n[e]||0}const aj=new WeakMap;class oj{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=jn(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const a=p=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Rd(p).point)},o=(p,g)=>{const{drag:v,dragPropagation:b,onDragStart:w}=this.getProps();if(v&&!b&&(this.openDragLock&&this.openDragLock(),this.openDragLock=hB(v),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Mi(T=>{let R=this.getAxisMotionValue(T).get()||0;if(Wa.test(R)){const{projection:I}=this.visualElement;if(I&&I.layout){const C=I.layout.layoutBox[T];C&&(R=Vr(C)*(parseFloat(R)/100))}}this.originPoint[T]=R}),w&&rn.postRender(()=>w(p,g)),Tb(this.visualElement,"transform");const{animationState:E}=this.visualElement;E&&E.setActive("whileDrag",!0)},u=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g;const{dragPropagation:v,dragDirectionLock:b,onDirectionLock:w,onDrag:E}=this.getProps();if(!v&&!this.openDragLock)return;const{offset:T}=g;if(b&&this.currentDirection===null){this.currentDirection=sj(T),this.currentDirection!==null&&w&&w(this.currentDirection);return}this.updateAxis("x",g.point,T),this.updateAxis("y",g.point,T),this.visualElement.render(),E&&E(p,g)},c=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g,this.stop(p,g),this.latestPointerEvent=null,this.latestPanInfo=null},h=()=>Mi(p=>this.getAnimationState(p)==="paused"&&this.getAxisMotionValue(p).animation?.play()),{dragSnapToOrigin:d}=this.getProps();this.panSession=new UD(e,{onSessionStart:a,onStart:o,onMove:u,onSessionEnd:c,resumeAnimation:h},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:jD(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,i=t||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!i||!r)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:u}=this.getProps();u&&rn.postRender(()=>u(r,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:i}=this.getProps();if(!r||!Sm(e,i,this.currentDirection))return;const a=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=J6(o,this.constraints[e],this.elastic[e])),a.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&bc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=ej(r.layoutBox,e):this.constraints=!1,this.elastic=ij(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Mi(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=rj(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!bc(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const a=u6(r,i.root,this.visualElement.getTransformPagePoint());let o=tj(i.layout.layoutBox,a);if(t){const u=t(a6(o));this.hasMutatedConstraints=!!u,u&&(o=CD(u))}return o}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:i,dragTransition:a,dragSnapToOrigin:o,onDragTransitionEnd:u}=this.getProps(),c=this.constraints||{},h=Mi(d=>{if(!Sm(d,t,this.currentDirection))return;let p=c&&c[d]||{};o&&(p={min:0,max:0});const g=i?200:1e6,v=i?40:1e7,b={type:"inertia",velocity:r?e[d]:0,bounceStiffness:g,bounceDamping:v,timeConstant:750,restDelta:1,restSpeed:10,...a,...p};return this.startAxisValueAnimation(d,b)});return Promise.all(h).then(u)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return Tb(this.visualElement,e),r.start(dx(e,r,0,t,this.visualElement,!1))}stopAnimation(){Mi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Mi(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),i=r[t];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Mi(t=>{const{drag:r}=this.getProps();if(!Sm(t,r,this.currentDirection))return;const{projection:i}=this.visualElement,a=this.getAxisMotionValue(t);if(i&&i.layout){const{min:o,max:u}=i.layout.layoutBox[t],c=a.get()||0;a.set(e[t]-on(o,u,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!bc(t)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Mi(o=>{const u=this.getAxisMotionValue(o);if(u&&this.constraints!==!1){const c=u.get();i[o]=nj({min:c,max:c},this.constraints[o])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Mi(o=>{if(!Sm(o,e,null))return;const u=this.getAxisMotionValue(o),{min:c,max:h}=this.constraints[o];u.set(on(c,h,i[o]))})}addListeners(){if(!this.visualElement.current)return;aj.set(this.visualElement,this);const e=this.visualElement.current,t=Vf(e,"pointerdown",c=>{const{drag:h,dragListener:d=!0}=this.getProps();h&&d&&this.start(c)}),r=()=>{const{dragConstraints:c}=this.getProps();bc(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,a=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),rn.read(r);const o=ed(window,"resize",()=>this.scalePositionWithinConstraints()),u=i.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:h})=>{this.isDragging&&h&&(Mi(d=>{const p=this.getAxisMotionValue(d);p&&(this.originPoint[d]+=c[d].translate,p.set(p.get()+c[d].translate))}),this.visualElement.render())}));return()=>{o(),t(),a(),u&&u()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:a=!1,dragElastic:o=Sb,dragMomentum:u=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:i,dragConstraints:a,dragElastic:o,dragMomentum:u}}}function Sm(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function sj(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class uj extends Zs{constructor(e){super(e),this.removeGroupControls=ji,this.removeListeners=ji,this.controls=new oj(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ji}update(){const{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const XS=n=>(e,t)=>{n&&rn.postRender(()=>n(e,t))};class lj extends Zs{constructor(){super(...arguments),this.removePointerDownListener=ji}onPointerDown(e){this.session=new UD(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:jD(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:XS(e),onStart:XS(t),onMove:r,onEnd:(a,o)=>{delete this.session,i&&rn.postRender(()=>i(a,o))}}}mount(){this.removePointerDownListener=Vf(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Jm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let l_=!1;class cj extends oe.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:i}=this.props,{projection:a}=e;a&&(t.group&&t.group.add(a),r&&r.register&&i&&r.register(a),l_&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),Jm.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:i,isPresent:a}=this.props,{projection:o}=r;return o&&(o.isPresent=a,l_=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==a?o.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?o.promote():o.relegate()||rn.postRender(()=>{const u=o.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),nx.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:i}=e;l_=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function GD(n){const[e,t]=hD(),r=oe.useContext(P1);return S.jsx(cj,{...n,layoutGroup:r,switchLayoutGroup:oe.useContext(ED),isPresent:e,safeToRemove:t})}function hj(n,e,t){const r=Ir(n)?n:jc(n);return r.start(dx("",r,e,t)),r.animation}const fj=(n,e)=>n.depth-e.depth;class dj{constructor(){this.children=[],this.isDirty=!1}add(e){L1(this.children,e),this.isDirty=!0}remove(e){B1(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(fj),this.isDirty=!1,this.children.forEach(e)}}function pj(n,e){const t=$r.now(),r=({timestamp:i})=>{const a=i-t;a>=e&&(Us(r),n(a-e))};return rn.setup(r,!0),()=>Us(r)}const HD=["TopLeft","TopRight","BottomLeft","BottomRight"],mj=HD.length,YS=n=>typeof n=="string"?parseFloat(n):n,$S=n=>typeof n=="number"||Pe.test(n);function gj(n,e,t,r,i,a){i?(n.opacity=on(0,t.opacity??1,vj(r)),n.opacityExit=on(e.opacity??1,0,yj(r))):a&&(n.opacity=on(e.opacity??1,t.opacity??1,r));for(let o=0;o<mj;o++){const u=`border${HD[o]}Radius`;let c=QS(e,u),h=QS(t,u);if(c===void 0&&h===void 0)continue;c||(c=0),h||(h=0),c===0||h===0||$S(c)===$S(h)?(n[u]=Math.max(on(YS(c),YS(h),r),0),(Wa.test(h)||Wa.test(c))&&(n[u]+="%")):n[u]=h}(e.rotate||t.rotate)&&(n.rotate=on(e.rotate||0,t.rotate||0,r))}function QS(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const vj=WD(0,.5,NN),yj=WD(.5,.95,ji);function WD(n,e,t){return r=>r<n?0:r>e?1:t($f(n,e,r))}function ZS(n,e){n.min=e.min,n.max=e.max}function ta(n,e){ZS(n.x,e.x),ZS(n.y,e.y)}function JS(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function eA(n,e,t,r,i){return n-=e,n=fg(n,1/t,r),i!==void 0&&(n=fg(n,1/i,r)),n}function _j(n,e=0,t=1,r=.5,i,a=n,o=n){if(Wa.test(e)&&(e=parseFloat(e),e=on(o.min,o.max,e/100)-o.min),typeof e!="number")return;let u=on(a.min,a.max,r);n===a&&(u-=e),n.min=eA(n.min,e,t,u,i),n.max=eA(n.max,e,t,u,i)}function tA(n,e,[t,r,i],a,o){_j(n,e[t],e[r],e[i],e.scale,a,o)}const bj=["x","scaleX","originX"],xj=["y","scaleY","originY"];function nA(n,e,t,r){tA(n.x,e,bj,t?t.x:void 0,r?r.x:void 0),tA(n.y,e,xj,t?t.y:void 0,r?r.y:void 0)}function rA(n){return n.translate===0&&n.scale===1}function qD(n){return rA(n.x)&&rA(n.y)}function iA(n,e){return n.min===e.min&&n.max===e.max}function wj(n,e){return iA(n.x,e.x)&&iA(n.y,e.y)}function aA(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function KD(n,e){return aA(n.x,e.x)&&aA(n.y,e.y)}function oA(n){return Vr(n.x)/Vr(n.y)}function sA(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class Ej{constructor(){this.members=[]}add(e){L1(this.members,e),e.scheduleRender()}remove(e){if(B1(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let r;for(let i=t;i>=0;i--){const a=this.members[i];if(a.isPresent!==!1){r=a;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Tj(n,e,t){let r="";const i=n.x.translate/e.x,a=n.y.translate/e.y,o=t?.z||0;if((i||a||o)&&(r=`translate3d(${i}px, ${a}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:h,rotate:d,rotateX:p,rotateY:g,skewX:v,skewY:b}=t;h&&(r=`perspective(${h}px) ${r}`),d&&(r+=`rotate(${d}deg) `),p&&(r+=`rotateX(${p}deg) `),g&&(r+=`rotateY(${g}deg) `),v&&(r+=`skewX(${v}deg) `),b&&(r+=`skewY(${b}deg) `)}const u=n.x.scale*e.x,c=n.y.scale*e.y;return(u!==1||c!==1)&&(r+=`scale(${u}, ${c})`),r||"none"}const c_=["","X","Y","Z"],Cj=1e3;let Sj=0;function h_(n,e,t,r){const{latestValues:i}=e;i[n]&&(t[n]=i[n],e.setStaticValue(n,0),r&&(r[n]=0))}function XD(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=MD(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:a}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",rn,!(i||a))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&XD(r)}function YD({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(o={},u=e?.()){this.id=Sj++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Ij),this.nodes.forEach(Mj),this.nodes.forEach(Oj),this.nodes.forEach(Nj)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new dj)}addEventListener(o,u){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new z1),this.eventHandlers.get(o).add(u)}notifyListeners(o,...u){const c=this.eventHandlers.get(o);c&&c.notify(...u)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=cD(o)&&!vB(o),this.instance=o;const{layoutId:u,layout:c,visualElement:h}=this.options;if(h&&!h.current&&h.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||u)&&(this.isLayoutDirty=!0),n){let d,p=0;const g=()=>this.root.updateBlockedByResize=!1;rn.read(()=>{p=window.innerWidth}),n(o,()=>{const v=window.innerWidth;v!==p&&(p=v,this.root.updateBlockedByResize=!0,d&&d(),d=pj(g,250),Jm.hasAnimatedSinceResize&&(Jm.hasAnimatedSinceResize=!1,this.nodes.forEach(cA)))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&h&&(u||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:p,hasRelativeLayoutChanged:g,layout:v})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||h.getDefaultTransition()||Bj,{onLayoutAnimationStart:w,onLayoutAnimationComplete:E}=h.getProps(),T=!this.targetLayout||!KD(this.targetLayout,v),R=!p&&g;if(this.options.layoutRoot||this.resumeFrom||R||p&&(T||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const I={...ex(b,"layout"),onPlay:w,onComplete:E};(h.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I),this.setAnimationOrigin(d,R)}else p||cA(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=v})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Us(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Pj),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&XD(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const p=this.path[d];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:u,layout:c}=this.options;if(u===void 0&&!c)return;const h=this.getTransformTemplate();this.prevTransformTemplateValue=h?h(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(uA);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(lA);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(kj),this.nodes.forEach(Aj),this.nodes.forEach(Rj)):this.nodes.forEach(lA),this.clearAllSnapshots();const u=$r.now();hr.delta=Mo(0,1e3/60,u-hr.timestamp),hr.timestamp=u,hr.isProcessing=!0,J0.update.process(hr),J0.preRender.process(hr),J0.render.process(hr),hr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,nx.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Dj),this.sharedNodes.forEach(Vj)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,rn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){rn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Vr(this.snapshot.measuredBox.x)&&!Vr(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=jn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:u}=this.options;u&&u.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let u=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(u=!1),u&&this.instance){const c=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,u=this.projectionDelta&&!qD(this.projectionDelta),c=this.getTransformTemplate(),h=c?c(this.latestValues,""):void 0,d=h!==this.prevTransformTemplateValue;o&&this.instance&&(u||Fu(this.latestValues)||d)&&(i(this.instance,h),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const u=this.measurePageBox();let c=this.removeElementScroll(u);return o&&(c=this.removeTransform(c)),jj(c),{animationId:this.root.animationId,measuredBox:u,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return jn();const u=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Uj))){const{scroll:h}=this.root;h&&(xc(u.x,h.offset.x),xc(u.y,h.offset.y))}return u}removeElementScroll(o){const u=jn();if(ta(u,o),this.scroll?.wasRoot)return u;for(let c=0;c<this.path.length;c++){const h=this.path[c],{scroll:d,options:p}=h;h!==this.root&&d&&p.layoutScroll&&(d.wasRoot&&ta(u,o),xc(u.x,d.offset.x),xc(u.y,d.offset.y))}return u}applyTransform(o,u=!1){const c=jn();ta(c,o);for(let h=0;h<this.path.length;h++){const d=this.path[h];!u&&d.options.layoutScroll&&d.scroll&&d!==d.root&&wc(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),Fu(d.latestValues)&&wc(c,d.latestValues)}return Fu(this.latestValues)&&wc(c,this.latestValues),c}removeTransform(o){const u=jn();ta(u,o);for(let c=0;c<this.path.length;c++){const h=this.path[c];if(!h.instance||!Fu(h.latestValues))continue;bb(h.latestValues)&&h.updateSnapshot();const d=jn(),p=h.measurePageBox();ta(d,p),nA(u,h.latestValues,h.snapshot?h.snapshot.layoutBox:void 0,d)}return Fu(this.latestValues)&&nA(u,this.latestValues),u}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==hr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==u;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:p}=this.options;if(!this.layout||!(d||p))return;this.resolvedRelativeTargetAt=hr.timestamp;const g=this.getClosestProjectingParent();g&&this.linkedParentVersion!==g.layoutVersion&&!g.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(g&&g.layout?this.createRelativeTarget(g,this.layout.layoutBox,g.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=jn(),this.targetWithTransforms=jn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Y6(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ta(this.target,this.layout.layoutBox),AD(this.target,this.targetDelta)):ta(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?this.createRelativeTarget(g,this.target,g.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||bb(this.parent.latestValues)||SD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,u,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=jn(),this.relativeTargetOrigin=jn(),dg(this.relativeTargetOrigin,u,c),ta(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),u=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===hr.timestamp&&(c=!1),c)return;const{layout:h,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||d))return;ta(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;s6(this.layoutCorrected,this.treeScale,this.path,u),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=jn());const{target:v}=o;if(!v){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(JS(this.prevProjectionDelta.x,this.projectionDelta.x),JS(this.prevProjectionDelta.y,this.projectionDelta.y)),Ff(this.projectionDelta,this.layoutCorrected,v,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!sA(this.projectionDelta.x,this.prevProjectionDelta.x)||!sA(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",v))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ec(),this.projectionDelta=Ec(),this.projectionDeltaWithTransform=Ec()}setAnimationOrigin(o,u=!1){const c=this.snapshot,h=c?c.latestValues:{},d={...this.latestValues},p=Ec();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!u;const g=jn(),v=c?c.source:void 0,b=this.layout?this.layout.source:void 0,w=v!==b,E=this.getStack(),T=!E||E.members.length<=1,R=!!(w&&!T&&this.options.crossfade===!0&&!this.path.some(Lj));this.animationProgress=0;let I;this.mixTargetDelta=C=>{const k=C/1e3;hA(p.x,o.x,k),hA(p.y,o.y,k),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(dg(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Fj(this.relativeTarget,this.relativeTargetOrigin,g,k),I&&wj(this.relativeTarget,I)&&(this.isProjectionDirty=!1),I||(I=jn()),ta(I,this.relativeTarget)),w&&(this.animationValues=d,gj(d,h,this.latestValues,k,R,T)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Us(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=rn.update(()=>{Jm.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=jc(0)),this.currentAnimation=hj(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),o.onUpdate&&o.onUpdate(u)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Cj),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:u,target:c,layout:h,latestValues:d}=o;if(!(!u||!c||!h)){if(this!==o&&this.layout&&h&&$D(this.options.animationType,this.layout.layoutBox,h.layoutBox)){c=this.target||jn();const p=Vr(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+p;const g=Vr(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+g}ta(u,c),wc(u,d),Ff(this.projectionDeltaWithTransform,this.layoutCorrected,u,d)}}registerSharedNode(o,u){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Ej),this.sharedNodes.get(o).add(u);const h=u.options.initialPromotionConfig;u.promote({transition:h?h.transition:void 0,preserveFollowOpacity:h&&h.shouldPreserveFollowOpacity?h.shouldPreserveFollowOpacity(u):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:u,preserveFollowOpacity:c}={}){const h=this.getStack();h&&h.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),u&&this.setOptions({transition:u})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let u=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(u=!0),!u)return;const h={};c.z&&h_("z",o,h,this.animationValues);for(let d=0;d<c_.length;d++)h_(`rotate${c_[d]}`,o,h,this.animationValues),h_(`skew${c_[d]}`,o,h,this.animationValues);o.render();for(const d in h)o.setStaticValue(d,h[d]),this.animationValues&&(this.animationValues[d]=h[d]);o.scheduleRender()}applyProjectionStyles(o,u){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Zm(u?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Zm(u?.pointerEvents)||""),this.hasProjected&&!Fu(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=h.animationValues||h.latestValues;this.applyTransformsToTarget();let p=Tj(this.projectionDeltaWithTransform,this.treeScale,d);c&&(p=c(d,p)),o.transform=p;const{x:g,y:v}=this.projectionDelta;o.transformOrigin=`${g.origin*100}% ${v.origin*100}% 0`,h.animationValues?o.opacity=h===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const b in _b){if(d[b]===void 0)continue;const{correct:w,applyTo:E,isCSSVariable:T}=_b[b],R=p==="none"?d[b]:w(d[b],h);if(E){const I=E.length;for(let C=0;C<I;C++)o[E[C]]=R}else T?this.options.visualElement.renderState.vars[b]=R:o[b]=R}this.options.layoutId&&(o.pointerEvents=h===this?Zm(u?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(uA),this.root.sharedNodes.clear()}}}function Aj(n){n.updateLayout()}function Rj(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=n.layout,{animationType:i}=n.options,a=e.source!==n.layout.source;i==="size"?Mi(d=>{const p=a?e.measuredBox[d]:e.layoutBox[d],g=Vr(p);p.min=t[d].min,p.max=p.min+g}):$D(i,e.layoutBox,t)&&Mi(d=>{const p=a?e.measuredBox[d]:e.layoutBox[d],g=Vr(t[d]);p.max=p.min+g,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[d].max=n.relativeTarget[d].min+g)});const o=Ec();Ff(o,t,e.layoutBox);const u=Ec();a?Ff(u,n.applyTransform(r,!0),e.measuredBox):Ff(u,t,e.layoutBox);const c=!qD(o);let h=!1;if(!n.resumeFrom){const d=n.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:p,layout:g}=d;if(p&&g){const v=jn();dg(v,e.layoutBox,p.layoutBox);const b=jn();dg(b,t,g.layoutBox),KD(v,b)||(h=!0),d.options.layoutRoot&&(n.relativeTarget=b,n.relativeTargetOrigin=v,n.relativeParent=d)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:u,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:h})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function Ij(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Nj(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Dj(n){n.clearSnapshot()}function uA(n){n.clearMeasurements()}function lA(n){n.isLayoutDirty=!1}function kj(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function cA(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function Mj(n){n.resolveTargetDelta()}function Oj(n){n.calcProjection()}function Pj(n){n.resetSkewAndRotation()}function Vj(n){n.removeLeadSnapshot()}function hA(n,e,t){n.translate=on(e.translate,0,t),n.scale=on(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function fA(n,e,t,r){n.min=on(e.min,t.min,r),n.max=on(e.max,t.max,r)}function Fj(n,e,t,r){fA(n.x,e.x,t.x,r),fA(n.y,e.y,t.y,r)}function Lj(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const Bj={duration:.45,ease:[.4,0,.1,1]},dA=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),pA=dA("applewebkit/")&&!dA("chrome/")?Math.round:ji;function mA(n){n.min=pA(n.min),n.max=pA(n.max)}function jj(n){mA(n.x),mA(n.y)}function $D(n,e,t){return n==="position"||n==="preserve-aspect"&&!X6(oA(e),oA(t),.2)}function Uj(n){return n!==n.root&&n.scroll?.wasRoot}const zj=YD({attachResizeListener:(n,e)=>ed(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),f_={current:void 0},QD=YD({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!f_.current){const n=new zj({});n.mount(window),n.setOptions({layoutScroll:!0}),f_.current=n}return f_.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Gj={pan:{Feature:lj},drag:{Feature:uj,ProjectionNode:QD,MeasureLayout:GD}};function gA(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,a=r[i];a&&rn.postRender(()=>a(e,Rd(e)))}class Hj extends Zs{mount(){const{current:e}=this.node;e&&(this.unmount=fB(e,(t,r)=>(gA(this.node,r,"Start"),i=>gA(this.node,i,"End"))))}unmount(){}}class Wj extends Zs{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Cd(ed(this.node.current,"focus",()=>this.onFocus()),ed(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function vA(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),a=r[i];a&&rn.postRender(()=>a(e,Rd(e)))}class qj extends Zs{mount(){const{current:e}=this.node;e&&(this.unmount=gB(e,(t,r)=>(vA(this.node,r,"Start"),(i,{success:a})=>vA(this.node,i,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ab=new WeakMap,d_=new WeakMap,Kj=n=>{const e=Ab.get(n.target);e&&e(n)},Xj=n=>{n.forEach(Kj)};function Yj({root:n,...e}){const t=n||document;d_.has(t)||d_.set(t,{});const r=d_.get(t),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(Xj,{root:n,...e})),r[i]}function $j(n,e,t){const r=Yj(e);return Ab.set(n,t),r.observe(n),()=>{Ab.delete(n),r.unobserve(n)}}const Qj={some:0,all:1};class Zj extends Zs{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:i="some",once:a}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:Qj[i]},u=c=>{const{isIntersecting:h}=c;if(this.isInView===h||(this.isInView=h,a&&!h&&this.hasEnteredView))return;h&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",h);const{onViewportEnter:d,onViewportLeave:p}=this.node.getProps(),g=h?d:p;g&&g(c)};return $j(this.node.current,o,u)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(Jj(e,t))&&this.startObserver()}unmount(){}}function Jj({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const e5={inView:{Feature:Zj},tap:{Feature:qj},focus:{Feature:Wj},hover:{Feature:Hj}},t5={layout:{ProjectionNode:QD,MeasureLayout:GD}},n5={...z6,...e5,...Gj,...t5},Ce=i6(n5,v6);var ZD=function(n,e){return(ZD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function fa(n,e){function t(){this.constructor=n}ZD(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Fe(n,e,t,r){return new(t||(t=Promise))((function(i,a){function o(h){try{c(r.next(h))}catch(d){a(d)}}function u(h){try{c(r.throw(h))}catch(d){a(d)}}function c(h){h.done?i(h.value):new t((function(d){d(h.value)})).then(o,u)}c((r=r.apply(n,[])).next())}))}function Le(n,e){var t,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(h){return(function(d){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&d[0]?r.return:d[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,d[1])).done)return i;switch(r=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return o.label++,{value:d[1],done:!1};case 5:o.label++,r=d[1],d=[0];continue;case 7:d=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){o=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){o.label=d[1];break}if(d[0]===6&&o.label<i[1]){o.label=i[1],i=d;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(d);break}i[2]&&o.ops.pop(),o.trys.pop();continue}d=e.call(n,o)}catch(p){d=[6,p],r=0}finally{t=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}})([c,h])}}}var r5=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(a){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];return i5(r,o[0],o[1]),o.join("=")})),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach((function(a){var o=a.split(":"),u=o[0],c=o[1];e.urlFlags[u]=(function(h,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+h+".")})(u,c)}))}},n})();function i5(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function ge(){return JD}var JD=null,pg=new Map,Rb=new Map;function ek(n,e){var t=nk(n,e);return pg.get(t)}function a5(n){return Rb.get(n)}function yA(n){for(var e=pg.entries(),t=[];;){var r=e.next(),i=r.done,a=r.value;if(i)break;var o=a[0],u=a[1];o.split("_")[0]===n&&t.push(u)}return t}function tk(n){var e=n.kernelName,t=n.backendName,r=nk(e,t);if(pg.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");pg.set(r,n)}function o5(n){var e=n.kernelName;Rb.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),Rb.set(e,n)}function nk(n,e){return e+"_"+n}function Ib(n,e,t){return Math.max(n,Math.min(e,t))}function rk(n){return n%2==0?n:n+1}function s5(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function H(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Pt(n,e,t){t===void 0&&(t=""),H(rr(n,e),(function(){return t+" Shapes "+n+" and "+e+" must match"}))}function ah(n){H(n!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function zc(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||qa(n)&&!t)for(var r=0;r<n.length;++r)zc(n[r],e,t);else e.push(n);return e}function je(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function rr(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function bn(n){return n%1==0}function u5(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function Nb(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Ac(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function _A(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise((function(r,i){var a=0,o=function(){if(n())r();else{a++;var u=e(a);t!=null&&a>=t?i():setTimeout(o,u)}};o()}))}function l5(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var a=n.slice();return a[r]=e/t,a}function qn(n,e){var t=e.length;return H((n=n==null?e.map((function(r,i){return i})):[].concat(n)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n})),H(n.every((function(r){return bn(r)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(r){return r<0?t+r:r}))}function zu(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||i?null:qn(e,n).sort(),o=0,u=0;u<n.length;++u){if(a!=null){if(a[o]===u&&n[u]!==1)throw new Error("Can't squeeze axis "+u+" since its dim '"+n[u]+"' is not 1");(a[o]==null||a[o]>u)&&n[u]===1&&(t.push(n[u]),r.push(u)),a[o]<=u&&o++}n[u]!==1&&(t.push(n[u]),r.push(u))}return{newShape:t,keptDims:r}}function td(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function mg(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function c5(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function h5(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function f5(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function qa(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function ik(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function d5(n){if(n==null)return 0;var e=0;return n.forEach((function(t){return e+=t.length})),e}function px(n){return typeof n=="string"||n instanceof String}function p5(n){return typeof n=="boolean"}function m5(n){return typeof n=="number"}function Id(n){return Array.isArray(n)?Id(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":m5(n)?"float32":px(n)?"string":p5(n)?"bool":"float32"}function Db(n){return!!(n&&n.constructor&&n.call&&n.apply)}function kb(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Ka(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function ak(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=zc(n)),t&&c5(n,e),(function(a,o){return a instanceof Float32Array&&o==="float32"||a instanceof Int32Array&&o==="int32"||a instanceof Uint8Array&&o==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function bA(n,e){if(n.length===0)return e[0];var t=n.reduce((function(r,i){return r*i}));if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(i,a,o){var u=new Array;if(a.length===1)for(var c=a[0],h=0;h<c;h++)u[h]=o[i+h];else{c=a[0];var d=a.slice(1),p=d.reduce((function(g,v){return g*v}));for(h=0;h<c;h++)u[h]=r(i+h*p,d,o)}return u})(0,n,e)}function ok(n,e){for(var t=Nd(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Nd(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Ba(){return ge().platform.now()}function sk(n){n.forEach((function(e){H(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function g5(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ge().platform.encode(n,e)}function gg(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ge().platform.decode(n,e)}function xA(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function v5(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var y5=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new _5)}return n.prototype.profileKernel=function(e,t,r){var i,a=this,o=this.backendTimer.time((function(){i=r()}));return i.forEach((function(u){u.data().then((function(c){(function(h,d,p){if(d!=="float32")return!1;for(var g=0;g<h.length;g++){var v=h[g];if(isNaN(v)||!isFinite(v))return console.warn("Found "+v+" in the result of '"+p+"'"),!0}})(c,u.dtype,e),o.then((function(h){var d="";h.getExtraProfileInfo!=null&&(d=h.getExtraProfileInfo()),a.logger.logKernelProfile(e,u,c,h.kernelMs,t,d)}))}))})),i},n})(),_5=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,a,o){var u=typeof i=="number"?Ac(i+"ms",9):i.error,c=Ac(e,25),h=t.rank,d=t.size,p=Ac(t.shape.toString(),14),g="";for(var v in a){var b=a[v].shape||t.shape,w=b.length;g+=v+": "+w+"D "+(w>0?b:"")+" "}console.log("%c"+c+"	%c"+u+"	%c"+h+"D "+p+"	%c"+d+"	%c"+g+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n})(),wA=20,xf=3,p_=7;function b5(n,e,t,r){var i=Ka(e),a=(function(h,d,p,g){var v=je(d),b=g[g.length-1],w=new Array(b).fill(0),E=d.length,T=p==="complex64"?Ef(h):h;if(E>1)for(var R=0;R<v/b;R++)for(var I=R*b,C=0;C<b;C++)w[C]=Math.max(w[C],wf(T[I+C],0,p).length);return w})(n,e,t,i),o=e.length,u=(function h(d,p,g,v,b,w){w===void 0&&(w=!0);var E=g==="complex64"?2:1,T=p[0],R=p.length;if(R===0)return g==="complex64"?[wf(Ef(d)[0],0,g)]:g==="bool"?[uk(d[0])]:[d[0].toString()];if(R===1){if(T>wA){var I=xf*E,C=Array.from(d.slice(0,I)),k=Array.from(d.slice((T-xf)*E,T*E));return g==="complex64"&&(C=Ef(C),k=Ef(k)),["["+C.map((function(ne,q){return wf(ne,b[q],g)})).join(", ")+", ..., "+k.map((function(ne,q){return wf(ne,b[T-xf+q],g)})).join(", ")+"]"]}return["["+(g==="complex64"?Ef(d):Array.from(d)).map((function(ne,q){return wf(ne,b[q],g)})).join(", ")+"]"]}var L=p.slice(1),O=v.slice(1),N=v[0]*E,D=[];if(T>wA){for(var P=0;P<xf;P++){var F=(j=P*N)+N;D.push.apply(D,h(d.slice(j,F),L,g,O,b,!1))}for(D.push("..."),P=T-xf;P<T;P++)F=(j=P*N)+N,D.push.apply(D,h(d.slice(j,F),L,g,O,b,P===T-1))}else for(P=0;P<T;P++){var j;F=(j=P*N)+N,D.push.apply(D,h(d.slice(j,F),L,g,O,b,P===T-1))}var B=R===2?",":"";for(D[0]="["+D[0]+B,P=1;P<D.length-1;P++)D[P]=" "+D[P]+B;var J=`,
`;for(P=2;P<R;P++)J+=`
`;return D[D.length-1]=" "+D[D.length-1]+"]"+(w?"":J),D})(n,e,t,i,a),c=["Tensor"];return r&&(c.push("  dtype: "+t),c.push("  rank: "+o),c.push("  shape: ["+e+"]"),c.push("  values:")),c.push(u.map((function(h){return"    "+h})).join(`
`)),c.join(`
`)}function wf(n,e,t){return Ac(Array.isArray(n)?parseFloat(n[0].toFixed(p_))+" + "+parseFloat(n[1].toFixed(p_))+"j":px(n)?"'"+n+"'":t==="bool"?uk(n):parseFloat(n.toFixed(p_)).toString(),e)}function uk(n){return n===0?"false":"true"}function Ef(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var nd=(function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=je(e),r!=null){var a=r.length;H(a===this.size,(function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+i.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||mg(t,this.size),this.strides=Ka(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),H(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var a=this.locToIndex(r);this.values[a]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,a=e;i<a.length;i++){var o=a[i];if(o<0||o>=this.shape[r]){var u="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(u)}r++}for(var c=e[e.length-1],h=0;h<e.length-1;++h)c+=this.strides[h]*e[h];return this.values[c]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return ja().makeTensor(this.values,this.shape,this.dtype)},n})(),ja=null,pe=null,lk=null,an=(function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=je(e),this.strides=Ka(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),H(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,a){return this.throwIfDisposed(),this.reshape([e,t,r,i,a])},n.prototype.asType=function(e){return this.throwIfDisposed(),pe.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Fe(this,void 0,void 0,(function(){var e;return Le(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,pe.buffer(this.shape,this.dtype,e)]}}))}))},n.prototype.bufferSync=function(){return pe.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Fe(this,void 0,void 0,(function(){var e;return Le(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,bA(this.shape,e)]}}))}))},n.prototype.arraySync=function(){return bA(this.shape,this.dataSync())},n.prototype.data=function(){return Fe(this,void 0,void 0,(function(){var e,t;return Le(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ja().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map((function(i){return gg(i)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ja().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return gg(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Fe(this,void 0,void 0,(function(){var e;return Le(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ja().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(ja().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),pe.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),pe.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),pe.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),pe.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),pe.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),pe.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),pe.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),b5(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),pe.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),pe.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),pe.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),pe.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),pe.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),pe.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),pe.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),pe.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),pe.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),pe.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),pe.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),pe.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,a){return r===void 0&&(r=.001),lk("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,i,r)},n.prototype.batchNorm=function(e,t,r,i,a){return a===void 0&&(a=.001),this.throwIfDisposed(),pe.batchNorm(this,e,t,r,i,a)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),pe.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),pe.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),pe.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),pe.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),pe.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),pe.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),pe.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),pe.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),pe.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),pe.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),pe.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),pe.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),pe.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),pe.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),pe.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),pe.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),pe.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),pe.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),pe.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),pe.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),pe.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),pe.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),pe.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),pe.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),pe.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),pe.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),pe.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),pe.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),pe.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),pe.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),pe.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),pe.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),pe.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),pe.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),pe.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),pe.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),pe.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),pe.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),pe.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),pe.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),pe.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),pe.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),pe.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),pe.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),pe.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),pe.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),pe.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),pe.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),pe.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),pe.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),pe.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),pe.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),pe.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),pe.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),pe.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),pe.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),pe.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),pe.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),pe.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),pe.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),pe.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),pe.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),pe.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),pe.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),pe.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),pe.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),pe.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),pe.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),pe.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),pe.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),pe.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),pe.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),pe.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),pe.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),pe.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),pe.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),pe.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),pe.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),pe.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),pe.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),pe.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),pe.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),pe.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),pe.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),pe.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),pe.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),pe.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),pe.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,a,o){return i===void 0&&(i="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),pe.conv1d(this,e,t,r,i,a,o)},n.prototype.conv2d=function(e,t,r,i,a,o){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),pe.conv2d(this,e,t,r,i,a,o)},n.prototype.conv2dTranspose=function(e,t,r,i,a){return this.throwIfDisposed(),pe.conv2dTranspose(this,e,t,r,i,a)},n.prototype.depthwiseConv2D=function(e,t,r,i,a,o){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),pe.depthwiseConv2d(this,e,t,r,i,a,o)},n.prototype.separableConv2d=function(e,t,r,i,a,o){return a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),pe.separableConv2d(this,e,t,r,i,a,o)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),pe.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),pe.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),pe.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,a){return this.throwIfDisposed(),pe.pool(this,e,t,r,i,a)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),ja().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),pe.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),pe.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),pe.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),pe.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,a,o,u,c){return i===void 0&&(i=0),a===void 0&&(a=0),o===void 0&&(o=0),u===void 0&&(u=0),c===void 0&&(c=0),this.throwIfDisposed(),pe.stridedSlice(this,e,t,r,i,a,o,u,c)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),pe.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),pe.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),pe.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),pe.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),pe.spectral.irfft(this)},n})();Object.defineProperty(an,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var EA,Mb,Ob,Pb,Vb,Gc=(function(n){function e(t,r,i,a){var o=n.call(this,t.shape,t.dtype,t.dataId,a)||this;return o.trainable=r,o.name=i,o}return fa(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!rr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");ja().disposeTensor(this),this.dataId=t.dataId,ja().incRef(this,null)},e.prototype.dispose=function(){ja().disposeVariable(this),this.isDisposedInternal=!0},e})(an);Object.defineProperty(Gc,Symbol.hasInstance,{value:function(n){return n instanceof an&&n.assign!=null&&n.assign instanceof Function}}),(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(EA||(EA={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Mb||(Mb={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Ob||(Ob={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Pb||(Pb={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Vb||(Vb={}));var x5={float32:Pb,int32:Mb,bool:Ob,complex64:Vb};function dr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return x5[n][e]}function m_(n){return dr(n,"int32")}function un(n,e){if(n.dtype===e.dtype)return[n,e];var t=dr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function w5(n,e){H(n.dtype===e.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"}))}function ck(n){var e=[];return(function t(r,i,a){if(r!=null){if(r instanceof an)return void i.push(r);if(o=r,!(!Array.isArray(o)&&typeof o!="object")){var o,u=r;for(var c in u){var h=u[c];a.has(h)||(a.add(h),t(h,i,a))}}}})(n,e,new Set),e}var g_,TA=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),E5=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new TA}return n.prototype.ready=function(){return Fe(this,void 0,void 0,(function(){var e,t,r;return Le(this,(function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Fe(this,void 0,void 0,(function(){var t,r,i;return Le(this,(function(a){switch(a.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=a.sent(),[3,3];case 2:i=r,a.label=3;case 3:if(!i)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new y5(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var e=this;yA(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(e){var t=this;yA(e).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])}))},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var a=++this.pendingBackendInitId,o=i.then((function(u){return!(a<t.pendingBackendInitId)&&(t.registry[e]=u,t.pendingBackendInit=null,!0)})).catch((function(u){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),!1)}));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(u){return console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),a=i.success,o=i.asyncInit;if(o||a)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,a=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,a,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return i.startScope(a)}),(function(){return i.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(a){throw t(),a}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(i){return{x:function(){return i.toFloat()}}}),[]),t},n.prototype.runKernel=function(e,t,r,i,a){return this.runKernelFunc(null,t,null,e,r,i,a)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),a=0;r.forEach((function(c){a+=c.dtype==="complex64"?3:1}));var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=i-t-a-o;if(u>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+u+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,a,o,u){var c,h=this;o===void 0&&(o=[]),u===void 0&&(u=[]);var d=[],p=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var g,v=function(R){p&&(d=R.map((function(I){return h.keep(h.clone(I))})))},b=this.state.numBytes,w=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var E,T=ek(i,this.backendName);return g=T!=null?function(){var R=h.backend.numDataIds();E=T.kernelFunc({inputs:t,attrs:a,backend:h.backend});var I=Array.isArray(E)?E:[E];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(i,R,I);var C=I.map((function(L){var O=L.dataId,N=L.shape,D=L.dtype;return h.makeTensorFromDataId(O,N,D)})),k=C.filter((function(L,O){return u[O]}));return v((o||[]).slice().concat(k)),C}:function(){var R=h.backend.numDataIds();E=h.tidy((function(){return e(h.backend,v)}));var I=Array.isArray(E)?E:[E];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(i,R,I),I},this.scopedRun((function(){return h.state.kernelDepth++}),(function(){return h.state.kernelDepth--}),(function(){c=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(i,t,(function(){return g()})):g()})),p&&this.addTapeNode(i,t,c,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-b,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-w,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(R){return t[R].shape})),outputShapes:c.map((function(R){return R.shape}))}),Array.isArray(E)?c:c[0]},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var a=e;r==="string"&&px(e[0])&&(a=e.map((function(d){return g5(d)})));var o=i.write(a,t,r),u=new an(t,r,o,this.nextTensorId());if(this.incRef(u,i),r==="string"){var c=this.state.tensorInfo.get(o),h=d5(a);this.state.numBytes+=h-c.bytes,c.bytes=h}return u},n.prototype.makeTensorFromDataId=function(e,t,r,i){var a=new an(t,r=r||"float32",e,this.nextTensorId());return this.incRef(a,i),a},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var a=new Gc(e,t,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*ik(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Gc||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Fe(this,void 0,void 0,(function(){var t,r;return Le(this,(function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(a){return a.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,a){var o=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:a},c=a5(e);c!=null&&(i=c.gradFunc),i!=null&&(u.gradient=function(h){return h=h.map((function(d,p){if(d==null){var g=r[p],v=Nd(g.size,g.dtype);return o.makeTensor(v,g.shape,g.dtype)}return d})),i(h.length>1?h:h[0],a)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=ck(e),i=new Set(r.map((function(c){return c.id}))),a=0;a<this.state.activeScope.track.length;a++){var o=this.state.activeScope.track[a];o.kept||i.has(o.id)||o.dispose()}var u=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(c){c.kept||c.scopeId!==u.id||t.track(c)}))},n.prototype.gradients=function(e,t,r,i){var a=this;if(i===void 0&&(i=!1),H(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));H(o instanceof an,(function(){return"The result y returned by f() must be a tensor."}));var u=(function(c,h,d){for(var p={},g={},v=0;v<h.length;v++)p[h[v].id]=!0;for(v=0;v<c.length;v++){var b=(L=c[v]).inputs;for(var w in b){for(var E=b[w],T=!1,R=0;R<h.length;R++)if(p[E.id]){L.outputs.forEach((function(P){return p[P.id]=!0})),T=!0,g[L.id]=!0;break}if(T)break}}var I={};I[d.id]=!0;var C={};for(v=c.length-1;v>=0;v--)for(b=(L=c[v]).inputs,R=0;R<L.outputs.length;R++)if(I[L.outputs[R].id]){for(var w in b)I[b[w].id]=!0,C[L.id]=!0;break}var k=[];for(v=0;v<c.length;v++){var L;if(g[(L=c[v]).id]&&C[L.id]){var O={};for(var w in L.inputs){var N=L.inputs[w];p[N.id]&&(O[w]=N)}var D=Object.assign({},L);D.inputs=O,D.outputs=L.outputs,k.push(D)}}return k})(this.state.activeTape,t,o);if(!i&&u.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var c,h,d={};d[o.id]=r??(c=o.shape,h=ok(je(c),"float32"),Z.makeTensor(h,c,"float32")),(function(g,v,b){for(var w=function(T){var R=v[T],I=[];if(R.outputs.forEach((function(O){var N=g[O.id];N!=null?I.push(N):I.push(null)})),R.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+R.kernelName+".");var C=R.gradient(I),k=function(O){if(!(O in C))throw new Error("Cannot backprop through input "+O+". Available gradients found: "+Object.keys(C)+".");var N=b((function(){return C[O]()}));if(N.dtype!=="float32")throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input "+O+" must have 'float32' dtype, but has '"+N.dtype+"'");var D=R.inputs[O];if(!rr(N.shape,D.shape))throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input '"+O+"' has shape '"+N.shape+"', which does not match the shape of the input '"+D.shape+"'");if(g[D.id]==null)g[D.id]=N;else{var P=g[D.id];g[D.id]=P.add(N),P.dispose()}};for(var L in R.inputs)k(L)},E=v.length-1;E>=0;E--)w(E)})(d,u,(function(g){return a.tidy(g)}));var p=t.map((function(g){return d[g.id]}));return a.state.gradientDepth===0&&(a.state.activeTape.forEach((function(g){for(var v=0,b=g.saved;v<b.length;v++)b[v].dispose()})),a.state.activeTape=null),{value:o,grads:p}}))},n.prototype.customGrad=function(e){var t=this;return H(Db(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];H(i.every((function(u){return u instanceof an})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return i.forEach((function(u,c){o[c]=u})),t.runKernelFunc((function(u,c){return H((r=e.apply(void 0,i.concat([c]))).value instanceof an,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),H(Db(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),o,(function(u,c){var h=r.gradFunc(u,c),d=Array.isArray(h)?h:[h];H(d.length===i.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),H(d.every((function(g){return g instanceof an})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var p={};return d.forEach((function(g,v){p[v]=function(){return g}})),p}))}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Fe(this,void 0,void 0,(function(){var t,r;return Le(this,(function(i){switch(i.label){case 0:return t=Ba(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Ba()-t,[2,r]}}))}))},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new TA,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),Z=(function(){var n=(function(){if(g_==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}g_=t}return g_})();if(n._tfengine==null){var e=new r5(n);n._tfengine=new E5(e)}return(function(t){JD=t})(n._tfengine.ENV),ja=function(){return n._tfengine},n._tfengine})();function hk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var So=ge();So.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),So.registerFlag("IS_BROWSER",(function(){return hk()})),So.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),So.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),So.registerFlag("PROD",(function(){return!1})),So.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return So.getBool("DEBUG")})),So.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),So.registerFlag("IS_TEST",(function(){return!1}));var rd,fi,hi,Lu={},v_={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function T5(n,e){Lu[n]=e}function to(n){n in Lu||(Lu[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(i){i.preventDefault(),delete Lu[t]}),!1),t===1?r.getContext("webgl",v_)||r.getContext("experimental-webgl",v_):r.getContext("webgl2",v_)})(n));var e=Lu[n];return e.isContextLost()?(delete Lu[n],to(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Lu[n])}function cv(n,e){return[e,n]}function Lf(n){var e=je(n);return Nb(Math.ceil(e/4))}function Dd(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function mx(n,e){var t,r,i,a,o,u,c,h,d,p=n;return ge().getNumber("WEBGL_VERSION")===2?(t=p.R32F,r=p.R16F,i=p.RGBA16F,a=p.RGBA32F,o=p.RED,u=4,c=1,h=p.HALF_FLOAT,d=p.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,a=p.RGBA,o=n.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}function Ue(n,e,t){var r=t();return e&&(function(i){var a=i.getError();if(a!==i.NO_ERROR)throw new Error("WebGL Error: "+R5(i,a))})(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(rd||(rd={})),(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(fi||(fi={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(hi||(hi={}));var C5=596e-10,S5=65504;function A5(n){return!!(ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||C5<Math.abs(n)&&Math.abs(n)<S5)}function R5(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Am(n,e,t){return jo(n,e,(function(){return n.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function I5(n,e,t){var r=jo(n,e,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Ue(n,e,(function(){return n.shaderSource(r,t)})),Ue(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function N5(n,e,t){var r=jo(n,e,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Ue(n,e,(function(){return n.shaderSource(r,t)})),Ue(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(i,a){var o=D5.exec(a);if(o==null)return console.log("Couldn't parse line number in error: "+a),void console.log(i);for(var u=+o[1],c=i.split(`
`),h=c.length.toString().length+2,d=c.map((function(E,T){return Ac((T+1).toString(),h)+E})),p=0,g=0;g<d.length;g++)p=Math.max(d[g].length,p);var v=d.slice(0,u-1),b=d.slice(u-1,u),w=d.slice(u);console.log(v.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Ac(b[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var y_,__,D5=/ERROR: [0-9]+:([0-9]+):/g;function k5(n,e){return jo(n,e,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function M5(n,e,t){if(Ue(n,e,(function(){return n.linkProgram(t)})),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function b_(n,e,t){if(Ue(n,e,(function(){return n.validateProgram(t)})),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function O5(n,e,t){var r=jo(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Ue(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),Ue(n,e,(function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function P5(n,e,t){var r=jo(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Ue(n,e,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)})),Ue(n,e,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function V5(n,e){return jo(n,e,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function F5(n,e){var t=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function L5(n,e){return jo(n,e,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function CA(n,e,t,r,i,a,o,u){var c=n.getAttribLocation(t,r);return c!==-1&&(Ue(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,i)})),Ue(n,e,(function(){return n.vertexAttribPointer(c,a,n.FLOAT,!1,o,u)})),Ue(n,e,(function(){return n.enableVertexAttribArray(c)})),!0)}function B5(n,e,t,r){H5(n,r),Ue(n,e,(function(){return n.activeTexture(n.TEXTURE0+r)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)}))}function j5(n,e,t,r){return jo(n,e,(function(){return n.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function U5(n,e,t){return n.getUniformLocation(e,t)}function z5(n,e,t,r,i,a){Ue(n,e,(function(){return B5(n,e,r,a)})),Ue(n,e,(function(){return n.uniform1i(i,a)}))}function x_(n,e,t,r){Ue(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),Ue(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}))}function SA(n,e,t){Ue(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)})),Ue(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function Rm(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+G5(n,e))}function G5(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function jo(n,e,t,r){var i=Ue(n,e,(function(){return t()}));if(i==null)throw new Error(r);return i}function H5(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function vg(n,e){return e===void 0&&(e=2),je(n.slice(0,n.length-e))}function yg(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function w_(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[vg(n)].concat(yg(n))),e}function W5(n,e){var t;e===void 0&&(e=!1);var r=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map((function(h,d){return d>=n.length-2?rk(n[d]):n[d]}))).length===1&&(n=[2,n[0]])),n.length!==2){var i=zu(n);n=i.newShape}var a=je(n);if(n.length<=1&&a<=r)return[1,a];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var o=vg(n),u=2,c=2;return n.length&&(u=(t=yg(n))[0],c=t[1]),Nb(a=o*(u/2)*(c/2)).map((function(h){return 2*h}))}return Nb(a)}function Im(n){return n%2==0}function Nm(n,e){if(rr(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Im(t)&&Im(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Im(n[0])&&Im(e[0])}function q5(n){if(y_==null){var e=to(n);y_=e.getParameter(e.MAX_TEXTURE_SIZE)}return y_}function K5(n){if(__==null){var e=to(n);__=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,__)}function X5(n){if(n===0)return 0;var e=to(n);return Li(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Li(e,"EXT_disjoint_timer_query")?1:0}function Li(n,e){return n.getExtension(e)!=null}function AA(n){try{if(to(n)!=null)return!0}catch{return!1}return!1}function Y5(n){if(n===0)return!1;var e=to(n);if(n===1){if(!Li(e,"OES_texture_float"))return!1}else if(!Li(e,"EXT_color_buffer_float"))return!1;return Fb(e)}function $5(n){if(n===0)return!1;var e=to(n);if(n!==1){if(Li(e,"EXT_color_buffer_float"))return Fb(e);if(Li(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(r,i){var a=mx(r,i),o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var u=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,u),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.deleteFramebuffer(u),c})(e,t)}return!1}return!!Li(e,"OES_texture_float")&&!!Li(e,"WEBGL_color_buffer_float")&&Fb(e)}function Fb(n){var e=mx(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function Q5(n){return n===2&&to(n).fenceSync!=null}var Qe=ge();function fk(n){ge().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Oe(n,e){return Z.tidy(n,e)}function Zr(n){ck(n).forEach((function(e){return e.dispose()}))}function Z5(n){return Z.keep(n)}function _g(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];ge().getBool("IS_TEST")||console.warn.apply(console,n)}function Js(n,e){var t=n;if(qa(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||qa(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&ge().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function i(a,o,u){if(u=u||[],!Array.isArray(a)&&!qa(a))return void H(o.length===0,(function(){return"Element arr["+u.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"}));H(o.length>0,(function(){return"Element arr["+u.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"})),H(a.length===o[0],(function(){return"Element arr["+u.join("][")+"] should have "+o[0]+" elements, but has "+a.length+" elements"}));for(var c=o.slice(1),h=0;h<a.length;++h)i(a[h],c,u.concat(h))})(n,r,[]),r}function RA(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function z(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof an)return RA(r,n.dtype,e,t),n;var i=Id(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),RA(r,i,e,t),n==null||!qa(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var a=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=Js(n,i);qa(n)||Array.isArray(n)||(n=[n]);var u=i!=="string"?ak(n,i,ge().getBool("DEBUG")):zc(n,[],!0);return Z.makeTensor(u,o,i)}function bg(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(i,a){return z(i,e+"["+a+"]",t)}),r)}function dk(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function J5(n,e,t){for(var r=n.length+e.length,i=[],a=0,o=0,u=0;u<r;u++)t.indexOf(u)===-1?i.push(n[a++]):i.push(e[o++]);return i}function xr(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map((function(a){return n[a]}))]}function Jr(n,e){return J5(n,e.map((function(t){return 1})),e)}function ci(n,e,t){H(dk(e,t),(function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function no(n,e){if(dk(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach((function(i){return t.push(i)})),t}function gx(n){return n.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function ro(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function eU(n,e){var t=n[0].length;n.forEach((function(i,a){H(i.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+t+")"}))})),H(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=n[0];n.forEach((function(i,a){for(var o=0;o<t;o++)H(o===e||i[o]===r[o],(function(){return"Error in concat"+t+"D: Shape of tensors["+a+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."}))}))}function Hc(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function X(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];Z.startScope(t);try{var u=r.apply(void 0,a);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Z.endScope(u),u}catch(c){throw Z.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Qe.registerFlag("HAS_WEBGL",(function(){return Qe.getNumber("WEBGL_VERSION")>0})),Qe.registerFlag("WEBGL_VERSION",(function(){return AA(2)?2:AA(1)?1:0})),Qe.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return Qe.get("WEBGL_VERSION")===2})),Qe.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Qe.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Qe.registerFlag("WEBGL_PACK",(function(){return Qe.getBool("HAS_WEBGL")})),Qe.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_PACK_CLIP",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Qe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_PACK_REDUCE",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_CONV_IM2COL",(function(){return Qe.getBool("WEBGL_PACK")})),Qe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return q5(Qe.getNumber("WEBGL_VERSION"))})),Qe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return K5(Qe.getNumber("WEBGL_VERSION"))})),Qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=Qe.getNumber("WEBGL_VERSION");return n===0?0:X5(n)})),Qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Qe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),Qe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Y5(Qe.getNumber("WEBGL_VERSION"))})),Qe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Qe.getBool("WEBGL_FORCE_F16_TEXTURES")&&Qe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Qe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return $5(Qe.getNumber("WEBGL_VERSION"))})),Qe.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Q5(Qe.getNumber("WEBGL_VERSION"))})),Qe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Qe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),lk=fk;var fr=X({complex_:function(n,e){var t=z(n,"real","complex"),r=z(e,"imag","complex");return Pt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),Z.runKernelFunc((function(i){return i.complex(t,r)}),{$real:t,$imag:r})}}),Pi=X({real_:function(n){var e=z(n,"input","real");return Z.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),Ua=X({imag_:function(n){var e=z(n,"input","imag");return Z.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function pr(n,e,t){return eu(n,e,Js(n,t),t)}function eu(n,e,t,r){if(r==null&&(r=Id(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!qa(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){sk(e);var i=je(e),a=je(t);H(i===a,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<t.length;++o){var u=t[o],c=o!==t.length-1||u!==je(e.slice(o));H(t[o]===e[o]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return qa(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?ak(n,r,ge().getBool("DEBUG")):zc(n,[],!0),Z.makeTensor(n,e,r)}function Re(n,e){if((qa(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&qa(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eu(n,[],[],e)}function kn(n,e){ah(n);var t=Js(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eu(n,null,t,e)}function Ns(n,e,t){if(ah(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Js(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eu(n,e,r,t)}function vx(n,e,t){if(ah(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Js(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return eu(n,e,r,t)}function Kr(n,e,t){if(ah(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Js(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return eu(n,e,r,t)}function tU(n,e,t){if(ah(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Js(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return eu(n,e,r,t)}function nU(n,e,t){if(ah(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Js(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return eu(n,e=e||r,r,t)}function rU(n,e,t,r){return e===void 0&&(e=!0),Z.makeVariable(n,e,t,r)}function oh(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=oh(n,"float32"),r=$t(n,"float32");return fr(t,r)}var i=ok(je(n),e);return Z.makeTensor(i,n,e)}function $t(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=$t(n,"float32"),r=$t(n,"float32");return fr(t,r)}var i=Nd(je(n),e);return Z.makeTensor(i,n,e)}function Xa(n,e,t){return Z.runKernelFunc((function(r){return r.fill(n,e,t)}),{})}function iU(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return Z.runKernelFunc((function(r){return r.linspace(n,e,t)}),{})}function xg(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return $t([0],r);var i=Nd(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var a=1;a<i.length;a++)i[a]=i[a-1]+t;return kn(i,r)}var pk=X({onesLike_:function(n){var e=z(n,"x","onesLike");if(e.dtype==="complex64"){var t=pk(Pi(e)),r=St(Ua(e));return fr(t,r)}return Z.runKernelFunc((function(i){return i.onesLike(e)}),{$x:e},(function(i,a){return{$x:function(){return St(i)}}}))}}),St=X({zerosLike_:function(n){var e=z(n,"x","zerosLike");return Z.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,r){return{$x:function(){return St(t)}}}))}}),Un=X({concat_:function(n,e){e===void 0&&(e=0),H(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=bg(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(u){if(u.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+u.dtype+". ")})),e=qn(e,t[0].shape)[0];var r=Hc(t.map((function(u){return u.shape})),e);if(je(r)===0)return pr([],r);if((t=t.filter((function(u){return u.size>0}))).length===1)return t[0];var i=t.map((function(u){return u.shape}));eU(i,e);var a=t,o={axis:e};return Z.runKernelFunc((function(u){return u.concat(t,e)}),a,(function(u){var c=i.map((function(h){return h[e]}));return yx(u,c,e).map((function(h){return function(){return h}}))}),"Concat",o)}}),aU=X({concat1d_:function(n){return Un(n,0)}}),oU=X({concat2d_:function(n,e){return Un(n,e)}}),sU=X({concat3d_:function(n,e){return Un(n,e)}}),uU=X({concat4d_:function(n,e){return Un(n,e)}}),yx=X({split_:function(n,e,t){t===void 0&&(t=0);var r,i=z(n,"x","split");return t=qn(t,i.shape)[0],typeof e=="number"?(H(i.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(i.shape[t]/e)):(H(i.shape[t]===e.reduce((function(a,o){return a+o})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),Z.runKernelFunc((function(a){return a.split(i,r,t)}),{$x:i},(function(a){return{$x:function(){return Un(a,t)}}}))}});function ol(n,e){return n(e={exports:{}},e.exports),e.exports}var lU=ol((function(n){(function(e,t,r){function i(u){var c,h=this,d=(c=4022871197,function(p){p=p.toString();for(var g=0;g<p.length;g++){var v=.02519603282416938*(c+=p.charCodeAt(g));v-=c=v>>>0,c=(v*=c)>>>0,c+=4294967296*(v-=c)}return 23283064365386963e-26*(c>>>0)});h.next=function(){var p=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=p-(h.c=0|p)},h.c=1,h.s0=d(" "),h.s1=d(" "),h.s2=d(" "),h.s0-=d(u),h.s0<0&&(h.s0+=1),h.s1-=d(u),h.s1<0&&(h.s1+=1),h.s2-=d(u),h.s2<0&&(h.s2+=1),d=null}function a(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var h=new i(u),d=c&&c.state,p=h.next;return p.int32=function(){return 4294967296*h.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.alea=o})(0,n)})),cU=ol((function(n){(function(e,t,r){function i(u){var c=this,h="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var p=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^p^p>>>8},u===(0|u)?c.x=u:h+=u;for(var d=0;d<h.length+64;d++)c.x^=0|h.charCodeAt(d),c.next()}function a(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c}function o(u,c){var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xor128=o})(0,n)})),hU=ol((function(n){(function(e,t,r){function i(u){var c=this,h="";c.next=function(){var p=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^p^p<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,u===(0|u)?c.x=u:h+=u;for(var d=0;d<h.length+64;d++)c.x^=0|h.charCodeAt(d),d==h.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.v=u.v,c.d=u.d,c}function o(u,c){var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xorwow=o})(0,n)})),fU=ol((function(n){(function(e,t,r){function i(u){var c=this;c.next=function(){var h,d,p=c.x,g=c.i;return h=p[g],d=(h^=h>>>7)^h<<24,d^=(h=p[g+1&7])^h>>>10,d^=(h=p[g+3&7])^h>>>3,d^=(h=p[g+4&7])^h<<7,h=p[g+7&7],d^=(h^=h<<13)^h<<9,p[g]=d,c.i=g+1&7,d},(function(h,d){var p,g=[];if(d===(0|d))g[0]=d;else for(d=""+d,p=0;p<d.length;++p)g[7&p]=g[7&p]<<15^d.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],h.x=g,h.i=0,p=256;p>0;--p)h.next()})(c,u)}function a(u,c){return c.x=u.x.slice(),c.i=u.i,c}function o(u,c){u==null&&(u=+new Date);var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(d.x&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xorshift7=o})(0,n)})),dU=ol((function(n){(function(e,t,r){function i(u){var c=this;c.next=function(){var h,d,p=c.w,g=c.X,v=c.i;return c.w=p=p+1640531527|0,d=g[v+34&127],h=g[v=v+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,d=g[v]=d^h,c.i=v,d+(p^p>>>16)|0},(function(h,d){var p,g,v,b,w,E=[],T=128;for(d===(0|d)?(g=d,d=null):(d+="\0",g=0,T=Math.max(T,d.length)),v=0,b=-32;b<T;++b)d&&(g^=d.charCodeAt((b+32)%d.length)),b===0&&(w=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,b>=0&&(w=w+1640531527|0,v=(p=E[127&b]^=g+w)==0?v+1:0);for(v>=128&&(E[127&(d&&d.length||0)]=-1),v=127,b=512;b>0;--b)g=E[v+34&127],p=E[v=v+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,E[v]=g^p;h.w=w,h.X=E,h.i=v})(c,u)}function a(u,c){return c.i=u.i,c.w=u.w,c.X=u.X.slice(),c}function o(u,c){u==null&&(u=+new Date);var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(d.X&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xor4096=o})(0,n)})),pU=ol((function(n){(function(e,t,r){function i(u){var c=this,h="";c.next=function(){var p=c.b,g=c.c,v=c.d,b=c.a;return p=p<<25^p>>>7^g,g=g-v|0,v=v<<24^v>>>8^b,b=b-p|0,c.b=p=p<<20^p>>>12^g,c.c=g=g-v|0,c.d=v<<16^g>>>16^b,c.a=b-p|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,u===Math.floor(u)?(c.a=u/4294967296|0,c.b=0|u):h+=u;for(var d=0;d<h.length+20;d++)c.b^=0|h.charCodeAt(d),c.next()}function a(u,c){return c.a=u.a,c.b=u.b,c.c=u.c,c.d=u.d,c}function o(u,c){var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.tychei=o})(0,n)})),Bu=ol((function(n){(function(e,t){var r,i=this,a=256,o=6,u="random",c=t.pow(a,o),h=t.pow(2,52),d=2*h,p=a-1;function g(T,R,I){var C=[],k=w((function N(D,P){var F,j=[],B=typeof D;if(P&&B=="object")for(F in D)try{j.push(N(D[F],P-1))}catch{}return j.length?j:B=="string"?D:D+"\0"})((R=R==1?{entropy:!0}:R||{}).entropy?[T,E(e)]:T??(function(){try{var N;return r&&(N=r.randomBytes)?N=N(a):(N=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(N)),E(N)}catch{var D=i.navigator,P=D&&D.plugins;return[+new Date,i,P,i.screen,E(e)]}})(),3),C),L=new v(C),O=function(){for(var N=L.g(o),D=c,P=0;N<h;)N=(N+P)*a,D*=a,P=L.g(1);for(;N>=d;)N/=2,D/=2,P>>>=1;return(N+P)/D};return O.int32=function(){return 0|L.g(4)},O.quick=function(){return L.g(4)/4294967296},O.double=O,w(E(L.S),e),(R.pass||I||function(N,D,P,F){return F&&(F.S&&b(F,L),N.state=function(){return b(L,{})}),P?(t[u]=N,D):N})(O,k,"global"in R?R.global:this==t,R.state)}function v(T){var R,I=T.length,C=this,k=0,L=C.i=C.j=0,O=C.S=[];for(I||(T=[I++]);k<a;)O[k]=k++;for(k=0;k<a;k++)O[k]=O[L=p&L+T[k%I]+(R=O[k])],O[L]=R;(C.g=function(N){for(var D,P=0,F=C.i,j=C.j,B=C.S;N--;)D=B[F=p&F+1],P=P*a+B[p&(B[F]=B[j=p&j+D])+(B[j]=D)];return C.i=F,C.j=j,P})(a)}function b(T,R){return R.i=T.i,R.j=T.j,R.S=T.S.slice(),R}function w(T,R){for(var I,C=T+"",k=0;k<C.length;)R[p&k]=p&(I^=19*R[p&k])+C.charCodeAt(k++);return E(R)}function E(T){return String.fromCharCode.apply(0,T)}if(t["seed"+u]=g,w(t.random(),e),n.exports){n.exports=g;try{r=require("crypto")}catch{}}})([],Math)}));Bu.alea=lU,Bu.xor128=cU,Bu.xorwow=hU,Bu.xorshift7=fU,Bu.xor4096=dU,Bu.tychei=pU;var hv=Bu.alea,_x=(function(){function n(e,t,r,i,a){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=a||Math.random();this.random=hv(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var a=void 0,o=void 0,u=void 0;do u=(a=2*this.random()-1)*a+(o=2*this.random()-1)*o;while(u>=1||u===0);var c=Math.sqrt(-2*Math.log(u)/u);t=this.mean+this.stdDev*a*c,r=this.mean+this.stdDev*o*c,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),mU=(function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var a=i||Math.random();this.randu=hv(a.toString()),this.randn=new _x(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,a,o;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-o+Math.log(o)),(a=this.randu())<t||Math.log(a)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n})(),gU=(function(){function n(e,t,r,i){var a=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=hv(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})();function it(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",sk(n),new nd(n,e,t)}function vU(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var mk=X({batchToSpaceND_:function(n,e,t){var r=z(n,"x","batchToSpaceND"),i=e.reduce((function(a,o){return a*o}));return H(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),H(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),H(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i})),Z.runKernelFunc((function(a){return a.batchToSpaceND(r,e,t)}),{$x:r},(function(a){return{$x:function(){return a.spaceToBatchND(e,t)}}}))}}),yU=X({broadcastTo_:function(n,e){var t=z(n,"broadcastTo","x"),r=t.shape;if(e.some((function(c){return!(c>0)||c%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var a=Array.from(e),o=e.length-1;o>=0;o--)if(t.shape[o]===e[o])a[o]=1;else if(t.shape[o]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=a.map((function(c,h){return c>1?h:-1})).filter((function(c){return c>=0}));return u.length===0?t.clone():Z.runKernelFunc((function(c){return c.tile(t,a)}),{input:t},(function(c){return{input:function(){return c.sum(u,!0)}}}))}}),_U=X({cast_:function(n,e){var t=z(n,"x","cast");if(!h5(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return Z.runKernelFunc((function(i){return i.cast(t,e)}),{x:t},(function(i){return{x:function(){return i.clone()}}}),"Cast",r)}}),bU=X({clone_:function(n){var e=z(n,"x","clone",null);return Z.runKernelFunc((function(){return Z.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),xU=X({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=z(n,"x","cumsum"),a=no([e|=0],i.rank),o=i;a!=null&&(o=i.transpose(a));var u=ro(1,i.rank)[0],c=Z.runKernelFunc((function(h){return h.cumsum(o,u,t,r)}),{permutedX:o},(function(h){return{permutedX:function(){return h.cumsum(e,t,!r)}}}));return a!=null&&(c=c.transpose(a)),c}}),wU=X({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=z(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],a=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];return H(i*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape})),H(a*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+e+` for depthToSpace with input shape
          `+r.shape})),H(o%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+r.shape})),Z.runKernelFunc((function(u){return u.depthToSpace(r,e,t)}),{$x:r})}}),Oi=X({expandDims_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","expandDims",null);H(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return e<0&&(H(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),r.splice(e,0,1),aa(t,r)}}),gk=X({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=it([n,e],r),a=n<=e?n:e,o=0;o<a;++o)i.set(1,o,o);var u=i.toTensor().as2D(n,e);if(t==null)return u;if(t.length===1)return Rc(Oi(u,0),[t[0],1,1]);if(t.length===2)return Rc(Oi(Oi(u,0),0),[t[0],t[1],1,1]);if(t.length===3)return Rc(Oi(Oi(Oi(u,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),EU=X({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=z(n,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var u=o===1?i.as2D(1,-1):i,c=Z.runKernelFunc((function(h){return h.multinomial(u,r,e,t)}),{logits2D:u});return o===1?c.as1D():c}}),Lb=X({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=z(n,"indices","oneHot","int32"),a=i.shape.concat([e]);return i=i.flatten(),Z.runKernelFunc((function(o){return o.oneHot(i,e,t,r)}),{$indices:i},(function(o){return{$indices:function(){return $t(i.shape,"float32")}}})).reshape(a)}}),sl=X({pad_:function(n,e,t){t===void 0&&(t=0);var r=z(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return Z.runKernelFunc((function(a){return a.pad(r,e,t)}),{x:r},(function(a){var o=e.map((function(u){return u[0]}));return{x:function(){return a.slice(o,r.shape)}}}),"PadV2",i)}}),TU=X({pad1d_:function(n,e,t){return t===void 0&&(t=0),H(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),sl(n,[e],t)}}),CU=X({pad2d_:function(n,e,t){return t===void 0&&(t=0),H(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),sl(n,e,t)}}),SU=X({pad3d_:function(n,e,t){return t===void 0&&(t=0),H(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),sl(n,e,t)}}),AU=X({pad4d_:function(n,e,t){return t===void 0&&(t=0),H(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),sl(n,e,t)}}),RU=X({rand_:function(n,e,t){var r=je(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=e();return Z.makeTensor(i,n,t)}}),IU=X({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new _x(e,t,r,!1,i),o=it(n,r),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),NU=X({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var a=new mU(e,t,r,i),o=it(n,r),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),vk=X({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var a=it(n,r),o=new gU(e,t,null,i),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),aa=X({reshape_:function(n,e){var t=z(n,"x","reshape",null);e=l5(e,t.size),H(t.size===je(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return Z.runKernelFunc((function(i){return i.reshape(t,e)}),{x:t},(function(i){return{x:function(){return i.reshape(t.shape)}}}),"Reshape",r)}}),yk=X({spaceToBatchND_:function(n,e,t){var r=z(n,"x","spaceToBatchND");return H(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),H(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),H(r.shape.reduce((function(i,a,o){return o>0&&o<=e.length?i&&(a+t[o-1][0]+t[o-1][1])%e[o-1]==0:i}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),Z.runKernelFunc((function(i){return i.spaceToBatchND(r,e,t)}),{$x:r},(function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}}))}}),_k=X({squeeze_:function(n,e){var t=z(n,"x","squeeze");return aa(t,zu(t.shape,e).newShape)}}),gi=X({stack_:function(n,e){e===void 0&&(e=0);var t=bg(n,"tensors","stack");if(H(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,a=t[0].dtype;H(e<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(u){Pt(i,u.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(u){H(a===u.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=t.map((function(u){return u.expandDims(e)}));return Un(o,e)}}),Rc=X({tile_:function(n,e){var t=z(n,"x","tile",null);H(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var r=[t],i={reps:e};return Z.runKernelFunc((function(a,o){var u=a.tile(t,e);return o([t]),u}),{x:t},(function(a,o){var u=o[0];return{x:function(){var c=St(u);if(u.rank===1)for(var h=0;h<e[0];++h)c=c.add(a.slice([h*u.shape[0]],[u.shape[0]]));else if(u.rank===2)for(h=0;h<e[0];++h)for(var d=0;d<e[1];++d)c=c.add(a.slice([h*u.shape[0],d*u.shape[1]],[u.shape[0],u.shape[1]]));else if(u.rank===3)for(h=0;h<e[0];++h)for(d=0;d<e[1];++d)for(var p=0;p<e[2];++p)c=c.add(a.slice([h*u.shape[0],d*u.shape[1],p*u.shape[2]],[u.shape[0],u.shape[1],u.shape[2]]));else{if(u.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+u.rank+" tensors yet.");for(h=0;h<e[0];++h)for(d=0;d<e[1];++d)for(p=0;p<e[2];++p)for(var g=0;g<e[3];++g)c=c.add(a.slice([h*u.shape[0],d*u.shape[1],p*u.shape[2],g*u.shape[3]],[u.shape[0],u.shape[1],u.shape[2],u.shape[3]]))}return c}}}),"Tile",i,r)}}),DU=X({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new _x(e,t,r,!0,i),o=it(n,r),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),zn=X({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=z(n,"x","unstack");H(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var r={axis:e};return Z.runKernelFunc((function(i){return i.unstack(t,e)}),{x:t},(function(i){return{x:function(){return gi(i,e)}}}),"Unpack",r)}}),kU=function(n,e){return Fe(this,void 0,void 0,(function(){var t,r,i,a,o,u,c,h,d,p;return Le(this,(function(g){switch(g.label){case 0:return t=z(n,"x","setdiff1d"),r=z(e,"y","setdiff1d"),H(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),H(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),H(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return i=g.sent(),[4,r.data()];case 2:for(a=g.sent(),o=new Set(a),u=0,d=0;d<i.length;d++)o.has(i[d])||u++;for(c=new nd([u],t.dtype),h=new nd([u],"int32"),d=0,p=0;d<i.length;d++)o.has(i[d])||(c.values[p]=i[d],h.values[p]=d,p++);return[2,[c.toTensor(),h.toTensor()]]}}))}))};function wg(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var a=e.length,o=0;o<a;++o)i=i.concat([n[o+1]/e[o],e[o]]);i=i.concat(n.slice(a+1))}return i}function Eg(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function Tg(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var a=1;a<n.length;++a)a<=e.length?r?i.push(e[a-1]*n[a]):i.push(n[a]/e[a-1]):i.push(n[a]);return i}function bk(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function xk(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function wk(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,a=0;a<t.length-1;++a)i*=t[a];var o=n.shape,u=t.slice();u.pop();var c=1;for(a=r;a<n.rank;++a)c*=o[a],u.push(o[a]);var h=Ka(n.shape).map((function(d){return d/c})).concat([1]).slice(0,r);return[u,i,c,h]}var Ek=30;function E_(n){return n<=Ek?n:kb(n,Math.floor(Math.sqrt(n)))}function MU(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(a+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(a+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(a+" update.rank != "+(i+n.length-r));for(var o=0;o<i;++o)if(t.shape[o]!==e.shape[o])throw new Error(a+" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+").");for(o=0;o<t.rank-i;++o)if(t.shape[o+i]!==n[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+t.shape[o+i]+") != shape["+(o+i)+"] ("+n[o+i]+")")}function OU(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}MU(t,e,n)}function Cg(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,a=t.length,o=1,u=i;u<a;++u)o*=t[u];var c=i<1?1:i;return{sliceRank:i,numUpdates:je(e.shape)/c,sliceSize:o,strides:Ka(t.slice(0,i)).concat([1]),outputSize:je(t)}}function PU(n,e,t){H(n.rank===e.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."})),H(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."}));for(var r=function(a){H(e[a]+t[a]<=n.shape[a],(function(){return"Error in slice"+n.rank+"D: begin["+a+"] + size["+a+"] ("+(e[a]+t[a])+") would overflow input.shape["+a+"] ("+n.shape[a]+")"}))},i=0;i<n.rank;++i)r(i)}function IA(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function bx(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function VU(n,e,t,r,i){var a=e[i],o=t[i]||1;(n&1<<i||a==null)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[i];return a<0&&(a+=u),a=Ib(0,a,u-1)}function FU(n,e,t,r,i){var a=e[i],o=t[i]||1;(n&1<<i||a==null)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[i];return a<0&&(a+=u),a=o>0?Ib(0,a,u):Ib(-1,a,u-1)}function Tk(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function Ck(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function LU(n,e){H(Db(n),(function(){return"The f passed in variableGrads(f) must be a function"})),H(e==null||Array.isArray(e)&&e.every((function(d){return d instanceof Gc})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var r in e=[],Z.registeredVariables)e.push(Z.registeredVariables[r]);var i=t?e.filter((function(d){return!d.trainable})):null,a=e.length;H((e=e.filter((function(d){return d.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=Z.gradients(n,e,null,!0),u=o.value,c=o.grads;H(c.some((function(d){return d!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),H(u.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"}));var h={};return e.forEach((function(d,p){c[p]!=null&&(h[d.name]=c[p])})),i?.forEach((function(d){return h[d.name]=null})),{value:u,grads:h}}function fv(n){return Z.customGrad(n)}var Uo=X({softmax_:function(n,e){e===void 0&&(e=-1);var t=z(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return Z.runKernelFunc((function(r,i){var a=r.softmax(t,e);return i([a]),a}),{logits:t},(function(r,i){var a=i[0],o=r.mul(a);return{logits:function(){return o.sub(o.sum([e],!0).mul(a))}}}),"Softmax",{dim:e},[],[!0])}}),BU=X({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=z(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return fv((function(r,i){var a=r.max(e,!0),o=r.sub(a),u=o.toFloat().sub(o.exp().sum(e,!0).log());return i([u]),{value:u,gradFunc:function(c,h){var d=h[0].exp();return c.sub(c.sum(e,!0).mul(d))}}}))(t)}}),Sk=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n})(),Ak=(function(){function n(){}return n.prototype.time=function(e){return le("time")},n.prototype.read=function(e){return le("read")},n.prototype.readSync=function(e){return le("readSync")},n.prototype.numDataIds=function(){return le("numDataIds")},n.prototype.disposeData=function(e){return le("disposeData")},n.prototype.write=function(e,t,r){return le("write")},n.prototype.move=function(e,t,r,i){return le("move")},n.prototype.memory=function(){return le("memory")},n.prototype.floatPrecision=function(){return le("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return le("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,le("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return le("slice")},n.prototype.stridedSlice=function(e,t,r,i){return le("stridedSlice")},n.prototype.unstack=function(e,t){return le("unstack")},n.prototype.reverse=function(e,t){return le("reverse")},n.prototype.concat=function(e,t){return le("concat")},n.prototype.neg=function(e){return le("neg")},n.prototype.add=function(e,t){return le("add")},n.prototype.addN=function(e){return le("addN")},n.prototype.subtract=function(e,t){return le("subtract")},n.prototype.multiply=function(e,t){return le("multiply")},n.prototype.realDivide=function(e,t){return le("realDivide")},n.prototype.floorDiv=function(e,t){return le("floorDiv")},n.prototype.sum=function(e,t){return le("sum")},n.prototype.prod=function(e,t){return le("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return le("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return le("argMin")},n.prototype.argMax=function(e,t){return le("argMax")},n.prototype.equal=function(e,t){return le("equal")},n.prototype.notEqual=function(e,t){return le("notEqual")},n.prototype.less=function(e,t){return le("less")},n.prototype.lessEqual=function(e,t){return le("lessEqual")},n.prototype.greater=function(e,t){return le("greater")},n.prototype.greaterEqual=function(e,t){return le("greaterEqual")},n.prototype.logicalNot=function(e){return le("logicalNot")},n.prototype.logicalAnd=function(e,t){return le("logicalAnd")},n.prototype.logicalOr=function(e,t){return le("logicalOr")},n.prototype.where=function(e){return le("where")},n.prototype.select=function(e,t,r){return le("select")},n.prototype.topk=function(e,t,r){return le("topk")},n.prototype.min=function(e,t){return le("min")},n.prototype.minimum=function(e,t){return le("minimum")},n.prototype.mod=function(e,t){return le("mod")},n.prototype.max=function(e,t){return le("max")},n.prototype.maximum=function(e,t){return le("maximum")},n.prototype.all=function(e,t){return le("all")},n.prototype.any=function(e,t){return le("any")},n.prototype.squaredDifference=function(e,t){return le("squaredDifference")},n.prototype.ceil=function(e){return le("ceil")},n.prototype.floor=function(e){return le("floor")},n.prototype.round=function(e){return le("round")},n.prototype.sign=function(e){return le("sign")},n.prototype.isNaN=function(e){return le("isNaN")},n.prototype.isInf=function(e){return le("isInf")},n.prototype.isFinite=function(e){return le("isFinite")},n.prototype.pow=function(e,t){return le("pow")},n.prototype.exp=function(e){return le("exp")},n.prototype.expm1=function(e){return le("expm1")},n.prototype.softmax=function(e,t){return le("softmax")},n.prototype.log=function(e){return le("log")},n.prototype.log1p=function(e){return le("log1p")},n.prototype.sqrt=function(e){return le("sqrt")},n.prototype.rsqrt=function(e){return le("rsqrt")},n.prototype.square=function(e){return le("square")},n.prototype.reciprocal=function(e){return le("reciprocal")},n.prototype.relu=function(e){return le("relu")},n.prototype.relu6=function(e){return le("relu6")},n.prototype.prelu=function(e,t){return le("prelu")},n.prototype.elu=function(e){return le("elu")},n.prototype.eluDer=function(e,t){return le("eluDer")},n.prototype.selu=function(e){return le("selu")},n.prototype.int=function(e){return le("int")},n.prototype.clip=function(e,t,r){return le("clip")},n.prototype.abs=function(e){return le("abs")},n.prototype.complexAbs=function(e){return le("complexAbs")},n.prototype.sigmoid=function(e){return le("sigmoid")},n.prototype.softplus=function(e){return le("softplus")},n.prototype.sin=function(e){return le("sin")},n.prototype.cos=function(e){return le("cos")},n.prototype.tan=function(e){return le("tan")},n.prototype.asin=function(e){return le("asin")},n.prototype.acos=function(e){return le("acos")},n.prototype.atan=function(e){return le("atan")},n.prototype.atan2=function(e,t){return le("atan2")},n.prototype.sinh=function(e){return le("sinh")},n.prototype.cosh=function(e){return le("cosh")},n.prototype.tanh=function(e){return le("tanh")},n.prototype.asinh=function(e){return le("asinh")},n.prototype.acosh=function(e){return le("acosh")},n.prototype.atanh=function(e){return le("atanh")},n.prototype.erf=function(e){return le("erf")},n.prototype.step=function(e,t){return le("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return le("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return le("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return le("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return le("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return le("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return le("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return le("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return le("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return le("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return le("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return le("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return le("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return le("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return le("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return le("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return le("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return le("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return le("reshape")},n.prototype.cast=function(e,t){return le("cast")},n.prototype.tile=function(e,t){return le("tile")},n.prototype.pad=function(e,t,r){return le("pad")},n.prototype.transpose=function(e,t){return le("transpose")},n.prototype.gather=function(e,t,r){return le("gather")},n.prototype.gatherND=function(e,t){return le("gatherND")},n.prototype.scatterND=function(e,t,r){return le("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return le("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return le("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return le("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return le("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return le("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return le("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,a,o){return le("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,a){return le("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,a,o,u){return le("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return le("multinomial")},n.prototype.oneHot=function(e,t,r,i){return le("oneHot")},n.prototype.cumsum=function(e,t,r,i){return le("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,a){return le("nonMaxSuppression")},n.prototype.fft=function(e){return le("fft")},n.prototype.ifft=function(e){return le("ifft")},n.prototype.complex=function(e,t){return le("complex")},n.prototype.real=function(e){return le("real")},n.prototype.imag=function(e){return le("imag")},n.prototype.cropAndResize=function(e,t,r,i,a,o){return le("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return le("depthToSpace")},n.prototype.split=function(e,t,r){return le("split")},n.prototype.sparseToDense=function(e,t,r,i){return le("sparseToDense")},n.prototype.diag=function(e){return le("diag")},n.prototype.fill=function(e,t,r){return le("fill")},n.prototype.onesLike=function(e){return le("onesLike")},n.prototype.zerosLike=function(e){return le("zerosLike")},n.prototype.linspace=function(e,t,r){return le("linspace")},n.prototype.dispose=function(){return le("dispose")},n})();function le(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function As(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var a=t-1-i,o=n[a]||1;(e[e.length-1-i]||1)>1&&o===1&&r.unshift(a)}return r}function Hn(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],a=e.length-r-1,o=e[a];(i==null||i===1&&o>1)&&t.unshift(a)}return t}function mt(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var a=n[n.length-i-1];a==null&&(a=1);var o=e[e.length-i-1];if(o==null&&(o=1),a===1)t.unshift(o);else if(o===1)t.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(a)}}return t}function id(n,e,t,r,i,a,o){o===void 0&&(o="channelsLast");var u,c=Rg(e),h=c[0],d=c[1];if(o==="channelsLast")u=[h,d,n[3],n[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=[h,d,n[1],n[1]]}return ul(n,u,t,r,i,a,!1,o)}function Sg(n,e,t,r,i,a,o){o===void 0&&(o="NDHWC");var u,c,h=Bb(e),d=h[0],p=h[1],g=h[2];if(o==="NDHWC")c="channelsLast",u=[d,p,g,n[4],n[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);c="channelsFirst",u=[d,p,g,n[1],n[1]]}return Ag(n,u,t,r,i,!1,c,a)}function ul(n,e,t,r,i,a,o,u){o===void 0&&(o=!1),u===void 0&&(u="channelsLast");var c=[-1,-1,-1,-1],h=c[0],d=c[1],p=c[2],g=c[3];if(u==="channelsLast")h=n[0],d=n[1],p=n[2],g=n[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);h=n[0],g=n[1],d=n[2],p=n[3]}var v,b=e[0],w=e[1],E=e[3],T=Rg(t),R=T[0],I=T[1],C=Rg(r),k=C[0],L=C[1],O=Ic(b,k),N=Ic(w,L),D=(function(J,ne,q,Y,ee,ue,fe,W){var Q,ce,ve;if(typeof J=="number"){Q={top:J,bottom:J,left:J,right:J,type:J===0?"VALID":"NUMBER"};var Te=(function(Je,Ze,Xe,ot,$e){ot==null&&(ot=Rk(Je,Ze,Xe));var lt=Je[0],Kn=Je[1],xn=Bf((lt-Ze+2*ot)/Xe+1,$e);H(bn(xn),(function(){return"The output # of rows ("+xn+") must be an integer. Change the stride and/or zero pad parameters"}));var et=Bf((Kn-Ze+2*ot)/Xe+1,$e);return H(bn(et),(function(){return"The output # of columns ("+et+") must be an integer. Change the stride and/or zero pad parameters"})),[xn,et]})([ne,q],ue,Y,J,W);ce=Te[0],ve=Te[1]}else if(J==="same"){ce=Math.ceil(ne/Y),ve=Math.ceil(q/ee);var Ae=Math.max(0,(ce-1)*Y+ue-ne),xe=Math.max(0,(ve-1)*ee+fe-q),ke=Math.floor(Ae/2),Ie=Ae-ke,qe=Math.floor(xe/2);Q={top:ke,bottom:Ie,left:qe,right:xe-qe,type:"SAME"}}else{if(J!=="valid")throw Error("Unknown padding parameter: "+J);Q={top:0,bottom:0,left:0,right:0,type:"VALID"},ce=Math.ceil((ne-ue+1)/Y),ve=Math.ceil((q-fe+1)/ee)}return{padInfo:Q,outHeight:ce,outWidth:ve}})(i,d,p,R,I,O,N,a),P=D.padInfo,F=D.outHeight,j=D.outWidth,B=o?E*g:E;return u==="channelsFirst"?v=[h,B,F,j]:u==="channelsLast"&&(v=[h,F,j,B]),{batchSize:h,dataFormat:u,inHeight:d,inWidth:p,inChannels:g,outHeight:F,outWidth:j,outChannels:B,padInfo:P,strideHeight:R,strideWidth:I,filterHeight:b,filterWidth:w,effectiveFilterHeight:O,effectiveFilterWidth:N,dilationHeight:k,dilationWidth:L,inShape:n,outShape:v,filterShape:e}}function Ag(n,e,t,r,i,a,o,u){a===void 0&&(a=!1),o===void 0&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],h=c[0],d=c[1],p=c[2],g=c[3],v=c[4];if(o==="channelsLast")h=n[0],d=n[1],p=n[2],g=n[3],v=n[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);h=n[0],v=n[1],d=n[2],p=n[3],g=n[4]}var b,w=e[0],E=e[1],T=e[2],R=e[4],I=Bb(t),C=I[0],k=I[1],L=I[2],O=Bb(r),N=O[0],D=O[1],P=O[2],F=Ic(w,N),j=Ic(E,D),B=Ic(T,P),J=(function(fe,W,Q,ce,ve,Te,Ae,xe,ke,Ie,qe){var Je,Ze,Xe,ot;if(typeof fe=="number"){Je={top:fe,bottom:fe,left:fe,right:fe,front:fe,back:fe,type:fe===0?"VALID":"NUMBER"};var $e=(function(ln,ar,ao,bi,Fn,ou){Fn==null&&(Fn=Rk(ln,ar,bi));var ml=ln[0],gl=ln[1],vl=ln[2],Mr=Bf((ml-ar+2*Fn)/bi+1,ou);H(bn(Mr),(function(){return"The output # of depths ("+Mr+") must be an integer. Change the stride and/or zero pad parameters"}));var pn=Bf((gl-ar+2*Fn)/bi+1,ou);H(bn(pn),(function(){return"The output # of rows ("+pn+") must be an integer. Change the stride and/or zero pad parameters"}));var yr=Bf((vl-ar+2*Fn)/bi+1,ou);return H(bn(yr),(function(){return"The output # of columns ("+yr+") must be an integer. Change the stride and/or zero pad parameters"})),[Mr,pn,yr,ao]})([W,Q,ce,1],xe,1,ve,fe,qe);Ze=$e[0],Xe=$e[1],ot=$e[2]}else if(fe==="same"){Ze=Math.ceil(W/ve),Xe=Math.ceil(Q/Te),ot=Math.ceil(ce/Ae);var lt=(Ze-1)*ve+xe-W,Kn=(Xe-1)*Te+ke-Q,xn=(ot-1)*Ae+Ie-ce,et=Math.floor(lt/2),Vt=lt-et,Xn=Math.floor(Kn/2),_i=Kn-Xn,Lr=Math.floor(xn/2);Je={top:Xn,bottom:_i,left:Lr,right:xn-Lr,front:et,back:Vt,type:"SAME"}}else{if(fe!=="valid")throw Error("Unknown padding parameter: "+fe);Je={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ze=Math.ceil((W-xe+1)/ve),Xe=Math.ceil((Q-ke+1)/Te),ot=Math.ceil((ce-Ie+1)/Ae)}return{padInfo:Je,outDepth:Ze,outHeight:Xe,outWidth:ot}})(i,d,p,g,C,k,L,F,j,B,u),ne=J.padInfo,q=J.outDepth,Y=J.outHeight,ee=J.outWidth,ue=a?R*v:R;return o==="channelsFirst"?b=[h,ue,q,Y,ee]:o==="channelsLast"&&(b=[h,q,Y,ee,ue]),{batchSize:h,dataFormat:o,inDepth:d,inHeight:p,inWidth:g,inChannels:v,outDepth:q,outHeight:Y,outWidth:ee,outChannels:ue,padInfo:ne,strideDepth:C,strideHeight:k,strideWidth:L,filterDepth:w,filterHeight:E,filterWidth:T,effectiveFilterDepth:F,effectiveFilterHeight:j,effectiveFilterWidth:B,dilationDepth:N,dilationHeight:D,dilationWidth:P,inShape:n,outShape:b,filterShape:e}}function Rk(n,e,t,r){r===void 0&&(r=1);var i=Ic(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function Rg(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Bb(n){return typeof n=="number"?[n,n,n]:n}function Ic(n,e){return e<=1?n:n+(n-1)*(e-1)}function Bf(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function Wc(n){var e=Rg(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function ei(n,e){return Wc(n)||Wc(e)}function xx(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function Ik(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=$t(n.shape),i=n.toFloat(),a=t.complex(i,r);return r.dispose(),i.dispose(),a}if(!f5(n.dtype,e))return Z.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var o=t.real(n);return a=o.cast(e),o.dispose(),a}if(e==="int32")return t.int(n);if(e==="bool"){var u=Re(0,n.dtype);return a=t.notEqual(n,u),u.dispose(),a}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function jb(n,e){return Z.makeTensorFromDataId(n.dataId,e,n.dtype)}function Nk(n,e,t){var r=(e-n)/(t-1),i=Nd(t,"float32");i[0]=n;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return kn(i,"float32")}function Ub(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function NA(n,e){return{real:n[2*e],imag:n[2*e+1]}}function jU(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function UU(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function zU(n,e,t){var r=(function(a,o,u){return(function(c,h,d){for(var p=0,g=c.length,v=0,b=!1;p<g;){var w=d(h,c[v=p+(g-p>>>1)]);w>0?p=v+1:(g=v,b=!w)}return b?p:-p-1})(a,o,u||GU)})(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function GU(n,e){return n>e?1:n<e?-1:0}function wx(n,e,t,r,i){return Dk(n,e,t,r,i,0).selectedIndices}function Ex(n,e,t,r,i,a){var o=Dk(n,e,t,r,i,a);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function Dk(n,e,t,r,i,a,o,u){u===void 0&&(u=!1);for(var c=Array.from(e).map((function(C,k){return{score:C,boxIndex:k,suppressBeginIndex:0}})).filter((function(C){return C.score>i})).sort(DA),h=a>0?-.5/a:0,d=[],p=[];d.length<t&&c.length>0;){var g=c.pop(),v=g.score,b=g.boxIndex,w=g.suppressBeginIndex;if(v<i)break;for(var E=!1,T=d.length-1;T>=w;--T){var R=HU(n,b,d[T]);if(R>=r){E=!0;break}if(g.score=g.score*WU(r,h,R),g.score<=i)break}g.suppressBeginIndex=d.length,E||(g.score===v?(d.push(b),p.push(g.score)):g.score>i&&zU(c,g,DA))}var I=d.length;return u&&(d.fill(0,I),p.fill(0,I)),{selectedIndices:kn(d,"int32"),selectedScores:kn(p,"float32"),numValidOutputs:Re(I,"int32")}}function HU(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),u=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),h=Math.min(i[0],i[2]),d=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),g=Math.max(i[1],i[3]),v=(u-a)*(c-o),b=(p-h)*(g-d);if(v<=0||b<=0)return 0;var w=Math.max(a,h),E=Math.max(o,d),T=Math.min(u,p),R=Math.min(c,g),I=Math.max(T-w,0)*Math.max(R-E,0);return I/(v+b-I)}function WU(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function DA(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function kk(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map((function(a){i[t]=a;var o=n.slice(r,i);return r[t]+=a,o}))}function Mk(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=it(t,n.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(n.rank),u=0;u<o.length;u++)o[u]=a[u]%n.shape[u];var c=n.locToIndex(o);i.values[r]=n.values[c]}return i.toTensor()}function Ok(n,e,t,r,i){for(var a=e[e.length-1],o=[n.length/a,a],u=o[0],c=o[1],h=td(t,u*r),d=td("int32",u*r),p=0;p<u;p++){for(var g=p*c,v=n.subarray(g,g+c),b=[],w=0;w<v.length;w++)b.push({value:v[w],index:w});b.sort((function(C,k){return k.value-C.value}));var E=p*r,T=h.subarray(E,E+r),R=d.subarray(E,E+r);for(w=0;w<r;w++)T[w]=b[w].value,R[w]=b[w].index}var I=e.slice();return I[I.length-1]=r,[pr(h,I,t),pr(d,I,"int32")]}function Tx(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=it(n,"int32"),a=it([t.length,n.length],"int32");for(r=0;r<t.length;r++){var o=i.indexToLoc(t[r]),u=r*n.length;a.values.set(o,u)}return a.toTensor()}var qU=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((function(i,a){return"T"+a}));var t=[];this.variableNames.forEach((function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},KU=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((function(i,a){return"T"+a}));var t=[];this.variableNames.forEach((function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},XU=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,a=n.inSize,o=Math.ceil(a/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var u=e==="max"?">":"<",c=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Pk(n,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return n+"."+t}))}function Xr(n,e){return e===1?[n]:Pk(n,e)}function Ar(){var n,e,t,r,i,a,o,u,c,h;return ge().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",u=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",a="gl_FragColor",o="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:u,defineSpecialInf:c,defineRound:h}}function Wu(n,e,t){t===void 0&&(t="index");var r=Ka(e);return r.map((function(i,a){return"int "+n[a]+" = "+t+" / "+i+"; "+(a===r.length-1?"int "+n[a+1]+" = "+t+" - "+n[a]+" * "+i:"index -= "+n[a]+" * "+i)+";"})).join("")}function Cx(n){var e=Ka(n).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var Vk=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function YU(n,e,t,r){var i=[];n.forEach((function(v){var b=je(v.shapeInfo.logicalShape);v.shapeInfo.isUniform?i.push("uniform float "+v.name+(b>1?"["+b+"]":"")+";"):(i.push("uniform sampler2D "+v.name+";"),i.push("uniform int offset"+v.name+";"))}));var a,o,u=i.join(`
`),c=n.map((function(v){return(function(b,w,E){E===void 0&&(E=!1);var T="";T+=E?Fk(b):hc(b);var R=b.shapeInfo.logicalShape,I=w.logicalShape;return R.length<=I.length&&(T+=E?(function(C,k){var L,O=C.name,N=O.charAt(0).toUpperCase()+O.slice(1),D="get"+N+"AtOutCoords",P=C.shapeInfo.logicalShape.length,F=k.logicalShape.length,j=As(C.shapeInfo.logicalShape,k.logicalShape),B=Kt(F),J=F-P,ne=["x","y","z","w","u","v"];L=P===0?"":F<2&&j.length>=1?"coords = 0;":j.map((function(Q){return"coords."+ne[Q+J]+" = 0;"})).join(`
`);var q="";q=F<2&&P>0?"coords":C.shapeInfo.logicalShape.map((function(Q,ce){return"coords."+ne[ce+J]})).join(", ");var Y="return outputValue;",ee=je(C.shapeInfo.logicalShape)===1,ue=je(k.logicalShape)===1;if(P!==1||ee||ue){if(ee&&!ue)Y=F===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(j.length){var fe=P-2,W=P-1;j.indexOf(fe)>-1&&j.indexOf(W)>-1?Y="return vec4(outputValue.x);":j.indexOf(fe)>-1?Y="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":j.indexOf(W)>-1&&(Y="return vec4(outputValue.xx, outputValue.zz);")}}else Y=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+D+`() {
      `+B+` coords = getOutputCoords();
      `+L+`
      vec4 outputValue = get`+N+"("+q+`);
      `+Y+`
    }
  `})(b,w):(function(C,k){var L=C.name,O=L.charAt(0).toUpperCase()+L.slice(1),N="get"+O+"AtOutCoords",D=k.texShape,P=C.shapeInfo.texShape,F=C.shapeInfo.logicalShape.length,j=k.logicalShape.length;if(!C.shapeInfo.isUniform&&F===j&&C.shapeInfo.flatOffset==null&&rr(P,D))return`
      float `+N+`() {
        return sampleTexture(`+L+`, resultUV);
      }
    `;var B,J=Kt(j),ne=As(C.shapeInfo.logicalShape,k.logicalShape),q=j-F,Y=["x","y","z","w","u","v"];B=F===0?"":j<2&&ne.length>=1?"coords = 0;":ne.map((function(ue){return"coords."+Y[ue+q]+" = 0;"})).join(`
`);var ee="";return ee=j<2&&F>0?"coords":C.shapeInfo.logicalShape.map((function(ue,fe){return"coords."+Y[fe+q]})).join(", "),`
    float `+N+`() {
      `+J+` coords = getOutputCoords();
      `+B+`
      return get`+O+"("+ee+`);
    }
  `})(b,w)),T})(v,e,r)})).join(`
`),h=e.texShape,d=Ar(),p=(function(v){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+v.texture2D+`(textureSampler, uv).r;
    }
  `})(d),g=(function(v){return v.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+v.varyingFs+` vec2 resultUV;
    `+v.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+v.defineSpecialNaN+`
    `+v.defineSpecialInf+`
    `+v.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+$U+`
    `+QU+`
    `+ZU+`
  `})(d);return e.isPacked?(a=(function(v,b){switch(v.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(C,k){var L=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return L[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+L[1]+`.0);
      }
    `:L[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+L[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+L[0]+", "+L[1]+`));
      return 2 * (resTexRC.x * `+L[1]+` + resTexRC.y);
    }
  `})(0,b);case 2:return(function(C,k){var L=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(rr(C,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+L[0]+", "+L[1]+`));
      }
    `;var O=Math.ceil(C[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+L[0]+", "+L[1]+`));

      int index = resTexRC.x * `+L[1]+` + resTexRC.y;
      int r = 2 * (index / `+O+`);
      int c = imod(index, `+O+`) * 2;

      return ivec2(r, c);
    }
  `})(v,b);case 3:return w=v,E=b,T=[Math.ceil(E[0]/2),Math.ceil(E[1]/2)],R=Math.ceil(w[2]/2),I=R*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+T[0]+", "+T[1]+`));
      int index = resTexRC.x * `+T[1]+` + resTexRC.y;

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(C,k){for(var L=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],O=Math.ceil(C[C.length-1]/2),N=O*Math.ceil(C[C.length-2]/2),D=N,P="",F="b, r, c",j=2;j<C.length-1;j++)D*=C[C.length-j-1],P=`
      int b`+j+" = index / "+D+`;
      index -= b`+j+" * "+D+`;
    `+P,F="b"+j+", "+F;return`
    ivec`+C.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+L[0]+", "+L[1]+`));
      int index = resTexRC.x * `+L[1]+` + resTexRC.y;

      `+P+`

      int b = index / `+N+`;
      index -= b * `+N+`;

      int r = 2 * (index / `+O+`);
      int c = imod(index, `+O+`) * 2;

      return ivec`+C.length+"("+F+`);
    }
  `})(v,b)}var w,E,T,R,I})(e.logicalShape,h),o=(function(v){return`
    void setOutput(vec4 val) {
      `+v.output+` = val;
    }
  `})(d)):(a=(function(v,b){switch(v.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(T,R){return R[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+R[1]+`.0);
      }
    `:R[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+R[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      return resTexRC.x * `+R[1]+` + resTexRC.y;
    }
  `})(0,b);case 2:return(function(T,R){return rr(T,R)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+R[0]+", "+R[1]+`));
      }
    `:T[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:T[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      int r = index / `+T[1]+`;
      int c = index - r * `+T[1]+`;
      return ivec2(r, c);
    }
  `})(v,b);case 3:return w=b,E=Wu(["r","c","d"],v),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+E+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(T,R){var I=Wu(["r","c","d","d2"],T);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      `+I+`
      return ivec4(r, c, d, d2);
    }
  `})(v,b);case 5:return(function(T,R){var I=Wu(["r","c","d","d2","d3"],T);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+R[0]+`,
                             `+R[1]+`));

      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+I+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(v,b);case 6:return(function(T,R){var I=Wu(["r","c","d","d2","d3","d4"],T);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+I+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(v,b);default:throw new Error(v.length+"-D output sampling is not yet supported")}var w,E})(e.logicalShape,h),o=(function(v){return`
    void setOutput(float val) {
      `+v.output+` = vec4(val, 0, 0, 0);
    }
  `})(d)),r&&(g+=JU),[g,p,o,u,a,c,t].join(`
`)}function hc(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var a=t.shapeInfo.texShape,o=a[0],u=a[1];if(o===1&&u===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=t.shapeInfo.texShape,h=c[0],d=c[1],p=Vu(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+h+", "+d+", "+p+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+ac(t)+`
      }
    `;var a=t.shapeInfo.texShape,o=a[0],u=a[1];if(u===1&&o===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=Vu(r);return u===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+o+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:o===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+u+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+u+", index + "+c+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape;if(o!=null&&rr(r,o)){var u=o[0],c=o[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+u+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var h=zu(r),d=h.newShape,p=h.keptDims,g=d;if(g.length<r.length){var v=fc(t,g);return`
      `+hc(v)+`
      float `+a+`(int row, int col) {
        return `+a+"("+dc(["row","col"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+ac(t)+`
      }
    `;var b=o[0],w=o[1],E=Vu(i);return w===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+E+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+b+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:b===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+E+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+E+`;
    vec2 uv = uvFromFlat(`+b+", "+w+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=r[1]*r[2],u=r[2],c=zu(r),h=c.newShape,d=c.keptDims,p=h;if(p.length<r.length){var g=fc(t,p);return`
        `+hc(g)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+dc(["row","col","depth"],d)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+u+`, 1)));
        `+ac(t)+`
      }
    `;var v=t.shapeInfo.texShape,b=v[0],w=v[1],E=t.shapeInfo.flatOffset;if(w===o&&E==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+u+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+b+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(w===u&&E==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+b+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var T=Vu(i);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+u+" + depth + "+T+`;
        vec2 uv = uvFromFlat(`+b+", "+w+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=r[3],u=r[2]*o,c=r[1]*u,h=zu(r),d=h.newShape,p=h.keptDims;if(d.length<r.length){var g=fc(t,d);return`
      `+hc(g)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+dc(["row","col","depth","depth2"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+u+", "+o+`, 1)));
        `+ac(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,b=t.shapeInfo.texShape,w=b[0],E=b[1];if(E===c&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+u+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+E+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(E===o&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+E+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var T=Vu(i);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+E+", index + "+T+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=r[4],u=r[3]*o,c=r[2]*u,h=r[1]*c,d=zu(r),p=d.newShape,g=d.keptDims;if(p.length<r.length){var v=fc(t,p);return`
      `+hc(v)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+dc(["row","col","depth","depth2","depth3"],g)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+c+", "+u+", "+o+`)) +
          depth3;
        `+ac(t)+`
      }
    `;var b=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,E=w[0],T=w[1];if(T===h&&b==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+u+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+T+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(T===o&&b==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+T+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var R=Vu(i);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+c+" + depth * "+u+` +
          depth2 * `+o+" + depth3 + "+R+`;
      vec2 uv = uvFromFlat(`+E+", "+T+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=zu(r),u=o.newShape,c=o.keptDims;if(u.length<r.length){var h=fc(t,u);return`
      `+hc(h)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+dc(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var d=r[5],p=r[4]*d,g=r[3]*p,v=r[2]*g,b=r[1]*v;if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+b+", "+v+", "+g+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+d+`, 1)));
        `+ac(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,E=t.shapeInfo.texShape,T=E[0],R=E[1];if(R===b&&w==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+v+", "+g+", "+p+", "+d+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+R+".0, "+T+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(R===d&&w==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+R+".0, "+T+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var I=Vu(i);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+b+" + col * "+v+" + depth * "+g+` +
          depth2 * `+p+" + depth3 * "+d+" + depth4 + "+I+`;
      vec2 uv = uvFromFlat(`+T+", "+R+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Fk(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Ar(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var a=i.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Ar();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+h.texture2D+"("+a+`, uv);
    }
  `})(n);case 2:return(function(i){var a=i.shapeInfo.logicalShape,o=i.name,u="get"+o.charAt(0).toUpperCase()+o.slice(1),c=i.shapeInfo.texShape,h=c[0],d=c[1],p=Ar();if(c!=null&&rr(a,c))return`
      vec4 `+u+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+d+".0, "+h+`.0);

        return `+p.texture2D+"("+o+`, uv);
      }
    `;var g=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],v=Math.ceil(a[1]/2);return`
    vec4 `+u+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+v+", "+g[0]+", "+g[1]+`, row, col);
      return `+p.texture2D+"("+o+`, uv);
    }
  `})(n);case 3:return(function(i){var a=i.shapeInfo.logicalShape,o=i.name,u="get"+o.charAt(0).toUpperCase()+o.slice(1),c=i.shapeInfo.texShape,h=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(a[0]===1){var d=a.slice(1),p=fc(i,d);return`
        `+Fk(p)+`
        vec4 `+u+`(int b, int row, int col) {
          return `+u+"("+dc(["b","row","col"],[1,2])+`);
        }
      `}var g=h[0],v=h[1],b=Math.ceil(a[2]/2),w=b*Math.ceil(a[1]/2),E=Ar();return`
    vec4 `+u+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+g+", "+v+", "+w+", "+b+`, b, row, col);
      return `+E.texture2D+"("+o+`, uv);
    }
  `})(n);default:return(function(i){for(var a=i.shapeInfo.logicalShape,o=a.length,u=i.name,c="get"+u.charAt(0).toUpperCase()+u.slice(1),h=i.shapeInfo.texShape,d=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],p=d[0],g=d[1],v=Math.ceil(a[o-1]/2),b=v*Math.ceil(a[o-2]/2),w="int b, int row, int col",E="b * "+b+" + (row / 2) * "+v+" + (col / 2)",T=2;T<o-1;T++)w="int b"+T+", "+w,b*=a[o-T-1],E="b"+T+" * "+b+" + "+E;var R=Ar();return`
    vec4 `+c+"("+w+`) {
      int index = `+E+`;
      int texR = index / `+g+`;
      int texC = index - texR * `+g+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+", "+p+`);
      return `+R.texture2D+"("+u+`, uv);
    }
  `})(n)}}var $U=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,QU=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ZU=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,JU=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Vu(n){return"offset"+n}function ac(n){var e=n.name,t=je(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Kt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function fc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function dc(n,e){return e.map((function(t){return n[t]})).join(", ")}var ez=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,H(n.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var i=n[n.length-1],a=Math.ceil(i/e);this.outputShape=n.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,u,c=this.outputShape,h=c.length,d=Kt(h),p=Xr("coords",h);if(a===1){var g=Kt(u=h+1);o=`
        `+g+" sourceLocR = "+g+"("+p.join()+`, 0);
        ++`+p[h-1]+`;
        `+g+" sourceLocG = "+g+"("+p.join()+`, 0);
        ++`+p[h-2]+`;
        `+g+" sourceLocA = "+g+"("+p.join()+`, 0);
        --`+p[h-1]+`;
        `+g+" sourceLocB = "+g+"("+p.join()+`, 0);
        --`+p[h-2]+";"}else u=h,o=`
        `+d+` sourceLocR = coords;
        ++`+p[h-1]+`;
        `+d+` sourceLocG = coords;
        ++`+p[h-2]+`;
        `+d+` sourceLocA = coords;
        --`+p[h-1]+`;
        `+d+` sourceLocB = coords;
        --`+p[h-2]+";";var v=["x","y","z","w","u","v"].slice(0,u),b="."+v[u-1],w=v.map((function(N){return"int "+N})),E=Xr("sourceLocR",u-1).concat("inIdx.r"),T=Xr("sourceLocG",u-1).concat("inIdx.g"),R=Xr("sourceLocB",u-1).concat("inIdx.b"),I=Xr("sourceLocA",u-1).concat("inIdx.a"),C=t==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+E.join()+`),
                             getBestIndicesAChannel(`+T.join()+`),
                             getBestIndicesAChannel(`+R.join()+`),
                             getBestIndicesAChannel(`+I.join()+")));",L=`vec4(
            getAChannel(`+E.join()+`),
            hasNextCol ? getAChannel(`+T.join()+`) : 0.,
            hasNextRow ? getAChannel(`+R.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+I.join()+") : 0.)",O=r?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+v.join()+`),
                                          vec2(`+v.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+v.join()+`),
                               vec2(`+v.slice(-2).join()+`));
      }
      `+O+`
      void main() {
        `+d+` coords = getOutputCoords();
        bool hasNextCol = `+p[h-1]+" < "+(c[h-1]-1)+`;
        bool hasNextRow = `+p[h-2]+" < "+(c[h-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+b+", sourceLocG"+b+`,
          sourceLocB`+b+", sourceLocA"+b+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+L+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+L+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+C+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},tz=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,a=n.dilationHeight,o=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,h=u-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+d+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},nz=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,a=n.strideHeight,o=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,g=n.effectiveFilterWidth,v=d-1-n.padInfo.front,b=p-1-n.padInfo.top,w=g-1-n.padInfo.left,E=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+v+", "+b+", "+w+`);
      const float avgMultiplier = float(`+E+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+g+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},rz=function(n,e,t,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],mt(n,e),mt(n,t);var o="0.0";r!=null&&(mt(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="1.0";i!=null&&(mt(n,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},iz=function(n,e,t,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],mt(n,e),mt(n,t);var o="vec4(0.0)";r!=null&&(mt(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(mt(n,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},az="return areal * breal - aimag * bimag;",oz="return areal * bimag + aimag * breal;",kA=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=mt(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},T_="return a + b;",C_="return a - b;",MA="return a * b;",Lk="return (a < 0.) ? b * a : a;",fn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=mt(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Bk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ao=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=mt(e,t);var i=this.outputShape.length,a="";if(r)if(i===0||je(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+Kt(i)+` coords = getOutputCoords();
        `,i===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=Xr("coords",i);a+=`
            bool nextRowOutOfBounds =
              (`+o[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+o[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},sz=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,a){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),uz=(function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,a){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),lz=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},cz=function(n){this.outputShape=[],this.outputShape=Hc(n,1),this.variableNames=n.map((function(u,c){return"T"+c}));var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var a=e.length,o=e[e.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},hz=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Hc(n,e);var t=this.outputShape,r=t.length,i=Kt(r),a=Xr("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map((function(E,T){return"T"+T}));var u=new Array(n.length-1);u[0]=n[0][e];for(var c=1;c<u.length;c++)u[c]=u[c-1]+n[c][e];var h=o[e],d=o.slice(-2),p=o.join(),g="if ("+h+" < "+u[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+d.join()+`));
        }`;for(c=1;c<u.length;c++){var v=u[c-1];g+=`
        if (`+h+" < "+u[c]+"  && "+h+" >= "+u[c-1]+`) {
          return getChannel(
            getT`+c+"("+Dm(o,h,v)+`),
            vec2(`+Dm(d,h,v)+`));
        }`}var b=u.length,w=u[u.length-1];g+=`
        return getChannel(
          getT`+b+"("+Dm(o,h,w)+`),
          vec2(`+Dm(d,h,w)+"));",this.userCode=`
      float getValue(`+o.map((function(E){return"int "+E}))+`) {
        `+g+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[r-1]+" = "+a[r-1]+` + 1;
        if (`+a[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[r-2]+" = "+a[r-2]+` + 1;
        if (`+a[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[r-1]+" = "+a[r-1]+` - 1;
        if (`+a[r-2]+" < "+t[r-2]+` &&
            `+a[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function Dm(n,e,t){var r=n.indexOf(e);return n.map((function(i,a){return a===r?i+" - "+t:i})).join()}var fz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,a=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},dz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,a=n.dataFormat==="channelsLast",o=e-1-n.padInfo.top,u=t-1-n.padInfo.left,c=a?1:2,h=a?2:3,d=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+d+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},pz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,a=n.padInfo.top,o=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+a+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+o+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},mz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,a=n.strideHeight,o=n.strideWidth,u=e-1-n.padInfo.front,c=t-1-n.padInfo.top,h=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+c+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},gz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},vz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,a=e-1-n.padInfo.top,o=t-1-n.padInfo.left,u=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},OA=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,a=n.padInfo.left,o=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,g=4*Math.floor(n.inChannels/4),v=n.inChannels%4,b=n.dataFormat==="channelsLast",w=b?1:2,E=b?2:3,T=b?3:1,R="",I="";t&&(R=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,I="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+R+`

      const ivec2 strides = ivec2(`+o+", "+u+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+T+`];

        ivec2 xRCCorner =
            ivec2(coords[`+w+"], coords["+E+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+g+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+b+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(v===1)+`) {

              if (`+b+`) {
                dotProd +=
                    getX(batch, xR, xC, `+g+`) *
                    getW(wR, wC, `+g+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+g+`, xR, xC) *
                    getW(wR, wC, `+g+`, d2);
              }

            } else if (`+(v===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+g+`, d2),
                getW(wR, wC, `+g+` + 1, d2)
              );

              if (`+b+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+g+`),
                  getX(batch, xR, xC, `+g+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+g+`, xR, xC),
                  getX(batch, `+g+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(v===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+g+`, d2),
                getW(wR, wC, `+g+` + 1, d2),
                getW(wR, wC, `+g+` + 2, d2)
              );

              if (`+b+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+g+`),
                  getX(batch, xR, xC, `+g+` + 1),
                  getX(batch, xR, xC, `+g+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+g+`, xR, xC),
                  getX(batch, `+g+` + 1, xR, xC),
                  getX(batch, `+g+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+C+`
        `+I+`
        setOutput(result);
      }
    `},yz=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,a=n.strideHeight,o=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,g=n.filterWidth,v=4*Math.floor(n.inChannels/4),b=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+d+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+g+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+v+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(b===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+v+`) *
                  getW(wF, wR, wC, `+v+`, d2);
              } else if (`+(b===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+v+`),
                  getX(batch, xF, xR, xC, `+v+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+v+`, d2),
                  getW(wF, wR, wC, `+v+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(b===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+v+`),
                  getX(batch, xF, xR, xC, `+v+` + 1),
                  getX(batch, xF, xR, xC, `+v+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+v+`, d2),
                  getW(wF, wR, wC, `+v+` + 1, d2),
                  getW(wF, wR, wC, `+v+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},PA=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,a=n.inWidth,o=n.padInfo.top,u=n.padInfo.left,c=n.strideHeight,h=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,g=n.filterHeight,v=n.filterWidth,b=n.outChannels/n.inChannels,w="",E="";t&&(w=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,E="result = activation(result);");var T=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+c+", "+h+`);
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+b+`;
        int q = d2 - d1 * `+b+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+g+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+T+`
        `+E+`
        setOutput(result);
      }
    `},VA=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,a=n.inWidth,o=n.padInfo.top,u=n.padInfo.left,c=n.strideHeight,h=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,g=n.filterHeight,v=n.filterWidth,b=v,w="int xR; int xC; int xCOffset;",E=0;E<g;E++)for(var T=0;T<v;T++)w+=`
          vec4 xTexelR`+E+"C"+2*T+` = vec4(0.);
          vec4 wR`+E+"C"+T+` = vec4(0.);
          vec4 xR`+E+"C"+T+" = vec4(0.);";for(E=0;E<g;E++)for(var R=0;R<b;R++){if(w+=`
          xR = xRCorner + `+E*d+`;
          xC = xCCorner + `+(T=2*R)*p+`;
        `,h===1){if(T<v&&(w+=u%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+E+"C"+T+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+E+"C"+T+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+E+"C"+T+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+E+"C"+T+" = vec4(previous.zw, xTexelR"+E+"C"+T+`.xy);
                } else {
                  xR`+E+"C"+T+" = vec4(0, 0, xTexelR"+E+"C"+T+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+E+"C"+T+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+E+"C"+T+` = vec4(0.);
                }

                xR`+E+"C"+T+" = xTexelR"+E+"C"+T+`;
              `,T+1<v)){var I=u%2==0?rk(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(w+=`
                  xCOffset = xC + `+u%2+" + "+I+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+E+"C"+(T+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(w+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+E+"C"+T+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+E+"C"+T+` = vec4(0.);
                    }
                  `),w+=`
                  xR`+E+"C"+(T+1)+` = vec4(
                    xTexelR`+E+"C"+T+".zw, xTexelR"+E+"C"+(T+2)+`.xy);
                `):w+=`
                  xCOffset = xC + `+I+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+E+"C"+(T+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+E+"C"+(T+1)+" = xTexelR"+E+"C"+(T+2)+`;
                `}}else T<v&&(w+=`
              if(xR >= 0 && xR < `+i+`) {
            `,u%2==1?(w+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+E+"C"+T+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+E+"C"+T+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+E+"C"+(T+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+E+"C"+(T+2)+` = vec4(0.);
                }

                xR`+E+"C"+T+` = vec4(
                  xTexelR`+E+"C"+T+".zw, xTexelR"+E+"C"+(T+2)+`.zw);
              `,T+1<v&&(w+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+E+"C"+(T+1)+" = vec4(xTexelR"+E+"C"+(T+2)+`.xy, final.xy);
                `)):(w+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+E+"C"+T+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+E+"C"+T+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+E+"C"+(T+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+E+"C"+(T+2)+` = vec4(0.);
                }

                xR`+E+"C"+T+` = vec4(
                  xTexelR`+E+"C"+T+".xy, xTexelR"+E+"C"+(T+2)+`.xy);
              `,T+1<v&&(w+=`
                  xR`+E+"C"+(T+1)+` = vec4(
                    xTexelR`+E+"C"+T+".zw, xTexelR"+E+"C"+(T+2)+`.zw);
                `)),w+="}");T<v&&(w+=`
            vec4 wTexelR`+E+"C"+T+" = getW("+E+", "+T+`, d1, q);
            wR`+E+"C"+T+" = vec4(wTexelR"+E+"C"+T+".xz, wTexelR"+E+"C"+T+`.xz);
          `,T+1<v&&(w+=`
              vec4 wTexelR`+E+"C"+(T+1)+" = getW("+E+", "+(T+1)+`, d1, q);
              wR`+E+"C"+(T+1)+` =
                vec4(wTexelR`+E+"C"+(T+1)+".xz, wTexelR"+E+"C"+(T+1)+".xz);"))}for(E=0;E<g;E++)for(T=0;T<v;T++)w+="dotProd += xR"+E+"C"+T+" * wR"+E+"C"+T+";";var C="",k="";t&&(C=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,k="result = activation(result);");var L=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+c+", "+h+`);
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+w+`

        vec4 result = dotProd;
        `+L+`
        `+k+`
        setOutput(result);
      }
    `},_z=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=n[0],o=n[1],u=n[2],c=n[3],h=e[0],d=t[0],p=t[1];this.outputShape=[h,d,p,c];var g=r==="bilinear"?1:0,v=[o-1+".0",u-1+".0"],b=v[0],w=v[1],E=d>1?[""+(o-1)/(d-1),"(y2-y1) * height_ratio","y1*"+b+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+b],T=E[0],R=E[1],I=E[2],C=p>1?[""+(u-1)/(p-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],k=C[0],L=C[1],O=C[2];this.userCode=`
      const float height_ratio = float(`+T+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+R+`;
        float width_scale = `+L+`;

        float in_y = `+I+`;
        if( in_y < 0.0 || in_y > `+b+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+O+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+g+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},bz=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],a=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Kt(r)+` coords = getOutputCoords();
        int end = `+FA(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+FA(r,"coords")+` = idx;
          val += getX(`+(function(o,u){if(o===1)return""+u;if(o===2)return u+".x, "+u+".y";if(o===3)return u+".x, "+u+".y, "+u+".z";if(o===4)return u+".x, "+u+".y, "+u+".z, "+u+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function FA(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var xz=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rd.DENSE;var e=Lf(n),t=Ar();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Wu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},wz=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rd.DENSE;var e=Lf(n),t=Ar();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Wu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},Ez=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),Tz=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Cz=function(n){this.variableNames=["A"],this.outTexUsage=fi.DOWNLOAD;var e=Ar();this.outputShape=n,this.userCode=`
      `+Vk+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},Sz=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=fi.DOWNLOAD;var e=Ar();this.outputShape=n,this.userCode=`
      `+Vk+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},Az=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Ar(),i=e[0],a=e[1];this.outputShape=n;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+Cx(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},Rz=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ar(),i=e[0],a=e[1];this.outputShape=n;var o="",u="result";t&&(u="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var h=0;h<=1;h++){var d=2*c+h;o+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+n[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+c+" < "+n[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+d+`] = values[0];
              } else if(offset == 1) {
                result[`+d+`] = values[1];
              } else if(offset == 2) {
                result[`+d+`] = values[2];
              } else {
                result[`+d+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Cx(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+r.output+" = "+u+`;
      }
    `},Iz="return real * expR - imag * expI;",Nz="return real * expI + imag * expR;",LA=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Dz=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),kz=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Kt(this.rank),a=(function(o,u){var c=o.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],p=0;p<o.length;p++)p===u?d.push("int(getIndices("+h[p]+"))"):d.push(""+h[p]);return d.join()})(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},Mz=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Kt(e.length),i=Kt(t.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function Oz(n,e){var t=Ar();return I5(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Pz(n,e){return O5(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Vz(n,e){return P5(n,e,new Uint16Array([0,1,2,2,1,3]))}function kd(n,e,t,r,i,a,o){F5(t,r);var u=V5(n,e),c=n.TEXTURE_2D;return Ue(n,e,(function(){return n.bindTexture(c,u)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_MIN_FILTER,n.NEAREST)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_MAG_FILTER,n.NEAREST)})),Ue(n,e,(function(){return n.texImage2D(c,0,i,t,r,0,a,o,null)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),u}function Fz(n,e,t,r,i){var a=cv(t,r);return kd(n,e,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function Lz(n,e,t,r,i){var a=cv(t,r);return kd(n,e,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Bz(n,e,t,r,i){var a=cv(t,r);return kd(n,e,a[0],a[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function jz(n,e,t,r,i){var a=Dd(t,r);return kd(n,e,a[0],a[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function Uz(n,e,t,r,i){var a=Dd(t,r);return kd(n,e,a[0],a[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function zz(n,e,t,r){return Ue(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),CA(n,e,t,"clipSpacePos",r,3,20,0)&&CA(n,e,t,"uv",r,2,20,12)}function Gz(n,e,t,r,i,a,o){var u,c,h;Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),a instanceof Uint8Array?(u=new Uint8Array(r*i*4),c=n.UNSIGNED_BYTE,h=n.RGBA):(u=new Float32Array(r*i*4),c=n.FLOAT,h=o.internalFormatPackedFloat),u.set(a),Ue(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,h,r,i,0,n.RGBA,c,u)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function Hz(n,e,t,r){Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),r.data instanceof Uint8Array?Ue(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)})):Ue(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function Wz(n,e,t,r,i){var a=n.createBuffer();Ue(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)}));var o=16*t*r;return Ue(n,e,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)})),Ue(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)})),Ue(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),a}function qz(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function Kz(n,e,t,r,i){var a=cv(t,r),o=a[0],u=a[1],c=new Uint8Array(t*r*4);return Ue(n,e,(function(){return n.readPixels(0,0,o,u,i.downloadTextureFormat,n.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}function Xz(n,e,t,r,i,a,o,u){var c=n,h=new Float32Array((function(d,p){var g=Dd(d,p);return g[0]*g[1]*4})(a,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,h),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),h}function Yz(n,e,t,r){var i=new Float32Array(t*r*4);return Ue(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)})),i}var $z=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=ge().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,T5(t,e)):this.gl=to(t);var r="WEBGL_color_buffer_float";if(ge().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Am(this.gl,this.debug,"OES_texture_float"),Li(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Am(this.gl,this.debug,"OES_texture_half_float");else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Li(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Am(this.gl,this.debug,"EXT_color_buffer_half_float");else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Li(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Li(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Pz(this.gl,this.debug),this.indexBuffer=Vz(this.gl,this.debug),this.framebuffer=L5(this.gl,this.debug),this.textureConfig=mx(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return ge().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ue(t,this.debug,(function(){return t.finish()})),Ue(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Ue(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Ue(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Ue(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Ue(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Fz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Lz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Bz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Hz(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),Gz(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Uz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),jz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(SA(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ue(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return Kz(i.gl,i.debug,t,r,i.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,a,o){return Xz(this.gl,e,0,0,0,a,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return qz(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=Wz(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(ge().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var u=a.clientWaitSync(o,0,0);return u===a.ALREADY_SIGNALED||u===a.CONDITION_SATISFIED},t=o}else ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return Yz(i.gl,i.debug,t,r)}))},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=N5(t,this.debug,e),i=Oz(t,this.debug),a=k5(t,this.debug);return Ue(t,this.debug,(function(){return t.attachShader(a,i)})),Ue(t,this.debug,(function(){return t.attachShader(a,r)})),M5(t,this.debug,a),this.debug&&b_(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=zz(t,this.debug,this.program,this.vertexBuffer)),a},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Ue(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&b_(this.gl,this.debug,this.program),Ue(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?j5(this.gl,this.debug,e,t):U5(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Ue(this.gl,this.debug,(function(){return r.gl.getAttribLocation(e,t)}))},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),z5(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=Dd(t,r),a=i[0],o=i[1];this.setOutputMatrixTextureDriver(e,a,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&b_(this.gl,this.debug,this.program),Rm(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ue(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ue(this.gl,this.debug,(function(){return e.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Am(this.gl,this.debug,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),a=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,a),a},n.prototype.endQuery=function(){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Fe(this,void 0,void 0,(function(){var t=this;return Le(this,(function(r){switch(r.label){case 0:return[4,_A((function(){return t.disposed||t.isQueryAvailable(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var e=(function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||_A((function(){return r.pollItems(),r.itemsToPoll.length===0}))},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),x_(this.gl,this.debug,e,this.framebuffer),this.debug&&Rm(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(x_(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Rm(this.gl)):SA(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;x_(i,this.debug,e,this.framebuffer),this.debug&&Rm(i),this.outputTexture=e,Ue(i,this.debug,(function(){return i.viewport(0,0,t,r)})),Ue(i,this.debug,(function(){return i.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var a=this;this.throwIfDisposed(),Ue(this.gl,this.debug,(function(){return a.gl.scissor(e,t,r,i)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function BA(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach((function(t,r){var i=t.logicalShape,a=e[r],o=a.shape;if(!rr(i,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+o+" must match");if(!t.isUniform||!a.isUniform){var u=t.texShape,c=a.isUniform?null:a.texData.texShape;if(!rr(u,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+c+" must match")}}))}var Qz=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,a=t.strideWidth,o=t.strideHeight,u=t.padInfo,c=t.outWidth,h=t.dilationWidth,d=t.dilationHeight,p=t.dataFormat,g=u.left,v=u.top,b=i*r,w=Ar(),E=p==="channelsLast",T=E?0:1,R=E?1:2,I="",C=0;C<=1;C++)for(var k=0;k<=1;k++)I+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+C+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+o+" - "+v+`;
            d0 = offsetY + `+d+" * (pos / "+b+`);

            if(d0 < `+e[T]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+a+". - "+g+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+b+".) / "+i+`.));

              if(d1 < `+e[R]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+E+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*C+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*C+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+I+`

        `+w.output+` = result;
      }
    `},Zz=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=e,u=n[3]-1;this.outputShape=n;var c="float("+t+") + float("+r+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},Jz=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},e9=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=e,u=n[3]-1;this.outputShape=n;var c="float("+t+") + float("+r+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+u+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},t9=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,a=n.effectiveFilterWidth,o=i-1-n.padInfo.top,u=a-1-n.padInfo.left,c=i*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},n9=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,a=n.dilationHeight,o=n.dilationWidth,u=n.effectiveFilterDepth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,d=u-1-n.padInfo.front,p=c-1-n.padInfo.top,g=h-1-n.padInfo.left,v=u*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+v+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},S_=function(n,e,t,r,i,a,o){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),a===void 0&&(a=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=t?n[1]:n[2],c=Math.ceil(u/2),h=t?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",p=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",b="";a&&(v=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,b="result = activation(result);");var w=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+d+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+g[0]+`);
          result += (`+p[1]+" * "+g[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+w+`

        `+b+`

        setOutput(result);
      }
    `},r9=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),i9=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},a9=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Xr("rc",e),r=Kt(e),i=(function(u,c,h){if(u===1)return"rc > "+c[0];for(var d="",p=u-2;p<u;p++)d+=h[p]+" >= "+c[p],p<u-1&&(d+="||");return d})(e,n,t),a=(function(u,c,h,d){if(u===1)return"";var p=d.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+h+`;
  `})(e,n[n.length-1],n[n.length-2],t),o=(function(u,c){var h=u.length,d=(function(p,g){for(var v=[],b=0;b<=1;b++)for(var w=0;w<=1;w++){for(var E=(b===0?"r":"rp1")+", "+(w===0?"c":"cp1"),T=2;T<p;T++)E=g[g.length-1-T]+","+E;v.push(E)}return v})(h,c);return h===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+d[0]+`),
          cEdge ? 0. : getA(`+d[1]+`),
          rEdge ? 0. : getA(`+d[2]+`),
          rEdge || cEdge ? 0. : getA(`+d[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},o9=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map((function(c,h){return c[0]+n[h]+c[1]}));var r=n.length,i=Kt(r),a=e.map((function(c){return c[0]})).join(","),o=e.map((function(c,h){return c[0]+n[h]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+a+`);
      `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},s9=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(E,T){return E[0]+n[T]+E[1]}));for(var r=n.length,i=Kt(r),a=e.map((function(E){return E[0]})).join(","),o=e.map((function(E,T){return E[0]+n[T]})).join(","),u=Xr("rc",r),c=Xr("source",r),h=u[r-1]+" < "+this.outputShape[r-1],d=r===1?"source":"vec2("+c.slice(-2).join()+")",p=[i+" rc = outputLoc;",u[r-1]+` += 1;
       if(`+h+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+u[r-2]+` += 1;
       if(`+u[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+u[r-1]+` += 1;
         if(`+h+") {"],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",v="",b=0,w=r===1?2:4;b<w;b++)v+=`
        `+p[b]+`
        if (`+g+`) {
          result[`+b+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+b+"] = getChannel(getX("+c.join()+"), "+d+`);
        }
      `;v+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+a+`);
      const `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+v+`
        setOutput(result);
      }
    `},A_=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,a=n.strideWidth,o=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,d=n.padInfo.top,p=n.padInfo.left;this.outputShape=n.outShape;var g=e==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+a+`);
        const ivec2 pads = ivec2(`+d+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(b="avgValue / count");var w=4*Math.floor(r/4),E=r%4,T=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+d+", "+p+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+w+`; wC += 4) {
            int xC = xCCorner + wC * `+u+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              getValue(batch, xR, xC + 3 * `+u+`, d)
            );

            `+T+`
          }

          int xC = xCCorner + `+w+`;
          if (`+(E===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+T+`
          } else if (`+(E===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              initializationValue,
              initializationValue
            );

            `+T+`
          } else if (`+(E===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              initializationValue
            );

            `+T+`
          }
        }
        setOutput(`+b+`);
      }
    `}},R_=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,a=n.strideHeight,o=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,g=n.effectiveFilterWidth,v=n.padInfo.front,b=n.padInfo.top,w=n.padInfo.left;this.outputShape=n.outShape;var E=e==="avg",T="0.0";if(E||(T="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+a+", "+o+`);
        const ivec3 pads = ivec3(`+v+", "+b+", "+w+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+u+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+g+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+p+" * "+g+` +
                      wR * `+g+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var R=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(R="avgValue / count");var I=4*Math.floor(r/4),C=r%4,k=`
      if (`+E+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+v+", "+b+", "+w+`);
      const float initializationValue = `+T+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+T+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+I+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+k+`
            }

            int xC = xCCorner + `+I+`;
            if (`+(C===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+k+`
            } else if (`+(C===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+k+`
            } else if (`+(C===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+k+`
            }
          }
          setOutput(`+R+`);
        }
      }
    `}},u9=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,a=Math.ceil(i/t);this.outputShape=[r,a];var o="0.0",u="";e==="prod"?o="1.0":e==="min"?(o="1.0 / 1e-20",u="min"):e==="max"&&(o="-1.0 / 1e-20",u="max");var c=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");var h=4*Math.floor(t/4),d=t%4,p=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,g="vec4";e==="all"?(o="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):e==="any"&&(o="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");var v="";i%t>0&&(v=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+v+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(d===1)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===2)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===3)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+c+`);
      }
    `},l9=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Wu(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Cx(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},c9=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],a=r[2],o=n.shape,u=o[1],c=o[2],h=[t&&u>1?i-1:i,t&&c>1?a-1:a],d=[t&&u>1?u-1:u,t&&c>1?c-1:c],p=h[0]/d[0],g=h[1]/d[1],v=1/p,b=1/g,w=2*Math.ceil(v)+2,E=2*Math.ceil(b)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+g+`);

        const float invHeightScale = float(`+v+`);
        const float invWidthScale = float(`+b+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+E+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},h9=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],a=n[1],o=n[2],u=n[3];this.outputShape=[i,e,t,u];var c=[r&&e>1?a-1:a,r&&t>1?o-1:o],h=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},f9=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],a=n[1],o=n[2],u=n[3];this.outputShape=[i,e,t,u];var c=[r&&e>1?a-1:a,r&&t>1?o-1:o],h=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`,
          `+c[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},d9=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],a=r[2],o=n.shape,u=o[1],c=o[2],h=[t&&u>1?i-1:i,t&&c>1?a-1:a],d=[t&&u>1?u-1:u,t&&c>1?c-1:c],p=h[0]/d[0],g=h[1]/d[1],v=1/p,b=1/g,w=2*Math.ceil(v)+2,E=2*Math.ceil(b)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+g+`);

        const float invHeightScale = float(`+v+`);
        const float invWidthScale = float(`+b+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+E+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+d[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+d[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},p9=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],a=n[1],o=n[2],u=n[3];this.outputShape=[i,e,t,u];var c=[r&&e>1?a-1:a,r&&t>1?o-1:o],h=[r&&e>1?e-1:e,r&&t>1?t-1:t],d=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+d+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},m9=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map((function(a,o){return(function(u){return e.indexOf(u)!==-1&&n[u]!==1?n[u]+" - coords["+u+"] - 1":"coords["+u+"]"})(o)})).join(","),i=Kt(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},g9=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=Xr("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],a=r[t-2]+" + 1 < "+this.outputShape[t-2],o=Kt(t);function u(c){var h=n.map((function(d,p){return(function(g,v){return e.indexOf(g)!==-1&&n[g]!==1?n[g]+" - "+v[g]+" - 1":""+v[g]})(p,c)}));return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(c){return u(c)})(r.slice())+`;
          if(`+i+`){
            result.g = `+(function(c){return c[t-1]="("+c[t-1]+" + 1)",u(c)})(r.slice())+`;
          }
          if(`+a+`) {
            result.b = `+(function(c){return c[t-2]="("+c[t-2]+" + 1)",u(c)})(r.slice())+`;
            if(`+i+`) {
              result.a = `+(function(c){return c[t-1]="("+c[t-1]+" + 1)",c[t-2]="("+c[t-2]+" + 1)",u(c)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},jA=function(n,e,t,r,i,a,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var u=Kt(i.length),c=Kt(a.length),h="";t===1?h="i":t===2&&(h="i, j");var d="getIndices("+h+")",p="";r===1?p="i":r===2&&(p="i, coords[1]");var g="getUpdates("+p+")",v=e>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+i+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+d+`);
              flattenedIndex += index * `+v+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+g+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},v9=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,a=n.numSegments,o=a*Math.ceil(i/t);this.outputShape=[r,o];var u=4*Math.floor(t/4),c=t%4,h=`
        sumValue += dot(values, segFilter);
    `,d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var p="";i%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `},y9=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],u=[],c=0;c<e.length;c++)u.push(""+a[c]),c<n&&o.push(""+a[c]);r=o.join(),i=u.join()}var h=Kt(t);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},_9=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Kt(this.rank),i="uniform int start["+this.rank+"];",a=(function(o){if(o===1)return"sourceLoc";if(o<=6)return I_.slice(0,o).map((function(u){return"sourceLoc."+u})).join(",");throw Error("Slicing for rank "+o+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map((function(o,u){return"sourceLoc."+I_[u]+" = start["+u+"] + coords."+I_[u]+";"})).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+a+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),I_=["x","y","z","w","u","v"],b9=(function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Kt(this.rank),r=Xr("coords",this.rank),i=Xr("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",o="getChannel(getSource("+i.join()+"), "+a+")",u=`
      result.x = `+o+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+o+`;
        --`+i[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(d,p){return"start["+p+"]"})).join()+");":e.map((function(d,p){return i[p]+" = "+r[p]+" + start["+p+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+u+`
        `+c+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),x9=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=Kt(t.length),a=Kt(t.length),o="";if(r===1)o="coords * strides + begin";else{var u=0;o=t.map((function(c,h){return u++,t.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(u-1)+"] * strides["+h+"] + begin["+h+"]"})).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},w9=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,a=UA(t,r),o=zA(e,a,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[o].shift();return this.usedTextures[o].push(u),u}return this.numUsedTextures++,this.log(),a===hi.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===hi.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===hi.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===hi.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===hi.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var a=zA(t,UA(r,i),i);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[a],u=o.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(u,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){e.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(i){e.gpgpu.deleteMatrixTexture(i)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function UA(n,e){if(n===fi.UPLOAD)return hi.PACKED_2X2_FLOAT32;if(n===fi.RENDER||n==null)return(function(t){return ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?hi.PACKED_2X2_FLOAT32:hi.UNPACKED_FLOAT32:t?hi.PACKED_2X2_FLOAT16:hi.UNPACKED_FLOAT16})(e);if(n===fi.DOWNLOAD||n===fi.PIXELS)return hi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function zA(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var E9=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Kt(this.rank),a=(function(o){var u=o.length;if(u>5)throw Error("Tile for rank "+u+" is not yet supported");if(u===1)return"imod(resRC, "+o[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],d=0;d<o.length;d++)h.push("imod("+c[d]+", "+o[d]+")");return h.join()})(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},T9=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Kt(this.rank),a=(function(o){var u=o.length;if(u>6)throw Error("Transpose for rank "+u+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(u),d=0;d<o.length;d++)h[o[d]]=c[d];return h.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},C9=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Kt(this.rank),a=Pk("rc",this.rank),o=new Array(this.rank);for(r=0;r<e.length;r++)o[e[r]]=a[r];var u="vec2("+o.slice(-2).join()+")",c="++"+a[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+o.join()+"), "+u+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+c+`) {
        result[1] = `+h+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+c+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `},Sx=1.7580993408473768,Ax=1.0507009873554805,ht=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},da="if (isnan(x)) return x;",S9="return x;",GA="return abs(x);",jk=da+`
  return (x < 0.0) ? 0.0 : x;
`,Uk=da+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,zk="return (x >= 0.0) ? x : (exp(x) - 1.0);",A9=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Sx+`;
  float scale = `+Ax+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,HA="return -x;",WA="return ceil(x);",qA="return floor(x);",KA="return exp(x);",XA="return exp(x) - 1.0;",R9=da+`
  return sin(x);
`,I9=da+`
  return cos(x);
`,N9=da+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,D9=da+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,k9=da+`
  return atan(x);
`,M9=da+"return log(x + sqrt(x * x + 1.0));",O9=da+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,P9=da+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,km="return x;",V9="return x;",Gk=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Hk=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Wk=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Tf=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},F9=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=Xr("rc",e),r=Kt(e),i=(function(u,c){if(u===1)return"rc";for(var h="",d=0;d<u;d++)h+=c[d],d<u-1&&(h+=",");return h})(e,t),a=t.slice(-2),o=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},Mm={};function Om(n,e){if(e===void 0&&(e=!1),n==="linear")return e?V9:S9;if(n==="relu")return e?Gk:jk;if(n==="elu")return e?Wk:zk;if(n==="relu6")return e?Hk:Uk;if(n==="prelu")return e?Bk:Lk;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var L9=600,B9=(function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!ge().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var a=to(ge().getNumber("WEBGL_VERSION"));i.binaryCache=((r=ge().getNumber("WEBGL_VERSION"))in Mm||(Mm[r]={}),Mm[r]),i.gpgpu=new $z(a),i.canvas=a.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new w9(i.gpgpu),i.numMBBeforeWarning=ge().global.screen==null?1024:ge().global.screen.height*ge().global.screen.width*window.devicePixelRatio*L9/1024/1024,i.texData=new Sk(i,Z),i}return fa(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:r,dtype:i,values:t,usage:fi.UPLOAD}),a},e.prototype.move=function(t,r,i,a){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(r),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:a,values:r,usage:fi.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,a=r.dtype,o=r.complexTensors,u=r.slice,c=r.shape,h=r.isPacked;if(u!=null){var d=void 0;d=h?new Tf(c,km):new ht(c,km);var p=this.runWebGLProgram(d,[{dataId:t,shape:c,dtype:a}],a),g=this.readSync(p.dataId);return this.disposeData(p.dataId),g}if(i!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return i;var v,b,w=this.activeTimers!=null;return w&&(v=Ba()),a==="complex64"?b=Ub(o.real.dataSync(),o.imag.dataSync()):b=this.getValuesFromTexture(t),w&&(this.downloadWaitMs+=Ba()-v),this.convertAndCacheOnCPU(t,b)},e.prototype.read=function(t){return Fe(this,void 0,void 0,(function(){var r,i,a,o,u,c,h,d,p,g,v,b,w,E,T,R,I,C,k,L,O,N;return Le(this,(function(D){switch(D.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(P){return r.push(P)}))];if(i=this.texData.get(t),a=i.values,o=i.shape,u=i.slice,c=i.dtype,h=i.complexTensors,d=i.isPacked,u!=null)return p=void 0,p=d?new Tf(o,km):new ht(o,km),g=this.runWebGLProgram(p,[{dataId:t,shape:o,dtype:c}],c),v=this.read(g.dataId),this.disposeData(g.dataId),[2,v];if(a!=null)return[2,this.convertAndCacheOnCPU(t)];if(!ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ge().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return b=null,c!=="complex64"&&ge().get("WEBGL_BUFFER_SUPPORTED")&&(w=this.decode(t),E=this.texData.get(w.dataId),b=(N=this.gpgpu).createBufferFromTexture.apply(N,[E.texture].concat(Lf(o)))),this.pendingRead.set(t,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:D.sent(),D.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return R=D.sent(),I=R[0],C=R[1],T=Ub(I,C),[3,5];case 4:b==null?T=this.getValuesFromTexture(t):(k=je(o),T=this.gpgpu.downloadFloat32MatrixFromBuffer(b,k)),D.label=5;case 5:return w!=null&&this.disposeData(w.dataId),L=this.convertAndCacheOnCPU(t,T),O=this.pendingRead.get(t),this.pendingRead.delete(t),O.forEach((function(P){return P(L)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,L]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!A5(i))throw ge().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),a=i.shape,o=i.dtype,u=i.isPacked,c=je(a);if(ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(t),d=this.texData.get(h.dataId),p=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[d.texture].concat(Lf(a))).subarray(0,c);return this.disposeData(h.dataId),p}var g=ge().getBool("WEBGL_PACK")&&u===!0,v=g?w_(a):a,b=g?new Sz(v):new Cz(v),w=this.runWebGLProgram(b,[{shape:v,dtype:o,dataId:t}],"float32"),E=this.texData.get(w.dataId),T=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(E.texture,E.texShape[0],E.texShape[1]).subarray(0,c);return this.disposeData(w.dataId),T},e.prototype.time=function(t){return Fe(this,void 0,void 0,(function(){var r,i,a,o,u,c,h;return Le(this,(function(d){switch(d.label){case 0:return r=this.activeTimers,i=[],a=!1,this.programTimersStack==null?(this.programTimersStack=i,a=!0):this.activeTimers.push(i),this.activeTimers=i,t(),o=zc(this.activeTimers.map((function(p){return p.query}))).filter((function(p){return p!=null})),u=zc(this.activeTimers.map((function(p){return p.name}))).filter((function(p){return p!=null})),this.activeTimers=r,a&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return h=d.sent(),c.kernelMs=s5(h),c.getExtraProfileInfo=function(){return h.map((function(p,g){return{name:u[g],ms:p}})).map((function(p){return p.name+": "+p.ms})).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ba(),endMs:null}},e.prototype.endTimer=function(t){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Ba(),t)},e.prototype.getQueryTime=function(t){return Fe(this,void 0,void 0,(function(){var r;return Le(this,(function(i){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,a=r.dtype,o=r.texShape,u=r.usage,c=r.isPacked,h=r.slice,d=h&&h.origDataId||t,p=this.dataRefCount.get(d);p>1?this.dataRefCount.set(d,p-1):(this.dataRefCount.delete(d),i!=null&&(this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(i,o,u,c)));var g=this.texData.get(t);g.texture=null,g.texShape=null,g.isPacked=!1,g.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return ge().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Z.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(a){return i.texData.get(a.dataId).texture==null&&a.size<r}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:Z.keep(t.clone()),imag:Z.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(je(i)===0)return pr([],i,t.dtype);var a=this.texData.get(t.dataId).isPacked,o=Tk(t.shape,r,i);if(a||!o){var u=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new b9(i):new _9(i),c=u.getCustomSetupFunc(r);return this.compileAndRun(u,[t],null,c)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var a=this.texData.get(t.dataId),o=this.makeOutput(i,t.dtype),u=this.texData.get(o.dataId);Object.assign(u,a),u.shape=i,u.dtype=t.dtype;var c=Ck(r,t.strides);a.slice&&(c+=a.slice.flatOffset),u.slice={flatOffset:c,origDataId:a.slice&&a.slice.origDataId||t.dataId};var h=this.dataRefCount.get(u.slice.origDataId)||1;return this.dataRefCount.set(u.slice.origDataId,h+1),o},e.prototype.stridedSlice=function(t,r,i,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,a);var o=bx(r,i,a);if(o.some((function(c){return c===0})))return pr([],o);var u=new x9(r,a,o);return this.compileAndRun(u,[t])},e.prototype.reverse=function(t,r){var i=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new g9(t.shape,r):new m9(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map((function(v){return Pi(v)})),a=t.map((function(v){return Ua(v)}));return fr(this.concat(i,r),this.concat(a,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),u=this.concat(t.slice(0,o),r),c=this.concat(t.slice(o),r);return this.concat([u,c],r)}if(ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var h=new hz(t.map((function(v){return v.shape})),r);return this.compileAndRun(h,t)}var d=Hc(t.map((function(v){return v.shape})),r),p=t.map((function(v){return v.as2D(-1,je(v.shape.slice(r)))})),g=new cz(p.map((function(v){return v.shape})));return this.compileAndRun(g,p).reshape(d)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,HA,t.dtype);var r=new ht(t.shape,HA);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,a){var o=i?t.shape[2]:t.shape[1],u=a?r.shape[1]:r.shape[2],c=i?t.shape[1]:t.shape[2],h=t.shape[0];if((o===1||u===1)&&c>1e3){i&&(t=t.transpose([0,2,1])),a&&(r=r.transpose([0,2,1]));var d=u===1?t:t.as3D(h,c,1),p=u===1?2:1,g=u===1?r.as3D(h,1,c):r;return this.multiply(d,g).sum(p,!0)}var v=dr(t.dtype,r.dtype),b=new S_(t.shape,[h,o,u],i,a);return this.compileAndRun(b,[t,r],v)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,a=t.transposeA,o=t.transposeB,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=a?r.shape[2]:r.shape[1],p=o?i.shape[1]:i.shape[2],g=r.shape[0],v=dr(r.dtype,i.dtype),b=u!=null,w=h!=null,E=c?Om(c,!0):null,T=new S_(r.shape,[g,d,p],a,o,b,E,w),R=[r,i];return u&&R.push(u),h&&R.push(h),this.compileAndRun(T,R,v)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),a=this.texData.get(r.dataId),o=new kA(az,t.shape,r.shape),u=new kA(oz,t.shape,r.shape),c=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,a.complexTensors.real),this.makeComplexComponentTensorInfo(r,a.complexTensors.imag)],h=this.compileAndRun(o,c),d=this.compileAndRun(u,c),p=this.complex(h,d);return h.dispose(),d.dispose(),p}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,MA,t.dtype);var g=new fn(MA,t.shape,r.shape);return this.compileAndRun(g,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,a,o,u){var c=[t,r,i],h=null;u!=null&&(h=u.shape,c.push(u));var d=null;if(o!=null&&(d=o.shape,c.push(o)),ge().getBool("WEBGL_PACK_NORMALIZATION")){var p=new iz(t.shape,r.shape,i.shape,h,d,a);return this.compileAndRun(p,c)}var g=new rz(t.shape,r.shape,i.shape,h,d,a);return this.compileAndRun(g,c)},e.prototype.localResponseNormalization4D=function(t,r,i,a,o){var u=ge().getBool("WEBGL_PACK_NORMALIZATION")?new e9(t.shape,r,i,a,o):new Zz(t.shape,r,i,a,o);return this.compileAndRun(u,[t])},e.prototype.LRNGrad=function(t,r,i,a,o,u,c){var h=new Jz(r.shape,a,o,u,c);return this.compileAndRun(h,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map((function(o){return gg(o)}));return Mk(it(t.shape,t.dtype,i),r)}var a=new E9(t.shape,r);return this.compileAndRun(a,[t])},e.prototype.pad=function(t,r,i){var a=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new s9(t.shape,r,i):new o9(t.shape,r,i);return this.compileAndRun(a,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new C9(t.shape,r):new T9(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var a=new kz(t.shape,r.size,i);return this.compileAndRun(a,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){H(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var a=r.reduce((function(p,g){return p*g})),o=wg(t.shape,r,a),u=Eg(o.length,r.length),c=Tg(t.shape,r,a),h=bk(i,r.length),d=xk(c,i,r.length);return t.reshape(o).transpose(u).reshape(c).slice(h,d)},e.prototype.spaceToBatchND=function(t,r,i){H(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var a=r.reduce((function(g,v){return g*v})),o=[[0,0]];o.push.apply(o,i);for(var u=1+r.length;u<t.shape.length;++u)o.push([0,0]);var c=t.pad(o),h=wg(c.shape,r,a,!1),d=Eg(h.length,r.length,!1),p=Tg(c.shape,r,a,!1);return c.reshape(h).transpose(d).reshape(p)},e.prototype.reduce=function(t,r,i){var a=t.shape[0],o=t.shape[1],u=E_(o),c=new u9({windowSize:u,inSize:o,batchSize:a},r),h=this.compileAndRun(c,[t],i);return h.shape[1]===1?h:this.reduce(h,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var a=t.shape[0],o=t.shape[1];i!=null&&(a=i.shape[0],o=i.shape[1]);var u=E_(o),c=new XU({windowSize:u,inSize:o,batchSize:a},r,i==null),h=[t];i!=null&&h.push(i);var d=this.compileAndRun(c,h,"int32");return d.shape[1]===1?d:this.argReduce(t,r,d)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var a=i!=null?i.shape:t.shape,o=E_(a[a.length-1]),u=new ez(a,o,r,i==null),c=i==null?[t]:[t,i],h=this.compileAndRun(u,c,"int32");return h.rank===t.rank?this.argReducePacked(t,r,h):h},e.prototype.sum=function(t,r){ci("sum",r,t.rank);var i=xr(t.shape,r),a=i[0],o=je(i[1]),u=t.as2D(-1,o),c=m_(t.dtype);return this.reduce(u,"sum",c).reshape(a)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=xr(t.shape,r),a=i[0],o=je(i[1]),u=t.as2D(-1,o),c=m_(t.dtype);return this.reduce(u,"prod",c).reshape(a)},e.prototype.unsortedSegmentSum=function(t,r,i){var a=0,o=no([a],t.rank),u=t;o!=null&&(u=t.transpose(o),a=ro(1,t.rank)[0]);var c=(function(v,b,w){for(var E=[],T=v.length,R=0;R<T;R++)R!==b?E.push(v[R]):E.push(w);return E})(u.shape,a,i),h=je([u.shape[a]]),d=u.as2D(-1,h),p=m_(t.dtype),g=this.segOpCompute(d,"unsortedSegmentSum",r,p,i).reshape(c);return o!=null&&(g=g.transpose(gx(o))),g},e.prototype.segOpCompute=function(t,r,i,a,o){var u=t.shape[0],c=t.shape[1],h=(function(g,v){var b,w=!1;for(g<=Ek?(b=g,w=!0):b=kb(g,Math.floor(Math.sqrt(g)));!w;)b>v||b===g?w=!0:b=kb(g,b+1);return b})(c,o),d=new v9({windowSize:h,inSize:c,batchSize:u,numSegments:o}),p=this.compileAndRun(d,[t,i],a);return p.shape[1]===o?p:(i=xg(0,o).tile([c/h]),this.segOpCompute(p,r,i,a,o))},e.prototype.argMinMaxReduce=function(t,r,i){var a=[r];if(ci("arg"+i.charAt(0).toUpperCase()+i.slice(1),a,t.rank),!ge().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=xr(t.shape,a),u=o[0],c=je(o[1]),h=t.as2D(-1,c);return this.argReduce(h,i).reshape(u)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,a){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var o=new bz(t.shape,i,a);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new fn("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new fn("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new fn("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new fn("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new fn("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new fn("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new ht(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new fn("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new fn("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var a=new y9(t.rank,r.shape,r.rank);return this.compileAndRun(a,[t,r,i],dr(r.dtype,i.dtype))},e.prototype.where=function(t){_g("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Tx(t.shape,r)},e.prototype.topk=function(t,r,i){return Ok(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){ci("min",r,t.rank);var i=xr(t.shape,r),a=i[0],o=je(i[1]),u=t.as2D(-1,o);return this.reduce(u,"min",u.dtype).reshape(a)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);ci("max",r,t.rank);var i=xr(t.shape,r),a=i[0],o=je(i[1]),u=t.as2D(-1,o);return this.reduce(u,"max",u.dtype).reshape(a)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){ci("all",r,t.rank);var i=xr(t.shape,r),a=i[0],o=je(i[1]),u=t.as2D(-1,o);return this.reduce(u,"all",u.dtype).reshape(a)},e.prototype.any=function(t,r){ci("any",r,t.rank);var i=xr(t.shape,r),a=i[0],o=je(i[1]),u=t.as2D(-1,o);return this.reduce(u,"any",u.dtype).reshape(a)},e.prototype.realDivide=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new fn(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new fn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,T_);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=dr(t.dtype,r.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,T_,i);var a=new fn(T_,t.shape,r.shape);return this.compileAndRun(a,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var a=new Tf(t.shape,r);return this.compileAndRun(a,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,a,o){o===void 0&&(o=!1);var u=new Ao(i,t.shape,r.shape,o);return this.compileAndRun(u,[t,r],a)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var a=this,o=this.texData.get(t.dataId),u=this.texData.get(r.dataId),c=[[o.complexTensors.real,u.complexTensors.real],[o.complexTensors.imag,u.complexTensors.imag]].map((function(g){var v=g[0],b=g[1],w=a.makeComplexComponentTensorInfo(t,v),E=a.makeComplexComponentTensorInfo(r,b),T=new fn(i,t.shape,r.shape);return a.compileAndRun(T,[w,E],dr(v.dtype,b.dtype))})),h=c[0],d=c[1],p=this.complex(h,d);return h.dispose(),d.dispose(),p},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>ge().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),a=this.addN(t.slice(r));return this.addN([i,a])}var o=t.map((function(h){return h.dtype})).reduce((function(h,d){return dr(h,d)})),u=t.map((function(h){return h.shape})),c=ge().getBool("WEBGL_PACK")?new KU(t[0].shape,u):new qU(t[0].shape,u);return this.compileAndRun(c,t,o)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,C_);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=dr(t.dtype,r.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,C_,t.dtype);var a=new fn(C_,t.shape,r.shape);return this.compileAndRun(a,[t,r],i)},e.prototype.pow=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),a=dr(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],a)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,WA,t.dtype);var r=new ht(t.shape,WA);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qA,t.dtype);var r=new ht(t.shape,qA);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new ht(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new ht(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new ht(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new ht(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new ht(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,KA,t.dtype);var r=new ht(t.shape,KA);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XA,t.dtype);var r=new ht(t.shape,XA);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=qn([r],t.shape),a=this.max(t,i),o=Jr(a.shape,i),u=this.subtract(t,a.reshape(o)),c=this.exp(u),h=this.sum(c,i).reshape(o);return this.realDivide(c,h)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new ht(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new ht(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new ht(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new ht(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new ht(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=ge().getBool("WEBGL_PACK")?new Tf(t.shape,Gk):new ht(t.shape,jk),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=ge().getBool("WEBGL_PACK")?new Tf(t.shape,Hk):new ht(t.shape,Uk),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(Bk,t.shape,r.shape):new fn(Lk,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Wk,t.dtype);var r=new ht(t.shape,zk);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new fn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new ht(t.shape,A9);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new ht(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var a,o=(a=ge().getBool("WEBGL_PACK_CLIP")?new uz(t.shape):new sz(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(a,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,GA,t.dtype);var r=new ht(t.shape,GA);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new lz(t.shape),a=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,a)},e.prototype.sigmoid=function(t){var r=new ht(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new ht(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new ht(t.shape,R9);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new ht(t.shape,I9);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new ht(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new ht(t.shape,N9);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new ht(t.shape,D9);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new ht(t.shape,k9);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new ht(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new ht(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new ht(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new ht(t.shape,M9);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new ht(t.shape,O9);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new ht(t.shape,P9);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new ht(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new ht(t.shape,(function(a){return a===void 0&&(a=0),da+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `})(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,a,o,u){var c=t.shape,h=this.texData.get(t.dataId),d=i.inChannels,p=c[0]*c[1]*c[2],g=i.outChannels,v=i.dataFormat==="channelsLast",b=(p===1||g===1)&&d>1e3,w=c[2]%2!=0&&!!h.isPacked;if(b||!ge().getBool("WEBGL_LAZILY_UNPACK")||!ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!w){var E=v?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],T=this.reshape(t,[1,E,i.inChannels]),R=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:T,b:R,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:u}),i.outShape)}var I=v?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),C={dataId:t.dataId,shape:[1,I,i.inChannels],dtype:t.dtype},k=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,H(Nm(h.shape,C.shape),(function(){return"packed reshape "+h.shape+" to "+C.shape+" isn't free"}));var L=this.reshape(r,[1,i.inChannels,i.outChannels]),O=this.fusedBatchMatMul({a:C,b:L,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:u}),N=this.texData.get(O.dataId);return H(N.isPacked,(function(){return"batchMatMul result is expected to be packed"})),h.shape=k,N.shape=i.outShape,Z.makeTensorFromDataId(O.dataId,i.outShape,O.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,a,o,u){var c=i.filterWidth,h=i.filterHeight,d=i.inChannels,p=i.outWidth,g=i.outHeight,v=i.dataFormat==="channelsLast",b=c*h*d,w=g*p,E=[b,w],T=t.squeeze([0]),R=r.reshape([1,b,-1]),I=new Qz(E,T.shape,i),C=this.compileAndRun(I,[T]).reshape([1,E[0],E[1]]),k=a!=null,L=u!=null,O=o?Om(o,!0):null,N=new S_(C.shape,[1,w,i.outChannels],!0,!1,k,O,L),D=[C,R];a&&D.push(a),L&&D.push(u);var P=this.compileAndRun(N,D);return v?P.reshape([1,g,p,i.outChannels]):P.reshape([1,i.outChannels,g,p])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,a=t.convInfo,o=t.bias,u=t.activation,c=t.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,a,o,u,c);if(ge().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,a,o,u,c);var h=o!=null,d=c!=null,p=u?Om(u,!1):null,g=new OA(a,h,p,d),v=[r,i];return o&&v.push(o),c&&v.push(c),this.compileAndRun(g,v)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(ge().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var a=new OA(i);return this.compileAndRun(a,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var a=new dz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var a=new fz(i);return this.compileAndRun(a,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,a=t.filter,o=t.convInfo,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,p=c?Om(c,d):null,g=[i,a],v=u!=null,b=h!=null;return v&&g.push(u),b&&g.push(h),d?(r=new VA(o,v,p,b),this.compileAndRun(r,g)):(r=new PA(o,v,p,b),this.compileAndRun(r,g))},e.prototype.depthwiseConv2D=function(t,r,i){var a;return ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(a=new VA(i),this.compileAndRun(a,[t,r])):(a=new PA(i),this.compileAndRun(a,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var a=new vz(i);return this.compileAndRun(a,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var a=new gz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv3d=function(t,r,i){var a=new yz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var a=new mz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var a=new pz(i);return this.compileAndRun(a,[t,r])},e.prototype.maxPool=function(t,r){var i=new A_(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new A_(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,a){var o=new A_(a,"max",!0),u=this.compileAndRun(o,[r]),c=new t9(a),h=this.compileAndRun(c,[t,u],r.dtype);return u.dispose(),h},e.prototype.avgPoolBackprop=function(t,r,i){var a=new tz(i);return this.compileAndRun(a,[t],r.dtype)},e.prototype.cast=function(t,r){return Ik(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],a=new Array(t.rank-1),o=0,u=0;u<t.rank;u++)u!==r&&(a[o++]=t.shape[u]);var c=new Array(t.rank).fill(0),h=t.shape.slice();h[r]=1;var d=new Array(i);for(u=0;u<d.length;u++)c[r]=u,d[u]=this.slice(t,c,h).reshape(a);return d},e.prototype.avgPool3d=function(t,r){var i=new R_(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var a=new nz(i);return this.compileAndRun(a,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new R_(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,a){var o=new R_(a,"max",!0),u=this.compileAndRun(o,[r]),c=new n9(a),h=this.compileAndRun(c,[t,u],r.dtype);return u.dispose(),h},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!Nm(t.shape,r)&&(i.texture===null||!Nm(i.shape,r))){var a=this.packedReshape(t,r);return Z.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return jb(t,r)},e.prototype.resizeBilinear=function(t,r,i,a){var o=ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new f9(t.shape,r,i,a):new h9(t.shape,r,i,a);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var a=new c9(t,r,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,a){var o=new p9(t.shape,r,i,a);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var a=new d9(t,r,i);return this.compileAndRun(a,[t])},e.prototype.multinomial=function(t,r,i,a){var o=r?t:Uo(t),u=o.shape[0],c=o.shape[1],h=new r9(u,c,i),d=h.getCustomSetupFunc(a);return this.compileAndRun(h,[o],"int32",d)},e.prototype.oneHot=function(t,r,i,a){var o=new i9(t.size,r,i,a);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var r=new Tz(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,a,o){return _g("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),wx(t.dataSync(),r.dataSync(),i,a,o)},e.prototype.cropAndResize=function(t,r,i,a,o,u){var c=new _z(t.shape,r.shape,a,o,u);return this.compileAndRun(c,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){H(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var a=t.shape[0],o=i==="NHWC"?t.shape[1]:t.shape[2],u=i==="NHWC"?t.shape[2]:t.shape[3],c=i==="NHWC"?t.shape[3]:t.shape[1],h=o*r,d=u*r,p=c/(r*r),g=new Ez(i==="NHWC"?[a,h,d,p]:[a,p,h,d],r,i);return this.compileAndRun(g,[t])},e.prototype.split=function(t,r,i){return kk(t,r,i)},e.prototype.scatterND=function(t,r,i){var a=Cg(0,t,i),o=a.sliceRank,u=a.numUpdates,c=a.sliceSize,h=a.strides,d=a.outputSize,p=[d/c,c],g=t.reshape([u,o]),v=r.reshape([u,c]);if(d===0)return jb(pr([]),i);var b=Re(0),w=new jA(u,o,g.rank,v.rank,h,p);return this.compileAndRun(w,[v,g,b]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,a){var o=Cg(0,t,i),u=o.sliceRank,c=o.numUpdates,h=o.strides,d=o.outputSize,p=new jA(c,u,t.rank,r.rank,h,[d,1]);return this.compileAndRun(p,[r,t,a]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),a=new LA(Iz,t.shape,r),o=new LA(Nz,t.shape,r),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(a,u),h=this.compileAndRun(o,u),d=this.complex(c,h).as2D(t.shape[0],t.shape[1]);return c.dispose(),h.dispose(),d},e.prototype.gatherND=function(t,r){var i=r.shape,a=i[i.length-1],o=wk(t,r),u=o[0],c=o[1],h=o[2],d=o[3],p=r.reshape([c,a]),g=t.reshape([t.size/h,h]),v=new Mz(a,d,[c,h]);return this.compileAndRun(v,[g,p]).reshape(u)},e.prototype.fill=function(t,r,i){if((i=i||Id(r))==="string"){var a=mg(i,je(t));return a.fill(r),Z.makeTensor(a,t,i,this)}var o=new Dz(t,r),u=o.getCustomSetupFunc(r);return this.compileAndRun(o,[],i,u)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return Nk(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return Z.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new F9(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new a9(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[vg(t.shape)].concat(yg(t.shape)),a={dtype:t.dtype,shape:i,dataId:t.dataId},o=[vg(r)].concat(yg(r)),u=new l9(o,i),c=this.runWebGLProgram(u,[a],t.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),a=i.isPacked,o=i.shape,u=i.dtype,c=w_(o);return r=a?new wz(c):new xz(c),{dtype:u,shape:o,dataId:this.runWebGLProgram(r,[{shape:c,dtype:u,dataId:t}],u,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,a,o){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,i),h=this.texData.get(c.dataId);if(t.packedOutput&&(h.isPacked=!0),t.outPackingScheme===rd.DENSE){var d=Lf(t.outputShape);h.texShape=d.map((function(I){return 2*I}))}if(t.outTexUsage!=null&&(h.usage=t.outTexUsage),je(c.shape)===0)return h.values=td(c.dtype,0),c;var p=[],g=r.map((function(I){if(I.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var C=u.texData.get(I.dataId);if(C.texture==null){if(!t.packedInputs&&je(I.shape)<=ge().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:I.shape,texData:null,isUniform:!0,uniformValues:C.values};t.packedInputs&&(C.isPacked=!0,C.shape=I.shape)}else if(!!C.isPacked!=!!t.packedInputs)I=C.isPacked?u.unpackTensor(I):u.packTensor(I),p.push(I),C=u.texData.get(I.dataId);else if(C.isPacked&&!Nm(C.shape,I.shape)){var k=I,L=I.shape;I.shape=C.shape,I=u.packedReshape(I,L),p.push(I),C=u.texData.get(I.dataId),k.shape=L}return u.uploadToGPU(I.dataId),{shape:I.shape,texData:C,isUniform:!1}}));this.uploadToGPU(c.dataId);var v,b={shape:c.shape,texData:h,isUniform:!1},w=(function(I,C,k){var L="";C.concat(k).forEach((function(D){var P=D.texData!=null&&D.texData.slice!=null&&D.texData.slice.flatOffset>0,F=D.isUniform?"uniform":D.texData.texShape;L+=D.shape+"_"+F+"_"+P}));var O=I.userCode,N=I.constructor.name;return N+="_"+L+"_"+O})(t,g,b),E=this.getAndSaveBinary(w,(function(){return(function(I,C,k,L){var O=C.userCode,N=k.map((function(ee,ue){var fe={logicalShape:ee.shape,texShape:ee.isUniform?null:ee.texData.texShape,isUniform:ee.isUniform,isPacked:!ee.isUniform&&ee.texData.isPacked,flatOffset:null};return ee.texData!=null&&ee.texData.slice!=null&&ee.texData.slice.flatOffset>0&&(fe.flatOffset=ee.texData.slice.flatOffset),{name:C.variableNames[ue],shapeInfo:fe}})),D=N.map((function(ee){return ee.shapeInfo})),P={logicalShape:L.shape,texShape:L.texData.texShape,isUniform:!1,isPacked:L.texData.isPacked,flatOffset:null},F=YU(N,P,O,C.packedInputs),j=I.createProgram(F),B=null,J=I.getUniformLocation(j,"NAN",!1);ge().getNumber("WEBGL_VERSION")===1&&(B=I.getUniformLocation(j,"INFINITY",!1));for(var ne={},q=0;q<C.variableNames.length;q++){var Y=C.variableNames[q];ne[Y]=I.getUniformLocation(j,Y,!1),ne["offset"+Y]=I.getUniformLocation(j,"offset"+Y,!1)}return{program:C,source:F,webGLProgram:j,uniformLocations:ne,inShapeInfos:D,outShapeInfo:P,infLoc:B,nanLoc:J}})(u.gpgpu,t,g,b)})),T=this.activeTimers!=null;if(T&&(v=this.startTimer()),(function(I,C,k,L,O){BA(C.inShapeInfos,k),BA([C.outShapeInfo],[L]);var N=L.texData.texture,D=L.texData.texShape;L.texData.isPacked?I.setOutputPackedMatrixTexture(N,D[0],D[1]):I.setOutputMatrixTexture(N,D[0],D[1]),I.setProgram(C.webGLProgram),ge().getNumber("WEBGL_VERSION")===1&&C.infLoc!==null&&I.gl.uniform1f(C.infLoc,1/0),C.nanLoc!==null&&I.gl.uniform1f(C.nanLoc,NaN),k.forEach((function(P,F){var j=C.program.variableNames[F],B=C.uniformLocations[j],J=C.uniformLocations["offset"+j];if(B!=null)if(P.isUniform)if(je(P.shape)<2)I.gl.uniform1f(B,P.uniformValues[0]);else{var ne=P.uniformValues;ne instanceof Float32Array||(ne=new Float32Array(ne)),I.gl.uniform1fv(B,ne)}else P.texData.slice!=null&&J!=null&&I.gl.uniform1i(J,P.texData.slice.flatOffset),I.setInputMatrixTexture(P.texData.texture,B,F)})),O?.(I,C.webGLProgram),I.executeProgram()})(this.gpgpu,E,g,b,a),p.forEach((function(I){return u.disposeData(I.dataId)})),T&&(v=this.endTimer(v),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(v)})),!ge().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&o===!1){var R=this.unpackTensor(c);return this.disposeData(c.dataId),R}return c},e.prototype.compileAndRun=function(t,r,i,a,o){o===void 0&&(o=!1),i=i||r[0].dtype;var u=this.runWebGLProgram(t,r,i,a,o);return Z.makeTensorFromDataId(u.dataId,u.shape,u.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(ge().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Oe((function(){if(!ge().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=ge().getBool("DEBUG");ge().set("DEBUG",!1);var i=t.abs(Re(1e-8)).dataSync()[0];if(ge().set("DEBUG",r),i>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),a=i.shape,o=i.dtype,u=i.values,c=i.texture,h=i.usage,d=i.isPacked;if(c==null){var p,g=this.activeTimers!=null;g&&(p=Ba());var v=i.texShape;if(v==null&&(v=W5(a,d),i.texShape=v),u!=null){var b=w_(a),w=void 0,E=v[1],T=v[0],R=u instanceof Uint8Array;d?(E=(r=Dd(v[0],v[1]))[0],T=r[1],w=new Rz(b,[T,E],R)):w=new Az(b,[T,E],R);var I=this.makeTensorInfo([T,E],o);this.texData.get(I.dataId).usage=R?fi.PIXELS:fi.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(I.dataId),E,T,u);var C=this.runWebGLProgram(w,[I],o,null,!0),k=this.texData.get(C.dataId);i.texture=k.texture,i.texShape=k.texShape,i.isPacked=k.isPacked,i.usage=k.usage,this.disposeData(I.dataId),this.texData.delete(C.dataId),i.values=null,g&&(this.uploadWaitMs+=Ba()-p)}else{var L=this.acquireTexture(v,h,o,d);i.texture=L}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),a=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=(function(o,u){if(u==="float32"||u==="complex64")return o;if(u==="int32"||u==="bool"){for(var c=u==="int32"?new Int32Array(o.length):new Uint8Array(o.length),h=0;h<c.length;++h)c[h]=Math.round(o[h]);return c}throw new Error("Unknown dtype "+u)})(r,a)),i.values},e.prototype.acquireTexture=function(t,r,i,a){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,a)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*ik(r)},e})(Ak);hk()&&Z.registerBackend("webgl",(function(){return new B9}),2);var j9=X({square_:function(n){var e=z(n,"x","square"),t=[e];return Z.runKernelFunc((function(r,i){return i([e]),r.square(e)}),{x:e},null,"Square",{},t,[])}}),ad="SquaredDifference",qk=X({squaredDifference_:function(n,e){var t,r=z(n,"a","squaredDifference"),i=z(e,"b","squaredDifference");t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape);var a={a:r,b:i},o=[r,i];return Z.runKernelFunc((function(u,c){var h=u.squaredDifference(r,i);return c([r,i]),h}),a,(function(u,c){var h=c[0],d=c[1],p=Re(2);return{a:function(){return u.mul(h.sub(d).mul(p))},b:function(){return u.mul(d.sub(h).mul(p))}}}),ad,{},o,[])}}),U9=X({abs_:function(n){var e=z(n,"x","abs");return e.dtype==="complex64"?Z.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):Z.runKernelFunc((function(t,r){var i=t.abs(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}}),"Abs")}}),z9=X({acos_:function(n){var e=z(n,"x","acos");return Z.runKernelFunc((function(t,r){var i=t.acos(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Re(1).sub(i.toFloat().square()).sqrt()).neg()}}}))}}),G9=X({acosh_:function(n){var e=z(n,"x","acosh");return Z.runKernelFunc((function(t,r){var i=t.acosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}}))}}),H9=X({asin_:function(n){var e=z(n,"x","asin");return Z.runKernelFunc((function(t,r){var i=t.asin(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Re(1).sub(i.toFloat().square()).sqrt())}}}))}}),W9=X({asinh_:function(n){var e=z(n,"x","asinh");return Z.runKernelFunc((function(t,r){var i=t.asinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Re(1).add(i.toFloat().square()).sqrt())}}}))}}),q9=X({atan_:function(n){var e=z(n,"x","atan");return Z.runKernelFunc((function(t,r){var i=t.atan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}}))}}),K9=X({atanh_:function(n){var e=z(n,"x","atanh");return Z.runKernelFunc((function(t,r){var i=t.atanh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(Re(1).sub(i.toFloat().square()))}}}))}}),X9=X({ceil_:function(n){var e=z(n,"x","ceil");return Z.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),Rx=X({clipByValue_:function(n,e,t){var r=z(n,"x","clipByValue");H(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var i=[r],a={min:e,max:t};return Z.runKernelFunc((function(o,u){var c=o.clip(r,e,t);return u([r]),c}),{x:r},(function(o,u){var c=u[0];return{x:function(){return o.where(c.greaterEqual(e).logicalAnd(c.lessEqual(t)),St(o))}}}),"ClipByValue",a,i)}}),Y9=X({cos_:function(n){var e=z(n,"x","cos"),t=[e];return Z.runKernelFunc((function(r,i){var a=r.cos(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return a.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),$9=X({cosh_:function(n){var e=z(n,"x","cosh");return Z.runKernelFunc((function(t,r){var i=t.cosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}}))}}),Q9=X({erf_:function(n){var e=z(n,"x","erf");return H(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),Z.runKernelFunc((function(t,r){var i=t.erf(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),zb=X({exp_:function(n){var e=z(n,"x","exp");return Z.runKernelFunc((function(t,r){var i=t.exp(e);return r([i]),i}),{x:e},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),Z9=X({expm1_:function(n){var e=z(n,"x","expm1");return Z.runKernelFunc((function(t,r){var i=t.expm1(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}}))}}),J9=X({floor_:function(n){var e=z(n,"x","floor");return Z.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),e8=X({log_:function(n){var e=z(n,"x","log"),t=[e];return Z.runKernelFunc((function(r,i){var a=r.log(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return r.div(a.toFloat())}}}),"Log",{},t)}}),t8=X({log1p_:function(n){var e=z(n,"x","log1p");return Z.runKernelFunc((function(t,r){var i=t.log1p(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}}))}}),n8=X({logSigmoid_:function(n){var e=z(n,"x","logSigmoid");return Z.runKernelFunc((function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}}))}}),Ig=X({neg_:function(n){var e=z(n,"x","neg"),t=[e];return Z.runKernelFunc((function(r){return r.neg(e)}),{x:e},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),r8=X({reciprocal_:function(n){var e=z(n,"x","reciprocal");return Z.runKernelFunc((function(t,r){var i=t.reciprocal(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}}))}}),i8=X({round_:function(n){var e=z(n,"x","round");return Z.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),Kk=X({rsqrt_:function(n){var e=z(n,"x","rsqrt"),t=[e];return Z.runKernelFunc((function(r,i){var a=r.rsqrt(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return r.div(a.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),Xk=X({sigmoid_:function(n){var e=z(n,"x","sigmoid");return Z.runKernelFunc((function(t,r){var i=t.sigmoid(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Re(1).sub(i)))}}}),"Sigmoid")}}),a8=X({sign_:function(n){var e=z(n,"x","sign");return Z.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),o8=X({isNaN_:function(n){var e=z(n,"x","isNaN");return Z.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),s8=X({isInf_:function(n){var e=z(n,"x","isInf");return Z.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),u8=X({isFinite_:function(n){var e=z(n,"x","isFinite");return Z.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return St(t)}}}))}}),l8=X({sin_:function(n){var e=z(n,"x","sin"),t=[e];return Z.runKernelFunc((function(r,i){var a=r.sin(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return a.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),c8=X({sinh_:function(n){var e=z(n,"x","sinh");return Z.runKernelFunc((function(t,r){var i=t.sinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}}))}}),h8=X({softplus_:function(n){var e=z(n,"x","softplus");return Z.runKernelFunc((function(t,r){var i=t.softplus(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}}))}}),f8=X({sqrt_:function(n){var e=z(n,"x","sqrt");return Z.runKernelFunc((function(t,r){var i=t.sqrt(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}}))}}),d8=X({step_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","step");return Z.runKernelFunc((function(r){return r.step(t,e)}),{$x:t},(function(r){return{$x:function(){return St(r)}}}))}}),p8=X({tan_:function(n){var e=z(n,"x","tan");return Z.runKernelFunc((function(t,r){var i=t.tan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}}))}}),m8=X({tanh_:function(n){var e=z(n,"x","tanh");return Z.runKernelFunc((function(t,r){var i=t.tanh(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return Re(1).sub(i.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function Yk(n,e,t,r,i,a){var o,u,c=z(n,"x","batchNorm"),h=z(e,"mean","batchNorm"),d=z(t,"variance","batchNorm");return i!=null&&(o=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),H(c.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),H(h.rank===2||h.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."})),H(d.rank===2||d.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."})),o!=null&&H(o.rank===2||o.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),u!=null&&H(u.rank===2||u.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."})),Md(c,h,d,u,o,a)}function $k(n,e,t,r,i,a){var o,u,c=z(n,"x","batchNorm"),h=z(e,"mean","batchNorm"),d=z(t,"variance","batchNorm");return i!=null&&(o=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),H(c.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),H(h.rank===3||h.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."})),H(d.rank===3||d.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."})),o!=null&&H(o.rank===3||o.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),u!=null&&H(u.rank===3||u.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."})),Md(c,h,d,u,o,a)}function Qk(n,e,t,r,i,a){var o,u,c=z(n,"x","batchNorm"),h=z(e,"mean","batchNorm"),d=z(t,"variance","batchNorm");return i!=null&&(o=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),H(c.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."})),H(h.rank===4||h.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."})),H(d.rank===4||d.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."})),o!=null&&H(o.rank===4||o.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),u!=null&&H(u.rank===4||u.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."})),Md(c,h,d,u,o,a)}function Md(n,e,t,r,i,a){a==null&&(a=.001);var o,u,c,h=z(n,"x","batchNorm"),d=z(e,"mean","batchNorm"),p=z(t,"variance","batchNorm");i!=null&&(o=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),H(d.rank===p.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),H(u==null||d.rank===u.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),H(o==null||d.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),c=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h;var g=[h,d,p,o];return Z.runKernelFunc((function(v,b){var w=v.batchNormalization(c,Pm(d),Pm(p),a,Pm(o),Pm(u));return b([h,d,p,o]),w}),{x:h,mean:d,variance:p,scale:o,offset:u},(function(v,b){var w=b,E=w[0],T=w[1],R=w[2],I=w[3],C=I??Re(1),k=Hn(T.shape,c.shape),L=[];if(T.rank===1){for(var O=0;O<c.shape.length-1;++O)L.push(c.shape[O]);L.push(1)}var N=E.sub(T),D=v.mul(C),P=Kk(R.add(Re(a))),F=P.mul(P).mul(P).mul(Re(-.5));return{x:function(){return T.rank===1?v.mul(Rc(P.as4D(1,1,1,T.shape[0]),L)).mul(C).reshape(E.shape):v.mul(P).mul(C).reshape(E.shape)},mean:function(){var j=P.mul(Re(-1)).mul(D);return T.rank===1&&(j=j.sum(k)),j.reshape(T.shape)},variance:function(){var j=F.mul(N).mul(D);return T.rank===1&&(j=j.sum(k)),j.reshape(T.shape)},scale:function(){var j=N.mul(P),B=v.mul(j);return T.rank===1&&(B=B.sum(k)),B.reshape(T.shape)},offset:function(){var j=v;return T.rank===1&&(j=j.sum(k)),j.reshape(T.shape)}}}),"BatchNormalization",{varianceEpsilon:a},g).reshape(h.shape)}function Pm(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function dv(){fk("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var g8=X({batchNormalization2d_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),dv(),Yk(n,e,t,a,i,r)}}),v8=X({batchNormalization3d_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),dv(),$k(n,e,t,a,i,r)}}),y8=X({batchNormalization4d_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),dv(),Qk(n,e,t,a,i,r)}}),_8=X({batchNormalization_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),dv(),Md(n,e,t,a,i,r)}}),Zk=X({batchNorm_:Md}),b8=X({batchNorm2d_:Yk}),x8=X({batchNorm3d_:$k}),w8=X({batchNorm4d_:Qk}),pv=X({logicalAnd_:function(n,e){var t=z(n,"a","logicalAnd","bool"),r=z(e,"b","logicalAnd","bool");return mt(t.shape,r.shape),Z.runKernelFunc((function(i){return i.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),E8=X({logicalNot_:function(n){var e=z(n,"x","logicalNot","bool");return Z.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),Jk=X({logicalOr_:function(n,e){var t=z(n,"a","logicalOr","bool"),r=z(e,"b","logicalOr","bool");return mt(t.shape,r.shape),Z.runKernelFunc((function(i){return i.logicalOr(t,r)}),{$a:t,$b:r})}}),T8=X({logicalXor_:function(n,e){var t=z(n,"a","logicalXor","bool"),r=z(e,"b","logicalXor","bool");return mt(t.shape,r.shape),Jk(n,e).logicalAnd(pv(n,e).logicalNot())}}),Ju=X({where_:function(n,e,t){var r=z(e,"a","where"),i=z(t,"b","where"),a=z(n,"condition","where","bool");return Pt(r.shape,i.shape,"Error in where: "),a.rank===1?H(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):Pt(a.shape,i.shape,"Error in where: "),Z.runKernelFunc((function(o,u){var c=o.select(a,r,i);return u([a]),c}),{$condition:a,$a:r,$b:i},(function(o,u){var c=u[0];return{$condition:function(){return St(c).toFloat()},$a:function(){return o.mul(c.cast(o.dtype))},$b:function(){return o.mul(c.logicalNot().cast(o.dtype))}}}))}}),eM=function(n){return Fe(this,void 0,void 0,(function(){var e,t,r;return Le(this,(function(i){switch(i.label){case 0:return[4,(e=z(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Tx(e.shape,t),n!==e&&e.dispose(),[2,r]}}))}))},ft=X({add_:function(n,e){var t,r=z(n,"a","add"),i=z(e,"b","add");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o){return o.add(r,i)}),{a:r,b:i},(function(o){return{a:function(){var u=o,c=Hn(r.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(r.shape)},b:function(){var u=o,c=Hn(i.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(i.shape)}}}),"Add")}}),C8=X({addN_:function(n){H(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),H(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var e=n.map((function(i,a){return z(i,"tensors"+a,"addN")})),t=e[0];e.forEach((function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(i){if(!rr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return Z.runKernelFunc((function(i){return i.addN(e)}),r,(function(i){var a={};return e.forEach((function(o,u){a[u]=function(){return i.clone()}})),a}),"AddN")}}),S8=X({addStrict_:function(n,e){var t=z(n,"a","addStrict"),r=z(e,"b","addStrict");return Pt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),A8=X({atan2_:function(n,e){var t,r=z(n,"a","atan2"),i=z(e,"b","atan2");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o,u){var c=o.atan2(r,i);return u([r,i]),c}),{$a:r,$b:i},(function(o,u){var c=u[0],h=u[1];return{$a:function(){var d=ft(c.square(),h.square()),p=o.mul(h.div(d)),g=Hn(c.shape,a);return g.length>0&&(p=p.sum(g)),p.reshape(c.shape)},$b:function(){var d=ft(c.square(),h.square()),p=Ig(o.mul(c.div(d))),g=Hn(h.shape,a);return g.length>0&&(p=p.sum(g)),p.reshape(h.shape)}}}))}}),ra=X({div_:function(n,e){var t,r=z(n,"a","div"),i=z(e,"b","div");if(t=un(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return tM(r,i);var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o,u){var c=o.realDivide(r,i);return u([r,i]),c}),{a:r,b:i},(function(o,u){var c=u[0],h=u[1];return{a:function(){var d=o.div(h.toFloat()),p=Hn(c.shape,a);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),p=Hn(h.shape,a);p.length>0&&(d=d.sum(p).reshape(h.shape));var g=h.square();return d.div(g.toFloat()).neg()}}}),"Div")}}),R8=X({divNoNan_:function(n,e){var t,r=z(n,"a","div"),i=z(e,"b","div");r=(t=un(r,i))[0],i=t[1];var a=ra(r,i),o=St(a),u=i.equal(o);return Ju(u,o,a)}}),I8=X({divStrict_:function(n,e){var t=z(n,"a","div"),r=z(e,"b","div");return Pt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),tM=X({floorDiv_:function(n,e){var t,r=z(n,"a","floorDiv"),i=z(e,"b","floorDiv");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o,u){var c=o.floorDiv(r,i);return u([r,i]),c}),{a:r,b:i},(function(o,u){var c=u[0],h=u[1];return{a:function(){var d=o.div(h.toFloat()),p=Hn(c.shape,a);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),p=Hn(h.shape,a);p.length>0&&(d=d.sum(p).reshape(h.shape));var g=h.square();return d.div(g.toFloat()).neg()}}}),"FloorDiv")}}),Ix=X({maximum_:function(n,e){var t,r=z(n,"a","maximum"),i=z(e,"b","maximum");return t=un(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),mt(r.shape,i.shape),Z.runKernelFunc((function(a,o){var u=a.maximum(r,i);return o([r,i]),u}),{a:r,b:i},(function(a,o){var u=o[0],c=o[1];return{a:function(){return a.mul(u.greaterEqual(c).toFloat())},b:function(){return a.mul(u.less(c).toFloat())}}}),"Maximum")}}),N8=X({maximumStrict_:function(n,e){var t=z(n,"a","maximumStrict"),r=z(e,"b","maximumStrict");return Pt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),nM=X({minimum_:function(n,e){var t,r=z(n,"a","minimum"),i=z(e,"b","minimum");return t=un(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),mt(r.shape,i.shape),Z.runKernelFunc((function(a,o){var u=a.minimum(r,i);return o([r,i]),u}),{a:r,b:i},(function(a,o){var u=o[0],c=o[1];return{a:function(){return a.mul(u.lessEqual(c).toFloat())},b:function(){return a.mul(u.greater(c).toFloat())}}}),"Minimum")}}),D8=X({minimumStrict_:function(n,e){var t=z(n,"a","minimumStrict"),r=z(e,"b","minimumStrict");return Pt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),k8=X({mod_:function(n,e){var t,r=z(n,"a","mod"),i=z(e,"b","mod");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o,u){var c=o.mod(r,i);return u([r,i]),c}),{$a:r,$b:i},(function(o,u){var c=u[0],h=u[1];return{$a:function(){var d=Hn(c.shape,a);return d.length>0?o.sum(d).reshape(c.shape):o},$b:function(){var d=o.mul(c.div(h).floor().neg()),p=Hn(h.shape,a);return p.length>0?d.sum(p).reshape(h.shape):d}}}))}}),M8=X({modStrict_:function(n,e){var t=z(n,"a","modStrict"),r=z(e,"b","modStrict");return Pt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Nr=X({mul_:function(n,e){var t,r=z(n,"a","mul"),i=z(e,"b","mul");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o,u){var c=o.multiply(r,i);return u([r,i]),c}),{a:r,b:i},(function(o,u){var c=u[0],h=u[1];return{a:function(){var d=o.mul(h.toFloat()),p=Hn(c.shape,a);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),p=Hn(h.shape,a);return p.length>0?d.sum(p).reshape(h.shape):d}}}),"Mul")}}),O8=X({mulStrict_:function(n,e){var t=z(n,"a","mul"),r=z(e,"b","mul");return Pt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Ng=X({pow_:function(n,e){var t,r=z(n,"base","pow"),i=z(e,"exp","pow");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape),o=[r,i];return Z.runKernelFunc((function(u,c){var h=u.pow(r,i);return c([r,i,h]),h}),{a:r,b:i},(function(u,c){var h=c[0],d=c[1],p=c[2];return{a:function(){var g=d.toFloat(),v=u.mul(g.mul(h.pow(g.sub(Re(1))))),b=Hn(h.shape,a);return b.length>0&&(v=v.sum(b)),v.reshape(h.shape)},b:function(){var g=h.greater(0),v=h.log().where(g,St(h)),b=u.mul(p.mul(v)),w=Hn(d.shape,a);return w.length>0&&(b=b.sum(w)),b.reshape(d.shape)}}}),"Pow",{},o,[!0])}}),P8=X({powStrict_:function(n,e){return Pt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),V8=X({squaredDifferenceStrict_:function(n,e){var t=z(n,"a","squaredDifferenceStrict"),r=z(e,"b","squaredDifferenceStrict");return Pt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Wn=X({sub_:function(n,e){var t,r=z(n,"a","sub"),i=z(e,"b","sub");t=un(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return Z.runKernelFunc((function(o){return o.subtract(r,i)}),{a:r,b:i},(function(o){return{a:function(){var u=o,c=Hn(r.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(r.shape)},b:function(){var u=o,c=Hn(i.shape,a);return c.length>0&&(u=u.sum(c)),u.neg().reshape(i.shape)}}}),"Sub")}}),F8=X({subStrict_:function(n,e){var t=z(n,"a","subStrict"),r=z(e,"b","subStrict");return Pt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),rM=X({equal_:function(n,e){var t,r=z(n,"a","equal"),i=z(e,"b","equal");return t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),Z.runKernelFunc((function(a){return a.equal(r,i)}),{$a:r,$b:i})}}),L8=X({equalStrict_:function(n,e){var t=z(n,"a","equalStrict"),r=z(e,"b","equalStrict");return Pt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),B8=X({greater_:function(n,e){var t,r=z(n,"a","greater"),i=z(e,"b","greater");return t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),Z.runKernelFunc((function(a){return a.greater(r,i)}),{a:r,b:i},null,"Greater")}}),iM=X({greaterEqual_:function(n,e){var t,r=z(n,"a","greaterEqual"),i=z(e,"b","greaterEqual");return t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),Z.runKernelFunc((function(a,o){var u=a.greaterEqual(r,i);return o([r,i]),u}),{a:r,b:i},(function(a,o){var u=o[0],c=o[1];return{a:function(){return St(u)},b:function(){return St(c)}}}),"GreaterEqual")}}),j8=X({greaterEqualStrict_:function(n,e){var t=z(n,"a","greaterEqualStrict"),r=z(e,"b","greaterEqualStrict");return Pt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),U8=X({greaterStrict_:function(n,e){var t=z(n,"a","greaterStrict"),r=z(e,"b","greaterStrict");return Pt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),z8=X({less_:function(n,e){var t,r=z(n,"a","less"),i=z(e,"b","less");return t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),Z.runKernelFunc((function(a){return a.less(r,i)}),{a:r,b:i},null,"Less")}}),G8=X({lessEqual_:function(n,e){var t,r=z(n,"a","lessEqual"),i=z(e,"b","lessEqual");return t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),Z.runKernelFunc((function(a,o){var u=a.lessEqual(r,i);return o([r,i]),u}),{a:r,b:i},null,"LessEqual")}}),H8=X({lessEqualStrict_:function(n,e){var t=z(n,"a","lessEqualStrict"),r=z(e,"b","lessEqualStrict");return Pt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),W8=X({lessStrict_:function(n,e){var t=z(n,"a","lessStrict"),r=z(e,"b","lessStrict");return Pt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),q8=X({notEqual_:function(n,e){var t,r=z(n,"a","notEqual"),i=z(e,"b","notEqual");return t=un(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),Z.runKernelFunc((function(a){return a.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),K8=X({notEqualStrict_:function(n,e){var t=z(n,"a","notEqualStrict"),r=z(e,"b","notEqualStrict");return Pt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function YA(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function $A(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Nx=X({gather_:function(n,e,t){t===void 0&&(t=0);var r=z(n,"x","gather"),i=z(e,"indices","gather","int32");t=qn(t,r.shape)[0];var a=(function(o,u,c){for(var h=o.shape[c],d=[],p=1,g=1,v=0;v<c;v++)d.push(o.shape[v]),p*=o.shape[v];for(v=0;v<u.rank;v++)d.push(u.shape[v]);for(v=c+1;v<o.rank;v++)d.push(o.shape[v]),g*=o.shape[v];return{batchSize:p,sliceSize:g,dimSize:h,outputShape:d}})(r,i,t);return Z.runKernelFunc((function(o,u){var c=o.gather(r,i.flatten(),t);return u([i]),c}),{x:r,indices:i},(function(o,u){var c=u[0];return{x:function(){var h=r.shape,d=c.size,p=h.slice(0,t),g=p.length,v=h.slice(t,h.length).slice(1),b=v.length,w=YA(0,g),E=YA(g+1,g+1+b),T=$A([p,[d],v]),R=o.reshape(T),I=c.reshape([d]),C=$A([[g],w,E]),k=R.transpose(C),L=aM(k,I,r.shape[t]),O=gx(C);return L=L.transpose(O)},indices:function(){return c}}}),"Gather",{axis:t}).reshape(a.outputShape)}}),aM=X({unsortedSegmentSum_:function(n,e,t){var r=z(n,"x","unsortedSegmentSum"),i=z(e,"segmentIds","unsortedSegmentSum","int32");return H(bn(t),(function(){return"numSegments must be of dtype int"})),Z.runKernelFunc((function(a,o){var u=a.unsortedSegmentSum(r,i,t);return o([i]),u}),{$x:r},(function(a,o){var u=o[0];return{$x:function(){return(function(c,h){for(var d=Ix(h,St(h)),p=Nx(c,d),g=iM(h,Re(0,"int32")),v=p.rank-g.rank,b=0;b<v;++b)g=Oi(g,b+1);g=pv(g,oh(p.shape,"bool"));var w=St(p);return Ju(g,p,w)})(a,u)}}}))}}),X8=function(n,e,t){return Fe(this,void 0,void 0,(function(){var r,i,a,o,u,c,h,d,p,g,v,b,w;return Le(this,(function(E){switch(E.label){case 0:for(r=z(n,"tensor","boolMask"),i=z(e,"mask","boolMask","bool"),a=t??0,o=i.rank,u=r.shape,H(o>0,(function(){return"mask cannot be scalar"})),Pt(u.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,h=a;h<a+o;h++)c*=u[h];return d=u.slice(0,a).concat([c],u.slice(a+o)),p=r.reshape(d),g=i.reshape([-1]),[4,eM(g)];case 1:return v=E.sent(),b=v.squeeze([1]),w=Nx(p,b,a),n!==r&&r.dispose(),e!==i&&i.dispose(),b.dispose(),p.dispose(),g.dispose(),v.dispose(),[2,w]}}))}))};function oM(n,e,t,r,i,a,o){a===void 0&&(a="NHWC"),H(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var u=n,c=e,h=!1;e.rank===3&&(h=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),u=[1,n[0],n[1],n[2]]),H(u.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."})),H(c.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank})),H(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var d=a==="NHWC"?u[3]:u[1],p=a==="NHWC"?c.shape[3]:c.shape[1];H(d===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+t.shape[2]+"."})),H(p===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+t.shape[3]+"."})),o!=null&&H(bn(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var g=xx(a),v=ul(u,t.shape,r,1,i,o,!1,g),b=Z.runKernelFunc((function(w,E){var T=w.conv2dDerInput(c,t,v);return E([t,c]),T}),{dy4D:c,filter:t},(function(w,E){var T=E[0],R=E[1];return{dy4D:function(){return Gi(w,T,r,i,a,1,o)},filter:function(){return Dx(w,R,T.shape,r,i,a,o)}}}));return h?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}function N_(n){var e=(function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a})(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function sM(n,e,t,r,i){H(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var a=n,o=e,u=!1;e.rank===4&&(u=!0,o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,n[0],n[1],n[2],n[3]]);var c=a[4],h=o.shape[4];H(a.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),H(o.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),H(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),H(c===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[3]+"."})),H(h===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[4]+"."}));var d=Ag(a,t.shape,r,1,i),p=Z.runKernelFunc((function(g){return g.conv3dDerInput(o,t,d)}),{dy5D:o});return u?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var Y8=X({conv1d_:function(n,e,t,r,i,a,o){i===void 0&&(i="NWC"),a===void 0&&(a=1);var u=z(n,"x","conv1d"),c=z(e,"filter","conv1d"),h=u,d=!1;u.rank===2&&(d=!0,h=u.as3D(1,u.shape[0],u.shape[1])),H(h.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."})),H(c.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."})),o!=null&&H(bn(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),H(h.shape[2]===c.shape[1],(function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+c.shape[1]+"."})),H(ei(t,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+a+"'"})),H(i==="NWC",(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var p=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),g=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),v=Gi(g,p,[1,t],r,"NHWC",[1,a],o);return d?v.as2D(v.shape[2],v.shape[3]):v.as3D(v.shape[0],v.shape[2],v.shape[3])}}),Gi=X({conv2d_:function(n,e,t,r,i,a,o){i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]);var u=z(n,"x","conv2d"),c=z(e,"filter","conv2d"),h=u,d=!1;u.rank===3&&(d=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),H(h.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."})),H(c.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."})),o!=null&&H(bn(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var p=i==="NHWC"?h.shape[3]:h.shape[1];H(p===c.shape[2],(function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+c.shape[2]+"."})),H(ei(t,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}));var g=xx(i),v=ul(h.shape,c.shape,t,a,r,o,!1,g),b=[c,h],w=Z.runKernelFunc((function(E,T){var R=E.conv2d(h,c,v);return T([c,h]),R}),{x:h,filter:c},(function(E,T){var R=T,I=R[0],C=R[1];return H(Wc(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return uM(C.shape,E,I,t,r,i)},filter:function(){return Dx(C,E,I.shape,t,r,i)}}}),"Conv2D",v,b);return d?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),$8=X({conv3d_:function(n,e,t,r,i,a){i===void 0&&(i="NDHWC"),a===void 0&&(a=[1,1,1]);var o=z(n,"x","conv3d"),u=z(e,"filter","conv3d"),c=o,h=!1;o.rank===4&&(h=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),H(c.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."})),H(u.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."})),H(c.shape[4]===u.shape[3],(function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+u.shape[3]+"."})),H((function(g,v){return N_(g)||N_(v)})(t,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),H(i==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var d=Ag(c.shape,u.shape,t,a,r),p=Z.runKernelFunc((function(g,v){var b=g.conv3d(c,u,d);return v([c,u]),b}),{x:c,$filter:u},(function(g,v){H(N_(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var b=v[0],w=v[1];return{x:function(){return sM(b.shape,g,w,t,r)},$filter:function(){return(function(E,T,R,I,C){var k=E;E.rank===4&&(k=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]));var L=T;L.rank===4&&(L=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),H(k.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."})),H(L.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+L.shape+"."})),H(R.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+R+"."})),H(k.shape[4]===R[3],(function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+R[3]+"."})),H(L.shape[4]===R[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+L.shape[4]+") must match output depth for filter ("+R[4]+")."}));var O=Ag(k.shape,R,I,1,C);return Z.runKernelFunc((function(N){return N.conv3dDerFilter(k,L,O)}),{x5D:k,dy5D:L})})(b,g,w.shape,t,r)}}}));return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Dx=X({conv2dDerFilter_:function(n,e,t,r,i,a,o){a===void 0&&(a="NHWC");var u=n;n.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var c=e;c.rank===3&&(c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),H(u.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."})),H(c.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."})),H(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var h=a==="NHWC"?u.shape[3]:u.shape[1],d=a==="NHWC"?c.shape[3]:c.shape[1];H(h===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+t[2]+"."})),H(d===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+t[3]+")."})),o!=null&&H(bn(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var p=xx(a),g=ul(u.shape,t,r,1,i,o,!1,p);return Z.runKernelFunc((function(v){return v.conv2dDerFilter(u,c,g)}),{x4D:u,dy4D:c})}}),uM=X({conv2dDerInput_:oM}),mv=X({depthwiseConv2d_:function(n,e,t,r,i,a,o){a===void 0&&(a=[1,1]);var u=z(n,"x","depthwiseConv2d"),c=z(e,"filter","depthwiseConv2d"),h=u,d=!1;u.rank===3&&(d=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),H(h.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."})),H(c.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."})),H(h.shape[3]===c.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."})),a==null&&(a=[1,1]),H(ei(t,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),o!=null&&H(bn(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var p=ul(h.shape,c.shape,t,a,r,o,!0),g=[h,c],v=Z.runKernelFunc((function(b,w){var E=b.depthwiseConv2D(h,c,p);return w([h,c]),E}),{x:h,filter:c},(function(b,w){H(Wc(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var E=w[0],T=w[1];return{x:function(){return lM(E.shape,b,T,p)},filter:function(){return cM(E,b,T.shape,p)}}}),"DepthwiseConv2dNative",p,g);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),lM=X({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,a=!1;e.rank===3&&(a=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=Z.runKernelFunc((function(u){return u.depthwiseConv2DDerInput(i,t,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),cM=X({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e;return a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Z.runKernelFunc((function(o){return o.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),kx=X({separableConv2d_:function(n,e,t,r,i,a,o){a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC");var u=z(n,"x","separableConv2d"),c=z(e,"depthwiseFilter","separableConv2d"),h=z(t,"pointwiseFilter","separableConv2d"),d=u,p=!1;if(u.rank===3&&(p=!0,d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");H(d.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."})),H(c.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."})),H(h.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."})),H(h.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."})),H(h.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."}));var g=c.shape[2],v=c.shape[3];H(h.shape[2]===g*v,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+g*v+", but got "+h.shape[2]+"."}));var b=mv(d,c,r,i,o,a),w=Gi(b,h,1,"valid",o);return p?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),Q8=X({conv2dTranspose_:function(n,e,t,r,i,a){return oM(t,z(n,"x","conv2dTranspose"),z(e,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),Z8=X({conv3dTranspose_:function(n,e,t,r,i){return sM(t,z(n,"x","conv3dTranspose"),z(e,"filter","conv3dTranspose"),r,i)}}),gv=X({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var a=z(n,"a","matMul"),o=z(e,"b","matMul");i=un(a,o),a=i[0],o=i[1];var u=t?a.shape[a.rank-2]:a.shape[a.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],h=t?a.shape[a.rank-1]:a.shape[a.rank-2],d=r?o.shape[o.rank-2]:o.shape[o.rank-1],p=a.shape.slice(0,-2),g=o.shape.slice(0,-2),v=je(p),b=je(g);H(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),H(rr(p,g),(function(){return"Error in matMul: outer dimensions ("+p+") and ("+g+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),H(u===c,(function(){return"Error in matMul: inner shapes ("+u+") and ("+c+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var w=a.shape.slice(0,-2).concat([h,d]),E=t?a.as3D(v,u,h):a.as3D(v,h,u),T=r?o.as3D(b,d,c):o.as3D(b,c,d),R={transposeA:t,transposeB:r};return Z.runKernelFunc((function(I,C){var k=I.batchMatMul(E,T,t,r);return C([E,T]),k}),{a:E,b:T},(function(I,C){var k=C,L=k[0],O=k[1];return t||r?!t&&r?{a:function(){return I.matMul(O,!1,!1)},b:function(){return I.matMul(L,!0,!1)}}:t&&!r?{a:function(){return O.matMul(I,!1,!0)},b:function(){return L.matMul(I,!1,!1)}}:{a:function(){return O.matMul(I,!0,!0)},b:function(){return I.matMul(L,!0,!0)}}:{a:function(){return I.matMul(O,!1,!0)},b:function(){return L.matMul(I,!0,!1)}}}),"BatchMatMul",R).reshape(w)}}),J8=X({dot_:function(n,e){var t=z(n,"t1","dot"),r=z(e,"t2","dot");H(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var i=t.rank===1?t.size:t.shape[1],a=r.rank===1?r.size:r.shape[0];return H(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),eG=X({outerProduct_:function(n,e){var t=z(n,"v1","outerProduct"),r=z(e,"v2","outerProduct");return H(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Od=X({reverse_:function(n,e){var t=z(n,"x","reverse");if(t.rank===0)return t.clone();var r=qn(e,t.shape);return Z.runKernelFunc((function(i){return i.reverse(t,r)}),{$x:t},(function(i){return{$x:function(){return i.reverse(r)}}})).reshapeAs(t)}}),tG=X({reverse1d_:function(n){var e=z(n,"x","reverse");return H(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),Od(e,0)}}),nG=X({reverse2d_:function(n,e){var t=z(n,"x","reverse");return H(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),Od(t,e)}}),rG=X({reverse3d_:function(n,e){var t=z(n,"x","reverse");return H(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),Od(t,e)}}),iG=X({reverse4d_:function(n,e){var t=z(n,"x","reverse");return H(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),Od(t,e)}});function hM(n,e,t,r,i,a){var o=z(n,"x","maxPool"),u=o,c=!1;o.rank===3&&(c=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),H(u.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."})),H(ei(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),a!=null&&H(bn(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=id(u.shape,e,t,r,i,a);if(h.filterWidth===1&&h.filterHeight===1&&rr(h.inShape,h.outShape))return o.clone();var d=[u],p=Z.runKernelFunc((function(g,v){var b=g.maxPool(u,h);return v([u,b]),b}),{x:u},(function(g,v){var b=v[0],w=v[1];return{x:function(){return(function(E,T,R,I,C,k,L,O){var N=z(E,"dy","maxPoolBackprop"),D=z(T,"input","maxPoolBackprop"),P=z(R,"output","maxPoolBackprop");H(D.rank===N.rank,(function(){return"Rank of input ("+D.rank+") does not match rank of dy ("+N.rank+")"})),H(ei(C,k),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+k+"'"})),H(N.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+N.rank+"."})),H(D.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+D.rank+"."}));var F=id(D.shape,I,C,k,L,O);return Z.runKernelFunc((function(j){return j.maxPoolBackprop(N,D,P,F)}),{$dy:N,$input:D})})(g,b,w,e,t,r,i)}}}),"MaxPool",h,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function fM(n,e,t,r,i,a){var o=z(n,"x","avgPool","float32");H(ei(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var u=o,c=!1;o.rank===3&&(c=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),H(u.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."})),a!=null&&H(bn(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=id(u.shape,e,t,r,i,a);if(h.filterWidth===1&&h.filterHeight===1&&rr(h.inShape,h.outShape))return o.clone();var d=Z.runKernelFunc((function(p){return p.avgPool(u,h)}),{x:u},(function(p){return{x:function(){return(function(g,v,b,w,E,T){var R=z(g,"dy","avgPoolBackprop"),I=z(v,"input","avgPoolBackprop");H(I.rank===R.rank,(function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+R.rank+")"})),H(ei(w,E),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+E+"'"}));var C=I,k=R,L=!1;I.rank===3&&(L=!0,C=I.as4D(1,I.shape[0],I.shape[1],I.shape[2]),k=R.as4D(1,R.shape[0],R.shape[1],R.shape[2])),H(k.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."})),H(C.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+C.rank+"."}));var O=id(C.shape,b,w,E,T),N=Z.runKernelFunc((function(D){return D.avgPoolBackprop(k,C,O)}),{dy4D:k,input4D:C});return L?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N})(p,u,e,t,r,i)}}}),"AvgPool",h);return d=d.cast(o.dtype),c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var Zn=X({maxPool_:function(n,e,t,r,i){return hM(n,e,t,1,r,i)}}),Pd=X({avgPool_:function(n,e,t,r,i){return fM(n,e,t,1,r,i)}}),aG=X({pool_:function(n,e,t,r,i,a){i==null&&(i=[1,1]),a==null&&(a=1),r===0&&(r="valid");var o=z(n,"x","maxPool"),u=o,c=!1;o.rank===3&&(c=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),H(ei(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var h,d=id(u.shape,e,a,i,r),p=[d.dilationHeight,d.dilationWidth];h=r==="same"?(function(C,k){var L=C.map((function(D,P){return D+(D-1)*(k[P]-1)})).map((function(D){return D-1})),O=L.map((function(D){return Math.floor(D/2)})),N=L.map((function(D,P){return D-O[P]}));return L.map((function(D,P){return[O[P],N[P]]}))})([d.filterHeight,d.filterWidth],p):[[0,0],[0,0]];var g=p[0]===1&&p[1]===1,v=(function(C,k,L){var O=L.map((function(J){return J[0]})),N=L.map((function(J){return J[1]})),D=C.concat(O,N),P=k.map((function(J,ne){return(J-D[ne]%J)%J})),F=N.map((function(J,ne){return J+P[ne]})),j=k.map((function(J,ne){return[O[ne],F[ne]]})),B=k.map((function(J,ne){return[0,P[ne]]}));return[j,B]})([d.inHeight,d.inWidth],p,h),b=v[0],w=v[1],E=g?r:"valid",T=g?u:yk(u,p,b),R=(t==="avg"?function(){return fM(T,e,a,1,E)}:function(){return hM(T,e,a,1,E)})(),I=g?R:mk(R,p,w);return c?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),oG=X({maxPool3d_:function(n,e,t,r,i,a,o){a===void 0&&(a="NDHWC");var u=z(n,"x","maxPool3d"),c=u,h=!1;u.rank===4&&(h=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),o==null&&(o=[1,1,1]),H(c.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."})),H(a==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),H(ei(t,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),i!=null&&H(bn(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=Sg(c.shape,e,t,o,r,i,a),p=Z.runKernelFunc((function(g,v){var b=g.maxPool3d(c,d);return v([c,b]),b}),{x:c},(function(g,v){var b=v[0],w=v[1];return{x:function(){return(function(E,T,R,I,C,k,L,O){var N=z(E,"dy","maxPool3dBackprop"),D=z(T,"input","maxPool3dBackprop"),P=z(R,"output","maxPool3dBackprop"),F=N,j=D,B=P,J=!1;D.rank===4&&(J=!0,F=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3]),j=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),B=P.as5D(1,P.shape[0],P.shape[1],P.shape[2],P.shape[3])),H(F.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+F.rank+"."})),H(j.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+j.rank+"."})),H(B.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."})),k==null&&(k=[1,1,1]),H(ei(C,k),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+k+"'"})),O!=null&&H(bn(L),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+O+" but got pad "+L+"."}));var ne=Sg(j.shape,I,C,k,L,O),q=Z.runKernelFunc((function(Y){return Y.maxPool3dBackprop(F,j,B,ne)}),{dy5D:F,input5D:j});return J?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q})(g,b,w,e,t,o,r,i)}}}));return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),sG=X({avgPool3d_:function(n,e,t,r,i,a,o){a===void 0&&(a="NDHWC");var u=z(n,"x","avgPool3d","float32"),c=u,h=!1;u.rank===4&&(h=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),o==null&&(o=[1,1,1]),H(c.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."})),H(a==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),H(ei(t,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),i!=null&&H(bn(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=Sg(c.shape,e,t,o,r,i,a),p=Z.runKernelFunc((function(g){return g.avgPool3d(c,d)}),{x:c},(function(g){return{x:function(){return(function(v,b,w,E,T,R,I){var C=z(v,"dy","avgPool3dBackprop"),k=z(b,"input","avgPool3dBackprop"),L=C,O=k,N=!1;k.rank===4&&(N=!0,L=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),O=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),H(L.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+L.rank+"."})),H(O.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."})),T==null&&(T=[1,1,1]),H(ei(E,T),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+T+"'"})),I!=null&&H(bn(R),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+I+" but got pad "+R+"."}));var D=Sg(O.shape,w,E,T,R,I),P=Z.runKernelFunc((function(F){return F.avgPool3dBackprop(L,O,D)}),{dy5D:L,input5D:O});return N?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P})(g,c,e,t,o,r,i)}}}));return p=p.cast(c.dtype),h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Ja=X({slice_:function(n,e,t){var r,i,a=z(n,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach((function(c){H(c!==-1,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=t==null?new Array(a.rank).fill(-1):typeof t=="number"?[t].concat(new Array(a.rank-1).fill(-1)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(-1)):t).map((function(c,h){return c>=0?c:(H(c===-1,(function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+h+"."})),a.shape[h]-r[h])})),PU(a,r,i);var o=a.shape,u={begin:r,size:i};return Z.runKernelFunc((function(c){return c.slice(a,r,i)}),{x:a},(function(c){for(var h=[],d=0;d<c.rank;d++)h.push([r[d],o[d]-r[d]-i[d]]);return{x:function(){return c.pad(h)}}}),"Slice",u)}}),uG=X({slice1d_:function(n,e,t){var r=z(n,"x","slice1d");return H(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Ja(r,[e],[t])}}),lG=X({slice2d_:function(n,e,t){var r=z(n,"x","slice2d");return H(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Ja(r,e,t)}}),dM=X({slice3d_:function(n,e,t){var r=z(n,"x","slice3d");return H(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Ja(r,e,t)}}),cG=X({slice4d_:function(n,e,t){var r=z(n,"x","slice4d");return H(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Ja(r,e,t)}});function pM(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(Jr(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Jr(n.shape,r))),{x:function(){var a=n.mul(t.equal(e).cast(n.dtype));return i==null?a:a.transpose(i)}}}var hG=X({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","all","bool"),i=qn(e,r.shape),a=i,o=no(a,r.rank);o!=null&&(r=r.transpose(o),a=ro(a.length,r.rank));var u=Z.runKernelFunc((function(h){return h.all(r,a)}),{$x:r});if(t){var c=Jr(u.shape,i);return u.reshape(c)}return u}}),fG=X({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","any","bool"),i=qn(e,r.shape),a=i,o=no(a,r.rank);o!=null&&(r=r.transpose(o),a=ro(a.length,r.rank));var u=Z.runKernelFunc((function(h){return h.any(r,a)}),{$x:r});if(t){var c=Jr(u.shape,i);return u.reshape(c)}return u}}),dG=X({argMax_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","argMax");e==null&&(e=0);var r=qn(e,t.shape),i=no(r,t.rank);i!=null&&(t=t.transpose(i),r=ro(r.length,t.rank));var a={axis:r[0]},o=[t];return Z.runKernelFunc((function(u,c){var h=u.argMax(t,r[0]);return c([t]),h}),{x:t},(function(u,c){var h=c[0];return{x:function(){return St(h)}}}),"ArgMax",a,o)}}),pG=X({argMin_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","argMin");e==null&&(e=0);var r=qn(e,t.shape),i=no(r,t.rank);return i!=null&&(t=t.transpose(i),r=ro(r.length,t.rank)),Z.runKernelFunc((function(a,o){var u=a.argMin(t,r[0]);return o([t]),u}),{$x:t},(function(a,o){var u=o[0];return{$x:function(){return St(u)}}}))}}),mG=X({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","logSumExp"),i=qn(e,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),u=a.reshape(o.shape).add(o);if(t){var c=Jr(u.shape,i);return u.reshape(c)}return u}}),vv=X({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","max"),i=r,a=qn(e,r.shape),o=a,u=no(o,r.rank);u!=null&&(r=r.transpose(u),o=ro(o.length,r.rank));var c=[r],h=Z.runKernelFunc((function(p,g){var v=p.max(r,o);return g([i,v]),v}),{x:r},(function(p,g){return pM(p,g[1],g[0],a,u)}),"Max",{axes:o},c,[!0]);if(t){var d=Jr(h.shape,a);h=h.reshape(d)}return h}}),gG=X({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","mean"),i=qn(e,r.shape),a=je(xr(r.shape,i)[1]);return fv((function(o){var u=Re(a);return{value:(u.dtype===o.dtype?o:o.cast(u.dtype)).div(u).sum(e,t),gradFunc:function(c){var h=o.shape.slice();return i.forEach((function(d){h[d]=1})),c.reshape(h).mul(oh(o.shape,"float32")).div(a)}}}))(r)}}),vG=X({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","min"),i=r,a=qn(e,r.shape),o=a,u=no(o,r.rank);u!=null&&(r=r.transpose(u),o=ro(o.length,r.rank));var c=[r],h=Z.runKernelFunc((function(p,g){var v=p.min(r,o);return g([i,v]),v}),{x:r},(function(p,g){return pM(p,g[1],g[0],a,u)}),"Min",{axes:o},c,[!0]);if(t){var d=Jr(h.shape,a);h=h.reshape(d)}return h}}),yG=X({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=qn(e,(n=z(n,"x","moments")).shape),i=n.mean(r,t),a=i.shape;t||(a=Jr(i.shape,r));var o=n.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(r,t)}}}),mM=X({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=qn(e,r.shape);return fv((function(a){var o=no(i,a.rank),u=i,c=a;o!=null&&(c=a.transpose(o),u=ro(u.length,a.rank));var h=function(v){var b=a.shape.slice();return i.forEach((function(w){b[w]=1})),v.reshape(b).mul(oh(a.shape,"float32"))},d={axes:u},p=Z.runKernelFunc((function(v){return v.sum(c,u)}),{x:c},(function(v){return{x:function(){return h(v)}}}),"Sum",d);if(t){var g=Jr(p.shape,i);p=p.reshape(g)}return{value:p,gradFunc:h}}))(r)}}),_G=X({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=qn(e,r.shape),a=no(i,r.rank),o=i,u=r;a!=null&&(u=r.transpose(a),o=ro(o.length,r.rank));var c=Z.runKernelFunc((function(d){return d.prod(u,o)}),{permutedX:u});if(t){var h=Jr(c.shape,i);c=c.reshape(h)}return c}}),gM=X({elu_:function(n){var e=z(n,"x","elu");return Z.runKernelFunc((function(t,r){var i=t.elu(e);return r([i]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return Z.runKernelFunc((function(a){return a.eluDer(t,i)}),{dy:t,y:i})}}}))}}),bG=X({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=z(n,"x","leakyRelu");return Ix(Re(e).mul(t),t)}}),vM=X({prelu_:function(n,e){var t=z(n,"x","prelu"),r=z(e,"alpha","prelu");return Z.runKernelFunc((function(i,a){var o=i.prelu(t,r);return a([t,r]),o}),{x:t,alpha:r},(function(i,a){var o=a[0],u=a[1],c=o.greater(0);return{x:function(){return Ju(c,i,i.mul(u))},alpha:function(){var h=Ju(c,St(i),i.mul(o)),d=Hn(u.shape,i.shape);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)}}}),"Prelu")}}),sn=X({relu_:function(n){var e=z(n,"x","relu");return e.dtype==="bool"?e.toInt():Z.runKernelFunc((function(t,r){var i=t.relu(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}}),"Relu")}}),yM=X({relu6_:function(n){var e=z(n,"x","relu6");return e.dtype==="bool"?e.toInt():Z.runKernelFunc((function(t,r){var i=t.relu6(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0],a=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(a.toFloat())}}}),"Relu6")}}),xG=X({selu_:function(n){var e=z(n,"x","selu");return Z.runKernelFunc((function(t,r){var i=t.selu(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){var a=i.greater(Re(0)),o=Re(Sx),u=Re(Ax),c=t.mul(u),h=t.mul(o).mul(i.toFloat().exp());return Ju(a,c,h)}}}))}}),Gs=X({transpose_:function(n,e){var t=z(n,"x","transpose");if(e==null&&(e=t.shape.map((function(i,a){return a})).reverse()),H(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(i){H(i>=0&&i<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var r={perm:e};return Z.runKernelFunc((function(i){return i.transpose(t,e)}),{x:t},(function(i){var a=gx(e);return{x:function(){return i.transpose(a)}}}),"Transpose",r)}}),wG=X({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var a=z(n,"x","localResponseNormalization");H(a.rank===4||a.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."})),H(bn(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var o=a,u=!1;a.rank===3&&(u=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var c=Z.runKernelFunc((function(h,d){var p=h.localResponseNormalization4D(o,e,t,r,i);return d([o,p]),p}),{x4D:o},(function(h,d){var p=d[0],g=d[1];return{x4D:function(){return Z.runKernelFunc((function(v){return v.LRNGrad(h,p,g,e,t,r,i)}),{})}}}));return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),_M=X({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=(function u(c,h,d){if(d===void 0&&(d=null),c.rank===0)return c.abs();if(c.rank!==1&&d===null)return u(c.reshape([-1]),h,d);if(c.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(h===1)return c.abs().sum(d);if(h===1/0)return c.abs().max(d);if(h===-1/0)return c.abs().min(d);if(h==="euclidean"||h===2)return c.abs().pow(Re(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(d)&&d.length===2){if(h===1)return c.abs().sum(d[0]).max(d[1]-1);if(h===1/0)return c.abs().sum(d[1]).max(d[0]);if(h===-1/0)return c.abs().sum(d[1]).min(d[0]);if(h==="fro"||h==="euclidean")return c.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+d)})(n=z(n,"x","norm"),e,t),a=i.shape;if(r){var o=qn(t,n.shape);a=Jr(i.shape,o)}return i.reshape(a)}}),EG=X({basicLSTMCell_:function(n,e,t,r,i,a){var o=z(n,"forgetBias","basicLSTMCell"),u=z(e,"lstmKernel","basicLSTMCell"),c=z(t,"lstmBias","basicLSTMCell"),h=z(r,"data","basicLSTMCell"),d=z(i,"c","basicLSTMCell"),p=z(a,"h","basicLSTMCell"),g=h.concat(p,1).matMul(u).add(c),v=g.shape[0],b=g.shape[1]/4,w=[v,b],E=g.slice([0,0],w),T=g.slice([0,b],w),R=g.slice([0,2*b],w),I=g.slice([0,3*b],w),C=E.sigmoid().mulStrict(T.tanh()).addStrict(d.mulStrict(o.add(R).sigmoid())),k=C.tanh().mulStrict(I.sigmoid());return[C,k]}}),TG=X({multiRNNCell_:function(n,e,t,r){for(var i=z(e,"data","multiRNNCell"),a=bg(t,"c","multiRNNCell"),o=bg(r,"h","multiRNNCell"),u=i,c=[],h=0;h<n.length;h++){var d=n[h](u,a[h],o[h]);c.push(d[0]),c.push(d[1]),u=d[1]}var p=[],g=[];for(h=0;h<c.length;h+=2)p.push(c[h]),g.push(c[h+1]);return[p,g]}}),CG=X({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var a=z(n,"v","movingAverage"),o=z(e,"x","movingAverage"),u=z(t,"decay","movingAverage");w5(a,o),H(rr(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var c=Re(1),h=c.sub(u),d=o.sub(a).mul(h);if(i){H(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var p=z(r,"step","movingAverage");d=d.div(c.sub(Ng(u,p)))}return a.add(d)}}),SG=X({stridedSlice_:function(n,e,t,r,i,a,o,u,c){if(i===void 0&&(i=0),a===void 0&&(a=0),o===void 0&&(o=0),u===void 0&&(u=0),c===void 0&&(c=0),r==null&&(r=new Array(e.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var h=z(n,"x","stridedSlice"),d=IA(u),p=h.shape.slice();d.forEach((function(E){e[E]=0,t[E]=1,p.splice(E,0,1)})),h=h.reshape(p);for(var g=0;g<h.rank;g++)e[g]=VU(i,e,r,h.shape,g),t[g]=FU(a,t,r,h.shape,g),r[g]=r[g]||1;var v=IA(c);v.forEach((function(E){t[E]=e[E]+1,r[E]=1}));var b=bx(e,t,r),w=b.filter((function(E,T){return v.indexOf(T)===-1}));return r.every((function(E){return E===1}))?Ja(h,e,b).reshape(w):Z.runKernelFunc((function(E){return E.stridedSlice(h,e,t,r)}),{$x:h}).reshape(w)}}),AG=X({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=z(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var a=Z.runKernelFunc((function(o){return o.topk(r,e,t)}),{$x:r});return{values:a[0],indices:a[1]}}}),RG=X({scatterND_:function(n,e,t){var r=z(n,"indices","scatterND","int32"),i=z(e,"updates","scatterND");return OU(i,r,t),Z.runKernelFunc((function(a){return a.scatterND(r,i,t)}),{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Mx=X({fft_:function(n){H(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return Z.runKernelFunc((function(i){return i.fft(r)}),{input:n}).reshape(n.shape)}}),Dg=X({ifft_:function(n){H(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return Z.runKernelFunc((function(i){return i.ifft(r)}),{input:n}).reshape(n.shape)}}),Ox=X({rfft_:function(n,e){H(n.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var a=n.shape.map((function(T){return 0})),o=n.shape.map((function(T){return T}));o[n.shape.length-1]=e,t=n.slice(a,o),r=e}else if(e!=null&&e>r){var u=n.shape.map((function(T){return T}));u[n.shape.length-1]=e-r,t=n.concat($t(u),n.shape.length-1),r=e}else t=n;var c=t.zerosLike(),h=fr(t,c).as2D(i,r),d=Mx(h),p=Math.floor(r/2)+1,g=Pi(d),v=Ua(d),b=g.split([p,r-p],g.shape.length-1),w=v.split([p,r-p],v.shape.length-1),E=t.shape.slice();return E[t.shape.length-1]=p,fr(b[0],w[0]).reshape(E)}}),bM=X({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=Dg(r);return Pi(i)}var a=[t,2*(e-1)],o=Pi(n).as2D(t,e),u=Ua(n).as2D(t,e),c=o.slice([0,1],[t,e-2]).reverse(1),h=u.slice([0,1],[t,e-2]).reverse(1).mul(Re(-1)),d=o.concat(c,1),p=u.concat(h,1);return r=fr(d,p).as2D(a[0],a[1]),i=Dg(r),Pi(i)}}),IG=Object.freeze({fft:Mx,ifft:Dg,rfft:Ox,irfft:bM}),NG=X({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=z(n,"sparseIndices","sparseToDense","int32"),a=z(e,"sparseValues","sparseToDense"),o=z(r,"defaultValue","sparseToDense",a.dtype);return(function(u,c,h,d){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var p=u.rank>0?u.shape[0]:1,g=u.rank>1?u.shape[1]:1;if(h.length!==g)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+g+".");var v=c.size;if(c.rank!==0&&(c.rank!==1||v!==p))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+p+"]");if(c.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,a,t,o),Z.runKernelFunc((function(u){return u.sparseToDense(i,a,t,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),DG=X({gatherND_:function(n,e){var t=z(e,"indices","gatherND","int32"),r=z(n,"x","gatherND");return Z.runKernelFunc((function(i){return i.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),kG=X({diag_:function(n){var e=z(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return Z.runKernelFunc((function(r){return r.diag(e)}),{$x:e}).reshape(t)}}),MG=X({dropout_:function(n,e,t,r){var i=z(n,"x","dropout");if(H(i.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),H(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return n instanceof an?i.clone():i;var a=(function(c,h){if(h==null)return c.shape.slice();if(rr(c.shape,h))return h;if(c.shape.length===h.length){for(var d=[],p=0;p<c.shape.length;p++)h[p]==null&&c.shape[p]!=null?d.push(c.shape[p]):d.push(h[p]);return d}return h})(i,t),o=1-e,u=vk(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(u)}});function xM(n,e,t){for(var r=1-n%2,i=new Float32Array(n),a=0;a<n;++a){var o=2*Math.PI*a/(n+r-1);i[a]=e-t*Math.cos(o)}return kn(i,"float32")}var Px=X({hannWindow_:function(n){return xM(n,.5,.5)}}),wM=X({hammingWindow_:function(n){return xM(n,.54,.46)}}),Vx=X({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var a=0,o=[];a+e<=n.size;)o.push(Ja(n,a,e)),a+=t;if(r)for(;a<n.size;){var u=a+e-n.size,c=Un([Ja(n,a,e-u),Xa([u],i)]);o.push(c),a+=t}return o.length===0?Ns([],[0,e]):Un(o).as2D(o.length,e)}}),EM=X({stft_:function(n,e,t,r,i){var a;i===void 0&&(i=Px),r==null&&(a=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=Vx(n,e,t),u=Nr(o,i(e)),c=[],h=0;h<o.shape[0];h++)c.push(Ox(u.slice([h,0],[1,e]),r));return Un(c)}}),OG=Object.freeze({hannWindow:Px,hammingWindow:wM,frame:Vx,stft:EM}),Rr,PG=function(n,e,t){return t===void 0&&(t=1),Fe(this,void 0,void 0,(function(){var r,i,a,o,u,c,h,d,p,g,v,b,w,E;return Le(this,(function(T){switch(T.label){case 0:return r=z(n,"predictions","inTopK"),i=z(e,"targets","inTopK"),H(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),H(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),Pt(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],H(t>0&&t<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+t})),[4,r.data()];case 1:return o=T.sent(),[4,i.data()];case 2:for(u=T.sent(),c=[o.length/a,a],d=c[1],p=td("bool",h=c[0]),g=0;g<h;g++){for(v=g*d,b=o.subarray(v,v+d),w=[],E=0;E<b.length;E++)w.push({value:b[E],index:E});for(w.sort((function(R,I){return I.value-R.value})),p[g]=0,E=0;E<t;E++)if(w[E].index===u[g]){p[g]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,pr(p,i.shape,"bool")]}}))}))};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Rr||(Rr={}));var VG=X({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Rr.SUM_BY_NONZERO_WEIGHTS);var i=z(n,"labels","absoluteDifference"),a=z(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=z(t,"weights","absoluteDifference")),Pt(i.shape,a.shape,"Error in absoluteDifference: ");var u=i.sub(a).abs();return zo(u,o,r)}}),zo=X({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Rr.SUM_BY_NONZERO_WEIGHTS);var r=z(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=z(e,"weights","computeWeightedLoss"));var a=i==null?r:r.mul(i);if(t===Rr.NONE)return a;if(t===Rr.SUM)return a.sum();if(t===Rr.MEAN){if(i==null)return a.mean();var o=r.size/i.size,u=a.sum().div(i.sum());return o>1?u.div(Re(o)):u}if(t===Rr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return a.sum().div(Re(r.size));var c=i.mul(oh(r.shape)).notEqual(Re(0)).sum().toFloat();return a.sum().div(c)}throw Error("Unknown reduction: "+t)}}),FG=X({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Rr.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"labels","cosineDistance"),o=z(e,"predictions","cosineDistance"),u=null;r!=null&&(u=z(r,"weights","cosineDistance")),Pt(a.shape,o.shape,"Error in cosineDistance: ");var c=Re(1).sub(a.mul(o).sum(t,!0));return zo(c,u,i)}}),LG=X({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Rr.SUM_BY_NONZERO_WEIGHTS);var i=z(n,"labels","hingeLoss"),a=z(e,"predictions","hingeLoss"),o=null;t!=null&&(o=z(t,"weights","hingeLoss")),Pt(i.shape,a.shape,"Error in hingeLoss: ");var u=Re(1);i=Re(2).mul(i).sub(u);var c=u.sub(i.mul(a)).relu();return zo(c,o,r)}}),BG=X({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Rr.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"labels","huberLoss"),o=z(e,"predictions","huberLoss"),u=null;t!=null&&(u=z(t,"weights","huberLoss")),Pt(a.shape,o.shape,"Error in huberLoss: ");var c=Re(r),h=o.sub(a).abs(),d=nM(h,c),p=h.sub(d),g=Re(.5).mul(d.square()).add(c.mul(p));return zo(g,u,i)}}),jG=X({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Rr.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"labels","logLoss"),o=z(e,"predictions","logLoss"),u=null;t!=null&&(u=z(t,"weights","logLoss")),Pt(a.shape,o.shape,"Error in logLoss: ");var c=Re(1),h=Re(r),d=a.mul(o.add(h).log()).neg().sub(c.sub(a).mul(c.sub(o).add(h).log()));return zo(d,u,i)}}),UG=X({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Rr.SUM_BY_NONZERO_WEIGHTS);var i=z(n,"labels","meanSquaredError"),a=z(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=z(t,"weights","meanSquaredError")),Pt(i.shape,a.shape,"Error in meanSquaredError: ");var u=i.squaredDifference(a);return zo(u,o,r)}}),zG=X({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Rr.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"multiClassLabels","sigmoidCrossEntropy"),o=z(e,"logits","sigmoidCrossEntropy"),u=null;if(t!=null&&(u=z(t,"weights","sigmoidCrossEntropy")),Pt(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=Re(r),h=Re(1),d=Re(.5);a=a.mul(h.sub(c)).add(d.mul(c))}var p=(function(g,v){var b=z(g,"labels","sigmoidCrossEntropyWithLogits"),w=z(v,"logits","sigmoidCrossEntropyWithLogits");Pt(b.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var E=w.relu(),T=w.mul(b),R=w.abs().neg().exp().log1p();return E.sub(T).add(R)})(a,o);return zo(p,u,i)}}),GG=X({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Rr.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"onehotLabels","softmaxCrossEntropy"),o=z(e,"logits","softmaxCrossEntropy"),u=null;if(t!=null&&(u=z(t,"weights","softmaxCrossEntropy")),Pt(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Re(r),h=Re(1),d=Re(a.shape[1]);a=a.mul(h.sub(c)).add(c.div(d))}var p=(function(g,v,b){if(b===void 0&&(b=-1),b===-1&&(b=v.rank-1),b!==v.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+v.rank+" and dim was "+b);return fv((function(w,E,T){var R=E.logSumExp([b],!0),I=E.toFloat().sub(R);return T([w,I]),{value:I.mul(w).neg().sum([b]),gradFunc:function(C,k){var L=k[0],O=k[1],N=Jr(C.shape,[b]);return[C.reshape(N).mul(L.toFloat().sub(O.exp())),C.reshape(N).mul(O.exp().sub(L.toFloat()))]}}}))(g,v)})(a,o);return zo(p,u,i)}}),HG=Object.freeze({get Reduction(){return Rr},absoluteDifference:VG,computeWeightedLoss:zo,cosineDistance:FG,hingeLoss:LG,huberLoss:BG,logLoss:jG,meanSquaredError:UG,sigmoidCrossEntropy:zG,softmaxCrossEntropy:GG});function QA(n,e){return e===void 0&&(e=!1),Z.tidy((function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=gk(t),a=n.clone(),o=Ns([[1]],[1,1]),u=o.clone(),c=t>=r?r:t,h=function(p){var g,v=a,b=u,w=i;g=Z.tidy((function(){var E=a.slice([p,p],[t-p,1]),T=E.norm(),R=a.slice([p,p],[1,1]),I=Ns([[-1]]).where(R.greater(0),Ns([[1]])),C=R.sub(I.mul(T)),k=E.div(C);u=k.shape[0]===1?o.clone():o.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var L=I.matMul(C).div(T).neg(),O=a.slice([p,0],[t-p,r]),N=L.mul(u);if(p===0)a=O.sub(N.matMul(u.transpose().matMul(O)));else{var D=O.sub(N.matMul(u.transpose().matMul(O)));a=a.slice([0,0],[p,r]).concat(D,0)}var P=i.slice([0,p],[t,i.shape[1]-p]);if(p===0)i=P.sub(P.matMul(u).matMul(N.transpose()));else{var F=P.sub(P.matMul(u).matMul(N.transpose()));i=i.slice([0,0],[t,p]).concat(F,1)}return[u,a,i]})),u=g[0],a=g[1],i=g[2],Zr([v,b,w])},d=0;d<c;++d)h(d);return!e&&t>r&&(i=i.slice([0,0],[t,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var WG=X({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=z(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],u=a[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+o+").");if(!(t<=u))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+u+").");e<0&&(e=o),t<0&&(t=u);var c=xg(0,o,1,"int32").reshape([-1,1]),h=xg(0,u,1,"int32"),d=Wn(c,h),p=pv(d.lessEqual(Re(+e,"int32")),d.greaterEqual(Re(-t,"int32"))),g=$t([o,u],r.dtype);return gi(zn(r.reshape([-1,o,u])).map((function(v){return Ju(p,v,g)}))).reshape(i)}}),qG=X({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,H(n!=null&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=n[0].shape[0],r=function(c){H(n[c].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[c].shape[0]+" vs. "+t+")"}))},i=1;i<n.length;++i)r(i)}else e=!0,n=yx(n,n.shape[0],0).map((function(c){return _k(c,[0])}));H(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var a=[],o=n,u=function(c){a.push(Z.tidy((function(){var h=o[c];if(c>0)for(var d=0;d<c;++d){var p=mM(a[d].mulStrict(h)).mul(a[d]);h=h.sub(p)}return h.div(_M(h,"euclidean"))})))};for(i=0;i<n.length;++i)u(i);return e?gi(a,0):a}}),KG=X({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return QA(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce((function(o,u){return o*u})),r=zn(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],a=[];return r.forEach((function(o){var u=QA(o,e),c=u[0],h=u[1];i.push(c),a.push(h)})),[gi(i,0).reshape(n.shape),gi(a,0).reshape(n.shape)]}}),XG=Object.freeze({bandPart:WG,gramSchmidt:qG,qr:KG});function yv(n,e,t,r,i,a){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),a==null&&(a=0);var o=n.shape[0];return t=Math.min(t,o),H(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),H(n.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),H(n.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),H(e.rank===1,(function(){return"scores must be a 1D tensor"})),H(e.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]})),H(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var YG=X({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=z(n,"images","resizeBilinear");H(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),H(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var i=r,a=!1;r.rank===3&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],u=e[1],c=Z.runKernelFunc((function(h,d){return d([i]),h.resizeBilinear(i,o,u,t)}),{x:i},(function(h,d){return{x:function(){return Z.runKernelFunc((function(p){return p.resizeBilinearBackprop(h,d[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:o,newWidth:u});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),$G=X({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=z(n,"images","resizeNearestNeighbor");H(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),H(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),H(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;r.rank===3&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],u=e[1],c=Z.runKernelFunc((function(h,d){return d([i]),h.resizeNearestNeighbor(i,o,u,t)}),{batchImages:i},(function(h,d){return{batchImages:function(){return Z.runKernelFunc((function(p){return p.resizeNearestNeighborBackprop(h,d[0],t)}),{})}}}));return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),QG=X({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var a=z(n,"boxes","nonMaxSuppression"),o=z(e,"scores","nonMaxSuppression"),u=yv(a,o,t,r,i);t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold;var c={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return Z.runKernelFunc((function(h){return h.nonMaxSuppression(a,o,t,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",c)}}),ZG=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Fe(this,void 0,void 0,(function(){var a,o,u,c,h,d,p;return Le(this,(function(g){switch(g.label){case 0:return a=z(n,"boxes","nonMaxSuppressionAsync"),o=z(e,"scores","nonMaxSuppressionAsync"),u=yv(a,o,t,r,i),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return c=g.sent(),h=c[0],d=c[1],p=wx(h,d,t,r,i),a!==n&&a.dispose(),o!==e&&o.dispose(),[2,p]}}))}))},JG=X({nonMaxSuppressionWithScore_:function(n,e,t,r,i,a){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var o=z(n,"boxes","nonMaxSuppression"),u=z(e,"scores","nonMaxSuppression"),c=yv(o,u,t,r,i,a),h={maxOutputSize:t=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:a=c.softNmsSigma},d=Z.runKernel("NonMaxSuppressionV5",{boxes:o,scores:u},h);return{selectedIndices:d[0],selectedScores:d[1]}}}),eH=function(n,e,t,r,i,a){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),Fe(this,void 0,void 0,(function(){var o,u,c,h,d,p,g;return Le(this,(function(v){switch(v.label){case 0:return o=z(n,"boxes","nonMaxSuppressionAsync"),u=z(e,"scores","nonMaxSuppressionAsync"),c=yv(o,u,t,r,i,a),t=c.maxOutputSize,r=c.iouThreshold,i=c.scoreThreshold,a=c.softNmsSigma,[4,Promise.all([o.data(),u.data()])];case 1:return h=v.sent(),d=h[0],p=h[1],g=Ex(d,p,t,r,i,a),o!==n&&o.dispose(),u!==e&&u.dispose(),[2,g]}}))}))},tH=X({cropAndResize_:function(n,e,t,r,i,a){var o=z(n,"image","cropAndResize"),u=z(e,"boxes","cropAndResize","float32"),c=z(t,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var h=u.shape[0];return H(o.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),H(u.rank===2&&u.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+u.shape+"."})),H(c.rank===1&&c.shape[0]===h,(function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+u.shape+"."})),H(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),H(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),H(i==="bilinear"||i==="nearest",(function(){return"method must be bilinear or nearest, but was "+i})),Z.runKernelFunc((function(d,p){return d.cropAndResize(o,u,c,r,i,a)}),{images:o,boxes:u,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),Fx=Object.freeze({resizeBilinear:YG,resizeNearestNeighbor:$G,nonMaxSuppression:QG,nonMaxSuppressionAsync:ZG,nonMaxSuppressionWithScore:JG,nonMaxSuppressionWithScoreAsync:eH,cropAndResize:tH}),Lx=function(n,e){return!(n>0)||e==="linear"},Bx=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},jx=function(n,e){var t=e,r=Hn(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},Ux=function(n,e,t){if(e==="linear")return n;if(e==="relu")return sn(n);if(e==="elu")return gM(n);if(e==="relu6")return yM(n);if(e==="prelu")return vM(n,t);throw new Error("Unknown fused activation "+e+".")},nH=X({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,a=i!==void 0&&i,o=n.transposeB,u=o!==void 0&&o,c=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights;if(Lx(Z.state.gradientDepth,d)===!1){var g=gv(t,r,a,u);return c!=null&&(g=ft(g,c)),Ux(g,d,p)}var v=z(t,"a","fused matMul"),b=z(r,"b","fused matMul");e=un(v,b),v=e[0],b=e[1];var w=a?v.shape[v.rank-2]:v.shape[v.rank-1],E=u?b.shape[b.rank-1]:b.shape[b.rank-2],T=a?v.shape[v.rank-1]:v.shape[v.rank-2],R=u?b.shape[b.rank-2]:b.shape[b.rank-1],I=v.shape.slice(0,-2),C=b.shape.slice(0,-2),k=je(I),L=je(C);H(v.rank>=2&&b.rank>=2&&v.rank===b.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+v.rank+" and "+b.rank+"."})),H(rr(I,C),(function(){return"Error in fused matMul: outer dimensions ("+I+") and ("+C+") of Tensors with shapes "+v.shape+" and "+b.shape+" must match."})),H(w===E,(function(){return"Error in fused matMul: inner shapes ("+w+") and ("+E+") of Tensors with shapes "+v.shape+" and "+b.shape+" and transposeA="+a+" and transposeB="+u+" must match."}));var O,N,D=v.shape.slice(0,-2).concat([T,R]),P=a?v.as3D(k,w,T):v.as3D(k,T,w),F=u?b.as3D(L,R,E):b.as3D(L,E,R);c!=null&&mt(D,(O=un(O=z(c,"bias","fused matMul"),v)[0]).shape),p!=null&&(N=z(p,"prelu weights","fused matMul"));var j={a:P,b:F};c!=null&&(j.bias=O),p!=null&&(j.preluActivationWeights=N);var B=[P,F];return Z.runKernelFunc((function(J,ne){var q=J.fusedBatchMatMul({a:P,b:F,transposeA:a,transposeB:u,bias:O,activation:d,preluActivationWeights:N});return ne([P,F,q]),q}),j,(function(J,ne){var q=ne[0],Y=ne[1],ee=ne[2],ue=Bx(J,ee,d),fe={};return c!=null&&(fe={bias:function(){return jx(O,ue)}}),Object.assign(a||u?!a&&u?{a:function(){return ue.matMul(Y,!1,!1)},b:function(){return ue.matMul(q,!0,!1)}}:a&&!u?{a:function(){return Y.matMul(ue,!1,!0)},b:function(){return q.matMul(ue,!1,!1)}}:{a:function(){return Y.matMul(ue,!0,!0)},b:function(){return ue.matMul(q,!0,!0)}}:{a:function(){return ue.matMul(Y,!1,!0)},b:function(){return q.matMul(ue,!0,!1)}},fe)}),"_FusedMatMul",{transposeA:a,transposeB:u,activation:d},B,[!0]).reshape(D)}}),rH=X({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,a=n.dataFormat,o=a===void 0?"NHWC":a,u=n.dilations,c=u===void 0?[1,1]:u,h=n.dimRoundingMode,d=n.bias,p=n.activation,g=p===void 0?"linear":p,v=n.preluActivationWeights;if(g=g||"linear",Lx(Z.state.gradientDepth,g)===!1){var b=Gi(e,t,r,i,o,c,h);return d!=null&&(b=ft(b,d)),Ux(b,g,v)}var w=z(e,"x","conv2d"),E=z(t,"filter","conv2d"),T=w,R=!1;w.rank===3&&(R=!0,T=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),H(T.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+T.rank+"."})),H(E.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+E.rank+"."})),h!=null&&H(bn(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+i+"."})),H(T.shape[3]===E.shape[2],(function(){return"Error in conv2d: depth of input ("+T.shape[3]+") must match input depth for filter "+E.shape[2]+"."})),H(ei(r,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),H(o==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var I,C,k=ul(T.shape,E.shape,r,c,i,h);d!=null&&(I=un(I=z(d,"bias","fused conv2d"),w)[0],mt(k.outShape,I.shape)),v!=null&&(C=z(v,"prelu weights","fused conv2d"));var L={x:T,filter:E};d!=null&&(L.bias=I),v!=null&&(L.preluActivationWeights=C);var O=[E,T],N=Z.runKernelFunc((function(D,P){var F=D.fusedConv2d({input:T,filter:E,convInfo:k,bias:I,activation:g,preluActivationWeights:C});return P([E,T,F]),F}),L,(function(D,P){var F=P,j=F[0],B=F[1],J=F[2],ne=Bx(D,J,g);H(Wc(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"}));var q={};return d!=null&&(q={bias:function(){return jx(I,ne)}}),Object.assign({x:function(){return uM(B.shape,ne,j,r,i)},filter:function(){return Dx(B,ne,j.shape,r,i)}},q)}),"FusedConv2D",{convInfo:k,activation:g},O,[!0]);return R?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),iH=X({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,a=n.dataFormat,o=a===void 0?"NHWC":a,u=n.dilations,c=u===void 0?[1,1]:u,h=n.dimRoundingMode,d=n.bias,p=n.activation,g=p===void 0?"linear":p,v=n.preluActivationWeights;if(Lx(Z.state.gradientDepth,g)===!1){var b=mv(e,t,r,i,o,c,h);return d!=null&&(b=ft(b,d)),Ux(b,g,v)}var w=z(e,"x","depthwiseConv2d"),E=z(t,"filter","depthwiseConv2d"),T=w,R=!1;w.rank===3&&(R=!0,T=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),H(T.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+T.rank+"."})),H(E.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+E.rank+"."})),H(T.shape[3]===E.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+T.shape[3]+") must match the inChannels dimension in filter "+E.shape[2]+"."})),c==null&&(c=[1,1]),H(ei(r,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),h!=null&&H(bn(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+i+"."}));var I,C,k=ul(T.shape,E.shape,r,c,i,h,!0);d!=null&&(I=un(I=z(d,"bias","fused conv2d"),w)[0],mt(k.outShape,I.shape)),v!=null&&(C=z(v,"prelu weights","fused depthwiseConv2d"));var L={x:T,filter:E};d!=null&&(L.bias=I),v!=null&&(L.preluActivationWeights=C);var O=[E,T],N=Z.runKernelFunc((function(D,P){var F=D.fusedDepthwiseConv2D({input:T,filter:E,convInfo:k,bias:I,activation:g,preluActivationWeights:C});return P([E,T,F]),F}),L,(function(D,P){H(Wc(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"}));var F=P[0],j=P[1],B=P[2],J=Bx(D,B,g),ne={};return d!=null&&(ne={bias:function(){return jx(I,J)}}),Object.assign({x:function(){return lM(j.shape,J,F,k)},filter:function(){return cM(j,J,F.shape,k)}},ne)}),"FusedDepthwiseConv2D",{convInfo:k,activation:g},O,[!0]);return R?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),aH=Object.freeze({matMul:nH,conv2d:rH,depthwiseConv2d:iH}),oH=Object.freeze({image:Fx,linalg:XG,losses:HG,spectral:IG,fused:aH,signal:OG,square:j9,squaredDifference:qk,conv1d:Y8,conv2d:Gi,conv3d:$8,depthwiseConv2d:mv,separableConv2d:kx,conv2dTranspose:Q8,conv3dTranspose:Z8,op:X,batchNormalization2d:g8,batchNormalization3d:v8,batchNormalization4d:y8,batchNormalization:_8,batchNorm:Zk,batchNorm2d:b8,batchNorm3d:x8,batchNorm4d:w8,booleanMaskAsync:X8,complex:fr,real:Pi,imag:Ua,concat:Un,concat1d:aU,concat2d:oU,concat3d:sU,concat4d:uU,split:yx,matMul:gv,dot:J8,outerProduct:eG,reverse:Od,reverse1d:tG,reverse2d:nG,reverse3d:rG,reverse4d:iG,maxPool:Zn,avgPool:Pd,pool:aG,maxPool3d:oG,avgPool3d:sG,slice:Ja,slice1d:uG,slice2d:lG,slice3d:dM,slice4d:cG,abs:U9,acos:z9,acosh:G9,asin:H9,asinh:W9,atan:q9,atanh:K9,ceil:X9,clipByValue:Rx,cos:Y9,cosh:$9,erf:Q9,exp:zb,expm1:Z9,floor:J9,log:e8,log1p:t8,logSigmoid:n8,neg:Ig,reciprocal:r8,round:i8,rsqrt:Kk,sigmoid:Xk,sign:a8,isNaN:o8,isInf:s8,isFinite:u8,sin:l8,sinh:c8,softplus:h8,sqrt:f8,step:d8,tan:p8,tanh:m8,all:hG,any:fG,argMax:dG,argMin:pG,logSumExp:mG,max:vv,mean:gG,min:vG,moments:yG,sum:mM,prod:_G,equal:rM,equalStrict:L8,greater:B8,greaterEqual:iM,greaterEqualStrict:j8,greaterStrict:U8,less:z8,lessEqual:G8,lessEqualStrict:H8,lessStrict:W8,notEqual:q8,notEqualStrict:K8,add:ft,addN:C8,addStrict:S8,atan2:A8,div:ra,divNoNan:R8,divStrict:I8,floorDiv:tM,maximum:Ix,maximumStrict:N8,minimum:nM,minimumStrict:D8,mod:k8,modStrict:M8,mul:Nr,mulStrict:O8,pow:Ng,powStrict:P8,squaredDifferenceStrict:V8,sub:Wn,subStrict:F8,elu:gM,leakyRelu:bG,prelu:vM,relu:sn,relu6:yM,selu:xG,logicalAnd:pv,logicalNot:E8,logicalOr:Jk,logicalXor:T8,where:Ju,whereAsync:eM,buffer:it,print:vU,batchToSpaceND:mk,broadcastTo:yU,cast:_U,clone:bU,cumsum:xU,depthToSpace:wU,expandDims:Oi,eye:gk,multinomial:EU,oneHot:Lb,pad:sl,pad1d:TU,pad2d:CU,pad3d:SU,pad4d:AU,rand:RU,randomNormal:IU,randomGamma:NU,randomUniform:vk,reshape:aa,spaceToBatchND:yk,squeeze:_k,stack:gi,tile:Rc,truncatedNormal:DU,unstack:zn,setdiff1dAsync:kU,fill:Xa,linspace:iU,ones:oh,range:xg,scalar:Re,tensor:pr,tensor1d:kn,tensor2d:Ns,tensor3d:vx,tensor4d:Kr,tensor5d:tU,tensor6d:nU,variable:rU,zeros:$t,onesLike:pk,zerosLike:St,transpose:Gs,softmax:Uo,logSoftmax:BU,localResponseNormalization:wG,norm:_M,gather:Nx,unsortedSegmentSum:aM,basicLSTMCell:EG,multiRNNCell:TG,movingAverage:CG,stridedSlice:SG,topk:AG,scatterND:RG,fft:Mx,ifft:Dg,rfft:Ox,irfft:bM,sparseToDense:NG,gatherND:DG,diag:kG,dropout:MG,hannWindow:Px,hammingWindow:wM,frame:Vx,stft:EM,inTopKAsync:PG});function Ee(n,e){Array.isArray(n)||(n=[n]),n.forEach((function(t){t!=null&&H(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function D_(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var sH=(function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Sk(t,Z),t}return fa(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,ge().get("IS_NODE")&&_g(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:t,dtype:i}),a},e.prototype.move=function(t,r,i,a){this.data.set(t,{values:r,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Fe(this,void 0,void 0,(function(){return Le(this,(function(r){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,a=r.complexTensors;return i==="complex64"?Ub(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map((function(a){return gg(a)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return it(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var a=this.write(t,r,i);return Z.makeTensorFromDataId(a,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Fe(this,void 0,void 0,(function(){var r;return Le(this,(function(i){return r=Ba(),t(),[2,{kernelMs:Ba()-r}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:Z.keep(t.clone()),imag:Z.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Ee(t,"slice"),Tk(t.shape,r,i)){var a=Ck(r,t.strides),o=je(i);return pr(this.readSync(t.dataId).subarray(a,a+o),i,t.dtype)}for(var u=it(i,t.dtype),c=this.bufferSync(t),h=0;h<u.size;++h){var d=u.indexToLoc(h).map((function(p,g){return p+r[g]}));u.values[h]=c.get.apply(c,d)}return u.toTensor()},e.prototype.stridedSlice=function(t,r,i,a){Ee(t,"stridedSlice");var o=bx(r,i,a);if(o.some((function(v){return v===0})))return pr([],o);for(var u=it(o,t.dtype),c=this.bufferSync(t),h=0;h<u.size;h++){for(var d=u.indexToLoc(h),p=new Array(d.length),g=0;g<p.length;g++)p[g]=d[g]*a[g]+r[g];u.set.apply(u,[c.get.apply(c,p)].concat(d))}return u.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=it([t.size,t.size],t.dtype),a=i.values,o=0;o<r.length;o++)a[o*t.size+o]=r[o];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],a=new Array(t.rank-1),o=0,u=0;u<t.rank;u++)u!==r&&(a[o++]=t.shape[u]);var c=new Array(t.rank).fill(0),h=t.shape.slice();h[r]=1;var d=new Array(i);for(u=0;u<d.length;u++)c[r]=u,d[u]=this.slice(t,c,h).reshape(a);return d},e.prototype.reverse=function(t,r){Ee(t,"reverse");for(var i=it(t.shape,t.dtype),a=this.bufferSync(t),o=function(c){var h=i.indexToLoc(c),d=h.slice();r.forEach((function(p){return d[p]=t.shape[p]-1-d[p]})),i.set.apply(i,[a.get.apply(a,d)].concat(h))},u=0;u<i.size;u++)o(u);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var a=t.map((function(v){return Pi(v)})),o=t.map((function(v){return Ua(v)}));return fr(this.concat(a,r),this.concat(o,r))}var u=t.map((function(v){var b=je(v.shape.slice(r));return v.as2D(-1,b)})),c=Hc(u.map((function(v){return v.shape})),1),h=it(c,t[0].dtype).values;if(u[0].shape[0]===1){var d=0;u.forEach((function(v){h.set(i.readSync(v.dataId),d),d+=v.size}))}else{var p=0;u.forEach((function(v){for(var b=i.readSync(v.dataId),w=0,E=0;E<v.shape[0];++E)for(var T=E*c[1]+p,R=0;R<v.shape[1];++R)h[T+R]=b[w++];p+=v.shape[1]}))}var g=Hc(t.map((function(v){return v.shape})),r);return pr(h,g,t[0].dtype)},e.prototype.neg=function(t){return Ee(t,"neg"),this.multiply(Re(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,a,o,u){return{real:i+o,imag:a+u}})):this.broadcastedBinaryOp(t,r,dr(t.dtype,r.dtype),(function(i,a){return i+a}))},e.prototype.addN=function(t){var r=this;Ee(t,"addN");for(var i=t.map((function(d){return r.readSync(d.dataId)})),a=it(t[0].shape,t[0].dtype),o=a.values,u=0;u<t.length;u++)for(var c=i[u],h=0;h<o.length;h++)o[h]+=c[h];return a.toTensor()},e.prototype.softmax=function(t,r){var i=qn([r],t.shape),a=this.max(t,i),o=Jr(a.shape,i),u=this.subtract(t,a.reshape(o)),c=this.exp(u),h=this.sum(c,i).reshape(o);return this.realDivide(c,h)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,a,o,u){return{real:i-o,imag:a-u}})):this.broadcastedBinaryOp(t,r,dr(t.dtype,r.dtype),(function(i,a){return i-a}))},e.prototype.pow=function(t,r){return Ee([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.pow(i,a)}))},e.prototype.batchMatMul=function(t,r,i,a){Ee([t,r],"matMul");for(var o=i?t.shape[1]:t.shape[2],u=i?t.shape[2]:t.shape[1],c=a?r.shape[1]:r.shape[2],h=t.shape[0],d=this.readSync(t.dataId),p=this.readSync(r.dataId),g=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],v=g[0],b=g[1],w=g[2],E=a?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],T=E[0],R=E[1],I=E[2],C=u*c,k=it([h,u,c],t.dtype),L=k.values,O=this.blockSize,N=0;N<h;N++)for(var D=0;D<u;D+=O)for(var P=0;P<c;P+=O)for(var F=0;F<o;F+=O)for(var j=Math.min(D+O,u),B=Math.min(P+O,c),J=Math.min(F+O,o),ne=D;ne<j;ne++)for(var q=P;q<B;q++){for(var Y=0,ee=F;ee<J;ee++)Y+=d[N*v+ne*b+ee*w]*p[ee*T+q*R+N*I];L[N*C+(ne*c+q)]+=Y}return k.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,a=t.transposeA,o=t.transposeB,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=this.batchMatMul(r,i,a,o);return u&&(d=this.add(d,u)),c&&(d=D_(this,d,c,h)),d},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,a,o,u){return{real:i*o-a*u,imag:i*u+a*o}})):this.broadcastedBinaryOp(t,r,dr(t.dtype,r.dtype),(function(i,a){return i*a}))},e.prototype.realDivide=function(t,r){return Ee([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(i,a){return i/a}))},e.prototype.floorDiv=function(t,r){return Ee([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(i,a){return Math.floor(i/a)}))},e.prototype.sum=function(t,r){Ee(t,"sum"),ci("sum",r,t.rank);for(var i=xr(t.shape,r),a=i[0],o=i[1],u=$t(a,dr(t.dtype,"int32")),c=je(o),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=0,b=0;b<c;++b)v+=d[g+b];h[p]=v}return u},e.prototype.prod=function(t,r){Ee(t,"sum");for(var i=xr(t.shape,r),a=i[0],o=i[1],u=$t(a,dr(t.dtype,"int32")),c=je(o),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=1,b=0;b<c;++b)v*=d[g+b];h[p]=v}return u},e.prototype.unsortedSegmentSum=function(t,r,i){Ee(t,"unsortedSegmentSum");for(var a=[],o=t.rank-r.rank,u=0;u<o;++u)r=r.expandDims(u+1);for(u=0;u<i;++u){var c=Re(u,"int32"),h=rM(c,r).asType("float32").mul(t).sum(0);a.push(h)}return gi(a)},e.prototype.argMin=function(t,r){Ee(t,"argMin");var i=[r];ci("argMin",i,t.rank);for(var a=xr(t.shape,i),o=a[0],u=a[1],c=$t(o,"int32"),h=je(u),d=this.readSync(c.dataId),p=this.readSync(t.dataId),g=0;g<d.length;++g){for(var v=g*h,b=p[v],w=0,E=0;E<h;++E){var T=p[v+E];T<b&&(b=T,w=E)}d[g]=w}return c},e.prototype.argMax=function(t,r){Ee(t,"argMax");var i=[r];ci("argMax",i,t.rank);for(var a=xr(t.shape,i),o=a[0],u=a[1],c=$t(o,"int32"),h=je(u),d=this.readSync(c.dataId),p=this.readSync(t.dataId),g=0;g<d.length;++g){for(var v=g*h,b=p[v],w=0,E=0;E<h;++E){var T=p[v+E];T>b&&(b=T,w=E)}d[g]=w}return c},e.prototype.cumsum=function(t,r,i,a){if(Ee(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var o=dr(t.dtype,"int32"),u=$t(t.shape,o),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=t.shape[t.rank-1],p=a?function(E,T){return E+d-T-1}:function(E,T){return E+T},g=0;g<h.length;g+=d)for(var v=0;v<d;v++){var b=p(g,v);if(v===0)c[b]=i?0:h[b];else{var w=p(g,v-1);c[b]=i?h[w]+c[w]:h[b]+c[w]}}return u},e.prototype.equal=function(t,r){return Ee([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i===a?1:0}))},e.prototype.notEqual=function(t,r){return Ee([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i!==a?1:0}))},e.prototype.less=function(t,r){return Ee([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i<a?1:0}))},e.prototype.lessEqual=function(t,r){return Ee([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i<=a?1:0}))},e.prototype.greater=function(t,r){return Ee([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i>a?1:0}))},e.prototype.greaterEqual=function(t,r){return Ee([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i>=a?1:0}))},e.prototype.logicalNot=function(t){Ee(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)i[a]=r[a]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Ee([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i&&a}))},e.prototype.logicalOr=function(t,r){return Ee([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i||a}))},e.prototype.select=function(t,r,i){Ee([t,r,i],"select");for(var a=this.readSync(t.dataId),o=this.readSync(r.dataId),u=this.readSync(i.dataId),c=$t(r.shape,dr(r.dtype,i.dtype)),h=this.readSync(c.dataId),d=0,p=t.rank===0||t.rank>1||r.rank===1?1:je(r.shape.slice(1)),g=0;g<a.length;g++)for(var v=0;v<p;v++)a[g]===1?h[d++]=o[g]:h[d++]=u[g];return c},e.prototype.where=function(t){Ee([t],"where");var r=this.readSync(t.dataId);return Tx(t.shape,r)},e.prototype.topk=function(t,r,i){return Ee(t,"topk"),Ok(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ee(t,"min"),ci("min",r,t.rank);for(var i=xr(t.shape,r),a=i[0],o=i[1],u=$t(a,t.dtype),c=je(o),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var w=d[g+b];w<v&&(v=w)}h[p]=v}return u},e.prototype.minimum=function(t,r){return Ee([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.min(i,a)}))},e.prototype.mod=function(t,r){return Ee([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){var o=i%a;return i<0&&a<0||i>=0&&a>=0?o:(o+a)%a}))},e.prototype.max=function(t,r){Ee(t,"max"),ci("max",r,t.rank);for(var i=xr(t.shape,r),a=i[0],o=i[1],u=$t(a,t.dtype),c=je(o),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var w=d[g+b];w>v&&(v=w)}h[p]=v}return u},e.prototype.maximum=function(t,r){return Ee([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.max(i,a)}))},e.prototype.all=function(t,r){Ee(t,"all"),ci("all",r,t.rank);for(var i=xr(t.shape,r),a=i[0],o=i[1],u=$t(a,t.dtype),c=je(o),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var w=d[g+b];v=v&&w}h[p]=v}return u},e.prototype.any=function(t,r){Ee(t,"any"),ci("any",r,t.rank);for(var i=xr(t.shape,r),a=i[0],o=i[1],u=$t(a,t.dtype),c=je(o),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var w=d[g+b];v=v||w}h[p]=v}return u},e.prototype.squaredDifference=function(t,r){return Ee([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){var o=i-a;return o*o}))},e.prototype.ceil=function(t){Ee(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.ceil(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Ee(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.floor(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)r[a]<0?i[a]=-1:r[a]>0?i[a]=1:i[a]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isNaN(r[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)Math.abs(r[a])===1/0&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isFinite(r[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Ee(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var o=Math.floor(r[a]);r[a]-o<.5?i[a]=Math.floor(r[a]):r[a]-o>.5?i[a]=Math.ceil(r[a]):i[a]=o%2==0?o:o+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Ee(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.exp(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Ee(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.expm1(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Ee(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];i[a]=Math.log(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Ee(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];i[a]=Math.log1p(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Ee(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];i[a]=Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Ee(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var o=r[a];i[a]=1/Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Ee(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=1/r[a];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Ee(t,"relu");for(var r=$t(t.shape,t.dtype),i=this.readSync(r.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)i[o]=Math.max(0,a[o]);return r},e.prototype.relu6=function(t){Ee(t,"relu");for(var r=$t(t.shape,t.dtype),i=this.readSync(r.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)i[o]=Math.min(Math.max(0,a[o]),6);return r},e.prototype.prelu=function(t,r){return Ee([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return i<0?a*i:i}))},e.prototype.elu=function(t){Ee(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>=0?o:Math.exp(o)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Ee([t,r],"eluDer");for(var i=new Float32Array(r.size),a=this.readSync(r.dataId),o=this.readSync(t.dataId),u=0;u<a.length;++u){var c=a[u];i[u]=c>=1?o[u]:o[u]*(c+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Ee(t,"selu");for(var r=Sx,i=Ax,a=new Float32Array(t.size),o=this.readSync(t.dataId),u=0;u<o.length;++u){var c=o[u];a[u]=c>=0?i*c:r*(Math.exp(c)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,r,i){Ee(t,"clip");for(var a=new Float32Array(t.size),o=this.readSync(t.dataId),u=0;u<o.length;++u){var c=o[u];a[u]=c>i?i:c<r?r:c}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.abs(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<t.size;++a){var o=i[2*a],u=i[2*a+1];r[a]=Math.hypot(o,u)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Ee(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=i[a];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Ee(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=1/(1+Math.exp(-i[a]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Ee(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var u=a[o]>-r,c=a[o]<r,h=Math.exp(a[o]),d=void 0;d=c?h:u?a[o]:Math.log(1+h),i[o]=d}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Ee(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.sin(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Ee(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.cos(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Ee(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.tan(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Ee(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.asin(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Ee(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.acos(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Ee(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.atan(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Ee([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.atan2(i,a)}))},e.prototype.sinh=function(t){Ee(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.sinh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Ee(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.cosh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Ee(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=u5(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Ee(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.asinh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Ee(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.acosh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Ee(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.atanh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Ee(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var o=Math.sign(i[a]),u=Math.abs(i[a]),c=1/(1+.3275911*u);r[a]=o*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-u*u))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Ee(t,"step");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var u=a[o];isNaN(u)?i[o]=NaN:i[o]=u>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,a=t.convInfo,o=t.bias,u=t.activation,c=t.preluActivationWeights,h=this.conv2d(r,i,a);return o&&(h=this.add(h,o)),u&&(h=D_(this,h,u,c)),h},e.prototype.conv2d=function(t,r,i){Ee([t,r],"conv2d");for(var a=i.filterHeight,o=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.left,d=i.padInfo.top,p=i.dataFormat==="channelsLast",g=it(i.outShape,t.dtype),v=t.strides[0],b=p?t.strides[1]:t.strides[2],w=p?t.strides[2]:1,E=p?1:t.strides[1],T=g.strides[0],R=p?g.strides[1]:g.strides[2],I=p?g.strides[2]:1,C=p?1:g.strides[1],k=this.readSync(t.dataId),L=this.readSync(r.dataId),O=g.values,N=0;N<i.batchSize;++N)for(var D=N*v,P=N*T,F=0;F<i.outHeight;++F)for(var j=P+F*R,B=F*i.strideHeight-d,J=0;J<a;J++){var ne=B+J*u;if(!(ne<0||ne>=i.inHeight))for(var q=J*r.strides[0],Y=D+ne*b,ee=0;ee<i.outWidth;++ee)for(var ue=j+ee*I,fe=ee*i.strideWidth-h,W=0;W<o;W++){var Q=fe+W*c;if(!(Q<0||Q>=i.inWidth))for(var ce=Y+Q*w,ve=q+W*r.strides[1],Te=0;Te<i.inChannels;++Te){for(var Ae=k[ce+Te*E],xe=0;xe<i.outChannels;++xe)O[ue+xe*C]+=Ae*L[ve+xe];ve+=i.outChannels}}}return g.toTensor()},e.prototype.conv3d=function(t,r,i){for(var a=i.filterDepth,o=i.filterHeight,u=i.filterWidth,c=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,p=i.padInfo.front,g=i.padInfo.left,v=i.padInfo.top,b=it(i.outShape,t.dtype),w=this.readSync(t.dataId),E=this.readSync(r.dataId),T=b.values,R=0;R<i.batchSize;++R)for(var I=R*t.strides[0],C=R*b.strides[0],k=0;k<i.outDepth;++k)for(var L=C+k*b.strides[1],O=k*i.strideDepth-p,N=0;N<a;N++){var D=O+N*c;if(!(D<0||D>=i.inDepth))for(var P=N*r.strides[0],F=I+D*t.strides[1],j=0;j<i.outHeight;++j)for(var B=L+j*b.strides[2],J=j*i.strideHeight-v,ne=0;ne<o;ne++){var q=J+ne*h;if(!(q<0||q>=i.inHeight))for(var Y=P+ne*r.strides[1],ee=F+q*t.strides[2],ue=0;ue<i.outWidth;++ue)for(var fe=B+ue*i.outChannels,W=ue*i.strideWidth-g,Q=0;Q<u;Q++){var ce=W+Q*d;if(!(ce<0||ce>=i.inWidth))for(var ve=Y+Q*r.strides[2],Te=ee+ce*i.inChannels,Ae=ve,xe=0;xe<i.inChannels;++xe){for(var ke=w[Te+xe],Ie=0;Ie<i.outChannels;++Ie)T[fe+Ie]+=ke*E[Ae+Ie];Ae+=i.outChannels}}}}return b.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Ee([t,r],"conv2dDerInput");for(var a=it(i.inShape,"float32"),o=a.values,u=this.readSync(t.dataId),c=this.readSync(r.dataId),h=r.strides,d=h[0],p=h[1],g=h[2],v=i.batchSize,b=i.filterHeight,w=i.filterWidth,E=i.inChannels,T=i.inHeight,R=i.inWidth,I=i.outChannels,C=i.outHeight,k=i.outWidth,L=i.strideHeight,O=i.strideWidth,N=i.dataFormat,D=b-1-i.padInfo.top,P=w-1-i.padInfo.left,F=N==="channelsLast",j=a.strides[0],B=F?a.strides[1]:a.strides[2],J=F?a.strides[2]:1,ne=F?1:a.strides[1],q=t.strides[0],Y=F?t.strides[1]:t.strides[2],ee=F?t.strides[2]:1,ue=F?1:t.strides[1],fe=0;fe<v;++fe)for(var W=0;W<E;++W)for(var Q=0;Q<T;++Q)for(var ce=Q-D,ve=Math.max(0,Math.ceil(ce/L)),Te=Math.min(C,(b+ce)/L),Ae=0;Ae<R;++Ae){for(var xe=Ae-P,ke=Math.max(0,Math.ceil(xe/O)),Ie=Math.min(k,(w+xe)/O),qe=0,Je=ve;Je<Te;++Je)for(var Ze=Je*L-ce,Xe=ke;Xe<Ie;++Xe)for(var ot=q*fe+Y*Je+ee*Xe,$e=d*(b-1-Ze)+p*(w-1-(Xe*O-xe))+g*W,lt=0;lt<I;++lt)qe+=u[ot+ue*lt]*c[$e+lt];o[j*fe+B*Q+J*Ae+ne*W]=qe}return a.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var a=it(i.inShape,"float32"),o=a.values,u=a.strides,c=u[0],h=u[1],d=u[2],p=u[3],g=this.readSync(t.dataId),v=t.strides,b=v[0],w=v[1],E=v[2],T=v[3],R=this.readSync(r.dataId),I=r.strides,C=I[0],k=I[1],L=I[2],O=I[3],N=i.batchSize,D=i.filterDepth,P=i.filterHeight,F=i.filterWidth,j=i.inChannels,B=i.inDepth,J=i.inHeight,ne=i.inWidth,q=i.outChannels,Y=i.outDepth,ee=i.outHeight,ue=i.outWidth,fe=i.strideDepth,W=i.strideHeight,Q=i.strideWidth,ce=D-1-i.padInfo.front,ve=P-1-i.padInfo.top,Te=F-1-i.padInfo.left,Ae=0;Ae<N;++Ae)for(var xe=0;xe<j;++xe)for(var ke=0;ke<B;++ke)for(var Ie=ke-ce,qe=Math.max(0,Math.ceil(Ie/fe)),Je=Math.min(Y,(D+Ie)/fe),Ze=0;Ze<J;++Ze)for(var Xe=Ze-ve,ot=Math.max(0,Math.ceil(Xe/W)),$e=Math.min(ee,(P+Xe)/W),lt=0;lt<ne;++lt){for(var Kn=lt-Te,xn=Math.max(0,Math.ceil(Kn/Q)),et=Math.min(ue,(F+Kn)/Q),Vt=0,Xn=qe;Xn<Je;++Xn)for(var _i=Xn*fe-Ie,Lr=ot;Lr<$e;++Lr)for(var ln=Lr*W-Xe,ar=xn;ar<et;++ar)for(var ao=b*Ae+w*Xn+E*Lr+T*ar,bi=C*(D-1-_i)+k*(P-1-ln)+L*(F-1-(ar*Q-Kn))+O*xe,Fn=0;Fn<q;++Fn)Vt+=g[ao+Fn]*R[bi+Fn];o[c*Ae+h*ke+d*Ze+p*lt+xe]=Vt}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Ee([t,r],"conv2dDerFilter");for(var a=i.strideHeight,o=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=i.dataFormat==="channelsLast",d=it(i.filterShape,"float32"),p=i.padInfo.left,g=i.padInfo.top,v=this.bufferSync(t),b=this.bufferSync(r),w=0;w<u;++w)for(var E=Math.max(0,Math.ceil((g-w)/a)),T=Math.min(i.outHeight,(i.inHeight+g-w)/a),R=0;R<c;++R)for(var I=Math.max(0,Math.ceil((p-R)/o)),C=Math.min(i.outWidth,(i.inWidth+p-R)/o),k=0;k<i.inChannels;++k)for(var L=0;L<i.outChannels;++L){for(var O=0,N=0;N<i.batchSize;++N)for(var D=E;D<T;++D)for(var P=w+D*a-g,F=I;F<C;++F){var j=R+F*o-p;O+=h?v.get(N,P,j,k)*b.get(N,D,F,L):v.get(N,k,P,j)*b.get(N,L,D,F)}d.set(O,w,R,k,L)}return d.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var a=i.strideDepth,o=i.strideHeight,u=i.strideWidth,c=i.filterDepth,h=i.filterHeight,d=i.filterWidth,p=it(i.filterShape,"float32"),g=p.values,v=p.strides,b=v[0],w=v[1],E=v[2],T=v[3],R=this.readSync(r.dataId),I=r.strides,C=I[0],k=I[1],L=I[2],O=I[3],N=this.readSync(t.dataId),D=t.strides,P=D[0],F=D[1],j=D[2],B=D[3],J=i.padInfo.front,ne=i.padInfo.left,q=i.padInfo.top,Y=0;Y<c;++Y)for(var ee=Math.max(0,Math.ceil((J-Y)/a)),ue=Math.min(i.outDepth,(i.inDepth+J-Y)/a),fe=Y*b,W=0;W<h;++W)for(var Q=Math.max(0,Math.ceil((q-W)/o)),ce=Math.min(i.outHeight,(i.inHeight+q-W)/o),ve=W*w+fe,Te=0;Te<d;++Te)for(var Ae=Math.max(0,Math.ceil((ne-Te)/u)),xe=Math.min(i.outWidth,(i.inWidth+ne-Te)/u),ke=Te*E+ve,Ie=0;Ie<i.inChannels;++Ie)for(var qe=Ie*T+ke,Je=0;Je<i.outChannels;++Je){for(var Ze=0,Xe=0;Xe<i.batchSize;++Xe)for(var ot=Xe*P,$e=Xe*C,lt=ee;lt<ue;++lt)for(var Kn=(Y+lt*a-J)*F+ot,xn=lt*k+$e,et=Q;et<ce;++et)for(var Vt=(W+et*o-q)*j+Kn,Xn=et*L+xn,_i=Ae;_i<xe;++_i){var Lr=_i*O+Xn;Ze+=N[(Te+_i*u-ne)*B+Vt+Ie]*R[Lr+Je]}g[qe+Je]=Ze}return p.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,a=t.convInfo,o=t.bias,u=t.activation,c=t.preluActivationWeights,h=this.depthwiseConv2D(r,i,a);return o&&(h=this.add(h,o)),u&&(h=D_(this,h,u,c)),h},e.prototype.depthwiseConv2D=function(t,r,i){Ee([t,r],"depthwiseConv2D");for(var a=i.filterHeight,o=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.left,d=i.padInfo.top,p=i.outChannels/i.inChannels,g=it(i.outShape,t.dtype),v=this.readSync(t.dataId),b=this.readSync(r.dataId),w=g.values,E=0;E<i.batchSize;++E)for(var T=E*t.strides[0],R=E*g.strides[0],I=0;I<i.outHeight;++I)for(var C=R+I*g.strides[1],k=I*i.strideHeight-h,L=0;L<a;++L){var O=k+L*u;if(!(O<0||O>=i.inHeight))for(var N=L*r.strides[0],D=T+O*t.strides[1],P=0;P<i.outWidth;++P)for(var F=C+P*g.strides[2],j=P*i.strideWidth-d,B=0;B<o;++B){var J=j+B*c;if(!(J<0||J>=i.inWidth))for(var ne=N+B*r.strides[1],q=D+J*i.inChannels,Y=F,ee=ne,ue=0;ue<i.inChannels;++ue){for(var fe=v[q+ue],W=0;W<p;++W)w[Y+W]+=fe*b[ee+W];Y+=p,ee+=p}}}return g.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Ee([t,r],"depthwiseConv2DDerInput");for(var a=it(i.inShape,"float32"),o=a.values,u=a.strides,c=u[0],h=u[1],d=u[2],p=this.readSync(t.dataId),g=t.strides,v=g[0],b=g[1],w=g[2],E=this.readSync(r.dataId),T=r.strides,R=T[0],I=T[1],C=T[2],k=i.batchSize,L=i.filterHeight,O=i.filterWidth,N=i.inChannels,D=i.inHeight,P=i.inWidth,F=i.outChannels,j=i.outHeight,B=i.outWidth,J=i.strideHeight,ne=i.strideWidth,q=L-1-i.padInfo.top,Y=O-1-i.padInfo.left,ee=F/N,ue=0;ue<k;++ue)for(var fe=0;fe<N;++fe)for(var W=0;W<D;++W)for(var Q=W-q,ce=Math.max(0,Math.ceil(Q/J)),ve=Math.min(j,(L+Q)/J),Te=0;Te<P;++Te){for(var Ae=Te-Y,xe=Math.max(0,Math.ceil(Ae/ne)),ke=Math.min(B,(O+Ae)/ne),Ie=0,qe=ce;qe<ve;++qe)for(var Je=qe*J-Q,Ze=xe;Ze<ke;++Ze)for(var Xe=v*ue+b*qe+w*Ze,ot=R*(L-1-Je)+I*(O-1-(Ze*ne-Ae))+C*fe,$e=0;$e<ee;++$e)Ie+=p[Xe+(fe*ee+$e)]*E[ot+$e];o[c*ue+h*W+d*Te+fe]=Ie}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Ee([t,r],"depthwiseConv2DDerFilter");for(var a=i.strideHeight,o=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=it(i.filterShape,"float32"),d=i.padInfo.left,p=i.padInfo.top,g=i.outChannels/i.inChannels,v=this.bufferSync(t),b=this.bufferSync(r),w=0;w<u;++w)for(var E=Math.max(0,Math.ceil((p-w)/a)),T=Math.min(i.outHeight,(i.inHeight+p-w)/a),R=0;R<c;++R)for(var I=Math.max(0,Math.ceil((d-R)/o)),C=Math.min(i.outWidth,(i.inWidth+d-R)/o),k=0;k<i.outChannels;++k){for(var L=Math.trunc(k/g),O=k%g,N=0,D=0;D<i.batchSize;++D)for(var P=E;P<T;++P)for(var F=w+P*a-p,j=I;j<C;++j){var B=R+j*o-d;N+=v.get(D,F,B,L)*b.get(D,P,j,k)}h.set(N,w,R,L,O)}return h.toTensor()},e.prototype.tile=function(t,r){return Ee(t,"tile"),Mk(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Ee(t,"pad");var a=r.map((function(g,v){return g[0]+t.shape[v]+g[1]})),o=r.map((function(g){return g[0]})),u=this.bufferSync(t),c=it(a,t.dtype);i!==0&&c.values.fill(i);for(var h=0;h<t.size;h++){var d=u.indexToLoc(h),p=d.map((function(g,v){return g+o[v]}));c.set.apply(c,[u.get.apply(u,d)].concat(p))}return c.toTensor()},e.prototype.transpose=function(t,r){Ee(t,"transpose");for(var i=new Array(t.rank),a=0;a<i.length;a++)i[a]=t.shape[r[a]];var o=this.readSync(t.dataId),u=it(i,t.dtype),c=this.bufferSync(t);for(a=0;a<t.size;++a){for(var h=c.indexToLoc(a),d=new Array(h.length),p=0;p<d.length;p++)d[p]=h[r[p]];var g=u.locToIndex(d);u.values[g]=o[a]}return u.toTensor()},e.prototype.gather=function(t,r,i){Ee([t,r],"gather");var a=t.shape.slice(),o=this.readSync(r.dataId);a[i]=o.length;for(var u=it(a,t.dtype),c=this.bufferSync(t),h=0;h<u.size;++h){var d=u.indexToLoc(h),p=d.slice();p[i]=o[d[i]];var g=c.locToIndex(p);u.values[h]=c.values[g]}return u.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Ee([t],"batchToSpaceND");var a=r.reduce((function(p,g){return p*g})),o=wg(t.shape,r,a),u=Eg(o.length,r.length),c=Tg(t.shape,r,a),h=bk(i,r.length),d=xk(c,i,r.length);return t.reshape(o).transpose(u).reshape(c).slice(h,d)},e.prototype.spaceToBatchND=function(t,r,i){Ee([t],"spaceToBatchND");var a=r.reduce((function(g,v){return g*v})),o=[[0,0]];o.push.apply(o,i);for(var u=1+r.length;u<t.shape.length;++u)o.push([0,0]);var c=t.pad(o),h=wg(c.shape,r,a,!1),d=Eg(h.length,r.length,!1),p=Tg(c.shape,r,a,!1);return c.reshape(h).transpose(d).reshape(p)},e.prototype.pool=function(t,r,i){Ee(t,"pool");for(var a=r.strideHeight,o=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(t.dataId),w=it(r.outShape,t.dtype),E=w.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3],R=r.outShape[2]*r.outShape[3],I=r.outShape[3],C=0;C<r.batchSize;++C)for(var k=C*T,L=C*t.strides[0],O=0;O<r.inChannels;++O)for(var N=0;N<r.outHeight;++N)for(var D=N*a-p,P=Math.max(0,D),F=Math.min(r.inHeight,h+D),j=k+N*R,B=0;B<r.outWidth;++B){for(var J=B*o-g,ne=Math.max(0,J),q=Math.min(r.inWidth,d+J),Y=v,ee=0,ue=0,fe=P;fe<F;fe+=u){for(var W=L+fe*t.strides[1],Q=ne;Q<q;Q+=c){var ce=b[W+Q*t.strides[2]+O];i==="max"&&ce>Y?Y=ce:i==="avg"&&(ee+=ce,ue++)}if(isNaN(Y))break}E[j+B*I+O]=i==="avg"?ee/ue:Y}return w.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=it(r.outShape,"int32"),a=r.strideHeight,o=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,v=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var E=0;E<r.outHeight;++E){for(var T=E*a-p,R=T;R<0;)R+=u;for(var I=Math.min(r.inHeight,h+T),C=0;C<r.outWidth;++C){for(var k=C*o-g,L=k;L<0;)L+=c;for(var O=Math.min(r.inWidth,d+k),N=Number.NEGATIVE_INFINITY,D=-1,P=R;P<I;P+=u)for(var F=P-T,j=L;j<O;j+=c){var B=j-k,J=v.get(b,P,j,w);J>N&&(N=J,D=F*d+B)}i.set(D,b,E,C,w)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,a){Ee([r,i],"maxPoolBackprop");for(var o=this.maxPoolPositions(r,a),u=a.strideHeight,c=a.strideWidth,h=a.dilationHeight,d=a.dilationWidth,p=a.effectiveFilterHeight,g=a.effectiveFilterWidth,v=g-1-a.padInfo.left,b=p-1-a.padInfo.top,w=it(r.shape,"float32"),E=this.bufferSync(o),T=this.bufferSync(t),R=0;R<a.batchSize;++R)for(var I=0;I<a.inChannels;++I)for(var C=0;C<a.inHeight;++C)for(var k=0;k<a.inWidth;++k){for(var L=C-b,O=k-v,N=0,D=0;D<p;D+=h){var P=(L+D)/u;if(!(P<0||P>=a.outHeight||Math.floor(P)!==P))for(var F=0;F<g;F+=d){var j=(O+F)/c;if(!(j<0||j>=a.outWidth||Math.floor(j)!==j)){var B=p*g-1-E.get(R,P,j,I)===D*g+F?1:0;B!==0&&(N+=T.get(R,P,j,I)*B)}}}w.set(N,R,C,k,I)}return w.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Ee([t,r],"avgPoolBackprop");for(var a=i.strideHeight,o=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=i.dilationHeight,d=i.dilationWidth,p=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=g-1-i.padInfo.left,b=p-1-i.padInfo.top,w=it(r.shape,"float32"),E=1/(u*c),T=this.bufferSync(t),R=0;R<i.batchSize;++R)for(var I=0;I<i.inChannels;++I)for(var C=0;C<i.inHeight;++C)for(var k=0;k<i.inWidth;++k){for(var L=C-b,O=k-v,N=0,D=0;D<p;D+=h){var P=(L+D)/a;if(!(P<0||P>=i.outHeight||Math.floor(P)!==P))for(var F=0;F<g;F+=d){var j=(O+F)/o;j<0||j>=i.outWidth||Math.floor(j)!==j||(N+=T.get(R,P,j,I))}}w.set(N*E,R,C,k,I)}return w.toTensor()},e.prototype.pool3d=function(t,r,i){Ee(t,"pool3d");for(var a=r.strideDepth,o=r.strideHeight,u=r.strideWidth,c=r.dilationDepth,h=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,v=r.effectiveFilterWidth,b=r.padInfo.front,w=r.padInfo.top,E=r.padInfo.left,T=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,R=this.readSync(t.dataId),I=it(r.outShape,t.dtype),C=I.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],L=r.outShape[2]*r.outShape[3]*r.outShape[4],O=r.outShape[3]*r.outShape[4],N=r.outShape[4],D=0;D<r.batchSize;++D)for(var P=D*k,F=D*t.strides[0],j=0;j<r.inChannels;++j)for(var B=0;B<r.outDepth;++B){for(var J=B*a-b,ne=J;ne<0;)ne+=c;for(var q=Math.min(r.inDepth,p+J),Y=P+B*L,ee=0;ee<r.outHeight;++ee){for(var ue=ee*o-w,fe=ue;fe<0;)fe+=h;for(var W=Math.min(r.inHeight,g+ue),Q=Y+ee*O,ce=0;ce<r.outWidth;++ce){for(var ve=ce*u-E,Te=ve;Te<0;)Te+=d;for(var Ae=Math.min(r.inWidth,v+ve),xe=Q+ce*N,ke=T,Ie=0,qe=0,Je=ne;Je<q;Je+=c){for(var Ze=F+Je*t.strides[1],Xe=fe;Xe<W;Xe+=h){for(var ot=Ze+Xe*t.strides[2],$e=Te;$e<Ae;$e+=d){var lt=R[ot+$e*t.strides[3]+j];if(i==="max"&&lt>ke?ke=lt:i==="avg"&&(Ie+=lt,qe++),isNaN(ke))break}if(isNaN(ke))break}if(isNaN(ke))break}C[xe+j]=i==="avg"?Ie/qe:ke}}}return I.toTensor()},e.prototype.avgPool3d=function(t,r){return Ee(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Ee([t,r],"avgPool3dBackprop");for(var a=i.strideDepth,o=i.strideHeight,u=i.strideWidth,c=i.filterDepth,h=i.filterHeight,d=i.filterWidth,p=i.dilationDepth,g=i.dilationHeight,v=i.dilationWidth,b=i.effectiveFilterDepth,w=i.effectiveFilterHeight,E=i.effectiveFilterWidth,T=b-1-i.padInfo.front,R=E-1-i.padInfo.left,I=w-1-i.padInfo.top,C=it(r.shape,"float32"),k=1/(c*h*d),L=this.bufferSync(t),O=0;O<i.batchSize;++O)for(var N=0;N<i.inChannels;++N)for(var D=0;D<i.inDepth;++D)for(var P=0;P<i.inHeight;++P)for(var F=0;F<i.inWidth;++F){for(var j=D-T,B=P-I,J=F-R,ne=0,q=0;q<b;q+=p){var Y=(j+q)/a;if(!(Y<0||Y>=i.outDepth||Math.floor(Y)!==Y))for(var ee=0;ee<w;ee+=g){var ue=(B+ee)/o;if(!(ue<0||ue>=i.outHeight||Math.floor(ue)!==ue))for(var fe=0;fe<E;fe+=v){var W=(J+fe)/u;W<0||W>=i.outWidth||Math.floor(W)!==W||(ne+=L.get(O,Y,ue,W,N))}}}C.set(ne*k,O,D,P,F,N)}return C.toTensor()},e.prototype.maxPool3d=function(t,r){return Ee(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=it(r.outShape,"int32"),a=r.strideDepth,o=r.strideHeight,u=r.strideWidth,c=r.dilationDepth,h=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,v=r.effectiveFilterWidth,b=r.padInfo.front,w=r.padInfo.top,E=r.padInfo.left,T=this.bufferSync(t),R=0;R<r.batchSize;++R)for(var I=0;I<r.inChannels;++I)for(var C=0;C<r.outDepth;++C){for(var k=C*a-b,L=k;L<0;)L+=c;for(var O=Math.min(r.inDepth,p+k),N=0;N<r.outHeight;++N){for(var D=N*o-w,P=D;P<0;)P+=h;for(var F=Math.min(r.inHeight,g+D),j=0;j<r.outWidth;++j){for(var B=j*u-E,J=B;J<0;)J+=d;for(var ne=Math.min(r.inWidth,v+B),q=Number.NEGATIVE_INFINITY,Y=-1,ee=L;ee<O;ee+=c)for(var ue=ee-k,fe=P;fe<F;fe+=h)for(var W=fe-D,Q=J;Q<ne;Q+=d){var ce=Q-B,ve=T.get(R,ee,fe,Q,I);ve>=q&&(q=ve,Y=ue*g*v+W*g+ce)}i.set(Y,R,C,N,j,I)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,a){Ee([r,i],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(r,a),u=a.strideDepth,c=a.strideHeight,h=a.strideWidth,d=a.dilationDepth,p=a.dilationHeight,g=a.dilationWidth,v=a.effectiveFilterDepth,b=a.effectiveFilterHeight,w=a.effectiveFilterWidth,E=v-1-a.padInfo.front,T=w-1-a.padInfo.left,R=b-1-a.padInfo.top,I=it(r.shape,"float32"),C=this.bufferSync(o),k=this.bufferSync(t),L=0;L<a.batchSize;++L)for(var O=0;O<a.inChannels;++O)for(var N=0;N<a.inDepth;++N)for(var D=0;D<a.inHeight;++D)for(var P=0;P<a.inWidth;++P){for(var F=N-E,j=D-R,B=P-T,J=0,ne=0;ne<v;ne+=d){var q=(F+ne)/u;if(!(q<0||q>=a.outDepth||Math.floor(q)!==q))for(var Y=0;Y<b;Y+=p){var ee=(j+Y)/c;if(!(ee<0||ee>=a.outHeight||Math.floor(ee)!==ee))for(var ue=0;ue<w;ue+=g){var fe=(B+ue)/h;if(!(fe<0||fe>=a.outWidth||Math.floor(fe)!==fe)){var W=v*b*w-1-C.get(L,q,ee,fe,O)===ne*b*w+Y*w+ue?1:0;W!==0&&(J+=k.get(L,q,ee,fe,O)*W)}}}}I.set(J,L,N,D,P,O)}return I.toTensor()},e.prototype.cast=function(t,r){return Ik(t,r,this)},e.prototype.reshape=function(t,r){return jb(t,r)},e.prototype.avgPool=function(t,r){return Ee(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,a){Ee(t,"resizeBilinear");for(var o=t.shape,u=o[0],c=o[1],h=o[2],d=o[3],p=this.readSync(t.dataId),g=new Float32Array(je([u,r,i,d])),v=[a&&r>1?c-1:c,a&&i>1?h-1:h],b=[a&&r>1?r-1:r,a&&i>1?i-1:i],w=0,E=v[0]/b[0],T=v[1]/b[1],R=0;R<u;R++)for(var I=0;I<r;I++)for(var C=E*I,k=Math.floor(C),L=C-k,O=Math.min(c-1,Math.ceil(C)),N=R*t.strides[0]+k*t.strides[1],D=R*t.strides[0]+O*t.strides[1],P=0;P<i;P++)for(var F=T*P,j=Math.floor(F),B=F-j,J=Math.min(h-1,Math.ceil(F)),ne=N+j*t.strides[2],q=D+j*t.strides[2],Y=N+J*t.strides[2],ee=D+J*t.strides[2],ue=0;ue<d;ue++){var fe=p[ne+ue],W=p[q+ue],Q=fe+(p[Y+ue]-fe)*B,ce=Q+(W+(p[ee+ue]-W)*B-Q)*L;g[w++]=ce}return pr(g,[u,r,i,d])},e.prototype.resizeBilinearBackprop=function(t,r,i){Ee([t,r],"resizeBilinearBackprop");for(var a=r.shape,o=a[0],u=a[1],c=a[2],h=a[3],d=t.shape,p=d[1],g=d[2],v=new Float32Array(o*u*c*h),b=[i&&p>1?u-1:u,i&&g>1?c-1:c],w=[i&&p>1?p-1:p,i&&g>1?g-1:g],E=b[0]/w[0],T=b[1]/w[1],R=this.readSync(t.dataId),I=0,C=0;C<o;C++)for(var k=C*r.strides[0],L=0;L<p;L++)for(var O=L*E,N=Math.floor(O),D=Math.min(Math.ceil(O),u-1),P=k+N*r.strides[1],F=k+D*r.strides[1],j=O-N,B=1-j,J=0;J<g;J++)for(var ne=J*T,q=Math.floor(ne),Y=Math.min(Math.ceil(ne),c-1),ee=ne-q,ue=1-ee,fe=P+q*r.strides[2],W=P+Y*r.strides[2],Q=F+q*r.strides[2],ce=F+Y*r.strides[2],ve=B*ue,Te=B*ee,Ae=j*ue,xe=j*ee,ke=0;ke<h;ke++){var Ie=R[I++];v[fe+ke]+=Ie*ve,v[W+ke]+=Ie*Te,v[Q+ke]+=Ie*Ae,v[ce+ke]+=Ie*xe}return Kr(v,[o,c,u,h],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,a){Ee(t,"resizeNearestNeighbor");for(var o=t.shape,u=o[0],c=o[1],h=o[2],d=o[3],p=this.readSync(t.dataId),g=new Float32Array(u*r*i*d),v=[a&&r>1?c-1:c,a&&i>1?h-1:h],b=[a&&r>1?r-1:r,a&&i>1?i-1:i],w=v[0]/b[0],E=v[1]/b[1],T=0,R=0;R<u;R++)for(var I=R*t.strides[0],C=0;C<r;C++)for(var k=w*C,L=I+Math.min(c-1,a?Math.round(k):Math.floor(k))*t.strides[1],O=0;O<i;O++)for(var N=E*O,D=L+Math.min(h-1,a?Math.round(N):Math.floor(N))*t.strides[2],P=0;P<d;P++){var F=p[D+P];g[T++]=F}return pr(g,[u,r,i,d],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Ee([t,r],"resizeNearestNeighborBackprop");for(var a=r.shape,o=a[0],u=a[1],c=a[2],h=a[3],d=t.shape,p=d[1],g=d[2],v=new Float32Array(o*u*c*h),b=this.readSync(t.dataId),w=[i&&p>1?u-1:u,i&&g>1?c-1:c],E=[i&&p>1?p-1:p,i&&g>1?g-1:g],T=w[0]/E[0],R=w[1]/E[1],I=1/T,C=1/R,k=2*Math.ceil(I)+2,L=2*Math.ceil(C)+2,O=0;O<o;O++)for(var N=O*r.strides[0],D=0;D<u;D++)for(var P=N+D*r.strides[1],F=Math.floor(D*I),j=Math.floor(F-k/2),B=0;B<c;B++)for(var J=P+B*r.strides[2],ne=Math.floor(B*C),q=Math.floor(ne-L/2),Y=0;Y<h;Y++){for(var ee=0,ue=0;ue<k;ue++){var fe=ue+j;if(!(fe<0||fe>=p)){var W=N+fe*t.strides[1],Q=fe*T;if(D===Math.min(u-1,i?Math.round(Q):Math.floor(Q)))for(var ce=0;ce<L;ce++){var ve=ce+q;if(!(ve<0||ve>=g)){var Te=W+ve*t.strides[2],Ae=ve*R;B===Math.min(c-1,i?Math.round(Ae):Math.floor(Ae))&&(ee+=b[Te+Y])}}}}v[J+Y]=ee}return Kr(v,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,a,o,u){Ee([t,r,i,o,u],"batchNorm");for(var c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=this.readSync(i.dataId),p=o?this.readSync(o.dataId):new Float32Array([1]),g=u?this.readSync(u.dataId):new Float32Array([0]),v=new Float32Array(c.length),b=g.length,w=p.length,E=d.length,T=h.length,R=0,I=0,C=0,k=0,L=0;L<c.length;++L)v[L]=g[R++]+(c[L]-h[I++])*p[C++]/Math.sqrt(d[k++]+a),R>=b&&(R=0),I>=T&&(I=0),C>=w&&(C=0),k>=E&&(k=0);return Kr(v,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,a,o){Ee(t,"localResponseNormalization4D");var u=t.shape[3],c=u-1,h=this.readSync(t.dataId),d=t.size,p=new Float32Array(d);function g(E){for(var T=E%u,R=E-T+Math.max(0,T-r),I=E-T+Math.min(T+r,c),C=0;R<=I;R++){var k=h[R];C+=k*k}return C}for(var v=0;v<d;v++){var b=g(v),w=h[v]*Math.pow(i+a*b,-o);p[v]=w}return Kr(p,t.shape)},e.prototype.LRNGrad=function(t,r,i,a,o,u,c){Ee(t,"LRNGrad");for(var h=t.shape[3],d=this.readSync(t.dataId),p=this.readSync(r.dataId),g=this.readSync(i.dataId),v=new Float32Array(t.size),b=t.size,w=0;w<b;w++){for(var E=w%h,T=w-E+Math.max(0,E-a),R=w-E+Math.min(h,E+a+1),I=0,C=T;C<R;C++)I+=Math.pow(p[C],2);for(I=u*I+o,C=T;C<R;C++){var k=-2*u*c*p[C]*g[w]/I;w===C&&(k+=Math.pow(I,-c)),k*=d[w],v[C]+=k}}return Kr(v,t.shape)},e.prototype.multinomial=function(t,r,i,a){Ee(t,"multinomial");for(var o=r?t:Uo(t),u=o.shape[0],c=o.shape[1],h=$t([u,i],"int32"),d=this.readSync(h.dataId),p=this.readSync(o.dataId),g=0;g<u;++g){var v=g*c,b=new Float32Array(c-1);b[0]=p[v];for(var w=1;w<b.length;++w)b[w]=b[w-1]+p[v+w];for(var E=hv(a.toString()),T=g*i,R=0;R<i;++R){var I=E();d[T+R]=b.length;for(var C=0;C<b.length;C++)if(I<b[C]){d[T+R]=C;break}}}return h},e.prototype.oneHot=function(t,r,i,a){Ee(t,"oneHot");var o=new Float32Array(t.size*r);o.fill(a);for(var u=this.readSync(t.dataId),c=0;c<t.size;++c)u[c]>=0&&u[c]<r&&(o[c*r+u[c]]=i);return Ns(o,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,a,o){return Ee(t,"nonMaxSuppression"),wx(this.readSync(t.dataId),this.readSync(r.dataId),i,a,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],a=t.shape[1],o=it(t.shape,"float32"),u=it(t.shape,"float32"),c=Pi(t).as2D(i,a),h=Ua(t).as2D(i,a),d=0;d<i;d++)for(var p=c.slice([d,0],[1,a]),g=h.slice([d,0],[1,a]),v=fr(p,g),b=this.readSync(this.fftImpl(v,r).dataId),w=0;w<a;w++){var E=NA(b,w);o.values[d*a+w]=E.real,u.values[d*a+w]=E.imag}return fr(o.toTensor(),u.toTensor()).as2D(i,a)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),a=i.size;if(this.isExponentOf2(a)){var o=this.fftRadix2(i,a,r).as2D(t.shape[0],t.shape[1]);return r&&(o=fr(Pi(o).div(Re(a)),Ua(o).div(Re(a)))),o}var u=this.readSync(t.dataId),c=(function(h){for(var d=new Float32Array(h.length/2),p=new Float32Array(h.length/2),g=0;g<h.length;g+=2)d[g/2]=h[g],p[g/2]=h[g+1];return{real:d,imag:p}})(this.fourierTransformByMatmul(u,a,r));return fr(c.real,c.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var a=this.readSync(t.dataId),o=r/2,u=(function(T){for(var R=Math.ceil(T.length/4),I=new Float32Array(R),C=new Float32Array(R),k=0;k<T.length;k+=4)I[Math.floor(k/4)]=T[k],C[Math.floor(k/4)]=T[k+1];return{real:I,imag:C}})(a),c=fr(u.real,u.imag).as1D(),h=(function(T){for(var R=Math.floor(T.length/4),I=new Float32Array(R),C=new Float32Array(R),k=2;k<T.length;k+=4)I[Math.floor(k/4)]=T[k],C[Math.floor(k/4)]=T[k+1];return{real:I,imag:C}})(a),d=fr(h.real,h.imag).as1D();c=this.fftRadix2(c,o,i),d=this.fftRadix2(d,o,i);var p=(function(T,R){for(var I=new Float32Array(T/2),C=new Float32Array(T/2),k=0;k<Math.ceil(T/2);k++){var L=(R?2:-2)*Math.PI*(k/T);I[k]=Math.cos(L),C[k]=Math.sin(L)}return{real:I,imag:C}})(r,i),g=fr(p.real,p.imag).mul(d),v=c.add(g),b=c.sub(g),w=Pi(v).concat(Pi(b)),E=Ua(v).concat(Ua(b));return fr(w,E).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var a=new Float32Array(2*r),o=0;o<r;o++){for(var u=0,c=0,h=0;h<r;h++){var d=UU(o*h,r,i),p=NA(t,h);u+=p.real*d.real-p.imag*d.imag,c+=p.real*d.imag+p.imag*d.real}i&&(u/=r,c/=r),jU(a,u,c,o)}return a},e.prototype.depthToSpace=function(t,r,i){H(i==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i})),H(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var a=t.shape[0],o=t.shape[1],u=t.shape[2],c=t.shape[3],h=o*r,d=u*r,p=c/(r*r),g=this.readSync(t.dataId),v=new Float32Array(a*h*d*p),b=0,w=0;w<a;++w)for(var E=0;E<h;++E)for(var T=Math.floor(E/r),R=E%r,I=0;I<d;++I)for(var C=Math.floor(I/r),k=(R*r+I%r)*p,L=0;L<p;++L){var O=L+k+c*(C+u*(T+o*w));v[b++]=g[O]}return Kr(v,[a,h,d,p])},e.prototype.broadcastedBinaryOp=function(t,r,i,a){var o=mt(t.shape,r.shape),u=it(o,i),c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=As(t.shape,o),p=As(r.shape,o),g=u.values;if(d.length+p.length===0)for(var v=0;v<g.length;++v)g[v]=a(c[v%c.length],h[v%h.length]);else{var b=this.bufferSync(t),w=this.bufferSync(r),E=function(T){var R=u.indexToLoc(T),I=R.slice(-t.rank);d.forEach((function(O){return I[O]=0}));var C=b.locToIndex(I),k=R.slice(-r.rank);p.forEach((function(O){return k[O]=0}));var L=w.locToIndex(k);g[T]=a(c[C],h[L])};for(v=0;v<g.length;++v)E(v)}return u.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var a=mt(t.shape,r.shape),o=it(a,"float32"),u=it(a,"float32"),c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=As(t.shape,a),p=As(r.shape,a),g=o.values,v=u.values;if(d.length+p.length===0)for(var b=0;b<g.length;b++){var w=b%c.length,E=b%h.length,T=i(c[2*w],c[2*w+1],h[2*E],h[2*E+1]);g[b]=T.real,v[b]=T.imag}else{var R=this.bufferSync(this.data.get(t.dataId).complexTensors.real),I=this.bufferSync(this.data.get(r.dataId).complexTensors.real),C=function(k){var L=o.indexToLoc(k),O=L.slice(-t.rank);d.forEach((function(j){return O[j]=0}));var N=R.locToIndex(O),D=L.slice(-r.rank);p.forEach((function(j){return D[j]=0}));var P=I.locToIndex(D),F=i(c[2*N],c[2*N+1],h[2*P],h[2*P+1]);g[k]=F.real,v[k]=F.imag};for(b=0;b<g.length;b++)C(b)}return this.complex(o.toTensor(),u.toTensor())},e.prototype.split=function(t,r,i){return kk(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,a,o,u){for(var c=t.shape,h=c[0],d=c[1],p=c[2],g=c[3],v=r.shape[0],b=a[0],w=a[1],E=it([v,b,w,g],"float32"),T=this.readSync(r.dataId),R=this.readSync(i.dataId),I=this.readSync(t.dataId),C=t.strides,k=E.strides,L=0;L<v;L++){var O=4*L,N=T[O],D=T[O+1],P=T[O+2],F=T[O+3],j=R[L];if(!(j>=h))for(var B=b>1?(P-N)*(d-1)/(b-1):0,J=w>1?(F-D)*(p-1)/(w-1):0,ne=0;ne<b;ne++){var q=b>1?N*(d-1)+ne*B:.5*(N+P)*(d-1);if(q<0||q>d-1)for(var Y=0;Y<w;Y++)for(var ee=0;ee<g;ee++){var ue=ee+Y*k[2]+ne*k[1]+L*k[0];E.values[ue]=u}else if(o==="bilinear"){var fe=Math.floor(q),W=Math.ceil(q),Q=q-fe;for(Y=0;Y<w;Y++)if((Je=w>1?D*(p-1)+Y*J:.5*(D+F)*(p-1))<0||Je>p-1)for(ee=0;ee<g;ee++)ue=ee+Y*k[2]+ne*k[1]+L*k[0],E.values[ue]=u;else{var ce=Math.floor(Je),ve=Math.ceil(Je),Te=Je-ce;for(ee=0;ee<g;ee++){var Ae=I[ue=ee+ce*C[2]+fe*C[1]+j*C[0]],xe=I[ue=ee+ve*C[2]+fe*C[1]+j*C[0]],ke=I[ue=ee+ce*C[2]+W*C[1]+j*C[0]],Ie=Ae+(xe-Ae)*Te,qe=ke+(I[ue=ee+ve*C[2]+W*C[1]+j*C[0]]-ke)*Te;ue=ee+Y*k[2]+ne*k[1]+L*k[0],E.values[ue]=Ie+(qe-Ie)*Q}}}else for(Y=0;Y<w;++Y){var Je;if((Je=w>1?D*(p-1)+Y*J:.5*(D+F)*(p-1))<0||Je>p-1)for(ee=0;ee<g;ee++)ue=ee+Y*k[2]+ne*k[1]+L*k[0],E.values[ue]=u;else{var Ze=Math.round(Je),Xe=Math.round(q);for(ee=0;ee<g;ee++){var ot=ee+Ze*C[2]+Xe*C[1]+j*C[0],$e=ee+Y*k[2]+ne*k[1]+L*k[0];E.values[$e]=I[ot]}}}}}return E.toTensor()},e.prototype.sparseToDense=function(t,r,i,a){var o=Cg(0,t,i),u=o.sliceRank,c=o.numUpdates,h=o.sliceSize,d=o.strides,p=o.outputSize;return this.scatter(t,r,i,p,h,c,u,d,a,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,a=i[i.length-1],o=wk(t,r),u=o[0],c=o[1],h=o[2],d=o[3];if(c===0)return pr([],u,t.dtype);for(var p=new nd([c,h],t.dtype),g=this.readSync(r.dataId),v=this.readSync(t.dataId),b=0;b<c;b++){for(var w=[],E=0,T=0;T<a;T++){var R=g[b*a+T];E+=R*d[T],w.push(R)}if(E<0||E>=t.size/h)throw new Error("Invalid indices: "+w+" does not index into "+t.shape);for(var I=0;I<h;I++)p.values[b*h+I]=v[E*h+I]}return p.toTensor().reshape(u)},e.prototype.scatterND=function(t,r,i){var a=Cg(0,t,i),o=a.sliceRank,u=a.numUpdates,c=a.sliceSize,h=a.strides,d=a.outputSize,p=Re(0);return this.scatter(t,r,i,d,c,u,o,h,p,!0)},e.prototype.fill=function(t,r,i){var a=mg(i=i||Id(r),je(t));return a.fill(r),Z.makeTensor(a,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=mg(t.dtype,je(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return Nk(t,r,i)},e.prototype.scatter=function(t,r,i,a,o,u,c,h,d,p){var g=[a/o,o],v=this.readSync(t.dataId),b=this.readSync(r.dataId);if(a===0)return pr([],i,r.dtype);var w=new nd(g,r.dtype);w.values.fill(this.readSync(d.dataId)[0]);for(var E=0;E<u;E++){for(var T=[],R=0,I=0;I<c;I++){var C=v[E*c+I];T.push(C),R+=C*h[I]}if(R<0||R>=a/o)throw new Error("Invalid indices: "+T+" does not index into "+i);for(var k=0;k<o;k++)p?w.values[R*o+k]+=b[E*o+k]:w.values[R*o+k]=r.rank===0?b[0]:b[E*o+k]}return w.toTensor().reshape(i)},e})(Ak);Z.registerBackend("cpu",(function(){return new sH}),1);for(var k_=0,ZA=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,a=i.boxes,o=i.scores,u=r,c=u.maxOutputSize,h=u.iouThreshold,d=u.scoreThreshold,p=u.softNmsSigma,g=t;Ee(a,"NonMaxSuppressionWithScore");var v=Ex(g.data.get(a.dataId).values,g.data.get(o.dataId).values,c,h,d,p);return[v.selectedIndices,v.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;Ee(r,"square");for(var a=i.data.get(r.dataId).values,o=new Float32Array(a.length),u=0;u<a.length;++u){var c=a[u];o[u]=c*c}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:ad,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,a=r.b,o=t;Ee([i,a],ad);var u=o.data.get(i.dataId).values,c=o.data.get(a.dataId).values,h=(function(g,v,b,w,E,T){var R=mt(g,v),I=R.length,C=Ka(R),k=td(E,je(R)),L=g.length,O=v.length,N=Ka(g),D=Ka(v),P=As(g,R),F=As(v,R);if(P.length+F.length===0)for(var j=0;j<k.length;++j)k[j]=T(b[j%b.length],w[j%w.length]);else{var B=function(J){var ne=v5(J,I,C),q=ne.slice(-L);P.forEach((function(fe){return q[fe]=0}));var Y=xA(q,L,N),ee=ne.slice(-O);F.forEach((function(fe){return ee[fe]=0}));var ue=xA(ee,O,D);k[J]=T(b[Y],w[ue])};for(j=0;j<k.length;++j)B(j)}return[k,R]})(i.shape,a.shape,u,c,i.dtype,(function(g,v){var b=g-v;return b*b})),d=h[0],p=h[1];return{dataId:o.write(d,p,i.dtype),shape:p,dtype:i.dtype}}}];k_<ZA.length;k_++)tk(ZA[k_]);var oc,uH=function(n){this.variableNames=["A"];var e=Ar(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},lH=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Ar(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var M_=0,JA=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,a=r.numChannels,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,c=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=c[0],d=c[1],p=[d,h],g=[d,h,a];(u||o)&&(oc==null&&(oc=document.createElement("canvas").getContext("2d")),oc.canvas.width=h,oc.canvas.height=d,oc.drawImage(i,0,0,h,d),i=oc.canvas);var v=t.makeTensorInfo(p,"int32");t.texData.get(v.dataId).usage=fi.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(v.dataId),i);var b=ge().getBool("WEBGL_PACK")?new lH(g):new uH(g),w=t.runWebGLProgram(b,[v],"int32");return t.disposeData(v.dataId),w}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;_g("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,a=i.boxes,o=i.scores,u=r,c=u.maxOutputSize,h=u.iouThreshold,d=u.scoreThreshold,p=u.softNmsSigma,g=t,v=Ex(g.readSync(a.dataId),g.readSync(o.dataId),c,h,d,p);return[v.selectedIndices,v.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,a=new ht(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:ad,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,a=r.b,o=t,u=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ao("return (a - b) * (a - b);",i.shape,a.shape):new fn("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(u,[i,a])}}];M_<JA.length;M_++)tk(JA[M_]);for(var O_=0,eR=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:ad,gradFunc:function(n,e){var t=e[0],r=e[1],i=Re(2);return{a:function(){return Nr(n,Nr(i,Wn(t,r)))},b:function(){return Nr(n,Nr(i,Wn(r,t)))}}}}];O_<eR.length;O_++)o5(eR[O_]);var cH=(function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n})();ge().get("IS_BROWSER")&&ge().setPlatform("browser",new cH);var P_,hH=function(){return require("node-fetch")},fH=(function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return ge().global.fetch!=null?ge().global.fetch(e,t):(P_==null&&(P_=hH()),P_(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n})();ge().get("IS_NODE")&&ge().setPlatform("node",new fH);var Gb={float32:4,int32:4,uint16:2,uint8:1,bool:1},kg=4;function TM(n,e){for(var t={},r=0,i=function(u){var c=u.name,h=u.dtype,d=u.shape,p=je(d),g=void 0;if("quantization"in u){var v=u.quantization;if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Weight "+u.name+" has unknown quantization dtype "+v.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var b=Gb[v.dtype],w=n.slice(r,r+p*b),E=v.dtype==="uint8"?new Uint8Array(w):new Uint16Array(w);if(h==="float32")g=Float32Array.from(E,(function(L){return L*v.scale+v.min}));else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+h);g=Int32Array.from(E,(function(L){return Math.round(L*v.scale+v.min)}))}r+=p*b}else if(h==="string"){var T=je(u.shape);g=[];for(var R=0;R<T;R++){var I=new Uint32Array(n.slice(r,r+kg))[0];r+=kg;var C=new Uint8Array(n.slice(r,r+I));g.push(C),r+=I}}else{var k=Gb[h];if(w=n.slice(r,r+p*k),h==="float32")g=new Float32Array(w);else if(h==="int32")g=new Int32Array(w);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+h);g=new Uint8Array(w)}r+=p*k}t[c]=pr(g,d,h)},a=0,o=e;a<o.length;a++)i(o[a]);return t}function dH(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach((function(a){if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)}));var r=new Uint8Array(e),i=0;return t.forEach((function(a){r.set(new Uint8Array(a.buffer),i),i+=a.byteLength})),r.buffer}var Hb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function tR(n){return Hb?Buffer.byteLength(n):new Blob([n]).size}function zx(n){var e=0;n.forEach((function(i){e+=i.byteLength}));var t=new Uint8Array(e),r=0;return n.forEach((function(i){t.set(new Uint8Array(i),r),r+=i.byteLength})),t.buffer}function nR(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Vd(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:tR(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:tR(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var di=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(a){var o=a(e,r);o!==null&&i.push(o)})),i},n})(),Nc="://",Ds=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){H(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(Nc)&&(e=e.slice(0,e.indexOf(Nc))),H(e.length>0,(function(){return"scheme must not be an empty string."}));var r=n.getInstance();H(r.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})();function eg(n){if(n.indexOf(Nc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ds.getSchemes().join(","));return{scheme:n.split(Nc)[0],path:n.split(Nc)[1]}}function rR(n,e,t){return t===void 0&&(t=!1),Fe(this,void 0,void 0,(function(){var r,i,a,o,u,c,h,d,p;return Le(this,(function(g){switch(g.label){case 0:return H(n!==e,(function(){return"Old path and new path are the same: '"+n+"'"})),H((r=di.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),H(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."})),i=r[0],H((a=di.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),H(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),o=a[0],u=eg(n).scheme,c=eg(n).path,h=u===eg(n).scheme,[4,i.load()];case 1:return d=g.sent(),t&&h?[4,Ds.getManager(u).removeModel(c)]:[3,3];case 2:g.sent(),g.label=3;case 3:return[4,o.save(d)];case 4:return p=g.sent(),!t||h?[3,6]:[4,Ds.getManager(u).removeModel(c)];case 5:g.sent(),g.label=6;case 6:return[2,p.modelArtifactsInfo]}}))}))}var qu="models_store",Rs="model_info_store";function CM(){if(!ge().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Wb(n){var e=n.result;e.createObjectStore(qu,{keyPath:"modelPath"}),e.createObjectStore(Rs,{keyPath:"modelPath"})}var Dc=(function(){function n(e){if(this.indexedDB=CM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},n.prototype.load=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(e,t){var r=this;return new Promise((function(i,a){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Wb(o)},o.onsuccess=function(){var u=o.result;if(t==null){var c=u.transaction(qu,"readonly"),h=c.objectStore(qu).get(r.modelPath);h.onsuccess=function(){if(h.result==null)return u.close(),a(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(h.result.modelArtifacts)},h.onerror=function(w){return u.close(),a(h.error)},c.oncomplete=function(){return u.close()}}else{var d,p=Vd(t),g=u.transaction(Rs,"readwrite"),v=g.objectStore(Rs),b=v.put({modelPath:r.modelPath,modelArtifactsInfo:p});b.onsuccess=function(){var w=(d=u.transaction(qu,"readwrite")).objectStore(qu).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:p});w.onsuccess=function(){return i({modelArtifactsInfo:p})},w.onerror=function(E){var T=(v=g.objectStore(Rs)).delete(r.modelPath);T.onsuccess=function(){return u.close(),a(w.error)},T.onerror=function(R){return u.close(),a(w.error)}}},b.onerror=function(w){return u.close(),a(b.error)},g.oncomplete=function(){d==null?u.close():d.oncomplete=function(){return u.close()}}}},o.onerror=function(u){return a(o.error)}}))},n.URL_SCHEME="indexeddb://",n})(),iR=function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Dc.URL_SCHEME)?(e=n.slice(Dc.URL_SCHEME.length),new Dc(e)):null;var e};di.registerSaveRouter(iR),di.registerLoadRouter(iR);var pH=(function(){function n(){this.indexedDB=CM()}return n.prototype.listModels=function(){return Fe(this,void 0,void 0,(function(){var e=this;return Le(this,(function(t){return[2,new Promise((function(r,i){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Wb(a)},a.onsuccess=function(){var o=a.result,u=o.transaction(Rs,"readonly"),c=u.objectStore(Rs).getAll();c.onsuccess=function(){for(var h={},d=0,p=c.result;d<p.length;d++){var g=p[d];h[g.modelPath]=g.modelArtifactsInfo}r(h)},c.onerror=function(h){return o.close(),i(c.error)},u.oncomplete=function(){return o.close()}},a.onerror=function(o){return i(a.error)}}))]}))}))},n.prototype.removeModel=function(e){return Fe(this,void 0,void 0,(function(){var t=this;return Le(this,(function(r){var i;return e=(i=e).startsWith(Dc.URL_SCHEME)?i.slice(Dc.URL_SCHEME.length):i,[2,new Promise((function(a,o){var u=t.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return Wb(u)},u.onsuccess=function(){var c,h=u.result,d=h.transaction(Rs,"readwrite"),p=d.objectStore(Rs),g=p.get(e);g.onsuccess=function(){if(g.result==null)return h.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var v=p.delete(e),b=function(){var w=(c=h.transaction(qu,"readwrite")).objectStore(qu).delete(e);w.onsuccess=function(){return a(g.result.modelArtifactsInfo)},w.onerror=function(E){return o(g.error)}};v.onsuccess=b,v.onerror=function(w){return b(),h.close(),o(g.error)}},g.onerror=function(v){return h.close(),o(g.error)},d.oncomplete=function(){c==null?h.close():c.oncomplete=function(){return h.close()}}},u.onerror=function(c){return o(u.error)}}))]}))}))},n})();if(ge().getBool("IS_BROWSER"))try{Ds.registerManager(Dc.URL_SCHEME,new pH)}catch{}var Io="/",pc="tensorflowjs_models",SM="info",mH="model_topology",gH="weight_specs",vH="weight_data",yH="model_metadata";function AM(n){return{info:[pc,n,SM].join(Io),topology:[pc,n,mH].join(Io),weightSpecs:[pc,n,gH].join(Io),weightData:[pc,n,vH].join(Io),modelMetadata:[pc,n,yH].join(Io)}}function _H(n){var e=n.split(Io);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Io)}var kc=(function(){function n(e){if(!ge().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=AM(this.modelPath)}return n.prototype.save=function(e){return Fe(this,void 0,void 0,(function(){var t,r,i;return Le(this,(function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Vd(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(o){if(Hb)return Buffer.from(o).toString("base64");for(var u=new Uint8Array(o),c="",h=0,d=u.length;h<d;h++)c+=String.fromCharCode(u[h]);return btoa(c)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return Fe(this,void 0,void 0,(function(){var e,t,r,i,a,o,u;return Le(this,(function(c){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(a),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(h){if(Hb){var d=Buffer.from(h,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var p=atob(h),g=new Uint8Array(p.length),v=0;v<p.length;++v)g.set([p.charCodeAt(v)],v);return g.buffer})(u),[2,t]}))}))},n.URL_SCHEME="localstorage://",n})(),aR=function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(kc.URL_SCHEME)?(e=n.slice(kc.URL_SCHEME.length),new kc(e)):null;var e};di.registerSaveRouter(aR),di.registerLoadRouter(aR);var bH=(function(){function n(){H(ge().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),H(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return Fe(this,void 0,void 0,(function(){var e,t,r,i,a,o;return Le(this,(function(u){for(e={},t=pc+Io,r=Io+SM,i=0;i<this.LS.length;++i)(a=this.LS.key(i)).startsWith(t)&&a.endsWith(r)&&(o=_H(a),e[o]=JSON.parse(this.LS.getItem(a)));return[2,e]}))}))},n.prototype.removeModel=function(e){return Fe(this,void 0,void 0,(function(){var t,r;return Le(this,(function(i){var a;if(e=(a=e).startsWith(kc.URL_SCHEME)?a.slice(kc.URL_SCHEME.length):a,t=AM(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n})();if(ge().getBool("IS_BROWSER"))try{Ds.registerManager(kc.URL_SCHEME,new bH)}catch{}var xH="model",wH=".json",EH=".weights.bin";function oR(n){return new Promise((function(e){return setTimeout(e)})).then(n)}var V_=(function(){function n(e){if(!ge().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=xH),this.modelTopologyFileName=e+wH,this.weightDataFileName=e+EH}return n.prototype.save=function(e){return Fe(this,void 0,void 0,(function(){var t,r,i,a,o,u;return Le(this,(function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=a,[4,oR((function(){return o.dispatchEvent(new MouseEvent("click"))}))];case 2:return c.sent(),e.weightData==null?[3,4]:((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=t,[4,oR((function(){return u.dispatchEvent(new MouseEvent("click"))}))]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Vd(e)}]}}))}))},n.URL_SCHEME="downloads://",n})(),TH=(function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Fe(this,void 0,void 0,(function(){var e,t,r=this;return Le(this,(function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(a,o){var u=new FileReader;u.onload=function(c){var h=JSON.parse(c.target.result),d=h.modelTopology;if(d!=null){t.length===0&&a({modelTopology:d});var p=h.weightsManifest;if(p!=null){var g;try{g=r.checkManifestAndWeightFiles(p,t)}catch(E){return void o(E)}var v=[],b=[],w=[];p.forEach((function(E){E.paths.forEach((function(T){b.push(T),w.push(null)})),v.push.apply(v,E.weights)})),p.forEach((function(E){E.paths.forEach((function(T){var R=new FileReader;R.onload=function(I){var C=I.target.result,k=b.indexOf(T);w[k]=C,w.indexOf(null)===-1&&a({modelTopology:d,weightSpecs:v,weightData:zx(w),format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})},R.onerror=function(I){return o("Failed to weights data from file of path '"+T+"'.")},R.readAsArrayBuffer(g[T])}))}))}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},u.onerror=function(c){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},u.readAsText(e)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map((function(c){return nR(c.name)})),a={},o=0,u=e;o<u.length;o++)u[o].paths.forEach((function(c){var h=nR(c);if(r.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(r.push(h),i.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");a[c]=t[i.indexOf(h)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return a},n})();function sR(n,e,t,r){(function(a){H(a!=null&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"}))})(n),(function(a,o){H(a>=0&&a<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a})),H(o>=0&&o<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o})),H(o>=a,(function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+o}))})(t=t??0,r=r??1);var i=0;return Promise.all(n.map((function(a){return a.then((function(o){var u=t+ ++i/n.length*(r-t);return e(u),o})),a})))}function RM(n,e){return Fe(this,void 0,void 0,(function(){var t,r,i,a,o,u,c,h,d;return Le(this,(function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?ge().platform.fetch:e.fetchFunc,r=n.map((function(g){return t(g,e.requestInit,{isBinary:!0})})),i=0,a=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return o=p.sent(),[3,4];case 2:return[4,sR(r,e.onProgress,i,a)];case 3:o=p.sent(),p.label=4;case 4:return u=o.map((function(g){return g.arrayBuffer()})),c=.5,h=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return d=p.sent(),[3,8];case 6:return[4,sR(u,e.onProgress,c,h)];case 7:d=p.sent(),p.label=8;case 8:return[2,d]}}))}))}function uR(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),Fe(e,void 0,void 0,(function(){var a,o,u,c,h,d,p,g,v,b;return Le(this,(function(w){switch(w.label){case 0:if(a=t.map((function(){return!1})),o={},u=i!=null?i.map((function(){return!1})):[],c=[],t.forEach((function(E,T){var R=0;E.weights.forEach((function(I){var C="quantization"in I?I.quantization.dtype:I.dtype,k=Gb[C]*je(I.shape),L=function(){a[T]=!0,o[T]==null&&(o[T]=[]),o[T].push({manifestEntry:I,groupOffset:R,sizeBytes:k})};i!=null?i.forEach((function(O,N){O===I.name&&(L(),u[N]=!0)})):L(),c.push(I.name),R+=k}))})),!u.every((function(E){return E})))throw h=i.filter((function(E,T){return!u[T]})),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return d=a.reduce((function(E,T,R){return T&&E.push(R),E}),[]),p=[],d.forEach((function(E){t[E].paths.forEach((function(T){var R=r+(r.endsWith("/")?"":"/")+T;p.push(R)}))})),[4,n(p)];case 1:return g=w.sent(),v={},b=0,d.forEach((function(E){for(var T=t[E].paths.length,R=0,I=0;I<T;I++)R+=g[b+I].byteLength;for(var C=new ArrayBuffer(R),k=new Uint8Array(C),L=0,O=0;O<T;O++){var N=new Uint8Array(g[b+O]);k.set(N,L),L+=N.byteLength}o[E].forEach((function(D){var P=TM(C.slice(D.groupOffset,D.groupOffset+D.sizeBytes),[D.manifestEntry]);for(var F in P)v[F]=P[F]})),b+=T})),[2,v]}}))}))}}di.registerSaveRouter((function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(V_.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new V_(e)})(n.slice(V_.URL_SCHEME.length)):null}));var IM=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(H(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=ge().platform.fetch,H(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&H(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Fe(this,void 0,void 0,(function(){var t,r,i,a;return Le(this,(function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=o.sent()).ok)return[2,{modelArtifactsInfo:Vd(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}}))}))},n.prototype.load=function(){return Fe(this,void 0,void 0,(function(){var e,t,r,i,a,o,u,c,h,d,p,g;return Le(this,(function(v){switch(v.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=v.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");v.label=2;case 2:return v.trys.push([2,4,,5]),[4,e.json()];case 3:return t=v.sent(),[3,5];case 4:throw v.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,a=t.weightsManifest,o=t.generatedBy,u=t.convertedBy,c=t.format,h=t.userDefinedMetadata,i==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:g=v.sent(),d=g[0],p=g[1],v.label=7;case 7:return[2,{modelTopology:i,weightSpecs:d,weightData:p,userDefinedMetadata:h,generatedBy:o,convertedBy:u,format:c}]}}))}))},n.prototype.loadWeights=function(e){return Fe(this,void 0,void 0,(function(){var t,r,i,a,o,u,c,h,d,p,g;return Le(this,(function(v){switch(v.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(b){var w=b.lastIndexOf("/"),E=b.lastIndexOf("?"),T=b.substring(0,w),R=E>w?b.substring(E):"";return[T+"/",R]})(t),i=r[0],a=r[1],o=this.weightPathPrefix||i,u=[],c=0,h=e;c<h.length;c++)d=h[c],u.push.apply(u,d.weights);return p=[],e.forEach((function(b){b.paths.forEach((function(w){p.push(o+w+a)}))})),[4,RM(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return g=v.sent(),[2,[u,zx(g)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function qb(n){return n.match(IM.URL_SCHEME_REGEX)!=null}var lR=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every((function(t){return qb(t)})):qb(n))?Kb(n,{onProgress:e}):null};function Kb(n,e){return new IM(n,e)}di.registerSaveRouter(lR),di.registerLoadRouter(lR);var F_=(function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(e){return[2,this.modelArtifacts]}))}))},n})(),CH=(function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){return[2,this.saveHandler(e)]}))}))},n})(),NM=Object.freeze({browserFiles:function(n){return new TH(n)},browserHTTPRequest:function(n,e){return Kb(n,e)},concatenateArrayBuffers:zx,decodeWeights:TM,encodeWeights:function(n,e){return Fe(this,void 0,void 0,(function(){var t,r,i,a,o,u=this;return Le(this,(function(c){switch(c.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map((function(h){return h.name})):Object.keys(n),a=function(h){var d=i[h],p=Array.isArray(n)?n[h].tensor:n[d];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+p.dtype);var g={name:d,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var v=new Promise((function(b){return Fe(u,void 0,void 0,(function(){var w,E,T,R,I,C,k;return Le(this,(function(L){switch(L.label){case 0:return[4,p.bytes()];case 1:for(w=L.sent(),E=w.reduce((function(O,N){return O+N.length}),0)+kg*w.length,T=new Uint8Array(E),R=0,I=0;I<w.length;I++)C=w[I],k=new Uint8Array(new Uint32Array([C.length]).buffer),T.set(k,R),R+=kg,T.set(C,R),R+=C.length;return b(T),[2]}}))}))}));r.push(v)}else r.push(p.data());e!=null&&(g.group=e),t.push(g)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:dH(c.sent()),specs:t}]}}))}))},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new F_(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new F_({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new F_({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return di.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Vd,getSaveHandlers:function(n){return di.getSaveHandlers(n)},http:Kb,isHTTPScheme:qb,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Fe(this,void 0,void 0,(function(){return Le(this,(function(i){return[2,uR((function(a){return RM(a,{requestInit:r})}))(n,e,t)]}))}))},registerLoadRouter:function(n){return di.registerLoadRouter(n)},registerSaveRouter:function(n){return di.registerSaveRouter(n)},weightsLoaderFactory:uR,withSaveHandler:function(n){return new CH(n)},copyModel:function(n,e){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){return[2,rR(n,e,!1)]}))}))},listModels:function(){return Fe(this,void 0,void 0,(function(){var n,e,t,r,i,a,o;return Le(this,(function(u){switch(u.label){case 0:n=Ds.getSchemes(),e={},t=0,r=n,u.label=1;case 1:return t<r.length?(i=r[t],[4,Ds.getManager(i).listModels()]):[3,4];case 2:for(o in a=u.sent())e[i+Nc+o]=a[o];u.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(n,e){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){return[2,rR(n,e,!0)]}))}))},removeModel:function(n){return Fe(this,void 0,void 0,(function(){var e;return Le(this,(function(t){return e=eg(n),[2,Ds.getManager(e.scheme).removeModel(e.path)]}))}))}}),sc;X({confusionMatrix_:function(n,e,t){var r=z(n,"labels","confusionMatrix"),i=z(e,"predictions","confusionMatrix");H(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),H(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),H(i.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),H(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),H(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var a=Lb(r.asType("int32"),t),o=Lb(i.asType("int32"),t);return a.transpose().matMul(o).asType("int32")}});var SH=X({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,a=!1,o=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)a=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);o=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(ek("FromPixels",Z.backendName)!=null)return Z.runKernel("FromPixels",{pixels:n},{numChannels:e});var u,c,h=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],d=h[0],p=h[1];if(o?u=n.getContext("2d").getImageData(0,0,d,p).data:r||t?u=n.data:(a||i)&&(sc==null&&(sc=document.createElement("canvas").getContext("2d")),sc.canvas.width=d,sc.canvas.height=p,sc.drawImage(n,0,0,d,p),u=sc.getImageData(0,0,d,p).data),e===4)c=new Int32Array(u);else{var g=d*p;c=new Int32Array(g*e);for(var v=0;v<g;v++)for(var b=0;b<e;++b)c[v*e+b]=u[4*v+b]}return vx(c,[p,d,e],"int32")}}),Gx=Object.freeze({toPixels:function(n,e){return Fe(this,void 0,void 0,(function(){var t,r,i,a,o,u,c,h,d,p,g,v,b,w,E,T,R,I,C,k,L,O,N;return Le(this,(function(D){switch(D.label){case 0:if(t=z(n,"img","toPixels"),n instanceof an||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],a=r[1],(o=t.rank===2?1:t.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,t.data()];case 1:return u=D.sent(),c=t.min(),h=t.max(),[4,Promise.all([c.data(),h.data()])];case 2:if(d=D.sent(),p=d[0],g=d[1],v=p[0],b=g[0],c.dispose(),h.dispose(),t.dtype==="float32"){if(v<0||b>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+v+" - "+b+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(v<0||b>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+v+" - "+b+"].")}for(w=t.dtype==="float32"?255:1,E=new Uint8ClampedArray(a*i*4),T=0;T<i*a;++T)R=void 0,I=void 0,C=void 0,k=void 0,o===1?(R=u[T]*w,I=u[T]*w,C=u[T]*w,k=255):o===3?(R=u[3*T]*w,I=u[3*T+1]*w,C=u[3*T+2]*w,k=255):o===4&&(R=u[4*T]*w,I=u[4*T+1]*w,C=u[4*T+2]*w,k=u[4*T+3]*w),E[(L=4*T)+0]=Math.round(R),E[L+1]=Math.round(I),E[L+2]=Math.round(C),E[L+3]=Math.round(k);return e!=null&&(e.width=a,e.height=i,O=e.getContext("2d"),N=new ImageData(E,a,i),O.putImageData(N,0,0)),t!==n&&t.dispose(),[2,E]}}))}))},fromPixels:SH}),AH=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),RH=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function ll(n){H(n.className!=null,(function(){return"Class being registered does not have the static className property defined."})),H(typeof n.className=="string",(function(){return"className is required to be a string, but got type "+typeof n.className})),H(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),RH.register(n)}var cl=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return fa(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var a=this.computeGradients(t,i),o=a.value,u=a.grads;if(i!=null){var c=i.map((function(h){return{name:h.name,tensor:u[h.name]}}));this.applyGradients(c)}else this.applyGradients(u);return Zr(u),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return LU(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Zr(this.iterations_)},e.prototype.saveIterations=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Re(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){return Le(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return Fe(this,void 0,void 0,(function(){var r;return Le(this,(function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}}))}))},e})(AH);Object.defineProperty(cl,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var IH=(function(n){function e(t,r,i){i===void 0&&(i=null);var a=n.call(this)||this;return a.learningRate=t,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],i==null&&(a.epsilon=Z.backend.epsilon()),a}return fa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var o=Z.registeredVariables[i];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:i+"/accum_grad",variable:Oe((function(){return St(o).variable(!1)}))}),r.accumulatedUpdates[a]==null&&(r.accumulatedUpdates[a]={originalName:i+"/accum_var",variable:Oe((function(){return St(o).variable(!1)}))});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=r.accumulatedGrads[a].variable,h=r.accumulatedUpdates[a].variable;Oe((function(){var d=c.mul(r.rho).add(u.square().mul(1-r.rho)),p=h.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(u),g=h.mul(r.rho).add(p.square().mul(1-r.rho));c.assign(d),h.assign(g);var v=p.mul(-r.learningRate).add(o);o.assign(v)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Zr(this.accumulatedGrads.map((function(t){return t.variable}))),Zr(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){var t;return Le(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){var r;return Le(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e})(cl);ll(IH);var NH=(function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return fa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var o=Z.registeredVariables[i];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:i+"/accumulator",variable:Oe((function(){return Xa(o.shape,r.initialAccumulatorValue).variable(!1)}))});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=r.accumulatedGrads[a].variable;Oe((function(){var h=c.add(u.square());c.assign(h);var d=u.div(h.add(Z.backend.epsilon()).sqrt()).mul(-r.learningRate).add(o);o.assign(d)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Zr(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){return Le(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(cl);ll(NH);var DH=(function(n){function e(t,r,i,a){a===void 0&&(a=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=i,o.epsilon=a,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Oe((function(){o.accBeta1=Re(r).variable(),o.accBeta2=Re(i).variable()})),a==null&&(o.epsilon=Z.backend.epsilon()),o}return fa(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t);Oe((function(){var a=Wn(1,r.accBeta1),o=Wn(1,r.accBeta2);i.forEach((function(u,c){var h=Z.registeredVariables[u];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:u+"/m",variable:Oe((function(){return St(h).variable(!1)}))}),r.accumulatedSecondMoment[c]==null&&(r.accumulatedSecondMoment[c]={originalName:u+"/v",variable:Oe((function(){return St(h).variable(!1)}))});var d=Array.isArray(t)?t[c].tensor:t[u];if(d!=null){var p=r.accumulatedFirstMoment[c].variable,g=r.accumulatedSecondMoment[c].variable,v=p.mul(r.beta1).add(d.mul(1-r.beta1)),b=g.mul(r.beta2).add(d.square().mul(1-r.beta2)),w=v.div(a),E=b.div(o);p.assign(v),g.assign(b);var T=w.div(E.sqrt().add(r.epsilon)).mul(-r.learningRate).add(h);h.assign(T)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Zr(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&Zr(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){var t;return Le(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){var r,i=this;return Le(this,(function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),Oe((function(){i.accBeta1.assign(Ng(i.beta1,i.iterations_+1)),i.accBeta2.assign(Ng(i.beta2,i.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(cl);ll(DH);var kH=(function(n){function e(t,r,i,a,o){a===void 0&&(a=null),o===void 0&&(o=0);var u=n.call(this)||this;return u.learningRate=t,u.beta1=r,u.beta2=i,u.epsilon=a,u.decay=o,u.accumulatedFirstMoment=[],u.accumulatedWeightedInfNorm=[],Oe((function(){u.iteration=Re(0).variable(),u.accBeta1=Re(r).variable()})),a==null&&(u.epsilon=Z.backend.epsilon()),u}return fa(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t);Oe((function(){var a=Wn(1,r.accBeta1),o=ra(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach((function(u,c){var h=Z.registeredVariables[u];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:u+"/m",variable:St(h).variable(!1)}),r.accumulatedWeightedInfNorm[c]==null&&(r.accumulatedWeightedInfNorm[c]={originalName:u+"/v",variable:St(h).variable(!1)});var d=Array.isArray(t)?t[c].tensor:t[u];if(d!=null){var p=r.accumulatedFirstMoment[c].variable,g=r.accumulatedWeightedInfNorm[c].variable,v=p.mul(r.beta1).add(d.mul(1-r.beta1)),b=g.mul(r.beta2),w=d.abs(),E=b.maximum(w);p.assign(v),g.assign(E);var T=o.div(a).mul(v.div(E.add(r.epsilon))).add(h);h.assign(T)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Zr(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&Zr(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){return Le(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(cl);ll(kH);var DM=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return fa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var o=Array.isArray(t)?t[a].tensor:t[i];if(o!=null){var u=Z.registeredVariables[i];Oe((function(){var c=r.c.mul(o).add(u);u.assign(c)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Z5(Re(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){return Le(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(cl);ll(DM);var MH=(function(n){function e(t,r,i){i===void 0&&(i=!1);var a=n.call(this,t)||this;return a.learningRate=t,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=Re(a.momentum),a}return fa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var o=Z.registeredVariables[i];r.accumulations[a]==null&&(r.accumulations[a]={originalName:i+"/momentum",variable:Oe((function(){return St(o).variable(!1)}))});var u=r.accumulations[a].variable,c=Array.isArray(t)?t[a].tensor:t[i];c!=null&&Oe((function(){var h,d=r.m.mul(u).add(c);h=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(o):r.c.mul(d).add(o),u.assign(d),o.assign(h)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Zr(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){return Le(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){return Le(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e})(DM);ll(MH);var OH=(function(n){function e(t,r,i,a,o){r===void 0&&(r=.9),i===void 0&&(i=0),a===void 0&&(a=null),o===void 0&&(o=!1);var u=n.call(this)||this;if(u.learningRate=t,u.decay=r,u.momentum=i,u.epsilon=a,u.accumulatedMeanSquares=[],u.accumulatedMoments=[],u.accumulatedMeanGrads=[],u.centered=o,a==null&&(u.epsilon=Z.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return u}return fa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var o=Z.registeredVariables[i];r.accumulatedMeanSquares[a]==null&&(r.accumulatedMeanSquares[a]={originalName:i+"/rms",variable:Oe((function(){return St(o).variable(!1)}))}),r.accumulatedMoments[a]==null&&(r.accumulatedMoments[a]={originalName:i+"/momentum",variable:Oe((function(){return St(o).variable(!1)}))}),r.accumulatedMeanGrads[a]==null&&r.centered&&(r.accumulatedMeanGrads[a]={originalName:i+"/mg",variable:Oe((function(){return St(o).variable(!1)}))});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=r.accumulatedMeanSquares[a].variable,h=r.accumulatedMoments[a].variable;Oe((function(){var d=c.mul(r.decay).add(u.square().mul(1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[a].variable,g=p.mul(r.decay).add(u.mul(1-r.decay)),v=h.mul(r.momentum).add(u.mul(r.learningRate).div(d.sub(g.square().add(r.epsilon)).sqrt()));c.assign(d),p.assign(g),h.assign(v);var b=o.sub(v);o.assign(b)}else{var w=c.mul(r.decay).add(u.square().mul(1-r.decay));v=h.mul(r.momentum).add(u.mul(r.learningRate).div(w.add(r.epsilon).sqrt())),c.assign(w),h.assign(v),b=o.sub(v),o.assign(b)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Zr(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&Zr(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&Zr(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Fe(this,void 0,void 0,(function(){var t;return Le(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Fe(this,void 0,void 0,(function(){var r;return Le(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(cl);ll(OH);an.prototype.squaredDifference=function(n){return qk(this,n)},pe=oH;var Xb=function(n,e){return Xb=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Xb(n,e)};function nt(n,e){Xb(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Er=function(){return Er=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Er.apply(this,arguments)};function ze(n,e,t,r){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function u(d){try{h(r.next(d))}catch(p){o(p)}}function c(d){try{h(r.throw(d))}catch(p){o(p)}}function h(d){d.done?a(d.value):i(d.value).then(u,c)}h((r=r.apply(n,[])).next())})}function Ge(n,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(h){return function(d){return c([h,d])}}function c(h){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(n,t)}catch(d){h=[6,d],i=0}finally{r=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function jf(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var a=arguments[e],o=0,u=a.length;o<u;o++,i++)r[i]=a[o];return r}var Mc=(function(){function n(e,t){if(!Qu(e)||!Qu(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n})();function _v(n,e){return n instanceof an&&n.shape.length===e}function PH(n){return _v(n,2)}function bv(n){return _v(n,3)}function ks(n){return _v(n,4)}function VH(n){return n%1!==0}function cR(n){return n%2===0}function FH(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function hR(n){return n&&n.width&&n.height}function LH(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Mc(Math.round(t*i),Math.round(r*i))}function Hx(n){return n.reduce(function(e,t){return e.add(t)},new Dt(0,0)).div(new Dt(n.length,n.length))}function od(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Qu(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function fR(n){return Qu(n)&&0<=n&&n<=1}var Dt=(function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n})(),Hs=(function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Qu),a=[r.x,r.y,r.width,r.height].every(Qu);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],u=o[0],c=o[1],h=o[2],d=o[3];n.assertIsValidBox({x:u,y:c,width:h,height:d},"Box.constructor",t),this._x=u,this._y=c,this._width=h,this._height=d}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Qu)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Dt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Dt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Dt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Dt(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),t=e[0],r=e[1],i=e[2],a=e[3];return new n({x:t,y:r,width:i,height:a})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),t=e[0],r=e[1],i=e[2],a=e[3];return new n({x:t,y:r,width:i,height:a})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,a=e.height,o=Math.abs(i-a);return i<a&&(t-=o/2,i+=o),a<i&&(r-=o/2,a+=o),new n({x:t,y:r,width:i,height:a})},n.prototype.rescale=function(e){var t=hR(e)?e.width:e,r=hR(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],a=r[1],o=r[2],u=r[3];return new n({x:i,y:a,width:o,height:u})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,a=r.y,o=r.right,u=r.bottom,c=Math.max(i,0),h=Math.max(a,0),d=o-c,p=u-h,g=Math.min(d,e-c),v=Math.min(p,t-h);return new n({x:c,y:h,width:g,height:v}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,a=r.height,o=this.x+e,u=this.y+t;return new n({x:o,y:u,width:i,height:a})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,a=1,o=1,u=r,c=i,h=this.left,d=this.top,p=this.right,g=this.bottom;return p>t&&(u=-p+t+r,p=t),g>e&&(c=-g+e+i,g=e),h<1&&(c=2-h,h=1),d<1&&(c=2-d,d=1),{dy:o,edy:c,dx:a,edx:u,y:d,ey:g,x:h,ex:p,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n})(),xv=(function(n){nt(e,n);function e(t,r,i,a,o){return o===void 0&&(o=!1),n.call(this,{left:t,top:r,right:i,bottom:a},o)||this}return e})(Hs),kM=(function(){function n(e,t,r,i,a){this._imageDims=new Mc(a.width,a.height),this._score=e,this._classScore=t,this._className=r,this._box=new Hs(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Hs(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n})(),io=(function(n){nt(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),a=i.score,o=i.relativeBox,u=i.imageDims;return new e(a,o,u)},e})(kM);function BH(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),a=r*i;return t?a/(n.area+e.area-a):a/Math.min(n.area,e.area)}function jH(n){var e=n.map(function(u){return u.x}),t=n.map(function(u){return u.y}),r=e.reduce(function(u,c){return c<u?c:u},1/0),i=t.reduce(function(u,c){return c<u?c:u},1/0),a=e.reduce(function(u,c){return u<c?c:u},0),o=t.reduce(function(u,c){return u<c?c:u},0);return new xv(r,i,a,o)}function sd(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(u,c){return{score:u,boxIndex:c}}).sort(function(u,c){return u.score-c.score}).map(function(u){return u.boxIndex}),a=[],o=function(){var u=i.pop();a.push(u);for(var c=i,h=[],d=0;d<c.length;d++){var p=c[d],g=n[u],v=n[p];h.push(BH(g,v,r))}i=i.filter(function(b,w){return h[w]<=t})};i.length>0;)o();return a}function Fd(n,e){return Oe(function(){var t=e[0],r=e[1],i=e[2],a=Xa(jf(n.shape.slice(0,3),[1]),t),o=Xa(jf(n.shape.slice(0,3),[1]),r),u=Xa(jf(n.shape.slice(0,3),[1]),i),c=Un([a,o,u],3);return Wn(n,c)})}function UH(n,e){return e===void 0&&(e=!1),Oe(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var a=Math.abs(r-i),o=Math.round(a*(e?.5:1)),u=r>i?2:1,c=function(v){var b=n.shape.slice();return b[u]=v,Xa(b,0)},h=c(o),d=a-h.shape[u],p=e&&d?c(d):null,g=[p,n,h].filter(function(v){return!!v}).map(function(v){return v.toFloat()});return Un(g,u)})}function L_(n){return 1/(1+Math.exp(-n))}var Wx=(function(n){nt(e,n);function e(t,r,i,a,o){return o===void 0&&(o=!1),n.call(this,{x:t,y:r,width:i,height:a},o)||this}return e})(Hs),zH=.5,GH=.43,HH=.45,Mg=(function(){function n(e,t,r){r===void 0&&(r=new Dt(0,0));var i=t.width,a=t.height;this._imgDims=new Mc(i,a),this._shift=r,this._positions=e.map(function(o){return o.mul(new Dt(i,a)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Dt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Dt(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Dt(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof io?e.box.floor():new Hs(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=i.useDlibAlignment,o=i.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(o)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],a=function(p){return i.sub(p).magnitude()},o=(a(t)+a(r))/2,u=Math.floor(o/HH),c=Hx(e),h=Math.floor(Math.max(0,c.x-zH*u)),d=Math.floor(Math.max(0,c.y-GH*u));return new Wx(h,d,Math.min(u,this.imageWidth+h),Math.min(u,this.imageHeight+d))},n.prototype.alignMinBbox=function(e){var t=jH(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n})(),WH=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Hx([t[3],t[4]])]},e})(Mg),qH=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Hx)},e})(Mg),dR=(function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+FH(this.distance)+")":"")},n})(),pR=(function(n){nt(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(Hs.assertIsValidBox(t,r),!Qu(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(Hs),Vm=(function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n})();(function(n){nt(e,n);function e(t,r,i,a){var o=n.call(this,t,r)||this;return o._score=i,o._classScore=a,o}return e.assertIsValidPredictedBox=function(t,r){if(pR.assertIsValidLabeledBox(t,r),!fR(t.score)||!fR(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(pR);function KH(n){return n.detection instanceof io}function qx(n,e){var t={detection:e};return Object.assign({},n,t)}function MM(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function OM(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,a){n.readFile(r,function(o,u){return o?a(o):i(u)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function PM(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=OM();return Er({Canvas:n||(function(){function o(){}return o})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function o(){}return o})(),Image:e||(function(){function o(){}return o})(),ImageData:global.ImageData||(function(){function o(){}return o})(),Video:global.HTMLVideoElement||(function(){function o(){}return o})(),createCanvasElement:t,createImageElement:r,fetch:i},a)}function VM(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function FM(){return typeof global=="object"&&typeof require=="function"&&typeof OP<"u"&&typeof process<"u"&&!!process.version}var Bn;function XH(){if(!Bn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Bn}function Yb(n){Bn=n}function Kx(){VM()&&Yb(MM()),FM()&&Yb(PM())}function YH(n){if(Bn||Kx(),!Bn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?Bn.Canvas:e,r=n.Image,i=r===void 0?Bn.Image:r;Bn.Canvas=t,Bn.Image=i,Bn.createCanvasElement=n.createCanvasElement||(function(){return new t}),Bn.createImageElement=n.createImageElement||(function(){return new i}),Bn.ImageData=n.ImageData||Bn.ImageData,Bn.Video=n.Video||Bn.Video,Bn.fetch=n.fetch||Bn.fetch,Bn.readFile=n.readFile||Bn.readFile}var kr={getEnv:XH,setEnv:Yb,initialize:Kx,createBrowserEnv:MM,createFileSystem:OM,createNodejsEnv:PM,monkeyPatch:YH,isBrowser:VM,isNodejs:FM};Kx();function LM(n){return!kr.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function el(n){var e=kr.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=LM(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=i.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var mR;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(mR||(mR={}));function BM(n){var e=kr.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function $H(n){return new Promise(function(e,t){if(n instanceof kr.getEnv().Canvas||BM(n))return e();function r(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",i),e(a))}function i(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",i),t(a))}n.addEventListener("load",r),n.addEventListener("error",i)})}function jM(n){var e=kr.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Mc(n.naturalWidth,n.naturalHeight):n instanceof r?new Mc(n.videoWidth,n.videoHeight):new Mc(n.width,n.height)}function wv(n){var e=n.width,t=n.height,r=kr.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function Xx(n,e){var t=kr.getEnv().ImageData;if(!(n instanceof t)&&!BM(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=jM(n),i=r.width,a=r.height,o=wv({width:i,height:a});return n instanceof t?el(o).putImageData(n,0,0):el(o).drawImage(n,0,0,i,a),o}function QH(n,e){return ze(this,void 0,void 0,function(){var t,r,i,a,o,u;return Ge(this,function(c){switch(c.label){case 0:return t=kr.getEnv().createCanvasElement(),r=n.shape.slice(ks(n)?1:0),i=r[0],a=r[1],o=r[2],u=Oe(function(){return n.as3D(i,a,o).toInt()}),[4,Gx.toPixels(u,t)];case 1:return c.sent(),u.dispose(),[2,t]}})})}function gR(n){var e=kr.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function ZH(n,e,t){t===void 0&&(t=!1);var r=kr.getEnv(),i=r.Image,a=r.Canvas;if(!(n instanceof i||n instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=jM(n),u=e/Math.max(o.height,o.width),c=u*o.width,h=u*o.height,d=wv({width:e,height:e}),p=n instanceof a?n:Xx(n),g=Math.abs(c-h)/2,v=t&&c<h?g:0,b=t&&h<c?g:0;return el(d).drawImage(p,v,b,c,h),d}var Og=(function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,a){if(bv(i)){r._imageTensors[a]=i,r._inputDimensions[a]=i.shape;return}if(ks(i)){var o=i.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");r._imageTensors[a]=i,r._inputDimensions[a]=i.shape.slice(1);return}var u=i instanceof kr.getEnv().Canvas?i:Xx(i);r._canvases[a]=u,r._inputDimensions[a]=[u.height,u.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return od(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return LH({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,Oe(function(){var i=od(r.batchSize,0,1).map(function(o){var u=r.getInput(o);if(u instanceof an){var c=ks(u)?u:u.expandDims();return c=UH(c,t),(c.shape[1]!==e||c.shape[2]!==e)&&(c=Fx.resizeBilinear(c,[e,e])),c.as3D(e,e,3)}if(u instanceof kr.getEnv().Canvas)return Gx.fromPixels(ZH(u,e,t));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+u)}),a=gi(i.map(function(o){return o.toFloat()})).as4D(r.batchSize,e,e,3);return a})},n})();function ir(n){return ze(this,void 0,void 0,function(){var e,t,r;return Ge(this,function(i){switch(i.label){case 0:if(n instanceof Og)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(a){return Array.isArray(n)?" at input index "+a+":":""},r=e.map(LM),r.forEach(function(a,o){if(!gR(a)&&!bv(a)&&!ks(a))throw typeof e[o]=="string"?new Error("toNetInput -"+t(o)+" string passed, but could not resolve HTMLElement for element id "+e[o]):new Error("toNetInput -"+t(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ks(a)){var u=a.shape[0];if(u!==1)throw new Error("toNetInput -"+t(o)+" tf.Tensor4D with batchSize "+u+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(a){return gR(a)&&$H(a)}))];case 1:return i.sent(),[2,new Og(r,Array.isArray(n))]}})})}function Yx(n,e){return ze(this,void 0,void 0,function(){var t,r,i,a,o,u,c;return Ge(this,function(h){switch(h.label){case 0:return t=kr.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,ir(n)];case 1:if(i=h.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=i.getInput(0),a instanceof t?(o=a,[3,4]):[3,2];case 2:return[4,QH(a)];case 3:o=h.sent(),h.label=4;case 4:r=o,h.label=5;case 5:return u=el(r),c=e.map(function(d){return d instanceof io?d.forSize(r.width,r.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(r.width,r.height)}),[2,c.map(function(d){var p=d.x,g=d.y,v=d.width,b=d.height,w=wv({width:v,height:b});return el(w).putImageData(u.getImageData(p,g,v,b),0,0),w})]}})})}function $x(n,e){return ze(this,void 0,void 0,function(){return Ge(this,function(t){if(!bv(n)&&!ks(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ks(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Oe(function(){var r=n.shape.slice(ks(n)?1:0),i=r[0],a=r[1],o=r[2],u=e.map(function(h){return h instanceof io?h.forSize(a,i).box:h}).map(function(h){return h.clipAtImageBorders(a,i)}),c=u.map(function(h){var d=h.x,p=h.y,g=h.width,v=h.height;return dM(n.as3D(i,a,o),[p,d,0],[v,g,o])});return c})]})})}function JH(n,e){return ze(this,void 0,void 0,function(){var t,r;return Ge(this,function(i){switch(i.label){case 0:return t=kr.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function eW(n){return ze(this,void 0,void 0,function(){return Ge(this,function(e){switch(e.label){case 0:return[4,JH(n)];case 1:return[2,e.sent().json()]}})})}function UM(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(u){return u}),a=n.endsWith(".json")?i[i.length-1]:t,o=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return o=n.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+a:o+"/"+a}}function tW(n,e){return ze(this,void 0,void 0,function(){var t,r,i,a;return Ge(this,function(o){switch(o.label){case 0:return t=UM(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,eW(r)];case 1:return a=o.sent(),[2,NM.loadWeights(a,i)]}})})}var Go=(function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,a=r.objProp;i[a].dispose(),i[a]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Gc})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Gc)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,a=pr(i.dataSync());i.dispose(),e.reassignParamFromPath(r,a)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return ze(this,void 0,void 0,function(){return Ge(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return ze(this,void 0,void 0,function(){var t;return Ge(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,tW(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return ze(this,void 0,void 0,function(){var t,r,i,a,o,u,c,h,d,p;return Ge(this,function(g){switch(g.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=kr.getEnv().readFile,r=UM(e,this.getDefaultModelName()),i=r.manifestUri,a=r.modelBaseUri,o=function(v){return Promise.all(v.map(function(b){return t(b).then(function(w){return w.buffer})}))},u=NM.weightsLoaderFactory(o),d=(h=JSON).parse,[4,t(i)];case 1:return c=d.apply(h,[g.sent().toString()]),[4,u(c,a)];case 2:return p=g.sent(),this.loadFromWeightMap(p),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(a,o){if(!a.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+e);return{obj:a.nextObj,objProp:o,nextObj:a.nextObj[o]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof an))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n})();function pi(n,e,t){return Oe(function(){var r=kx(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=ft(r,e.bias),r})}function B_(n,e,t){return t===void 0&&(t=!1),Oe(function(){var r=sn(t?ft(Gi(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):pi(n,e.conv0,[2,2])),i=pi(r,e.conv1,[1,1]),a=sn(ft(r,i)),o=pi(a,e.conv2,[1,1]);return sn(ft(r,ft(i,o)))})}function Fm(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Oe(function(){var i=sn(t?ft(Gi(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):pi(n,e.conv0,r?[2,2]:[1,1])),a=pi(i,e.conv1,[1,1]),o=sn(ft(i,a)),u=pi(o,e.conv2,[1,1]),c=sn(ft(i,ft(a,u))),h=pi(c,e.conv3,[1,1]);return sn(ft(i,ft(a,ft(u,h))))})}function ua(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),Oe(function(){var i=ft(Gi(n,e.filters,[1,1],t),e.bias);return r?sn(i):i})}function Ho(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function Ev(n,e){return function(t,r,i,a){var o=Kr(n(t*r*i*i),[i,i,t,r]),u=kn(n(r));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:u}}}function Qx(n,e){return function(t,r,i){var a=Ns(n(t*r),[t,r]),o=kn(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:o}}}var zM=(function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n})();function Zx(n,e){return function(t,r,i){var a=Kr(n(9*t),[3,3,t,1]),o=Kr(n(t*r),[1,1,t,r]),u=kn(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new zM(a,o,u)}}function Jx(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new zM(t,r,i)}}function tu(n,e){return function(t,r,i){var a=n[t];if(!_v(a,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+a);return e.push({originalPath:t,paramPath:i||t}),a}}function Wo(n){var e=n;function t(i){var a=e.slice(0,i);return e=e.slice(i),a}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function GM(n,e){var t=Ev(n,e),r=Zx(n,e);function i(o,u,c,h){h===void 0&&(h=!1);var d=h?t(o,u,3,c+"/conv0"):r(o,u,c+"/conv0"),p=r(u,u,c+"/conv1"),g=r(u,u,c+"/conv2");return{conv0:d,conv1:p,conv2:g}}function a(o,u,c,h){h===void 0&&(h=!1);var d=i(o,u,c,h),p=d.conv0,g=d.conv1,v=d.conv2,b=r(u,u,c+"/conv3");return{conv0:p,conv1:g,conv2:v,conv3:b}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function nW(n){var e=[],t=Wo(n),r=t.extractWeights,i=t.getRemainingWeights,a=GM(r,e).extractDenseBlock4Params,o=a(3,32,"dense0",!0),u=a(32,64,"dense1"),c=a(64,128,"dense2"),h=a(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:o,dense1:u,dense2:c,dense3:h}}}function HM(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function WM(n,e){var t=tu(n,e),r=HM(t),i=Jx(t);function a(u,c){c===void 0&&(c=!1);var h=c?r(u+"/conv0"):i(u+"/conv0"),d=i(u+"/conv1"),p=i(u+"/conv2");return{conv0:h,conv1:d,conv2:p}}function o(u,c){c===void 0&&(c=!1);var h=c?r(u+"/conv0"):i(u+"/conv0"),d=i(u+"/conv1"),p=i(u+"/conv2"),g=i(u+"/conv3");return{conv0:h,conv1:d,conv2:p,conv3:g}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:o}}function rW(n){var e=[],t=WM(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Ho(n,e),{params:r,paramMappings:e}}var qM=(function(n){nt(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Oe(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],o=Fd(i,a).div(Re(255)),u=Fm(o,r.dense0,!0);return u=Fm(u,r.dense1),u=Fm(u,r.dense2),u=Fm(u,r.dense3),u=Pd(u,[7,7],[2,2],"valid"),u})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return rW(t)},e.prototype.extractParams=function(t){return nW(t)},e})(Go);function za(n,e){return Oe(function(){return ft(gv(n,e.weights),e.bias)})}function iW(n,e,t){var r=[],i=Wo(n),a=i.extractWeights,o=i.getRemainingWeights,u=Qx(a,r),c=u(e,t,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:c}}}function aW(n){var e=[],t=tu(n,e);function r(a){var o=t(a+"/weights",2),u=t(a+"/bias",1);return{weights:o,bias:u}}var i={fc:r("fc")};return Ho(n,e),{params:i,paramMappings:e}}function KM(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var XM=(function(n){nt(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Oe(function(){var a=t instanceof Og?r.faceFeatureExtractor.forwardInput(t):t;return za(a.as2D(a.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,a=r.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return iW(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=KM(t),i=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),aW(a)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),a=i*r+i,o=t.slice(0,t.length-a),u=t.slice(t.length-a);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(u)},e})(Go),vR=["neutral","happy","sad","angry","fearful","disgusted","surprised"],oW=(function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);vR.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return vR.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n})(),sW=(function(n){nt(e,n);function e(t){return t===void 0&&(t=new qM),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return Oe(function(){return Uo(r.runNet(t))})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return ze(this,void 0,void 0,function(){var r,i,a,o,u=this;return Ge(this,function(c){switch(c.label){case 0:return[4,ir(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),[4,Promise.all(zn(i).map(function(h){return ze(u,void 0,void 0,function(){var d;return Ge(this,function(p){switch(p.label){case 0:return[4,h.data()];case 1:return d=p.sent(),h.dispose(),[2,d]}})})}))];case 3:return a=c.sent(),i.dispose(),o=a.map(function(h){return new oW(h)}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})(XM);function YM(n,e){var t={expressions:e};return Object.assign({},n,t)}function uW(n){return KH(n)&&n.landmarks instanceof Mg&&n.unshiftedLandmarks instanceof Mg&&n.alignedRect instanceof io}function ew(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),a=n.detection.imageDims,o=new io(n.detection.score,i.rescale(a.reverse()),a),u={landmarks:r,unshiftedLandmarks:e,alignedRect:o};return Object.assign({},n,u)}function lW(n,e){var t=Ev(n,e),r=Zx(n,e);function i(o,u,c){var h=r(o,u,c+"/separable_conv0"),d=r(u,u,c+"/separable_conv1"),p=t(o,u,1,c+"/expansion_conv");return{separable_conv0:h,separable_conv1:d,expansion_conv:p}}function a(o,u){var c=r(o,o,u+"/separable_conv0"),h=r(o,o,u+"/separable_conv1"),d=r(o,o,u+"/separable_conv2");return{separable_conv0:c,separable_conv1:h,separable_conv2:d}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:a}}function cW(n,e){var t=[],r=Wo(n),i=r.extractWeights,a=r.getRemainingWeights,o=lW(i,t),u=o.extractConvParams,c=o.extractSeparableConvParams,h=o.extractReductionBlockParams,d=o.extractMainBlockParams,p=u(3,32,3,"entry_flow/conv_in"),g=h(32,64,"entry_flow/reduction_block_0"),v=h(64,128,"entry_flow/reduction_block_1"),b={conv_in:p,reduction_block_0:g,reduction_block_1:v},w={};od(e,0,1).forEach(function(I){w["main_block_"+I]=d(128,"middle_flow/main_block_"+I)});var E=h(128,256,"exit_flow/reduction_block"),T=c(256,512,"exit_flow/separable_conv"),R={reduction_block:E,separable_conv:T};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{entry_flow:b,middle_flow:w,exit_flow:R}}}function hW(n,e){var t=tu(n,e),r=HM(t),i=Jx(t);function a(u){var c=i(u+"/separable_conv0"),h=i(u+"/separable_conv1"),d=r(u+"/expansion_conv");return{separable_conv0:c,separable_conv1:h,expansion_conv:d}}function o(u){var c=i(u+"/separable_conv0"),h=i(u+"/separable_conv1"),d=i(u+"/separable_conv2");return{separable_conv0:c,separable_conv1:h,separable_conv2:d}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:a,extractMainBlockParams:o}}function fW(n,e){var t=[],r=hW(n,t),i=r.extractConvParams,a=r.extractSeparableConvParams,o=r.extractReductionBlockParams,u=r.extractMainBlockParams,c=i("entry_flow/conv_in"),h=o("entry_flow/reduction_block_0"),d=o("entry_flow/reduction_block_1"),p={conv_in:c,reduction_block_0:h,reduction_block_1:d},g={};od(e,0,1).forEach(function(E){g["main_block_"+E]=u("middle_flow/main_block_"+E)});var v=o("exit_flow/reduction_block"),b=a("exit_flow/separable_conv"),w={reduction_block:v,separable_conv:b};return Ho(n,t),{params:{entry_flow:p,middle_flow:g,exit_flow:w},paramMappings:t}}function $M(n,e,t){return ft(Gi(n,e.filters,t,"same"),e.bias)}function j_(n,e,t){t===void 0&&(t=!0);var r=t?sn(n):n;return r=pi(r,e.separable_conv0,[1,1]),r=pi(sn(r),e.separable_conv1,[1,1]),r=Zn(r,[3,3],[2,2],"same"),r=ft(r,$M(n,e.expansion_conv,[2,2])),r}function dW(n,e){var t=pi(sn(n),e.separable_conv0,[1,1]);return t=pi(sn(t),e.separable_conv1,[1,1]),t=pi(sn(t),e.separable_conv2,[1,1]),t=ft(t,n),t}var pW=(function(n){nt(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Oe(function(){var a=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],u=Fd(a,o).div(Re(256)),c=sn($M(u,i.entry_flow.conv_in,[2,2]));return c=j_(c,i.entry_flow.reduction_block_0,!1),c=j_(c,i.entry_flow.reduction_block_1),od(r._numMainBlocks,0,1).forEach(function(h){c=dW(c,i.middle_flow["main_block_"+h])}),c=j_(c,i.exit_flow.reduction_block),c=sn(pi(c,i.exit_flow.separable_conv,[1,1])),c})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return fW(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return cW(t,this._numMainBlocks)},e})(Go);function mW(n){var e=[],t=Wo(n),r=t.extractWeights,i=t.getRemainingWeights,a=Qx(r,e),o=a(512,1,"fc/age"),u=a(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:o,gender:u}}}}function gW(n){var e=[],t=tu(n,e);function r(a){var o=t(a+"/weights",2),u=t(a+"/bias",1);return{weights:o,bias:u}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Ho(n,e),{params:i,paramMappings:e}}var Pg;(function(n){n.FEMALE="female",n.MALE="male"})(Pg||(Pg={}));var vW=(function(n){nt(e,n);function e(t){t===void 0&&(t=new pW(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Oe(function(){var a=t instanceof Og?r.faceFeatureExtractor.forwardInput(t):t,o=Pd(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),u=za(o,i.fc.age).as1D(),c=za(o,i.fc.gender);return{age:u,gender:c}})},e.prototype.forwardInput=function(t){var r=this;return Oe(function(){var i=r.runNet(t),a=i.age,o=i.gender;return{age:a,gender:Uo(o)}})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return ze(this,void 0,void 0,function(){var r,i,a,o,u,c,h=this;return Ge(this,function(d){switch(d.label){case 0:return[4,ir(t)];case 1:return r=d.sent(),[4,this.forwardInput(r)];case 2:return i=d.sent(),a=zn(i.age),o=zn(i.gender),u=a.map(function(p,g){return{ageTensor:p,genderTensor:o[g]}}),[4,Promise.all(u.map(function(p){var g=p.ageTensor,v=p.genderTensor;return ze(h,void 0,void 0,function(){var b,w,E,T,R;return Ge(this,function(I){switch(I.label){case 0:return[4,g.data()];case 1:return b=I.sent()[0],[4,v.data()];case 2:return w=I.sent()[0],E=w>.5,T=E?Pg.MALE:Pg.FEMALE,R=E?w:1-w,g.dispose(),v.dispose(),[2,{age:b,gender:T,genderProbability:R}]}})})}))];case 3:return c=d.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,a=r.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return mW(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=KM(t),i=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),gW(a)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),a=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},e})(Go),QM=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var a=i.map(function(u){var c=u.width,h=u.height,d=r/Math.max(h,c);return{width:c*d,height:h*d}}),o=a.length;return Oe(function(){var u=function(g,v){return gi([Xa([68],g),Xa([68],v)],1).as2D(1,136).as1D()},c=function(g,v){var b=a[g],w=b.width,E=b.height;return v(w,E)?Math.abs(w-E)/2:0},h=function(g){return c(g,function(v,b){return v<b})},d=function(g){return c(g,function(v,b){return b<v})},p=t.mul(Xa([o,136],r)).sub(gi(Array.from(Array(o),function(g,v){return u(h(v),d(v))}))).div(gi(Array.from(Array(o),function(g,v){return u(a[v].width,a[v].height)})));return p})},e.prototype.forwardInput=function(t){var r=this;return Oe(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(a){var o=a[0],u=a[1];return{height:o,width:u}}))})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return ze(this,void 0,void 0,function(){var r,i,a,o=this;return Ge(this,function(u){switch(u.label){case 0:return[4,ir(t)];case 1:return r=u.sent(),i=Oe(function(){return zn(o.forwardInput(r))}),[4,Promise.all(i.map(function(c,h){return ze(o,void 0,void 0,function(){var d,p,g,v,b;return Ge(this,function(w){switch(w.label){case 0:return g=(p=Array).from,[4,c.data()];case 1:return d=g.apply(p,[w.sent()]),v=d.filter(function(E,T){return cR(T)}),b=d.filter(function(E,T){return!cR(T)}),[2,new qH(Array(68).fill(0).map(function(E,T){return new Dt(v[T],b[T])}),{height:r.getInputHeight(h),width:r.getInputWidth(h)})]}})})}))];case 2:return a=u.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})(XM),ZM=(function(n){nt(e,n);function e(t){return t===void 0&&(t=new qM),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(QM);function yW(n){var e=[],t=WM(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Ho(n,e),{params:r,paramMappings:e}}function _W(n){var e=[],t=Wo(n),r=t.extractWeights,i=t.getRemainingWeights,a=GM(r,e).extractDenseBlock3Params,o=a(3,32,"dense0",!0),u=a(32,64,"dense1"),c=a(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:o,dense1:u,dense2:c}}}var bW=(function(n){nt(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Oe(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],o=Fd(i,a).div(Re(255)),u=B_(o,r.dense0,!0);return u=B_(u,r.dense1),u=B_(u,r.dense2),u=Pd(u,[14,14],[2,2],"valid"),u})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return yW(t)},e.prototype.extractParams=function(t){return _W(t)},e})(Go),xW=(function(n){nt(e,n);function e(t){return t===void 0&&(t=new bW),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(QM);(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(ZM);function wW(n,e){return ft(Nr(n,e.weights),e.biases)}function tw(n,e,t,r,i){i===void 0&&(i="same");var a=e.conv,o=a.filters,u=a.bias,c=Gi(n,o,t,i);return c=ft(c,u),c=wW(c,e.scale),r?sn(c):c}function EW(n,e){return tw(n,e,[1,1],!0)}function JM(n,e){return tw(n,e,[1,1],!1)}function e3(n,e){return tw(n,e,[2,2],!0,"valid")}function TW(n,e){function t(u,c,h){var d=n(u),p=d.length/(c*h*h);if(VH(p))throw new Error("depth has to be an integer: "+p+", weights.length: "+d.length+", numFilters: "+c+", filterSize: "+h);return Oe(function(){return Gs(Kr(d,[c,p,h,h]),[2,3,1,0])})}function r(u,c,h,d){var p=t(u,c,h),g=kn(n(c));return e.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:p,bias:g}}function i(u,c){var h=kn(n(u)),d=kn(n(u));return e.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:h,biases:d}}function a(u,c,h,d){var p=r(u,c,h,d+"/conv"),g=i(c,d+"/scale");return{conv:p,scale:g}}function o(u,c,h,d,p){p===void 0&&(p=!1);var g=a((p?.5:1)*u,c,h,d+"/conv1"),v=a(u,c,h,d+"/conv2");return{conv1:g,conv2:v}}return{extractConvLayerParams:a,extractResidualLayerParams:o}}function CW(n){var e=Wo(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],a=TW(t,i),o=a.extractConvLayerParams,u=a.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),h=u(9216,32,3,"conv32_1"),d=u(9216,32,3,"conv32_2"),p=u(9216,32,3,"conv32_3"),g=u(36864,64,3,"conv64_down",!0),v=u(36864,64,3,"conv64_1"),b=u(36864,64,3,"conv64_2"),w=u(36864,64,3,"conv64_3"),E=u(147456,128,3,"conv128_down",!0),T=u(147456,128,3,"conv128_1"),R=u(147456,128,3,"conv128_2"),I=u(589824,256,3,"conv256_down",!0),C=u(589824,256,3,"conv256_1"),k=u(589824,256,3,"conv256_2"),L=u(589824,256,3,"conv256_down_out"),O=Oe(function(){return Gs(Ns(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var N={conv32_down:c,conv32_1:h,conv32_2:d,conv32_3:p,conv64_down:g,conv64_1:v,conv64_2:b,conv64_3:w,conv128_down:E,conv128_1:T,conv128_2:R,conv256_down:I,conv256_1:C,conv256_2:k,conv256_down_out:L,fc:O};return{params:N,paramMappings:i}}function SW(n,e){var t=tu(n,e);function r(o){var u=t(o+"/scale/weights",1),c=t(o+"/scale/biases",1);return{weights:u,biases:c}}function i(o){var u=t(o+"/conv/filters",4),c=t(o+"/conv/bias",1),h=r(o);return{conv:{filters:u,bias:c},scale:h}}function a(o){return{conv1:i(o+"/conv1"),conv2:i(o+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function AW(n){var e=[],t=SW(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,a=r("conv32_down"),o=i("conv32_1"),u=i("conv32_2"),c=i("conv32_3"),h=i("conv64_down"),d=i("conv64_1"),p=i("conv64_2"),g=i("conv64_3"),v=i("conv128_down"),b=i("conv128_1"),w=i("conv128_2"),E=i("conv256_down"),T=i("conv256_1"),R=i("conv256_2"),I=i("conv256_down_out"),C=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!PH(C))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+C);var k={conv32_down:a,conv32_1:o,conv32_2:u,conv32_3:c,conv64_down:h,conv64_1:d,conv64_2:p,conv64_3:g,conv128_down:v,conv128_1:b,conv128_2:w,conv256_down:E,conv256_1:T,conv256_2:R,conv256_down_out:I,fc:C};return Ho(n,e),{params:k,paramMappings:e}}function Pa(n,e){var t=EW(n,e.conv1);return t=JM(t,e.conv2),t=ft(t,n),t=sn(t),t}function Lm(n,e){var t=e3(n,e.conv1);t=JM(t,e.conv2);var r=Pd(n,2,2,"valid"),i=$t(r.shape),a=r.shape[3]!==t.shape[3],o=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(o){var u=jf(t.shape);u[1]=1;var c=$t(u);t=Un([t,c],1);var h=jf(t.shape);h[2]=1;var d=$t(h);t=Un([t,d],2)}return r=a?Un([r,i],3):r,t=ft(r,t),t=sn(t),t}var RW=(function(n){nt(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Oe(function(){var i=t.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],o=Fd(i,a).div(Re(256)),u=e3(o,r.conv32_down);u=Zn(u,3,2,"valid"),u=Pa(u,r.conv32_1),u=Pa(u,r.conv32_2),u=Pa(u,r.conv32_3),u=Lm(u,r.conv64_down),u=Pa(u,r.conv64_1),u=Pa(u,r.conv64_2),u=Pa(u,r.conv64_3),u=Lm(u,r.conv128_down),u=Pa(u,r.conv128_1),u=Pa(u,r.conv128_2),u=Lm(u,r.conv256_down),u=Pa(u,r.conv256_1),u=Pa(u,r.conv256_2),u=Lm(u,r.conv256_down_out);var c=u.mean([1,2]),h=gv(c,r.fc);return h})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return ze(this,void 0,void 0,function(){var r,i,a,o=this;return Ge(this,function(u){switch(u.label){case 0:return[4,ir(t)];case 1:return r=u.sent(),i=Oe(function(){return zn(o.forwardInput(r))}),[4,Promise.all(i.map(function(c){return c.data()}))];case 2:return a=u.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return AW(t)},e.prototype.extractParams=function(t){return CW(t)},e})(Go);function t3(n,e){var t={descriptor:e};return Object.assign({},n,t)}function n3(n,e){var t={age:e};return Object.assign({},n,t)}function r3(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var i3=(function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,a=t.maxNumScales,o=t.scoreThresholds,u=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=a||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=u,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n})();function IW(n,e){function t(c,h){var d=Kr(n(9*c),[3,3,c,1]),p=kn(n(c)),g=kn(n(c)),v=kn(n(c)),b=kn(n(c));return e.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:d,batch_norm_scale:p,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:b}}function r(c,h,d,p,g){var v=Kr(n(c*h*d*d),[d,d,c,h]),b=kn(n(h));return e.push({paramPath:p+"/filters"},{paramPath:p+"/"+(g?"batch_norm_offset":"bias")}),{filters:v,bias:b}}function i(c,h,d,p){var g=r(c,h,d,p,!0),v=g.filters,b=g.bias;return{filters:v,batch_norm_offset:b}}function a(c,h,d){var p=t(c,d+"/depthwise_conv"),g=i(c,h,1,d+"/pointwise_conv");return{depthwise_conv:p,pointwise_conv:g}}function o(){var c=i(3,32,3,"mobilenetv1/conv_0"),h=a(32,64,"mobilenetv1/conv_1"),d=a(64,128,"mobilenetv1/conv_2"),p=a(128,128,"mobilenetv1/conv_3"),g=a(128,256,"mobilenetv1/conv_4"),v=a(256,256,"mobilenetv1/conv_5"),b=a(256,512,"mobilenetv1/conv_6"),w=a(512,512,"mobilenetv1/conv_7"),E=a(512,512,"mobilenetv1/conv_8"),T=a(512,512,"mobilenetv1/conv_9"),R=a(512,512,"mobilenetv1/conv_10"),I=a(512,512,"mobilenetv1/conv_11"),C=a(512,1024,"mobilenetv1/conv_12"),k=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:h,conv_2:d,conv_3:p,conv_4:g,conv_5:v,conv_6:b,conv_7:w,conv_8:E,conv_9:T,conv_10:R,conv_11:I,conv_12:C,conv_13:k}}function u(){var c=i(1024,256,1,"prediction_layer/conv_0"),h=i(256,512,3,"prediction_layer/conv_1"),d=i(512,128,1,"prediction_layer/conv_2"),p=i(128,256,3,"prediction_layer/conv_3"),g=i(256,128,1,"prediction_layer/conv_4"),v=i(128,256,3,"prediction_layer/conv_5"),b=i(256,64,1,"prediction_layer/conv_6"),w=i(64,128,3,"prediction_layer/conv_7"),E=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),T=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),R=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),I=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),C=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),L=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),O=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),N=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),D=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),P=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),F=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),j={box_encoding_predictor:E,class_predictor:T},B={box_encoding_predictor:R,class_predictor:I},J={box_encoding_predictor:C,class_predictor:k},ne={box_encoding_predictor:L,class_predictor:O},q={box_encoding_predictor:N,class_predictor:D},Y={box_encoding_predictor:P,class_predictor:F};return{conv_0:c,conv_1:h,conv_2:d,conv_3:p,conv_4:g,conv_5:v,conv_6:b,conv_7:w,box_predictor_0:j,box_predictor_1:B,box_predictor_2:J,box_predictor_3:ne,box_predictor_4:q,box_predictor_5:Y}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function NW(n){var e=[],t=Wo(n),r=t.extractWeights,i=t.getRemainingWeights,a=IW(r,e),o=a.extractMobilenetV1Params,u=a.extractPredictionLayerParams,c=o(),h=u(),d=vx(r(5118*4),[1,5118,4]),p={extra_dim:d};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:h,output_layer:p},paramMappings:e}}function DW(n,e){var t=tu(n,e);function r(h,d,p){var g=t(h+"/Conv2d_"+d+"_pointwise/weights",4,p+"/filters"),v=t(h+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,p+"/batch_norm_offset");return{filters:g,batch_norm_offset:v}}function i(h){var d="mobilenetv1/conv_"+h,p="MobilenetV1/Conv2d_"+h+"_depthwise",g=d+"/depthwise_conv",v=d+"/pointwise_conv",b=t(p+"/depthwise_weights",4,g+"/filters"),w=t(p+"/BatchNorm/gamma",1,g+"/batch_norm_scale"),E=t(p+"/BatchNorm/beta",1,g+"/batch_norm_offset"),T=t(p+"/BatchNorm/moving_mean",1,g+"/batch_norm_mean"),R=t(p+"/BatchNorm/moving_variance",1,g+"/batch_norm_variance");return{depthwise_conv:{filters:b,batch_norm_scale:w,batch_norm_offset:E,batch_norm_mean:T,batch_norm_variance:R},pointwise_conv:r("MobilenetV1",h,v)}}function a(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function o(h,d){var p=t(h+"/weights",4,d+"/filters"),g=t(h+"/biases",1,d+"/bias");return{filters:p,bias:g}}function u(h){var d=o("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),p=o("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:d,class_predictor:p}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:u(0),box_predictor_1:u(1),box_predictor_2:u(2),box_predictor_3:u(3),box_predictor_4:u(4),box_predictor_5:u(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:c}}function kW(n){var e=[],t=DW(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,a=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!bv(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var o={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:a}};return Ho(n,e),{params:o,paramMappings:e}}function Va(n,e,t){return Oe(function(){var r=Gi(n,e.filters,t,"same");return r=ft(r,e.batch_norm_offset),Rx(r,0,6)})}var MW=.0010000000474974513;function OW(n,e,t){return Oe(function(){var r=mv(n,e.filters,t,"same");return r=Zk(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,MW),Rx(r,0,6)})}function PW(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function VW(n,e){return Oe(function(){var t=null,r=Va(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(a,o){var u=o+1,c=PW(u);r=OW(r,a.depthwise_conv,c),r=Va(r,a.pointwise_conv,[1,1]),u===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function FW(n,e,t,r,i){var a=n.shape[0],o=Math.min(t,a),u=e.map(function(d,p){return{score:d,boxIndex:p}}).filter(function(d){return d.score>i}).sort(function(d,p){return p.score-d.score}),c=function(d){return d<=r?1:0},h=[];return u.forEach(function(d){if(!(h.length>=o)){for(var p=d.score,g=h.length-1;g>=0;--g){var v=LW(n,d.boxIndex,h[g]);if(v!==0&&(d.score*=c(v),d.score<=i))break}p===d.score&&h.push(d.boxIndex)}}),h}function LW(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),a=Math.min(r[e][1],r[e][3]),o=Math.max(r[e][0],r[e][2]),u=Math.max(r[e][1],r[e][3]),c=Math.min(r[t][0],r[t][2]),h=Math.min(r[t][1],r[t][3]),d=Math.max(r[t][0],r[t][2]),p=Math.max(r[t][1],r[t][3]),g=(o-i)*(u-a),v=(d-c)*(p-h);if(g<=0||v<=0)return 0;var b=Math.max(i,c),w=Math.max(a,h),E=Math.min(o,d),T=Math.min(u,p),R=Math.max(E-b,0)*Math.max(T-w,0);return R/(g+v-R)}function BW(n){var e=zn(Gs(n,[1,0])),t=[Wn(e[2],e[0]),Wn(e[3],e[1])],r=[ft(e[0],ra(t[0],Re(2))),ft(e[1],ra(t[1],Re(2)))];return{sizes:t,centers:r}}function jW(n,e){var t=BW(n),r=t.sizes,i=t.centers,a=zn(Gs(e,[1,0])),o=ra(Nr(zb(ra(a[2],Re(5))),r[0]),Re(2)),u=ft(Nr(ra(a[0],Re(10)),r[0]),i[0]),c=ra(Nr(zb(ra(a[3],Re(5))),r[1]),Re(2)),h=ft(Nr(ra(a[1],Re(10)),r[1]),i[1]);return Gs(gi([Wn(u,o),Wn(h,c),ft(u,o),ft(h,c)]),[1,0])}function UW(n,e,t){return Oe(function(){var r=n.shape[0],i=jW(aa(Rc(t.extra_dim,[r,1,1]),[-1,4]),aa(n,[-1,4]));i=aa(i,[r,i.shape[0]/r,4]);var a=Xk(Ja(e,[0,0,1],[-1,-1,-1])),o=Ja(a,[0,0,0],[-1,-1,1]);o=aa(o,[r,o.shape[1]]);var u=zn(i),c=zn(o);return{boxes:u,scores:c}})}function uc(n,e){return Oe(function(){var t=n.shape[0],r=aa(ua(n,e.box_encoding_predictor),[t,-1,1,4]),i=aa(ua(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function zW(n,e,t){return Oe(function(){var r=Va(n,t.conv_0,[1,1]),i=Va(r,t.conv_1,[2,2]),a=Va(i,t.conv_2,[1,1]),o=Va(a,t.conv_3,[2,2]),u=Va(o,t.conv_4,[1,1]),c=Va(u,t.conv_5,[2,2]),h=Va(c,t.conv_6,[1,1]),d=Va(h,t.conv_7,[2,2]),p=uc(e,t.box_predictor_0),g=uc(n,t.box_predictor_1),v=uc(i,t.box_predictor_2),b=uc(o,t.box_predictor_3),w=uc(c,t.box_predictor_4),E=uc(d,t.box_predictor_5),T=Un([p.boxPredictionEncoding,g.boxPredictionEncoding,v.boxPredictionEncoding,b.boxPredictionEncoding,w.boxPredictionEncoding,E.boxPredictionEncoding],1),R=Un([p.classPrediction,g.classPrediction,v.classPrediction,b.classPrediction,w.classPrediction,E.classPrediction],1);return{boxPredictions:T,classPredictions:R}})}var Tv=(function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n})(),a3=(function(n){nt(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Oe(function(){var i=t.toBatchTensor(512,!1).toFloat(),a=Wn(Nr(i,Re(.007843137718737125)),Re(1)),o=VW(a,r.mobilenetv1),u=zW(o.out,o.conv11,r.prediction_layer),c=u.boxPredictions,h=u.classPredictions;return UW(c,h,r.output_layer)})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return Ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i,a,o,u,c,h,d,p,g,v,b,w,E,T,R,I,C,k,L,O,N;return Ge(this,function(D){switch(D.label){case 0:return i=new Tv(r),a=i.maxResults,o=i.minConfidence,[4,ir(t)];case 1:for(u=D.sent(),c=this.forwardInput(u),h=c.boxes,d=c.scores,p=h[0],g=d[0],v=1;v<h.length;v++)h[v].dispose(),d[v].dispose();return E=(w=Array).from,[4,g.data()];case 2:return b=E.apply(w,[D.sent()]),T=.5,R=FW(p,b,a,T,o),I=u.getReshapedInputDimensions(0),C=u.inputSize,k=C/I.width,L=C/I.height,O=p.arraySync(),N=R.map(function(P){var F=[Math.max(0,O[P][0]),Math.min(1,O[P][2])].map(function(Y){return Y*L}),j=F[0],B=F[1],J=[Math.max(0,O[P][1]),Math.min(1,O[P][3])].map(function(Y){return Y*k}),ne=J[0],q=J[1];return new io(b[P],new Wx(ne,j,q-ne,B-j),{height:u.getInputHeight(0),width:u.getInputWidth(0)})}),p.dispose(),g.dispose(),[2,N]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return kW(t)},e.prototype.extractParams=function(t){return NW(t)},e})(Go);(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(a3);var GW=.4,HW=[new Dt(.738768,.874946),new Dt(2.42204,2.65704),new Dt(4.30971,7.04493),new Dt(10.246,4.59428),new Dt(12.6868,11.8741)],WW=[new Dt(1.603231,2.094468),new Dt(6.041143,7.080126),new Dt(2.882459,3.518061),new Dt(4.266906,5.178857),new Dt(9.041765,10.66308)],qW=[117.001,114.697,97.404],KW="tiny_yolov2_model",XW="tiny_yolov2_separable_conv_model",Bm=function(n){return typeof n=="number"};function YW(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Bm(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return Bm(e.x)&&Bm(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(Bm)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function nw(n){return Oe(function(){var e=Nr(n,Re(.10000000149011612));return ft(sn(Wn(n,e)),e)})}function Ts(n,e){return Oe(function(){var t=sl(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Gi(t,e.conv.filters,[1,1],"valid"),t=Wn(t,e.bn.sub),t=Nr(t,e.bn.truediv),t=ft(t,e.conv.bias),nw(t)})}function Cs(n,e){return Oe(function(){var t=sl(n,[[0,0],[1,1],[1,1],[0,0]]);return t=kx(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=ft(t,e.bias),nw(t)})}function $W(n,e){var t=Ev(n,e);function r(o,u){var c=kn(n(o)),h=kn(n(o));return e.push({paramPath:u+"/sub"},{paramPath:u+"/truediv"}),{sub:c,truediv:h}}function i(o,u,c){var h=t(o,u,3,c+"/conv"),d=r(u,c+"/bn");return{conv:h,bn:d}}var a=Zx(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function QW(n,e,t,r){var i=Wo(n),a=i.extractWeights,o=i.getRemainingWeights,u=[],c=$W(a,u),h=c.extractConvParams,d=c.extractConvWithBatchNormParams,p=c.extractSeparableConvParams,g;if(e.withSeparableConvs){var v=r[0],b=r[1],w=r[2],E=r[3],T=r[4],R=r[5],I=r[6],C=r[7],k=r[8],L=e.isFirstLayerConv2d?h(v,b,3,"conv0"):p(v,b,"conv0"),O=p(b,w,"conv1"),N=p(w,E,"conv2"),D=p(E,T,"conv3"),P=p(T,R,"conv4"),F=p(R,I,"conv5"),j=C?p(I,C,"conv6"):void 0,B=k?p(C,k,"conv7"):void 0,J=h(k||C||I,5*t,1,"conv8");g={conv0:L,conv1:O,conv2:N,conv3:D,conv4:P,conv5:F,conv6:j,conv7:B,conv8:J}}else{var v=r[0],b=r[1],w=r[2],E=r[3],T=r[4],R=r[5],I=r[6],C=r[7],k=r[8],L=d(v,b,"conv0"),O=d(b,w,"conv1"),N=d(w,E,"conv2"),D=d(E,T,"conv3"),P=d(T,R,"conv4"),F=d(R,I,"conv5"),j=d(I,C,"conv6"),B=d(C,k,"conv7"),J=h(k,5*t,1,"conv8");g={conv0:L,conv1:O,conv2:N,conv3:D,conv4:P,conv5:F,conv6:j,conv7:B,conv8:J}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:g,paramMappings:u}}function ZW(n,e){var t=tu(n,e);function r(u){var c=t(u+"/sub",1),h=t(u+"/truediv",1);return{sub:c,truediv:h}}function i(u){var c=t(u+"/filters",4),h=t(u+"/bias",1);return{filters:c,bias:h}}function a(u){var c=i(u+"/conv"),h=r(u+"/bn");return{conv:c,bn:h}}var o=Jx(t);return{extractConvParams:i,extractConvWithBatchNormParams:a,extractSeparableConvParams:o}}function JW(n,e){var t=[],r=ZW(n,t),i=r.extractConvParams,a=r.extractConvWithBatchNormParams,o=r.extractSeparableConvParams,u;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;u={conv0:e.isFirstLayerConv2d?i("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:c>7?o("conv6"):void 0,conv7:c>8?o("conv7"):void 0,conv8:i("conv8")}}else u={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return Ho(n,t),{params:u,paramMappings:t}}var yR;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(yR||(yR={}));var rw=(function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n})(),o3=(function(n){nt(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return YW(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Ts(t,r.conv0);return i=Zn(i,[2,2],[2,2],"same"),i=Ts(i,r.conv1),i=Zn(i,[2,2],[2,2],"same"),i=Ts(i,r.conv2),i=Zn(i,[2,2],[2,2],"same"),i=Ts(i,r.conv3),i=Zn(i,[2,2],[2,2],"same"),i=Ts(i,r.conv4),i=Zn(i,[2,2],[2,2],"same"),i=Ts(i,r.conv5),i=Zn(i,[2,2],[1,1],"same"),i=Ts(i,r.conv6),i=Ts(i,r.conv7),ua(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?nw(ua(t,r.conv0,"valid",!1)):Cs(t,r.conv0);return i=Zn(i,[2,2],[2,2],"same"),i=Cs(i,r.conv1),i=Zn(i,[2,2],[2,2],"same"),i=Cs(i,r.conv2),i=Zn(i,[2,2],[2,2],"same"),i=Cs(i,r.conv3),i=Zn(i,[2,2],[2,2],"same"),i=Cs(i,r.conv4),i=Zn(i,[2,2],[2,2],"same"),i=Cs(i,r.conv5),i=Zn(i,[2,2],[1,1],"same"),i=r.conv6?Cs(i,r.conv6):i,i=r.conv7?Cs(i,r.conv7):i,ua(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return Oe(function(){var o=t.toBatchTensor(r,!1).toFloat();return o=i.config.meanRgb?Fd(o,i.config.meanRgb):o,o=o.div(Re(256)),i.config.withSeparableConvs?i.runMobilenet(o,a):i.runTinyYolov2(o,a)})},e.prototype.forward=function(t,r){return ze(this,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,ir(t)];case 1:return[4,i.apply(this,[a.sent(),r])];case 2:return[2,a.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i,a,o,u,c,h,d,p,g,v,b,w,E,T,R=this;return Ge(this,function(I){switch(I.label){case 0:return i=new rw(r),a=i.inputSize,o=i.scoreThreshold,[4,ir(t)];case 1:return u=I.sent(),[4,this.forwardInput(u,a)];case 2:return c=I.sent(),h=Oe(function(){return zn(c)[0].expandDims()}),d={width:u.getInputWidth(0),height:u.getInputHeight(0)},[4,this.extractBoxes(h,u.getReshapedInputDimensions(0),o)];case 3:return p=I.sent(),c.dispose(),h.dispose(),g=p.map(function(C){return C.box}),v=p.map(function(C){return C.score}),b=p.map(function(C){return C.classScore}),w=p.map(function(C){return R.config.classes[C.label]}),E=sd(g.map(function(C){return C.rescale(a)}),v,this.config.iouThreshold,!0),T=E.map(function(C){return new kM(v[C],b[C],w[C],g[C],d)}),[2,T]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return JW(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return QW(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return ze(this,void 0,void 0,function(){var a,o,u,c,h,d,p,g,v,b,w,E,T,R,I,C,k,L,O,N,D,P,F,j,B,J,ne,q,Y,ee=this;return Ge(this,function(ue){switch(ue.label){case 0:return a=r.width,o=r.height,u=Math.max(a,o),c=u/a,h=u/o,d=t.shape[1],p=this.config.anchors.length,g=Oe(function(){var fe=t.reshape([d,d,p,ee.boxEncodingSize]),W=fe.slice([0,0,0,0],[d,d,p,4]),Q=fe.slice([0,0,0,4],[d,d,p,1]),ce=ee.withClassScores?Uo(fe.slice([0,0,0,5],[d,d,p,ee.config.classes.length]),3):Re(0);return[W,Q,ce]}),v=g[0],b=g[1],w=g[2],E=[],[4,b.array()];case 1:return T=ue.sent(),[4,v.array()];case 2:R=ue.sent(),I=0,ue.label=3;case 3:if(!(I<d))return[3,12];C=0,ue.label=4;case 4:if(!(C<d))return[3,11];k=0,ue.label=5;case 5:return k<p?(L=L_(T[I][C][k][0]),!i||L>i?(O=(C+L_(R[I][C][k][0]))/d*c,N=(I+L_(R[I][C][k][1]))/d*h,D=Math.exp(R[I][C][k][2])*this.config.anchors[k].x/d*c,P=Math.exp(R[I][C][k][3])*this.config.anchors[k].y/d*h,F=O-D/2,j=N-P/2,B={row:I,col:C,anchor:k},this.withClassScores?[4,this.extractPredictedClass(w,B)]:[3,7]):[3,9]):[3,10];case 6:return Y=ue.sent(),[3,8];case 7:Y={classScore:1,label:0},ue.label=8;case 8:J=Y,ne=J.classScore,q=J.label,E.push(Er({box:new xv(F,j,F+D,j+P),score:L,classScore:L*ne,label:q},B)),ue.label=9;case 9:return k++,[3,5];case 10:return C++,[3,4];case 11:return I++,[3,3];case 12:return v.dispose(),b.dispose(),w.dispose(),[2,E]}})})},e.prototype.extractPredictedClass=function(t,r){return ze(this,void 0,void 0,function(){var i,a,o,u;return Ge(this,function(c){switch(c.label){case 0:return i=r.row,a=r.col,o=r.anchor,[4,t.array()];case 1:return u=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(h,d){return u[i][a][o][d]}).map(function(h,d){return{classScore:h,label:d}}).reduce(function(h,d){return h.classScore>d.classScore?h:d})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(Go),eq=(function(n){nt(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:GW,classes:["face"]},t?{anchors:WW,meanRgb:qW}:{anchors:HW,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ze(this,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return[4,this.detect(t,r)];case 1:return i=a.sent(),[2,i.map(function(o){return new io(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?XW:KW},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(o3),s3=(function(n){nt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(rw),Ld=(function(){function n(){}return n.prototype.then=function(e){return ze(this,void 0,void 0,function(){var t;return Ge(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return ze(this,void 0,void 0,function(){return Ge(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n})();function Cv(n,e,t,r,i){return i===void 0&&(i=function(a){var o=a.alignedRect;return o}),ze(this,void 0,void 0,function(){var a,o,u,c,h;return Ge(this,function(d){switch(d.label){case 0:return a=n.map(function(p){return uW(p)?i(p):p.detection}),u=r,u?[3,5]:e instanceof an?[4,$x(e,a)]:[3,2];case 1:return c=d.sent(),[3,4];case 2:return[4,Yx(e,a)];case 3:c=d.sent(),d.label=4;case 4:u=c,d.label=5;case 5:return o=u,[4,t(o)];case 6:return h=d.sent(),o.forEach(function(p){return p instanceof an&&p.dispose()}),[2,h]}})})}function iw(n,e,t,r,i){return ze(this,void 0,void 0,function(){var a=this;return Ge(this,function(o){return[2,Cv([n],e,function(u){return ze(a,void 0,void 0,function(){return Ge(this,function(c){return[2,t(u[0])]})})},r,i)]})})}function tq(n){return Oe(function(){return gi(zn(n,3).reverse(),3)})}var jm=2,Vg=12;function nq(n,e){var t=Ev(n,e),r=Qx(n,e);function i(h,d){var p=kn(n(h));return e.push({paramPath:d}),p}function a(h,d,p){p===void 0&&(p=!1);var g=t(h[0],h[1],3,d+"/conv1"),v=i(h[1],d+"/prelu1_alpha"),b=t(h[1],h[2],3,d+"/conv2"),w=i(h[2],d+"/prelu2_alpha"),E=t(h[2],h[3],p?2:3,d+"/conv3"),T=i(h[3],d+"/prelu3_alpha");return{conv1:g,prelu1_alpha:v,conv2:b,prelu2_alpha:w,conv3:E,prelu3_alpha:T}}function o(){var h=a([3,10,16,32],"pnet"),d=t(32,2,1,"pnet/conv4_1"),p=t(32,4,1,"pnet/conv4_2");return Er(Er({},h),{conv4_1:d,conv4_2:p})}function u(){var h=a([3,28,48,64],"rnet",!0),d=r(576,128,"rnet/fc1"),p=i(128,"rnet/prelu4_alpha"),g=r(128,2,"rnet/fc2_1"),v=r(128,4,"rnet/fc2_2");return Er(Er({},h),{fc1:d,prelu4_alpha:p,fc2_1:g,fc2_2:v})}function c(){var h=a([3,32,64,64],"onet"),d=t(64,128,2,"onet/conv4"),p=i(128,"onet/prelu4_alpha"),g=r(1152,256,"onet/fc1"),v=i(256,"onet/prelu5_alpha"),b=r(256,2,"onet/fc2_1"),w=r(256,4,"onet/fc2_2"),E=r(256,10,"onet/fc2_3");return Er(Er({},h),{conv4:d,prelu4_alpha:p,fc1:g,prelu5_alpha:v,fc2_1:b,fc2_2:w,fc2_3:E})}return{extractPNetParams:o,extractRNetParams:u,extractONetParams:c}}function rq(n){var e=Wo(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],a=nq(t,i),o=a.extractPNetParams,u=a.extractRNetParams,c=a.extractONetParams,h=o(),d=u(),p=c();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:h,rnet:d,onet:p},paramMappings:i}}function iq(n,e){var t=tu(n,e);function r(d){var p=t(d+"/weights",4,d+"/filters"),g=t(d+"/bias",1);return{filters:p,bias:g}}function i(d){var p=t(d+"/weights",2),g=t(d+"/bias",1);return{weights:p,bias:g}}function a(d){return t(d,1)}function o(d){var p=r(d+"/conv1"),g=a(d+"/prelu1_alpha"),v=r(d+"/conv2"),b=a(d+"/prelu2_alpha"),w=r(d+"/conv3"),E=a(d+"/prelu3_alpha");return{conv1:p,prelu1_alpha:g,conv2:v,prelu2_alpha:b,conv3:w,prelu3_alpha:E}}function u(){var d=o("pnet"),p=r("pnet/conv4_1"),g=r("pnet/conv4_2");return Er(Er({},d),{conv4_1:p,conv4_2:g})}function c(){var d=o("rnet"),p=i("rnet/fc1"),g=a("rnet/prelu4_alpha"),v=i("rnet/fc2_1"),b=i("rnet/fc2_2");return Er(Er({},d),{fc1:p,prelu4_alpha:g,fc2_1:v,fc2_2:b})}function h(){var d=o("onet"),p=r("onet/conv4"),g=a("onet/prelu4_alpha"),v=i("onet/fc1"),b=a("onet/prelu5_alpha"),w=i("onet/fc2_1"),E=i("onet/fc2_2"),T=i("onet/fc2_3");return Er(Er({},d),{conv4:p,prelu4_alpha:g,fc1:v,prelu5_alpha:b,fc2_1:w,fc2_2:E,fc2_3:T})}return{extractPNetParams:u,extractRNetParams:c,extractONetParams:h}}function aq(n){var e=[],t=iq(n,e),r=t.extractPNetParams,i=t.extractRNetParams,a=t.extractONetParams,o=r(),u=i(),c=a();return Ho(n,e),{params:{pnet:o,rnet:u,onet:c},paramMappings:e}}function $b(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function oq(n,e,t){for(var r=t[0],i=t[1],a=Vg/n,o=[],u=Math.min(r,i)*a,c=0;u>=12;)o.push(a*Math.pow(e,c)),u=u*e,c+=1;return o}var aw=(function(n){nt(e,n);function e(t,r,i,a){return n.call(this,{left:t,top:r,right:i,bottom:a},!0)||this}return e})(Hs);function u3(n){return Oe(function(){return Nr(Wn(n,Re(127.5)),Re(.0078125))})}function Oc(n,e){return Oe(function(){return ft(sn(n),Nr(e,Ig(sn(Ig(n)))))})}function ow(n,e,t){return t===void 0&&(t=!1),Oe(function(){var r=ua(n,e.conv1,"valid");return r=Oc(r,e.prelu1_alpha),r=Zn(r,t?[2,2]:[3,3],[2,2],"same"),r=ua(r,e.conv2,"valid"),r=Oc(r,e.prelu2_alpha),r=t?r:Zn(r,[3,3],[2,2],"valid"),r=ua(r,e.conv3,"valid"),r=Oc(r,e.prelu3_alpha),r})}function sq(n,e){return Oe(function(){var t=ow(n,e,!0),r=ua(t,e.conv4_1,"valid"),i=Oi(vv(r,3),3),a=Uo(Wn(r,i),3),o=ua(t,e.conv4_2,"valid");return{prob:a,regions:o}})}function uq(n,e){return Oe(function(){var t=$b(e,n.shape.slice(1)),r=t.height,i=t.width,a=Fx.resizeBilinear(n,[r,i]),o=u3(a);return Gs(o,[0,2,1,3])})}function lq(n,e,t,r){for(var i=[],a=n.arraySync(),o=0;o<n.shape[0];o++)for(var u=0;u<n.shape[1];u++)a[o][u]>=r&&i.push(new Dt(u,o));var c=i.map(function(h){var d=new xv(Math.round((h.y*jm+1)/t),Math.round((h.x*jm+1)/t),Math.round((h.y*jm+Vg)/t),Math.round((h.x*jm+Vg)/t)),p=a[h.y][h.x],g=e.arraySync(),v=new aw(g[h.y][h.x][0],g[h.y][h.x][1],g[h.y][h.x][2],g[h.y][h.x][3]);return{cell:d,score:p,region:v}});return c}function cq(n,e,t,r,i){i.stage1=[];var a=e.map(function(g){return Oe(function(){var v={scale:g},b=uq(n,g),w=Date.now(),E=sq(b,r),T=E.prob,R=E.regions;v.pnet=Date.now()-w;var I=zn(zn(T,3)[1])[0],C=zn(R)[0];return{scoresTensor:I,regionsTensor:C,scale:g,statsForScale:v}})}),o=a.map(function(g){var v=g.scoresTensor,b=g.regionsTensor,w=g.scale,E=g.statsForScale,T=lq(v,b,w,t);if(v.dispose(),b.dispose(),!T.length)return i.stage1.push(E),[];var R=Date.now(),I=sd(T.map(function(C){return C.cell}),T.map(function(C){return C.score}),.5);return E.nms=Date.now()-R,E.numBoxes=I.length,i.stage1.push(E),I.map(function(C){return T[C]})}),u=o.reduce(function(g,v){return g.concat(v)},[]),c=[],h=[];if(u.length>0){var d=Date.now(),p=sd(u.map(function(g){return g.cell}),u.map(function(g){return g.score}),.7);i.stage1_nms=Date.now()-d,h=p.map(function(g){return u[g].score}),c=p.map(function(g){return u[g]}).map(function(g){var v=g.cell,b=g.region;return new xv(v.left+b.left*v.width,v.top+b.top*v.height,v.right+b.right*v.width,v.bottom+b.bottom*v.height).toSquare().round()})}return{boxes:c,scores:h}}function l3(n,e,t){var r=t.width,i=t.height;return ze(this,void 0,void 0,function(){var a,o,u,c=this;return Ge(this,function(h){switch(h.label){case 0:return a=el(n),[4,Promise.all(e.map(function(d){return ze(c,void 0,void 0,function(){var p,g,v,b,w,E,T,R;return Ge(this,function(I){return p=d.padAtBorders(n.height,n.width),g=p.y,v=p.ey,b=p.x,w=p.ex,E=b-1,T=g-1,R=a.getImageData(E,T,w-E,v-T),[2,kr.isNodejs()?Xx(R):createImageBitmap(R)]})})}))];case 1:return o=h.sent(),u=[],o.forEach(function(d){var p=wv({width:r,height:i}),g=el(p);g.drawImage(d,0,0,r,i);for(var v=g.getImageData(0,0,r,i).data,b=[],w=0;w<v.length;w+=4)b.push(v[w+2]),b.push(v[w+1]),b.push(v[w]);u.push(b)}),[2,u.map(function(d){var p=Oe(function(){var g=Gs(Kr(d,[1,r,i,3]),[0,2,1,3]).toFloat();return u3(g)});return p})]}})})}function hq(n,e){return Oe(function(){var t=ow(n,e),r=aa(t,[t.shape[0],e.fc1.weights.shape[0]]),i=za(r,e.fc1),a=Oc(i,e.prelu4_alpha),o=za(a,e.fc2_1),u=Oi(vv(o,1),1),c=Uo(Wn(o,u),1),h=za(a,e.fc2_2),d=zn(c,1)[1];return{scores:d,regions:h}})}function fq(n,e,t,r,i){return ze(this,void 0,void 0,function(){var a,o,u,c,h,d,p,g,v,b,w,E,T,R;return Ge(this,function(I){switch(I.label){case 0:return a=Date.now(),[4,l3(n,e,{width:24,height:24})];case 1:return o=I.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),u=o.map(function(C){var k=hq(C,r);return C.dispose(),k}),i.stage2_rnet=Date.now()-a,c=u.length>1?Un(u.map(function(C){return C.scores})):u[0].scores,p=(d=Array).from,[4,c.data()];case 2:return h=p.apply(d,[I.sent()]),c.dispose(),g=h.map(function(C,k){return{score:C,idx:k}}).filter(function(C){return C.score>t}).map(function(C){var k=C.idx;return k}),v=g.map(function(C){return e[C]}),b=g.map(function(C){return h[C]}),w=[],E=[],v.length>0&&(a=Date.now(),T=sd(v,b,.7),i.stage2_nms=Date.now()-a,R=T.map(function(C){var k=u[g[C]].regions.arraySync();return new aw(k[0][0],k[0][1],k[0][2],k[0][3])}),E=T.map(function(C){return b[C]}),w=T.map(function(C,k){return v[C].calibrate(R[k])})),u.forEach(function(C){C.regions.dispose(),C.scores.dispose()}),[2,{boxes:w,scores:E}]}})})}function dq(n,e){return Oe(function(){var t=ow(n,e);t=Zn(t,[2,2],[2,2],"same"),t=ua(t,e.conv4,"valid"),t=Oc(t,e.prelu4_alpha);var r=aa(t,[t.shape[0],e.fc1.weights.shape[0]]),i=za(r,e.fc1),a=Oc(i,e.prelu5_alpha),o=za(a,e.fc2_1),u=Oi(vv(o,1),1),c=Uo(Wn(o,u),1),h=za(a,e.fc2_2),d=za(a,e.fc2_3),p=zn(c,1)[1];return{scores:p,regions:h,points:d}})}function pq(n,e,t,r,i){return ze(this,void 0,void 0,function(){var a,o,u,c,h,d,p,g,v,b,w,E,T,R,I;return Ge(this,function(C){switch(C.label){case 0:return a=Date.now(),[4,l3(n,e,{width:48,height:48})];case 1:return o=C.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),u=o.map(function(k){var L=dq(k,r);return k.dispose(),L}),i.stage3_onet=Date.now()-a,c=u.length>1?Un(u.map(function(k){return k.scores})):u[0].scores,p=(d=Array).from,[4,c.data()];case 2:return h=p.apply(d,[C.sent()]),c.dispose(),g=h.map(function(k,L){return{score:k,idx:L}}).filter(function(k){return k.score>t}).map(function(k){var L=k.idx;return L}),v=g.map(function(k){var L=u[k].regions.arraySync();return new aw(L[0][0],L[0][1],L[0][2],L[0][3])}),b=g.map(function(k,L){return e[k].calibrate(v[L])}),w=g.map(function(k){return h[k]}),E=[],T=[],R=[],b.length>0&&(a=Date.now(),I=sd(b,w,.7,!1),i.stage3_nms=Date.now()-a,E=I.map(function(k){return b[k]}),T=I.map(function(k){return w[k]}),R=I.map(function(k,L){return Array(5).fill(0).map(function(O,N){var D=u[k].points.arraySync();return new Dt(D[0][N]*(E[L].width+1)+E[L].left,D[0][N+5]*(E[L].height+1)+E[L].top)})})),u.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:E,scores:T,points:R}]}})})}var mq=(function(n){nt(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return ze(this,void 0,void 0,function(){return Ge(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return ze(this,void 0,void 0,function(){return Ge(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i,a,o,u,c,h,d,p,g,v,b,w,E,T,R,I,C,k,L,O,N;return Ge(this,function(D){switch(D.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(a=t.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},u=Date.now(),c=Oe(function(){return tq(Oi(Gx.fromPixels(a)).toFloat())}),h=function(P){return c.dispose(),o.total=Date.now()-u,P},d=c.shape.slice(1),p=d[0],g=d[1],v=new i3(r),b=v.minFaceSize,w=v.scaleFactor,E=v.maxNumScales,T=v.scoreThresholds,R=v.scaleSteps,I=(R||oq(b,w,[p,g])).filter(function(P){var F=$b(P,[p,g]);return Math.min(F.width,F.height)>Vg}).slice(0,E),o.scales=I,o.pyramid=I.map(function(P){return $b(P,[p,g])}),C=Date.now(),[4,cq(c,I,T[0],i.pnet,o)];case 1:return k=D.sent(),o.total_stage1=Date.now()-C,k.boxes.length?(o.stage2_numInputBoxes=k.boxes.length,C=Date.now(),[4,fq(a,k.boxes,T[1],i.rnet,o)]):[2,h({results:[],stats:o})];case 2:return L=D.sent(),o.total_stage2=Date.now()-C,L.boxes.length?(o.stage3_numInputBoxes=L.boxes.length,C=Date.now(),[4,pq(a,L.boxes,T[2],i.onet,o)]):[2,h({results:[],stats:o})];case 3:return O=D.sent(),o.total_stage3=Date.now()-C,N=O.boxes.map(function(P,F){return ew(qx({},new io(O.scores[F],new Wx(P.left/g,P.top/p,P.width/g,P.height/p),{height:p,width:g})),new WH(O.points[F].map(function(j){return j.sub(new Dt(P.left,P.top)).div(new Dt(P.width,P.height))}),{width:P.width,height:P.height}))}),[2,h({results:N,stats:o})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,ir(t)];case 1:return[4,i.apply(this,[a.sent(),r])];case 2:return[2,a.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,ir(t)];case 1:return[2,i.apply(this,[a.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return aq(t)},e.prototype.extractParams=function(t){return rq(t)},e})(Go),gq=.4,vq=[new Dt(1.603231,2.094468),new Dt(6.041143,7.080126),new Dt(2.882459,3.518061),new Dt(4.266906,5.178857),new Dt(9.041765,10.66308)],yq=[117.001,114.697,97.404],_q=(function(n){nt(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:gq,classes:["face"],anchors:vq,meanRgb:yq,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ze(this,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return[4,this.detect(t,r)];case 1:return i=a.sent(),[2,i.map(function(o){return new io(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(o3),Fr={ssdMobilenetv1:new a3,tinyFaceDetector:new _q,tinyYolov2:new eq,mtcnn:new mq,faceLandmark68Net:new ZM,faceLandmark68TinyNet:new xW,faceRecognitionNet:new RW,faceExpressionNet:new sW,ageGenderNet:new vW},c3=(function(n){nt(e,n);function e(t,r,i){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.extractedFaces=i,a}return e})(Ld),sw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i=this;return Ge(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,Cv(t,this.input,function(o){return ze(i,void 0,void 0,function(){return Ge(this,function(u){switch(u.label){case 0:return[4,Promise.all(o.map(function(c){return Fr.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,t.map(function(o,u){return YM(o,r[u])})]}})})},e.prototype.withAgeAndGender=function(){return new hw(this,this.input)},e})(c3),uw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return Ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,iw(t,this.input,function(a){return Fr.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,YM(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new fw(this,this.input)},e})(c3),lw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new dw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new mw(this,this.input)},e})(sw),cw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new pw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new gw(this,this.input)},e})(uw),h3=(function(n){nt(e,n);function e(t,r,i){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.extractedFaces=i,a}return e})(Ld),hw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i=this;return Ge(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,Cv(t,this.input,function(o){return ze(i,void 0,void 0,function(){return Ge(this,function(u){switch(u.label){case 0:return[4,Promise.all(o.map(function(c){return Fr.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,t.map(function(o,u){var c=r[u],h=c.age,d=c.gender,p=c.genderProbability;return n3(r3(o,d,p),h)})]}})})},e.prototype.withFaceExpressions=function(){return new sw(this,this.input)},e})(h3),fw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a,o;return Ge(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),t?[4,iw(t,this.input,function(c){return Fr.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=u.sent(),i=r.age,a=r.gender,o=r.genderProbability,[2,n3(r3(t,a,o),i)]}})})},e.prototype.withFaceExpressions=function(){return new uw(this,this.input)},e})(h3),dw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new lw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new mw(this,this.input)},e})(hw),pw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new cw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new gw(this,this.input)},e})(fw),f3=(function(n){nt(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e})(Ld),mw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return Ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Cv(t,this.input,function(a){return Promise.all(a.map(function(o){return Fr.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(a,o){return t3(t[o],a)})]}})})},e.prototype.withFaceExpressions=function(){return new lw(this,this.input)},e.prototype.withAgeAndGender=function(){return new dw(this,this.input)},e})(f3),gw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return Ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,iw(t,this.input,function(a){return Fr.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,t3(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new cw(this,this.input)},e.prototype.withAgeAndGender=function(){return new pw(this,this.input)},e})(f3),d3=(function(n){nt(e,n);function e(t,r,i){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.useTinyLandmarkNet=i,a}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Fr.faceLandmark68TinyNet:Fr.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(Ld),bq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a,o,u=this;return Ge(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),r=t.map(function(h){return h.detection}),this.input instanceof an?[4,$x(this.input,r)]:[3,3];case 2:return a=c.sent(),[3,5];case 3:return[4,Yx(this.input,r)];case 4:a=c.sent(),c.label=5;case 5:return i=a,[4,Promise.all(i.map(function(h){return u.landmarkNet.detectLandmarks(h)}))];case 6:return o=c.sent(),i.forEach(function(h){return h instanceof an&&h.dispose()}),[2,t.map(function(h,d){return ew(h,o[d])})]}})})},e.prototype.withFaceExpressions=function(){return new lw(this,this.input)},e.prototype.withAgeAndGender=function(){return new dw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new mw(this,this.input)},e})(d3),xq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a,o;return Ge(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),t?(r=t.detection,this.input instanceof an?[4,$x(this.input,[r])]:[3,3]):[2];case 2:return a=u.sent(),[3,5];case 3:return[4,Yx(this.input,[r])];case 4:a=u.sent(),u.label=5;case 5:return i=a,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return o=u.sent(),i.forEach(function(c){return c instanceof an&&c.dispose()}),[2,ew(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new cw(this,this.input)},e.prototype.withAgeAndGender=function(){return new pw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new gw(this,this.input)},e})(d3),p3=(function(n){nt(e,n);function e(t,r){r===void 0&&(r=new Tv);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e})(Ld),wq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a;return Ge(this,function(o){switch(o.label){case 0:return t=this,r=t.input,i=t.options,i instanceof i3?[4,Fr.mtcnn.forward(r,i)]:[3,2];case 1:return[2,o.sent().map(function(u){return u.detection})];case 2:if(a=i instanceof s3?function(u){return Fr.tinyFaceDetector.locateFaces(u,i)}:i instanceof Tv?function(u){return Fr.ssdMobilenetv1.locateFaces(u,i)}:i instanceof rw?function(u){return Fr.tinyYolov2.locateFaces(u,i)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ze(t,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,r(i.map(function(o){return qx({},o)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new bq(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new sw(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new hw(this.runAndExtendWithFaceDetections(),this.input)},e})(p3),Eq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return Ge(this,function(i){switch(i.label){case 0:return[4,new wq(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(a){a.score>r.score&&(r=a)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ze(t,void 0,void 0,function(){var i;return Ge(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,r(i?qx({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new xq(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new uw(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new fw(this.runAndExtendWithFaceDetection(),this.input)},e})(p3);function Tq(n,e){return e===void 0&&(e=new Tv),new Eq(n,e)}function Cq(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,a){return i-r[a]}).reduce(function(i,a){return i+Math.pow(a,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,a=function(){return"person "+i++};this._labeledDescriptors=r.map(function(o){if(o instanceof Vm)return o;if(o instanceof Float32Array)return new Vm(a(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new Vm(a(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return Cq(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,a=r.label;return new dR(a,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new dR("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return Vm.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();const vw={apiKey:"AIzaSyBD7qwPXdRdzdKTKE9XgT20g1dV7iH49Jo",authDomain:"smart-papr-kiosk.firebaseapp.com",projectId:"smart-papr-kiosk",storageBucket:"smart-papr-kiosk.firebasestorage.app",messagingSenderId:"139324926582",appId:"1:139324926582:web:98889c32aacc42ff634d57",databaseURL:"https://smart-papr-kiosk-default-rtdb.asia-southeast1.firebasedatabase.app",measurementId:"G-7EWY7J8VS1"},Sq="AIzaSyBfeYBUKx7re4wOj7drifj4oXZbPe99Q0o",Aq={usePiCamera:!1},lc={enabled:!0,defaultLanguage:"th",thai:{voice:"Thai Female",rate:1.1,pitch:1.2,volume:1},english:{voice:"US English Female",rate:1.15,pitch:1.1,volume:1},chinese:{voice:"Chinese Female",rate:1,pitch:1,volume:1}},Cf={KIDS_3_7:{ageRange:[3,7],uiType:"KidsMode",features:["simple_animation","big_buttons","emoji_focused","no_text"],requiresConsent:!0,layout:"fullscreen_simplified",colors:["#FF6B6B","#4ECDC4","#FFE66D","#95E1D3"]},KIDS_8_12:{ageRange:[8,12],uiType:"ExploreMode",features:["interactive_games","career_exploration","simple_content","animation"],requiresConsent:!0,layout:"grid_cards",colors:["#3498db","#2ecc71","#f39c12","#e74c3c"]},TEENS_13_18:{ageRange:[13,18],uiType:"StandardMode",features:["career_cards","avatar_chat","tuition_info","analytics"],requiresConsent:!1,layout:"standard",colors:["#667eea","#764ba2","#f093fb","#4facfe"]},ADULTS_18_PLUS:{ageRange:[18,100],uiType:"ParentMode",features:["scholarship_info","roi_data","admission_requirements","career_stats"],requiresConsent:!1,layout:"parent_dashboard",colors:["#2c3e50","#34495e","#3498db","#2ecc71"]}},Rq=n=>n>=3&&n<=7?Cf.KIDS_3_7:n>=8&&n<=12?Cf.KIDS_8_12:n>=13&&n<=18?Cf.TEENS_13_18:n>=18?Cf.ADULTS_18_PLUS:Cf.KIDS_3_7,Fg=[{id:"au",name:"",code:"Au",category:"",icon:"",color:"#ef4444",gradient:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",description:"    3 /     ",keywords:["","","","","","auto","car"]},{id:"ev",name:"",code:"Ev",category:"",icon:"",color:"#22c55e",gradient:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",description:"  EV    EV  ",keywords:["EV","","","","","electric","battery"]},{id:"ep",name:"",code:"Ep",category:"",icon:"",color:"#fbbf24",gradient:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",description:"      ",keywords:["","","","","PLC","electric","power"]},{id:"el",name:"",code:"El",category:"",icon:"",color:"#3b82f6",gradient:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",description:"          ",keywords:["","","Arduino","IoT","","electronics","circuit"]},{id:"co",name:"",code:"Co",category:"",icon:"",color:"#78716c",gradient:"linear-gradient(135deg, #78716c 0%, #57534e 100%)",description:"    Draftman   ",keywords:["","","","","","construction","building"]},{id:"ar",name:"",code:"Ar",category:"",icon:"",color:"#8b5cf6",gradient:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",description:"           ",keywords:["","","","3D","Revit","architecture","design"]},{id:"ct",name:"",code:"Ct",category:"",icon:"",color:"#06b6d4",gradient:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",description:"    C, Java, Python     IoT ",keywords:["","code","Python","Java","","coding","programming"]},{id:"it",name:"",code:"It",category:"",icon:"",color:"#14b8a6",gradient:"linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)",description:"  .      IT    e-Commerce  IT     ",keywords:["IT","network","server","","","tech","computer",""]},{id:"ac",name:"",code:"Ac",category:"",icon:"",color:"#10b981",gradient:"linear-gradient(135deg, #10b981 0%, #059669 100%)",description:"       ",keywords:["","","","","SAP","accounting","finance"]},{id:"mk",name:"",code:"Mk",category:"",icon:"",color:"#ec4899",gradient:"linear-gradient(135deg, #ec4899 0%, #db2777 100%)",description:" E-Commerce           ",keywords:["","","digital","content","","marketing","social"]},{id:"dt",name:"",code:"Dt",category:"",icon:"",color:"#f97316",gradient:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",description:"       ",keywords:["","","startup","ecommerce","social","digital","business"]},{id:"tg",name:"",code:"Tg",category:"",icon:"",color:"#0ea5e9",gradient:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",description:"       ",keywords:["","","","","","tourism","travel"]},{id:"hm",name:"",code:"Hm",category:"",icon:"",color:"#a855f7",gradient:"linear-gradient(135deg, #a855f7 0%, #9333ea 100%)",description:"      ",keywords:["","","","","","hotel","hospitality"]}],Fa={certificate:{industrial:{tuition:9e3,entrance:3100,total:12100,name:""},business:{tuition:7e3,entrance:3100,total:10100,name:""},tourism:{tuition:7e3,entrance:3100,total:10100,name:""}},diploma:{industrial:{tuition:18700,entrance:3e3,total:21700,name:""},business:{tuition:16e3,entrance:3e3,total:19e3,name:""},tourism:{tuition:16e3,entrance:3e3,total:19e3,name:""}},scholarships:[{id:"cert-m3",name:" .3  .",description:" .3",icon:"",color:"#10b981"},{id:"quota-m6",name:" .6",description:" .6",icon:"",color:"#f59e0b"},{id:"quota-diploma",name:" .",description:" .",icon:"",color:"#8b5cf6"},{id:"student-loan",name:" (.)",description:" ",icon:"",color:"#3b82f6"},{id:"kalyanamitr",name:"",description:"",icon:"",color:"#ec4899"}],benefits:[" 1 ",""," 2 "," 1 "],documents:[".1 "," (, , )"," (, , )",""],applicationMethods:[{method:"walk-in",name:"",icon:"",description:""},{method:"online",name:"",icon:"",description:" "}],notes:["","  "," "]},Iq=()=>{};var _R={};const m3={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const Ne=function(n,e){if(!n)throw sh(e)},sh=function(n){return new Error("Firebase Database ("+m3.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const g3=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Nq=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=n[t++];e[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=n[t++],o=n[t++],u=n[t++],c=((i&7)<<18|(a&63)<<12|(o&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const a=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return e.join("")},yw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const a=n[i],o=i+1<n.length,u=o?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,d=a>>2,p=(a&3)<<4|u>>4;let g=(u&15)<<2|h>>6,v=h&63;c||(v=64,o||(g=64)),r.push(t[d],t[p],t[g],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(g3(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Nq(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const a=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,a==null||u==null||h==null||p==null)throw new Dq;const g=a<<2|u>>4;if(r.push(g),h!==64){const v=u<<4&240|h>>2;if(r.push(v),p!==64){const b=h<<6&192|p;r.push(b)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Dq extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const v3=function(n){const e=g3(n);return yw.encodeByteArray(e,!0)},Lg=function(n){return v3(n).replace(/\./g,"")},Qb=function(n){try{return yw.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function kq(n){return y3(void 0,n)}function y3(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Mq(t)||(n[t]=y3(n[t],e[t]));return n}function Mq(n){return n!=="__proto__"}function Oq(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Pq=()=>Oq().__FIREBASE_DEFAULTS__,Vq=()=>{if(typeof process>"u"||typeof _R>"u")return;const n=_R.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Fq=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Qb(n[1]);return e&&JSON.parse(e)},_w=()=>{try{return Iq()||Pq()||Vq()||Fq()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Lq=n=>_w()?.emulatorHosts?.[n],_3=n=>{const e=Lq(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},b3=()=>_w()?.config;class bw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Bd(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function x3(n){return(await fetch(n,{credentials:"include"})).ok}function w3(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Lg(JSON.stringify(t)),Lg(JSON.stringify(o)),""].join(".")}const Uf={};function Bq(){const n={prod:[],emulator:[]};for(const e of Object.keys(Uf))Uf[e]?n.emulator.push(e):n.prod.push(e);return n}function jq(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let bR=!1;function E3(n,e){if(typeof window>"u"||typeof document>"u"||!Bd(window.location.host)||Uf[n]===e||Uf[n]||bR)return;Uf[n]=e;function t(g){return`__firebase__banner__${g}`}const r="__firebase__banner",a=Bq().prod.length>0;function o(){const g=document.getElementById(r);g&&g.remove()}function u(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function c(g,v){g.setAttribute("width","24"),g.setAttribute("id",v),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function h(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{bR=!0,o()},g}function d(g,v){g.setAttribute("id",v),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){const g=jq(r),v=t("text"),b=document.getElementById(v)||document.createElement("span"),w=t("learnmore"),E=document.getElementById(w)||document.createElement("a"),T=t("preprendIcon"),R=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const I=g.element;u(I),d(E,w);const C=h();c(R,T),I.append(R,b,E,C),document.body.appendChild(I)}a?(b.innerText="Preview backend disconnected.",R.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(R.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function T3(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function C3(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(T3())}function Uq(){const n=_w()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function zq(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Gq(){return m3.NODE_ADMIN===!0}function Hq(){return!Uq()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Wq(){try{return typeof indexedDB=="object"}catch{return!1}}function qq(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const Kq="FirebaseError";class uh extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Kq,Object.setPrototypeOf(this,uh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S3.prototype.create)}}class S3{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?Xq(a,r):"Error",u=`${this.serviceName}: ${o} (${i}).`;return new uh(i,u,r)}}function Xq(n,e){return n.replace(Yq,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Yq=/\{\$([^}]+)}/g;function ud(n){return JSON.parse(n)}function mr(n){return JSON.stringify(n)}const A3=function(n){let e={},t={},r={},i="";try{const a=n.split(".");e=ud(Qb(a[0])||""),t=ud(Qb(a[1])||""),i=a[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:i}},$q=function(n){const e=A3(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Qq=function(n){const e=A3(n).claims;return typeof e=="object"&&e.admin===!0};function qo(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function qc(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function xR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Bg(n,e,t){const r={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=e.call(t,n[i],i,n));return r}function ld(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const a=n[i],o=e[i];if(wR(a)&&wR(o)){if(!ld(a,o))return!1}else if(a!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function wR(n){return n!==null&&typeof n=="object"}function Zq(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}class Jq{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)r[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)r[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const g=r[p-3]^r[p-8]^r[p-14]^r[p-16];r[p]=(g<<1|g>>>31)&4294967295}let i=this.chain_[0],a=this.chain_[1],o=this.chain_[2],u=this.chain_[3],c=this.chain_[4],h,d;for(let p=0;p<80;p++){p<40?p<20?(h=u^a&(o^u),d=1518500249):(h=a^o^u,d=1859775393):p<60?(h=a&o|u&(a|o),d=2400959708):(h=a^o^u,d=3395469782);const g=(i<<5|i>>>27)+h+c+d+r[p]&4294967295;c=u,u=o,o=(a<<30|a>>>2)&4294967295,a=i,i=g}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let i=0;const a=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(a[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(a),o=0;break}}else for(;i<t;)if(a[o]=e[i],++o,++i,o===this.blockSize){this.compress_(a),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let a=24;a>=0;a-=8)e[r]=this.chain_[i]>>a&255,++r;return e}}function e7(n,e){return`${n} failed: ${e} argument `}const t7=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i>=55296&&i<=56319){const a=i-55296;r++,Ne(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;i=65536+(a<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Sv=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};function ca(n){return n&&n._delegate?n._delegate:n}class Kc{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ju="[DEFAULT]";class n7{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new bw;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(i7(e))try{this.getOrInitializeService({instanceIdentifier:ju})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});r.resolve(a)}catch{}}}}clearInstance(e=ju){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ju){return this.instances.has(e)}getOptions(e=ju){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[a,o]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(a);r===u&&o.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:r7(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ju){return this.component?this.component.multipleInstances?e:ju:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function r7(n){return n===ju?void 0:n}function i7(n){return n.instantiationMode==="EAGER"}class a7{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new n7(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var xt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(xt||(xt={}));const o7={debug:xt.DEBUG,verbose:xt.VERBOSE,info:xt.INFO,warn:xt.WARN,error:xt.ERROR,silent:xt.SILENT},s7=xt.INFO,u7={[xt.DEBUG]:"log",[xt.VERBOSE]:"log",[xt.INFO]:"info",[xt.WARN]:"warn",[xt.ERROR]:"error"},l7=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=u7[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class xw{constructor(e){this.name=e,this._logLevel=s7,this._logHandler=l7,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?o7[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xt.DEBUG,...e),this._logHandler(this,xt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xt.VERBOSE,...e),this._logHandler(this,xt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xt.INFO,...e),this._logHandler(this,xt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xt.WARN,...e),this._logHandler(this,xt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xt.ERROR,...e),this._logHandler(this,xt.ERROR,...e)}}const c7=(n,e)=>e.some(t=>n instanceof t);let ER,TR;function h7(){return ER||(ER=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function f7(){return TR||(TR=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const R3=new WeakMap,Zb=new WeakMap,I3=new WeakMap,U_=new WeakMap,ww=new WeakMap;function d7(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",a),n.removeEventListener("error",o)},a=()=>{t(Ms(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",a),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&R3.set(t,n)}).catch(()=>{}),ww.set(e,n),e}function p7(n){if(Zb.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",o),n.removeEventListener("abort",o)},a=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",a),n.addEventListener("error",o),n.addEventListener("abort",o)});Zb.set(n,e)}let Jb={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Zb.get(n);if(e==="objectStoreNames")return n.objectStoreNames||I3.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ms(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function m7(n){Jb=n(Jb)}function g7(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(z_(this),e,...t);return I3.set(r,e.sort?e.sort():[e]),Ms(r)}:f7().includes(n)?function(...e){return n.apply(z_(this),e),Ms(R3.get(this))}:function(...e){return Ms(n.apply(z_(this),e))}}function v7(n){return typeof n=="function"?g7(n):(n instanceof IDBTransaction&&p7(n),c7(n,h7())?new Proxy(n,Jb):n)}function Ms(n){if(n instanceof IDBRequest)return d7(n);if(U_.has(n))return U_.get(n);const e=v7(n);return e!==n&&(U_.set(n,e),ww.set(e,n)),e}const z_=n=>ww.get(n);function y7(n,e,{blocked:t,upgrade:r,blocking:i,terminated:a}={}){const o=indexedDB.open(n,e),u=Ms(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Ms(o.result),c.oldVersion,c.newVersion,Ms(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),u.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const _7=["get","getKey","getAll","getAllKeys","count"],b7=["put","add","delete","clear"],G_=new Map;function CR(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(G_.get(e))return G_.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=b7.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||_7.includes(t)))return;const a=async function(o,...u){const c=this.transaction(o,i?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(u.shift())),(await Promise.all([h[t](...u),i&&c.done]))[0]};return G_.set(e,a),a}m7(n=>({...n,get:(e,t,r)=>CR(e,t)||n.get(e,t,r),has:(e,t)=>!!CR(e,t)||n.has(e,t)}));class x7{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(w7(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function w7(n){return n.getComponent()?.type==="VERSION"}const e1="@firebase/app",SR="0.14.6";const Po=new xw("@firebase/app"),E7="@firebase/app-compat",T7="@firebase/analytics-compat",C7="@firebase/analytics",S7="@firebase/app-check-compat",A7="@firebase/app-check",R7="@firebase/auth",I7="@firebase/auth-compat",N7="@firebase/database",D7="@firebase/data-connect",k7="@firebase/database-compat",M7="@firebase/functions",O7="@firebase/functions-compat",P7="@firebase/installations",V7="@firebase/installations-compat",F7="@firebase/messaging",L7="@firebase/messaging-compat",B7="@firebase/performance",j7="@firebase/performance-compat",U7="@firebase/remote-config",z7="@firebase/remote-config-compat",G7="@firebase/storage",H7="@firebase/storage-compat",W7="@firebase/firestore",q7="@firebase/ai",K7="@firebase/firestore-compat",X7="firebase",Y7="12.6.0";const t1="[DEFAULT]",$7={[e1]:"fire-core",[E7]:"fire-core-compat",[C7]:"fire-analytics",[T7]:"fire-analytics-compat",[A7]:"fire-app-check",[S7]:"fire-app-check-compat",[R7]:"fire-auth",[I7]:"fire-auth-compat",[N7]:"fire-rtdb",[D7]:"fire-data-connect",[k7]:"fire-rtdb-compat",[M7]:"fire-fn",[O7]:"fire-fn-compat",[P7]:"fire-iid",[V7]:"fire-iid-compat",[F7]:"fire-fcm",[L7]:"fire-fcm-compat",[B7]:"fire-perf",[j7]:"fire-perf-compat",[U7]:"fire-rc",[z7]:"fire-rc-compat",[G7]:"fire-gcs",[H7]:"fire-gcs-compat",[W7]:"fire-fst",[K7]:"fire-fst-compat",[q7]:"fire-vertex","fire-js":"fire-js",[X7]:"fire-js-all"};const jg=new Map,Q7=new Map,n1=new Map;function AR(n,e){try{n.container.addComponent(e)}catch(t){Po.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cd(n){const e=n.name;if(n1.has(e))return Po.debug(`There were multiple attempts to register component ${e}.`),!1;n1.set(e,n);for(const t of jg.values())AR(t,n);for(const t of Q7.values())AR(t,n);return!0}function N3(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function D3(n){return n==null?!1:n.settings!==void 0}const Z7={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Os=new S3("app","Firebase",Z7);class J7{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Kc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Os.create("app-deleted",{appName:this._name})}}const k3=Y7;function M3(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:t1,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Os.create("bad-app-name",{appName:String(i)});if(t||(t=b3()),!t)throw Os.create("no-options");const a=jg.get(i);if(a){if(ld(t,a.options)&&ld(r,a.config))return a;throw Os.create("duplicate-app",{appName:i})}const o=new a7(i);for(const c of n1.values())o.addComponent(c);const u=new J7(t,r,o);return jg.set(i,u),u}function O3(n=t1){const e=jg.get(n);if(!e&&n===t1&&b3())return M3();if(!e)throw Os.create("no-app",{appName:n});return e}function Ps(n,e,t){let r=$7[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Po.warn(o.join(" "));return}cd(new Kc(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const eK="firebase-heartbeat-database",tK=1,hd="firebase-heartbeat-store";let H_=null;function P3(){return H_||(H_=y7(eK,tK,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(hd)}catch(t){console.warn(t)}}}}).catch(n=>{throw Os.create("idb-open",{originalErrorMessage:n.message})})),H_}async function nK(n){try{const t=(await P3()).transaction(hd),r=await t.objectStore(hd).get(V3(n));return await t.done,r}catch(e){if(e instanceof uh)Po.warn(e.message);else{const t=Os.create("idb-get",{originalErrorMessage:e?.message});Po.warn(t.message)}}}async function RR(n,e){try{const r=(await P3()).transaction(hd,"readwrite");await r.objectStore(hd).put(e,V3(n)),await r.done}catch(t){if(t instanceof uh)Po.warn(t.message);else{const r=Os.create("idb-set",{originalErrorMessage:t?.message});Po.warn(r.message)}}}function V3(n){return`${n.name}!${n.options.appId}`}const rK=1024,iK=30;class aK{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new sK(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=IR();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>iK){const i=uK(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Po.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=IR(),{heartbeatsToSend:t,unsentEntries:r}=oK(this._heartbeatsCache.heartbeats),i=Lg(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Po.warn(e),""}}}function IR(){return new Date().toISOString().substring(0,10)}function oK(n,e=rK){const t=[];let r=n.slice();for(const i of n){const a=t.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),NR(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),NR(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class sK{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Wq()?qq().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await nK(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return RR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return RR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function NR(n){return Lg(JSON.stringify({version:2,heartbeats:n})).length}function uK(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function lK(n){cd(new Kc("platform-logger",e=>new x7(e),"PRIVATE")),cd(new Kc("heartbeat",e=>new aK(e),"PRIVATE")),Ps(e1,SR,n),Ps(e1,SR,"esm2020"),Ps("fire-js","")}lK("");var cK="firebase",hK="12.7.0";Ps(cK,hK,"app");var DR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Vs,F3;(function(){var n;function e(O,N){function D(){}D.prototype=N.prototype,O.F=N.prototype,O.prototype=new D,O.prototype.constructor=O,O.D=function(P,F,j){for(var B=Array(arguments.length-2),J=2;J<arguments.length;J++)B[J-2]=arguments[J];return N.prototype[F].apply(P,B)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(O,N,D){D||(D=0);const P=Array(16);if(typeof N=="string")for(var F=0;F<16;++F)P[F]=N.charCodeAt(D++)|N.charCodeAt(D++)<<8|N.charCodeAt(D++)<<16|N.charCodeAt(D++)<<24;else for(F=0;F<16;++F)P[F]=N[D++]|N[D++]<<8|N[D++]<<16|N[D++]<<24;N=O.g[0],D=O.g[1],F=O.g[2];let j=O.g[3],B;B=N+(j^D&(F^j))+P[0]+3614090360&4294967295,N=D+(B<<7&4294967295|B>>>25),B=j+(F^N&(D^F))+P[1]+3905402710&4294967295,j=N+(B<<12&4294967295|B>>>20),B=F+(D^j&(N^D))+P[2]+606105819&4294967295,F=j+(B<<17&4294967295|B>>>15),B=D+(N^F&(j^N))+P[3]+3250441966&4294967295,D=F+(B<<22&4294967295|B>>>10),B=N+(j^D&(F^j))+P[4]+4118548399&4294967295,N=D+(B<<7&4294967295|B>>>25),B=j+(F^N&(D^F))+P[5]+1200080426&4294967295,j=N+(B<<12&4294967295|B>>>20),B=F+(D^j&(N^D))+P[6]+2821735955&4294967295,F=j+(B<<17&4294967295|B>>>15),B=D+(N^F&(j^N))+P[7]+4249261313&4294967295,D=F+(B<<22&4294967295|B>>>10),B=N+(j^D&(F^j))+P[8]+1770035416&4294967295,N=D+(B<<7&4294967295|B>>>25),B=j+(F^N&(D^F))+P[9]+2336552879&4294967295,j=N+(B<<12&4294967295|B>>>20),B=F+(D^j&(N^D))+P[10]+4294925233&4294967295,F=j+(B<<17&4294967295|B>>>15),B=D+(N^F&(j^N))+P[11]+2304563134&4294967295,D=F+(B<<22&4294967295|B>>>10),B=N+(j^D&(F^j))+P[12]+1804603682&4294967295,N=D+(B<<7&4294967295|B>>>25),B=j+(F^N&(D^F))+P[13]+4254626195&4294967295,j=N+(B<<12&4294967295|B>>>20),B=F+(D^j&(N^D))+P[14]+2792965006&4294967295,F=j+(B<<17&4294967295|B>>>15),B=D+(N^F&(j^N))+P[15]+1236535329&4294967295,D=F+(B<<22&4294967295|B>>>10),B=N+(F^j&(D^F))+P[1]+4129170786&4294967295,N=D+(B<<5&4294967295|B>>>27),B=j+(D^F&(N^D))+P[6]+3225465664&4294967295,j=N+(B<<9&4294967295|B>>>23),B=F+(N^D&(j^N))+P[11]+643717713&4294967295,F=j+(B<<14&4294967295|B>>>18),B=D+(j^N&(F^j))+P[0]+3921069994&4294967295,D=F+(B<<20&4294967295|B>>>12),B=N+(F^j&(D^F))+P[5]+3593408605&4294967295,N=D+(B<<5&4294967295|B>>>27),B=j+(D^F&(N^D))+P[10]+38016083&4294967295,j=N+(B<<9&4294967295|B>>>23),B=F+(N^D&(j^N))+P[15]+3634488961&4294967295,F=j+(B<<14&4294967295|B>>>18),B=D+(j^N&(F^j))+P[4]+3889429448&4294967295,D=F+(B<<20&4294967295|B>>>12),B=N+(F^j&(D^F))+P[9]+568446438&4294967295,N=D+(B<<5&4294967295|B>>>27),B=j+(D^F&(N^D))+P[14]+3275163606&4294967295,j=N+(B<<9&4294967295|B>>>23),B=F+(N^D&(j^N))+P[3]+4107603335&4294967295,F=j+(B<<14&4294967295|B>>>18),B=D+(j^N&(F^j))+P[8]+1163531501&4294967295,D=F+(B<<20&4294967295|B>>>12),B=N+(F^j&(D^F))+P[13]+2850285829&4294967295,N=D+(B<<5&4294967295|B>>>27),B=j+(D^F&(N^D))+P[2]+4243563512&4294967295,j=N+(B<<9&4294967295|B>>>23),B=F+(N^D&(j^N))+P[7]+1735328473&4294967295,F=j+(B<<14&4294967295|B>>>18),B=D+(j^N&(F^j))+P[12]+2368359562&4294967295,D=F+(B<<20&4294967295|B>>>12),B=N+(D^F^j)+P[5]+4294588738&4294967295,N=D+(B<<4&4294967295|B>>>28),B=j+(N^D^F)+P[8]+2272392833&4294967295,j=N+(B<<11&4294967295|B>>>21),B=F+(j^N^D)+P[11]+1839030562&4294967295,F=j+(B<<16&4294967295|B>>>16),B=D+(F^j^N)+P[14]+4259657740&4294967295,D=F+(B<<23&4294967295|B>>>9),B=N+(D^F^j)+P[1]+2763975236&4294967295,N=D+(B<<4&4294967295|B>>>28),B=j+(N^D^F)+P[4]+1272893353&4294967295,j=N+(B<<11&4294967295|B>>>21),B=F+(j^N^D)+P[7]+4139469664&4294967295,F=j+(B<<16&4294967295|B>>>16),B=D+(F^j^N)+P[10]+3200236656&4294967295,D=F+(B<<23&4294967295|B>>>9),B=N+(D^F^j)+P[13]+681279174&4294967295,N=D+(B<<4&4294967295|B>>>28),B=j+(N^D^F)+P[0]+3936430074&4294967295,j=N+(B<<11&4294967295|B>>>21),B=F+(j^N^D)+P[3]+3572445317&4294967295,F=j+(B<<16&4294967295|B>>>16),B=D+(F^j^N)+P[6]+76029189&4294967295,D=F+(B<<23&4294967295|B>>>9),B=N+(D^F^j)+P[9]+3654602809&4294967295,N=D+(B<<4&4294967295|B>>>28),B=j+(N^D^F)+P[12]+3873151461&4294967295,j=N+(B<<11&4294967295|B>>>21),B=F+(j^N^D)+P[15]+530742520&4294967295,F=j+(B<<16&4294967295|B>>>16),B=D+(F^j^N)+P[2]+3299628645&4294967295,D=F+(B<<23&4294967295|B>>>9),B=N+(F^(D|~j))+P[0]+4096336452&4294967295,N=D+(B<<6&4294967295|B>>>26),B=j+(D^(N|~F))+P[7]+1126891415&4294967295,j=N+(B<<10&4294967295|B>>>22),B=F+(N^(j|~D))+P[14]+2878612391&4294967295,F=j+(B<<15&4294967295|B>>>17),B=D+(j^(F|~N))+P[5]+4237533241&4294967295,D=F+(B<<21&4294967295|B>>>11),B=N+(F^(D|~j))+P[12]+1700485571&4294967295,N=D+(B<<6&4294967295|B>>>26),B=j+(D^(N|~F))+P[3]+2399980690&4294967295,j=N+(B<<10&4294967295|B>>>22),B=F+(N^(j|~D))+P[10]+4293915773&4294967295,F=j+(B<<15&4294967295|B>>>17),B=D+(j^(F|~N))+P[1]+2240044497&4294967295,D=F+(B<<21&4294967295|B>>>11),B=N+(F^(D|~j))+P[8]+1873313359&4294967295,N=D+(B<<6&4294967295|B>>>26),B=j+(D^(N|~F))+P[15]+4264355552&4294967295,j=N+(B<<10&4294967295|B>>>22),B=F+(N^(j|~D))+P[6]+2734768916&4294967295,F=j+(B<<15&4294967295|B>>>17),B=D+(j^(F|~N))+P[13]+1309151649&4294967295,D=F+(B<<21&4294967295|B>>>11),B=N+(F^(D|~j))+P[4]+4149444226&4294967295,N=D+(B<<6&4294967295|B>>>26),B=j+(D^(N|~F))+P[11]+3174756917&4294967295,j=N+(B<<10&4294967295|B>>>22),B=F+(N^(j|~D))+P[2]+718787259&4294967295,F=j+(B<<15&4294967295|B>>>17),B=D+(j^(F|~N))+P[9]+3951481745&4294967295,O.g[0]=O.g[0]+N&4294967295,O.g[1]=O.g[1]+(F+(B<<21&4294967295|B>>>11))&4294967295,O.g[2]=O.g[2]+F&4294967295,O.g[3]=O.g[3]+j&4294967295}r.prototype.v=function(O,N){N===void 0&&(N=O.length);const D=N-this.blockSize,P=this.C;let F=this.h,j=0;for(;j<N;){if(F==0)for(;j<=D;)i(this,O,j),j+=this.blockSize;if(typeof O=="string"){for(;j<N;)if(P[F++]=O.charCodeAt(j++),F==this.blockSize){i(this,P),F=0;break}}else for(;j<N;)if(P[F++]=O[j++],F==this.blockSize){i(this,P),F=0;break}}this.h=F,this.o+=N},r.prototype.A=function(){var O=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);O[0]=128;for(var N=1;N<O.length-8;++N)O[N]=0;N=this.o*8;for(var D=O.length-8;D<O.length;++D)O[D]=N&255,N/=256;for(this.v(O),O=Array(16),N=0,D=0;D<4;++D)for(let P=0;P<32;P+=8)O[N++]=this.g[D]>>>P&255;return O};function a(O,N){var D=u;return Object.prototype.hasOwnProperty.call(D,O)?D[O]:D[O]=N(O)}function o(O,N){this.h=N;const D=[];let P=!0;for(let F=O.length-1;F>=0;F--){const j=O[F]|0;P&&j==N||(D[F]=j,P=!1)}this.g=D}var u={};function c(O){return-128<=O&&O<128?a(O,function(N){return new o([N|0],N<0?-1:0)}):new o([O|0],O<0?-1:0)}function h(O){if(isNaN(O)||!isFinite(O))return p;if(O<0)return E(h(-O));const N=[];let D=1;for(let P=0;O>=D;P++)N[P]=O/D|0,D*=4294967296;return new o(N,0)}function d(O,N){if(O.length==0)throw Error("number format error: empty string");if(N=N||10,N<2||36<N)throw Error("radix out of range: "+N);if(O.charAt(0)=="-")return E(d(O.substring(1),N));if(O.indexOf("-")>=0)throw Error('number format error: interior "-" character');const D=h(Math.pow(N,8));let P=p;for(let j=0;j<O.length;j+=8){var F=Math.min(8,O.length-j);const B=parseInt(O.substring(j,j+F),N);F<8?(F=h(Math.pow(N,F)),P=P.j(F).add(h(B))):(P=P.j(D),P=P.add(h(B)))}return P}var p=c(0),g=c(1),v=c(16777216);n=o.prototype,n.m=function(){if(w(this))return-E(this).m();let O=0,N=1;for(let D=0;D<this.g.length;D++){const P=this.i(D);O+=(P>=0?P:4294967296+P)*N,N*=4294967296}return O},n.toString=function(O){if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(b(this))return"0";if(w(this))return"-"+E(this).toString(O);const N=h(Math.pow(O,6));var D=this;let P="";for(;;){const F=C(D,N).g;D=T(D,F.j(N));let j=((D.g.length>0?D.g[0]:D.h)>>>0).toString(O);if(D=F,b(D))return j+P;for(;j.length<6;)j="0"+j;P=j+P}},n.i=function(O){return O<0?0:O<this.g.length?this.g[O]:this.h};function b(O){if(O.h!=0)return!1;for(let N=0;N<O.g.length;N++)if(O.g[N]!=0)return!1;return!0}function w(O){return O.h==-1}n.l=function(O){return O=T(this,O),w(O)?-1:b(O)?0:1};function E(O){const N=O.g.length,D=[];for(let P=0;P<N;P++)D[P]=~O.g[P];return new o(D,~O.h).add(g)}n.abs=function(){return w(this)?E(this):this},n.add=function(O){const N=Math.max(this.g.length,O.g.length),D=[];let P=0;for(let F=0;F<=N;F++){let j=P+(this.i(F)&65535)+(O.i(F)&65535),B=(j>>>16)+(this.i(F)>>>16)+(O.i(F)>>>16);P=B>>>16,j&=65535,B&=65535,D[F]=B<<16|j}return new o(D,D[D.length-1]&-2147483648?-1:0)};function T(O,N){return O.add(E(N))}n.j=function(O){if(b(this)||b(O))return p;if(w(this))return w(O)?E(this).j(E(O)):E(E(this).j(O));if(w(O))return E(this.j(E(O)));if(this.l(v)<0&&O.l(v)<0)return h(this.m()*O.m());const N=this.g.length+O.g.length,D=[];for(var P=0;P<2*N;P++)D[P]=0;for(P=0;P<this.g.length;P++)for(let F=0;F<O.g.length;F++){const j=this.i(P)>>>16,B=this.i(P)&65535,J=O.i(F)>>>16,ne=O.i(F)&65535;D[2*P+2*F]+=B*ne,R(D,2*P+2*F),D[2*P+2*F+1]+=j*ne,R(D,2*P+2*F+1),D[2*P+2*F+1]+=B*J,R(D,2*P+2*F+1),D[2*P+2*F+2]+=j*J,R(D,2*P+2*F+2)}for(O=0;O<N;O++)D[O]=D[2*O+1]<<16|D[2*O];for(O=N;O<2*N;O++)D[O]=0;return new o(D,0)};function R(O,N){for(;(O[N]&65535)!=O[N];)O[N+1]+=O[N]>>>16,O[N]&=65535,N++}function I(O,N){this.g=O,this.h=N}function C(O,N){if(b(N))throw Error("division by zero");if(b(O))return new I(p,p);if(w(O))return N=C(E(O),N),new I(E(N.g),E(N.h));if(w(N))return N=C(O,E(N)),new I(E(N.g),N.h);if(O.g.length>30){if(w(O)||w(N))throw Error("slowDivide_ only works with positive integers.");for(var D=g,P=N;P.l(O)<=0;)D=k(D),P=k(P);var F=L(D,1),j=L(P,1);for(P=L(P,2),D=L(D,2);!b(P);){var B=j.add(P);B.l(O)<=0&&(F=F.add(D),j=B),P=L(P,1),D=L(D,1)}return N=T(O,F.j(N)),new I(F,N)}for(F=p;O.l(N)>=0;){for(D=Math.max(1,Math.floor(O.m()/N.m())),P=Math.ceil(Math.log(D)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),j=h(D),B=j.j(N);w(B)||B.l(O)>0;)D-=P,j=h(D),B=j.j(N);b(j)&&(j=g),F=F.add(j),O=T(O,B)}return new I(F,O)}n.B=function(O){return C(this,O).h},n.and=function(O){const N=Math.max(this.g.length,O.g.length),D=[];for(let P=0;P<N;P++)D[P]=this.i(P)&O.i(P);return new o(D,this.h&O.h)},n.or=function(O){const N=Math.max(this.g.length,O.g.length),D=[];for(let P=0;P<N;P++)D[P]=this.i(P)|O.i(P);return new o(D,this.h|O.h)},n.xor=function(O){const N=Math.max(this.g.length,O.g.length),D=[];for(let P=0;P<N;P++)D[P]=this.i(P)^O.i(P);return new o(D,this.h^O.h)};function k(O){const N=O.g.length+1,D=[];for(let P=0;P<N;P++)D[P]=O.i(P)<<1|O.i(P-1)>>>31;return new o(D,O.h)}function L(O,N){const D=N>>5;N%=32;const P=O.g.length-D,F=[];for(let j=0;j<P;j++)F[j]=N>0?O.i(j+D)>>>N|O.i(j+D+1)<<32-N:O.i(j+D);return new o(F,O.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,F3=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,Vs=o}).apply(typeof DR<"u"?DR:typeof self<"u"?self:typeof window<"u"?window:{});var Um=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var L3,Df,B3,tg,r1,j3,U3,z3;(function(){var n,e=Object.defineProperty;function t(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Um=="object"&&Um];for(var A=0;A<y.length;++A){var V=y[A];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=t(this);function i(y,A){if(A)e:{var V=r;y=y.split(".");for(var G=0;G<y.length-1;G++){var re=y[G];if(!(re in V))break e;V=V[re]}y=y[y.length-1],G=V[y],A=A(G),A!=G&&A!=null&&e(V,y,{configurable:!0,writable:!0,value:A})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(A){var V=[],G;for(G in A)Object.prototype.hasOwnProperty.call(A,G)&&V.push([G,A[G]]);return V}});var a=a||{},o=this||self;function u(y){var A=typeof y;return A=="object"&&y!=null||A=="function"}function c(y,A,V){return y.call.apply(y.bind,arguments)}function h(y,A,V){return h=c,h.apply(null,arguments)}function d(y,A){var V=Array.prototype.slice.call(arguments,1);return function(){var G=V.slice();return G.push.apply(G,arguments),y.apply(this,G)}}function p(y,A){function V(){}V.prototype=A.prototype,y.Z=A.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(G,re,he){for(var Se=Array(arguments.length-2),st=2;st<arguments.length;st++)Se[st-2]=arguments[st];return A.prototype[re].apply(G,Se)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function v(y){const A=y.length;if(A>0){const V=Array(A);for(let G=0;G<A;G++)V[G]=y[G];return V}return[]}function b(y,A){for(let G=1;G<arguments.length;G++){const re=arguments[G];var V=typeof re;if(V=V!="object"?V:re?Array.isArray(re)?"array":V:"null",V=="array"||V=="object"&&typeof re.length=="number"){V=y.length||0;const he=re.length||0;y.length=V+he;for(let Se=0;Se<he;Se++)y[V+Se]=re[Se]}else y.push(re)}}class w{constructor(A,V){this.i=A,this.j=V,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function E(y){o.setTimeout(()=>{throw y},0)}function T(){var y=O;let A=null;return y.g&&(A=y.g,y.g=y.g.next,y.g||(y.h=null),A.next=null),A}class R{constructor(){this.h=this.g=null}add(A,V){const G=I.get();G.set(A,V),this.h?this.h.next=G:this.g=G,this.h=G}}var I=new w(()=>new C,y=>y.reset());class C{constructor(){this.next=this.g=this.h=null}set(A,V){this.h=A,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let k,L=!1,O=new R,N=()=>{const y=Promise.resolve(void 0);k=()=>{y.then(D)}};function D(){for(var y;y=T();){try{y.h.call(y.g)}catch(V){E(V)}var A=I;A.j(y),A.h<100&&(A.h++,y.next=A.g,A.g=y)}L=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function F(y,A){this.type=y,this.g=this.target=A,this.defaultPrevented=!1}F.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var y=!1,A=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};o.addEventListener("test",V,A),o.removeEventListener("test",V,A)}catch{}return y})();function B(y){return/^[\s\xa0]*$/.test(y)}function J(y,A){F.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,A)}p(J,F),J.prototype.init=function(y,A){const V=this.type=y.type,G=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=A,A=y.relatedTarget,A||(V=="mouseover"?A=y.fromElement:V=="mouseout"&&(A=y.toElement)),this.relatedTarget=A,G?(this.clientX=G.clientX!==void 0?G.clientX:G.pageX,this.clientY=G.clientY!==void 0?G.clientY:G.pageY,this.screenX=G.screenX||0,this.screenY=G.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&J.Z.h.call(this)},J.prototype.h=function(){J.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var ne="closure_listenable_"+(Math.random()*1e6|0),q=0;function Y(y,A,V,G,re){this.listener=y,this.proxy=null,this.src=A,this.type=V,this.capture=!!G,this.ha=re,this.key=++q,this.da=this.fa=!1}function ee(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function ue(y,A,V){for(const G in y)A.call(V,y[G],G,y)}function fe(y,A){for(const V in y)A.call(void 0,y[V],V,y)}function W(y){const A={};for(const V in y)A[V]=y[V];return A}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(y,A){let V,G;for(let re=1;re<arguments.length;re++){G=arguments[re];for(V in G)y[V]=G[V];for(let he=0;he<Q.length;he++)V=Q[he],Object.prototype.hasOwnProperty.call(G,V)&&(y[V]=G[V])}}function ve(y){this.src=y,this.g={},this.h=0}ve.prototype.add=function(y,A,V,G,re){const he=y.toString();y=this.g[he],y||(y=this.g[he]=[],this.h++);const Se=Ae(y,A,G,re);return Se>-1?(A=y[Se],V||(A.fa=!1)):(A=new Y(A,this.src,he,!!G,re),A.fa=V,y.push(A)),A};function Te(y,A){const V=A.type;if(V in y.g){var G=y.g[V],re=Array.prototype.indexOf.call(G,A,void 0),he;(he=re>=0)&&Array.prototype.splice.call(G,re,1),he&&(ee(A),y.g[V].length==0&&(delete y.g[V],y.h--))}}function Ae(y,A,V,G){for(let re=0;re<y.length;++re){const he=y[re];if(!he.da&&he.listener==A&&he.capture==!!V&&he.ha==G)return re}return-1}var xe="closure_lm_"+(Math.random()*1e6|0),ke={};function Ie(y,A,V,G,re){if(Array.isArray(A)){for(let he=0;he<A.length;he++)Ie(y,A[he],V,G,re);return null}return V=xn(V),y&&y[ne]?y.J(A,V,u(G)?!!G.capture:!1,re):qe(y,A,V,!1,G,re)}function qe(y,A,V,G,re,he){if(!A)throw Error("Invalid event type");const Se=u(re)?!!re.capture:!!re;let st=lt(y);if(st||(y[xe]=st=new ve(y)),V=st.add(A,V,G,Se,he),V.proxy)return V;if(G=Je(),V.proxy=G,G.src=y,G.listener=V,y.addEventListener)j||(re=Se),re===void 0&&(re=!1),y.addEventListener(A.toString(),G,re);else if(y.attachEvent)y.attachEvent(ot(A.toString()),G);else if(y.addListener&&y.removeListener)y.addListener(G);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Je(){function y(V){return A.call(y.src,y.listener,V)}const A=$e;return y}function Ze(y,A,V,G,re){if(Array.isArray(A))for(var he=0;he<A.length;he++)Ze(y,A[he],V,G,re);else G=u(G)?!!G.capture:!!G,V=xn(V),y&&y[ne]?(y=y.i,he=String(A).toString(),he in y.g&&(A=y.g[he],V=Ae(A,V,G,re),V>-1&&(ee(A[V]),Array.prototype.splice.call(A,V,1),A.length==0&&(delete y.g[he],y.h--)))):y&&(y=lt(y))&&(A=y.g[A.toString()],y=-1,A&&(y=Ae(A,V,G,re)),(V=y>-1?A[y]:null)&&Xe(V))}function Xe(y){if(typeof y!="number"&&y&&!y.da){var A=y.src;if(A&&A[ne])Te(A.i,y);else{var V=y.type,G=y.proxy;A.removeEventListener?A.removeEventListener(V,G,y.capture):A.detachEvent?A.detachEvent(ot(V),G):A.addListener&&A.removeListener&&A.removeListener(G),(V=lt(A))?(Te(V,y),V.h==0&&(V.src=null,A[xe]=null)):ee(y)}}}function ot(y){return y in ke?ke[y]:ke[y]="on"+y}function $e(y,A){if(y.da)y=!0;else{A=new J(A,this);const V=y.listener,G=y.ha||y.src;y.fa&&Xe(y),y=V.call(G,A)}return y}function lt(y){return y=y[xe],y instanceof ve?y:null}var Kn="__closure_events_fn_"+(Math.random()*1e9>>>0);function xn(y){return typeof y=="function"?y:(y[Kn]||(y[Kn]=function(A){return y.handleEvent(A)}),y[Kn])}function et(){P.call(this),this.i=new ve(this),this.M=this,this.G=null}p(et,P),et.prototype[ne]=!0,et.prototype.removeEventListener=function(y,A,V,G){Ze(this,y,A,V,G)};function Vt(y,A){var V,G=y.G;if(G)for(V=[];G;G=G.G)V.push(G);if(y=y.M,G=A.type||A,typeof A=="string")A=new F(A,y);else if(A instanceof F)A.target=A.target||y;else{var re=A;A=new F(G,y),ce(A,re)}re=!0;let he,Se;if(V)for(Se=V.length-1;Se>=0;Se--)he=A.g=V[Se],re=Xn(he,G,!0,A)&&re;if(he=A.g=y,re=Xn(he,G,!0,A)&&re,re=Xn(he,G,!1,A)&&re,V)for(Se=0;Se<V.length;Se++)he=A.g=V[Se],re=Xn(he,G,!1,A)&&re}et.prototype.N=function(){if(et.Z.N.call(this),this.i){var y=this.i;for(const A in y.g){const V=y.g[A];for(let G=0;G<V.length;G++)ee(V[G]);delete y.g[A],y.h--}}this.G=null},et.prototype.J=function(y,A,V,G){return this.i.add(String(y),A,!1,V,G)},et.prototype.K=function(y,A,V,G){return this.i.add(String(y),A,!0,V,G)};function Xn(y,A,V,G){if(A=y.i.g[String(A)],!A)return!0;A=A.concat();let re=!0;for(let he=0;he<A.length;++he){const Se=A[he];if(Se&&!Se.da&&Se.capture==V){const st=Se.listener,gn=Se.ha||Se.src;Se.fa&&Te(y.i,Se),re=st.call(gn,G)!==!1&&re}}return re&&!G.defaultPrevented}function _i(y,A){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=h(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:o.setTimeout(y,A||0)}function Lr(y){y.g=_i(()=>{y.g=null,y.i&&(y.i=!1,Lr(y))},y.l);const A=y.h;y.h=null,y.m.apply(null,A)}class ln extends P{constructor(A,V){super(),this.m=A,this.l=V,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Lr(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ar(y){P.call(this),this.h=y,this.g={}}p(ar,P);var ao=[];function bi(y){ue(y.g,function(A,V){this.g.hasOwnProperty(V)&&Xe(A)},y),y.g={}}ar.prototype.N=function(){ar.Z.N.call(this),bi(this)},ar.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fn=o.JSON.stringify,ou=o.JSON.parse,ml=class{stringify(y){return o.JSON.stringify(y,void 0)}parse(y){return o.JSON.parse(y,void 0)}};function gl(){}function vl(){}var Mr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function pn(){F.call(this,"d")}p(pn,F);function yr(){F.call(this,"c")}p(yr,F);var mn={},Zd=null;function yl(){return Zd=Zd||new et}mn.Ia="serverreachability";function Jd(y){F.call(this,mn.Ia,y)}p(Jd,F);function pa(y){const A=yl();Vt(A,new Jd(A))}mn.STAT_EVENT="statevent";function su(y,A){F.call(this,mn.STAT_EVENT,y),this.stat=A}p(su,F);function wn(y){const A=yl();Vt(A,new su(A,y))}mn.Ja="timingevent";function ma(y,A){F.call(this,mn.Ja,y),this.size=A}p(ma,F);function ga(y,A){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){y()},A)}function Hi(){this.g=!0}Hi.prototype.ua=function(){this.g=!1};function Qv(y,A,V,G,re,he){y.info(function(){if(y.g)if(he){var Se="",st=he.split("&");for(let It=0;It<st.length;It++){var gn=st[It].split("=");if(gn.length>1){const tn=gn[0];gn=gn[1];const Ti=tn.split("_");Se=Ti.length>=2&&Ti[1]=="type"?Se+(tn+"="+gn+"&"):Se+(tn+"=redacted&")}}}else Se=null;else Se=he;return"XMLHTTP REQ ("+G+") [attempt "+re+"]: "+A+`
`+V+`
`+Se})}function ep(y,A,V,G,re,he,Se){y.info(function(){return"XMLHTTP RESP ("+G+") [ attempt "+re+"]: "+A+`
`+V+`
`+he+" "+Se})}function va(y,A,V,G){y.info(function(){return"XMLHTTP TEXT ("+A+"): "+Zv(y,V)+(G?" "+G:"")})}function uu(y,A){y.info(function(){return"TIMEOUT: "+A})}Hi.prototype.info=function(){};function Zv(y,A){if(!y.g)return A;if(!A)return null;try{const he=JSON.parse(A);if(he){for(y=0;y<he.length;y++)if(Array.isArray(he[y])){var V=he[y];if(!(V.length<2)){var G=V[1];if(Array.isArray(G)&&!(G.length<1)){var re=G[0];if(re!="noop"&&re!="stop"&&re!="close")for(let Se=1;Se<G.length;Se++)G[Se]=""}}}}return Fn(he)}catch{return A}}var lu={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yh={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},_h;function cu(){}p(cu,gl),cu.prototype.g=function(){return new XMLHttpRequest},_h=new cu;function oo(y){return encodeURIComponent(String(y))}function tp(y){var A=1;y=y.split(":");const V=[];for(;A>0&&y.length;)V.push(y.shift()),A--;return y.length&&V.push(y.join(":")),V}function Wi(y,A,V,G){this.j=y,this.i=A,this.l=V,this.S=G||1,this.V=new ar(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qi}function qi(){this.i=null,this.g="",this.h=!1}var En={},Yn={};function ya(y,A,V){y.M=1,y.A=hu(Cn(A)),y.u=V,y.R=!0,_l(y,null)}function _l(y,A){y.F=Date.now(),_a(y),y.B=Cn(y.A);var V=y.B,G=y.S;Array.isArray(G)||(G=[String(G)]),El(V.i,"t",G),y.C=0,V=y.j.L,y.h=new qi,y.g=gp(y.j,V?A:null,!y.u),y.P>0&&(y.O=new ln(h(y.Y,y,y.g),y.P)),A=y.V,V=y.g,G=y.ba;var re="readystatechange";Array.isArray(re)||(re&&(ao[0]=re.toString()),re=ao);for(let he=0;he<re.length;he++){const Se=Ie(V,re[he],G||A.handleEvent,!1,A.h||A);if(!Se)break;A.g[Se.key]=Se}A=y.J?W(y.J):{},y.u?(y.v||(y.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,A)):(y.v="GET",y.g.ea(y.B,y.v,null,A)),pa(),Qv(y.i,y.v,y.B,y.l,y.S,y.u)}Wi.prototype.ba=function(y){y=y.target;const A=this.O;A&&Yi(y)==3?A.j():this.Y(y)},Wi.prototype.Y=function(y){try{if(y==this.g)e:{const st=Yi(this.g),gn=this.g.ya(),It=this.g.ca();if(!(st<3)&&(st!=3||this.g&&(this.h.h||this.g.la()||or(this.g)))){this.K||st!=4||gn==7||(gn==8||It<=0?pa(3):pa(2)),ba(this);var A=this.g.ca();this.X=A;var V=Jv(this);if(this.o=A==200,ep(this.i,this.v,this.B,this.l,this.S,st,A),this.o){if(this.U&&!this.L){t:{if(this.g){var G,re=this.g;if((G=re.g?re.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(G)){var he=G;break t}}he=null}if(y=he)va(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,xa(this,y);else{this.o=!1,this.m=3,wn(12),ti(this),xi(this);break e}}if(this.R){y=!0;let tn;for(;!this.K&&this.C<V.length;)if(tn=rp(this,V),tn==Yn){st==4&&(this.m=4,wn(14),y=!1),va(this.i,this.l,null,"[Incomplete Response]");break}else if(tn==En){this.m=4,wn(15),va(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else va(this.i,this.l,tn,null),xa(this,tn);if(np(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),st!=4||V.length!=0||this.h.h||(this.m=1,wn(16),y=!1),this.o=this.o&&y,!y)va(this.i,this.l,V,"[Invalid Chunked Response]"),ti(this),xi(this);else if(V.length>0&&!this.W){this.W=!0;var Se=this.j;Se.g==this&&Se.aa&&!Se.P&&(Se.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Oh(Se),Se.P=!0,wn(11))}}else va(this.i,this.l,V,null),xa(this,V);st==4&&ti(this),this.o&&!this.K&&(st==4?fp(this.j,this):(this.o=!1,_a(this)))}else uo(this.g),A==400&&V.indexOf("Unknown SID")>0?(this.m=3,wn(12)):(this.m=0,wn(13)),ti(this),xi(this)}}}catch{}};function Jv(y){if(!np(y))return y.g.la();const A=or(y.g);if(A==="")return"";let V="";const G=A.length,re=Yi(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return ti(y),xi(y),"";y.h.i=new o.TextDecoder}for(let he=0;he<G;he++)y.h.h=!0,V+=y.h.i.decode(A[he],{stream:!(re&&he==G-1)});return A.length=0,y.h.g+=V,y.C=0,y.h.g}function np(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function rp(y,A){var V=y.C,G=A.indexOf(`
`,V);return G==-1?Yn:(V=Number(A.substring(V,G)),isNaN(V)?En:(G+=1,G+V>A.length?Yn:(A=A.slice(G,G+V),y.C=G+V,A)))}Wi.prototype.cancel=function(){this.K=!0,ti(this)};function _a(y){y.T=Date.now()+y.H,bl(y,y.H)}function bl(y,A){if(y.D!=null)throw Error("WatchDog timer not null");y.D=ga(h(y.aa,y),A)}function ba(y){y.D&&(o.clearTimeout(y.D),y.D=null)}Wi.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(uu(this.i,this.B),this.M!=2&&(pa(),wn(17)),ti(this),this.m=2,xi(this)):bl(this,this.T-y)};function xi(y){y.j.I==0||y.K||fp(y.j,y)}function ti(y){ba(y);var A=y.O;A&&typeof A.dispose=="function"&&A.dispose(),y.O=null,bi(y.V),y.g&&(A=y.g,y.g=null,A.abort(),A.dispose())}function xa(y,A){try{var V=y.j;if(V.I!=0&&(V.g==y||Ea(V.h,y))){if(!y.L&&Ea(V.h,y)&&V.I==3){try{var G=V.Ba.g.parse(A)}catch{G=null}if(Array.isArray(G)&&G.length==3){var re=G;if(re[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Rl(V),es(V);else break e;yu(V),wn(18)}}else V.xa=re[1],0<V.xa-V.K&&re[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=ga(h(V.Va,V),6e3));wa(V.h)<=1&&V.ta&&(V.ta=void 0)}else Ia(V,11)}else if((y.L||V.g==y)&&Rl(V),!B(A))for(re=V.Ba.g.parse(A),A=0;A<re.length;A++){let It=re[A];const tn=It[0];if(!(tn<=V.K))if(V.K=tn,It=It[1],V.I==2)if(It[0]=="c"){V.M=It[1],V.ba=It[2];const Ti=It[3];Ti!=null&&(V.ka=Ti,V.j.info("VER="+V.ka));const Na=It[4];Na!=null&&(V.za=Na,V.j.info("SVER="+V.za));const $i=It[5];$i!=null&&typeof $i=="number"&&$i>0&&(G=1.5*$i,V.O=G,V.j.info("backChannelRequestTimeoutMs_="+G)),G=V;const Qi=y.g;if(Qi){const _u=Qi.g?Qi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_u){var he=G.h;he.g||_u.indexOf("spdy")==-1&&_u.indexOf("quic")==-1&&_u.indexOf("h2")==-1||(he.j=he.l,he.g=new Set,he.h&&(wh(he,he.h),he.h=null))}if(G.G){const Il=Qi.g?Qi.g.getResponseHeader("X-HTTP-Session-Id"):null;Il&&(G.wa=Il,Ft(G.J,G.G,Il))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),G=V;var Se=y;if(G.na=mp(G,G.L?G.ba:null,G.W),Se.L){Eh(G.h,Se);var st=Se,gn=G.O;gn&&(st.H=gn),st.D&&(ba(st),_a(st)),G.g=Se}else cp(G);V.i.length>0&&Ra(V)}else It[0]!="stop"&&It[0]!="close"||Ia(V,7);else V.I==3&&(It[0]=="stop"||It[0]=="close"?It[0]=="stop"?Ia(V,7):kh(V):It[0]!="noop"&&V.l&&V.l.qa(It),V.A=0)}}pa(4)}catch{}}var Tn=class{constructor(y,A){this.g=y,this.map=A}};function bh(y){this.l=y||10,o.PerformanceNavigationTiming?(y=o.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function xh(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function wa(y){return y.h?1:y.g?y.g.size:0}function Ea(y,A){return y.h?y.h==A:y.g?y.g.has(A):!1}function wh(y,A){y.g?y.g.add(A):y.h=A}function Eh(y,A){y.h&&y.h==A?y.h=null:y.g&&y.g.has(A)&&y.g.delete(A)}bh.prototype.cancel=function(){if(this.i=Th(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Th(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let A=y.i;for(const V of y.g.values())A=A.concat(V.G);return A}return v(y.i)}var ip=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xl(y,A){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const G=y[V].indexOf("=");let re,he=null;G>=0?(re=y[V].substring(0,G),he=y[V].substring(G+1)):re=y[V],A(re,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}function ni(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;y instanceof ni?(this.l=y.l,$n(this,y.j),this.o=y.o,this.g=y.g,Ko(this,y.u),this.h=y.h,Ch(this,up(y.i)),this.m=y.m):y&&(A=String(y).match(ip))?(this.l=!1,$n(this,A[1]||"",!0),this.o=Ta(A[2]||""),this.g=Ta(A[3]||"",!0),Ko(this,A[4]),this.h=Ta(A[5]||"",!0),Ch(this,A[6]||"",!0),this.m=Ta(A[7]||"")):(this.l=!1,this.i=new Yo(null,this.l))}ni.prototype.toString=function(){const y=[];var A=this.j;A&&y.push(fu(A,wl,!0),":");var V=this.g;return(V||A=="file")&&(y.push("//"),(A=this.o)&&y.push(fu(A,wl,!0),"@"),y.push(oo(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push(fu(V,V.charAt(0)=="/"?Sh:ap,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",fu(V,op)),y.join("")},ni.prototype.resolve=function(y){const A=Cn(this);let V=!!y.j;V?$n(A,y.j):V=!!y.o,V?A.o=y.o:V=!!y.g,V?A.g=y.g:V=y.u!=null;var G=y.h;if(V)Ko(A,y.u);else if(V=!!y.h){if(G.charAt(0)!="/")if(this.g&&!this.h)G="/"+G;else{var re=A.h.lastIndexOf("/");re!=-1&&(G=A.h.slice(0,re+1)+G)}if(re=G,re==".."||re==".")G="";else if(re.indexOf("./")!=-1||re.indexOf("/.")!=-1){G=re.lastIndexOf("/",0)==0,re=re.split("/");const he=[];for(let Se=0;Se<re.length;){const st=re[Se++];st=="."?G&&Se==re.length&&he.push(""):st==".."?((he.length>1||he.length==1&&he[0]!="")&&he.pop(),G&&Se==re.length&&he.push("")):(he.push(st),G=!0)}G=he.join("/")}else G=re}return V?A.h=G:V=y.i.toString()!=="",V?Ch(A,up(y.i)):V=!!y.m,V&&(A.m=y.m),A};function Cn(y){return new ni(y)}function $n(y,A,V){y.j=V?Ta(A,!0):A,y.j&&(y.j=y.j.replace(/:$/,""))}function Ko(y,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);y.u=A}else y.u=null}function Ch(y,A,V){A instanceof Yo?(y.i=A,Tl(y.i,y.l)):(V||(A=fu(A,Xo)),y.i=new Yo(A,y.l))}function Ft(y,A,V){y.i.set(A,V)}function hu(y){return Ft(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function Ta(y,A){return y?A?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function fu(y,A,V){return typeof y=="string"?(y=encodeURI(y).replace(A,Br),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function Br(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var wl=/[#\/\?@]/g,ap=/[#\?:]/g,Sh=/[#\?]/g,Xo=/[#\?@]/g,op=/#/g;function Yo(y,A){this.h=this.g=null,this.i=y||null,this.j=!!A}function jr(y){y.g||(y.g=new Map,y.h=0,y.i&&xl(y.i,function(A,V){y.add(decodeURIComponent(A.replace(/\+/g," ")),V)}))}n=Yo.prototype,n.add=function(y,A){jr(this),this.i=null,y=$o(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(A),this.h+=1,this};function sp(y,A){jr(y),A=$o(y,A),y.g.has(A)&&(y.i=null,y.h-=y.g.get(A).length,y.g.delete(A))}function Ah(y,A){return jr(y),A=$o(y,A),y.g.has(A)}n.forEach=function(y,A){jr(this),this.g.forEach(function(V,G){V.forEach(function(re){y.call(A,re,G,this)},this)},this)};function Rh(y,A){jr(y);let V=[];if(typeof A=="string")Ah(y,A)&&(V=V.concat(y.g.get($o(y,A))));else for(y=Array.from(y.g.values()),A=0;A<y.length;A++)V=V.concat(y[A]);return V}n.set=function(y,A){return jr(this),this.i=null,y=$o(this,y),Ah(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[A]),this.h+=1,this},n.get=function(y,A){return y?(y=Rh(this,y),y.length>0?String(y[0]):A):A};function El(y,A,V){sp(y,A),V.length>0&&(y.i=null,y.g.set($o(y,A),v(V)),y.h+=V.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],A=Array.from(this.g.keys());for(let G=0;G<A.length;G++){var V=A[G];const re=oo(V);V=Rh(this,V);for(let he=0;he<V.length;he++){let Se=re;V[he]!==""&&(Se+="="+oo(V[he])),y.push(Se)}}return this.i=y.join("&")};function up(y){const A=new Yo;return A.i=y.i,y.g&&(A.g=new Map(y.g),A.h=y.h),A}function $o(y,A){return A=String(A),y.j&&(A=A.toLowerCase()),A}function Tl(y,A){A&&!y.j&&(jr(y),y.i=null,y.g.forEach(function(V,G){const re=G.toLowerCase();G!=re&&(sp(this,G),El(this,re,V))},y)),y.j=A}function Ki(y,A){const V=new Hi;if(o.Image){const G=new Image;G.onload=d(wi,V,"TestLoadImage: loaded",!0,A,G),G.onerror=d(wi,V,"TestLoadImage: error",!1,A,G),G.onabort=d(wi,V,"TestLoadImage: abort",!1,A,G),G.ontimeout=d(wi,V,"TestLoadImage: timeout",!1,A,G),o.setTimeout(function(){G.ontimeout&&G.ontimeout()},1e4),G.src=y}else A(!1)}function Ih(y,A){const V=new Hi,G=new AbortController,re=setTimeout(()=>{G.abort(),wi(V,"TestPingServer: timeout",!1,A)},1e4);fetch(y,{signal:G.signal}).then(he=>{clearTimeout(re),he.ok?wi(V,"TestPingServer: ok",!0,A):wi(V,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(re),wi(V,"TestPingServer: error",!1,A)})}function wi(y,A,V,G,re){try{re&&(re.onload=null,re.onerror=null,re.onabort=null,re.ontimeout=null),G(V)}catch{}}function Qo(){this.g=new ml}function Ca(y){this.i=y.Sb||null,this.h=y.ab||!1}p(Ca,gl),Ca.prototype.g=function(){return new du(this.i,this.h)};function du(y,A){et.call(this),this.H=y,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(du,et),n=du.prototype,n.open=function(y,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=A,this.readyState=1,Xi(this)},n.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(A.body=y),(this.H||o).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Zo(this)),this.readyState=0},n.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Xi(this)),this.g&&(this.readyState=3,Xi(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Cl(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Cl(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}n.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var A=y.value?y.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!y.done}))&&(this.response=this.responseText+=A)}y.done?Zo(this):Xi(this),this.readyState==3&&Cl(this)}},n.Oa=function(y){this.g&&(this.response=this.responseText=y,Zo(this))},n.Na=function(y){this.g&&(this.response=y,Zo(this))},n.ga=function(){this.g&&Zo(this)};function Zo(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Xi(y)}n.setRequestHeader=function(y,A){this.A.append(y,A)},n.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],A=this.h.entries();for(var V=A.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=A.next();return y.join(`\r
`)};function Xi(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(du.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Ei(y){let A="";return ue(y,function(V,G){A+=G,A+=":",A+=V,A+=`\r
`}),A}function pu(y,A,V){e:{for(G in V){var G=!1;break e}G=!0}G||(V=Ei(V),typeof y=="string"?V!=null&&oo(V):Ft(y,A,V))}function jt(y){et.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(jt,et);var Sa=/^https?$/i,Nh=["POST","PUT"];n=jt.prototype,n.Fa=function(y){this.H=y},n.ea=function(y,A,V,G){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);A=A?A.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_h.g(),this.g.onreadystatechange=g(h(this.Ca,this));try{this.B=!0,this.g.open(A,String(y),!0),this.B=!1}catch(he){mu(this,he);return}if(y=V||"",V=new Map(this.headers),G)if(Object.getPrototypeOf(G)===Object.prototype)for(var re in G)V.set(re,G[re]);else if(typeof G.keys=="function"&&typeof G.get=="function")for(const he of G.keys())V.set(he,G.get(he));else throw Error("Unknown input type for opt_headers: "+String(G));G=Array.from(V.keys()).find(he=>he.toLowerCase()=="content-type"),re=o.FormData&&y instanceof o.FormData,!(Array.prototype.indexOf.call(Nh,A,void 0)>=0)||G||re||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[he,Se]of V)this.g.setRequestHeader(he,Se);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(he){mu(this,he)}};function mu(y,A){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=A,y.o=5,Dh(y),so(y)}function Dh(y){y.A||(y.A=!0,Vt(y,"complete"),Vt(y,"error"))}n.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Vt(this,"complete"),Vt(this,"abort"),so(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),so(this,!0)),jt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?gu(this):this.Xa())},n.Xa=function(){gu(this)};function gu(y){if(y.h&&typeof a<"u"){if(y.v&&Yi(y)==4)setTimeout(y.Ca.bind(y),0);else if(Vt(y,"readystatechange"),Yi(y)==4){y.h=!1;try{const he=y.ca();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var V;if(!(V=A)){var G;if(G=he===0){let Se=String(y.D).match(ip)[1]||null;!Se&&o.self&&o.self.location&&(Se=o.self.location.protocol.slice(0,-1)),G=!Sa.test(Se?Se.toLowerCase():"")}V=G}if(V)Vt(y,"complete"),Vt(y,"success");else{y.o=6;try{var re=Yi(y)>2?y.g.statusText:""}catch{re=""}y.l=re+" ["+y.ca()+"]",Dh(y)}}finally{so(y)}}}}function so(y,A){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,A||Vt(y,"ready");try{V.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yi(y){return y.g?y.g.readyState:0}n.ca=function(){try{return Yi(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(y){if(this.g){var A=this.g.responseText;return y&&A.indexOf(y)==0&&(A=A.substring(y.length)),ou(A)}};function or(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function uo(y){const A={};y=(y.g&&Yi(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let G=0;G<y.length;G++){if(B(y[G]))continue;var V=tp(y[G]);const re=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const he=A[re]||[];A[re]=he,he.push(V)}fe(A,function(G){return G.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Aa(y,A,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||A}function Jo(y){this.za=0,this.i=[],this.j=new Hi,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Aa("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Aa("baseRetryDelayMs",5e3,y),this.Za=Aa("retryDelaySeedMs",1e4,y),this.Ta=Aa("forwardChannelMaxRetries",2,y),this.va=Aa("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new bh(y&&y.concurrentRequestLimit),this.Ba=new Qo,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Jo.prototype,n.ka=8,n.I=1,n.connect=function(y,A,V,G){wn(0),this.W=y,this.H=A||{},V&&G!==void 0&&(this.H.OSID=V,this.H.OAID=G),this.F=this.X,this.J=mp(this,null,this.W),Ra(this)};function kh(y){if(Sl(y),y.I==3){var A=y.V++,V=Cn(y.J);if(Ft(V,"SID",y.M),Ft(V,"RID",A),Ft(V,"TYPE","terminate"),vu(y,V),A=new Wi(y,y.j,A),A.M=2,A.A=hu(Cn(V)),V=!1,o.navigator&&o.navigator.sendBeacon)try{V=o.navigator.sendBeacon(A.A.toString(),"")}catch{}!V&&o.Image&&(new Image().src=A.A,V=!0),V||(A.g=gp(A.j,null),A.g.ea(A.A)),A.F=Date.now(),_a(A)}pp(y)}function es(y){y.g&&(Oh(y),y.g.cancel(),y.g=null)}function Sl(y){es(y),y.v&&(o.clearTimeout(y.v),y.v=null),Rl(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&o.clearTimeout(y.m),y.m=null)}function Ra(y){if(!xh(y.h)&&!y.m){y.m=!0;var A=y.Ea;k||N(),L||(k(),L=!0),O.add(A,y),y.D=0}}function Al(y,A){return wa(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=A.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=ga(h(y.Ea,y,A),dp(y,y.D)),y.D++,!0)}n.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const re=new Wi(this,this.j,y);let he=this.o;if(this.U&&(he?(he=W(he),ce(he,this.U)):he=this.U),this.u!==null||this.R||(re.J=he,he=null),this.S)e:{for(var A=0,V=0;V<this.i.length;V++){t:{var G=this.i[V];if("__data__"in G.map&&(G=G.map.__data__,typeof G=="string")){G=G.length;break t}G=void 0}if(G===void 0)break;if(A+=G,A>4096){A=V;break e}if(A===4096||V===this.i.length-1){A=V+1;break e}}A=1e3}else A=1e3;A=lp(this,re,A),V=Cn(this.J),Ft(V,"RID",y),Ft(V,"CVER",22),this.G&&Ft(V,"X-HTTP-Session-Id",this.G),vu(this,V),he&&(this.R?A="headers="+oo(Ei(he))+"&"+A:this.u&&pu(V,this.u,he)),wh(this.h,re),this.Ra&&Ft(V,"TYPE","init"),this.S?(Ft(V,"$req",A),Ft(V,"SID","null"),re.U=!0,ya(re,V,null)):ya(re,V,A),this.I=2}}else this.I==3&&(y?Mh(this,y):this.i.length==0||xh(this.h)||Mh(this))};function Mh(y,A){var V;A?V=A.l:V=y.V++;const G=Cn(y.J);Ft(G,"SID",y.M),Ft(G,"RID",V),Ft(G,"AID",y.K),vu(y,G),y.u&&y.o&&pu(G,y.u,y.o),V=new Wi(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),A&&(y.i=A.G.concat(y.i)),A=lp(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),wh(y.h,V),ya(V,G,A)}function vu(y,A){y.H&&ue(y.H,function(V,G){Ft(A,G,V)}),y.l&&ue({},function(V,G){Ft(A,G,V)})}function lp(y,A,V){V=Math.min(y.i.length,V);const G=y.l?h(y.l.Ka,y.l,y):null;e:{var re=y.i;let st=-1;for(;;){const gn=["count="+V];st==-1?V>0?(st=re[0].g,gn.push("ofs="+st)):st=0:gn.push("ofs="+st);let It=!0;for(let tn=0;tn<V;tn++){var he=re[tn].g;const Ti=re[tn].map;if(he-=st,he<0)st=Math.max(0,re[tn].g-100),It=!1;else try{he="req"+he+"_"||"";try{var Se=Ti instanceof Map?Ti:Object.entries(Ti);for(const[Na,$i]of Se){let Qi=$i;u($i)&&(Qi=Fn($i)),gn.push(he+Na+"="+encodeURIComponent(Qi))}}catch(Na){throw gn.push(he+"type="+encodeURIComponent("_badmap")),Na}}catch{G&&G(Ti)}}if(It){Se=gn.join("&");break e}}Se=void 0}return y=y.i.splice(0,V),A.G=y,Se}function cp(y){if(!y.g&&!y.v){y.Y=1;var A=y.Da;k||N(),L||(k(),L=!0),O.add(A,y),y.A=0}}function yu(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=ga(h(y.Da,y),dp(y,y.A)),y.A++,!0)}n.Da=function(){if(this.v=null,hp(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=ga(h(this.Wa,this),y)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,wn(10),es(this),hp(this))};function Oh(y){y.B!=null&&(o.clearTimeout(y.B),y.B=null)}function hp(y){y.g=new Wi(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var A=Cn(y.na);Ft(A,"RID","rpc"),Ft(A,"SID",y.M),Ft(A,"AID",y.K),Ft(A,"CI",y.F?"0":"1"),!y.F&&y.ia&&Ft(A,"TO",y.ia),Ft(A,"TYPE","xmlhttp"),vu(y,A),y.u&&y.o&&pu(A,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=hu(Cn(A)),V.u=null,V.R=!0,_l(V,y)}n.Va=function(){this.C!=null&&(this.C=null,es(this),yu(this),wn(19))};function Rl(y){y.C!=null&&(o.clearTimeout(y.C),y.C=null)}function fp(y,A){var V=null;if(y.g==A){Rl(y),Oh(y),y.g=null;var G=2}else if(Ea(y.h,A))V=A.G,Eh(y.h,A),G=1;else return;if(y.I!=0){if(A.o)if(G==1){V=A.u?A.u.length:0,A=Date.now()-A.F;var re=y.D;G=yl(),Vt(G,new ma(G,V)),Ra(y)}else cp(y);else if(re=A.m,re==3||re==0&&A.X>0||!(G==1&&Al(y,A)||G==2&&yu(y)))switch(V&&V.length>0&&(A=y.h,A.i=A.i.concat(V)),re){case 1:Ia(y,5);break;case 4:Ia(y,10);break;case 3:Ia(y,6);break;default:Ia(y,2)}}}function dp(y,A){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*A}function Ia(y,A){if(y.j.info("Error code "+A),A==2){var V=h(y.bb,y),G=y.Ua;const re=!G;G=new ni(G||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||$n(G,"https"),hu(G),re?Ki(G.toString(),V):Ih(G.toString(),V)}else wn(2);y.I=0,y.l&&y.l.pa(A),pp(y),Sl(y)}n.bb=function(y){y?(this.j.info("Successfully pinged google.com"),wn(2)):(this.j.info("Failed to ping google.com"),wn(1))};function pp(y){if(y.I=0,y.ja=[],y.l){const A=Th(y.h);(A.length!=0||y.i.length!=0)&&(b(y.ja,A),b(y.ja,y.i),y.h.i.length=0,v(y.i),y.i.length=0),y.l.oa()}}function mp(y,A,V){var G=V instanceof ni?Cn(V):new ni(V);if(G.g!="")A&&(G.g=A+"."+G.g),Ko(G,G.u);else{var re=o.location;G=re.protocol,A=A?A+"."+re.hostname:re.hostname,re=+re.port;const he=new ni(null);G&&$n(he,G),A&&(he.g=A),re&&Ko(he,re),V&&(he.h=V),G=he}return V=y.G,A=y.wa,V&&A&&Ft(G,V,A),Ft(G,"VER",y.ka),vu(y,G),G}function gp(y,A,V){if(A&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=y.Aa&&!y.ma?new jt(new Ca({ab:V})):new jt(y.ma),A.Fa(y.L),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function vp(){}n=vp.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ts(){}ts.prototype.g=function(y,A){return new Or(y,A)};function Or(y,A){et.call(this),this.g=new Jo(A),this.l=y,this.h=A&&A.messageUrlParams||null,y=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(y?y["X-WebChannel-Content-Type"]=A.messageContentType:y={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(y?y["X-WebChannel-Client-Profile"]=A.sa:y={"X-WebChannel-Client-Profile":A.sa}),this.g.U=y,(y=A&&A.Qb)&&!B(y)&&(this.g.u=y),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!B(A)&&(this.g.G=A,y=this.h,y!==null&&A in y&&(y=this.h,A in y&&delete y[A])),this.j=new lo(this)}p(Or,et),Or.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Or.prototype.close=function(){kh(this.g)},Or.prototype.o=function(y){var A=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=Fn(y),y=V);A.i.push(new Tn(A.Ya++,y)),A.I==3&&Ra(A)},Or.prototype.N=function(){this.g.l=null,delete this.j,kh(this.g),delete this.g,Or.Z.N.call(this)};function yp(y){pn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var A=y.__sm__;if(A){e:{for(const V in A){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,A=A!==null&&y in A?A[y]:void 0),this.data=A}else this.data=y}p(yp,pn);function _p(){yr.call(this),this.status=1}p(_p,yr);function lo(y){this.g=y}p(lo,vp),lo.prototype.ra=function(){Vt(this.g,"a")},lo.prototype.qa=function(y){Vt(this.g,new yp(y))},lo.prototype.pa=function(y){Vt(this.g,new _p)},lo.prototype.oa=function(){Vt(this.g,"b")},ts.prototype.createWebChannel=ts.prototype.g,Or.prototype.send=Or.prototype.o,Or.prototype.open=Or.prototype.m,Or.prototype.close=Or.prototype.close,z3=function(){return new ts},U3=function(){return yl()},j3=mn,r1={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},lu.NO_ERROR=0,lu.TIMEOUT=8,lu.HTTP_ERROR=6,tg=lu,yh.COMPLETE="complete",B3=yh,vl.EventType=Mr,Mr.OPEN="a",Mr.CLOSE="b",Mr.ERROR="c",Mr.MESSAGE="d",et.prototype.listen=et.prototype.J,Df=vl,jt.prototype.listenOnce=jt.prototype.K,jt.prototype.getLastError=jt.prototype.Ha,jt.prototype.getLastErrorCode=jt.prototype.ya,jt.prototype.getStatus=jt.prototype.ca,jt.prototype.getResponseJson=jt.prototype.La,jt.prototype.getResponseText=jt.prototype.la,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Fa,L3=jt}).apply(typeof Um<"u"?Um:typeof self<"u"?self:typeof window<"u"?window:{});const kR="@firebase/firestore",MR="4.9.3";class wr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}wr.UNAUTHENTICATED=new wr(null),wr.GOOGLE_CREDENTIALS=new wr("google-credentials-uid"),wr.FIRST_PARTY=new wr("first-party-uid"),wr.MOCK_USER=new wr("mock-user");let lh="12.7.0";const tl=new xw("@firebase/firestore");function mc(){return tl.logLevel}function Me(n,...e){if(tl.logLevel<=xt.DEBUG){const t=e.map(Ew);tl.debug(`Firestore (${lh}): ${n}`,...t)}}function Vo(n,...e){if(tl.logLevel<=xt.ERROR){const t=e.map(Ew);tl.error(`Firestore (${lh}): ${n}`,...t)}}function Xc(n,...e){if(tl.logLevel<=xt.WARN){const t=e.map(Ew);tl.warn(`Firestore (${lh}): ${n}`,...t)}}function Ew(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function Ye(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,G3(n,r,t)}function G3(n,e,t){let r=`FIRESTORE (${lh}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Vo(r),new Error(r)}function Ot(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||G3(e,i,r)}function at(n,e){return n}const _e={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class De extends uh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Fs{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class H3{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fK{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(wr.UNAUTHENTICATED)))}shutdown(){}}class dK{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class pK{constructor(e){this.t=e,this.currentUser=wr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ot(this.o===void 0,42304);let r=this.i;const i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let a=new Fs;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Fs,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const c=a;e.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},u=c=>{Me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>u(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(Me("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Fs)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(Me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ot(typeof r.accessToken=="string",31837,{l:r}),new H3(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ot(e===null||typeof e=="string",2055,{h:e}),new wr(e)}}class mK{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=wr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class gK{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new mK(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(wr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class OR{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vK{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,D3(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ot(this.o===void 0,3512);const r=a=>{a.error!=null&&Me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,Me("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable((()=>r(a)))};const i=a=>{Me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((a=>i(a))),setTimeout((()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?i(a):Me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new OR(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Ot(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new OR(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function yK(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Tw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=yK(40);for(let a=0;a<i.length;++a)r.length<20&&i[a]<t&&(r+=e.charAt(i[a]%62))}return r}}function yt(n,e){return n<e?-1:n>e?1:0}function i1(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),a=e.charAt(r);if(i!==a)return W_(i)===W_(a)?yt(i,a):W_(i)?1:-1}return yt(n.length,e.length)}const _K=55296,bK=57343;function W_(n){const e=n.charCodeAt(0);return e>=_K&&e<=bK}function Yc(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}const PR="__name__";class La{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ye(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&Ye(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return La.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof La?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const a=La.compareSegments(e.get(i),t.get(i));if(a!==0)return a}return yt(e.length,t.length)}static compareSegments(e,t){const r=La.isNumericId(e),i=La.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?La.extractNumericId(e).compare(La.extractNumericId(t)):i1(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vs.fromString(e.substring(4,e.length-2))}}class qt extends La{construct(e,t,r){return new qt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new De(_e.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new qt(t)}static emptyPath(){return new qt([])}}const xK=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gr extends La{construct(e,t,r){return new gr(e,t,r)}static isValidIdentifier(e){return xK.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===PR}static keyField(){return new gr([PR])}static fromServerFormat(e){const t=[];let r="",i=0;const a=()=>{if(r.length===0)throw new De(_e.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new De(_e.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new De(_e.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else u==="`"?(o=!o,i++):u!=="."||o?(r+=u,i++):(a(),i++)}if(a(),o)throw new De(_e.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new gr(t)}static emptyPath(){return new gr([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We(qt.fromString(e))}static fromName(e){return new We(qt.fromString(e).popFirst(5))}static empty(){return new We(qt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&qt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return qt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new qt(e.slice()))}}function W3(n,e,t){if(!t)throw new De(_e.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function wK(n,e,t,r){if(e===!0&&r===!0)throw new De(_e.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function VR(n){if(!We.isDocumentKey(n))throw new De(_e.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function FR(n){if(We.isDocumentKey(n))throw new De(_e.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function q3(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Av(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ye(12329,{type:typeof n})}function Fo(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new De(_e.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Av(n);throw new De(_e.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function EK(n,e){if(e<=0)throw new De(_e.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function On(n,e){const t={typeString:n};return e&&(t.value=e),t}function jd(n,e){if(!q3(n))throw new De(_e.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,a="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(a!==void 0&&o!==a.value){t=`Expected '${r}' field to equal '${a.value}'`;break}}if(t)throw new De(_e.INVALID_ARGUMENT,t);return!0}const LR=-62135596800,BR=1e6;class Jt{static now(){return Jt.fromMillis(Date.now())}static fromDate(e){return Jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*BR);return new Jt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new De(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new De(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<LR)throw new De(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new De(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/BR}_compareTo(e){return this.seconds===e.seconds?yt(this.nanoseconds,e.nanoseconds):yt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Jt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(jd(e,Jt._jsonSchema))return new Jt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-LR;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Jt._jsonSchemaVersion="firestore/timestamp/1.0",Jt._jsonSchema={type:On("string",Jt._jsonSchemaVersion),seconds:On("number"),nanoseconds:On("number")};class tt{static fromTimestamp(e){return new tt(e)}static min(){return new tt(new Jt(0,0))}static max(){return new tt(new Jt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const fd=-1;function TK(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=tt.fromTimestamp(r===1e9?new Jt(t+1,0):new Jt(t,r));return new Ws(i,We.empty(),e)}function CK(n){return new Ws(n.readTime,n.key,fd)}class Ws{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ws(tt.min(),We.empty(),fd)}static max(){return new Ws(tt.max(),We.empty(),fd)}}function SK(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=We.comparator(n.documentKey,e.documentKey),t!==0?t:yt(n.largestBatchId,e.largestBatchId))}const AK="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class RK{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ch(n){if(n.code!==_e.FAILED_PRECONDITION||n.message!==AK)throw n;Me("LocalStore","Unexpectedly lost primary lease")}class we{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ye(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new we(((r,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,i)},this.catchCallback=a=>{this.wrapFailure(t,a).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof we?t:we.resolve(t)}catch(t){return we.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):we.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):we.reject(t)}static resolve(e){return new we(((t,r)=>{t(e)}))}static reject(e){return new we(((t,r)=>{r(e)}))}static waitFor(e){return new we(((t,r)=>{let i=0,a=0,o=!1;e.forEach((u=>{++i,u.next((()=>{++a,o&&a===i&&t()}),(c=>r(c)))})),o=!0,a===i&&t()}))}static or(e){let t=we.resolve(!1);for(const r of e)t=t.next((i=>i?we.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,a)=>{r.push(t.call(this,i,a))})),this.waitFor(r)}static mapArray(e,t){return new we(((r,i)=>{const a=e.length,o=new Array(a);let u=0;for(let c=0;c<a;c++){const h=c;t(e[h]).next((d=>{o[h]=d,++u,u===a&&r(o)}),(d=>i(d)))}}))}static doWhile(e,t){return new we(((r,i)=>{const a=()=>{e()===!0?t().next((()=>{a()}),i):r()};a()}))}}function IK(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function hh(n){return n.name==="IndexedDbTransactionError"}class Rv{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Rv.ce=-1;const Cw=-1;function Iv(n){return n==null}function Ug(n){return n===0&&1/n==-1/0}function NK(n){return typeof n=="number"&&Number.isInteger(n)&&!Ug(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const K3="";function DK(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=jR(e)),e=kK(n.get(t),e);return jR(e)}function kK(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const a=n.charAt(i);switch(a){case"\0":t+="";break;case K3:t+="";break;default:t+=a}}return t}function jR(n){return n+K3+""}function UR(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function nu(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function X3(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}let Vn=class a1{constructor(e,t){this.comparator=e,this.root=t||Ls.EMPTY}insert(e,t){return new a1(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ls.BLACK,null,null))}remove(e){return new a1(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ls.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zm(this.root,e,this.comparator,!1)}getReverseIterator(){return new zm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zm(this.root,e,this.comparator,!0)}},zm=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?r(e.key,t):1,t&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ls=class Ro{constructor(e,t,r,i,a){this.key=e,this.value=t,this.color=r??Ro.RED,this.left=i??Ro.EMPTY,this.right=a??Ro.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,a){return new Ro(e??this.key,t??this.value,r??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const a=r(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,t,r),null):a===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ro.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ro.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ro.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ro.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ye(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ye(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ye(27949);return e+(this.isRed()?0:1)}};Ls.EMPTY=null,Ls.RED=!0,Ls.BLACK=!1;Ls.EMPTY=new class{constructor(){this.size=0}get key(){throw Ye(57766)}get value(){throw Ye(16141)}get color(){throw Ye(16727)}get left(){throw Ye(29726)}get right(){throw Ye(36894)}copy(e,t,r,i,a){return this}insert(e,t,r){return new Ls(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Gn{constructor(e){this.comparator=e,this.data=new Vn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zR(this.data.getIterator())}getIteratorFrom(e){return new zR(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Gn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=r.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Gn(this.comparator);return t.data=e,t}}class zR{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class mi{constructor(e){this.fields=e,e.sort(gr.comparator)}static empty(){return new mi([])}unionWith(e){let t=new Gn(gr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new mi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Yc(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Y3 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class vr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new Y3("Invalid base64 string: "+a):a}})(e);return new vr(t)}static fromUint8Array(e){const t=(function(i){let a="";for(let o=0;o<i.length;++o)a+=String.fromCharCode(i[o]);return a})(e);return new vr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return yt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vr.EMPTY_BYTE_STRING=new vr("");const MK=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qs(n){if(Ot(!!n,39018),typeof n=="string"){let e=0;const t=MK.exec(n);if(Ot(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_n(n.seconds),nanos:_n(n.nanos)}}function _n(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ks(n){return typeof n=="string"?vr.fromBase64String(n):vr.fromUint8Array(n)}const $3="server_timestamp",Q3="__type__",Z3="__previous_value__",J3="__local_write_time__";function Sw(n){return(n?.mapValue?.fields||{})[Q3]?.stringValue===$3}function Nv(n){const e=n.mapValue.fields[Z3];return Sw(e)?Nv(e):e}function dd(n){const e=qs(n.mapValue.fields[J3].timestampValue);return new Jt(e.seconds,e.nanos)}class OK{constructor(e,t,r,i,a,o,u,c,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=d}}const zg="(default)";class pd{constructor(e,t){this.projectId=e,this.database=t||zg}static empty(){return new pd("","")}get isDefaultDatabase(){return this.database===zg}isEqual(e){return e instanceof pd&&e.projectId===this.projectId&&e.database===this.database}}const e4="__type__",PK="__max__",Gm={mapValue:{}},t4="__vector__",Gg="value";function Xs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sw(n)?4:FK(n)?9007199254740991:VK(n)?10:11:Ye(28295,{value:n})}function eo(n,e){if(n===e)return!0;const t=Xs(n);if(t!==Xs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return dd(n).isEqual(dd(e));case 3:return(function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const o=qs(i.timestampValue),u=qs(a.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,a){return Ks(i.bytesValue).isEqual(Ks(a.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,a){return _n(i.geoPointValue.latitude)===_n(a.geoPointValue.latitude)&&_n(i.geoPointValue.longitude)===_n(a.geoPointValue.longitude)})(n,e);case 2:return(function(i,a){if("integerValue"in i&&"integerValue"in a)return _n(i.integerValue)===_n(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const o=_n(i.doubleValue),u=_n(a.doubleValue);return o===u?Ug(o)===Ug(u):isNaN(o)&&isNaN(u)}return!1})(n,e);case 9:return Yc(n.arrayValue.values||[],e.arrayValue.values||[],eo);case 10:case 11:return(function(i,a){const o=i.mapValue.fields||{},u=a.mapValue.fields||{};if(UR(o)!==UR(u))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(u[c]===void 0||!eo(o[c],u[c])))return!1;return!0})(n,e);default:return Ye(52216,{left:n})}}function md(n,e){return(n.values||[]).find((t=>eo(t,e)))!==void 0}function $c(n,e){if(n===e)return 0;const t=Xs(n),r=Xs(e);if(t!==r)return yt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return yt(n.booleanValue,e.booleanValue);case 2:return(function(a,o){const u=_n(a.integerValue||a.doubleValue),c=_n(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1})(n,e);case 3:return GR(n.timestampValue,e.timestampValue);case 4:return GR(dd(n),dd(e));case 5:return i1(n.stringValue,e.stringValue);case 6:return(function(a,o){const u=Ks(a),c=Ks(o);return u.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(a,o){const u=a.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){const d=yt(u[h],c[h]);if(d!==0)return d}return yt(u.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(a,o){const u=yt(_n(a.latitude),_n(o.latitude));return u!==0?u:yt(_n(a.longitude),_n(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return HR(n.arrayValue,e.arrayValue);case 10:return(function(a,o){const u=a.fields||{},c=o.fields||{},h=u[Gg]?.arrayValue,d=c[Gg]?.arrayValue,p=yt(h?.values?.length||0,d?.values?.length||0);return p!==0?p:HR(h,d)})(n.mapValue,e.mapValue);case 11:return(function(a,o){if(a===Gm.mapValue&&o===Gm.mapValue)return 0;if(a===Gm.mapValue)return 1;if(o===Gm.mapValue)return-1;const u=a.fields||{},c=Object.keys(u),h=o.fields||{},d=Object.keys(h);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){const g=i1(c[p],d[p]);if(g!==0)return g;const v=$c(u[c[p]],h[d[p]]);if(v!==0)return v}return yt(c.length,d.length)})(n.mapValue,e.mapValue);default:throw Ye(23264,{he:t})}}function GR(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return yt(n,e);const t=qs(n),r=qs(e),i=yt(t.seconds,r.seconds);return i!==0?i:yt(t.nanos,r.nanos)}function HR(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const a=$c(t[i],r[i]);if(a)return a}return yt(t.length,r.length)}function Qc(n){return o1(n)}function o1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=qs(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ks(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return We.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const a of t.values||[])i?i=!1:r+=",",r+=o1(a);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",a=!0;for(const o of r)a?a=!1:i+=",",i+=`${o}:${o1(t.fields[o])}`;return i+"}"})(n.mapValue):Ye(61005,{value:n})}function ng(n){switch(Xs(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Nv(n);return e?16+ng(e):16;case 5:return 2*n.stringValue.length;case 6:return Ks(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,a)=>i+ng(a)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return nu(r.fields,((a,o)=>{i+=a.length+ng(o)})),i})(n.mapValue);default:throw Ye(13486,{value:n})}}function WR(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function s1(n){return!!n&&"integerValue"in n}function Aw(n){return!!n&&"arrayValue"in n}function qR(n){return!!n&&"nullValue"in n}function KR(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function rg(n){return!!n&&"mapValue"in n}function VK(n){return(n?.mapValue?.fields||{})[e4]?.stringValue===t4}function zf(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return nu(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=zf(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zf(n.arrayValue.values[t]);return e}return{...n}}function FK(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===PK}class Yr{constructor(e){this.value=e}static empty(){return new Yr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!rg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zf(t)}setAll(e){let t=gr.emptyPath(),r={},i=[];e.forEach(((o,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=u.popLast()}o?r[u.lastSegment()]=zf(o):i.push(u.lastSegment())}));const a=this.getFieldsMap(t);this.applyChanges(a,r,i)}delete(e){const t=this.field(e.popLast());rg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return eo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];rg(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){nu(t,((i,a)=>e[i]=a));for(const i of r)delete e[i]}clone(){return new Yr(zf(this.value))}}function n4(n){const e=[];return nu(n.fields,((t,r)=>{const i=new gr([t]);if(rg(r)){const a=n4(r.mapValue).fields;if(a.length===0)e.push(i);else for(const o of a)e.push(i.child(o))}else e.push(i)})),new mi(e)}class Tr{constructor(e,t,r,i,a,o,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Tr(e,0,tt.min(),tt.min(),tt.min(),Yr.empty(),0)}static newFoundDocument(e,t,r,i){return new Tr(e,1,t,tt.min(),r,i,0)}static newNoDocument(e,t){return new Tr(e,2,t,tt.min(),tt.min(),Yr.empty(),0)}static newUnknownDocument(e,t){return new Tr(e,3,t,tt.min(),tt.min(),Yr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(tt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Tr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Hg{constructor(e,t){this.position=e,this.inclusive=t}}function XR(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const a=e[i],o=n.position[i];if(a.field.isKeyField()?r=We.comparator(We.fromName(o.referenceValue),t.key):r=$c(o,t.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function YR(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!eo(n.position[t],e.position[t]))return!1;return!0}class gd{constructor(e,t="asc"){this.field=e,this.dir=t}}function LK(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class r4{}class Mn extends r4{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new jK(e,t,r):t==="array-contains"?new GK(e,r):t==="in"?new HK(e,r):t==="not-in"?new WK(e,r):t==="array-contains-any"?new qK(e,r):new Mn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new UK(e,r):new zK(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison($c(t,this.value)):t!==null&&Xs(this.value)===Xs(t)&&this.matchesComparison($c(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ye(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ha extends r4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ha(e,t)}matches(e){return i4(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function i4(n){return n.op==="and"}function a4(n){return BK(n)&&i4(n)}function BK(n){for(const e of n.filters)if(e instanceof ha)return!1;return!0}function u1(n){if(n instanceof Mn)return n.field.canonicalString()+n.op.toString()+Qc(n.value);if(a4(n))return n.filters.map((e=>u1(e))).join(",");{const e=n.filters.map((t=>u1(t))).join(",");return`${n.op}(${e})`}}function o4(n,e){return n instanceof Mn?(function(r,i){return i instanceof Mn&&r.op===i.op&&r.field.isEqual(i.field)&&eo(r.value,i.value)})(n,e):n instanceof ha?(function(r,i){return i instanceof ha&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((a,o,u)=>a&&o4(o,i.filters[u])),!0):!1})(n,e):void Ye(19439)}function s4(n){return n instanceof Mn?(function(t){return`${t.field.canonicalString()} ${t.op} ${Qc(t.value)}`})(n):n instanceof ha?(function(t){return t.op.toString()+" {"+t.getFilters().map(s4).join(" ,")+"}"})(n):"Filter"}class jK extends Mn{constructor(e,t,r){super(e,t,r),this.key=We.fromName(r.referenceValue)}matches(e){const t=We.comparator(e.key,this.key);return this.matchesComparison(t)}}class UK extends Mn{constructor(e,t){super(e,"in",t),this.keys=u4("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class zK extends Mn{constructor(e,t){super(e,"not-in",t),this.keys=u4("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function u4(n,e){return(e.arrayValue?.values||[]).map((t=>We.fromName(t.referenceValue)))}class GK extends Mn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Aw(t)&&md(t.arrayValue,this.value)}}class HK extends Mn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&md(this.value.arrayValue,t)}}class WK extends Mn{constructor(e,t){super(e,"not-in",t)}matches(e){if(md(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!md(this.value.arrayValue,t)}}class qK extends Mn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Aw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>md(this.value.arrayValue,r)))}}class KK{constructor(e,t=null,r=[],i=[],a=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=u,this.Te=null}}function $R(n,e=null,t=[],r=[],i=null,a=null,o=null){return new KK(n,e,t,r,i,a,o)}function Rw(n){const e=at(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>u1(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(a){return a.field.canonicalString()+a.dir})(r))).join(","),Iv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Qc(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Qc(r))).join(",")),e.Te=t}return e.Te}function Iw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!LK(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!o4(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!YR(n.startAt,e.startAt)&&YR(n.endAt,e.endAt)}function l1(n){return We.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class fh{constructor(e,t=null,r=[],i=[],a=null,o="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function XK(n,e,t,r,i,a,o,u){return new fh(n,e,t,r,i,a,o,u)}function l4(n){return new fh(n)}function QR(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function c4(n){return n.collectionGroup!==null}function Gf(n){const e=at(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),t.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new Gn(gr.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(u=u.add(h.field))}))})),u})(e).forEach((a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new gd(a,r))})),t.has(gr.keyField().canonicalString())||e.Ie.push(new gd(gr.keyField(),r))}return e.Ie}function Ya(n){const e=at(n);return e.Ee||(e.Ee=YK(e,Gf(n))),e.Ee}function YK(n,e){if(n.limitType==="F")return $R(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const a=i.dir==="desc"?"asc":"desc";return new gd(i.field,a)}));const t=n.endAt?new Hg(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Hg(n.startAt.position,n.startAt.inclusive):null;return $R(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function c1(n,e){const t=n.filters.concat([e]);return new fh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Wg(n,e,t){return new fh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Dv(n,e){return Iw(Ya(n),Ya(e))&&n.limitType===e.limitType}function h4(n){return`${Rw(Ya(n))}|lt:${n.limitType}`}function gc(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>s4(i))).join(", ")}]`),Iv(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>Qc(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>Qc(i))).join(",")),`Target(${r})`})(Ya(n))}; limitType=${n.limitType})`}function kv(n,e){return e.isFoundDocument()&&(function(r,i){const a=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):We.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)})(n,e)&&(function(r,i){for(const a of Gf(r))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const a of r.filters)if(!a.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(o,u,c){const h=XR(o,u,c);return o.inclusive?h<=0:h<0})(r.startAt,Gf(r),i)||r.endAt&&!(function(o,u,c){const h=XR(o,u,c);return o.inclusive?h>=0:h>0})(r.endAt,Gf(r),i))})(n,e)}function $K(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function f4(n){return(e,t)=>{let r=!1;for(const i of Gf(n)){const a=QK(i,e,t);if(a!==0)return a;r=r||i.field.isKeyField()}return 0}}function QK(n,e,t){const r=n.field.isKeyField()?We.comparator(e.key,t.key):(function(a,o,u){const c=o.data.field(a),h=u.data.field(a);return c!==null&&h!==null?$c(c,h):Ye(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ye(19790,{direction:n.dir})}}class hl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,a]of r)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){nu(this.inner,((t,r)=>{for(const[i,a]of r)e(i,a)}))}isEmpty(){return X3(this.inner)}size(){return this.innerSize}}const ZK=new Vn(We.comparator);function Lo(){return ZK}const d4=new Vn(We.comparator);function kf(...n){let e=d4;for(const t of n)e=e.insert(t.key,t);return e}function p4(n){let e=d4;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Ku(){return Hf()}function m4(){return Hf()}function Hf(){return new hl((n=>n.toString()),((n,e)=>n.isEqual(e)))}const JK=new Vn(We.comparator),eX=new Gn(We.comparator);function _t(...n){let e=eX;for(const t of n)e=e.add(t);return e}const tX=new Gn(yt);function nX(){return tX}function Nw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ug(e)?"-0":e}}function g4(n){return{integerValue:""+n}}function v4(n,e){return NK(e)?g4(e):Nw(n,e)}class Mv{constructor(){this._=void 0}}function rX(n,e,t){return n instanceof vd?(function(i,a){const o={fields:{[Q3]:{stringValue:$3},[J3]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&Sw(a)&&(a=Nv(a)),a&&(o.fields[Z3]=a),{mapValue:o}})(t,e):n instanceof yd?_4(n,e):n instanceof _d?b4(n,e):(function(i,a){const o=y4(i,a),u=ZR(o)+ZR(i.Ae);return s1(o)&&s1(i.Ae)?g4(u):Nw(i.serializer,u)})(n,e)}function iX(n,e,t){return n instanceof yd?_4(n,e):n instanceof _d?b4(n,e):t}function y4(n,e){return n instanceof bd?(function(r){return s1(r)||(function(a){return!!a&&"doubleValue"in a})(r)})(e)?e:{integerValue:0}:null}class vd extends Mv{}class yd extends Mv{constructor(e){super(),this.elements=e}}function _4(n,e){const t=x4(e);for(const r of n.elements)t.some((i=>eo(i,r)))||t.push(r);return{arrayValue:{values:t}}}class _d extends Mv{constructor(e){super(),this.elements=e}}function b4(n,e){let t=x4(e);for(const r of n.elements)t=t.filter((i=>!eo(i,r)));return{arrayValue:{values:t}}}class bd extends Mv{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ZR(n){return _n(n.integerValue||n.doubleValue)}function x4(n){return Aw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class w4{constructor(e,t){this.field=e,this.transform=t}}function aX(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof yd&&i instanceof yd||r instanceof _d&&i instanceof _d?Yc(r.elements,i.elements,eo):r instanceof bd&&i instanceof bd?eo(r.Ae,i.Ae):r instanceof vd&&i instanceof vd})(n.transform,e.transform)}class oX{constructor(e,t){this.version=e,this.transformResults=t}}class Ui{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ui}static exists(e){return new Ui(void 0,e)}static updateTime(e){return new Ui(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ig(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ov{}function E4(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Dw(n.key,Ui.none()):new Ud(n.key,n.data,Ui.none());{const t=n.data,r=Yr.empty();let i=new Gn(gr.comparator);for(let a of e.fields)if(!i.has(a)){let o=t.field(a);o===null&&a.length>1&&(a=a.popLast(),o=t.field(a)),o===null?r.delete(a):r.set(a,o),i=i.add(a)}return new ru(n.key,r,new mi(i.toArray()),Ui.none())}}function sX(n,e,t){n instanceof Ud?(function(i,a,o){const u=i.value.clone(),c=eI(i.fieldTransforms,a,o.transformResults);u.setAll(c),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,e,t):n instanceof ru?(function(i,a,o){if(!ig(i.precondition,a))return void a.convertToUnknownDocument(o.version);const u=eI(i.fieldTransforms,a,o.transformResults),c=a.data;c.setAll(T4(i)),c.setAll(u),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):(function(i,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Wf(n,e,t,r){return n instanceof Ud?(function(a,o,u,c){if(!ig(a.precondition,o))return u;const h=a.value.clone(),d=tI(a.fieldTransforms,c,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof ru?(function(a,o,u,c){if(!ig(a.precondition,o))return u;const h=tI(a.fieldTransforms,c,o),d=o.data;return d.setAll(T4(a)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),u===null?null:u.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map((p=>p.field)))})(n,e,t,r):(function(a,o,u){return ig(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u})(n,e,t)}function uX(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),a=y4(r.transform,i||null);a!=null&&(t===null&&(t=Yr.empty()),t.set(r.field,a))}return t||null}function JR(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Yc(r,i,((a,o)=>aX(a,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ud extends Ov{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ru extends Ov{constructor(e,t,r,i,a=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function T4(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function eI(n,e,t){const r=new Map;Ot(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const a=n[i],o=a.transform,u=e.data.field(a.field);r.set(a.field,iX(o,u,t[i]))}return r}function tI(n,e,t){const r=new Map;for(const i of n){const a=i.transform,o=t.data.field(i.field);r.set(i.field,rX(a,o,e))}return r}class Dw extends Ov{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lX extends Ov{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class cX{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&sX(a,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Wf(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Wf(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=m4();return this.mutations.forEach((i=>{const a=e.get(i.key),o=a.overlayedDocument;let u=this.applyToLocalView(o,a.mutatedFields);u=t.has(i.key)?null:u;const c=E4(o,u);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(tt.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),_t())}isEqual(e){return this.batchId===e.batchId&&Yc(this.mutations,e.mutations,((t,r)=>JR(t,r)))&&Yc(this.baseMutations,e.baseMutations,((t,r)=>JR(t,r)))}}class kw{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Ot(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return JK})();const a=e.mutations;for(let o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new kw(e,t,r,i)}}class hX{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class fX{constructor(e,t){this.count=e,this.unchangedNames=t}}var Nn,Et;function dX(n){switch(n){case _e.OK:return Ye(64938);case _e.CANCELLED:case _e.UNKNOWN:case _e.DEADLINE_EXCEEDED:case _e.RESOURCE_EXHAUSTED:case _e.INTERNAL:case _e.UNAVAILABLE:case _e.UNAUTHENTICATED:return!1;case _e.INVALID_ARGUMENT:case _e.NOT_FOUND:case _e.ALREADY_EXISTS:case _e.PERMISSION_DENIED:case _e.FAILED_PRECONDITION:case _e.ABORTED:case _e.OUT_OF_RANGE:case _e.UNIMPLEMENTED:case _e.DATA_LOSS:return!0;default:return Ye(15467,{code:n})}}function C4(n){if(n===void 0)return Vo("GRPC error has no .code"),_e.UNKNOWN;switch(n){case Nn.OK:return _e.OK;case Nn.CANCELLED:return _e.CANCELLED;case Nn.UNKNOWN:return _e.UNKNOWN;case Nn.DEADLINE_EXCEEDED:return _e.DEADLINE_EXCEEDED;case Nn.RESOURCE_EXHAUSTED:return _e.RESOURCE_EXHAUSTED;case Nn.INTERNAL:return _e.INTERNAL;case Nn.UNAVAILABLE:return _e.UNAVAILABLE;case Nn.UNAUTHENTICATED:return _e.UNAUTHENTICATED;case Nn.INVALID_ARGUMENT:return _e.INVALID_ARGUMENT;case Nn.NOT_FOUND:return _e.NOT_FOUND;case Nn.ALREADY_EXISTS:return _e.ALREADY_EXISTS;case Nn.PERMISSION_DENIED:return _e.PERMISSION_DENIED;case Nn.FAILED_PRECONDITION:return _e.FAILED_PRECONDITION;case Nn.ABORTED:return _e.ABORTED;case Nn.OUT_OF_RANGE:return _e.OUT_OF_RANGE;case Nn.UNIMPLEMENTED:return _e.UNIMPLEMENTED;case Nn.DATA_LOSS:return _e.DATA_LOSS;default:return Ye(39323,{code:n})}}(Et=Nn||(Nn={}))[Et.OK=0]="OK",Et[Et.CANCELLED=1]="CANCELLED",Et[Et.UNKNOWN=2]="UNKNOWN",Et[Et.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Et[Et.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Et[Et.NOT_FOUND=5]="NOT_FOUND",Et[Et.ALREADY_EXISTS=6]="ALREADY_EXISTS",Et[Et.PERMISSION_DENIED=7]="PERMISSION_DENIED",Et[Et.UNAUTHENTICATED=16]="UNAUTHENTICATED",Et[Et.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Et[Et.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Et[Et.ABORTED=10]="ABORTED",Et[Et.OUT_OF_RANGE=11]="OUT_OF_RANGE",Et[Et.UNIMPLEMENTED=12]="UNIMPLEMENTED",Et[Et.INTERNAL=13]="INTERNAL",Et[Et.UNAVAILABLE=14]="UNAVAILABLE",Et[Et.DATA_LOSS=15]="DATA_LOSS";function pX(){return new TextEncoder}const mX=new Vs([4294967295,4294967295],0);function nI(n){const e=pX().encode(n),t=new F3;return t.update(e),new Uint8Array(t.digest())}function rI(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Vs([t,r],0),new Vs([i,a],0)]}class Mw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Mf(`Invalid padding: ${t}`);if(r<0)throw new Mf(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Mf(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Mf(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vs.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Vs.fromNumber(r)));return i.compare(mX)===1&&(i=new Vs([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=nI(e),[r,i]=rI(t);for(let a=0;a<this.hashCount;a++){const o=this.ye(r,i,a);if(!this.we(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Mw(a,i,t);return r.forEach((u=>o.insert(u))),o}insert(e){if(this.ge===0)return;const t=nI(e),[r,i]=rI(t);for(let a=0;a<this.hashCount;a++){const o=this.ye(r,i,a);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Mf extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Pv{constructor(e,t,r,i,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,zd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Pv(tt.min(),i,new Vn(yt),Lo(),_t())}}class zd{constructor(e,t,r,i,a){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new zd(r,t,_t(),_t(),_t())}}class ag{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class S4{constructor(e,t){this.targetId=e,this.Ce=t}}class A4{constructor(e,t,r=vr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class iI{constructor(){this.ve=0,this.Fe=aI(),this.Me=vr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=_t(),t=_t(),r=_t();return this.Fe.forEach(((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Ye(38017,{changeType:a})}})),new zd(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=aI()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ot(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class gX{constructor(e){this.Ge=e,this.ze=new Map,this.je=Lo(),this.Je=Hm(),this.He=Hm(),this.Ye=new Vn(yt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:Ye(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const a=i.target;if(l1(a))if(r===0){const o=new We(a.path);this.et(t,o,Tr.newNoDocument(o,tt.min()))}else Ot(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const u=this.ut(e),c=u?this.ct(u,e,o):1;if(c!==0){this.it(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:a=0}=t;let o,u;try{o=Ks(r).toUint8Array()}catch(c){if(c instanceof Y3)return Xc("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Mw(o,i,a)}catch(c){return Xc(c instanceof Mf?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((a=>{const o=this.Ge.ht(),u=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(u)||(this.et(t,a,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((a,o)=>{const u=this.ot(o);if(u){if(a.current&&l1(u.target)){const c=new We(u.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Tr.newNoDocument(c,e))}a.Be&&(t.set(o,a.ke()),a.qe())}}));let r=_t();this.He.forEach(((a,o)=>{let u=!0;o.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(a))})),this.je.forEach(((a,o)=>o.setReadTime(e)));const i=new Pv(e,t,this.Ye,this.je,r);return this.je=Lo(),this.Je=Hm(),this.He=Hm(),this.Ye=new Vn(yt),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new iI,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Gn(yt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Gn(yt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Me("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new iI),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Hm(){return new Vn(We.comparator)}function aI(){return new Vn(We.comparator)}const vX={asc:"ASCENDING",desc:"DESCENDING"},yX={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_X={and:"AND",or:"OR"};class bX{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function h1(n,e){return n.useProto3Json||Iv(e)?e:{value:e}}function qg(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function R4(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function xX(n,e){return qg(n,e.toTimestamp())}function $a(n){return Ot(!!n,49232),tt.fromTimestamp((function(t){const r=qs(t);return new Jt(r.seconds,r.nanos)})(n))}function Ow(n,e){return f1(n,e).canonicalString()}function f1(n,e){const t=(function(i){return new qt(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function I4(n){const e=qt.fromString(n);return Ot(O4(e),10190,{key:e.toString()}),e}function d1(n,e){return Ow(n.databaseId,e.path)}function q_(n,e){const t=I4(e);if(t.get(1)!==n.databaseId.projectId)throw new De(_e.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new De(_e.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new We(D4(t))}function N4(n,e){return Ow(n.databaseId,e)}function wX(n){const e=I4(n);return e.length===4?qt.emptyPath():D4(e)}function p1(n){return new qt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function D4(n){return Ot(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function oI(n,e,t){return{name:d1(n,e),fields:t.value.mapValue.fields}}function EX(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Ye(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=(function(h,d){return h.useProto3Json?(Ot(d===void 0||typeof d=="string",58123),vr.fromBase64String(d||"")):(Ot(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),vr.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&(function(h){const d=h.code===void 0?_e.UNKNOWN:C4(h.code);return new De(d,h.message||"")})(o);t=new A4(r,i,a,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=q_(n,r.document.name),a=$a(r.document.updateTime),o=r.document.createTime?$a(r.document.createTime):tt.min(),u=new Yr({mapValue:{fields:r.document.fields}}),c=Tr.newFoundDocument(i,a,o,u),h=r.targetIds||[],d=r.removedTargetIds||[];t=new ag(h,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=q_(n,r.document),a=r.readTime?$a(r.readTime):tt.min(),o=Tr.newNoDocument(i,a),u=r.removedTargetIds||[];t=new ag([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=q_(n,r.document),a=r.removedTargetIds||[];t=new ag([],a,i,null)}else{if(!("filter"in e))return Ye(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:a}=r,o=new fX(i,a),u=r.targetId;t=new S4(u,o)}}return t}function TX(n,e){let t;if(e instanceof Ud)t={update:oI(n,e.key,e.value)};else if(e instanceof Dw)t={delete:d1(n,e.key)};else if(e instanceof ru)t={update:oI(n,e.key,e.data),updateMask:MX(e.fieldMask)};else{if(!(e instanceof lX))return Ye(16599,{Vt:e.type});t={verify:d1(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(a,o){const u=o.transform;if(u instanceof vd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof yd)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof _d)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof bd)return{fieldPath:o.field.canonicalString(),increment:u.Ae};throw Ye(20930,{transform:o.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,a){return a.updateTime!==void 0?{updateTime:xX(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Ye(27497)})(n,e.precondition)),t}function CX(n,e){return n&&n.length>0?(Ot(e!==void 0,14353),n.map((t=>(function(i,a){let o=i.updateTime?$a(i.updateTime):$a(a);return o.isEqual(tt.min())&&(o=$a(a)),new oX(o,i.transformResults||[])})(t,e)))):[]}function SX(n,e){return{documents:[N4(n,e.path)]}}function AX(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=N4(n,i);const a=(function(h){if(h.length!==0)return M4(ha.create(h,"and"))})(e.filters);a&&(t.structuredQuery.where=a);const o=(function(h){if(h.length!==0)return h.map((d=>(function(g){return{field:vc(g.field),direction:NX(g.dir)}})(d)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=h1(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function RX(n){let e=wX(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Ot(r===1,65062);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let a=[];t.where&&(a=(function(p){const g=k4(p);return g instanceof ha&&a4(g)?g.getFilters():[g]})(t.where));let o=[];t.orderBy&&(o=(function(p){return p.map((g=>(function(b){return new gd(yc(b.field),(function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(g)))})(t.orderBy));let u=null;t.limit&&(u=(function(p){let g;return g=typeof p=="object"?p.value:p,Iv(g)?null:g})(t.limit));let c=null;t.startAt&&(c=(function(p){const g=!!p.before,v=p.values||[];return new Hg(v,g)})(t.startAt));let h=null;return t.endAt&&(h=(function(p){const g=!p.before,v=p.values||[];return new Hg(v,g)})(t.endAt)),XK(e,i,o,a,u,"F",c,h)}function IX(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ye(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function k4(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=yc(t.unaryFilter.field);return Mn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=yc(t.unaryFilter.field);return Mn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=yc(t.unaryFilter.field);return Mn.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=yc(t.unaryFilter.field);return Mn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ye(61313);default:return Ye(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Mn.create(yc(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ye(58110);default:return Ye(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ha.create(t.compositeFilter.filters.map((r=>k4(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ye(1026)}})(t.compositeFilter.op))})(n):Ye(30097,{filter:n})}function NX(n){return vX[n]}function DX(n){return yX[n]}function kX(n){return _X[n]}function vc(n){return{fieldPath:n.canonicalString()}}function yc(n){return gr.fromServerFormat(n.fieldPath)}function M4(n){return n instanceof Mn?(function(t){if(t.op==="=="){if(KR(t.value))return{unaryFilter:{field:vc(t.field),op:"IS_NAN"}};if(qR(t.value))return{unaryFilter:{field:vc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(KR(t.value))return{unaryFilter:{field:vc(t.field),op:"IS_NOT_NAN"}};if(qR(t.value))return{unaryFilter:{field:vc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vc(t.field),op:DX(t.op),value:t.value}}})(n):n instanceof ha?(function(t){const r=t.getFilters().map((i=>M4(i)));return r.length===1?r[0]:{compositeFilter:{op:kX(t.op),filters:r}}})(n):Ye(54877,{filter:n})}function MX(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function O4(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Is{constructor(e,t,r,i,a=tt.min(),o=tt.min(),u=vr.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Is(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Is(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Is(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Is(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class OX{constructor(e){this.yt=e}}function PX(n){const e=RX({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Wg(e,e.limit,"L"):e}class VX{constructor(){this.Cn=new FX}addToCollectionParentIndex(e,t){return this.Cn.add(t),we.resolve()}getCollectionParents(e,t){return we.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return we.resolve()}deleteFieldIndex(e,t){return we.resolve()}deleteAllFieldIndexes(e){return we.resolve()}createTargetIndexes(e,t){return we.resolve()}getDocumentsMatchingTarget(e,t){return we.resolve(null)}getIndexType(e,t){return we.resolve(0)}getFieldIndexes(e,t){return we.resolve([])}getNextCollectionGroupToUpdate(e){return we.resolve(null)}getMinOffset(e,t){return we.resolve(Ws.min())}getMinOffsetFromCollectionGroup(e,t){return we.resolve(Ws.min())}updateCollectionGroup(e,t,r){return we.resolve()}updateIndexEntries(e,t){return we.resolve()}}class FX{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Gn(qt.comparator),a=!i.has(r);return this.index[t]=i.add(r),a}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Gn(qt.comparator)).toArray()}}const sI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},P4=41943040;class qr{static withCacheSize(e){return new qr(e,qr.DEFAULT_COLLECTION_PERCENTILE,qr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}qr.DEFAULT_COLLECTION_PERCENTILE=10,qr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qr.DEFAULT=new qr(P4,qr.DEFAULT_COLLECTION_PERCENTILE,qr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qr.DISABLED=new qr(-1,0,0);class Zc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Zc(0)}static cr(){return new Zc(-1)}}const uI="LruGarbageCollector",LX=1048576;function lI([n,e],[t,r]){const i=yt(n,t);return i===0?yt(e,r):i}class BX{constructor(e){this.Ir=e,this.buffer=new Gn(lI),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();lI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class jX{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Me(uI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){hh(t)?Me(uI,"Ignoring IndexedDB error during garbage collection: ",t):await ch(t)}await this.Vr(3e5)}))}}class UX{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return we.resolve(Rv.ce);const r=new BX(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Me("LruGarbageCollector","Garbage collection skipped; disabled"),we.resolve(sI)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Me("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sI):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,a,o,u,c,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(Me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i)))).next((p=>(r=p,u=Date.now(),this.removeTargets(e,r,t)))).next((p=>(a=p,c=Date.now(),this.removeOrphanedDocuments(e,r)))).next((p=>(h=Date.now(),mc()<=xt.DEBUG&&Me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(u-o)+`ms
	Removed ${a} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-d}ms`),we.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:p}))))}}function zX(n,e){return new UX(n,e)}class GX{constructor(){this.changes=new hl((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Tr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?we.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class HX{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class WX{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&Wf(r.mutation,i,mi.empty(),Jt.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,_t()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=_t()){const i=Ku();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((a=>{let o=kf();return a.forEach(((u,c)=>{o=o.insert(u,c.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const r=Ku();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,_t())))}populateOverlays(e,t,r){const i=[];return r.forEach((a=>{t.has(a)||i.push(a)})),this.documentOverlayCache.getOverlays(e,i).next((a=>{a.forEach(((o,u)=>{t.set(o,u)}))}))}computeViews(e,t,r,i){let a=Lo();const o=Hf(),u=(function(){return Hf()})();return t.forEach(((c,h)=>{const d=r.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof ru)?a=a.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),Wf(d.mutation,h,d.mutation.getFieldMask(),Jt.now())):o.set(h.key,mi.empty())})),this.recalculateAndSaveOverlays(e,a).next((c=>(c.forEach(((h,d)=>o.set(h,d))),t.forEach(((h,d)=>u.set(h,new HX(d,o.get(h)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=Hf();let i=new Vn(((o,u)=>o-u)),a=_t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const u of o)u.keys().forEach((c=>{const h=t.get(c);if(h===null)return;let d=r.get(c)||mi.empty();d=u.applyToLocalView(h,d),r.set(c,d);const p=(i.get(u.batchId)||_t()).add(c);i=i.insert(u.batchId,p)}))})).next((()=>{const o=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,d=c.value,p=m4();d.forEach((g=>{if(!a.has(g)){const v=E4(t.get(g),r.get(g));v!==null&&p.set(g,v),a=a.add(g)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return we.waitFor(o)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(o){return We.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):c4(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((a=>{const o=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-a.size):we.resolve(Ku());let u=fd,c=a;return o.next((h=>we.forEach(h,((d,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),a.get(d)?we.resolve():this.remoteDocumentCache.getEntry(e,d).next((g=>{c=c.insert(d,g)}))))).next((()=>this.populateOverlays(e,h,a))).next((()=>this.computeViews(e,c,h,_t()))).next((d=>({batchId:u,changes:p4(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new We(t)).next((r=>{let i=kf();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const a=t.collectionGroup;let o=kf();return this.indexManager.getCollectionParents(e,a).next((u=>we.forEach(u,(c=>{const h=(function(p,g){return new fh(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next((d=>{d.forEach(((p,g)=>{o=o.insert(p,g)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,a,i)))).next((o=>{a.forEach(((c,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,Tr.newInvalidDocument(d)))}));let u=kf();return o.forEach(((c,h)=>{const d=a.get(c);d!==void 0&&Wf(d.mutation,h,mi.empty(),Jt.now()),kv(t,h)&&(u=u.insert(c,h))})),u}))}}class qX{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return we.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:$a(i.createTime)}})(t)),we.resolve()}getNamedQuery(e,t){return we.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:PX(i.bundledQuery),readTime:$a(i.readTime)}})(t)),we.resolve()}}class KX{constructor(){this.overlays=new Vn(We.comparator),this.qr=new Map}getOverlay(e,t){return we.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ku();return we.forEach(t,(i=>this.getOverlay(e,i).next((a=>{a!==null&&r.set(i,a)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,a)=>{this.St(e,t,a)})),we.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((a=>this.overlays=this.overlays.remove(a))),this.qr.delete(r)),we.resolve()}getOverlaysForCollection(e,t,r){const i=Ku(),a=t.length+1,o=new We(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===a&&c.largestBatchId>r&&i.set(c.getKey(),c)}return we.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let a=new Vn(((h,d)=>h-d));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=a.get(h.largestBatchId);d===null&&(d=Ku(),a=a.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const u=Ku(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,d)=>u.set(h,d))),!(u.size()>=i)););return we.resolve(u)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new hX(t,r));let a=this.qr.get(t);a===void 0&&(a=_t(),this.qr.set(t,a)),this.qr.set(t,a.add(r.key))}}class XX{constructor(){this.sessionToken=vr.EMPTY_BYTE_STRING}getSessionToken(e){return we.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,we.resolve()}}class Pw{constructor(){this.Qr=new Gn(er.$r),this.Ur=new Gn(er.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new er(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new er(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new We(new qt([])),r=new er(t,e),i=new er(t,e+1),a=[];return this.Ur.forEachInRange([r,i],(o=>{this.Gr(o),a.push(o.key)})),a}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new We(new qt([])),r=new er(t,e),i=new er(t,e+1);let a=_t();return this.Ur.forEachInRange([r,i],(o=>{a=a.add(o.key)})),a}containsKey(e){const t=new er(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class er{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return We.comparator(e.key,t.key)||yt(e.Yr,t.Yr)}static Kr(e,t){return yt(e.Yr,t.Yr)||We.comparator(e.key,t.key)}}class YX{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Gn(er.$r)}checkEmpty(e){return we.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new cX(a,t,r,i);this.mutationQueue.push(o);for(const u of i)this.Zr=this.Zr.add(new er(u.key,a)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return we.resolve(o)}lookupMutationBatch(e,t){return we.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),a=i<0?0:i;return we.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return we.resolve(this.mutationQueue.length===0?Cw:this.tr-1)}getAllMutationBatches(e){return we.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new er(t,0),i=new er(t,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([r,i],(o=>{const u=this.Xr(o.Yr);a.push(u)})),we.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Gn(yt);return t.forEach((i=>{const a=new er(i,0),o=new er(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,o],(u=>{r=r.add(u.Yr)}))})),we.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let a=r;We.isDocumentKey(a)||(a=a.child(""));const o=new er(new We(a),0);let u=new Gn(yt);return this.Zr.forEachWhile((c=>{const h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Yr)),!0)}),o),we.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){Ot(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return we.forEach(t.mutations,(i=>{const a=new er(i.key,t.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new er(t,0),i=this.Zr.firstAfterOrEqual(r);return we.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,we.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class $X{constructor(e){this.ri=e,this.docs=(function(){return new Vn(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),a=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return we.resolve(r?r.document.mutableCopy():Tr.newInvalidDocument(t))}getEntries(e,t){let r=Lo();return t.forEach((i=>{const a=this.docs.get(i);r=r.insert(i,a?a.document.mutableCopy():Tr.newInvalidDocument(i))})),we.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let a=Lo();const o=t.path,u=new We(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:d}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||SK(CK(d),r)<=0||(i.has(d.key)||kv(t,d))&&(a=a.insert(d.key,d.mutableCopy()))}return we.resolve(a)}getAllFromCollectionGroup(e,t,r,i){Ye(9500)}ii(e,t){return we.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new QX(this)}getSize(e){return we.resolve(this.size)}}class QX extends GX{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),we.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class ZX{constructor(e){this.persistence=e,this.si=new hl((t=>Rw(t)),Iw),this.lastRemoteSnapshotVersion=tt.min(),this.highestTargetId=0,this.oi=0,this._i=new Pw,this.targetCount=0,this.ai=Zc.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),we.resolve()}getLastRemoteSnapshotVersion(e){return we.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return we.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),we.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),we.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Zc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,we.resolve()}updateTargetData(e,t){return this.Pr(t),we.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,we.resolve()}removeTargets(e,t,r){let i=0;const a=[];return this.si.forEach(((o,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(o),a.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),we.waitFor(a).next((()=>i))}getTargetCount(e){return we.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return we.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),we.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,a=[];return i&&t.forEach((o=>{a.push(i.markPotentiallyOrphaned(e,o))})),we.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),we.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return we.resolve(r)}containsKey(e,t){return we.resolve(this._i.containsKey(t))}}class V4{constructor(e,t){this.ui={},this.overlays={},this.ci=new Rv(0),this.li=!1,this.li=!0,this.hi=new XX,this.referenceDelegate=e(this),this.Pi=new ZX(this),this.indexManager=new VX,this.remoteDocumentCache=(function(i){return new $X(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new OX(t),this.Ii=new qX(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new KX,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new YX(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Me("MemoryPersistence","Starting transaction:",e);const i=new JX(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((a=>this.referenceDelegate.di(i).next((()=>a)))).toPromise().then((a=>(i.raiseOnCommittedEvent(),a)))}Ai(e,t){return we.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class JX extends RK{constructor(e){super(),this.currentSequenceNumber=e}}class Vw{constructor(e){this.persistence=e,this.Ri=new Pw,this.Vi=null}static mi(e){return new Vw(e)}get fi(){if(this.Vi)return this.Vi;throw Ye(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),we.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),we.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),we.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((a=>this.fi.add(a.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return we.forEach(this.fi,(r=>{const i=We.fromPath(r);return this.gi(e,i).next((a=>{a||t.removeEntry(i,tt.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return we.or([()=>we.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Kg{constructor(e,t){this.persistence=e,this.pi=new hl((r=>DK(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=zX(this,t)}static mi(e,t){return new Kg(e,t)}Ei(){}di(e){return we.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return we.forEach(this.pi,((r,i)=>this.br(e,r,i).next((a=>a?we.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.ii(e,(o=>this.br(e,o,t).next((u=>{u||(r++,a.removeEntry(o,tt.min()))})))).next((()=>a.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),we.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),we.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),we.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),we.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ng(e.data.value)),t}br(e,t,r){return we.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return we.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Fw{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=_t(),i=_t();for(const a of t.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new Fw(e,t.fromCache,r,i)}}class eY{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class tY{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Hq()?8:IK(T3())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const a={result:null};return this.ys(e,t).next((o=>{a.result=o})).next((()=>{if(!a.result)return this.ws(e,t,i,r).next((o=>{a.result=o}))})).next((()=>{if(a.result)return;const o=new eY;return this.Ss(e,t,o).next((u=>{if(a.result=u,this.Vs)return this.bs(e,t,o,u.size)}))})).next((()=>a.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(mc()<=xt.DEBUG&&Me("QueryEngine","SDK will not create cache indexes for query:",gc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),we.resolve()):(mc()<=xt.DEBUG&&Me("QueryEngine","Query:",gc(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(mc()<=xt.DEBUG&&Me("QueryEngine","The SDK decides to create cache indexes for query:",gc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ya(t))):we.resolve())}ys(e,t){if(QR(t))return we.resolve(null);let r=Ya(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Wg(t,null,"F"),r=Ya(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((a=>{const o=_t(...a);return this.ps.getDocuments(e,o).next((u=>this.indexManager.getMinOffset(e,r).next((c=>{const h=this.Ds(t,u);return this.Cs(t,h,o,c.readTime)?this.ys(e,Wg(t,null,"F")):this.vs(e,h,t,c)}))))})))))}ws(e,t,r,i){return QR(t)||i.isEqual(tt.min())?we.resolve(null):this.ps.getDocuments(e,r).next((a=>{const o=this.Ds(t,a);return this.Cs(t,o,r,i)?we.resolve(null):(mc()<=xt.DEBUG&&Me("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),gc(t)),this.vs(e,o,t,TK(i,fd)).next((u=>u)))}))}Ds(e,t){let r=new Gn(f4(e));return t.forEach(((i,a)=>{kv(e,a)&&(r=r.add(a))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Ss(e,t,r){return mc()<=xt.DEBUG&&Me("QueryEngine","Using full collection scan to execute query:",gc(t)),this.ps.getDocumentsMatchingQuery(e,t,Ws.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((a=>(t.forEach((o=>{a=a.insert(o.key,o)})),a)))}}const Lw="LocalStore",nY=3e8;class rY{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Vn(yt),this.xs=new hl((a=>Rw(a)),Iw),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new WX(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function iY(n,e,t,r){return new rY(n,e,t,r)}async function F4(n,e){const t=at(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((a=>(i=a,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((a=>{const o=[],u=[];let c=_t();for(const h of i){o.push(h.batchId);for(const d of h.mutations)c=c.add(d.key)}for(const h of a){u.push(h.batchId);for(const d of h.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next((h=>({Ls:h,removedBatchIds:o,addedBatchIds:u})))}))}))}function aY(n,e){const t=at(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),a=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,c,h,d){const p=h.batch,g=p.keys();let v=we.resolve();return g.forEach((b=>{v=v.next((()=>d.getEntry(c,b))).next((w=>{const E=h.docVersions.get(b);Ot(E!==null,48541),w.version.compareTo(E)<0&&(p.applyToRemoteDocument(w,h),w.isValidDocument()&&(w.setReadTime(h.commitVersion),d.addEntry(w)))}))})),v.next((()=>u.mutationQueue.removeMutationBatch(c,p)))})(t,r,e,a).next((()=>a.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let c=_t();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function L4(n){const e=at(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function oY(n,e){const t=at(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(a=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const u=[];e.targetChanges.forEach(((d,p)=>{const g=i.get(p);if(!g)return;u.push(t.Pi.removeMatchingKeys(a,d.removedDocuments,p).next((()=>t.Pi.addMatchingKeys(a,d.addedDocuments,p))));let v=g.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(p)!==null?v=v.withResumeToken(vr.EMPTY_BYTE_STRING,tt.min()).withLastLimboFreeSnapshotVersion(tt.min()):d.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(d.resumeToken,r)),i=i.insert(p,v),(function(w,E,T){return w.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=nY?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0})(g,v,d)&&u.push(t.Pi.updateTargetData(a,v))}));let c=Lo(),h=_t();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(a,d))})),u.push(sY(a,o,e.documentUpdates).next((d=>{c=d.ks,h=d.qs}))),!r.isEqual(tt.min())){const d=t.Pi.getLastRemoteSnapshotVersion(a).next((p=>t.Pi.setTargetsMetadata(a,a.currentSequenceNumber,r)));u.push(d)}return we.waitFor(u).next((()=>o.apply(a))).next((()=>t.localDocuments.getLocalViewOfDocuments(a,c,h))).next((()=>c))})).then((a=>(t.Ms=i,a)))}function sY(n,e,t){let r=_t(),i=_t();return t.forEach((a=>r=r.add(a))),e.getEntries(n,r).next((a=>{let o=Lo();return t.forEach(((u,c)=>{const h=a.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(tt.min())?(e.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(u,c)):Me(Lw,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)})),{ks:o,qs:i}}))}function uY(n,e){const t=at(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Cw),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function lY(n,e){const t=at(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((a=>a?(i=a,we.resolve(i)):t.Pi.allocateTargetId(r).next((o=>(i=new Is(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function m1(n,e,t){const r=at(n),i=r.Ms.get(e),a=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",a,(o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!hh(o))throw o;Me(Lw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function cI(n,e,t){const r=at(n);let i=tt.min(),a=_t();return r.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,h,d){const p=at(c),g=p.xs.get(d);return g!==void 0?we.resolve(p.Ms.get(g)):p.Pi.getTargetData(h,d)})(r,o,Ya(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,u.targetId).next((c=>{a=c}))})).next((()=>r.Fs.getDocumentsMatchingQuery(o,e,t?i:tt.min(),t?a:_t()))).next((u=>(cY(r,$K(e),u),{documents:u,Qs:a})))))}function cY(n,e,t){let r=n.Os.get(e)||tt.min();t.forEach(((i,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)})),n.Os.set(e,r)}class hI{constructor(){this.activeTargetIds=nX()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hY{constructor(){this.Mo=new hI,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new hI,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fY{Oo(e){}shutdown(){}}const fI="ConnectivityMonitor";class dI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Me(fI,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Me(fI,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Wm=null;function g1(){return Wm===null?Wm=(function(){return 268435456+Math.round(2147483648*Math.random())})():Wm++,"0x"+Wm.toString(16)}const K_="RestConnection",dY={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pY{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===zg?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,a){const o=g1(),u=this.zo(e,t.toUriEncodedString());Me(K_,`Sending RPC '${e}' ${o}:`,u,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,a);const{host:h}=new URL(u),d=Bd(h);return this.Jo(e,u,c,r,d).then((p=>(Me(K_,`Received RPC '${e}' ${o}: `,p),p)),(p=>{throw Xc(K_,`RPC '${e}' ${o} failed with error: `,p,"url: ",u,"request:",r),p}))}Ho(e,t,r,i,a,o){return this.Go(e,t,r,i,a)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+lh})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,a)=>e[a]=i)),r&&r.headers.forEach(((i,a)=>e[a]=i))}zo(e,t){const r=dY[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class mY{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const br="WebChannelConnection";class gY extends pY{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,a){const o=g1();return new Promise(((u,c)=>{const h=new L3;h.setWithCredentials(!0),h.listenOnce(B3.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case tg.NO_ERROR:const p=h.getResponseJson();Me(br,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),u(p);break;case tg.TIMEOUT:Me(br,`RPC '${e}' ${o} timed out`),c(new De(_e.DEADLINE_EXCEEDED,"Request time out"));break;case tg.HTTP_ERROR:const g=h.getStatus();if(Me(br,`RPC '${e}' ${o} failed with status:`,g,"response text:",h.getResponseText()),g>0){let v=h.getResponseJson();Array.isArray(v)&&(v=v[0]);const b=v?.error;if(b&&b.status&&b.message){const w=(function(T){const R=T.toLowerCase().replace(/_/g,"-");return Object.values(_e).indexOf(R)>=0?R:_e.UNKNOWN})(b.status);c(new De(w,b.message))}else c(new De(_e.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new De(_e.UNAVAILABLE,"Connection failed."));break;default:Ye(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{Me(br,`RPC '${e}' ${o} completed.`)}}));const d=JSON.stringify(i);Me(br,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",d,r,15)}))}T_(e,t,r){const i=g1(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=z3(),u=U3(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const d=a.join("");Me(br,`Creating RPC '${e}' stream ${i}: ${d}`,c);const p=o.createWebChannel(d,c);this.I_(p);let g=!1,v=!1;const b=new mY({Yo:E=>{v?Me(br,`Not sending because RPC '${e}' stream ${i} is closed:`,E):(g||(Me(br,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),Me(br,`RPC '${e}' stream ${i} sending:`,E),p.send(E))},Zo:()=>p.close()}),w=(E,T,R)=>{E.listen(T,(I=>{try{R(I)}catch(C){setTimeout((()=>{throw C}),0)}}))};return w(p,Df.EventType.OPEN,(()=>{v||(Me(br,`RPC '${e}' stream ${i} transport opened.`),b.o_())})),w(p,Df.EventType.CLOSE,(()=>{v||(v=!0,Me(br,`RPC '${e}' stream ${i} transport closed`),b.a_(),this.E_(p))})),w(p,Df.EventType.ERROR,(E=>{v||(v=!0,Xc(br,`RPC '${e}' stream ${i} transport errored. Name:`,E.name,"Message:",E.message),b.a_(new De(_e.UNAVAILABLE,"The operation could not be completed")))})),w(p,Df.EventType.MESSAGE,(E=>{if(!v){const T=E.data[0];Ot(!!T,16349);const R=T,I=R?.error||R[0]?.error;if(I){Me(br,`RPC '${e}' stream ${i} received error:`,I);const C=I.status;let k=(function(N){const D=Nn[N];if(D!==void 0)return C4(D)})(C),L=I.message;k===void 0&&(k=_e.INTERNAL,L="Unknown error status: "+C+" with message "+I.message),v=!0,b.a_(new De(k,L)),p.close()}else Me(br,`RPC '${e}' stream ${i} received:`,T),b.u_(T)}})),w(u,j3.STAT_EVENT,(E=>{E.stat===r1.PROXY?Me(br,`RPC '${e}' stream ${i} detected buffering proxy`):E.stat===r1.NOPROXY&&Me(br,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function X_(){return typeof document<"u"?document:null}function Vv(n){return new bX(n,!0)}class B4{constructor(e,t,r=1e3,i=1.5,a=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&Me("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const pI="PersistentStream";class j4{constructor(e,t,r,i,a,o,u,c){this.Mi=e,this.S_=r,this.b_=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new B4(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===_e.RESOURCE_EXHAUSTED?(Vo(t.toString()),Vo("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===_e.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new De(_e.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Me(pI,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Me(pI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class vY extends j4{constructor(e,t,r,i,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=a}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=EX(this.serializer,e),r=(function(a){if(!("targetChange"in a))return tt.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?tt.min():o.readTime?$a(o.readTime):tt.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=p1(this.serializer),t.addTarget=(function(a,o){let u;const c=o.target;if(u=l1(c)?{documents:SX(a,c)}:{query:AX(a,c).ft},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=R4(a,o.resumeToken);const h=h1(a,o.expectedCount);h!==null&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(tt.min())>0){u.readTime=qg(a,o.snapshotVersion.toTimestamp());const h=h1(a,o.expectedCount);h!==null&&(u.expectedCount=h)}return u})(this.serializer,e);const r=IX(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=p1(this.serializer),t.removeTarget=e,this.q_(t)}}class yY extends j4{constructor(e,t,r,i,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Ot(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ot(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ot(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=CX(e.writeResults,e.commitTime),r=$a(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=p1(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>TX(this.serializer,r)))};this.q_(t)}}class _Y{}class bY extends _Y{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new De(_e.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,o])=>this.connection.Go(e,f1(t,r),i,a,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new De(_e.UNKNOWN,a.toString())}))}Ho(e,t,r,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,u])=>this.connection.Ho(e,f1(t,r),i,o,u,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new De(_e.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class xY{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Vo(t),this.aa=!1):Me("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const nl="RemoteStore";class wY{constructor(e,t,r,i,a){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo((o=>{r.enqueueAndForget((async()=>{fl(this)&&(Me(nl,"Restarting streams for network reachability change."),await(async function(c){const h=at(c);h.Ea.add(4),await Gd(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Fv(h)})(this))}))})),this.Ra=new xY(r,i)}}async function Fv(n){if(fl(n))for(const e of n.da)await e(!0)}async function Gd(n){for(const e of n.da)await e(!1)}function U4(n,e){const t=at(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),zw(t)?Uw(t):dh(t).O_()&&jw(t,e))}function Bw(n,e){const t=at(n),r=dh(t);t.Ia.delete(e),r.O_()&&z4(t,e),t.Ia.size===0&&(r.O_()?r.L_():fl(t)&&t.Ra.set("Unknown"))}function jw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}dh(n).Y_(e)}function z4(n,e){n.Va.Ue(e),dh(n).Z_(e)}function Uw(n){n.Va=new gX({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),dh(n).start(),n.Ra.ua()}function zw(n){return fl(n)&&!dh(n).x_()&&n.Ia.size>0}function fl(n){return at(n).Ea.size===0}function G4(n){n.Va=void 0}async function EY(n){n.Ra.set("Online")}async function TY(n){n.Ia.forEach(((e,t)=>{jw(n,e)}))}async function CY(n,e){G4(n),zw(n)?(n.Ra.ha(e),Uw(n)):n.Ra.set("Unknown")}async function SY(n,e,t){if(n.Ra.set("Online"),e instanceof A4&&e.state===2&&e.cause)try{await(async function(i,a){const o=a.cause;for(const u of a.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,o),i.Ia.delete(u),i.Va.removeTarget(u))})(n,e)}catch(r){Me(nl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Xg(n,r)}else if(e instanceof ag?n.Va.Ze(e):e instanceof S4?n.Va.st(e):n.Va.tt(e),!t.isEqual(tt.min()))try{const r=await L4(n.localStore);t.compareTo(r)>=0&&await(function(a,o){const u=a.Va.Tt(o);return u.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const d=a.Ia.get(h);d&&a.Ia.set(h,d.withResumeToken(c.resumeToken,o))}})),u.targetMismatches.forEach(((c,h)=>{const d=a.Ia.get(c);if(!d)return;a.Ia.set(c,d.withResumeToken(vr.EMPTY_BYTE_STRING,d.snapshotVersion)),z4(a,c);const p=new Is(d.target,c,h,d.sequenceNumber);jw(a,p)})),a.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){Me(nl,"Failed to raise snapshot:",r),await Xg(n,r)}}async function Xg(n,e,t){if(!hh(e))throw e;n.Ea.add(1),await Gd(n),n.Ra.set("Offline"),t||(t=()=>L4(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Me(nl,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Fv(n)}))}function H4(n,e){return e().catch((t=>Xg(n,t,e)))}async function Lv(n){const e=at(n),t=Ys(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Cw;for(;AY(e);)try{const i=await uY(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,RY(e,i)}catch(i){await Xg(e,i)}W4(e)&&q4(e)}function AY(n){return fl(n)&&n.Ta.length<10}function RY(n,e){n.Ta.push(e);const t=Ys(n);t.O_()&&t.X_&&t.ea(e.mutations)}function W4(n){return fl(n)&&!Ys(n).x_()&&n.Ta.length>0}function q4(n){Ys(n).start()}async function IY(n){Ys(n).ra()}async function NY(n){const e=Ys(n);for(const t of n.Ta)e.ea(t.mutations)}async function DY(n,e,t){const r=n.Ta.shift(),i=kw.from(r,e,t);await H4(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await Lv(n)}async function kY(n,e){e&&Ys(n).X_&&await(async function(r,i){if((function(o){return dX(o)&&o!==_e.ABORTED})(i.code)){const a=r.Ta.shift();Ys(r).B_(),await H4(r,(()=>r.remoteSyncer.rejectFailedWrite(a.batchId,i))),await Lv(r)}})(n,e),W4(n)&&q4(n)}async function mI(n,e){const t=at(n);t.asyncQueue.verifyOperationInProgress(),Me(nl,"RemoteStore received new credentials");const r=fl(t);t.Ea.add(3),await Gd(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Fv(t)}async function MY(n,e){const t=at(n);e?(t.Ea.delete(2),await Fv(t)):e||(t.Ea.add(2),await Gd(t),t.Ra.set("Unknown"))}function dh(n){return n.ma||(n.ma=(function(t,r,i){const a=at(t);return a.sa(),new vY(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)})(n.datastore,n.asyncQueue,{Xo:EY.bind(null,n),t_:TY.bind(null,n),r_:CY.bind(null,n),H_:SY.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),zw(n)?Uw(n):n.Ra.set("Unknown")):(await n.ma.stop(),G4(n))}))),n.ma}function Ys(n){return n.fa||(n.fa=(function(t,r,i){const a=at(t);return a.sa(),new yY(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:IY.bind(null,n),r_:kY.bind(null,n),ta:NY.bind(null,n),na:DY.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Lv(n)):(await n.fa.stop(),n.Ta.length>0&&(Me(nl,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Gw{constructor(e,t,r,i,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Fs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,a){const o=Date.now()+r,u=new Gw(e,t,o,i,a);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new De(_e.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Hw(n,e){if(Vo("AsyncQueue",`${e}: ${n}`),hh(n))return new De(_e.UNAVAILABLE,`${e}: ${n}`);throw n}class Pc{static emptySet(e){return new Pc(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||We.comparator(t.key,r.key):(t,r)=>We.comparator(t.key,r.key),this.keyedMap=kf(),this.sortedSet=new Vn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Pc)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Pc;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class gI{constructor(){this.ga=new Vn(We.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ye(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Jc{constructor(e,t,r,i,a,o,u,c,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,a){const o=[];return t.forEach((u=>{o.push({type:0,doc:u})})),new Jc(e,t,Pc.emptySet(t),o,r,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Dv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class OY{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class PY{constructor(){this.queries=vI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=at(t),a=i.queries;i.queries=vI(),a.forEach(((o,u)=>{for(const c of u.Sa)c.onError(r)}))})(this,new De(_e.ABORTED,"Firestore shutting down"))}}function vI(){return new hl((n=>h4(n)),Dv)}async function VY(n,e){const t=at(n);let r=3;const i=e.query;let a=t.queries.get(i);a?!a.ba()&&e.Da()&&(r=2):(a=new OY,r=e.Da()?0:1);try{switch(r){case 0:a.wa=await t.onListen(i,!0);break;case 1:a.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const u=Hw(o,`Initialization of query '${gc(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,a),a.Sa.push(e),e.va(t.onlineState),a.wa&&e.Fa(a.wa)&&Ww(t)}async function FY(n,e){const t=at(n),r=e.query;let i=3;const a=t.queries.get(r);if(a){const o=a.Sa.indexOf(e);o>=0&&(a.Sa.splice(o,1),a.Sa.length===0?i=e.Da()?0:1:!a.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function LY(n,e){const t=at(n);let r=!1;for(const i of e){const a=i.query,o=t.queries.get(a);if(o){for(const u of o.Sa)u.Fa(i)&&(r=!0);o.wa=i}}r&&Ww(t)}function BY(n,e,t){const r=at(n),i=r.queries.get(e);if(i)for(const a of i.Sa)a.onError(t);r.queries.delete(e)}function Ww(n){n.Ca.forEach((e=>{e.next()}))}var v1,yI;(yI=v1||(v1={})).Ma="default",yI.Cache="cache";class jY{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Jc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Jc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==v1.Cache}}class K4{constructor(e){this.key=e}}class X4{constructor(e){this.key=e}}class UY{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=_t(),this.mutatedKeys=_t(),this.eu=f4(e),this.tu=new Pc(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new gI,i=t?t.tu:this.tu;let a=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((d,p)=>{const g=i.get(d),v=kv(this.query,p)?p:null,b=!!g&&this.mutatedKeys.has(g.key),w=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let E=!1;g&&v?g.data.isEqual(v.data)?b!==w&&(r.track({type:3,doc:v}),E=!0):this.su(g,v)||(r.track({type:2,doc:v}),E=!0,(c&&this.eu(v,c)>0||h&&this.eu(v,h)<0)&&(u=!0)):!g&&v?(r.track({type:0,doc:v}),E=!0):g&&!v&&(r.track({type:1,doc:g}),E=!0,(c||h)&&(u=!0)),E&&(v?(o=o.add(v),a=w?a.add(d):a.delete(d)):(o=o.delete(d),a=a.delete(d)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),a=a.delete(d.key),r.track({type:1,doc:d})}return{tu:o,iu:r,Cs:u,mutatedKeys:a}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((d,p)=>(function(v,b){const w=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ye(20277,{Rt:E})}};return w(v)-w(b)})(d.type,p.type)||this.eu(d.doc,p.doc))),this.ou(r),i=i??!1;const u=t&&!i?this._u():[],c=this.Xa.size===0&&this.current&&!i?1:0,h=c!==this.Za;return this.Za=c,o.length!==0||h?{snapshot:new Jc(this.query,e.tu,a,o,e.mutatedKeys,c===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new gI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=_t(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new X4(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new K4(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=_t();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Jc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const qw="SyncEngine";class zY{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class GY{constructor(e){this.key=e,this.hu=!1}}class HY{constructor(e,t,r,i,a,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new hl((u=>h4(u)),Dv),this.Iu=new Map,this.Eu=new Set,this.du=new Vn(We.comparator),this.Au=new Map,this.Ru=new Pw,this.Vu={},this.mu=new Map,this.fu=Zc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function WY(n,e,t=!0){const r=eO(n);let i;const a=r.Tu.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await Y4(r,e,t,!0),i}async function qY(n,e){const t=eO(n);await Y4(t,e,!0,!1)}async function Y4(n,e,t,r){const i=await lY(n.localStore,Ya(e)),a=i.targetId,o=n.sharedClientState.addLocalQueryTarget(a,t);let u;return r&&(u=await KY(n,e,a,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&U4(n.remoteStore,i),u}async function KY(n,e,t,r,i){n.pu=(p,g,v)=>(async function(w,E,T,R){let I=E.view.ru(T);I.Cs&&(I=await cI(w.localStore,E.query,!1).then((({documents:O})=>E.view.ru(O,I))));const C=R&&R.targetChanges.get(E.targetId),k=R&&R.targetMismatches.get(E.targetId)!=null,L=E.view.applyChanges(I,w.isPrimaryClient,C,k);return bI(w,E.targetId,L.au),L.snapshot})(n,p,g,v);const a=await cI(n.localStore,e,!0),o=new UY(e,a.Qs),u=o.ru(a.documents),c=zd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(u,n.isPrimaryClient,c);bI(n,t,h.au);const d=new zY(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function XY(n,e,t){const r=at(n),i=r.Tu.get(e),a=r.Iu.get(i.targetId);if(a.length>1)return r.Iu.set(i.targetId,a.filter((o=>!Dv(o,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await m1(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Bw(r.remoteStore,i.targetId),y1(r,i.targetId)})).catch(ch)):(y1(r,i.targetId),await m1(r.localStore,i.targetId,!0))}async function YY(n,e){const t=at(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Bw(t.remoteStore,r.targetId))}async function $Y(n,e,t){const r=r$(n);try{const i=await(function(o,u){const c=at(o),h=Jt.now(),d=u.reduce(((v,b)=>v.add(b.key)),_t());let p,g;return c.persistence.runTransaction("Locally write mutations","readwrite",(v=>{let b=Lo(),w=_t();return c.Ns.getEntries(v,d).next((E=>{b=E,b.forEach(((T,R)=>{R.isValidDocument()||(w=w.add(T))}))})).next((()=>c.localDocuments.getOverlayedDocuments(v,b))).next((E=>{p=E;const T=[];for(const R of u){const I=uX(R,p.get(R.key).overlayedDocument);I!=null&&T.push(new ru(R.key,I,n4(I.value.mapValue),Ui.exists(!0)))}return c.mutationQueue.addMutationBatch(v,h,T,u)})).next((E=>{g=E;const T=E.applyToLocalDocumentSet(p,w);return c.documentOverlayCache.saveOverlays(v,E.batchId,T)}))})).then((()=>({batchId:g.batchId,changes:p4(p)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(o,u,c){let h=o.Vu[o.currentUser.toKey()];h||(h=new Vn(yt)),h=h.insert(u,c),o.Vu[o.currentUser.toKey()]=h})(r,i.batchId,t),await Hd(r,i.changes),await Lv(r.remoteStore)}catch(i){const a=Hw(i,"Failed to persist write");t.reject(a)}}async function $4(n,e){const t=at(n);try{const r=await oY(t.localStore,e);e.targetChanges.forEach(((i,a)=>{const o=t.Au.get(a);o&&(Ot(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?Ot(o.hu,14607):i.removedDocuments.size>0&&(Ot(o.hu,42227),o.hu=!1))})),await Hd(t,r,e)}catch(r){await ch(r)}}function _I(n,e,t){const r=at(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((a,o)=>{const u=o.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(o,u){const c=at(o);c.onlineState=u;let h=!1;c.queries.forEach(((d,p)=>{for(const g of p.Sa)g.va(u)&&(h=!0)})),h&&Ww(c)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function QY(n,e,t){const r=at(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),a=i&&i.key;if(a){let o=new Vn(We.comparator);o=o.insert(a,Tr.newNoDocument(a,tt.min()));const u=_t().add(a),c=new Pv(tt.min(),new Map,new Vn(yt),o,u);await $4(r,c),r.du=r.du.remove(a),r.Au.delete(e),Kw(r)}else await m1(r.localStore,e,!1).then((()=>y1(r,e,t))).catch(ch)}async function ZY(n,e){const t=at(n),r=e.batch.batchId;try{const i=await aY(t.localStore,e);Z4(t,r,null),Q4(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Hd(t,i)}catch(i){await ch(i)}}async function JY(n,e,t){const r=at(n);try{const i=await(function(o,u){const c=at(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let d;return c.mutationQueue.lookupMutationBatch(h,u).next((p=>(Ot(p!==null,37113),d=p.keys(),c.mutationQueue.removeMutationBatch(h,p)))).next((()=>c.mutationQueue.performConsistencyCheck(h))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(h,d,u))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d))).next((()=>c.localDocuments.getDocuments(h,d)))}))})(r.localStore,e);Z4(r,e,t),Q4(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Hd(r,i)}catch(i){await ch(i)}}function Q4(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Z4(n,e,t){const r=at(n);let i=r.Vu[r.currentUser.toKey()];if(i){const a=i.get(e);a&&(t?a.reject(t):a.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function y1(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||J4(n,r)}))}function J4(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Bw(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Kw(n))}function bI(n,e,t){for(const r of t)r instanceof K4?(n.Ru.addReference(r.key,e),e$(n,r)):r instanceof X4?(Me(qw,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||J4(n,r.key)):Ye(19791,{wu:r})}function e$(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Me(qw,"New document in limbo: "+t),n.Eu.add(r),Kw(n))}function Kw(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new We(qt.fromString(e)),r=n.fu.next();n.Au.set(r,new GY(t)),n.du=n.du.insert(t,r),U4(n.remoteStore,new Is(Ya(l4(t.path)),r,"TargetPurposeLimboResolution",Rv.ce))}}async function Hd(n,e,t){const r=at(n),i=[],a=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,c)=>{o.push(r.pu(c,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const d=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;r.sharedClientState.updateQueryState(c.targetId,d?"current":"not-current")}if(h){i.push(h);const d=Fw.As(c.targetId,h);a.push(d)}})))})),await Promise.all(o),r.Pu.H_(i),await(async function(c,h){const d=at(c);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>we.forEach(h,(g=>we.forEach(g.Es,(v=>d.persistence.referenceDelegate.addReference(p,g.targetId,v))).next((()=>we.forEach(g.ds,(v=>d.persistence.referenceDelegate.removeReference(p,g.targetId,v)))))))))}catch(p){if(!hh(p))throw p;Me(Lw,"Failed to update sequence numbers: "+p)}for(const p of h){const g=p.targetId;if(!p.fromCache){const v=d.Ms.get(g),b=v.snapshotVersion,w=v.withLastLimboFreeSnapshotVersion(b);d.Ms=d.Ms.insert(g,w)}}})(r.localStore,a))}async function t$(n,e){const t=at(n);if(!t.currentUser.isEqual(e)){Me(qw,"User change. New user:",e.toKey());const r=await F4(t.localStore,e);t.currentUser=e,(function(a,o){a.mu.forEach((u=>{u.forEach((c=>{c.reject(new De(_e.CANCELLED,o))}))})),a.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Hd(t,r.Ls)}}function n$(n,e){const t=at(n),r=t.Au.get(e);if(r&&r.hu)return _t().add(r.key);{let i=_t();const a=t.Iu.get(e);if(!a)return i;for(const o of a){const u=t.Tu.get(o);i=i.unionWith(u.view.nu)}return i}}function eO(n){const e=at(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=$4.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=n$.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=QY.bind(null,e),e.Pu.H_=LY.bind(null,e.eventManager),e.Pu.yu=BY.bind(null,e.eventManager),e}function r$(n){const e=at(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ZY.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=JY.bind(null,e),e}class Yg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Vv(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return iY(this.persistence,new tY,e.initialUser,this.serializer)}Cu(e){return new V4(Vw.mi,this.serializer)}Du(e){return new hY}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Yg.provider={build:()=>new Yg};class i$ extends Yg{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Ot(this.persistence.referenceDelegate instanceof Kg,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new jX(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?qr.withCacheSize(this.cacheSizeBytes):qr.DEFAULT;return new V4((r=>Kg.mi(r,t)),this.serializer)}}class _1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>_I(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=t$.bind(null,this.syncEngine),await MY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new PY})()}createDatastore(e){const t=Vv(e.databaseInfo.databaseId),r=(function(a){return new gY(a)})(e.databaseInfo);return(function(a,o,u,c){return new bY(a,o,u,c)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,a,o,u){return new wY(r,i,a,o,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>_I(this.syncEngine,t,0)),(function(){return dI.v()?new dI:new fY})())}createSyncEngine(e,t){return(function(i,a,o,u,c,h,d){const p=new HY(i,a,o,u,c,h);return d&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=at(t);Me(nl,"RemoteStore shutting down."),r.Ea.add(5),await Gd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}_1.provider={build:()=>new _1};class a${constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Vo("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const $s="FirestoreClient";class o${constructor(e,t,r,i,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=wr.UNAUTHENTICATED,this.clientId=Tw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,(async o=>{Me($s,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,(o=>(Me($s,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Fs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Hw(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Y_(n,e){n.asyncQueue.verifyOperationInProgress(),Me($s,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await F4(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function xI(n,e){n.asyncQueue.verifyOperationInProgress();const t=await s$(n);Me($s,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>mI(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>mI(e.remoteStore,i))),n._onlineComponents=e}async function s$(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Me($s,"Using user provided OfflineComponentProvider");try{await Y_(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===_e.FAILED_PRECONDITION||i.code===_e.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Xc("Error using user provided cache. Falling back to memory cache: "+t),await Y_(n,new Yg)}}else Me($s,"Using default OfflineComponentProvider"),await Y_(n,new i$(void 0));return n._offlineComponents}async function tO(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Me($s,"Using user provided OnlineComponentProvider"),await xI(n,n._uninitializedComponentsProvider._online)):(Me($s,"Using default OnlineComponentProvider"),await xI(n,new _1))),n._onlineComponents}function u$(n){return tO(n).then((e=>e.syncEngine))}async function l$(n){const e=await tO(n),t=e.eventManager;return t.onListen=WY.bind(null,e.syncEngine),t.onUnlisten=XY.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=qY.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=YY.bind(null,e.syncEngine),t}function c$(n,e,t={}){const r=new Fs;return n.asyncQueue.enqueueAndForget((async()=>(function(a,o,u,c,h){const d=new a$({next:g=>{d.Nu(),o.enqueueAndForget((()=>FY(a,p))),g.fromCache&&c.source==="server"?h.reject(new De(_e.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(g)},error:g=>h.reject(g)}),p=new jY(u,d,{includeMetadataChanges:!0,qa:!0});return VY(a,p)})(await l$(n),n.asyncQueue,e,t,r))),r.promise}function nO(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const wI=new Map;const rO="firestore.googleapis.com",EI=!0;class TI{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new De(_e.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rO,this.ssl=EI}else this.host=e.host,this.ssl=e.ssl??EI;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=P4;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<LX)throw new De(_e.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}wK("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nO(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new De(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new De(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new De(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bv{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new TI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new De(_e.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new De(_e.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new TI(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new fK;switch(r.type){case"firstParty":return new gK(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new De(_e.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=wI.get(t);r&&(Me("ComponentProvider","Removing Datastore"),wI.delete(t),r.terminate())})(this),Promise.resolve()}}function h$(n,e,t,r={}){n=Fo(n,Bv);const i=Bd(e),a=n._getSettings(),o={...a,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;i&&(x3(`https://${u}`),E3("Firestore",!0)),a.host!==rO&&a.host!==u&&Xc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...a,host:u,ssl:i,emulatorOptions:r};if(!ld(c,o)&&(n._setSettings(c),r.mockUserToken)){let h,d;if(typeof r.mockUserToken=="string")h=r.mockUserToken,d=wr.MOCK_USER;else{h=w3(r.mockUserToken,n._app?.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new De(_e.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new wr(p)}n._authCredentials=new dK(new H3(h,d))}}class iu{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new iu(this.firestore,e,this._query)}}class Pn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pn(this.firestore,e,this._key)}toJSON(){return{type:Pn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(jd(t,Pn._jsonSchema))return new Pn(e,r||null,new We(qt.fromString(t.referencePath)))}}Pn._jsonSchemaVersion="firestore/documentReference/1.0",Pn._jsonSchema={type:On("string",Pn._jsonSchemaVersion),referencePath:On("string")};class Bs extends iu{constructor(e,t,r){super(e,t,l4(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pn(this.firestore,null,new We(e))}withConverter(e){return new Bs(this.firestore,e,this._path)}}function vi(n,e,...t){if(n=ca(n),W3("collection","path",e),n instanceof Bv){const r=qt.fromString(e,...t);return FR(r),new Bs(n,null,r)}{if(!(n instanceof Pn||n instanceof Bs))throw new De(_e.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qt.fromString(e,...t));return FR(r),new Bs(n.firestore,null,r)}}function Do(n,e,...t){if(n=ca(n),arguments.length===1&&(e=Tw.newId()),W3("doc","path",e),n instanceof Bv){const r=qt.fromString(e,...t);return VR(r),new Pn(n,null,new We(r))}{if(!(n instanceof Pn||n instanceof Bs))throw new De(_e.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qt.fromString(e,...t));return VR(r),new Pn(n.firestore,n instanceof Bs?n.converter:null,new We(r))}}const CI="AsyncQueue";class SI{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new B4(this,"async_queue_retry"),this._c=()=>{const r=X_();r&&Me(CI,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=X_();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=X_();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Fs;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!hh(e))throw e;Me(CI,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Vo("INTERNAL UNHANDLED ERROR: ",AI(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Gw.createAndSchedule(this,e,t,r,(a=>this.hc(a)));return this.tc.push(i),i}uc(){this.nc&&Ye(47125,{Pc:AI(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function AI(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class ph extends Bv{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new SI,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new SI(e),this._firestoreClient=void 0,await e}}}function f$(n,e){const t=typeof n=="object"?n:O3(),r=typeof n=="string"?n:zg,i=N3(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const a=_3("firestore");a&&h$(i,...a)}return i}function iO(n){if(n._terminated)throw new De(_e.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||d$(n),n._firestoreClient}function d$(n){const e=n._freezeSettings(),t=(function(i,a,o,u){return new OK(i,a,o,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,nO(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new o$(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const a=i?._online.build();return{_offline:i?._offline.build(a),_online:a}})(n._componentsProvider))}class Vi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Vi(vr.fromBase64String(e))}catch(t){throw new De(_e.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Vi(vr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Vi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(jd(e,Vi._jsonSchema))return Vi.fromBase64String(e.bytes)}}Vi._jsonSchemaVersion="firestore/bytes/1.0",Vi._jsonSchema={type:On("string",Vi._jsonSchemaVersion),bytes:On("string")};class jv{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new De(_e.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Wd{constructor(e){this._methodName=e}}class Qa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new De(_e.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new De(_e.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return yt(this._lat,e._lat)||yt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Qa._jsonSchemaVersion}}static fromJSON(e){if(jd(e,Qa._jsonSchema))return new Qa(e.latitude,e.longitude)}}Qa._jsonSchemaVersion="firestore/geoPoint/1.0",Qa._jsonSchema={type:On("string",Qa._jsonSchemaVersion),latitude:On("number"),longitude:On("number")};class Za{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==i[a])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Za._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(jd(e,Za._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Za(e.vectorValues);throw new De(_e.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Za._jsonSchemaVersion="firestore/vectorValue/1.0",Za._jsonSchema={type:On("string",Za._jsonSchemaVersion),vectorValues:On("object")};const p$=/^__.*__$/;class m${constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ru(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ud(e,this.data,t,this.fieldTransforms)}}class aO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ru(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function oO(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ye(40011,{Ac:n})}}class Xw{constructor(e,t,r,i,a,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Xw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return $g(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(oO(this.Ac)&&p$.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class g${constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Vv(e)}Cc(e,t,r,i=!1){return new Xw({Ac:e,methodName:t,Dc:r,path:gr.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Uv(n){const e=n._freezeSettings(),t=Vv(n._databaseId);return new g$(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sO(n,e,t,r,i,a={}){const o=n.Cc(a.merge||a.mergeFields?2:0,e,t,i);Qw("Data must be an object, but it was:",o,r);const u=uO(r,o);let c,h;if(a.merge)c=new mi(o.fieldMask),h=o.fieldTransforms;else if(a.mergeFields){const d=[];for(const p of a.mergeFields){const g=b1(e,p,t);if(!o.contains(g))throw new De(_e.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);cO(d,g)||d.push(g)}c=new mi(d),h=o.fieldTransforms.filter((p=>c.covers(p.field)))}else c=null,h=o.fieldTransforms;return new m$(new Yr(u),c,h)}class zv extends Wd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof zv}}class Yw extends Wd{_toFieldTransform(e){return new w4(e.path,new vd)}isEqual(e){return e instanceof Yw}}class $w extends Wd{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new bd(e.serializer,v4(e.serializer,this.Fc));return new w4(e.path,t)}isEqual(e){return e instanceof $w&&this.Fc===e.Fc}}function v$(n,e,t,r){const i=n.Cc(1,e,t);Qw("Data must be an object, but it was:",i,r);const a=[],o=Yr.empty();nu(r,((c,h)=>{const d=Zw(e,c,t);h=ca(h);const p=i.yc(d);if(h instanceof zv)a.push(d);else{const g=qd(h,p);g!=null&&(a.push(d),o.set(d,g))}}));const u=new mi(a);return new aO(o,u,i.fieldTransforms)}function y$(n,e,t,r,i,a){const o=n.Cc(1,e,t),u=[b1(e,r,t)],c=[i];if(a.length%2!=0)throw new De(_e.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<a.length;g+=2)u.push(b1(e,a[g])),c.push(a[g+1]);const h=[],d=Yr.empty();for(let g=u.length-1;g>=0;--g)if(!cO(h,u[g])){const v=u[g];let b=c[g];b=ca(b);const w=o.yc(v);if(b instanceof zv)h.push(v);else{const E=qd(b,w);E!=null&&(h.push(v),d.set(v,E))}}const p=new mi(h);return new aO(d,p,o.fieldTransforms)}function _$(n,e,t,r=!1){return qd(t,n.Cc(r?4:3,e))}function qd(n,e){if(lO(n=ca(n)))return Qw("Unsupported field value:",e,n),uO(n,e);if(n instanceof Wd)return(function(r,i){if(!oO(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(i);a&&i.fieldTransforms.push(a)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const a=[];let o=0;for(const u of r){let c=qd(u,i.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),o++}return{arrayValue:{values:a}}})(n,e)}return(function(r,i){if((r=ca(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return v4(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=Jt.fromDate(r);return{timestampValue:qg(i.serializer,a)}}if(r instanceof Jt){const a=new Jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qg(i.serializer,a)}}if(r instanceof Qa)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Vi)return{bytesValue:R4(i.serializer,r._byteString)};if(r instanceof Pn){const a=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(a))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Ow(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Za)return(function(o,u){return{mapValue:{fields:{[e4]:{stringValue:t4},[Gg]:{arrayValue:{values:o.toArray().map((h=>{if(typeof h!="number")throw u.Sc("VectorValues must only contain numeric values.");return Nw(u.serializer,h)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Av(r)}`)})(n,e)}function uO(n,e){const t={};return X3(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):nu(n,((r,i)=>{const a=qd(i,e.mc(r));a!=null&&(t[r]=a)})),{mapValue:{fields:t}}}function lO(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Jt||n instanceof Qa||n instanceof Vi||n instanceof Pn||n instanceof Wd||n instanceof Za)}function Qw(n,e,t){if(!lO(t)||!q3(t)){const r=Av(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function b1(n,e,t){if((e=ca(e))instanceof jv)return e._internalPath;if(typeof e=="string")return Zw(n,e);throw $g("Field path arguments must be of type string or ",n,!1,void 0,t)}const b$=new RegExp("[~\\*/\\[\\]]");function Zw(n,e,t){if(e.search(b$)>=0)throw $g(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new jv(...e.split("."))._internalPath}catch{throw $g(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function $g(n,e,t,r,i){const a=r&&!r.isEmpty(),o=i!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new De(_e.INVALID_ARGUMENT,u+n+c)}function cO(n,e){return n.some((t=>t.isEqual(e)))}class hO{constructor(e,t,r,i,a){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Pn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new x$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gv("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class x$ extends hO{data(){return super.data()}}function Gv(n,e){return typeof e=="string"?Zw(n,e):e instanceof jv?e._internalPath:e._delegate._internalPath}function w$(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new De(_e.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jw{}class eE extends Jw{}function fO(n,e,...t){let r=[];e instanceof Jw&&r.push(e),r=r.concat(t),(function(a){const o=a.filter((c=>c instanceof tE)).length,u=a.filter((c=>c instanceof Hv)).length;if(o>1||o>0&&u>0)throw new De(_e.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class Hv extends eE{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Hv(e,t,r)}_apply(e){const t=this._parse(e);return dO(e._query,t),new iu(e.firestore,e.converter,c1(e._query,t))}_parse(e){const t=Uv(e.firestore);return(function(a,o,u,c,h,d,p){let g;if(h.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new De(_e.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){NI(p,d);const b=[];for(const w of p)b.push(II(c,a,w));g={arrayValue:{values:b}}}else g=II(c,a,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||NI(p,d),g=_$(u,o,p,d==="in"||d==="not-in");return Mn.create(h,d,g)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function RI(n,e,t){const r=e,i=Gv("where",n);return Hv._create(i,r,t)}class tE extends Jw{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tE(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:ha.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,a){let o=i;const u=a.getFlattenedFilters();for(const c of u)dO(o,c),o=c1(o,c)})(e._query,t),new iu(e.firestore,e.converter,c1(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class nE extends eE{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new nE(e,t)}_apply(e){const t=(function(i,a,o){if(i.startAt!==null)throw new De(_e.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new De(_e.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gd(a,o)})(e._query,this._field,this._direction);return new iu(e.firestore,e.converter,(function(i,a){const o=i.explicitOrderBy.concat([a]);return new fh(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}}function x1(n,e="asc"){const t=e,r=Gv("orderBy",n);return nE._create(r,t)}class rE extends eE{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new rE(e,t,r)}_apply(e){return new iu(e.firestore,e.converter,Wg(e._query,this._limit,this._limitType))}}function E$(n){return EK("limit",n),rE._create("limit",n,"F")}function II(n,e,t){if(typeof(t=ca(t))=="string"){if(t==="")throw new De(_e.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!c4(e)&&t.indexOf("/")!==-1)throw new De(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(qt.fromString(t));if(!We.isDocumentKey(r))throw new De(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return WR(n,new We(r))}if(t instanceof Pn)return WR(n,t._key);throw new De(_e.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Av(t)}.`)}function NI(n,e){if(!Array.isArray(n)||n.length===0)throw new De(_e.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dO(n,e){const t=(function(i,a){for(const o of i)for(const u of o.getFlattenedFilters())if(a.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new De(_e.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new De(_e.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class T${convertValue(e,t="none"){switch(Xs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _n(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ks(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ye(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return nu(e,((i,a)=>{r[i]=this.convertValue(a,t)})),r}convertVectorValue(e){const t=e.fields?.[Gg].arrayValue?.values?.map((r=>_n(r.doubleValue)));return new Za(t)}convertGeoPoint(e){return new Qa(_n(e.latitude),_n(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Nv(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(dd(e));default:return null}}convertTimestamp(e){const t=qs(e);return new Jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=qt.fromString(e);Ot(O4(r),9688,{name:e});const i=new pd(r.get(1),r.get(3)),a=new We(r.popFirst(5));return i.isEqual(t)||Vo(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}function pO(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class qm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Vc extends hO{constructor(e,t,r,i,a,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new og(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Gv("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new De(_e.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Vc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Vc._jsonSchemaVersion="firestore/documentSnapshot/1.0",Vc._jsonSchema={type:On("string",Vc._jsonSchemaVersion),bundleSource:On("string","DocumentSnapshot"),bundleName:On("string"),bundle:On("string")};class og extends Vc{data(e={}){return super.data(e)}}class Fc{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new qm(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new og(this._firestore,this._userDataWriter,r.key,r,new qm(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new De(_e.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,a){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((u=>{const c=new og(i._firestore,i._userDataWriter,u.doc.key,u.doc,new qm(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>a||u.type!==3)).map((u=>{const c=new og(i._firestore,i._userDataWriter,u.doc.key,u.doc,new qm(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return u.type!==0&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),u.type!==1&&(o=o.add(u.doc),d=o.indexOf(u.doc.key)),{type:C$(u.type),doc:c,oldIndex:h,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new De(_e.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Fc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Tw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((a=>{a._document!==null&&(t.push(a._document),r.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),i.push(a.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function C$(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ye(61501,{type:n})}}Fc._jsonSchemaVersion="firestore/querySnapshot/1.0",Fc._jsonSchema={type:On("string",Fc._jsonSchemaVersion),bundleSource:On("string","QuerySnapshot"),bundleName:On("string"),bundle:On("string")};class S$ extends T${constructor(e){super(),this.firestore=e}convertBytes(e){return new Vi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pn(this.firestore,null,t)}}function xd(n){n=Fo(n,iu);const e=Fo(n.firestore,ph),t=iO(e),r=new S$(e);return w$(n._query),c$(t,n._query).then((i=>new Fc(e,r,n,i)))}function A$(n,e,t){n=Fo(n,Pn);const r=Fo(n.firestore,ph),i=pO(n.converter,e);return Wv(r,[sO(Uv(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ui.none())])}function wd(n,e,t,...r){n=Fo(n,Pn);const i=Fo(n.firestore,ph),a=Uv(i);let o;return o=typeof(e=ca(e))=="string"||e instanceof jv?y$(a,"updateDoc",n._key,e,t,r):v$(a,"updateDoc",n._key,e),Wv(i,[o.toMutation(n._key,Ui.exists(!0))])}function mO(n){return Wv(Fo(n.firestore,ph),[new Dw(n._key,Ui.none())])}function au(n,e){const t=Fo(n.firestore,ph),r=Do(n),i=pO(n.converter,e);return Wv(t,[sO(Uv(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ui.exists(!1))]).then((()=>r))}function Wv(n,e){return(function(r,i){const a=new Fs;return r.asyncQueue.enqueueAndForget((async()=>$Y(await u$(r),i,a))),a.promise})(iO(n),e)}function gO(){return new Yw("serverTimestamp")}function vO(n){return new $w("increment",n)}(function(e,t=!0){(function(i){lh=i})(k3),cd(new Kc("firestore",((r,{instanceIdentifier:i,options:a})=>{const o=r.getProvider("app").getImmediate(),u=new ph(new pK(r.getProvider("auth-internal")),new vK(o,r.getProvider("app-check-internal")),(function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new De(_e.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pd(h.options.projectId,d)})(o,i),o);return a={useFetchStreams:t,...a},u._setSettings(a),u}),"PUBLIC").setMultipleInstances(!0)),Ps(kR,MR,e),Ps(kR,MR,"esm2020")})();var DI={};const kI="@firebase/database",MI="1.1.0";let yO="";function R$(n){yO=n}class I${constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),mr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ud(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class N${constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return qo(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const _O=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new I$(e)}}catch{}return new N$},Xu=_O("localStorage"),D$=_O("sessionStorage");const Lc=new xw("@firebase/database"),k$=(function(){let n=1;return function(){return n++}})(),bO=function(n){const e=t7(n),t=new Jq;t.update(e);const r=t.digest();return yw.encodeByteArray(r)},Kd=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Kd.apply(null,r):typeof r=="object"?e+=mr(r):e+=r,e+=" "}return e};let qf=null,OI=!0;const M$=function(n,e){Ne(!0,"Can't turn on custom loggers persistently."),Lc.logLevel=xt.VERBOSE,qf=Lc.log.bind(Lc)},Cr=function(...n){if(OI===!0&&(OI=!1,qf===null&&D$.get("logging_enabled")===!0&&M$()),qf){const e=Kd.apply(null,n);qf(e)}},Xd=function(n){return function(...e){Cr(n,...e)}},w1=function(...n){const e="FIREBASE INTERNAL ERROR: "+Kd(...n);Lc.error(e)},Bo=function(...n){const e=`FIREBASE FATAL ERROR: ${Kd(...n)}`;throw Lc.error(e),new Error(e)},yi=function(...n){const e="FIREBASE WARNING: "+Kd(...n);Lc.warn(e)},O$=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&yi("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},xO=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},P$=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},eh="[MIN_NAME]",rl="[MAX_NAME]",mh=function(n,e){if(n===e)return 0;if(n===eh||e===rl)return-1;if(e===eh||n===rl)return 1;{const t=PI(n),r=PI(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},V$=function(n,e){return n===e?0:n<e?-1:1},Sf=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+mr(e))},iE=function(n){if(typeof n!="object"||n===null)return mr(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=mr(e[r]),t+=":",t+=iE(n[e[r]]);return t+="}",t},wO=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function zi(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const EO=function(n){Ne(!xO(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let i,a,o,u,c;n===0?(a=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(u=Math.min(Math.floor(Math.log(n)/Math.LN2),r),a=u+r,o=Math.round(n*Math.pow(2,t-u)-Math.pow(2,t))):(a=0,o=Math.round(n/Math.pow(2,1-r-t))));const h=[];for(c=t;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)h.push(a%2?1:0),a=Math.floor(a/2);h.push(i?1:0),h.reverse();const d=h.join("");let p="";for(c=0;c<64;c+=8){let g=parseInt(d.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),p=p+g}return p.toLowerCase()},F$=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},L$=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},B$=new RegExp("^-?(0*)\\d{1,10}$"),j$=-2147483648,U$=2147483647,PI=function(n){if(B$.test(n)){const e=Number(n);if(e>=j$&&e<=U$)return e}return null},Yd=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw yi("Exception was thrown by user callback.",t),e},Math.floor(0))}},z$=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Kf=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class G${constructor(e,t){this.appCheckProvider=t,this.appName=e.name,D3(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){yi(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class H${constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Cr("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',yi(e)}}class sg{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}sg.OWNER="owner";const aE="5",TO="v",CO="s",SO="r",AO="f",RO=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,IO="ls",NO="p",E1="ac",DO="websocket",kO="long_polling";class MO{constructor(e,t,r,i,a=!1,o="",u=!1,c=!1,h=null){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=a,this.persistenceKey=o,this.includeNamespaceInQueryParams=u,this.isUsingEmulator=c,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Xu.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Xu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function W$(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function OO(n,e,t){Ne(typeof e=="string","typeof type must == string"),Ne(typeof t=="object","typeof params must == object");let r;if(e===DO)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===kO)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);W$(n)&&(t.ns=n.namespace);const i=[];return zi(t,(a,o)=>{i.push(a+"="+o)}),r+i.join("&")}class q${constructor(){this.counters_={}}incrementCounter(e,t=1){qo(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return kq(this.counters_)}}const $_={},Q_={};function oE(n){const e=n.toString();return $_[e]||($_[e]=new q$),$_[e]}function K$(n,e){const t=n.toString();return Q_[t]||(Q_[t]=e()),Q_[t]}class X${constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Yd(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const VI="start",Y$="close",$$="pLPCommand",Q$="pRTLPCB",PO="id",VO="pw",FO="ser",Z$="cb",J$="seg",eQ="ts",tQ="d",nQ="dframe",LO=1870,BO=30,rQ=LO-BO,iQ=25e3,aQ=3e4;class Tc{constructor(e,t,r,i,a,o,u){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.transportSessionId=o,this.lastSessionId=u,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Xd(e),this.stats_=oE(t),this.urlFn=c=>(this.appCheckToken&&(c[E1]=this.appCheckToken),OO(t,kO,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new X$(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(aQ)),P$(()=>{if(this.isClosed_)return;this.scriptTagHolder=new sE((...a)=>{const[o,u,c,h,d]=a;if(this.incrementIncomingBytes_(a),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===VI)this.id=u,this.password=c;else if(o===Y$)u?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(u,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...a)=>{const[o,u]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(o,u)},()=>{this.onClosed_()},this.urlFn);const r={};r[VI]="t",r[FO]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Z$]=this.scriptTagHolder.uniqueCallbackIdentifier),r[TO]=aE,this.transportSessionId&&(r[CO]=this.transportSessionId),this.lastSessionId&&(r[IO]=this.lastSessionId),this.applicationId&&(r[NO]=this.applicationId),this.appCheckToken&&(r[E1]=this.appCheckToken),typeof location<"u"&&location.hostname&&RO.test(location.hostname)&&(r[SO]=AO);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Tc.forceAllow_=!0}static forceDisallow(){Tc.forceDisallow_=!0}static isAvailable(){return Tc.forceAllow_?!0:!Tc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!F$()&&!L$()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=mr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=v3(t),i=wO(r,rQ);for(let a=0;a<i.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[a]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[nQ]="t",r[PO]=e,r[VO]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=mr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class sE{constructor(e,t,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=k$(),window[$$+this.uniqueCallbackIdentifier]=e,window[Q$+this.uniqueCallbackIdentifier]=t,this.myIFrame=sE.createIFrame_();let a="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(a='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(u){Cr("frame writing exception"),u.stack&&Cr(u.stack),Cr(u)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Cr("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[PO]=this.myID,e[VO]=this.myPW,e[FO]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+BO+r.length<=LO;){const o=this.pendingSegs.shift();r=r+"&"+J$+i+"="+o.seg+"&"+eQ+i+"="+o.ts+"&"+tQ+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(iQ)),a=()=>{clearTimeout(i),r()};this.addTag(e,a)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Cr("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}const oQ=16384,sQ=45e3;let Qg=null;typeof MozWebSocket<"u"?Qg=MozWebSocket:typeof WebSocket<"u"&&(Qg=WebSocket);class ia{constructor(e,t,r,i,a,o,u){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Xd(this.connId),this.stats_=oE(t),this.connURL=ia.connectionURL_(t,o,u,i,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,i,a){const o={};return o[TO]=aE,typeof location<"u"&&location.hostname&&RO.test(location.hostname)&&(o[SO]=AO),t&&(o[CO]=t),r&&(o[IO]=r),i&&(o[E1]=i),a&&(o[NO]=a),OO(e,DO,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Xu.set("previous_websocket_failure",!0);try{let r;Gq(),this.mySock=new Qg(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){ia.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Qg!==null&&!ia.forceDisallow_}static previouslyFailed(){return Xu.isInMemoryStorage||Xu.get("previous_websocket_failure")===!0}markConnectionHealthy(){Xu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=ud(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Ne(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=mr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=wO(t,oQ);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(sQ))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ia.responsesRequiredToBeHealthy=2;ia.healthyTimeout=3e4;class Ed{static get ALL_TRANSPORTS(){return[Tc,ia]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=ia&&ia.isAvailable();let r=t&&!ia.previouslyFailed();if(e.webSocketOnly&&(t||yi("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ia];else{const i=this.transports_=[];for(const a of Ed.ALL_TRANSPORTS)a&&a.isAvailable()&&i.push(a);Ed.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ed.globalTransportInitialized_=!1;const uQ=6e4,lQ=5e3,cQ=10*1024,hQ=100*1024,Z_="t",FI="d",fQ="s",LI="r",dQ="e",BI="o",jI="a",UI="n",zI="p",pQ="h";class mQ{constructor(e,t,r,i,a,o,u,c,h,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=a,this.onMessage_=o,this.onReady_=u,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Xd("c:"+this.id+":"),this.transportManager_=new Ed(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Kf(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>hQ?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>cQ?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Z_ in e){const t=e[Z_];t===jI?this.upgradeIfSecondaryHealthy_():t===LI?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===BI&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Sf("t",e),r=Sf("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:zI,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:jI,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:UI,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Sf("t",e),r=Sf("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Sf(Z_,e);if(FI in e){const r=e[FI];if(t===pQ){const i={...r};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===UI){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===fQ?this.onConnectionShutdown_(r):t===LI?this.onReset_(r):t===dQ?w1("Server Error: "+r):t===BI?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):w1("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),aE!==r&&yi("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Kf(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(uQ))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Kf(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(lQ))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:zI,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Xu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class jO{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class UO{constructor(e){this.allowedEvents_=e,this.listeners_={},Ne(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let a=0;a<i.length;a++)if(i[a].callback===t&&(!r||r===i[a].context)){i.splice(a,1);return}}validateEventType_(e){Ne(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Zg extends UO{static getInstance(){return new Zg}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!C3()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Ne(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const GI=32,HI=768;class en{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ht(){return new en("")}function Tt(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Qs(n){return n.pieces_.length-n.pieceNum_}function Zt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new en(n.pieces_,e)}function zO(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function gQ(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function GO(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function HO(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new en(e,0)}function nr(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof en)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new en(t,0)}function wt(n){return n.pieceNum_>=n.pieces_.length}function Bi(n,e){const t=Tt(n),r=Tt(e);if(t===null)return e;if(t===r)return Bi(Zt(n),Zt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function WO(n,e){if(Qs(n)!==Qs(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function oa(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Qs(n)>Qs(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class vQ{constructor(e,t){this.errorPrefix_=t,this.parts_=GO(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Sv(this.parts_[r]);qO(this)}}function yQ(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Sv(e),qO(n)}function _Q(n){const e=n.parts_.pop();n.byteLength_-=Sv(e),n.parts_.length>0&&(n.byteLength_-=1)}function qO(n){if(n.byteLength_>HI)throw new Error(n.errorPrefix_+"has a key path longer than "+HI+" bytes ("+n.byteLength_+").");if(n.parts_.length>GI)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+GI+") or object contains a cycle "+Uu(n))}function Uu(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class uE extends UO{static getInstance(){return new uE}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Ne(e==="visible","Unknown event type: "+e),[this.visible_]}}const Af=1e3,bQ=300*1e3,WI=30*1e3,xQ=1.3,wQ=3e4,EQ="server_kill",qI=3;class ko extends jO{constructor(e,t,r,i,a,o,u,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=a,this.authTokenProvider_=o,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=ko.nextPersistentConnectionId_++,this.log_=Xd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Af,this.maxReconnectDelay_=bQ,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");uE.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Zg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,a={r:i,a:e,b:t};this.log_(mr(a)),Ne(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new bw,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const u=o.d;o.s==="ok"?t.resolve(u):t.reject(u)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const a=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(a),t.promise}listen(e,t,r,i){this.initConnection_();const a=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+a),this.listens.has(o)||this.listens.set(o,new Map),Ne(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Ne(!this.listens.get(o).has(a),"listen() called twice for same path/queryId.");const u={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(o).set(a,u),this.connected_&&this.sendListen_(u)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+r+" for "+i);const a={p:r},o="q";e.tag&&(a.q=t._queryObject,a.t=e.tag),a.h=e.hashFn(),this.sendRequest(o,a,u=>{const c=u.d,h=u.s;ko.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",u),h!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&qo(e,"w")){const r=qc(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();yi(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Qq(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=WI)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=$q(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,i=>{const a=i.s,o=i.d||"error";this.authToken_===e&&(a==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),Ne(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,r,i){this.log_("Unlisten on "+e+" for "+t);const a={p:e},o="n";i&&(a.q=r,a.t=i),this.sendRequest(o,a)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,i){const a={p:t,d:r};this.log_("onDisconnect "+e,a),this.sendRequest(e,a,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,r,i){this.putInternal("p",e,t,r,i)}merge(e,t,r,i){this.putInternal("m",e,t,r,i)}putInternal(e,t,r,i,a){this.initConnection_();const o={p:t,d:r};a!==void 0&&(o.h=a),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const a=r.d;this.log_("reportStats","Error sending stats: "+a)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+mr(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):w1("Unrecognized action received from server: "+mr(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Ne(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Af,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Af,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>wQ&&(this.reconnectDelay_=Af),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*xQ)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+ko.nextConnectionId_++,a=this.lastSessionId;let o=!1,u=null;const c=function(){u?u.close():(o=!0,r())},h=function(p){Ne(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:c,sendRequest:h};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,g]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Cr("getToken() completed but was canceled"):(Cr("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=g&&g.token,u=new mQ(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,v=>{yi(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(EQ)},a))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&yi(p),c())}}}interrupt(e){Cr("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Cr("Resuming connection for reason: "+e),delete this.interruptReasons_[e],xR(this.interruptReasons_)&&(this.reconnectDelay_=Af,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(a=>iE(a)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const r=new en(e).toString();let i;if(this.listens.has(r)){const a=this.listens.get(r);i=a.get(t),a.delete(t),a.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,t){Cr("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=qI&&(this.reconnectDelay_=WI,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Cr("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=qI&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+yO.replace(/\./g,"-")]=1,C3()?e["framework.cordova"]=1:zq()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Zg.getInstance().currentlyOnline();return xR(this.interruptReasons_)&&e}}ko.nextPersistentConnectionId_=0;ko.nextConnectionId_=0;class Ct{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ct(e,t)}}class qv{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Ct(eh,e),i=new Ct(eh,t);return this.compare(r,i)!==0}minPost(){return Ct.MIN}}let Km;class KO extends qv{static get __EMPTY_NODE(){return Km}static set __EMPTY_NODE(e){Km=e}compare(e,t){return mh(e.name,t.name)}isDefinedOn(e){throw sh("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ct.MIN}maxPost(){return new Ct(rl,Km)}makePost(e,t){return Ne(typeof e=="string","KeyIndex indexValue must always be a string."),new Ct(e,Km)}toString(){return".key"}}const Bc=new KO;class Xm{constructor(e,t,r,i,a=null){this.isReverse_=i,this.resultGenerator_=a,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class tr{constructor(e,t,r,i,a){this.key=e,this.value=t,this.color=r??tr.RED,this.left=i??Qr.EMPTY_NODE,this.right=a??Qr.EMPTY_NODE}copy(e,t,r,i,a){return new tr(e??this.key,t??this.value,r??this.color,i??this.left,a??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const a=r(e,i.key);return a<0?i=i.copy(null,null,null,i.left.insert(e,t,r),null):a===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Qr.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,i;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Qr.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,tr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,tr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}tr.RED=!0;tr.BLACK=!1;class TQ{copy(e,t,r,i,a){return this}insert(e,t,r){return new tr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Qr{constructor(e,t=Qr.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Qr(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,tr.BLACK,null,null))}remove(e){return new Qr(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,tr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Xm(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Xm(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Xm(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Xm(this.root_,null,this.comparator_,!0,e)}}Qr.EMPTY_NODE=new TQ;function CQ(n,e){return mh(n.name,e.name)}function lE(n,e){return mh(n,e)}let T1;function SQ(n){T1=n}const XO=function(n){return typeof n=="number"?"number:"+EO(n):"string:"+n},YO=function(n){if(n.isLeafNode()){const e=n.val();Ne(typeof e=="string"||typeof e=="number"||typeof e=="object"&&qo(e,".sv"),"Priority must be a string or number.")}else Ne(n===T1||n.isEmpty(),"priority of unexpected type.");Ne(n===T1||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let KI;class Jn{static set __childrenNodeConstructor(e){KI=e}static get __childrenNodeConstructor(){return KI}constructor(e,t=Jn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Ne(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),YO(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Jn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Jn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return wt(e)?this:Tt(e)===".priority"?this.priorityNode_:Jn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Jn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Tt(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(Ne(r!==".priority"||Qs(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Jn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Zt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+XO(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=EO(this.value_):e+=this.value_,this.lazyHash_=bO(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Jn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Jn.__childrenNodeConstructor?-1:(Ne(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=Jn.VALUE_TYPE_ORDER.indexOf(t),a=Jn.VALUE_TYPE_ORDER.indexOf(r);return Ne(i>=0,"Unknown leaf type: "+t),Ne(a>=0,"Unknown leaf type: "+r),i===a?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Jn.VALUE_TYPE_ORDER=["object","boolean","number","string"];let $O,QO;function AQ(n){$O=n}function RQ(n){QO=n}class IQ extends qv{compare(e,t){const r=e.node.getPriority(),i=t.node.getPriority(),a=r.compareTo(i);return a===0?mh(e.name,t.name):a}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ct.MIN}maxPost(){return new Ct(rl,new Jn("[PRIORITY-POST]",QO))}makePost(e,t){const r=$O(e);return new Ct(t,new Jn("[PRIORITY-POST]",r))}toString(){return".priority"}}const Dr=new IQ;const NQ=Math.log(2);class DQ{constructor(e){const t=a=>parseInt(Math.log(a)/NQ,10),r=a=>parseInt(Array(a+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Jg=function(n,e,t,r){n.sort(e);const i=function(c,h){const d=h-c;let p,g;if(d===0)return null;if(d===1)return p=n[c],g=t?t(p):p,new tr(g,p.node,tr.BLACK,null,null);{const v=parseInt(d/2,10)+c,b=i(c,v),w=i(v+1,h);return p=n[v],g=t?t(p):p,new tr(g,p.node,tr.BLACK,b,w)}},a=function(c){let h=null,d=null,p=n.length;const g=function(b,w){const E=p-b,T=p;p-=b;const R=i(E+1,T),I=n[E],C=t?t(I):I;v(new tr(C,I.node,w,null,R))},v=function(b){h?(h.left=b,h=b):(d=b,h=b)};for(let b=0;b<c.count;++b){const w=c.nextBitIsOne(),E=Math.pow(2,c.count-(b+1));w?g(E,tr.BLACK):(g(E,tr.BLACK),g(E,tr.RED))}return d},o=new DQ(n.length),u=a(o);return new Qr(r||e,u)};let J_;const cc={};class No{static get Default(){return Ne(cc&&Dr,"ChildrenNode.ts has not been loaded"),J_=J_||new No({".priority":cc},{".priority":Dr}),J_}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=qc(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Qr?t:null}hasIndex(e){return qo(this.indexSet_,e.toString())}addIndex(e,t){Ne(e!==Bc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const a=t.getIterator(Ct.Wrap);let o=a.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=a.getNext();let u;i?u=Jg(r,e.getCompare()):u=cc;const c=e.toString(),h={...this.indexSet_};h[c]=e;const d={...this.indexes_};return d[c]=u,new No(d,h)}addToIndexes(e,t){const r=Bg(this.indexes_,(i,a)=>{const o=qc(this.indexSet_,a);if(Ne(o,"Missing index implementation for "+a),i===cc)if(o.isDefinedOn(e.node)){const u=[],c=t.getIterator(Ct.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&u.push(h),h=c.getNext();return u.push(e),Jg(u,o.getCompare())}else return cc;else{const u=t.get(e.name);let c=i;return u&&(c=c.remove(new Ct(e.name,u))),c.insert(e,e.node)}});return new No(r,this.indexSet_)}removeFromIndexes(e,t){const r=Bg(this.indexes_,i=>{if(i===cc)return i;{const a=t.get(e.name);return a?i.remove(new Ct(e.name,a)):i}});return new No(r,this.indexSet_)}}let Rf;class Mt{static get EMPTY_NODE(){return Rf||(Rf=new Mt(new Qr(lE),null,No.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&YO(this.priorityNode_),this.children_.isEmpty()&&Ne(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Rf}updatePriority(e){return this.children_.isEmpty()?this:new Mt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Rf:t}}getChild(e){const t=Tt(e);return t===null?this:this.getImmediateChild(t).getChild(Zt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Ne(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Ct(e,t);let i,a;t.isEmpty()?(i=this.children_.remove(e),a=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),a=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?Rf:this.priorityNode_;return new Mt(i,o,a)}}updateChild(e,t){const r=Tt(e);if(r===null)return t;{Ne(Tt(e)!==".priority"||Qs(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Zt(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,i=0,a=!0;if(this.forEachChild(Dr,(o,u)=>{t[o]=u.val(e),r++,a&&Mt.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1}),!e&&a&&i<2*r){const o=[];for(const u in t)o[u]=t[u];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+XO(this.getPriority().val())+":"),this.forEachChild(Dr,(t,r)=>{const i=r.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":bO(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const i=this.resolveIndex_(r);if(i){const a=i.getPredecessorKey(new Ct(e,t));return a?a.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ct(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ct(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ct.Wrap);let a=i.peek();for(;a!=null&&t.compare(a,e)<0;)i.getNext(),a=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ct.Wrap);let a=i.peek();for(;a!=null&&t.compare(a,e)>0;)i.getNext(),a=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===$d?-1:0}withIndex(e){if(e===Bc||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Mt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Bc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Dr),i=t.getIterator(Dr);let a=r.getNext(),o=i.getNext();for(;a&&o;){if(a.name!==o.name||!a.node.equals(o.node))return!1;a=r.getNext(),o=i.getNext()}return a===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Bc?null:this.indexMap_.get(e.toString())}}Mt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class kQ extends Mt{constructor(){super(new Qr(lE),Mt.EMPTY_NODE,No.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Mt.EMPTY_NODE}isEmpty(){return!1}}const $d=new kQ;Object.defineProperties(Ct,{MIN:{value:new Ct(eh,Mt.EMPTY_NODE)},MAX:{value:new Ct(rl,$d)}});KO.__EMPTY_NODE=Mt.EMPTY_NODE;Jn.__childrenNodeConstructor=Mt;SQ($d);RQ($d);const MQ=!0;function Sr(n,e=null){if(n===null)return Mt.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Ne(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Jn(t,Sr(e))}if(!(n instanceof Array)&&MQ){const t=[];let r=!1;if(zi(n,(o,u)=>{if(o.substring(0,1)!=="."){const c=Sr(u);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new Ct(o,c)))}}),t.length===0)return Mt.EMPTY_NODE;const a=Jg(t,CQ,o=>o.name,lE);if(r){const o=Jg(t,Dr.getCompare());return new Mt(a,Sr(e),new No({".priority":o},{".priority":Dr}))}else return new Mt(a,Sr(e),No.Default)}else{let t=Mt.EMPTY_NODE;return zi(n,(r,i)=>{if(qo(n,r)&&r.substring(0,1)!=="."){const a=Sr(i);(a.isLeafNode()||!a.isEmpty())&&(t=t.updateImmediateChild(r,a))}}),t.updatePriority(Sr(e))}}AQ(Sr);class OQ extends qv{constructor(e){super(),this.indexPath_=e,Ne(!wt(e)&&Tt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),i=this.extractChild(t.node),a=r.compareTo(i);return a===0?mh(e.name,t.name):a}makePost(e,t){const r=Sr(e),i=Mt.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ct(t,i)}maxPost(){const e=Mt.EMPTY_NODE.updateChild(this.indexPath_,$d);return new Ct(rl,e)}toString(){return GO(this.indexPath_,0).join("/")}}class PQ extends qv{compare(e,t){const r=e.node.compareTo(t.node);return r===0?mh(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ct.MIN}maxPost(){return Ct.MAX}makePost(e,t){const r=Sr(e);return new Ct(t,r)}toString(){return".value"}}const VQ=new PQ;function FQ(n){return{type:"value",snapshotNode:n}}function LQ(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function BQ(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function XI(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function jQ(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class cE{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Dr}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Ne(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Ne(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:eh}hasEnd(){return this.endSet_}getIndexEndValue(){return Ne(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Ne(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:rl}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Ne(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Dr}copy(){const e=new cE;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function YI(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Dr?t="$priority":n.index_===VQ?t="$value":n.index_===Bc?t="$key":(Ne(n.index_ instanceof OQ,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=mr(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=mr(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+mr(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=mr(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+mr(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function $I(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Dr&&(e.i=n.index_.toString()),e}class ev extends jO{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Ne(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Xd("p:rest:"),this.listens_={}}listen(e,t,r,i){const a=e._path.toString();this.log_("Listen called for "+a+" "+e._queryIdentifier);const o=ev.getListenId_(e,r),u={};this.listens_[o]=u;const c=YI(e._queryParams);this.restRequest_(a+".json",c,(h,d)=>{let p=d;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(a,p,!1,r),qc(this.listens_,o)===u){let g;h?h===401?g="permission_denied":g="rest_error:"+h:g="ok",i(g,null)}})}unlisten(e,t){const r=ev.getListenId_(e,t);delete this.listens_[r]}get(e){const t=YI(e._queryParams),r=e._path.toString(),i=new bw;return this.restRequest_(r+".json",t,(a,o)=>{let u=o;a===404&&(u=null,a=null),a===null?(this.onDataUpdate_(r,u,!1,null),i.resolve(u)):i.reject(new Error(u))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,a])=>{i&&i.accessToken&&(t.auth=i.accessToken),a&&a.token&&(t.ac=a.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zq(t);this.log_("Sending REST request for "+o);const u=new XMLHttpRequest;u.onreadystatechange=()=>{if(r&&u.readyState===4){this.log_("REST Response for "+o+" received. status:",u.status,"response:",u.responseText);let c=null;if(u.status>=200&&u.status<300){try{c=ud(u.responseText)}catch{yi("Failed to parse JSON response for "+o+": "+u.responseText)}r(null,c)}else u.status!==401&&u.status!==404&&yi("Got unsuccessful REST response for "+o+" Status: "+u.status),r(u.status);r=null}},u.open("GET",o,!0),u.send()})}}class UQ{constructor(){this.rootNode_=Mt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function tv(){return{value:null,children:new Map}}function ZO(n,e,t){if(wt(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Tt(e);n.children.has(r)||n.children.set(r,tv());const i=n.children.get(r);e=Zt(e),ZO(i,e,t)}}function C1(n,e,t){n.value!==null?t(e,n.value):zQ(n,(r,i)=>{const a=new en(e.toString()+"/"+r);C1(i,a,t)})}function zQ(n,e){n.children.forEach((t,r)=>{e(r,t)})}class GQ{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&zi(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}}const QI=10*1e3,HQ=30*1e3,WQ=300*1e3;class qQ{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new GQ(e);const r=QI+(HQ-QI)*Math.random();Kf(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;zi(e,(i,a)=>{a>0&&qo(this.statsToReport_,i)&&(t[i]=a,r=!0)}),r&&this.server_.reportStats(t),Kf(this.reportStats_.bind(this),Math.floor(Math.random()*2*WQ))}}var Ga;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ga||(Ga={}));function JO(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function eP(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function tP(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class nv{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Ga.ACK_USER_WRITE,this.source=JO()}operationForChild(e){if(wt(this.path)){if(this.affectedTree.value!=null)return Ne(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new en(e));return new nv(Ht(),t,this.revert)}}else return Ne(Tt(this.path)===e,"operationForChild called for unrelated child."),new nv(Zt(this.path),this.affectedTree,this.revert)}}class il{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Ga.OVERWRITE}operationForChild(e){return wt(this.path)?new il(this.source,Ht(),this.snap.getImmediateChild(e)):new il(this.source,Zt(this.path),this.snap)}}class Td{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Ga.MERGE}operationForChild(e){if(wt(this.path)){const t=this.children.subtree(new en(e));return t.isEmpty()?null:t.value?new il(this.source,Ht(),t.value):new Td(this.source,Ht(),t)}else return Ne(Tt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Td(this.source,Zt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class hE{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(wt(e))return this.isFullyInitialized()&&!this.filtered_;const t=Tt(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function KQ(n,e,t,r){const i=[],a=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&a.push(jQ(o.childName,o.snapshotNode))}),If(n,i,"child_removed",e,r,t),If(n,i,"child_added",e,r,t),If(n,i,"child_moved",a,r,t),If(n,i,"child_changed",e,r,t),If(n,i,"value",e,r,t),i}function If(n,e,t,r,i,a){const o=r.filter(u=>u.type===t);o.sort((u,c)=>YQ(n,u,c)),o.forEach(u=>{const c=XQ(n,u,a);i.forEach(h=>{h.respondsTo(u.type)&&e.push(h.createEvent(c,n.query_))})})}function XQ(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function YQ(n,e,t){if(e.childName==null||t.childName==null)throw sh("Should only compare child_ events.");const r=new Ct(e.childName,e.snapshotNode),i=new Ct(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function nP(n,e){return{eventCache:n,serverCache:e}}function Xf(n,e,t,r){return nP(new hE(e,t,r),n.serverCache)}function rP(n,e,t,r){return nP(n.eventCache,new hE(e,t,r))}function S1(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function al(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let eb;const $Q=()=>(eb||(eb=new Qr(V$)),eb);class Qt{static fromObject(e){let t=new Qt(null);return zi(e,(r,i)=>{t=t.set(new en(r),i)}),t}constructor(e,t=$Q()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ht(),value:this.value};if(wt(e))return null;{const r=Tt(e),i=this.children.get(r);if(i!==null){const a=i.findRootMostMatchingPathAndValue(Zt(e),t);return a!=null?{path:nr(new en(r),a.path),value:a.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(wt(e))return this;{const t=Tt(e),r=this.children.get(t);return r!==null?r.subtree(Zt(e)):new Qt(null)}}set(e,t){if(wt(e))return new Qt(t,this.children);{const r=Tt(e),a=(this.children.get(r)||new Qt(null)).set(Zt(e),t),o=this.children.insert(r,a);return new Qt(this.value,o)}}remove(e){if(wt(e))return this.children.isEmpty()?new Qt(null):new Qt(null,this.children);{const t=Tt(e),r=this.children.get(t);if(r){const i=r.remove(Zt(e));let a;return i.isEmpty()?a=this.children.remove(t):a=this.children.insert(t,i),this.value===null&&a.isEmpty()?new Qt(null):new Qt(this.value,a)}else return this}}get(e){if(wt(e))return this.value;{const t=Tt(e),r=this.children.get(t);return r?r.get(Zt(e)):null}}setTree(e,t){if(wt(e))return t;{const r=Tt(e),a=(this.children.get(r)||new Qt(null)).setTree(Zt(e),t);let o;return a.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,a),new Qt(this.value,o)}}fold(e){return this.fold_(Ht(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((i,a)=>{r[i]=a.fold_(nr(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ht(),t)}findOnPath_(e,t,r){const i=this.value?r(t,this.value):!1;if(i)return i;if(wt(e))return null;{const a=Tt(e),o=this.children.get(a);return o?o.findOnPath_(Zt(e),nr(t,a),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ht(),t)}foreachOnPath_(e,t,r){if(wt(e))return this;{this.value&&r(t,this.value);const i=Tt(e),a=this.children.get(i);return a?a.foreachOnPath_(Zt(e),nr(t,i),r):new Qt(null)}}foreach(e){this.foreach_(Ht(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(nr(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class la{constructor(e){this.writeTree_=e}static empty(){return new la(new Qt(null))}}function Yf(n,e,t){if(wt(e))return new la(new Qt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let a=r.value;const o=Bi(i,e);return a=a.updateChild(o,t),new la(n.writeTree_.set(i,a))}else{const i=new Qt(t),a=n.writeTree_.setTree(e,i);return new la(a)}}}function ZI(n,e,t){let r=n;return zi(t,(i,a)=>{r=Yf(r,nr(e,i),a)}),r}function JI(n,e){if(wt(e))return la.empty();{const t=n.writeTree_.setTree(e,new Qt(null));return new la(t)}}function A1(n,e){return dl(n,e)!=null}function dl(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Bi(t.path,e)):null}function eN(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Dr,(r,i)=>{e.push(new Ct(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new Ct(r,i.value))}),e}function js(n,e){if(wt(e))return n;{const t=dl(n,e);return t!=null?new la(new Qt(t)):new la(n.writeTree_.subtree(e))}}function R1(n){return n.writeTree_.isEmpty()}function th(n,e){return iP(Ht(),n.writeTree_,e)}function iP(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,a)=>{i===".priority"?(Ne(a.value!==null,"Priority writes must always be leaf nodes"),r=a.value):t=iP(nr(n,i),a,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(nr(n,".priority"),r)),t}}function aP(n,e){return cP(e,n)}function QQ(n,e,t,r,i){Ne(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Yf(n.visibleWrites,e,t)),n.lastWriteId=r}function ZQ(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function JQ(n,e){const t=n.allWrites.findIndex(u=>u.writeId===e);Ne(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,a=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const u=n.allWrites[o];u.visible&&(o>=t&&eZ(u,r.path)?i=!1:oa(r.path,u.path)&&(a=!0)),o--}if(i){if(a)return tZ(n),!0;if(r.snap)n.visibleWrites=JI(n.visibleWrites,r.path);else{const u=r.children;zi(u,c=>{n.visibleWrites=JI(n.visibleWrites,nr(r.path,c))})}return!0}else return!1}function eZ(n,e){if(n.snap)return oa(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&oa(nr(n.path,t),e))return!0;return!1}function tZ(n){n.visibleWrites=oP(n.allWrites,nZ,Ht()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function nZ(n){return n.visible}function oP(n,e,t){let r=la.empty();for(let i=0;i<n.length;++i){const a=n[i];if(e(a)){const o=a.path;let u;if(a.snap)oa(t,o)?(u=Bi(t,o),r=Yf(r,u,a.snap)):oa(o,t)&&(u=Bi(o,t),r=Yf(r,Ht(),a.snap.getChild(u)));else if(a.children){if(oa(t,o))u=Bi(t,o),r=ZI(r,u,a.children);else if(oa(o,t))if(u=Bi(o,t),wt(u))r=ZI(r,Ht(),a.children);else{const c=qc(a.children,Tt(u));if(c){const h=c.getChild(Zt(u));r=Yf(r,Ht(),h)}}}else throw sh("WriteRecord should have .snap or .children")}}return r}function sP(n,e,t,r,i){if(!r&&!i){const a=dl(n.visibleWrites,e);if(a!=null)return a;{const o=js(n.visibleWrites,e);if(R1(o))return t;if(t==null&&!A1(o,Ht()))return null;{const u=t||Mt.EMPTY_NODE;return th(o,u)}}}else{const a=js(n.visibleWrites,e);if(!i&&R1(a))return t;if(!i&&t==null&&!A1(a,Ht()))return null;{const o=function(h){return(h.visible||i)&&(!r||!~r.indexOf(h.writeId))&&(oa(h.path,e)||oa(e,h.path))},u=oP(n.allWrites,o,e),c=t||Mt.EMPTY_NODE;return th(u,c)}}}function rZ(n,e,t){let r=Mt.EMPTY_NODE;const i=dl(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Dr,(a,o)=>{r=r.updateImmediateChild(a,o)}),r;if(t){const a=js(n.visibleWrites,e);return t.forEachChild(Dr,(o,u)=>{const c=th(js(a,new en(o)),u);r=r.updateImmediateChild(o,c)}),eN(a).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const a=js(n.visibleWrites,e);return eN(a).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function iZ(n,e,t,r,i){Ne(r||i,"Either existingEventSnap or existingServerSnap must exist");const a=nr(e,t);if(A1(n.visibleWrites,a))return null;{const o=js(n.visibleWrites,a);return R1(o)?i.getChild(t):th(o,i.getChild(t))}}function aZ(n,e,t,r){const i=nr(e,t),a=dl(n.visibleWrites,i);if(a!=null)return a;if(r.isCompleteForChild(t)){const o=js(n.visibleWrites,i);return th(o,r.getNode().getImmediateChild(t))}else return null}function oZ(n,e){return dl(n.visibleWrites,e)}function sZ(n,e,t,r,i,a,o){let u;const c=js(n.visibleWrites,e),h=dl(c,Ht());if(h!=null)u=h;else if(t!=null)u=th(c,t);else return[];if(u=u.withIndex(o),!u.isEmpty()&&!u.isLeafNode()){const d=[],p=o.getCompare(),g=a?u.getReverseIteratorFrom(r,o):u.getIteratorFrom(r,o);let v=g.getNext();for(;v&&d.length<i;)p(v,r)!==0&&d.push(v),v=g.getNext();return d}else return[]}function uZ(){return{visibleWrites:la.empty(),allWrites:[],lastWriteId:-1}}function I1(n,e,t,r){return sP(n.writeTree,n.treePath,e,t,r)}function uP(n,e){return rZ(n.writeTree,n.treePath,e)}function tN(n,e,t,r){return iZ(n.writeTree,n.treePath,e,t,r)}function rv(n,e){return oZ(n.writeTree,nr(n.treePath,e))}function lZ(n,e,t,r,i,a){return sZ(n.writeTree,n.treePath,e,t,r,i,a)}function fE(n,e,t){return aZ(n.writeTree,n.treePath,e,t)}function lP(n,e){return cP(nr(n.treePath,e),n.writeTree)}function cP(n,e){return{treePath:n,writeTree:e}}class cZ{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;Ne(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Ne(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const a=i.type;if(t==="child_added"&&a==="child_removed")this.changeMap.set(r,XI(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&a==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&a==="child_changed")this.changeMap.set(r,BQ(r,i.oldSnap));else if(t==="child_changed"&&a==="child_added")this.changeMap.set(r,LQ(r,e.snapshotNode));else if(t==="child_changed"&&a==="child_changed")this.changeMap.set(r,XI(r,e.snapshotNode,i.oldSnap));else throw sh("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class hZ{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const hP=new hZ;class dE{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new hE(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fE(this.writes_,e,r)}}getChildAfterChild(e,t,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:al(this.viewCache_),a=lZ(this.writes_,i,t,1,r,e);return a.length===0?null:a[0]}}function fZ(n,e){Ne(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Ne(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function dZ(n,e,t,r,i){const a=new cZ;let o,u;if(t.type===Ga.OVERWRITE){const h=t;h.source.fromUser?o=N1(n,e,h.path,h.snap,r,i,a):(Ne(h.source.fromServer,"Unknown source."),u=h.source.tagged||e.serverCache.isFiltered()&&!wt(h.path),o=iv(n,e,h.path,h.snap,r,i,u,a))}else if(t.type===Ga.MERGE){const h=t;h.source.fromUser?o=mZ(n,e,h.path,h.children,r,i,a):(Ne(h.source.fromServer,"Unknown source."),u=h.source.tagged||e.serverCache.isFiltered(),o=D1(n,e,h.path,h.children,r,i,u,a))}else if(t.type===Ga.ACK_USER_WRITE){const h=t;h.revert?o=yZ(n,e,h.path,r,i,a):o=gZ(n,e,h.path,h.affectedTree,r,i,a)}else if(t.type===Ga.LISTEN_COMPLETE)o=vZ(n,e,t.path,r,a);else throw sh("Unknown operation type: "+t.type);const c=a.getChanges();return pZ(e,o,c),{viewCache:o,changes:c}}function pZ(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=S1(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&t.push(FQ(S1(e)))}}function fP(n,e,t,r,i,a){const o=e.eventCache;if(rv(r,t)!=null)return e;{let u,c;if(wt(t))if(Ne(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=al(e),d=h instanceof Mt?h:Mt.EMPTY_NODE,p=uP(r,d);u=n.filter.updateFullNode(e.eventCache.getNode(),p,a)}else{const h=I1(r,al(e));u=n.filter.updateFullNode(e.eventCache.getNode(),h,a)}else{const h=Tt(t);if(h===".priority"){Ne(Qs(t)===1,"Can't have a priority with additional path components");const d=o.getNode();c=e.serverCache.getNode();const p=tN(r,t,d,c);p!=null?u=n.filter.updatePriority(d,p):u=o.getNode()}else{const d=Zt(t);let p;if(o.isCompleteForChild(h)){c=e.serverCache.getNode();const g=tN(r,t,o.getNode(),c);g!=null?p=o.getNode().getImmediateChild(h).updateChild(d,g):p=o.getNode().getImmediateChild(h)}else p=fE(r,h,e.serverCache);p!=null?u=n.filter.updateChild(o.getNode(),h,p,d,i,a):u=o.getNode()}}return Xf(e,u,o.isFullyInitialized()||wt(t),n.filter.filtersNodes())}}function iv(n,e,t,r,i,a,o,u){const c=e.serverCache;let h;const d=o?n.filter:n.filter.getIndexedFilter();if(wt(t))h=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){const v=c.getNode().updateChild(t,r);h=d.updateFullNode(c.getNode(),v,null)}else{const v=Tt(t);if(!c.isCompleteForPath(t)&&Qs(t)>1)return e;const b=Zt(t),E=c.getNode().getImmediateChild(v).updateChild(b,r);v===".priority"?h=d.updatePriority(c.getNode(),E):h=d.updateChild(c.getNode(),v,E,b,hP,null)}const p=rP(e,h,c.isFullyInitialized()||wt(t),d.filtersNodes()),g=new dE(i,p,a);return fP(n,p,t,i,g,u)}function N1(n,e,t,r,i,a,o){const u=e.eventCache;let c,h;const d=new dE(i,e,a);if(wt(t))h=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Xf(e,h,!0,n.filter.filtersNodes());else{const p=Tt(t);if(p===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),r),c=Xf(e,h,u.isFullyInitialized(),u.isFiltered());else{const g=Zt(t),v=u.getNode().getImmediateChild(p);let b;if(wt(g))b=r;else{const w=d.getCompleteChild(p);w!=null?zO(g)===".priority"&&w.getChild(HO(g)).isEmpty()?b=w:b=w.updateChild(g,r):b=Mt.EMPTY_NODE}if(v.equals(b))c=e;else{const w=n.filter.updateChild(u.getNode(),p,b,g,d,o);c=Xf(e,w,u.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function nN(n,e){return n.eventCache.isCompleteForChild(e)}function mZ(n,e,t,r,i,a,o){let u=e;return r.foreach((c,h)=>{const d=nr(t,c);nN(e,Tt(d))&&(u=N1(n,u,d,h,i,a,o))}),r.foreach((c,h)=>{const d=nr(t,c);nN(e,Tt(d))||(u=N1(n,u,d,h,i,a,o))}),u}function rN(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function D1(n,e,t,r,i,a,o,u){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;wt(t)?h=r:h=new Qt(null).setTree(t,r);const d=e.serverCache.getNode();return h.children.inorderTraversal((p,g)=>{if(d.hasChild(p)){const v=e.serverCache.getNode().getImmediateChild(p),b=rN(n,v,g);c=iv(n,c,new en(p),b,i,a,o,u)}}),h.children.inorderTraversal((p,g)=>{const v=!e.serverCache.isCompleteForChild(p)&&g.value===null;if(!d.hasChild(p)&&!v){const b=e.serverCache.getNode().getImmediateChild(p),w=rN(n,b,g);c=iv(n,c,new en(p),w,i,a,o,u)}}),c}function gZ(n,e,t,r,i,a,o){if(rv(i,t)!=null)return e;const u=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(wt(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return iv(n,e,t,c.getNode().getChild(t),i,a,u,o);if(wt(t)){let h=new Qt(null);return c.getNode().forEachChild(Bc,(d,p)=>{h=h.set(new en(d),p)}),D1(n,e,t,h,i,a,u,o)}else return e}else{let h=new Qt(null);return r.foreach((d,p)=>{const g=nr(t,d);c.isCompleteForPath(g)&&(h=h.set(d,c.getNode().getChild(g)))}),D1(n,e,t,h,i,a,u,o)}}function vZ(n,e,t,r,i){const a=e.serverCache,o=rP(e,a.getNode(),a.isFullyInitialized()||wt(t),a.isFiltered());return fP(n,o,t,r,hP,i)}function yZ(n,e,t,r,i,a){let o;if(rv(r,t)!=null)return e;{const u=new dE(r,e,i),c=e.eventCache.getNode();let h;if(wt(t)||Tt(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=I1(r,al(e));else{const p=e.serverCache.getNode();Ne(p instanceof Mt,"serverChildren would be complete if leaf node"),d=uP(r,p)}d=d,h=n.filter.updateFullNode(c,d,a)}else{const d=Tt(t);let p=fE(r,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?h=n.filter.updateChild(c,d,p,Zt(t),u,a):e.eventCache.getNode().hasChild(d)?h=n.filter.updateChild(c,d,Mt.EMPTY_NODE,Zt(t),u,a):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=I1(r,al(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,a)))}return o=e.serverCache.isFullyInitialized()||rv(r,Ht())!=null,Xf(e,h,o,n.filter.filtersNodes())}}function _Z(n,e){const t=al(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!wt(e)&&!t.getImmediateChild(Tt(e)).isEmpty())?t.getChild(e):null}function iN(n,e,t,r){e.type===Ga.MERGE&&e.source.queryId!==null&&(Ne(al(n.viewCache_),"We should always have a full cache before handling merges"),Ne(S1(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,a=dZ(n.processor_,i,e,t,r);return fZ(n.processor_,a.viewCache),Ne(a.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=a.viewCache,bZ(n,a.changes,a.viewCache.eventCache.getNode())}function bZ(n,e,t,r){const i=n.eventRegistrations_;return KQ(n.eventGenerator_,e,t,i)}let aN;function xZ(n){Ne(!aN,"__referenceConstructor has already been defined"),aN=n}function pE(n,e,t,r){const i=e.source.queryId;if(i!==null){const a=n.views.get(i);return Ne(a!=null,"SyncTree gave us an op for an invalid query."),iN(a,e,t,r)}else{let a=[];for(const o of n.views.values())a=a.concat(iN(o,e,t,r));return a}}function mE(n,e){let t=null;for(const r of n.views.values())t=t||_Z(r,e);return t}let oN;function wZ(n){Ne(!oN,"__referenceConstructor has already been defined"),oN=n}class sN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Qt(null),this.pendingWriteTree_=uZ(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function EZ(n,e,t,r,i){return QQ(n.pendingWriteTree_,e,t,r,i),i?Xv(n,new il(JO(),e,t)):[]}function Cc(n,e,t=!1){const r=ZQ(n.pendingWriteTree_,e);if(JQ(n.pendingWriteTree_,e)){let a=new Qt(null);return r.snap!=null?a=a.set(Ht(),!0):zi(r.children,o=>{a=a.set(new en(o),!0)}),Xv(n,new nv(r.path,a,t))}else return[]}function Kv(n,e,t){return Xv(n,new il(eP(),e,t))}function TZ(n,e,t){const r=Qt.fromObject(t);return Xv(n,new Td(eP(),e,r))}function CZ(n,e,t,r){const i=gP(n,r);if(i!=null){const a=vP(i),o=a.path,u=a.queryId,c=Bi(o,e),h=new il(tP(u),c,t);return yP(n,o,h)}else return[]}function SZ(n,e,t,r){const i=gP(n,r);if(i){const a=vP(i),o=a.path,u=a.queryId,c=Bi(o,e),h=Qt.fromObject(t),d=new Td(tP(u),c,h);return yP(n,o,d)}else return[]}function dP(n,e,t){const i=n.pendingWriteTree_,a=n.syncPointTree_.findOnPath(e,(o,u)=>{const c=Bi(o,e),h=mE(u,c);if(h)return h});return sP(i,e,a,t,!0)}function Xv(n,e){return pP(e,n.syncPointTree_,null,aP(n.pendingWriteTree_,Ht()))}function pP(n,e,t,r){if(wt(n.path))return mP(n,e,t,r);{const i=e.get(Ht());t==null&&i!=null&&(t=mE(i,Ht()));let a=[];const o=Tt(n.path),u=n.operationForChild(o),c=e.children.get(o);if(c&&u){const h=t?t.getImmediateChild(o):null,d=lP(r,o);a=a.concat(pP(u,c,h,d))}return i&&(a=a.concat(pE(i,n,r,t))),a}}function mP(n,e,t,r){const i=e.get(Ht());t==null&&i!=null&&(t=mE(i,Ht()));let a=[];return e.children.inorderTraversal((o,u)=>{const c=t?t.getImmediateChild(o):null,h=lP(r,o),d=n.operationForChild(o);d&&(a=a.concat(mP(d,u,c,h)))}),i&&(a=a.concat(pE(i,n,r,t))),a}function gP(n,e){return n.tagToQueryMap.get(e)}function vP(n){const e=n.indexOf("$");return Ne(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new en(n.substr(0,e))}}function yP(n,e,t){const r=n.syncPointTree_.get(e);Ne(r,"Missing sync point for query tag that we're tracking");const i=aP(n.pendingWriteTree_,e);return pE(r,t,i,null)}class gE{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new gE(t)}node(){return this.node_}}class vE{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=nr(this.path_,e);return new vE(this.syncTree_,t)}node(){return dP(this.syncTree_,this.path_)}}const AZ=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},uN=function(n,e,t){if(!n||typeof n!="object")return n;if(Ne(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return RZ(n[".sv"],e,t);if(typeof n[".sv"]=="object")return IZ(n[".sv"],e);Ne(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},RZ=function(n,e,t){if(n==="timestamp")return t.timestamp;Ne(!1,"Unexpected server value: "+n)},IZ=function(n,e,t){n.hasOwnProperty("increment")||Ne(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&Ne(!1,"Unexpected increment value: "+r);const i=e.node();if(Ne(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return typeof o!="number"?r:o+r},NZ=function(n,e,t,r){return yE(e,new vE(t,n),r)},DZ=function(n,e,t){return yE(n,new gE(e),t)};function yE(n,e,t){const r=n.getPriority().val(),i=uN(r,e.getImmediateChild(".priority"),t);let a;if(n.isLeafNode()){const o=n,u=uN(o.getValue(),e,t);return u!==o.getValue()||i!==o.getPriority().val()?new Jn(u,Sr(i)):n}else{const o=n;return a=o,i!==o.getPriority().val()&&(a=a.updatePriority(new Jn(i))),o.forEachChild(Dr,(u,c)=>{const h=yE(c,e.getImmediateChild(u),t);h!==c&&(a=a.updateImmediateChild(u,h))}),a}}class _E{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function bE(n,e){let t=e instanceof en?e:new en(e),r=n,i=Tt(t);for(;i!==null;){const a=qc(r.node.children,i)||{children:{},childCount:0};r=new _E(i,r,a),t=Zt(t),i=Tt(t)}return r}function gh(n){return n.node.value}function _P(n,e){n.node.value=e,k1(n)}function bP(n){return n.node.childCount>0}function kZ(n){return gh(n)===void 0&&!bP(n)}function Yv(n,e){zi(n.node.children,(t,r)=>{e(new _E(t,n,r))})}function xP(n,e,t,r){t&&e(n),Yv(n,i=>{xP(i,e,!0)})}function MZ(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Qd(n){return new en(n.parent===null?n.name:Qd(n.parent)+"/"+n.name)}function k1(n){n.parent!==null&&OZ(n.parent,n.name,n)}function OZ(n,e,t){const r=kZ(t),i=qo(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,k1(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,k1(n))}const PZ=/[\[\].#$\/\u0000-\u001F\u007F]/,VZ=/[\[\].#$\u0000-\u001F\u007F]/,tb=10*1024*1024,wP=function(n){return typeof n=="string"&&n.length!==0&&!PZ.test(n)},FZ=function(n){return typeof n=="string"&&n.length!==0&&!VZ.test(n)},LZ=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),FZ(n)},EP=function(n,e,t){const r=t instanceof en?new vQ(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Uu(r));if(typeof e=="function")throw new Error(n+"contains a function "+Uu(r)+" with contents = "+e.toString());if(xO(e))throw new Error(n+"contains "+e.toString()+" "+Uu(r));if(typeof e=="string"&&e.length>tb/3&&Sv(e)>tb)throw new Error(n+"contains a string greater than "+tb+" utf8 bytes "+Uu(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,a=!1;if(zi(e,(o,u)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(a=!0,!wP(o)))throw new Error(n+" contains an invalid key ("+o+") "+Uu(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);yQ(r,o),EP(n,u,r),_Q(r)}),i&&a)throw new Error(n+' contains ".value" child '+Uu(r)+" in addition to actual children.")}},BZ=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!wP(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!LZ(t))throw new Error(e7(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class jZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function UZ(n,e){let t=null;for(let r=0;r<e.length;r++){const i=e[r],a=i.getPath();t!==null&&!WO(a,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:a}),t.events.push(i)}t&&n.eventLists_.push(t)}function pl(n,e,t){UZ(n,t),zZ(n,r=>oa(r,e)||oa(e,r))}function zZ(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const i=n.eventLists_[r];if(i){const a=i.path;e(a)?(GZ(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function GZ(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();qf&&Cr("event: "+t.toString()),Yd(r)}}}const HZ="repo_interrupt",WZ=25;class qZ{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new jZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=tv(),this.transactionQueueTree_=new _E,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function KZ(n,e,t){if(n.stats_=oE(n.repoInfo_),n.forceRestClient_||z$())n.server_=new ev(n.repoInfo_,(r,i,a,o)=>{lN(n,r,i,a,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>cN(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{mr(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new ko(n.repoInfo_,e,(r,i,a,o)=>{lN(n,r,i,a,o)},r=>{cN(n,r)},r=>{YZ(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=K$(n.repoInfo_,()=>new qQ(n.stats_,n.server_)),n.infoData_=new UQ,n.infoSyncTree_=new sN({startListening:(r,i,a,o)=>{let u=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(u=Kv(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),u},stopListening:()=>{}}),xE(n,"connected",!1),n.serverSyncTree_=new sN({startListening:(r,i,a,o)=>(n.server_.listen(r,a,i,(u,c)=>{const h=o(u,c);pl(n.eventQueue_,r._path,h)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function XZ(n){const t=n.infoData_.getNode(new en(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function TP(n){return AZ({timestamp:XZ(n)})}function lN(n,e,t,r,i){n.dataUpdateCount++;const a=new en(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){const c=Bg(t,h=>Sr(h));o=SZ(n.serverSyncTree_,a,c,i)}else{const c=Sr(t);o=CZ(n.serverSyncTree_,a,c,i)}else if(r){const c=Bg(t,h=>Sr(h));o=TZ(n.serverSyncTree_,a,c)}else{const c=Sr(t);o=Kv(n.serverSyncTree_,a,c)}let u=a;o.length>0&&(u=EE(n,a)),pl(n.eventQueue_,u,o)}function cN(n,e){xE(n,"connected",e),e===!1&&QZ(n)}function YZ(n,e){zi(e,(t,r)=>{xE(n,t,r)})}function xE(n,e,t){const r=new en("/.info/"+e),i=Sr(t);n.infoData_.updateSnapshot(r,i);const a=Kv(n.infoSyncTree_,r,i);pl(n.eventQueue_,r,a)}function $Z(n){return n.nextWriteId_++}function QZ(n){CP(n,"onDisconnectEvents");const e=TP(n),t=tv();C1(n.onDisconnect_,Ht(),(i,a)=>{const o=NZ(i,a,n.serverSyncTree_,e);ZO(t,i,o)});let r=[];C1(t,Ht(),(i,a)=>{r=r.concat(Kv(n.serverSyncTree_,i,a));const o=tJ(n,i);EE(n,o)}),n.onDisconnect_=tv(),pl(n.eventQueue_,Ht(),r)}function ZZ(n){n.persistentConnection_&&n.persistentConnection_.interrupt(HZ)}function CP(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Cr(t,...e)}function SP(n,e,t){return dP(n.serverSyncTree_,e,t)||Mt.EMPTY_NODE}function wE(n,e=n.transactionQueueTree_){if(e||$v(n,e),gh(e)){const t=RP(n,e);Ne(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&JZ(n,Qd(e),t)}else bP(e)&&Yv(e,t=>{wE(n,t)})}function JZ(n,e,t){const r=t.map(h=>h.currentWriteId),i=SP(n,e,r);let a=i;const o=i.hash();for(let h=0;h<t.length;h++){const d=t[h];Ne(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const p=Bi(e,d.path);a=a.updateChild(p,d.currentOutputSnapshotRaw)}const u=a.val(!0),c=e;n.server_.put(c.toString(),u,h=>{CP(n,"transaction put response",{path:c.toString(),status:h});let d=[];if(h==="ok"){const p=[];for(let g=0;g<t.length;g++)t[g].status=2,d=d.concat(Cc(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&p.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();$v(n,bE(n.transactionQueueTree_,e)),wE(n,n.transactionQueueTree_),pl(n.eventQueue_,e,d);for(let g=0;g<p.length;g++)Yd(p[g])}else{if(h==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{yi("transaction at "+c.toString()+" failed: "+h);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=h}EE(n,e)}},o)}function EE(n,e){const t=AP(n,e),r=Qd(t),i=RP(n,t);return eJ(n,i,r),r}function eJ(n,e,t){if(e.length===0)return;const r=[];let i=[];const o=e.filter(u=>u.status===0).map(u=>u.currentWriteId);for(let u=0;u<e.length;u++){const c=e[u],h=Bi(t,c.path);let d=!1,p;if(Ne(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,i=i.concat(Cc(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=WZ)d=!0,p="maxretry",i=i.concat(Cc(n.serverSyncTree_,c.currentWriteId,!0));else{const g=SP(n,c.path,o);c.currentInputSnapshot=g;const v=e[u].update(g.val());if(v!==void 0){EP("transaction failed: Data returned ",v,c.path);let b=Sr(v);typeof v=="object"&&v!=null&&qo(v,".priority")||(b=b.updatePriority(g.getPriority()));const E=c.currentWriteId,T=TP(n),R=DZ(b,g,T);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=R,c.currentWriteId=$Z(n),o.splice(o.indexOf(E),1),i=i.concat(EZ(n.serverSyncTree_,c.path,R,c.currentWriteId,c.applyLocally)),i=i.concat(Cc(n.serverSyncTree_,E,!0))}else d=!0,p="nodata",i=i.concat(Cc(n.serverSyncTree_,c.currentWriteId,!0))}pl(n.eventQueue_,t,i),i=[],d&&(e[u].status=2,(function(g){setTimeout(g,Math.floor(0))})(e[u].unwatcher),e[u].onComplete&&(p==="nodata"?r.push(()=>e[u].onComplete(null,!1,e[u].currentInputSnapshot)):r.push(()=>e[u].onComplete(new Error(p),!1,null))))}$v(n,n.transactionQueueTree_);for(let u=0;u<r.length;u++)Yd(r[u]);wE(n,n.transactionQueueTree_)}function AP(n,e){let t,r=n.transactionQueueTree_;for(t=Tt(e);t!==null&&gh(r)===void 0;)r=bE(r,t),e=Zt(e),t=Tt(e);return r}function RP(n,e){const t=[];return IP(n,e,t),t.sort((r,i)=>r.order-i.order),t}function IP(n,e,t){const r=gh(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Yv(e,i=>{IP(n,i,t)})}function $v(n,e){const t=gh(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,_P(e,t.length>0?t:void 0)}Yv(e,r=>{$v(n,r)})}function tJ(n,e){const t=Qd(AP(n,e)),r=bE(n.transactionQueueTree_,e);return MZ(r,i=>{nb(n,i)}),nb(n,r),xP(r,i=>{nb(n,i)}),t}function nb(n,e){const t=gh(e);if(t){const r=[];let i=[],a=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Ne(a===o-1,"All SENT items should be at beginning of queue."),a=o,t[o].status=3,t[o].abortReason="set"):(Ne(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Cc(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));a===-1?_P(e,void 0):t.length=a+1,pl(n.eventQueue_,Qd(e),i);for(let o=0;o<r.length;o++)Yd(r[o])}}function nJ(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function rJ(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):yi(`Invalid query segment '${t}' in query '${n}'`)}return e}const hN=function(n,e){const t=iJ(n),r=t.namespace;t.domain==="firebase.com"&&Bo(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Bo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||O$();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new MO(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new en(t.pathString)}},iJ=function(n){let e="",t="",r="",i="",a="",o=!0,u="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(u=n.substring(0,h-1),n=n.substring(h+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(i=nJ(n.substring(d,p)));const g=rJ(n.substring(Math.min(n.length,p)));h=e.indexOf(":"),h>=0?(o=u==="https"||u==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const v=e.slice(0,h);if(v.toLowerCase()==="localhost")t="localhost";else if(v.split(".").length<=2)t=v;else{const b=e.indexOf(".");r=e.substring(0,b).toLowerCase(),t=e.substring(b+1),a=r}"ns"in g&&(a=g.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:u,pathString:i,namespace:a}};class TE{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return wt(this._path)?null:zO(this._path)}get ref(){return new vh(this._repo,this._path)}get _queryIdentifier(){const e=$I(this._queryParams),t=iE(e);return t==="{}"?"default":t}get _queryObject(){return $I(this._queryParams)}isEqual(e){if(e=ca(e),!(e instanceof TE))return!1;const t=this._repo===e._repo,r=WO(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+gQ(this._path)}}class vh extends TE{constructor(e,t){super(e,t,new cE,!1)}get parent(){const e=HO(this._path);return e===null?null:new vh(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}xZ(vh);wZ(vh);const aJ="FIREBASE_DATABASE_EMULATOR_HOST",M1={};let oJ=!1;function sJ(n,e,t,r){const i=e.lastIndexOf(":"),a=e.substring(0,i),o=Bd(a);n.repoInfo_=new MO(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function uJ(n,e,t,r,i){let a=r||n.options.databaseURL;a===void 0&&(n.options.projectId||Bo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Cr("Using default host for project ",n.options.projectId),a=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=hN(a,i),u=o.repoInfo,c;typeof process<"u"&&DI&&(c=DI[aJ]),c?(a=`http://${c}?ns=${u.namespace}`,o=hN(a,i),u=o.repoInfo):o.repoInfo.secure;const h=new H$(n.name,n.options,e);BZ("Invalid Firebase Database URL",o),wt(o.path)||Bo("Database URL must point to the root of a Firebase Database (not including a child path).");const d=cJ(u,n,h,new G$(n,t));return new hJ(d,n)}function lJ(n,e){const t=M1[e];(!t||t[n.key]!==n)&&Bo(`Database ${e}(${n.repoInfo_}) has already been deleted.`),ZZ(n),delete t[n.key]}function cJ(n,e,t,r){let i=M1[e.name];i||(i={},M1[e.name]=i);let a=i[n.toURLString()];return a&&Bo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new qZ(n,oJ,t,r),i[n.toURLString()]=a,a}class hJ{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(KZ(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new vh(this._repo,Ht())),this._rootInternal}_delete(){return this._rootInternal!==null&&(lJ(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Bo("Cannot call "+e+" on a deleted database.")}}function fJ(n=O3(),e){const t=N3(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=_3("database");r&&dJ(t,...r)}return t}function dJ(n,e,t,r={}){n=ca(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,a=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&ld(r,a.repoInfo_.emulatorOptions))return;Bo("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(a.repoInfo_.nodeAdmin)r.mockUserToken&&Bo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new sg(sg.OWNER);else if(r.mockUserToken){const u=typeof r.mockUserToken=="string"?r.mockUserToken:w3(r.mockUserToken,n.app.options.projectId);o=new sg(u)}Bd(e)&&(x3(e),E3("Database",!0)),sJ(a,i,r,o)}function pJ(n){R$(k3),cd(new Kc("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return uJ(r,i,a,t)},"PUBLIC").setMultipleInstances(!0)),Ps(kI,MI,n),Ps(kI,MI,"esm2020")}ko.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};ko.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};pJ();const CE=vw.projectId!=="YOUR_PROJECT_ID";let rb,kt,mJ;if(CE)try{rb=M3(vw),kt=f$(rb),mJ=fJ(rb),console.log(" Firebase initialized successfully")}catch(n){console.warn(" Firebase initialization failed:",n.message)}const NP=async(n,e,t)=>{if(!(!CE||!kt))try{await au(vi(kt,"heatmap"),{x:n,y:e,page:t,timestamp:gO()})}catch(r){console.error("Error recording heatmap:",r)}},DP=async n=>{if(!(!CE||!kt))try{await au(vi(kt,"sessions"),{...n,timestamp:gO()})}catch(e){console.error("Error saving session:",e)}},gJ=vw.projectId!=="YOUR_PROJECT_ID",SE=async(n,e=null)=>{if(!gJ||!kt)return e;try{return await n()}catch(t){return console.error("Firebase operation error:",t),e}},vJ=async(n,e,t="unknown")=>SE(async()=>{const r=vi(kt,"heatmap");await au(r,{x:n,y:e,page:t,timestamp:new Date}),console.log(` Logged heatmap click at (${n}, ${e})`)}),av=async(n,e,t={})=>SE(async()=>{await au(vi(kt,"conversion_funnel"),{step:n,sessionId:e,timestamp:new Date,...t}),console.log(` Logged conversion step: ${n}`)}),yJ=async(n,e,t)=>SE(async()=>{await au(vi(kt,"page_transitions"),{sessionId:n,from:e,to:t,timestamp:new Date}),console.log(` Logged page transition: ${e}  ${t}`)});class _J{constructor(){this.isEnabled=lc.enabled,this.currentLanguage=lc.defaultLanguage,this.isSpeaking=!1,this.initialized=!1,this.userInteracted=!1}init(){return typeof responsiveVoice>"u"?(console.warn(" ResponsiveVoice not loaded"),this.isEnabled=!1,!1):(responsiveVoice.clickEvent=!1,responsiveVoice.enableEstimationTimeout=!1,responsiveVoice.enableWindowClickHook=!1,responsiveVoice.isPlaying()&&responsiveVoice.cancel(),this.initialized=!0,console.log(" VoiceService ready (silent mode - waiting for user interaction)"),this.setupInteractionListener(),!0)}setupInteractionListener(){const e=()=>{this.userInteracted||(this.userInteracted=!0,typeof responsiveVoice<"u"&&(typeof responsiveVoice.init=="function"&&responsiveVoice.init(),responsiveVoice.speak(" ","Thai Female",{volume:0,onend:()=>{console.log(" Audio context unlocked - Voice feedback NOW enabled")}})),console.log(" ResponsiveVoice initialized after user interaction"),document.removeEventListener("click",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e))};document.addEventListener("click",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("keydown",e,{once:!0})}detectLanguage(e){return/[\u0E00-\u0E7F]/.test(e)?"th":/[\u4E00-\u9FFF]/.test(e)?"zh":"en"}getVoiceSettings(e){switch(e){case"th":return lc.thai;case"en":return lc.english;case"zh":return lc.chinese;default:return lc.thai}}async speakInChunks(e,t=null){const i=[];if(console.log(`  ${e.length}  - `),/[\u0E00-\u0E7F]/.test(e)){const a=e.split(/([,;.!?]\s*|\s+)/);let o="";for(const u of a)(o+u).length>100&&o.trim()?(i.push(o.trim()),console.log(`   : "${o.substring(0,40)}..." (${o.length} )`),o=u):o+=u;o.trim()&&(i.push(o.trim()),console.log(`   : "${o.substring(0,40)}..." (${o.length} )`))}else{const a=e.match(/[^.!?]+[.!?]+/g)||[e];let o="";for(const u of a)(o+u).length>100&&o?(i.push(o.trim()),console.log(`   Chunk: "${o.substring(0,40)}..."`),o=u):o+=u;o.trim()&&(i.push(o.trim()),console.log(`   Chunk: "${o.substring(0,40)}..."`))}console.log(`  ${i.length} `);for(let a=0;a<i.length;a++){console.log(`  ${a+1}/${i.length}`),typeof window<"u"&&window.resetIdleTimer&&window.resetIdleTimer();try{await this.speakSingle(i[a],t),console.log(`  ${a+1} `)}catch(o){console.error(` Error  ${a+1}:`,o)}a<i.length-1&&(console.log("  500ms ..."),await new Promise(o=>setTimeout(o,500)))}console.log(`  ${i.length} `)}speakSingle(e,t=null){return new Promise((r,i)=>{const a=t||this.detectLanguage(e),o=this.getVoiceSettings(a);console.log(`   Speaking: "${e.substring(0,50)}..."`);try{responsiveVoice.speak(e,o.voice,{pitch:o.pitch,rate:o.rate,volume:o.volume,onstart:()=>{console.log("   ")},onend:()=>{console.log("   "),r()},onerror:u=>{console.error("   Speech error:",u),r()}})}catch(u){console.error("   ResponsiveVoice error:",u),r()}setTimeout(()=>{console.warn("   Speech timeout for chunk"),r()},15e3)})}speak(e,t=null){if(!this.isEnabled||!this.initialized||!e||typeof e!="string"||e.trim()===""||!this.userInteracted)return Promise.resolve();console.log("  ()"),this.stop(),typeof window<"u"&&window.resetIdleTimer&&(window.resetIdleTimer(),console.log(" Reset idle timer"));const r=100;return console.log(` : "${e.substring(0,60)}..." (${e.length} )`),e.length>r?(console.log(`  (>${r}) - `),this.speakInChunks(e,t)):new Promise(i=>{const a=t||this.detectLanguage(e),o=this.getVoiceSettings(a);this.stop(),console.log(`Speaking in ${a}:`,e),console.log("Voice settings:",o),this.isSpeaking=!0;try{responsiveVoice.speak(e,o.voice,{pitch:o.pitch,rate:o.rate,volume:o.volume,onstart:()=>{console.log(" :",e.substring(0,50)+"...")},onend:()=>{this.isSpeaking=!1,console.log(" "),i()},onerror:u=>{console.warn(" Speech error:",u),this.isSpeaking=!1,i()}})}catch(u){console.warn(" Speech exception:",u),this.isSpeaking=!1,i()}})}stop(){this.isSpeaking&&typeof responsiveVoice<"u"&&(responsiveVoice.cancel(),this.isSpeaking=!1)}pause(){typeof responsiveVoice<"u"&&responsiveVoice.pause()}resume(){typeof responsiveVoice<"u"&&responsiveVoice.resume()}getVoices(){return typeof responsiveVoice<"u"?responsiveVoice.getVoices():[]}isSpeakingNow(){return this.isSpeaking}setLanguage(e){["th","en","zh"].includes(e)&&(this.currentLanguage=e)}getLanguage(){return this.currentLanguage}}const Zu=new _J;typeof window<"u"&&window.addEventListener("load",()=>{setTimeout(()=>{Zu.init()},1e3)});const kP=(n,e=null)=>Zu.speak(n,e),fN=()=>{Zu.stop()},ib={Au:{th:" (Au) -     3        ",en:"Automotive Technology (Au) - Thailand's automotive industry ranks among the world's top producers, with projected output of 3 million vehicles annually. Graduates can work as mechanics, vehicle inspectors, or own auto repair businesses, or continue to automotive or mechanical engineering degrees.",zh:" (Au) - 300"},Ev:{th:" (Ev) -        ",en:"Electric Vehicle Technology (Ev) - Vehicle technology is constantly evolving. Thailand's automotive industry ranks among the world's top. Graduates can work as EV mechanics, service center supervisors, or continue to automotive or mechanical engineering degrees.",zh:" (Ev) - "},Ep:{th:" (Ep) -          ",en:"Electrical Power (Ep) - Electrical engineering is fundamental to modern life. Graduates can work as electrical installers, air conditioning and refrigeration technicians, or continue to electrical engineering, education, or industrial degrees.",zh:" (Ep) - "},El:{th:" (El) -             ",en:"Electronics (El) - Study video systems, audio systems, communications, industrial control systems, and robotics. Graduates can work at airports, aviation companies, telecommunications, or continue to communications, electronics and telecommunications, or multimedia engineering degrees.",zh:" (El) - "},Co:{th:" (Co) -       Draft man    ",en:"Construction (Co) - Learn construction techniques and innovations. Graduates can work as construction supervisors, contractors, civil technicians, draftsmen, or in construction materials business, or continue to civil engineering or industrial education degrees.",zh:" (Co) - "},Ar:{th:" (Ar) -               ",en:"Architecture (Ar) - Study design, construction drawing, cost estimation, model making, and structural calculations. Graduates can work as industrial product designers, decorators, interior designers, furniture designers, graphic designers, architects, or continue to architecture degrees.",zh:" (Ar) - "},Ct:{th:" (Ct) -     C, Java, Python       IoT ",en:"Computer Programming (Ct) - Think, code, and innovate. Learn programming with C, Java, Python, web development, mobile apps, system analysis and design, database management, and IoT programming. Programming skills are essential in the technology era.",zh:" (Ct) - CJavaPythonWeb"},It:{th:" (It) -  .         IT    ",en:"Information Technology (It) - Diploma level only. Study computer maintenance, software and hardware. Graduates can work in IT organizations, software companies, network services, internet, e-commerce, IT consulting, animation and gaming, or continue to database, network, or security studies.",zh:" (It) - ITIT"},Ac:{th:" (Ac) -            ",en:"Accounting (Ac) - Businesses need financial data. Lanna Polytechnic College develops curricula to produce efficient accounting professionals. Graduates can work as accountants, accounting consultants, auditors, cost analysts, financial officers, or bank employees.",zh:" (Ac) - "},Mk:{th:" (Mk) -  E-Commerce             ",en:"Marketing (Mk) - In the era of technology and E-Commerce, high competition creates demand for marketing professionals. Graduates can work as market researchers, analysts, brand builders, marketers, strategists, sales managers, in retail, wholesale, or import-export businesses.",zh:" (Mk) - "},Dt:{th:" (Dt) -          ",en:"Digital Business (Dt) - Computer technology plays a role in daily life. Business operations relate to information systems. Graduates can work as computer officers, data analysts, system developers and designers, programmers, IT managers, or webmasters.",zh:" (Dt) - IT"},Tg:{th:" (Tg) -          ",en:"Tourism (Tg) - Blends science and art. Students gain knowledge in various fields. As ASEAN integrates, Thailand becomes the hub for transportation and tourism. Graduates can work as tour guides, tourism business managers, attraction site managers, or recreation business managers.",zh:" (Tg) - "},Hm:{th:" (Hm) -       ",en:"Hotel Management (Hm) - Blends science and art. Students learn communication skills to entertain guests. As ASEAN integrates, Thailand becomes a tourism business hub. Graduates can work in hotel management, tourism business management, or attraction site management.",zh:" (Hm) - "}},bJ=({onDetected:n})=>{const e=oe.useRef(null),t=oe.useRef(null),[r,i]=oe.useState(!0),[a,o]=oe.useState(!1),[u,c]=oe.useState(null),[h,d]=oe.useState(0),[p,g]=oe.useState(""),[v,b]=oe.useState(0),[w,E]=oe.useState(!0),[T,R]=oe.useState(!1),[I,C]=oe.useState(0),[k,L]=oe.useState(null),[O,N]=oe.useState(null),[D,P]=oe.useState(!1),[F,j]=oe.useState(!1),[B,J]=oe.useState(null),[ne,q]=oe.useState(!1),[Y,ee]=oe.useState(0),ue=oe.useRef(null);oe.useRef(null);const fe=oe.useRef(null);oe.useEffect(()=>(T&&(console.log(" Consent accepted, starting setup chain..."),Zu.init(),console.log(" Using Web Camera"),Q().then(()=>(console.log(" Video started successfully"),W())).then(()=>{console.log(" Models loaded successfully, ready to detect face"),alert(" AI Models ! ..."),setTimeout(()=>{console.log(" Auto-starting face detection..."),ve()},1500)}).catch(xe=>{console.error(" Error in setup chain:",xe)})),()=>{e.current&&e.current.srcObject&&e.current.srcObject.getTracks().forEach(xe=>xe.stop()),ue.current&&clearInterval(ue.current),fe.current&&clearInterval(fe.current)}),[T]);const W=async()=>{try{console.log(" Starting to load Face-API models...");const xe="/models";console.log(" Loading tinyFaceDetector from:",xe),await Fr.tinyFaceDetector.loadFromUri(xe),console.log(" tinyFaceDetector loaded"),console.log(" Loading ageGenderNet from:",xe),await Fr.ageGenderNet.loadFromUri(xe),console.log(" ageGenderNet loaded"),console.log(" Loading faceExpressionNet from:",xe),await Fr.faceExpressionNet.loadFromUri(xe),console.log(" faceExpressionNet loaded"),console.log(" Models loaded successfully"),i(!1)}catch(xe){console.error(" Error loading models:",xe),console.error("Error details:",xe.message),alert(`  AI models 
 model  /public/models/

Error: ${xe.message}`),i(!1)}},Q=async()=>{try{console.log(" Requesting camera access...");const xe=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});if(console.log(" Camera opened successfully"),e.current){e.current.srcObject=xe,console.log(" Camera started, waiting for video to be ready...");try{await e.current.play(),console.log(" Video play() started")}catch(ke){console.warn(" Video play error (might autoplay):",ke.message)}return new Promise((ke,Ie)=>{const qe=setInterval(()=>{e.current&&e.current.readyState>=e.current.HAVE_CURRENT_DATA&&(console.log(" Video is ready to use, readyState:",e.current.readyState),clearInterval(qe),ke())},100);setTimeout(()=>{clearInterval(qe),e.current&&e.current.readyState>0?(console.log(" Video stream available (readyState="+e.current.readyState+")"),ke()):Ie(new Error("Video did not become ready in time"))},1e4)})}}catch(xe){throw console.error(" Error accessing camera:",xe),console.error("Camera error code:",xe.name),alert(` :
${xe.message}`),xe}},ce=()=>{c(null),o(!1),d(0),g(""),C(0),b(0),L(null),t.current&&t.current.getContext("2d").clearRect(0,0,t.current.width,t.current.height)},ve=async()=>{if(a){console.warn(" detectFace already in progress");return}if(!e.current){console.warn(" detectFace: videoRef not ready");return}if(e.current.readyState<e.current.HAVE_CURRENT_DATA){console.warn(" Video not ready, readyState:",e.current.readyState),g(" ..."),setTimeout(()=>ve(),500);return}if(!e.current.videoWidth||!e.current.videoHeight){console.warn(" Video dimensions not available"),setTimeout(()=>ve(),500);return}o(!0),d(0),g("");try{console.log(" Starting face detection..."),console.log(" Video dimensions:",e.current.videoWidth,"x",e.current.videoHeight),g(" ..."),d(20);const xe=await Tq(e.current,new s3({inputSize:416,scoreThreshold:.3})).withAgeAndGender().withFaceExpressions();if(!xe){if(console.log(" No face detected, retrying..."),g("  ..."),o(!1),b(et=>et+1),v>10){console.warn(" Max attempts reached, stopping auto-scan"),g('   "Start Scan" '),alert('   "Start Scan" ');return}setTimeout(()=>{ve()},1e3);return}console.log(" Face detected:",xe),Zu.speak(" ");const ke=e.current,Ie=document.createElement("canvas");Ie.width=200,Ie.height=200,Ie.getContext("2d").drawImage(ke,0,0,200,200);const Je=Ie.toDataURL("image/jpeg",.8);L(Je),g(" ..."),d(60),await new Promise(et=>setTimeout(et,1e3));const Ze=Math.round(xe.age),Xe=xe.gender,ot=xe.expressions;console.log(" Detected:",{age:Ze,gender:Xe,expressions:ot}),g(" "),d(90),await new Promise(et=>setTimeout(et,500));const $e=Te(Ze,Xe,ot);console.log(" Interests:",$e);const lt=Object.keys(ot).reduce((et,Vt)=>ot[et]>ot[Vt]?et:Vt);N(lt),d(100),g(" "),Zu.speak(""),await new Promise(et=>setTimeout(et,400));const Kn={age:Ze,gender:Xe,expressions:ot,interests:$e,emotion:lt,source:"web_camera",timestamp:new Date().toISOString()},xn=sessionStorage.getItem("sessionId")||`web_${Date.now()}`;sessionStorage.setItem("sessionId",xn),await DP({sessionId:xn,type:"face_scan_web",demographics:{age:Ze,gender:Xe,emotion:lt},interests:$e,device:"web_camera"}),await av("scanned",xn,{age:Ze,gender:Xe,emotion:lt,source:"web_camera"}),c(Kn),NP(0,0,"face-scan"),Ze<13?(P(!0),C(0)):(setTimeout(()=>C(1),1e3),setTimeout(()=>C(2),3e3),setTimeout(()=>C(3),5500),setTimeout(()=>{C(4),n&&(console.log(" Sending detected interests to parent:",$e),n($e))},8e3))}catch(xe){console.error(" Error detecting face:",xe),g(" ")}o(!1)},Te=(xe,ke,Ie)=>{const qe=[];switch(xe<=16?qe.push("co","it","dt"):xe<=18?qe.push("ev","it","mk"):xe<=20?qe.push("ac","mk","au"):qe.push("au","ep","ac"),ke==="male"?qe.push("au","ev","ep","el","co","ct","it"):qe.push("ac","mk","dt","hm","tg","it","co"),Object.keys(Ie).reduce(($e,lt)=>Ie[$e]>Ie[lt]?$e:lt)){case"happy":qe.push("hm","tg","mk","dt");break;case"neutral":qe.push("ep","el","ac","au","co");break;case"surprised":qe.push("it","dt","co","ev","ar");break;case"sad":qe.push("ar","ct","el","ep");break;default:qe.push("co","au","ac","mk")}const Ze={};qe.forEach($e=>{Ze[$e]=(Ze[$e]||0)+1});const Xe=Object.entries(Ze).sort(($e,lt)=>lt[1]-$e[1]).slice(0,3).map(([$e])=>$e),ot=["au","ev","ep","el","co","ar","ct","it","ac","mk","dt","tg","hm"];for(;Xe.length<3;){const $e=ot[Math.floor(Math.random()*ot.length)];Xe.includes($e)||Xe.push($e)}return Xe},Ae=xe=>{switch(Object.keys(xe).reduce((Ie,qe)=>xe[Ie]>xe[qe]?Ie:qe)){case"happy":return"  ";case"neutral":return"  ";case"surprised":return"  ";default:return"  "}};return S.jsxs("div",{className:"face-detection-container",children:[w&&!T&&S.jsxs(Ce.div,{className:"consent-card",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:[S.jsxs("div",{className:"consent-header",children:[S.jsx("div",{className:"consent-icon",children:""}),S.jsx("h2",{className:"consent-title",children:"Privacy & Data Protection"}),S.jsx("p",{className:"consent-subtitle",children:"PDPA Compliance Notice"})]}),S.jsxs("div",{className:"consent-body",children:[S.jsx("p",{className:"consent-text",children:S.jsx("strong",{children:"We will use the following data:"})}),S.jsxs("ul",{className:"consent-list",children:[S.jsx("li",{className:"consent-item",children:"Facial scan for age and gender detection"}),S.jsx("li",{className:"consent-item",children:"Facial expression analysis"}),S.jsx("li",{className:"consent-item",children:"Temporary video recording during scan"})]}),S.jsx("p",{className:"consent-text",children:S.jsx("strong",{children:"We do NOT:"})}),S.jsxs("ul",{className:"consent-list",children:[S.jsx("li",{className:"consent-item",children:"Store your personal data"}),S.jsx("li",{className:"consent-item",children:"Use microphone or record audio"}),S.jsx("li",{className:"consent-item",children:"Share information with third parties"})]}),S.jsx("p",{className:"consent-text",children:"By accepting, you consent to temporary facial analysis for career recommendations."})]}),S.jsxs("div",{className:"consent-actions",children:[S.jsx("button",{className:"btn btn-decline",onClick:()=>{E(!1),n&&n({skipScan:!0,goToInfo:!0})},children:"Decline"}),S.jsx("button",{className:"btn btn-accept",onClick:()=>{console.log(" User accepted consent, starting video and models..."),alert("   AI models..."),R(!0),E(!1)},children:"Accept & Proceed"})]})]}),D&&u&&u.age<13&&S.jsx(Ce.div,{className:"parental-consent-modal",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:S.jsxs("div",{className:"parental-consent-card",children:[S.jsxs("div",{className:"parental-header",children:[S.jsx("div",{className:"parental-icon",children:""}),S.jsx("h2",{className:"parental-title",children:"Parent/Guardian Permission Required"}),S.jsx("p",{className:"parental-subtitle",children:"This feature requires parental consent"})]}),S.jsxs("div",{className:"parental-body",children:[S.jsxs("div",{className:"child-info",children:[S.jsx("h3",{children:"Detected Information:"}),S.jsxs("p",{children:[S.jsx("strong",{children:"Age:"})," ",u.age," years old"]}),S.jsxs("p",{children:[S.jsx("strong",{children:"Gender:"})," ",u.gender==="male"?"Male":"Female"]}),S.jsxs("p",{children:[S.jsx("strong",{children:"Mood:"})," ",Ae(u.expressions)]})]}),S.jsxs("div",{className:"parental-notice",children:[S.jsx("p",{children:S.jsx("strong",{children:" What We Will Do:"})}),S.jsxs("ul",{children:[S.jsx("li",{children:"Show age-appropriate career recommendations"}),S.jsx("li",{children:"Track engagement with interactive content"}),S.jsx("li",{children:"Display gamified learning interface"})]})]}),S.jsxs("div",{className:"parental-privacy",children:[S.jsx("p",{children:S.jsx("strong",{children:" Privacy Assurance:"})}),S.jsxs("ul",{children:[S.jsx("li",{children:"No personal data is permanently stored"}),S.jsx("li",{children:"Face image deleted after analysis"}),S.jsx("li",{children:"No external data sharing"}),S.jsx("li",{children:"PDPA compliant"})]})]}),S.jsxs("label",{className:"parental-checkbox",children:[S.jsx("input",{type:"checkbox",onChange:xe=>{xe.target.checked&&j(!0)}}),S.jsx("span",{children:"I am the parent/guardian and I consent to this experience"})]})]}),S.jsxs("div",{className:"parental-actions",children:[S.jsx("button",{className:"btn btn-decline",onClick:()=>{P(!1),ce(),n&&n({skipScan:!0,goToInfo:!0})},children:"Not Now"}),S.jsx("button",{className:"btn btn-accept",disabled:!F,onClick:()=>{P(!1),setTimeout(()=>C(1),500),setTimeout(()=>C(2),2e3),setTimeout(()=>C(3),4e3),setTimeout(()=>{C(4),n&&n(u.interests)},6e3)},children:"I Agree & Continue"})]})]})}),T&&!u&&!D&&S.jsxs("div",{className:"scanning-view",children:[S.jsxs("div",{className:"scan-header",children:[S.jsx("h2",{className:"scan-title",children:"Face Detection"}),S.jsx("p",{className:"scan-subtitle",children:"Look at the camera for personalized recommendations"})]}),S.jsxs("div",{className:"video-scanner",children:[S.jsxs("div",{className:"scanner-frame",children:[S.jsx("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0,className:"scanner-video"}),Aq.usePiCamera,S.jsx("div",{className:"scan-circle",children:a&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"scan-line"}),S.jsxs("div",{className:"scan-corners",children:[S.jsx("div",{className:"corner corner-tl"}),S.jsx("div",{className:"corner corner-tr"}),S.jsx("div",{className:"corner corner-bl"}),S.jsx("div",{className:"corner corner-br"})]}),S.jsx("div",{className:"scan-grid"}),S.jsx("div",{className:"scan-particles",children:[...Array(20)].map((xe,ke)=>S.jsx("div",{className:"particle",style:{"--delay":`${ke*.1}s`,"--angle":`${ke*18}deg`}},ke))})]})})]}),S.jsx("p",{className:"scan-status",children:a?p||"Analyzing...":r?"Loading AI Models...":"Ready to Scan"}),!a&&!r&&S.jsx("button",{className:"btn-scan-manual",onClick:ve,children:" Start Scan"})]}),S.jsx("canvas",{ref:t,style:{display:"none"}})]}),u&&S.jsxs(Ce.div,{className:"detection-result",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[S.jsx("div",{className:"result-hero",children:S.jsxs("h2",{className:"hero-title",children:["FIND YOUR PATH.",S.jsx("br",{}),S.jsx("span",{className:"hero-highlight",children:"UNLOCK & FUTURE."})]})}),S.jsxs("div",{className:"recommendation-card",children:[S.jsx("div",{className:"card-header",children:"PERSONALIZED RECOMMENDATION"}),S.jsx("div",{className:"card-body",children:S.jsxs("div",{className:"profile-section",children:[S.jsx("div",{className:"profile-avatar",children:S.jsx("div",{className:"avatar-circle",children:k?S.jsx("img",{src:k,alt:"Scanned face",className:"avatar-image"}):S.jsx("span",{className:"avatar-placeholder",children:""})})}),S.jsxs("div",{className:"profile-info",children:[I>=1&&S.jsxs(Ce.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[S.jsx("span",{className:"info-label",children:"Age:"}),S.jsx("span",{className:"info-value",children:u.age})]}),I>=2&&S.jsxs(Ce.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:[S.jsx("span",{className:"info-label",children:"Gender:"}),S.jsx("span",{className:"info-value",children:u.gender==="male"?"Male":"Female"})]}),I>=3&&S.jsxs(Ce.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:[S.jsx("span",{className:"info-label",children:"Mood:"}),S.jsx("span",{className:"info-value",children:Ae(u.expressions)})]}),I>=4&&S.jsxs(Ce.div,{className:"interests-section",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[S.jsx("p",{className:"interests-title",children:"Based on your profile, you might interested in:"}),S.jsx("ul",{className:"interests-list",children:u.interests.map((xe,ke)=>{const Ie=Fg.find(qe=>qe.id===xe);return S.jsx(Ce.li,{className:"interest-item",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:ke*.1},children:Ie?.name},xe)})})]})]})]})})]}),I>=4&&S.jsxs(Ce.div,{className:"reset-actions",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[S.jsx("button",{className:"btn-reset",onClick:ce,children:"Not Interested, Explore All"}),S.jsx("button",{className:"btn-next",onClick:()=>{n&&n(u.interests)},children:"Show Me!"})]}),I>=4&&S.jsxs(Ce.div,{className:"result-footer",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:[S.jsx("div",{className:"footer-note",children:"AI-Powered Career Recommendations"}),S.jsx("div",{className:"footer-icon",children:""})]})]})]})};class xJ{constructor(){this.apiKey=Sq,this.endpoint="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent",this.conversationHistory=[],this.systemContext=this.buildSystemContext()}buildSystemContext(){const e=Fg.map(i=>`- ${i.name} (${i.code}): ${i.description}`).join(`
`),r=(Fa||{}).contact||{phone:"053-277-777",email:"lannapoly@edu.th",website:"www.lannapoly.ac.th"};return` ""   
  

 (14 ):
${e}

:
-  . : 12,100 / ( 9,000 +  3,100)
-  . : 21,700 / ( 18,700 +  3,000)
- / 

:
- : ${r.phone}
- : ${r.email}
- : ${r.website}

:
- **  1-2 **
- ** **
-  
-   /   /  
-  
- ** 30 **`}async ask(e,t="th"){try{this.conversationHistory.push({role:"user",parts:[{text:e}]});const r=this.conversationHistory.length===1?`${this.systemContext}

: ${e}`:e,i=await fetch(`${this.endpoint}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:r}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:200}})});if(!i.ok)throw new Error(`Gemini API error: ${i.status}`);const o=(await i.json()).candidates?.[0]?.content?.parts?.[0]?.text||"  ?";return this.conversationHistory.push({role:"model",parts:[{text:o}]}),o}catch(r){return console.error("Gemini API Error:",r),this.getFallbackResponse(e,t)}}getFallbackResponse(e,t="th"){const r=e.toLowerCase();if(r.includes("")||r.includes("")||r.includes("course")||r.includes("major"))return t==="th"?" 14   ":"We have 14 courses available. Check out the cards below!";if(r.includes("")||r.includes("tuition")||r.includes("fee"))return t==="th"?" . 12,100 /, . 21,700 / () ":"Tuition: Certificate 12,100 THB/year, Diploma 21,700 THB/year (Industrial)";if(r.includes("")||r.includes("apply")||r.includes("admission")){const i=Fa?.contact||{phone:"053-277-777",website:"www.lannapoly.ac.th"};return t==="th"?` ${i.website}  ${i.phone} `:`Apply at ${i.website} or call ${i.phone}`}if(r.includes("")||r.includes("contact")||r.includes("")){const i=Fa?.contact||{phone:"053-277-777",email:"lannapoly@edu.th"};return t==="th"?`:  ${i.phone},  ${i.email} `:`Contact: Phone ${i.phone}, Email ${i.email}`}return t==="th"?"! ?":t==="en"?"Hello! How can I help you with admissions or course information?":""}detectLanguage(e){return/[\u0E00-\u0E7F]/.test(e)?"th":/[\u4E00-\u9FFF]/.test(e)?"zh":"en"}resetConversation(){this.conversationHistory=[]}getGreeting(e="th"){const t={th:["! ?","! ?","! ?"],en:["Hello! How can I help you with admissions or course information?","Hey there! Which course are you interested in?","Hi! Ready to find your perfect major?"],zh:["","",""]},r=t[e]||t.th;return r[Math.floor(Math.random()*r.length)]}}const AE=new xJ,wJ=(n,e)=>AE.ask(n,e),EJ=()=>AE.resetConversation(),TJ=n=>AE.getGreeting(n);function CJ({onClose:n,interests:e=[]}){const[t,r]=oe.useState([]),[i,a]=oe.useState(""),[o,u]=oe.useState(!1),[c,h]=oe.useState(!1),[d,p]=oe.useState("idle"),[g,v]=oe.useState(!1),[b,w]=oe.useState(!1),[E,T]=oe.useState(!1),R=oe.useRef(null),I=oe.useRef(null),C=oe.useRef(null),k=()=>{R.current?.scrollIntoView({behavior:"smooth"})};oe.useEffect(()=>{k()},[t]),oe.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const B=window.SpeechRecognition||window.webkitSpeechRecognition,J=new B;J.continuous=!1,J.interimResults=!1,J.lang="th-TH",J.onresult=ne=>{const q=ne.results[0][0].transcript;a(q),T(!1)},J.onerror=ne=>{console.error("Speech recognition error:",ne.error),T(!1)},J.onend=()=>{T(!1)},C.current=J}},[]),oe.useEffect(()=>{["idle","talk","bye"].forEach(J=>{const ne=document.createElement("video");ne.src=`/VDO/${J}.mp4`,ne.preload="auto"})},[]),oe.useEffect(()=>(I.current&&I.current.play(),b||setTimeout(()=>{const B=TJ(e);L("talk",B),r([{role:"assistant",content:B}]),w(!0)},500),()=>{fN(),EJ()}),[]);const L=(B,J)=>{const ne=I.current;ne&&(ne.style.transition="opacity 0.2s ease",ne.style.opacity="0.5",setTimeout(()=>{p(B),h(!0),ne.loop=!0,ne.play().then(()=>{ne.style.opacity="1"})},200)),kP(J,"th")},O=()=>{d==="idle"||c?I.current&&I.current.play():p("idle")},N=async()=>{if(!i.trim())return;const B=i.trim();a(""),r(J=>[...J,{role:"user",content:B}]),u(!0),p("idle");try{const J=await wJ(B,e);r(ne=>[...ne,{role:"assistant",content:J}]),L("talk",J)}catch(J){console.error("Error asking Gemini:",J);const ne="  ";r(q=>[...q,{role:"assistant",content:ne}]),L("talk",ne)}finally{u(!1)}},D=(B,J="talk")=>{a(B),setTimeout(()=>N(),100)},P=()=>{if(!C.current){alert("  Google Chrome");return}if(E)C.current.stop(),T(!1);else try{C.current.start(),T(!0),p("idle")}catch(B){console.error("Error starting recognition:",B),T(!1)}},F=()=>{p("bye"),L("bye","  !"),setTimeout(()=>{fN(),n()},3e3)},j=[{text:" ?",video:"talk"},{text:" ?",video:"talk"},{text:" ?",video:"talk"},{text:" ?",video:"talk"}];return S.jsx(sa,{children:S.jsx(Ce.div,{className:"avatar-video-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:F,children:S.jsxs(Ce.div,{className:"avatar-video-container",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onClick:B=>B.stopPropagation(),children:[S.jsxs("div",{className:"video-avatar-section",children:[S.jsx("video",{ref:I,className:"avatar-video",src:`/VDO/${d}.mp4`,loop:d==="idle",autoPlay:!0,muted:!1,playsInline:!0,onEnded:O,onError:B=>{console.error("Video error:",B),d!=="idle"&&p("idle")}}),S.jsxs("div",{className:"avatar-status",children:[E&&S.jsx(Ce.div,{className:"status-badge listening",initial:{scale:0},animate:{scale:1},children:" ..."}),c&&S.jsx(Ce.div,{className:"status-badge speaking",initial:{scale:0},animate:{scale:1},children:" ..."}),o&&S.jsx(Ce.div,{className:"status-badge thinking",initial:{scale:0},animate:{scale:1},children:" ..."})]}),S.jsx("div",{className:"video-info",children:S.jsxs("p",{className:"video-state",children:[": ",d]})})]}),S.jsxs("div",{className:"chat-section",children:[S.jsxs("div",{className:"chat-header",children:[S.jsxs("div",{className:"header-info",children:[S.jsx("h3",{children:" "}),S.jsx("p",{className:"header-subtitle",children:""})]}),S.jsx("button",{className:"close-btn",onClick:F,children:""})]}),S.jsxs("div",{className:"messages-container",children:[t.map((B,J)=>S.jsxs(Ce.div,{className:`message ${B.role}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:J*.1},children:[S.jsx("div",{className:"message-avatar",children:B.role==="assistant"?"":""}),S.jsx("div",{className:"message-content",children:B.content})]},J)),o&&S.jsxs(Ce.div,{className:"message assistant thinking",initial:{opacity:0},animate:{opacity:1},children:[S.jsx("div",{className:"message-avatar",children:""}),S.jsx("div",{className:"message-content",children:S.jsxs("div",{className:"typing-indicator",children:[S.jsx("span",{}),S.jsx("span",{}),S.jsx("span",{})]})})]}),S.jsx("div",{ref:R})]}),t.length<=2&&S.jsxs("div",{className:"quick-questions",children:[S.jsx("p",{className:"quick-label",children:":"}),S.jsx("div",{className:"quick-buttons",children:j.map((B,J)=>S.jsx("button",{className:"quick-btn",onClick:()=>D(B.text,B.video),disabled:o,children:B.text},J))})]}),S.jsxs("div",{className:"chat-input",children:[S.jsx("button",{onClick:P,className:`voice-btn ${E?"listening":""}`,disabled:o,title:"",children:E?"":""}),S.jsx("input",{type:"text",value:i,onChange:B=>a(B.target.value),onKeyPress:B=>B.key==="Enter"&&N(),placeholder:E?"...":"...",disabled:o}),S.jsx("button",{onClick:N,disabled:!i.trim()||o,className:"send-btn",children:o?"":""})]})]})]})})})}const SJ=({suggestedInterests:n=[],onAvatarClick:e})=>{const[t,r]=oe.useState(null),[i,a]=oe.useState("all"),[o,u]=oe.useState(!1);oe.useEffect(()=>{DP({suggestedInterests:n,timestamp:new Date().toISOString()})},[n]);const c=d=>{r(d),NP(50,50,`career-${d.id}`);const p=sessionStorage.getItem("sessionId");av("clicked",p,{careerClicked:d.id,careerName:d.name});const g=ib[d.code];g&&kP(g.th,"th")},h=i==="all"?Fg:Fg.filter(d=>n.includes(d.id));return S.jsxs("div",{className:"career-cards-container",children:[S.jsxs("div",{className:"cards-header",children:[S.jsx(Ce.h2,{className:"section-title",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:" "}),S.jsxs("div",{className:"filter-buttons",children:[S.jsx("button",{className:`filter-btn ${i==="all"?"active":""}`,onClick:()=>a("all"),children:""}),S.jsx("button",{className:`filter-btn ${i==="suggested"?"active":""}`,onClick:()=>a("suggested"),disabled:n.length===0,children:" "})]}),S.jsx("button",{className:"avatar-btn",onClick:e,children:" "})]}),S.jsx("div",{className:"cards-grid",children:h.map((d,p)=>{const g=n.includes(d.id);return S.jsxs(Ce.div,{className:`career-card ${g?"suggested":""}`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:p*.05,duration:.3},whileHover:{scale:1.05,y:-5},onClick:()=>c(d),style:{borderColor:g?d.color:"transparent",color:d.color},children:[S.jsx("div",{className:"card-category",children:d.category}),S.jsx("div",{className:"card-code",style:{color:d.color},children:d.code}),S.jsx("div",{className:"card-icon",children:d.icon}),S.jsx("div",{className:"card-name",children:d.name}),S.jsx("div",{className:"card-description",children:d.description}),g&&S.jsx("div",{className:"suggested-badge",style:{background:d.gradient},children:" "})]},d.id)})}),t&&S.jsx(Ce.div,{className:"detail-overlay",initial:{opacity:0},animate:{opacity:1},onClick:()=>r(null),children:S.jsxs(Ce.div,{className:"detail-modal",initial:{scale:.8,y:50},animate:{scale:1,y:0},onClick:d=>d.stopPropagation(),children:[S.jsx("button",{className:"close-btn",onClick:()=>r(null),children:""}),S.jsxs("div",{className:"modal-header",style:{borderColor:t.color},children:[S.jsx("div",{className:"modal-icon",style:{color:t.color},children:AJ(t.id)}),S.jsx("h2",{style:{color:t.color},children:t.name})]}),S.jsxs("div",{className:"modal-content",children:[S.jsxs("section",{className:"modal-section",children:[S.jsx("h3",{children:" "}),S.jsx("p",{children:t.description})]}),S.jsxs("section",{className:"modal-section",children:[S.jsx("h3",{children:" "}),ib[t.code]&&S.jsx("p",{style:{lineHeight:"1.8",textAlign:"justify"},children:ib[t.code].th})]}),S.jsxs("section",{className:"modal-section",children:[S.jsx("h3",{children:" "}),S.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[S.jsxs("div",{style:{padding:"0.75rem",background:"rgba(126, 200, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(126, 200, 69, 0.3)"},children:[S.jsx("strong",{children:" . ()"}),S.jsx("br",{})," 3 "]}),S.jsxs("div",{style:{padding:"0.75rem",background:"rgba(0, 166, 81, 0.1)",borderRadius:"8px",border:"1px solid rgba(0, 166, 81, 0.3)"},children:[S.jsx("strong",{children:" . ()"}),S.jsx("br",{})," 2 ",t.code==="It"&&S.jsx("span",{style:{color:"#f59e0b",marginLeft:"0.5rem"},children:" ( .)"})]})]})]}),S.jsx("button",{className:"modal-btn",style:{background:`linear-gradient(135deg, ${t.color} 0%, ${t.color}80 100%)`},onClick:()=>u(!0),children:" "})]})]})}),S.jsx(sa,{children:o&&S.jsx(Ce.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>u(!1),children:S.jsxs(Ce.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:d=>d.stopPropagation(),children:[S.jsxs("div",{className:"external-header",children:[S.jsx("h3",{children:" "}),S.jsx("button",{className:"back-btn",onClick:()=>u(!1),children:" "})]}),S.jsx("iframe",{src:"https://www.lannapoly.ac.th/admission/#/?from=website",className:"admission-iframe",title:"Online Admission",allowFullScreen:!0,loading:"lazy"})]})})})]})},AJ=n=>({tech:"",business:"",design:"",health:"",engineering:"",hospitality:""})[n]||"",RJ=({onClose:n})=>{const[e,t]=oe.useState("certificate"),[r,i]=oe.useState(!1),[a,o]=oe.useState(!1),u=g=>new Intl.NumberFormat("th-TH").format(g),c=()=>{i(!0)},h=()=>{i(!1)},d=()=>{o(!0)},p=()=>{o(!1)};return S.jsxs(Ce.div,{className:"tuition-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,children:[S.jsxs(Ce.div,{className:"tuition-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:g=>g.stopPropagation(),children:[S.jsxs("div",{className:"tuition-header",children:[S.jsx("h2",{children:"  & "}),S.jsx("button",{className:"close-btn",onClick:n,children:""})]}),S.jsxs("div",{className:"tuition-tabs",children:[S.jsx("button",{className:`tab-btn ${e==="certificate"?"active":""}`,onClick:()=>t("certificate"),children:" ."}),S.jsx("button",{className:`tab-btn ${e==="diploma"?"active":""}`,onClick:()=>t("diploma"),children:" ."}),S.jsx("button",{className:`tab-btn ${e==="scholarships"?"active":""}`,onClick:()=>t("scholarships"),children:" "})]}),S.jsx("div",{className:"tuition-content",children:S.jsxs(sa,{mode:"wait",children:[e==="certificate"&&S.jsxs(Ce.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[S.jsx("h3",{children:"  . ( .3 )"}),S.jsx("div",{className:"fee-cards",children:Object.entries(Fa.certificate).map(([g,v])=>S.jsxs("div",{className:"fee-card",children:[S.jsx("h4",{children:v.name}),S.jsxs("div",{className:"fee-details",children:[S.jsxs("div",{className:"fee-row",children:[S.jsx("span",{children:":"}),S.jsxs("strong",{children:[u(v.tuition)," /"]})]}),S.jsxs("div",{className:"fee-row",children:[S.jsx("span",{children:" +  + :"}),S.jsxs("strong",{children:[u(v.entrance)," "]})]}),S.jsxs("div",{className:"fee-row total",children:[S.jsx("span",{children:":"}),S.jsxs("strong",{className:"total-price",children:[u(v.total)," "]})]})]})]},g))})]},"certificate"),e==="diploma"&&S.jsxs(Ce.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[S.jsx("h3",{children:"  . ( .3, .6 )"}),S.jsx("div",{className:"fee-cards",children:Object.entries(Fa.diploma).map(([g,v])=>S.jsxs("div",{className:"fee-card",children:[S.jsx("h4",{children:v.name}),S.jsxs("div",{className:"fee-details",children:[S.jsxs("div",{className:"fee-row",children:[S.jsx("span",{children:":"}),S.jsxs("strong",{children:[u(v.tuition)," /"]})]}),S.jsxs("div",{className:"fee-row",children:[S.jsx("span",{children:" +  + :"}),S.jsxs("strong",{children:[u(v.entrance)," "]})]}),S.jsxs("div",{className:"fee-row total",children:[S.jsx("span",{children:":"}),S.jsxs("strong",{className:"total-price",children:[u(v.total)," "]})]})]})]},g))})]},"diploma"),e==="scholarships"&&S.jsxs(Ce.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[S.jsx("h3",{children:" "}),S.jsx("div",{className:"scholarship-grid",children:Fa.scholarships.map(g=>S.jsxs("div",{className:"scholarship-card",style:{borderColor:g.color},children:[S.jsx("div",{className:"scholarship-icon",style:{color:g.color},children:g.icon}),S.jsx("h4",{children:g.name}),S.jsx("p",{children:g.description})]},g.id))}),S.jsxs("div",{className:"benefits-section",children:[S.jsx("h4",{children:" "}),S.jsx("ul",{className:"benefits-list",children:Fa.benefits.map((g,v)=>S.jsxs("li",{children:[" ",g]},v))})]})]},"scholarships")]})}),S.jsxs("div",{className:"tuition-footer",children:[S.jsxs("div",{className:"footer-section",children:[S.jsx("h4",{children:" "}),S.jsx("ul",{className:"doc-list",children:Fa.documents.map((g,v)=>S.jsx("li",{children:g},v))})]}),S.jsxs("div",{className:"footer-section",children:[S.jsx("h4",{children:" "}),S.jsx("div",{className:"method-list",children:Fa.applicationMethods.map(g=>S.jsxs("div",{className:"method-item clickable",onClick:()=>{g.method==="walk-in"?c():g.method==="online"&&d()},children:[S.jsx("span",{className:"method-icon",children:g.icon}),S.jsxs("div",{children:[S.jsx("strong",{children:g.name}),S.jsx("p",{children:g.description})]}),S.jsx("span",{className:"method-arrow",children:""})]},g.method))})]}),S.jsx("div",{className:"notes-section",children:Fa.notes.map((g,v)=>S.jsxs("div",{className:"note-item",children:[" ",g]},v))})]})]}),S.jsx(sa,{children:a&&S.jsx(Ce.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,children:S.jsxs(Ce.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:g=>g.stopPropagation(),children:[S.jsxs("div",{className:"external-header",children:[S.jsx("h3",{children:" "}),S.jsx("button",{className:"back-btn",onClick:p,children:" "})]}),S.jsx("iframe",{src:"https://www.lannapoly.ac.th/admission/#/?from=website",className:"admission-iframe",title:"Online Admission",allowFullScreen:!0,loading:"lazy"})]})})}),S.jsx(sa,{children:r&&S.jsx(Ce.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h,children:S.jsxs(Ce.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:g=>g.stopPropagation(),children:[S.jsxs("div",{className:"external-header",children:[S.jsx("h3",{children:" "}),S.jsx("button",{className:"back-btn",onClick:h,children:" "})]}),S.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d15107.211230282383!2d98.9912912!3d18.8069393!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da3bcb57f2cda3%3A0x5a42c69f9e85016a!2z4Lin4Li04LiX4Lii4Liy4Lil4Lix4Lii4LmA4LiX4LiE4LmC4LiZ4LmC4Lil4Lii4Li14LmC4Lib4Lil4Li04LmA4LiX4LiE4LiZ4Li04LiE4Lil4Liy4LiZ4LiZ4LiyIOC5gOC4iuC4teC4ouC4h-C5g-C4q-C4oeC5iA!5e0!3m2!1sth!2sth!4v1766587427769!5m2!1sth!2sth",className:"admission-iframe",title:"Google Maps - ",allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{border:0}})]})})})]})},IJ=({onInteraction:n})=>{const[e,t]=oe.useState(0),[r,i]=oe.useState("fade"),a=[{type:"fade",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},{type:"slide",initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:-100,opacity:0}},{type:"zoom",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.2,opacity:0}},{type:"rotate",initial:{rotateY:90,opacity:0},animate:{rotateY:0,opacity:1},exit:{rotateY:-90,opacity:0}},{type:"flip",initial:{rotateX:-90,opacity:0},animate:{rotateX:0,opacity:1},exit:{rotateX:90,opacity:0}}],o=[{id:1,type:"image",title:"",subtitle:" ",description:"",image:"/images/activities/1.jpg",gradient:"linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(118, 75, 162, 0.7) 100%)",icon:""},{id:2,type:"image",title:"14 ",subtitle:"",description:" |  |  | ",image:"/images/activities/2.jpg",gradient:"linear-gradient(135deg, rgba(240, 147, 251, 0.7) 0%, rgba(245, 87, 108, 0.7) 100%)",icon:""},{id:3,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/3.jpg",gradient:"linear-gradient(135deg, rgba(79, 172, 254, 0.7) 0%, rgba(0, 242, 254, 0.7) 100%)",icon:""},{id:4,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/4.jpg",gradient:"linear-gradient(135deg, rgba(250, 112, 154, 0.7) 0%, rgba(254, 225, 64, 0.7) 100%)",icon:""},{id:5,type:"image",title:"",subtitle:"95%  6 ",description:" 200 ",image:"/images/activities/5.jpg",gradient:"linear-gradient(135deg, rgba(48, 207, 208, 0.7) 0%, rgba(51, 8, 103, 0.7) 100%)",icon:""},{id:6,type:"image",title:"",subtitle:" 2568",description:" |  | ",image:"/images/activities/6.jpg",gradient:"linear-gradient(135deg, rgba(168, 237, 234, 0.7) 0%, rgba(254, 214, 227, 0.7) 100%)",icon:""},{id:7,type:"image",title:"",subtitle:"",description:"  ",image:"/images/activities/7.jpg",gradient:"linear-gradient(135deg, rgba(255, 159, 124, 0.7) 0%, rgba(255, 95, 109, 0.7) 100%)",icon:""},{id:8,type:"image",title:"",subtitle:"",description:"",image:"/images/activities/8.jpg",gradient:"linear-gradient(135deg, rgba(67, 198, 172, 0.7) 0%, rgba(25, 22, 84, 0.7) 100%)",icon:""},{id:9,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/9.jpg",gradient:"linear-gradient(135deg, rgba(255, 175, 189, 0.7) 0%, rgba(255, 195, 160, 0.7) 100%)",icon:""},{id:10,type:"image",title:"",subtitle:"",description:"",image:"/images/activities/10.jpg",gradient:"linear-gradient(135deg, rgba(132, 250, 176, 0.7) 0%, rgba(143, 211, 244, 0.7) 100%)",icon:""},{id:11,type:"cta",title:"!",subtitle:"",description:" ",gradient:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",icon:"",pulse:!0}];oe.useEffect(()=>{const c=setInterval(()=>{const h=a[Math.floor(Math.random()*a.length)];i(h.type),t(d=>(d+1)%o.length)},5e3);return()=>clearInterval(c)},[o.length]);const u=()=>{n&&n()};return S.jsxs("div",{className:"ad-slideshow",onClick:u,children:[S.jsx("div",{className:"inf-grid-hero-container",children:S.jsx("div",{className:"inf-grid-perspective",children:S.jsxs("div",{className:"grid-lines",children:[[...Array(20)].map((c,h)=>S.jsx("div",{className:"grid-line-horizontal",style:{top:`${h*5}%`}},`h-${h}`)),[...Array(20)].map((c,h)=>S.jsx("div",{className:"grid-line-vertical",style:{left:`${h*5}%`}},`v-${h}`))]})})}),S.jsx(sa,{mode:"wait",children:S.jsxs(Ce.div,{className:"slide",style:{background:o[e].gradient,backgroundImage:o[e].image?`url(${o[e].image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:a.find(c=>c.type===r)?.initial||{opacity:0},animate:a.find(c=>c.type===r)?.animate||{opacity:1},exit:a.find(c=>c.type===r)?.exit||{opacity:0},transition:{duration:.9,ease:[.43,.13,.23,.96]},children:[S.jsx("div",{className:"floating-images-3d",children:o.filter(c=>c.image).slice(0,8).map((c,h)=>S.jsx(Ce.div,{className:"floating-image-card",style:{backgroundImage:`url(${c.image})`,left:`${Math.random()*80+10}%`,top:`${Math.random()*60+20}%`},initial:{rotateX:Math.random()*30-15,rotateY:Math.random()*30-15,z:Math.random()*-500-100,opacity:0},animate:{rotateX:[null,Math.random()*20-10],rotateY:[null,Math.random()*360],z:[null,Math.random()*-300],opacity:[0,.7,.7,0]},transition:{duration:8+Math.random()*4,repeat:1/0,delay:h*.5,ease:"easeInOut"}},`float-${h}`))}),S.jsx("div",{className:"particles",children:[...Array(20)].map((c,h)=>S.jsx(Ce.div,{className:"particle",initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,scale:Math.random()*.5+.5,opacity:0},animate:{y:[null,Math.random()*-200-100],opacity:[0,.6,0],scale:[null,Math.random()*1.5+.5]},transition:{duration:Math.random()*3+2,repeat:1/0,delay:Math.random()*2}},h))}),S.jsx("div",{className:"grid-bg"}),o[e].image&&S.jsx("div",{className:"slide-overlay",style:{background:o[e].gradient}}),S.jsxs("div",{className:"slide-content",children:[S.jsx(Ce.div,{className:`slide-icon ${o[e].pulse?"pulse":""}`,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},children:o[e].icon}),S.jsx(Ce.h1,{className:"slide-title",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},children:o[e].title}),S.jsx(Ce.h2,{className:"slide-subtitle",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:o[e].subtitle}),S.jsx(Ce.p,{className:"slide-description",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},children:o[e].description}),o[e].type==="cta"&&S.jsxs(Ce.div,{className:"cta-hint",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},children:[S.jsx("div",{className:"hand-wave",children:""}),S.jsx("p",{children:""})]})]}),S.jsx("div",{className:"slide-dots",children:o.map((c,h)=>S.jsx("div",{className:`dot ${h===e?"active":""}`,onClick:d=>{d.stopPropagation(),t(h)}},h))})]},e)}),S.jsx("div",{className:"interaction-hint",children:S.jsx("p",{children:" "})})]})};function NJ({onComplete:n,careerSuggestions:e=[]}){const[t,r]=oe.useState("welcome"),[i,a]=oe.useState(null),o=h=>{const d=new(window.AudioContext||window.webkitAudioContext),p=d.createOscillator(),g=d.createGain();p.connect(g),g.connect(d.destination),h==="click"?(p.frequency.value=800,g.gain.setValueAtTime(.1,d.currentTime),g.gain.exponentialRampToValueAtTime(.01,d.currentTime+.1),p.start(d.currentTime),p.stop(d.currentTime+.1)):h==="success"&&(p.frequency.value=1200,g.gain.setValueAtTime(.1,d.currentTime),g.gain.exponentialRampToValueAtTime(.01,d.currentTime+.2),p.start(d.currentTime),p.stop(d.currentTime+.2))},u=h=>{o("click"),h==="start"?r("explore"):h==="back"?r("welcome"):h==="finish"&&n&&n()},c=h=>{o("success"),a(h),r("career")};return S.jsxs("div",{className:"kids-mode",children:[t==="welcome"&&S.jsxs(Ce.div,{className:"kids-screen welcome-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[S.jsx(Ce.h1,{className:"kids-title",children:" ! "}),S.jsx(Ce.div,{className:"emoji-bounce",animate:{y:[0,-20,0]},transition:{duration:1.5,repeat:1/0},children:""}),S.jsx(Ce.p,{className:"kids-subtitle",children:"  !"}),S.jsxs(Ce.button,{className:"big-button start-button",onClick:()=>u("start"),whileHover:{scale:1.1},whileTap:{scale:.95},children:[S.jsx("span",{className:"button-text",children:"!"}),S.jsx("span",{className:"button-emoji",children:""})]})]}),t==="explore"&&S.jsxs(Ce.div,{className:"kids-screen explore-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[S.jsx(Ce.h2,{className:"kids-title",children:"! "}),S.jsx("div",{className:"kids-career-grid",children:e.length>0?e.map(h=>S.jsxs(Ce.div,{className:"kids-career-card",onClick:()=>c(h),whileHover:{scale:1.05},whileTap:{scale:.95},animate:{boxShadow:["0 5px 15px rgba(0, 0, 0, 0.1)","0 8px 25px rgba(0, 0, 0, 0.2)","0 5px 15px rgba(0, 0, 0, 0.1)"]},transition:{duration:2,repeat:1/0},children:[S.jsx("div",{className:"big-emoji",children:h.icon}),S.jsx("div",{className:"career-name",children:h.name})]},h.id)):S.jsx("p",{className:"placeholder",children:"..."})}),S.jsxs(Ce.button,{className:"big-button back-button",onClick:()=>u("back"),whileHover:{scale:1.1},whileTap:{scale:.95},children:[S.jsx("span",{className:"button-emoji",children:""}),S.jsx("span",{className:"button-text",children:""})]})]}),t==="career"&&i&&S.jsxs(Ce.div,{className:"kids-screen career-screen",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},children:[S.jsx(Ce.div,{className:"big-emoji-large",animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:i.icon}),S.jsx(Ce.h2,{className:"kids-title",children:i.name}),S.jsx(Ce.p,{className:"kids-description",children:i.description}),S.jsxs("div",{className:"kids-buttons-row",children:[S.jsx(Ce.button,{className:"big-button back-button",onClick:()=>u("back"),whileHover:{scale:1.1},whileTap:{scale:.95},children:S.jsx("span",{className:"button-emoji",children:""})}),S.jsx(Ce.button,{className:"big-button finish-button",onClick:()=>u("finish"),whileHover:{scale:1.1},whileTap:{scale:.95},children:S.jsx("span",{className:"button-emoji",children:""})})]})]}),t!=="welcome"&&S.jsx("div",{className:"confetti",children:[...Array(10)].map((h,d)=>S.jsx(Ce.div,{className:"confetti-piece",initial:{x:Math.random()*300-150,y:-20,opacity:1},animate:{y:400,opacity:0},transition:{duration:2+Math.random()*1,repeat:1/0},children:["","","","",""][Math.floor(Math.random()*5)]},d))})]})}let ab=null,dN=0;const DJ=300*1e3,kJ=async()=>{try{const n=Date.now();if(ab&&n-dN<DJ)return ab;console.log(" Fetching age groups from Firebase...");const e=vi(kt,"age_groups"),t=await xd(e);if(t.empty)return console.warn(" No age groups found in Firebase, using fallback"),pN();const r=t.docs.map(i=>({id:i.id,...i.data()}));return r.sort((i,a)=>i.ageMin-a.ageMin),ab=r,dN=n,console.log(` Loaded ${r.length} age groups`),r}catch(n){return console.error(" Error fetching age groups:",n),pN()}},MP=async n=>{const e=await kJ(),t=e.find(i=>n>=i.ageMin&&n<=i.ageMax);if(t)return console.log(` Age ${n} matches group: ${t.name} (${t.id})`),t;const r=e[e.length-1];return console.warn(` Age ${n} not matched, using default: ${r.name}`),r},MJ=async(n,e=20)=>{try{const t=await MP(n);if(!t)return console.error(" No age group found"),mN(n);console.log(` Fetching content for age ${n} (${t.name} - ${t.id})`);const r=vi(kt,"content_items"),i=fO(r,RI("ageGroupId","==",t.id),RI("isActive","==",!0),x1("priority","desc"),x1("createdAt","desc"),E$(e)),o=(await xd(i)).docs.map(u=>({id:u.id,...u.data()}));return console.log(` Found ${o.length} content items for ${t.name}`),o}catch(t){return console.error(" Error fetching content:",t),mN(n)}},Ym=async(n,e)=>{try{const t=Do(kt,"content_items",n);await wd(t,{viewCount:vO(1)});const r=vi(kt,"user_interactions");await au(r,{...e,contentId:n,action:"view",timestamp:new Date}),console.log(` Logged view for content: ${n}`)}catch(t){console.error(" Error logging view:",t)}},OJ=async(n,e)=>{try{const t=Do(kt,"content_items",n);await wd(t,{clickCount:vO(1)});const r=vi(kt,"user_interactions");await au(r,{...e,contentId:n,action:"click",timestamp:new Date}),console.log(` Logged click for content: ${n}`)}catch(t){console.error(" Error logging click:",t)}},pN=()=>[{id:"kids",name:"",ageMin:3,ageMax:12,description:"",emoji:"",color:"#22c55e"},{id:"teens",name:"",ageMin:13,ageMax:21,description:"",emoji:"",color:"#3b82f6"},{id:"adults",name:"",ageMin:22,ageMax:100,description:"",emoji:"",color:"#8b5cf6"}],mN=async n=>{const e=await MP(n),t=e?e.id:"teens",r={kids:[{id:"fallback-kids-1",title:" ",description:"  8-12 ",type:"event",ageGroupId:"kids",priority:8,imageUrl:null,isActive:!0},{id:"fallback-kids-2",title:" ",description:" ",type:"activity",ageGroupId:"kids",priority:7,imageUrl:null,isActive:!0}],teens:[{id:"fallback-teens-1",title:"  100%",description:" GPA 3.5+",type:"scholarship",ageGroupId:"teens",priority:10,imageUrl:null,isActive:!0},{id:"fallback-teens-2",title:" 14 ",description:"    ",type:"career",ageGroupId:"teens",priority:9,imageUrl:null,isActive:!0},{id:"fallback-teens-3",title:"  .6",description:"!  ",type:"promotion",ageGroupId:"teens",priority:8,imageUrl:null,isActive:!0},{id:"fallback-teens-4",title:" ",description:"    ",type:"activity",ageGroupId:"teens",priority:7,imageUrl:null,isActive:!0},{id:"fallback-teens-5",title:"  0%",description:"   3,000 ",type:"promotion",ageGroupId:"teens",priority:8,imageUrl:null,isActive:!0}],adults:[{id:"fallback-adults-1",title:" ROI ",description:"",type:"news",ageGroupId:"adults",priority:9,imageUrl:null,isActive:!0},{id:"fallback-adults-2",title:"  95%",description:" 6   15,000+",type:"news",ageGroupId:"adults",priority:8,imageUrl:null,isActive:!0}]};return r[t]||r.teens};function PJ({age:n,sessionId:e,sessionData:t,onClose:r}){const[i,a]=oe.useState([]),[o,u]=oe.useState(0),[c,h]=oe.useState(!0),[d,p]=oe.useState(!0);oe.useEffect(()=>{(async()=>{h(!0);const R=await MJ(n,20);a(R),h(!1),R.length>0&&Ym(R[0].id,t)})()},[n]),oe.useEffect(()=>{if(!d||i.length===0)return;const T=setInterval(()=>{g()},8e3);return()=>clearInterval(T)},[d,o,i.length]);const g=()=>{const T=(o+1)%i.length;u(T),i[T]&&Ym(i[T].id,t)},v=()=>{const T=(o-1+i.length)%i.length;u(T),i[T]&&Ym(i[T].id,t)},b=()=>{i[o]&&(OJ(i[o].id,t),p(!1))};if(c)return S.jsx(Ce.div,{className:"content-popup-overlay",initial:{opacity:0},animate:{opacity:1},children:S.jsxs("div",{className:"content-popup loading",children:[S.jsx("div",{className:"loading-spinner"}),S.jsx("p",{children:"..."})]})});if(i.length===0)return null;const w=i[o],E={scholarship:"",news:"",event:"",promotion:"",career:"",activity:""};return S.jsx(sa,{children:S.jsx(Ce.div,{className:"content-popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,children:S.jsxs(Ce.div,{className:"content-popup",initial:{scale:.8,opacity:0,y:50},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:50},transition:{type:"spring",damping:20},onClick:T=>T.stopPropagation(),children:[S.jsx("button",{className:"close-btn",onClick:r,children:""}),S.jsxs("div",{className:"content-badge",children:[S.jsx("span",{className:"badge-emoji",children:E[w.type]||""}),S.jsx("span",{className:"badge-text",children:w.type})]}),S.jsx(sa,{mode:"wait",children:S.jsxs(Ce.div,{className:"content-body",initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.3},onClick:b,children:[w.imageUrl?S.jsx("div",{className:"content-image",children:S.jsx("img",{src:w.imageUrl,alt:w.title})}):S.jsx("div",{className:"content-icon",children:S.jsx("span",{children:E[w.type]||""})}),S.jsx("h2",{className:"content-title",children:w.title}),S.jsx("p",{className:"content-description",children:w.description}),w.tags&&w.tags.length>0&&S.jsx("div",{className:"content-tags",children:w.tags.map((T,R)=>S.jsxs("span",{className:"tag",children:["#",T]},R))})]},w.id)}),S.jsxs("div",{className:"content-navigation",children:[S.jsx("button",{className:"nav-btn prev",onClick:v,disabled:i.length<=1,children:" "}),S.jsxs("div",{className:"content-indicator",children:[S.jsx("span",{className:"current",children:o+1}),S.jsx("span",{className:"separator",children:"/"}),S.jsx("span",{className:"total",children:i.length})]}),S.jsx("button",{className:"nav-btn next",onClick:g,disabled:i.length<=1,children:" "})]}),S.jsx("div",{className:"auto-play-control",children:S.jsx("button",{className:`auto-play-btn ${d?"active":""}`,onClick:()=>p(!d),children:d?" ":" "})}),S.jsx("div",{className:"dots-indicator",children:i.map((T,R)=>S.jsx("button",{className:`dot ${R===o?"active":""}`,onClick:()=>{u(R),Ym(i[R].id,t),p(!1)}},R))})]})})})}function gN({onClose:n}){const[e,t]=oe.useState([]),[r,i]=oe.useState(!0),[a,o]=oe.useState(null),[u,c]=oe.useState(!1),[h,d]=oe.useState({title:"",description:"",type:"scholarship",ageGroupId:"",priority:5,tags:"",imageUrl:"",isActive:!0}),p=[{id:"scholarship",name:"",icon:""},{id:"news",name:"",icon:""},{id:"event",name:"",icon:""},{id:"promotion",name:"",icon:""},{id:"career",name:"",icon:""},{id:"activity",name:"",icon:""}],[g,v]=oe.useState([]);oe.useEffect(()=>{w(),b()},[]);const b=async()=>{if(!kt){console.warn(" Firebase not configured - using default age groups"),v([{id:"KIDS_3_12",name:"",emoji:"",ageMin:3,ageMax:12},{id:"TEENS_13_17",name:"",emoji:"",ageMin:13,ageMax:17},{id:"ADULTS_18_PLUS",name:"",emoji:"",ageMin:18,ageMax:100}]);return}try{const C=vi(kt,"age_groups"),L=(await xd(C)).docs.map(O=>({id:O.id,...O.data()}));L.sort((O,N)=>O.ageMin-N.ageMin),v(L),L.length===0&&console.warn(" No age groups found, please add them in Firebase")}catch(C){console.error("Error fetching age groups:",C)}},w=async()=>{if(!kt){i(!1),alert(` Firebase 

 Firebase  src/config.js  Admin Panel

: FIREBASE_SETUP.md`);return}try{i(!0);const C=vi(kt,"content_items"),k=fO(C,x1("createdAt","desc")),O=(await xd(k)).docs.map(N=>({id:N.id,...N.data()}));t(O)}catch(C){console.error("Error fetching contents:",C),alert(": "+C.message)}finally{i(!1)}},E=async C=>{if(C.preventDefault(),!kt){alert(" Firebase ");return}try{const k={...h,tags:h.tags.split(",").map(L=>L.trim()).filter(L=>L),createdAt:a?a.createdAt:new Date,updatedAt:new Date,viewCount:a?a.viewCount:0,clickCount:a?a.clickCount:0};if(a){const L=Do(kt,"content_items",a.id);await wd(L,k),alert(" !")}else await au(vi(kt,"content_items"),k),alert(" !");d({title:"",description:"",type:"scholarship",ageGroupId:"",priority:5,tags:"",imageUrl:"",isActive:!0}),o(null),c(!1),w()}catch(k){console.error("Error saving content:",k),alert(" : "+k.message)}},T=C=>{o(C),d({title:C.title,description:C.description,type:C.type,ageGroupId:C.ageGroupId||"",priority:C.priority,tags:C.tags?C.tags.join(", "):"",imageUrl:C.imageUrl||"",isActive:C.isActive}),c(!0)},R=async C=>{if(confirm("?"))try{await mO(Do(kt,"content_items",C)),alert(" !"),w()}catch(k){console.error("Error deleting content:",k),alert(" : "+k.message)}},I=async C=>{try{const k=Do(kt,"content_items",C.id);await wd(k,{isActive:!C.isActive}),w()}catch(k){console.error("Error toggling active:",k)}};return S.jsx(Ce.div,{className:"content-admin-overlay",initial:{opacity:0},animate:{opacity:1},children:S.jsxs(Ce.div,{className:"content-admin",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},children:[S.jsxs("div",{className:"admin-header",children:[S.jsx("h1",{children:"  Content Management"}),S.jsx("button",{className:"close-btn",onClick:n,children:""})]}),S.jsxs("div",{className:"admin-actions",children:[S.jsx("button",{className:"btn-add",onClick:()=>{c(!u),o(null),d({title:"",description:"",type:"scholarship",ageGroupId:"",priority:5,tags:"",imageUrl:"",isActive:!0})},children:u?" ":" "}),S.jsx("button",{className:"btn-refresh",onClick:w,children:" "})]}),u&&S.jsxs(Ce.form,{className:"content-form",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},onSubmit:E,children:[S.jsx("h2",{children:a?" ":" "}),S.jsx("div",{className:"form-row",children:S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" *"}),S.jsx("input",{type:"text",value:h.title,onChange:C=>d({...h,title:C.target.value}),required:!0,placeholder:"  100%"})]})}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" *"}),S.jsx("textarea",{value:h.description,onChange:C=>d({...h,description:C.target.value}),required:!0,rows:"4",placeholder:"..."})]}),S.jsxs("div",{className:"form-row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:""}),S.jsx("select",{value:h.type,onChange:C=>d({...h,type:C.target.value}),children:p.map(C=>S.jsxs("option",{value:C.id,children:[C.icon," ",C.name]},C.id))})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" *"}),S.jsxs("select",{value:h.ageGroupId,onChange:C=>d({...h,ageGroupId:C.target.value}),required:!0,children:[S.jsx("option",{value:"",children:"--  --"}),g.map(C=>S.jsxs("option",{value:C.id,children:[C.emoji," ",C.name," (",C.ageMin,"-",C.ageMax," )"]},C.id))]})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" (1-10)"}),S.jsx("input",{type:"number",min:"1",max:"10",value:h.priority,onChange:C=>d({...h,priority:parseInt(C.target.value)})})]})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Tags ()"}),S.jsx("input",{type:"text",value:h.tags,onChange:C=>d({...h,tags:C.target.value}),placeholder:", , "})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"URL  ()"}),S.jsx("input",{type:"url",value:h.imageUrl,onChange:C=>d({...h,imageUrl:C.target.value}),placeholder:"https://example.com/image.jpg"})]}),S.jsx("div",{className:"form-group checkbox",children:S.jsxs("label",{children:[S.jsx("input",{type:"checkbox",checked:h.isActive,onChange:C=>d({...h,isActive:C.target.checked})}),""]})}),S.jsxs("div",{className:"form-actions",children:[S.jsx("button",{type:"submit",className:"btn-save",children:a?" ":" "}),S.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>{c(!1),o(null)},children:""})]})]}),S.jsxs("div",{className:"content-list",children:[S.jsxs("h2",{children:["  (",e.length,")"]}),r?S.jsxs("div",{className:"loading",children:[S.jsx("div",{className:"spinner"}),S.jsx("p",{children:"..."})]}):e.length===0?S.jsxs("div",{className:"empty-state",children:[S.jsx("p",{children:""}),S.jsx("p",{children:' "" '})]}):S.jsx("div",{className:"content-grid",children:e.map(C=>S.jsxs(Ce.div,{className:`content-card ${C.isActive?"":"inactive"}`,whileHover:{scale:1.02},children:[S.jsxs("div",{className:"card-header",children:[S.jsxs("span",{className:"type-badge",children:[p.find(k=>k.id===C.type)?.icon," ",C.type]}),S.jsxs("span",{className:"age-badge",children:[g.find(k=>k.id===C.ageGroupId)?.emoji||"",g.find(k=>k.id===C.ageGroupId)?.name||C.ageGroupId]})]}),S.jsx("h3",{children:C.title}),S.jsx("p",{className:"description",children:C.description}),S.jsxs("div",{className:"card-meta",children:[S.jsxs("span",{children:[" Priority: ",C.priority]}),S.jsxs("span",{children:[" Views: ",C.viewCount||0]}),S.jsxs("span",{children:[" Clicks: ",C.clickCount||0]})]}),C.tags&&C.tags.length>0&&S.jsx("div",{className:"tags",children:C.tags.map((k,L)=>S.jsxs("span",{className:"tag",children:["#",k]},L))}),S.jsxs("div",{className:"card-actions",children:[S.jsx("button",{className:"btn-toggle",onClick:()=>I(C),children:C.isActive?" ":" "}),S.jsx("button",{className:"btn-edit",onClick:()=>T(C),children:" "}),S.jsx("button",{className:"btn-delete",onClick:()=>R(C.id),children:" "})]})]},C.id))})]})]})})}function vN({onClose:n}){const[e,t]=oe.useState([]),[r,i]=oe.useState(!0),[a,o]=oe.useState(null),[u,c]=oe.useState(!1),[h,d]=oe.useState({id:"",name:"",ageMin:0,ageMax:100,description:"",emoji:"",color:"#3b82f6"});oe.useEffect(()=>{p()},[]);const p=async()=>{if(!kt){i(!1),alert(` Firebase 

 Firebase  src/config.js  Admin Panel

: FIREBASE_SETUP.md`);return}try{i(!0);const T=vi(kt,"age_groups"),I=(await xd(T)).docs.map(C=>({id:C.id,...C.data()}));I.sort((C,k)=>C.ageMin-k.ageMin),t(I)}catch(T){console.error("Error fetching age groups:",T),alert(": "+T.message)}finally{i(!1)}},g=()=>h.id.trim()?h.name.trim()?h.ageMin<0||h.ageMax<0?(alert(" 0"),!1):h.ageMin>=h.ageMax?(alert(""),!1):!a&&e.some(T=>T.id===h.id)?(alert("ID   ID "),!1):!0:(alert(""),!1):(alert(" ID ( )"),!1),v=async T=>{if(T.preventDefault(),!kt){alert(" Firebase ");return}if(g())try{const R={id:h.id,name:h.name,ageMin:parseInt(h.ageMin),ageMax:parseInt(h.ageMax),description:h.description,emoji:h.emoji||"",color:h.color||"#3b82f6"};if(a){const I=Do(kt,"age_groups",a.id);await wd(I,R),alert(" !")}else await A$(Do(kt,"age_groups",h.id),R),alert(" !");d({id:"",name:"",ageMin:0,ageMax:100,description:"",emoji:"",color:"#3b82f6"}),o(null),c(!1),p()}catch(R){console.error("Error saving age group:",R),alert(" : "+R.message)}},b=T=>{o(T),d({id:T.id,name:T.name,ageMin:T.ageMin,ageMax:T.ageMax,description:T.description||"",emoji:T.emoji||"",color:T.color||"#3b82f6"}),c(!0)},w=async T=>{if(confirm(` "${T}"?

 : !`))try{await mO(Do(kt,"age_groups",T)),alert(" !"),p()}catch(R){console.error("Error deleting age group:",R),alert(" : "+R.message)}},E=()=>{d({id:"",name:"",ageMin:0,ageMax:100,description:"",emoji:"",color:"#3b82f6"}),o(null),c(!1)};return S.jsx(Ce.div,{className:"age-group-admin-overlay",initial:{opacity:0},animate:{opacity:1},children:S.jsxs(Ce.div,{className:"age-group-admin",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},children:[S.jsxs("div",{className:"admin-header",children:[S.jsx("h1",{children:"  (Age Groups)"}),S.jsx("button",{className:"close-btn",onClick:n,children:""})]}),S.jsxs("div",{className:"admin-actions",children:[S.jsx("button",{className:"btn-add",onClick:()=>{E(),c(!u)},children:u?" ":" "}),S.jsx("button",{className:"btn-refresh",onClick:p,children:" "})]}),u&&S.jsxs(Ce.form,{className:"age-group-form",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},onSubmit:v,children:[S.jsx("h2",{children:a?" ":" "}),S.jsxs("div",{className:"form-row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"ID () *"}),S.jsx("input",{type:"text",value:h.id,onChange:T=>d({...h,id:T.target.value.toLowerCase().replace(/\s/g,"_")}),placeholder:"teens",required:!0,disabled:!!a,pattern:"[a-z_]+",title:"  _ "}),S.jsx("small",{children:" Key  database ()"})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" *"}),S.jsx("input",{type:"text",value:h.name,onChange:T=>d({...h,name:T.target.value}),placeholder:"",required:!0})]})]}),S.jsxs("div",{className:"form-row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" *"}),S.jsx("input",{type:"number",min:"0",max:"150",value:h.ageMin,onChange:T=>d({...h,ageMin:parseInt(T.target.value)||0}),required:!0})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:" *"}),S.jsx("input",{type:"number",min:"0",max:"150",value:h.ageMax,onChange:T=>d({...h,ageMax:parseInt(T.target.value)||0}),required:!0})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Emoji"}),S.jsx("input",{type:"text",value:h.emoji,onChange:T=>d({...h,emoji:T.target.value}),placeholder:"",maxLength:"2"})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:""}),S.jsx("input",{type:"color",value:h.color,onChange:T=>d({...h,color:T.target.value})})]})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:""}),S.jsx("textarea",{value:h.description,onChange:T=>d({...h,description:T.target.value}),rows:"3",placeholder:"    "})]}),S.jsxs("div",{className:"form-actions",children:[S.jsx("button",{type:"submit",className:"btn-save",children:a?" ":" "}),S.jsx("button",{type:"button",className:"btn-cancel",onClick:E,children:""})]})]}),S.jsxs("div",{className:"age-groups-list",children:[S.jsxs("h2",{children:["  (",e.length,")"]}),r?S.jsxs("div",{className:"loading",children:[S.jsx("div",{className:"spinner"}),S.jsx("p",{children:"..."})]}):e.length===0?S.jsxs("div",{className:"empty-state",children:[S.jsx("p",{children:""}),S.jsx("p",{children:' "" '})]}):S.jsx("div",{className:"age-groups-grid",children:e.map(T=>S.jsxs(Ce.div,{className:"age-group-card",style:{borderLeftColor:T.color},whileHover:{scale:1.02},children:[S.jsxs("div",{className:"card-header",children:[S.jsxs("div",{className:"group-info",children:[S.jsx("span",{className:"emoji",children:T.emoji}),S.jsxs("div",{children:[S.jsx("h3",{children:T.name}),S.jsxs("span",{className:"group-id",children:["ID: ",T.id]})]})]}),S.jsxs("div",{className:"age-range",style:{backgroundColor:T.color},children:[T.ageMin,"-",T.ageMax," "]})]}),T.description&&S.jsx("p",{className:"description",children:T.description}),S.jsxs("div",{className:"card-actions",children:[S.jsx("button",{className:"btn-edit",onClick:()=>b(T),children:" "}),S.jsx("button",{className:"btn-delete",onClick:()=>w(T.id),children:" "})]})]},T.id))})]})]})})}const VJ=({onNavigate:n})=>{const[e,t]=oe.useState(!1),[r,i]=oe.useState(""),[a,o]=oe.useState(!1),[u,c]=oe.useState(!1),[h,d]=oe.useState(!1),p="2025",g=()=>{r===p?(o(!0),i(""),setTimeout(()=>t(!1),500)):(alert(" "),i(""))},v=w=>{t(!1),n(w)},b=()=>{o(!1),t(!1)};return S.jsxs(S.Fragment,{children:[S.jsx(Ce.button,{className:"admin-toggle-btn",onClick:()=>t(!e),whileHover:{scale:1.1},whileTap:{scale:.95},title:"Admin Panel",children:a?"":""}),S.jsx(sa,{children:e&&S.jsx(Ce.div,{className:"admin-menu-backdrop",onClick:()=>t(!1),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:S.jsx(Ce.div,{className:"admin-menu-popup",onClick:w=>w.stopPropagation(),initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:a?S.jsxs("div",{className:"admin-menu-content",children:[S.jsxs("div",{className:"admin-header",children:[S.jsx("h2",{children:" Admin Dashboard"}),S.jsx("p",{children:"Select what you want to view"})]}),S.jsxs("div",{className:"admin-menu-items",children:[S.jsxs(Ce.button,{className:"menu-item analytics",onClick:()=>v("analytics"),whileHover:{x:5,backgroundColor:"rgba(102, 126, 234, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:"Analytics Dashboard"}),S.jsx("p",{children:"View heatmaps and statistics"})]}),S.jsx("span",{className:"menu-arrow",children:""})]}),S.jsxs(Ce.button,{className:"menu-item careers",onClick:()=>v("home"),whileHover:{x:5,backgroundColor:"rgba(34, 197, 94, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:"Back to Kiosk"}),S.jsx("p",{children:"Return to main application"})]}),S.jsx("span",{className:"menu-arrow",children:""})]}),S.jsxs(Ce.button,{className:"menu-item content",onClick:()=>{t(!1),c(!0)},whileHover:{x:5,backgroundColor:"rgba(236, 72, 153, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:""}),S.jsx("p",{children:"//"})]}),S.jsx("span",{className:"menu-arrow",children:""})]}),S.jsxs(Ce.button,{className:"menu-item agegroup",onClick:()=>{t(!1),d(!0)},whileHover:{x:5,backgroundColor:"rgba(245, 158, 11, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:""}),S.jsx("p",{children:"//"})]}),S.jsx("span",{className:"menu-arrow",children:""})]}),S.jsxs(Ce.button,{className:"menu-item firebasedb",onClick:()=>window.open("https://console.firebase.google.com","_blank"),whileHover:{x:5,backgroundColor:"rgba(249, 115, 22, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:"Firebase Console"}),S.jsx("p",{children:"Manage database directly"})]}),S.jsx("span",{className:"menu-arrow",children:""})]}),S.jsxs(Ce.button,{className:"menu-item stats",onClick:()=>alert(" Session Management - Coming Soon!"),whileHover:{x:5,backgroundColor:"rgba(168, 85, 247, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:"Session Logs"}),S.jsx("p",{children:"View user activity history"})]}),S.jsx("span",{className:"menu-arrow",children:""})]}),u&&S.jsx(gN,{onClose:()=>c(!1)}),h&&S.jsx(vN,{onClose:()=>d(!1)}),S.jsxs(Ce.button,{className:"menu-item settings",onClick:()=>alert(" Settings - Coming Soon!"),whileHover:{x:5,backgroundColor:"rgba(14, 165, 233, 0.15)"},whileTap:{scale:.98},children:[S.jsx("span",{className:"menu-icon",children:""}),S.jsxs("div",{className:"menu-text",children:[S.jsx("h3",{children:"Kiosk Settings"}),S.jsx("p",{children:"Configure kiosk parameters"})]}),S.jsx("span",{className:"menu-arrow",children:""})]})]}),S.jsx("div",{className:"admin-footer",children:S.jsx("button",{className:"btn-logout",onClick:b,children:" Logout"})}),S.jsx("div",{className:"admin-info",children:S.jsxs("p",{children:[" Logged in as: ",S.jsx("strong",{children:"Administrator"})]})})]}):S.jsxs("div",{className:"admin-login",children:[S.jsx("h2",{children:" Admin Access"}),S.jsx("p",{children:""}),S.jsx("input",{type:"password",placeholder:"Enter Admin Code",value:r,onChange:w=>i(w.target.value),onKeyPress:w=>w.key==="Enter"&&g(),autoFocus:!0,className:"admin-input"}),S.jsx("button",{className:"btn-admin",onClick:g,children:""}),S.jsx("button",{className:"btn-close",onClick:()=>t(!1),children:""}),S.jsx("div",{className:"admin-hint",children:S.jsx("p",{children:" Hint: Enter the year Lanna Polythentic was founded"})})]})})})}),S.jsx(sa,{children:u&&S.jsx(gN,{onClose:()=>c(!1)})}),S.jsx(sa,{children:h&&S.jsx(vN,{onClose:()=>d(!1)})})]})};function FJ(){const[n,e]=oe.useState(!1),[t,r]=oe.useState("home"),[i,a]=oe.useState([]),[o,u]=oe.useState(!1),[c,h]=oe.useState(!1),[d,p]=oe.useState(!0),[g,v]=oe.useState(null),[b,w]=oe.useState(null),[E,T]=oe.useState(null),[R,I]=oe.useState(null),[C,k]=oe.useState(null),[L,O]=oe.useState("ADULTS_18_PLUS"),[N,D]=oe.useState(!1),P=oe.useRef(null),F=oe.useRef(null),j=oe.useRef(null),B=12e4;oe.useEffect(()=>{(async()=>{const ce="session-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);I(ce),k(Date.now()),sessionStorage.setItem("sessionId",ce),await av("visit",ce,{timestamp:new Date().toISOString(),userAgent:navigator.userAgent})})()},[]);const J=oe.useCallback(()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{console.log(" Idle timeout reached - returning to home"),p(!0),r("home"),u(!1),h(!1)},B)},[]);F.current=J;const ne=()=>{d&&(p(!1),r("home")),J()},q=Q=>{const ce=Q.clientX/window.innerWidth*100,ve=Q.clientY/window.innerHeight*100;vJ(ce,ve,t),ne()};oe.useEffect(()=>(setTimeout(()=>{Zu.init()},1e3),window.resetIdleTimer=J,()=>{window.resetIdleTimer=null}),[]),oe.useEffect(()=>{const Q=["mousedown","mousemove","keypress","scroll","touchstart","click"],ce=ve=>{F.current&&F.current()};return Q.forEach(ve=>{document.addEventListener(ve,ce,{passive:!0})}),console.log(" Event listeners registered for idle timer reset"),()=>{Q.forEach(ve=>{document.removeEventListener(ve,ce)}),console.log(" Event listeners cleaned up")}},[]),oe.useEffect(()=>{},[]);const Y=Q=>{if(J(),Q.skipScan&&Q.goToInfo){r("explore"),a([]);return}if(Q.age){v(Q.age);const ce=Rq(Q.age);O(ce.id)}Q.gender&&w(Q.gender),Q.emotion&&T(Q.emotion),a(Q),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{g&&(console.log(" Showing content popup after 10 seconds"),D(!0))},1e4),Q.length>0&&(yJ(R,"home","explore"),r("explore"))},ee=()=>{r("home"),a([]),u(!1),D(!1),j.current&&clearTimeout(j.current),J()},ue=()=>{u(!0),J()},fe=()=>{u(!1),J()},W=Q=>{Q==="home"?ee():Q==="analytics"&&console.log(" Navigate to Analytics Dashboard")};return S.jsxs("div",{className:"app",onClick:d?ne:q,children:[S.jsx(VJ,{onNavigate:W}),S.jsxs("div",{className:"app-background",children:[S.jsx("div",{className:"gradient-orb orb-1"}),S.jsx("div",{className:"gradient-orb orb-2"}),S.jsx("div",{className:"gradient-orb orb-3"}),S.jsx("div",{className:"grid-overlay"})]}),S.jsxs("header",{className:"app-header",style:{display:d?"none":"flex"},children:[S.jsxs(Ce.div,{className:"logo",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[S.jsx("div",{className:"logo-icon",children:""}),S.jsxs("div",{className:"logo-text",children:[S.jsx("h1",{children:"Lanna Polythentic College"}),S.jsx("p",{className:"logo-subtitle",children:"Uncover Your Future"})]})]}),S.jsx("div",{className:"header-actions",children:S.jsx("button",{className:"scholarships-btn",onClick:()=>h(!0),children:" Scholarships & Fees"})})]}),d&&S.jsx(IJ,{onInteraction:ne}),S.jsxs("main",{className:"app-main",style:{display:d?"none":"block"},children:[t==="home"&&S.jsx(Ce.div,{className:"home-page",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:S.jsxs("div",{className:"hero-content",children:[S.jsxs(Ce.h2,{className:"hero-title",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2},children:["",S.jsx("span",{className:"gradient-text",children:" "})]}),S.jsx(Ce.p,{className:"hero-subtitle",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.4},children:""}),S.jsx(Ce.div,{className:"scan-area",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.6},children:S.jsx(bJ,{onDetected:Y})}),S.jsx(Ce.button,{className:"btn-primary",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.8},onClick:()=>r("explore"),whileHover:{scale:1.05},whileTap:{scale:.95},children:""})]})}),t==="explore"&&S.jsx(Ce.div,{className:"explore-page",initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:g&&g>=3&&g<13?S.jsx(NJ,{careerSuggestions:i,onComplete:Q=>{av("clicked",R,{careers:Q,ageGroup:"KIDS_3_12"}),u(!0)}}):S.jsx(SJ,{suggestedInterests:i,onAvatarClick:ue})})]}),o&&S.jsx(CJ,{onClose:fe,interests:i}),c&&S.jsx(RJ,{onClose:()=>h(!1)}),N&&g&&S.jsx(PJ,{age:g,sessionId:R,sessionData:{age:g,gender:b,emotion:E,sessionId:R},onClose:()=>D(!1)}),!1,S.jsx("footer",{className:"app-footer",style:{display:d?"none":"block"},children:S.jsx("p",{children:" 2025 College Career Guide - Powered by AI & IoT"})})]})}EF.createRoot(document.getElementById("root")).render(S.jsx(mF.StrictMode,{children:S.jsx(FJ,{})}))});export default LJ();
