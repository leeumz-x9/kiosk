var OM=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var SY=OM((kY,dM)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function LM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var CS={exports:{}},bp={},SS={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yc=Symbol.for("react.element"),VM=Symbol.for("react.portal"),BM=Symbol.for("react.fragment"),jM=Symbol.for("react.strict_mode"),UM=Symbol.for("react.profiler"),WM=Symbol.for("react.provider"),zM=Symbol.for("react.context"),$M=Symbol.for("react.forward_ref"),HM=Symbol.for("react.suspense"),GM=Symbol.for("react.memo"),qM=Symbol.for("react.lazy"),Ax=Symbol.iterator;function KM(t){return t===null||typeof t!="object"?null:(t=Ax&&t[Ax]||t["@@iterator"],typeof t=="function"?t:null)}var TS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},IS=Object.assign,RS={};function Uu(t,e,n){this.props=t,this.context=e,this.refs=RS,this.updater=n||TS}Uu.prototype.isReactComponent={};Uu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Uu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function AS(){}AS.prototype=Uu.prototype;function b0(t,e,n){this.props=t,this.context=e,this.refs=RS,this.updater=n||TS}var E0=b0.prototype=new AS;E0.constructor=b0;IS(E0,Uu.prototype);E0.isPureReactComponent=!0;var kx=Array.isArray,kS=Object.prototype.hasOwnProperty,C0={current:null},PS={key:!0,ref:!0,__self:!0,__source:!0};function NS(t,e,n){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)kS.call(e,r)&&!PS.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var u=Array(a),l=0;l<a;l++)u[l]=arguments[l+2];i.children=u}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Yc,type:t,key:o,ref:s,props:i,_owner:C0.current}}function XM(t,e){return{$$typeof:Yc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function S0(t){return typeof t=="object"&&t!==null&&t.$$typeof===Yc}function YM(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Px=/\/+/g;function Wm(t,e){return typeof t=="object"&&t!==null&&t.key!=null?YM(""+t.key):e.toString(36)}function kf(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Yc:case VM:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+Wm(s,0):r,kx(i)?(n="",t!=null&&(n=t.replace(Px,"$&/")+"/"),kf(i,e,n,"",function(l){return l})):i!=null&&(S0(i)&&(i=XM(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(Px,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",kx(t))for(var a=0;a<t.length;a++){o=t[a];var u=r+Wm(o,a);s+=kf(o,e,n,u,i)}else if(u=KM(t),typeof u=="function")for(t=u.call(t),a=0;!(o=t.next()).done;)o=o.value,u=r+Wm(o,a++),s+=kf(o,e,n,u,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function jh(t,e,n){if(t==null)return t;var r=[],i=0;return kf(t,r,"","",function(o){return e.call(n,o,i++)}),r}function QM(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var jn={current:null},Pf={transition:null},JM={ReactCurrentDispatcher:jn,ReactCurrentBatchConfig:Pf,ReactCurrentOwner:C0};function DS(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:jh,forEach:function(t,e,n){jh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return jh(t,function(){e++}),e},toArray:function(t){return jh(t,function(e){return e})||[]},only:function(t){if(!S0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Oe.Component=Uu;Oe.Fragment=BM;Oe.Profiler=UM;Oe.PureComponent=b0;Oe.StrictMode=jM;Oe.Suspense=HM;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=JM;Oe.act=DS;Oe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=IS({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=C0.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(u in e)kS.call(e,u)&&!PS.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){a=Array(u);for(var l=0;l<u;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Yc,type:t.type,key:i,ref:o,props:r,_owner:s}};Oe.createContext=function(t){return t={$$typeof:zM,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:WM,_context:t},t.Consumer=t};Oe.createElement=NS;Oe.createFactory=function(t){var e=NS.bind(null,t);return e.type=t,e};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(t){return{$$typeof:$M,render:t}};Oe.isValidElement=S0;Oe.lazy=function(t){return{$$typeof:qM,_payload:{_status:-1,_result:t},_init:QM}};Oe.memo=function(t,e){return{$$typeof:GM,type:t,compare:e===void 0?null:e}};Oe.startTransition=function(t){var e=Pf.transition;Pf.transition={};try{t()}finally{Pf.transition=e}};Oe.unstable_act=DS;Oe.useCallback=function(t,e){return jn.current.useCallback(t,e)};Oe.useContext=function(t){return jn.current.useContext(t)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(t){return jn.current.useDeferredValue(t)};Oe.useEffect=function(t,e){return jn.current.useEffect(t,e)};Oe.useId=function(){return jn.current.useId()};Oe.useImperativeHandle=function(t,e,n){return jn.current.useImperativeHandle(t,e,n)};Oe.useInsertionEffect=function(t,e){return jn.current.useInsertionEffect(t,e)};Oe.useLayoutEffect=function(t,e){return jn.current.useLayoutEffect(t,e)};Oe.useMemo=function(t,e){return jn.current.useMemo(t,e)};Oe.useReducer=function(t,e,n){return jn.current.useReducer(t,e,n)};Oe.useRef=function(t){return jn.current.useRef(t)};Oe.useState=function(t){return jn.current.useState(t)};Oe.useSyncExternalStore=function(t,e,n){return jn.current.useSyncExternalStore(t,e,n)};Oe.useTransition=function(){return jn.current.useTransition()};Oe.version="18.3.1";SS.exports=Oe;var Y=SS.exports;const T0=LM(Y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZM=Y,e4=Symbol.for("react.element"),t4=Symbol.for("react.fragment"),n4=Object.prototype.hasOwnProperty,r4=ZM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i4={key:!0,ref:!0,__self:!0,__source:!0};function MS(t,e,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)n4.call(e,r)&&!i4.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:e4,type:t,key:o,ref:s,props:i,_owner:r4.current}}bp.Fragment=t4;bp.jsx=MS;bp.jsxs=MS;CS.exports=bp;var D=CS.exports,gv={},FS={exports:{}},_r={},OS={exports:{}},LS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,z){var U=V.length;V.push(z);e:for(;0<U;){var Q=U-1>>>1,te=V[Q];if(0<i(te,z))V[Q]=z,V[U]=te,U=Q;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var z=V[0],U=V.pop();if(U!==z){V[0]=U;e:for(var Q=0,te=V.length,ie=te>>>1;Q<ie;){var we=2*(Q+1)-1,_e=V[we],ce=we+1,be=V[ce];if(0>i(_e,U))ce<te&&0>i(be,_e)?(V[Q]=be,V[ce]=U,Q=ce):(V[Q]=_e,V[we]=U,Q=we);else if(ce<te&&0>i(be,U))V[Q]=be,V[ce]=U,Q=ce;else break e}}return z}function i(V,z){var U=V.sortIndex-z.sortIndex;return U!==0?U:V.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var u=[],l=[],c=1,h=null,f=3,d=!1,m=!1,v=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(V){for(var z=n(l);z!==null;){if(z.callback===null)r(l);else if(z.startTime<=V)r(l),z.sortIndex=z.expirationTime,e(u,z);else break;z=n(l)}}function x(V){if(v=!1,w(V),!m)if(n(u)!==null)m=!0,q(S);else{var z=n(l);z!==null&&X(x,z.startTime-V)}}function S(V,z){m=!1,v&&(v=!1,g(E),E=-1),d=!0;var U=f;try{for(w(z),h=n(u);h!==null&&(!(h.expirationTime>z)||V&&!P());){var Q=h.callback;if(typeof Q=="function"){h.callback=null,f=h.priorityLevel;var te=Q(h.expirationTime<=z);z=t.unstable_now(),typeof te=="function"?h.callback=te:h===n(u)&&r(u),w(z)}else r(u);h=n(u)}if(h!==null)var ie=!0;else{var we=n(l);we!==null&&X(x,we.startTime-z),ie=!1}return ie}finally{h=null,f=U,d=!1}}var A=!1,T=null,E=-1,C=5,I=-1;function P(){return!(t.unstable_now()-I<C)}function N(){if(T!==null){var V=t.unstable_now();I=V;var z=!0;try{z=T(!0,V)}finally{z?k():(A=!1,T=null)}}else A=!1}var k;if(typeof _=="function")k=function(){_(N)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,W=j.port2;j.port1.onmessage=N,k=function(){W.postMessage(null)}}else k=function(){y(N,0)};function q(V){T=V,A||(A=!0,k())}function X(V,z){E=y(function(){V(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){m||d||(m=!0,q(S))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(V){switch(f){case 1:case 2:case 3:var z=3;break;default:z=f}var U=f;f=z;try{return V()}finally{f=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,z){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var U=f;f=V;try{return z()}finally{f=U}},t.unstable_scheduleCallback=function(V,z,U){var Q=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?Q+U:Q):U=Q,V){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=U+te,V={id:c++,callback:z,priorityLevel:V,startTime:U,expirationTime:te,sortIndex:-1},U>Q?(V.sortIndex=U,e(l,V),n(u)===null&&V===n(l)&&(v?(g(E),E=-1):v=!0,X(x,U-Q))):(V.sortIndex=te,e(u,V),m||d||(m=!0,q(S))),V},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(V){var z=f;return function(){var U=f;f=z;try{return V.apply(this,arguments)}finally{f=U}}}})(LS);OS.exports=LS;var o4=OS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s4=Y,vr=o4;function re(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VS=new Set,fc={};function sa(t,e){_u(t,e),_u(t+"Capture",e)}function _u(t,e){for(fc[t]=e,t=0;t<e.length;t++)VS.add(e[t])}var Ki=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vv=Object.prototype.hasOwnProperty,a4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Nx={},Dx={};function u4(t){return vv.call(Dx,t)?!0:vv.call(Nx,t)?!1:a4.test(t)?Dx[t]=!0:(Nx[t]=!0,!1)}function l4(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function c4(t,e,n,r){if(e===null||typeof e>"u"||l4(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Un(t,e,n,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var mn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){mn[t]=new Un(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];mn[e]=new Un(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){mn[t]=new Un(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){mn[t]=new Un(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){mn[t]=new Un(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){mn[t]=new Un(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){mn[t]=new Un(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){mn[t]=new Un(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){mn[t]=new Un(t,5,!1,t.toLowerCase(),null,!1,!1)});var I0=/[\-:]([a-z])/g;function R0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(I0,R0);mn[e]=new Un(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(I0,R0);mn[e]=new Un(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(I0,R0);mn[e]=new Un(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){mn[t]=new Un(t,1,!1,t.toLowerCase(),null,!1,!1)});mn.xlinkHref=new Un("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){mn[t]=new Un(t,1,!1,t.toLowerCase(),null,!0,!0)});function A0(t,e,n,r){var i=mn.hasOwnProperty(e)?mn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(c4(e,n,i,r)&&(n=null),r||i===null?u4(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var to=s4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Uh=Symbol.for("react.element"),Oa=Symbol.for("react.portal"),La=Symbol.for("react.fragment"),k0=Symbol.for("react.strict_mode"),yv=Symbol.for("react.profiler"),BS=Symbol.for("react.provider"),jS=Symbol.for("react.context"),P0=Symbol.for("react.forward_ref"),_v=Symbol.for("react.suspense"),wv=Symbol.for("react.suspense_list"),N0=Symbol.for("react.memo"),xo=Symbol.for("react.lazy"),US=Symbol.for("react.offscreen"),Mx=Symbol.iterator;function pl(t){return t===null||typeof t!="object"?null:(t=Mx&&t[Mx]||t["@@iterator"],typeof t=="function"?t:null)}var Ct=Object.assign,zm;function Ml(t){if(zm===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);zm=e&&e[1]||""}return`
`+zm+t}var $m=!1;function Hm(t,e){if(!t||$m)return"";$m=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var u=`
`+i[s].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=s&&0<=a);break}}}finally{$m=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ml(t):""}function h4(t){switch(t.tag){case 5:return Ml(t.type);case 16:return Ml("Lazy");case 13:return Ml("Suspense");case 19:return Ml("SuspenseList");case 0:case 2:case 15:return t=Hm(t.type,!1),t;case 11:return t=Hm(t.type.render,!1),t;case 1:return t=Hm(t.type,!0),t;default:return""}}function xv(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case La:return"Fragment";case Oa:return"Portal";case yv:return"Profiler";case k0:return"StrictMode";case _v:return"Suspense";case wv:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case jS:return(t.displayName||"Context")+".Consumer";case BS:return(t._context.displayName||"Context")+".Provider";case P0:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case N0:return e=t.displayName||null,e!==null?e:xv(t.type)||"Memo";case xo:e=t._payload,t=t._init;try{return xv(t(e))}catch{}}return null}function f4(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xv(e);case 8:return e===k0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ko(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function WS(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function d4(t){var e=WS(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Wh(t){t._valueTracker||(t._valueTracker=d4(t))}function zS(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=WS(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Qf(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function bv(t,e){var n=e.checked;return Ct({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Fx(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ko(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $S(t,e){e=e.checked,e!=null&&A0(t,"checked",e,!1)}function Ev(t,e){$S(t,e);var n=Ko(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Cv(t,e.type,n):e.hasOwnProperty("defaultValue")&&Cv(t,e.type,Ko(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Ox(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Cv(t,e,n){(e!=="number"||Qf(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Fl=Array.isArray;function eu(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ko(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Sv(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(re(91));return Ct({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Lx(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(re(92));if(Fl(n)){if(1<n.length)throw Error(re(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ko(n)}}function HS(t,e){var n=Ko(e.value),r=Ko(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Vx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function GS(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Tv(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?GS(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var zh,qS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(zh=zh||document.createElement("div"),zh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=zh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function dc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var jl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},p4=["Webkit","ms","Moz","O"];Object.keys(jl).forEach(function(t){p4.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),jl[e]=jl[t]})});function KS(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||jl.hasOwnProperty(t)&&jl[t]?(""+e).trim():e+"px"}function XS(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=KS(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var m4=Ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Iv(t,e){if(e){if(m4[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(re(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(re(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(re(61))}if(e.style!=null&&typeof e.style!="object")throw Error(re(62))}}function Rv(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Av=null;function D0(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var kv=null,tu=null,nu=null;function Bx(t){if(t=Zc(t)){if(typeof kv!="function")throw Error(re(280));var e=t.stateNode;e&&(e=Ip(e),kv(t.stateNode,t.type,e))}}function YS(t){tu?nu?nu.push(t):nu=[t]:tu=t}function QS(){if(tu){var t=tu,e=nu;if(nu=tu=null,Bx(t),e)for(t=0;t<e.length;t++)Bx(e[t])}}function JS(t,e){return t(e)}function ZS(){}var Gm=!1;function eT(t,e,n){if(Gm)return t(e,n);Gm=!0;try{return JS(t,e,n)}finally{Gm=!1,(tu!==null||nu!==null)&&(ZS(),QS())}}function pc(t,e){var n=t.stateNode;if(n===null)return null;var r=Ip(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(re(231,e,typeof n));return n}var Pv=!1;if(Ki)try{var ml={};Object.defineProperty(ml,"passive",{get:function(){Pv=!0}}),window.addEventListener("test",ml,ml),window.removeEventListener("test",ml,ml)}catch{Pv=!1}function g4(t,e,n,r,i,o,s,a,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(c){this.onError(c)}}var Ul=!1,Jf=null,Zf=!1,Nv=null,v4={onError:function(t){Ul=!0,Jf=t}};function y4(t,e,n,r,i,o,s,a,u){Ul=!1,Jf=null,g4.apply(v4,arguments)}function _4(t,e,n,r,i,o,s,a,u){if(y4.apply(this,arguments),Ul){if(Ul){var l=Jf;Ul=!1,Jf=null}else throw Error(re(198));Zf||(Zf=!0,Nv=l)}}function aa(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function tT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function jx(t){if(aa(t)!==t)throw Error(re(188))}function w4(t){var e=t.alternate;if(!e){if(e=aa(t),e===null)throw Error(re(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return jx(i),t;if(o===r)return jx(i),e;o=o.sibling}throw Error(re(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s)throw Error(re(189))}}if(n.alternate!==r)throw Error(re(190))}if(n.tag!==3)throw Error(re(188));return n.stateNode.current===n?t:e}function nT(t){return t=w4(t),t!==null?rT(t):null}function rT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=rT(t);if(e!==null)return e;t=t.sibling}return null}var iT=vr.unstable_scheduleCallback,Ux=vr.unstable_cancelCallback,x4=vr.unstable_shouldYield,b4=vr.unstable_requestPaint,Pt=vr.unstable_now,E4=vr.unstable_getCurrentPriorityLevel,M0=vr.unstable_ImmediatePriority,oT=vr.unstable_UserBlockingPriority,ed=vr.unstable_NormalPriority,C4=vr.unstable_LowPriority,sT=vr.unstable_IdlePriority,Ep=null,gi=null;function S4(t){if(gi&&typeof gi.onCommitFiberRoot=="function")try{gi.onCommitFiberRoot(Ep,t,void 0,(t.current.flags&128)===128)}catch{}}var Kr=Math.clz32?Math.clz32:R4,T4=Math.log,I4=Math.LN2;function R4(t){return t>>>=0,t===0?32:31-(T4(t)/I4|0)|0}var $h=64,Hh=4194304;function Ol(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function td(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~i;a!==0?r=Ol(a):(o&=s,o!==0&&(r=Ol(o)))}else s=n&~i,s!==0?r=Ol(s):o!==0&&(r=Ol(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Kr(e),i=1<<n,r|=t[n],e&=~i;return r}function A4(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function k4(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-Kr(o),a=1<<s,u=i[s];u===-1?(!(a&n)||a&r)&&(i[s]=A4(a,e)):u<=e&&(t.expiredLanes|=a),o&=~a}}function Dv(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function aT(){var t=$h;return $h<<=1,!($h&4194240)&&($h=64),t}function qm(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Qc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Kr(e),t[e]=n}function P4(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Kr(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function F0(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Kr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Je=0;function uT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var lT,O0,cT,hT,fT,Mv=!1,Gh=[],ko=null,Po=null,No=null,mc=new Map,gc=new Map,Co=[],N4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wx(t,e){switch(t){case"focusin":case"focusout":ko=null;break;case"dragenter":case"dragleave":Po=null;break;case"mouseover":case"mouseout":No=null;break;case"pointerover":case"pointerout":mc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gc.delete(e.pointerId)}}function gl(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=Zc(e),e!==null&&O0(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function D4(t,e,n,r,i){switch(e){case"focusin":return ko=gl(ko,t,e,n,r,i),!0;case"dragenter":return Po=gl(Po,t,e,n,r,i),!0;case"mouseover":return No=gl(No,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return mc.set(o,gl(mc.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,gc.set(o,gl(gc.get(o)||null,t,e,n,r,i)),!0}return!1}function dT(t){var e=Ps(t.target);if(e!==null){var n=aa(e);if(n!==null){if(e=n.tag,e===13){if(e=tT(n),e!==null){t.blockedOn=e,fT(t.priority,function(){cT(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Nf(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Fv(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Av=r,n.target.dispatchEvent(r),Av=null}else return e=Zc(n),e!==null&&O0(e),t.blockedOn=n,!1;e.shift()}return!0}function zx(t,e,n){Nf(t)&&n.delete(e)}function M4(){Mv=!1,ko!==null&&Nf(ko)&&(ko=null),Po!==null&&Nf(Po)&&(Po=null),No!==null&&Nf(No)&&(No=null),mc.forEach(zx),gc.forEach(zx)}function vl(t,e){t.blockedOn===e&&(t.blockedOn=null,Mv||(Mv=!0,vr.unstable_scheduleCallback(vr.unstable_NormalPriority,M4)))}function vc(t){function e(i){return vl(i,t)}if(0<Gh.length){vl(Gh[0],t);for(var n=1;n<Gh.length;n++){var r=Gh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ko!==null&&vl(ko,t),Po!==null&&vl(Po,t),No!==null&&vl(No,t),mc.forEach(e),gc.forEach(e),n=0;n<Co.length;n++)r=Co[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Co.length&&(n=Co[0],n.blockedOn===null);)dT(n),n.blockedOn===null&&Co.shift()}var ru=to.ReactCurrentBatchConfig,nd=!0;function F4(t,e,n,r){var i=Je,o=ru.transition;ru.transition=null;try{Je=1,L0(t,e,n,r)}finally{Je=i,ru.transition=o}}function O4(t,e,n,r){var i=Je,o=ru.transition;ru.transition=null;try{Je=4,L0(t,e,n,r)}finally{Je=i,ru.transition=o}}function L0(t,e,n,r){if(nd){var i=Fv(t,e,n,r);if(i===null)rg(t,e,r,rd,n),Wx(t,r);else if(D4(i,t,e,n,r))r.stopPropagation();else if(Wx(t,r),e&4&&-1<N4.indexOf(t)){for(;i!==null;){var o=Zc(i);if(o!==null&&lT(o),o=Fv(t,e,n,r),o===null&&rg(t,e,r,rd,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else rg(t,e,r,null,n)}}var rd=null;function Fv(t,e,n,r){if(rd=null,t=D0(r),t=Ps(t),t!==null)if(e=aa(t),e===null)t=null;else if(n=e.tag,n===13){if(t=tT(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return rd=t,null}function pT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(E4()){case M0:return 1;case oT:return 4;case ed:case C4:return 16;case sT:return 536870912;default:return 16}default:return 16}}var To=null,V0=null,Df=null;function mT(){if(Df)return Df;var t,e=V0,n=e.length,r,i="value"in To?To.value:To.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[o-r];r++);return Df=i.slice(t,1<r?1-r:void 0)}function Mf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function qh(){return!0}function $x(){return!1}function wr(t){function e(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?qh:$x,this.isPropagationStopped=$x,this}return Ct(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=qh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=qh)},persist:function(){},isPersistent:qh}),e}var Wu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},B0=wr(Wu),Jc=Ct({},Wu,{view:0,detail:0}),L4=wr(Jc),Km,Xm,yl,Cp=Ct({},Jc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:j0,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yl&&(yl&&t.type==="mousemove"?(Km=t.screenX-yl.screenX,Xm=t.screenY-yl.screenY):Xm=Km=0,yl=t),Km)},movementY:function(t){return"movementY"in t?t.movementY:Xm}}),Hx=wr(Cp),V4=Ct({},Cp,{dataTransfer:0}),B4=wr(V4),j4=Ct({},Jc,{relatedTarget:0}),Ym=wr(j4),U4=Ct({},Wu,{animationName:0,elapsedTime:0,pseudoElement:0}),W4=wr(U4),z4=Ct({},Wu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),$4=wr(z4),H4=Ct({},Wu,{data:0}),Gx=wr(H4),G4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},q4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},K4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function X4(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=K4[t])?!!e[t]:!1}function j0(){return X4}var Y4=Ct({},Jc,{key:function(t){if(t.key){var e=G4[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Mf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?q4[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:j0,charCode:function(t){return t.type==="keypress"?Mf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Mf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Q4=wr(Y4),J4=Ct({},Cp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qx=wr(J4),Z4=Ct({},Jc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:j0}),e3=wr(Z4),t3=Ct({},Wu,{propertyName:0,elapsedTime:0,pseudoElement:0}),n3=wr(t3),r3=Ct({},Cp,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),i3=wr(r3),o3=[9,13,27,32],U0=Ki&&"CompositionEvent"in window,Wl=null;Ki&&"documentMode"in document&&(Wl=document.documentMode);var s3=Ki&&"TextEvent"in window&&!Wl,gT=Ki&&(!U0||Wl&&8<Wl&&11>=Wl),Kx=" ",Xx=!1;function vT(t,e){switch(t){case"keyup":return o3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yT(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Va=!1;function a3(t,e){switch(t){case"compositionend":return yT(e);case"keypress":return e.which!==32?null:(Xx=!0,Kx);case"textInput":return t=e.data,t===Kx&&Xx?null:t;default:return null}}function u3(t,e){if(Va)return t==="compositionend"||!U0&&vT(t,e)?(t=mT(),Df=V0=To=null,Va=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return gT&&e.locale!=="ko"?null:e.data;default:return null}}var l3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!l3[t.type]:e==="textarea"}function _T(t,e,n,r){YS(r),e=id(e,"onChange"),0<e.length&&(n=new B0("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var zl=null,yc=null;function c3(t){kT(t,0)}function Sp(t){var e=Ua(t);if(zS(e))return t}function h3(t,e){if(t==="change")return e}var wT=!1;if(Ki){var Qm;if(Ki){var Jm="oninput"in document;if(!Jm){var Qx=document.createElement("div");Qx.setAttribute("oninput","return;"),Jm=typeof Qx.oninput=="function"}Qm=Jm}else Qm=!1;wT=Qm&&(!document.documentMode||9<document.documentMode)}function Jx(){zl&&(zl.detachEvent("onpropertychange",xT),yc=zl=null)}function xT(t){if(t.propertyName==="value"&&Sp(yc)){var e=[];_T(e,yc,t,D0(t)),eT(c3,e)}}function f3(t,e,n){t==="focusin"?(Jx(),zl=e,yc=n,zl.attachEvent("onpropertychange",xT)):t==="focusout"&&Jx()}function d3(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Sp(yc)}function p3(t,e){if(t==="click")return Sp(e)}function m3(t,e){if(t==="input"||t==="change")return Sp(e)}function g3(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Jr=typeof Object.is=="function"?Object.is:g3;function _c(t,e){if(Jr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!vv.call(e,i)||!Jr(t[i],e[i]))return!1}return!0}function Zx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function eb(t,e){var n=Zx(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Zx(n)}}function bT(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?bT(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ET(){for(var t=window,e=Qf();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qf(t.document)}return e}function W0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function v3(t){var e=ET(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&bT(n.ownerDocument.documentElement,n)){if(r!==null&&W0(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=eb(n,o);var s=eb(n,r);i&&s&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var y3=Ki&&"documentMode"in document&&11>=document.documentMode,Ba=null,Ov=null,$l=null,Lv=!1;function tb(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lv||Ba==null||Ba!==Qf(r)||(r=Ba,"selectionStart"in r&&W0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),$l&&_c($l,r)||($l=r,r=id(Ov,"onSelect"),0<r.length&&(e=new B0("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ba)))}function Kh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ja={animationend:Kh("Animation","AnimationEnd"),animationiteration:Kh("Animation","AnimationIteration"),animationstart:Kh("Animation","AnimationStart"),transitionend:Kh("Transition","TransitionEnd")},Zm={},CT={};Ki&&(CT=document.createElement("div").style,"AnimationEvent"in window||(delete ja.animationend.animation,delete ja.animationiteration.animation,delete ja.animationstart.animation),"TransitionEvent"in window||delete ja.transitionend.transition);function Tp(t){if(Zm[t])return Zm[t];if(!ja[t])return t;var e=ja[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in CT)return Zm[t]=e[n];return t}var ST=Tp("animationend"),TT=Tp("animationiteration"),IT=Tp("animationstart"),RT=Tp("transitionend"),AT=new Map,nb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function os(t,e){AT.set(t,e),sa(e,[t])}for(var eg=0;eg<nb.length;eg++){var tg=nb[eg],_3=tg.toLowerCase(),w3=tg[0].toUpperCase()+tg.slice(1);os(_3,"on"+w3)}os(ST,"onAnimationEnd");os(TT,"onAnimationIteration");os(IT,"onAnimationStart");os("dblclick","onDoubleClick");os("focusin","onFocus");os("focusout","onBlur");os(RT,"onTransitionEnd");_u("onMouseEnter",["mouseout","mouseover"]);_u("onMouseLeave",["mouseout","mouseover"]);_u("onPointerEnter",["pointerout","pointerover"]);_u("onPointerLeave",["pointerout","pointerover"]);sa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sa("onBeforeInput",["compositionend","keypress","textInput","paste"]);sa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ll="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),x3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ll));function rb(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,_4(r,e,void 0,t),t.currentTarget=null}function kT(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],u=a.instance,l=a.currentTarget;if(a=a.listener,u!==o&&i.isPropagationStopped())break e;rb(i,a,l),o=u}else for(s=0;s<r.length;s++){if(a=r[s],u=a.instance,l=a.currentTarget,a=a.listener,u!==o&&i.isPropagationStopped())break e;rb(i,a,l),o=u}}}if(Zf)throw t=Nv,Zf=!1,Nv=null,t}function lt(t,e){var n=e[Wv];n===void 0&&(n=e[Wv]=new Set);var r=t+"__bubble";n.has(r)||(PT(e,t,2,!1),n.add(r))}function ng(t,e,n){var r=0;e&&(r|=4),PT(n,t,r,e)}var Xh="_reactListening"+Math.random().toString(36).slice(2);function wc(t){if(!t[Xh]){t[Xh]=!0,VS.forEach(function(n){n!=="selectionchange"&&(x3.has(n)||ng(n,!1,t),ng(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Xh]||(e[Xh]=!0,ng("selectionchange",!1,e))}}function PT(t,e,n,r){switch(pT(e)){case 1:var i=F4;break;case 4:i=O4;break;default:i=L0}n=i.bind(null,e,n,t),i=void 0,!Pv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function rg(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var u=s.tag;if((u===3||u===4)&&(u=s.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;s=s.return}for(;a!==null;){if(s=Ps(a),s===null)return;if(u=s.tag,u===5||u===6){r=o=s;continue e}a=a.parentNode}}r=r.return}eT(function(){var l=o,c=D0(n),h=[];e:{var f=AT.get(t);if(f!==void 0){var d=B0,m=t;switch(t){case"keypress":if(Mf(n)===0)break e;case"keydown":case"keyup":d=Q4;break;case"focusin":m="focus",d=Ym;break;case"focusout":m="blur",d=Ym;break;case"beforeblur":case"afterblur":d=Ym;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Hx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=B4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=e3;break;case ST:case TT:case IT:d=W4;break;case RT:d=n3;break;case"scroll":d=L4;break;case"wheel":d=i3;break;case"copy":case"cut":case"paste":d=$4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=qx}var v=(e&4)!==0,y=!v&&t==="scroll",g=v?f!==null?f+"Capture":null:f;v=[];for(var _=l,w;_!==null;){w=_;var x=w.stateNode;if(w.tag===5&&x!==null&&(w=x,g!==null&&(x=pc(_,g),x!=null&&v.push(xc(_,x,w)))),y)break;_=_.return}0<v.length&&(f=new d(f,m,null,n,c),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",f&&n!==Av&&(m=n.relatedTarget||n.fromElement)&&(Ps(m)||m[Xi]))break e;if((d||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,d?(m=n.relatedTarget||n.toElement,d=l,m=m?Ps(m):null,m!==null&&(y=aa(m),m!==y||m.tag!==5&&m.tag!==6)&&(m=null)):(d=null,m=l),d!==m)){if(v=Hx,x="onMouseLeave",g="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(v=qx,x="onPointerLeave",g="onPointerEnter",_="pointer"),y=d==null?f:Ua(d),w=m==null?f:Ua(m),f=new v(x,_+"leave",d,n,c),f.target=y,f.relatedTarget=w,x=null,Ps(c)===l&&(v=new v(g,_+"enter",m,n,c),v.target=w,v.relatedTarget=y,x=v),y=x,d&&m)t:{for(v=d,g=m,_=0,w=v;w;w=Ea(w))_++;for(w=0,x=g;x;x=Ea(x))w++;for(;0<_-w;)v=Ea(v),_--;for(;0<w-_;)g=Ea(g),w--;for(;_--;){if(v===g||g!==null&&v===g.alternate)break t;v=Ea(v),g=Ea(g)}v=null}else v=null;d!==null&&ib(h,f,d,v,!1),m!==null&&y!==null&&ib(h,y,m,v,!0)}}e:{if(f=l?Ua(l):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var S=h3;else if(Yx(f))if(wT)S=m3;else{S=d3;var A=f3}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=p3);if(S&&(S=S(t,l))){_T(h,S,n,c);break e}A&&A(t,f,l),t==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&Cv(f,"number",f.value)}switch(A=l?Ua(l):window,t){case"focusin":(Yx(A)||A.contentEditable==="true")&&(Ba=A,Ov=l,$l=null);break;case"focusout":$l=Ov=Ba=null;break;case"mousedown":Lv=!0;break;case"contextmenu":case"mouseup":case"dragend":Lv=!1,tb(h,n,c);break;case"selectionchange":if(y3)break;case"keydown":case"keyup":tb(h,n,c)}var T;if(U0)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Va?vT(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(gT&&n.locale!=="ko"&&(Va||E!=="onCompositionStart"?E==="onCompositionEnd"&&Va&&(T=mT()):(To=c,V0="value"in To?To.value:To.textContent,Va=!0)),A=id(l,E),0<A.length&&(E=new Gx(E,t,null,n,c),h.push({event:E,listeners:A}),T?E.data=T:(T=yT(n),T!==null&&(E.data=T)))),(T=s3?a3(t,n):u3(t,n))&&(l=id(l,"onBeforeInput"),0<l.length&&(c=new Gx("onBeforeInput","beforeinput",null,n,c),h.push({event:c,listeners:l}),c.data=T))}kT(h,e)})}function xc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function id(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=pc(t,n),o!=null&&r.unshift(xc(t,o,i)),o=pc(t,e),o!=null&&r.push(xc(t,o,i))),t=t.return}return r}function Ea(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ib(t,e,n,r,i){for(var o=e._reactName,s=[];n!==null&&n!==r;){var a=n,u=a.alternate,l=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&l!==null&&(a=l,i?(u=pc(n,o),u!=null&&s.unshift(xc(n,u,a))):i||(u=pc(n,o),u!=null&&s.push(xc(n,u,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var b3=/\r\n?/g,E3=/\u0000|\uFFFD/g;function ob(t){return(typeof t=="string"?t:""+t).replace(b3,`
`).replace(E3,"")}function Yh(t,e,n){if(e=ob(e),ob(t)!==e&&n)throw Error(re(425))}function od(){}var Vv=null,Bv=null;function jv(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Uv=typeof setTimeout=="function"?setTimeout:void 0,C3=typeof clearTimeout=="function"?clearTimeout:void 0,sb=typeof Promise=="function"?Promise:void 0,S3=typeof queueMicrotask=="function"?queueMicrotask:typeof sb<"u"?function(t){return sb.resolve(null).then(t).catch(T3)}:Uv;function T3(t){setTimeout(function(){throw t})}function ig(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),vc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);vc(e)}function Do(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ab(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var zu=Math.random().toString(36).slice(2),hi="__reactFiber$"+zu,bc="__reactProps$"+zu,Xi="__reactContainer$"+zu,Wv="__reactEvents$"+zu,I3="__reactListeners$"+zu,R3="__reactHandles$"+zu;function Ps(t){var e=t[hi];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Xi]||n[hi]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=ab(t);t!==null;){if(n=t[hi])return n;t=ab(t)}return e}t=n,n=t.parentNode}return null}function Zc(t){return t=t[hi]||t[Xi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ua(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(re(33))}function Ip(t){return t[bc]||null}var zv=[],Wa=-1;function ss(t){return{current:t}}function dt(t){0>Wa||(t.current=zv[Wa],zv[Wa]=null,Wa--)}function nt(t,e){Wa++,zv[Wa]=t.current,t.current=e}var Xo={},Nn=ss(Xo),Jn=ss(!1),Hs=Xo;function wu(t,e){var n=t.type.contextTypes;if(!n)return Xo;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Zn(t){return t=t.childContextTypes,t!=null}function sd(){dt(Jn),dt(Nn)}function ub(t,e,n){if(Nn.current!==Xo)throw Error(re(168));nt(Nn,e),nt(Jn,n)}function NT(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(re(108,f4(t)||"Unknown",i));return Ct({},n,r)}function ad(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Xo,Hs=Nn.current,nt(Nn,t),nt(Jn,Jn.current),!0}function lb(t,e,n){var r=t.stateNode;if(!r)throw Error(re(169));n?(t=NT(t,e,Hs),r.__reactInternalMemoizedMergedChildContext=t,dt(Jn),dt(Nn),nt(Nn,t)):dt(Jn),nt(Jn,n)}var Fi=null,Rp=!1,og=!1;function DT(t){Fi===null?Fi=[t]:Fi.push(t)}function A3(t){Rp=!0,DT(t)}function as(){if(!og&&Fi!==null){og=!0;var t=0,e=Je;try{var n=Fi;for(Je=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Fi=null,Rp=!1}catch(i){throw Fi!==null&&(Fi=Fi.slice(t+1)),iT(M0,as),i}finally{Je=e,og=!1}}return null}var za=[],$a=0,ud=null,ld=0,Cr=[],Sr=0,Gs=null,Li=1,Vi="";function xs(t,e){za[$a++]=ld,za[$a++]=ud,ud=t,ld=e}function MT(t,e,n){Cr[Sr++]=Li,Cr[Sr++]=Vi,Cr[Sr++]=Gs,Gs=t;var r=Li;t=Vi;var i=32-Kr(r)-1;r&=~(1<<i),n+=1;var o=32-Kr(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Li=1<<32-Kr(e)+i|n<<i|r,Vi=o+t}else Li=1<<o|n<<i|r,Vi=t}function z0(t){t.return!==null&&(xs(t,1),MT(t,1,0))}function $0(t){for(;t===ud;)ud=za[--$a],za[$a]=null,ld=za[--$a],za[$a]=null;for(;t===Gs;)Gs=Cr[--Sr],Cr[Sr]=null,Vi=Cr[--Sr],Cr[Sr]=null,Li=Cr[--Sr],Cr[Sr]=null}var pr=null,cr=null,gt=!1,Br=null;function FT(t,e){var n=Rr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function cb(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,pr=t,cr=Do(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,pr=t,cr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Gs!==null?{id:Li,overflow:Vi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Rr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,pr=t,cr=null,!0):!1;default:return!1}}function $v(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Hv(t){if(gt){var e=cr;if(e){var n=e;if(!cb(t,e)){if($v(t))throw Error(re(418));e=Do(n.nextSibling);var r=pr;e&&cb(t,e)?FT(r,n):(t.flags=t.flags&-4097|2,gt=!1,pr=t)}}else{if($v(t))throw Error(re(418));t.flags=t.flags&-4097|2,gt=!1,pr=t}}}function hb(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pr=t}function Qh(t){if(t!==pr)return!1;if(!gt)return hb(t),gt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!jv(t.type,t.memoizedProps)),e&&(e=cr)){if($v(t))throw OT(),Error(re(418));for(;e;)FT(t,e),e=Do(e.nextSibling)}if(hb(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(re(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){cr=Do(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}cr=null}}else cr=pr?Do(t.stateNode.nextSibling):null;return!0}function OT(){for(var t=cr;t;)t=Do(t.nextSibling)}function xu(){cr=pr=null,gt=!1}function H0(t){Br===null?Br=[t]:Br.push(t)}var k3=to.ReactCurrentBatchConfig;function _l(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(re(309));var r=n.stateNode}if(!r)throw Error(re(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(re(284));if(!n._owner)throw Error(re(290,t))}return t}function Jh(t,e){throw t=Object.prototype.toString.call(e),Error(re(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fb(t){var e=t._init;return e(t._payload)}function LT(t){function e(g,_){if(t){var w=g.deletions;w===null?(g.deletions=[_],g.flags|=16):w.push(_)}}function n(g,_){if(!t)return null;for(;_!==null;)e(g,_),_=_.sibling;return null}function r(g,_){for(g=new Map;_!==null;)_.key!==null?g.set(_.key,_):g.set(_.index,_),_=_.sibling;return g}function i(g,_){return g=Lo(g,_),g.index=0,g.sibling=null,g}function o(g,_,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<_?(g.flags|=2,_):w):(g.flags|=2,_)):(g.flags|=1048576,_)}function s(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,_,w,x){return _===null||_.tag!==6?(_=fg(w,g.mode,x),_.return=g,_):(_=i(_,w),_.return=g,_)}function u(g,_,w,x){var S=w.type;return S===La?c(g,_,w.props.children,x,w.key):_!==null&&(_.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===xo&&fb(S)===_.type)?(x=i(_,w.props),x.ref=_l(g,_,w),x.return=g,x):(x=Uf(w.type,w.key,w.props,null,g.mode,x),x.ref=_l(g,_,w),x.return=g,x)}function l(g,_,w,x){return _===null||_.tag!==4||_.stateNode.containerInfo!==w.containerInfo||_.stateNode.implementation!==w.implementation?(_=dg(w,g.mode,x),_.return=g,_):(_=i(_,w.children||[]),_.return=g,_)}function c(g,_,w,x,S){return _===null||_.tag!==7?(_=js(w,g.mode,x,S),_.return=g,_):(_=i(_,w),_.return=g,_)}function h(g,_,w){if(typeof _=="string"&&_!==""||typeof _=="number")return _=fg(""+_,g.mode,w),_.return=g,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Uh:return w=Uf(_.type,_.key,_.props,null,g.mode,w),w.ref=_l(g,null,_),w.return=g,w;case Oa:return _=dg(_,g.mode,w),_.return=g,_;case xo:var x=_._init;return h(g,x(_._payload),w)}if(Fl(_)||pl(_))return _=js(_,g.mode,w,null),_.return=g,_;Jh(g,_)}return null}function f(g,_,w,x){var S=_!==null?_.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return S!==null?null:a(g,_,""+w,x);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Uh:return w.key===S?u(g,_,w,x):null;case Oa:return w.key===S?l(g,_,w,x):null;case xo:return S=w._init,f(g,_,S(w._payload),x)}if(Fl(w)||pl(w))return S!==null?null:c(g,_,w,x,null);Jh(g,w)}return null}function d(g,_,w,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(w)||null,a(_,g,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Uh:return g=g.get(x.key===null?w:x.key)||null,u(_,g,x,S);case Oa:return g=g.get(x.key===null?w:x.key)||null,l(_,g,x,S);case xo:var A=x._init;return d(g,_,w,A(x._payload),S)}if(Fl(x)||pl(x))return g=g.get(w)||null,c(_,g,x,S,null);Jh(_,x)}return null}function m(g,_,w,x){for(var S=null,A=null,T=_,E=_=0,C=null;T!==null&&E<w.length;E++){T.index>E?(C=T,T=null):C=T.sibling;var I=f(g,T,w[E],x);if(I===null){T===null&&(T=C);break}t&&T&&I.alternate===null&&e(g,T),_=o(I,_,E),A===null?S=I:A.sibling=I,A=I,T=C}if(E===w.length)return n(g,T),gt&&xs(g,E),S;if(T===null){for(;E<w.length;E++)T=h(g,w[E],x),T!==null&&(_=o(T,_,E),A===null?S=T:A.sibling=T,A=T);return gt&&xs(g,E),S}for(T=r(g,T);E<w.length;E++)C=d(T,g,E,w[E],x),C!==null&&(t&&C.alternate!==null&&T.delete(C.key===null?E:C.key),_=o(C,_,E),A===null?S=C:A.sibling=C,A=C);return t&&T.forEach(function(P){return e(g,P)}),gt&&xs(g,E),S}function v(g,_,w,x){var S=pl(w);if(typeof S!="function")throw Error(re(150));if(w=S.call(w),w==null)throw Error(re(151));for(var A=S=null,T=_,E=_=0,C=null,I=w.next();T!==null&&!I.done;E++,I=w.next()){T.index>E?(C=T,T=null):C=T.sibling;var P=f(g,T,I.value,x);if(P===null){T===null&&(T=C);break}t&&T&&P.alternate===null&&e(g,T),_=o(P,_,E),A===null?S=P:A.sibling=P,A=P,T=C}if(I.done)return n(g,T),gt&&xs(g,E),S;if(T===null){for(;!I.done;E++,I=w.next())I=h(g,I.value,x),I!==null&&(_=o(I,_,E),A===null?S=I:A.sibling=I,A=I);return gt&&xs(g,E),S}for(T=r(g,T);!I.done;E++,I=w.next())I=d(T,g,E,I.value,x),I!==null&&(t&&I.alternate!==null&&T.delete(I.key===null?E:I.key),_=o(I,_,E),A===null?S=I:A.sibling=I,A=I);return t&&T.forEach(function(N){return e(g,N)}),gt&&xs(g,E),S}function y(g,_,w,x){if(typeof w=="object"&&w!==null&&w.type===La&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Uh:e:{for(var S=w.key,A=_;A!==null;){if(A.key===S){if(S=w.type,S===La){if(A.tag===7){n(g,A.sibling),_=i(A,w.props.children),_.return=g,g=_;break e}}else if(A.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===xo&&fb(S)===A.type){n(g,A.sibling),_=i(A,w.props),_.ref=_l(g,A,w),_.return=g,g=_;break e}n(g,A);break}else e(g,A);A=A.sibling}w.type===La?(_=js(w.props.children,g.mode,x,w.key),_.return=g,g=_):(x=Uf(w.type,w.key,w.props,null,g.mode,x),x.ref=_l(g,_,w),x.return=g,g=x)}return s(g);case Oa:e:{for(A=w.key;_!==null;){if(_.key===A)if(_.tag===4&&_.stateNode.containerInfo===w.containerInfo&&_.stateNode.implementation===w.implementation){n(g,_.sibling),_=i(_,w.children||[]),_.return=g,g=_;break e}else{n(g,_);break}else e(g,_);_=_.sibling}_=dg(w,g.mode,x),_.return=g,g=_}return s(g);case xo:return A=w._init,y(g,_,A(w._payload),x)}if(Fl(w))return m(g,_,w,x);if(pl(w))return v(g,_,w,x);Jh(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,_!==null&&_.tag===6?(n(g,_.sibling),_=i(_,w),_.return=g,g=_):(n(g,_),_=fg(w,g.mode,x),_.return=g,g=_),s(g)):n(g,_)}return y}var bu=LT(!0),VT=LT(!1),cd=ss(null),hd=null,Ha=null,G0=null;function q0(){G0=Ha=hd=null}function K0(t){var e=cd.current;dt(cd),t._currentValue=e}function Gv(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function iu(t,e){hd=t,G0=Ha=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Yn=!0),t.firstContext=null)}function Nr(t){var e=t._currentValue;if(G0!==t)if(t={context:t,memoizedValue:e,next:null},Ha===null){if(hd===null)throw Error(re(308));Ha=t,hd.dependencies={lanes:0,firstContext:t}}else Ha=Ha.next=t;return e}var Ns=null;function X0(t){Ns===null?Ns=[t]:Ns.push(t)}function BT(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,X0(e)):(n.next=i.next,i.next=n),e.interleaved=n,Yi(t,r)}function Yi(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var bo=!1;function Y0(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jT(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ui(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Mo(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,He&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Yi(t,n)}return i=r.interleaved,i===null?(e.next=e,X0(r)):(e.next=i.next,i.next=e),r.interleaved=e,Yi(t,n)}function Ff(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,F0(t,n)}}function db(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function fd(t,e,n,r){var i=t.updateQueue;bo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var u=a,l=u.next;u.next=null,s===null?o=l:s.next=l,s=u;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==s&&(a===null?c.firstBaseUpdate=l:a.next=l,c.lastBaseUpdate=u))}if(o!==null){var h=i.baseState;s=0,c=l=u=null,a=o;do{var f=a.lane,d=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,v=a;switch(f=e,d=n,v.tag){case 1:if(m=v.payload,typeof m=="function"){h=m.call(d,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=v.payload,f=typeof m=="function"?m.call(d,h,f):m,f==null)break e;h=Ct({},h,f);break e;case 2:bo=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(l=c=d,u=h):c=c.next=d,s|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Ks|=s,t.lanes=s,t.memoizedState=h}}function pb(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(re(191,i));i.call(r)}}}var eh={},vi=ss(eh),Ec=ss(eh),Cc=ss(eh);function Ds(t){if(t===eh)throw Error(re(174));return t}function Q0(t,e){switch(nt(Cc,e),nt(Ec,t),nt(vi,eh),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Tv(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Tv(e,t)}dt(vi),nt(vi,e)}function Eu(){dt(vi),dt(Ec),dt(Cc)}function UT(t){Ds(Cc.current);var e=Ds(vi.current),n=Tv(e,t.type);e!==n&&(nt(Ec,t),nt(vi,n))}function J0(t){Ec.current===t&&(dt(vi),dt(Ec))}var yt=ss(0);function dd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var sg=[];function Z0(){for(var t=0;t<sg.length;t++)sg[t]._workInProgressVersionPrimary=null;sg.length=0}var Of=to.ReactCurrentDispatcher,ag=to.ReactCurrentBatchConfig,qs=0,Et=null,Ut=null,Jt=null,pd=!1,Hl=!1,Sc=0,P3=0;function gn(){throw Error(re(321))}function e1(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Jr(t[n],e[n]))return!1;return!0}function t1(t,e,n,r,i,o){if(qs=o,Et=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Of.current=t===null||t.memoizedState===null?F3:O3,t=n(r,i),Hl){o=0;do{if(Hl=!1,Sc=0,25<=o)throw Error(re(301));o+=1,Jt=Ut=null,e.updateQueue=null,Of.current=L3,t=n(r,i)}while(Hl)}if(Of.current=md,e=Ut!==null&&Ut.next!==null,qs=0,Jt=Ut=Et=null,pd=!1,e)throw Error(re(300));return t}function n1(){var t=Sc!==0;return Sc=0,t}function ai(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?Et.memoizedState=Jt=t:Jt=Jt.next=t,Jt}function Dr(){if(Ut===null){var t=Et.alternate;t=t!==null?t.memoizedState:null}else t=Ut.next;var e=Jt===null?Et.memoizedState:Jt.next;if(e!==null)Jt=e,Ut=t;else{if(t===null)throw Error(re(310));Ut=t,t={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},Jt===null?Et.memoizedState=Jt=t:Jt=Jt.next=t}return Jt}function Tc(t,e){return typeof e=="function"?e(t):e}function ug(t){var e=Dr(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var r=Ut,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,u=null,l=o;do{var c=l.lane;if((qs&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var h={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(a=u=h,s=r):u=u.next=h,Et.lanes|=c,Ks|=c}l=l.next}while(l!==null&&l!==o);u===null?s=r:u.next=a,Jr(r,e.memoizedState)||(Yn=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,Et.lanes|=o,Ks|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function lg(t){var e=Dr(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);Jr(o,e.memoizedState)||(Yn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function WT(){}function zT(t,e){var n=Et,r=Dr(),i=e(),o=!Jr(r.memoizedState,i);if(o&&(r.memoizedState=i,Yn=!0),r=r.queue,r1(GT.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||Jt!==null&&Jt.memoizedState.tag&1){if(n.flags|=2048,Ic(9,HT.bind(null,n,r,i,e),void 0,null),nn===null)throw Error(re(349));qs&30||$T(n,e,i)}return i}function $T(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Et.updateQueue,e===null?(e={lastEffect:null,stores:null},Et.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function HT(t,e,n,r){e.value=n,e.getSnapshot=r,qT(e)&&KT(t)}function GT(t,e,n){return n(function(){qT(e)&&KT(t)})}function qT(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Jr(t,n)}catch{return!0}}function KT(t){var e=Yi(t,1);e!==null&&Xr(e,t,1,-1)}function mb(t){var e=ai();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tc,lastRenderedState:t},e.queue=t,t=t.dispatch=M3.bind(null,Et,t),[e.memoizedState,t]}function Ic(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Et.updateQueue,e===null?(e={lastEffect:null,stores:null},Et.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function XT(){return Dr().memoizedState}function Lf(t,e,n,r){var i=ai();Et.flags|=t,i.memoizedState=Ic(1|e,n,void 0,r===void 0?null:r)}function Ap(t,e,n,r){var i=Dr();r=r===void 0?null:r;var o=void 0;if(Ut!==null){var s=Ut.memoizedState;if(o=s.destroy,r!==null&&e1(r,s.deps)){i.memoizedState=Ic(e,n,o,r);return}}Et.flags|=t,i.memoizedState=Ic(1|e,n,o,r)}function gb(t,e){return Lf(8390656,8,t,e)}function r1(t,e){return Ap(2048,8,t,e)}function YT(t,e){return Ap(4,2,t,e)}function QT(t,e){return Ap(4,4,t,e)}function JT(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ZT(t,e,n){return n=n!=null?n.concat([t]):null,Ap(4,4,JT.bind(null,e,t),n)}function i1(){}function eI(t,e){var n=Dr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&e1(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function tI(t,e){var n=Dr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&e1(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function nI(t,e,n){return qs&21?(Jr(n,e)||(n=aT(),Et.lanes|=n,Ks|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Yn=!0),t.memoizedState=n)}function N3(t,e){var n=Je;Je=n!==0&&4>n?n:4,t(!0);var r=ag.transition;ag.transition={};try{t(!1),e()}finally{Je=n,ag.transition=r}}function rI(){return Dr().memoizedState}function D3(t,e,n){var r=Oo(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},iI(t))oI(e,n);else if(n=BT(t,e,n,r),n!==null){var i=Bn();Xr(n,t,r,i),sI(n,e,r)}}function M3(t,e,n){var r=Oo(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(iI(t))oI(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,Jr(a,s)){var u=e.interleaved;u===null?(i.next=i,X0(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=BT(t,e,i,r),n!==null&&(i=Bn(),Xr(n,t,r,i),sI(n,e,r))}}function iI(t){var e=t.alternate;return t===Et||e!==null&&e===Et}function oI(t,e){Hl=pd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function sI(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,F0(t,n)}}var md={readContext:Nr,useCallback:gn,useContext:gn,useEffect:gn,useImperativeHandle:gn,useInsertionEffect:gn,useLayoutEffect:gn,useMemo:gn,useReducer:gn,useRef:gn,useState:gn,useDebugValue:gn,useDeferredValue:gn,useTransition:gn,useMutableSource:gn,useSyncExternalStore:gn,useId:gn,unstable_isNewReconciler:!1},F3={readContext:Nr,useCallback:function(t,e){return ai().memoizedState=[t,e===void 0?null:e],t},useContext:Nr,useEffect:gb,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Lf(4194308,4,JT.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Lf(4194308,4,t,e)},useInsertionEffect:function(t,e){return Lf(4,2,t,e)},useMemo:function(t,e){var n=ai();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ai();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=D3.bind(null,Et,t),[r.memoizedState,t]},useRef:function(t){var e=ai();return t={current:t},e.memoizedState=t},useState:mb,useDebugValue:i1,useDeferredValue:function(t){return ai().memoizedState=t},useTransition:function(){var t=mb(!1),e=t[0];return t=N3.bind(null,t[1]),ai().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Et,i=ai();if(gt){if(n===void 0)throw Error(re(407));n=n()}else{if(n=e(),nn===null)throw Error(re(349));qs&30||$T(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,gb(GT.bind(null,r,o,t),[t]),r.flags|=2048,Ic(9,HT.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=ai(),e=nn.identifierPrefix;if(gt){var n=Vi,r=Li;n=(r&~(1<<32-Kr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Sc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=P3++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},O3={readContext:Nr,useCallback:eI,useContext:Nr,useEffect:r1,useImperativeHandle:ZT,useInsertionEffect:YT,useLayoutEffect:QT,useMemo:tI,useReducer:ug,useRef:XT,useState:function(){return ug(Tc)},useDebugValue:i1,useDeferredValue:function(t){var e=Dr();return nI(e,Ut.memoizedState,t)},useTransition:function(){var t=ug(Tc)[0],e=Dr().memoizedState;return[t,e]},useMutableSource:WT,useSyncExternalStore:zT,useId:rI,unstable_isNewReconciler:!1},L3={readContext:Nr,useCallback:eI,useContext:Nr,useEffect:r1,useImperativeHandle:ZT,useInsertionEffect:YT,useLayoutEffect:QT,useMemo:tI,useReducer:lg,useRef:XT,useState:function(){return lg(Tc)},useDebugValue:i1,useDeferredValue:function(t){var e=Dr();return Ut===null?e.memoizedState=t:nI(e,Ut.memoizedState,t)},useTransition:function(){var t=lg(Tc)[0],e=Dr().memoizedState;return[t,e]},useMutableSource:WT,useSyncExternalStore:zT,useId:rI,unstable_isNewReconciler:!1};function Lr(t,e){if(t&&t.defaultProps){e=Ct({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function qv(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ct({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var kp={isMounted:function(t){return(t=t._reactInternals)?aa(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Bn(),i=Oo(t),o=Ui(r,i);o.payload=e,n!=null&&(o.callback=n),e=Mo(t,o,i),e!==null&&(Xr(e,t,i,r),Ff(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Bn(),i=Oo(t),o=Ui(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=Mo(t,o,i),e!==null&&(Xr(e,t,i,r),Ff(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Bn(),r=Oo(t),i=Ui(n,r);i.tag=2,e!=null&&(i.callback=e),e=Mo(t,i,r),e!==null&&(Xr(e,t,r,n),Ff(e,t,r))}};function vb(t,e,n,r,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!_c(n,r)||!_c(i,o):!0}function aI(t,e,n){var r=!1,i=Xo,o=e.contextType;return typeof o=="object"&&o!==null?o=Nr(o):(i=Zn(e)?Hs:Nn.current,r=e.contextTypes,o=(r=r!=null)?wu(t,i):Xo),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=kp,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function yb(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&kp.enqueueReplaceState(e,e.state,null)}function Kv(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Y0(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Nr(o):(o=Zn(e)?Hs:Nn.current,i.context=wu(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(qv(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&kp.enqueueReplaceState(i,i.state,null),fd(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Cu(t,e){try{var n="",r=e;do n+=h4(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function cg(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Xv(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var V3=typeof WeakMap=="function"?WeakMap:Map;function uI(t,e,n){n=Ui(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){vd||(vd=!0,oy=r),Xv(t,e)},n}function lI(t,e,n){n=Ui(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Xv(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Xv(t,e),typeof r!="function"&&(Fo===null?Fo=new Set([this]):Fo.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function _b(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new V3;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=J3.bind(null,t,e,n),e.then(t,t))}function wb(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function xb(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ui(-1,1),e.tag=2,Mo(n,e,1))),n.lanes|=1),t)}var B3=to.ReactCurrentOwner,Yn=!1;function Ln(t,e,n,r){e.child=t===null?VT(e,null,n,r):bu(e,t.child,n,r)}function bb(t,e,n,r,i){n=n.render;var o=e.ref;return iu(e,i),r=t1(t,e,n,r,o,i),n=n1(),t!==null&&!Yn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Qi(t,e,i)):(gt&&n&&z0(e),e.flags|=1,Ln(t,e,r,i),e.child)}function Eb(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!f1(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,cI(t,e,o,r,i)):(t=Uf(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:_c,n(s,r)&&t.ref===e.ref)return Qi(t,e,i)}return e.flags|=1,t=Lo(o,r),t.ref=e.ref,t.return=e,e.child=t}function cI(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(_c(o,r)&&t.ref===e.ref)if(Yn=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(Yn=!0);else return e.lanes=t.lanes,Qi(t,e,i)}return Yv(t,e,n,r,i)}function hI(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt(qa,ar),ar|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nt(qa,ar),ar|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,nt(qa,ar),ar|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,nt(qa,ar),ar|=r;return Ln(t,e,i,n),e.child}function fI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Yv(t,e,n,r,i){var o=Zn(n)?Hs:Nn.current;return o=wu(e,o),iu(e,i),n=t1(t,e,n,r,o,i),r=n1(),t!==null&&!Yn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Qi(t,e,i)):(gt&&r&&z0(e),e.flags|=1,Ln(t,e,n,i),e.child)}function Cb(t,e,n,r,i){if(Zn(n)){var o=!0;ad(e)}else o=!1;if(iu(e,i),e.stateNode===null)Vf(t,e),aI(e,n,r),Kv(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var u=s.context,l=n.contextType;typeof l=="object"&&l!==null?l=Nr(l):(l=Zn(n)?Hs:Nn.current,l=wu(e,l));var c=n.getDerivedStateFromProps,h=typeof c=="function"||typeof s.getSnapshotBeforeUpdate=="function";h||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||u!==l)&&yb(e,s,r,l),bo=!1;var f=e.memoizedState;s.state=f,fd(e,r,s,i),u=e.memoizedState,a!==r||f!==u||Jn.current||bo?(typeof c=="function"&&(qv(e,n,c,r),u=e.memoizedState),(a=bo||vb(e,n,a,r,f,u,l))?(h||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),s.props=r,s.state=u,s.context=l,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,jT(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Lr(e.type,a),s.props=l,h=e.pendingProps,f=s.context,u=n.contextType,typeof u=="object"&&u!==null?u=Nr(u):(u=Zn(n)?Hs:Nn.current,u=wu(e,u));var d=n.getDerivedStateFromProps;(c=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==h||f!==u)&&yb(e,s,r,u),bo=!1,f=e.memoizedState,s.state=f,fd(e,r,s,i);var m=e.memoizedState;a!==h||f!==m||Jn.current||bo?(typeof d=="function"&&(qv(e,n,d,r),m=e.memoizedState),(l=bo||vb(e,n,l,r,f,m,u)||!1)?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,m,u),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,m,u)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),s.props=r,s.state=m,s.context=u,r=l):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Qv(t,e,n,r,o,i)}function Qv(t,e,n,r,i,o){fI(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&lb(e,n,!1),Qi(t,e,o);r=e.stateNode,B3.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=bu(e,t.child,null,o),e.child=bu(e,null,a,o)):Ln(t,e,a,o),e.memoizedState=r.state,i&&lb(e,n,!0),e.child}function dI(t){var e=t.stateNode;e.pendingContext?ub(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ub(t,e.context,!1),Q0(t,e.containerInfo)}function Sb(t,e,n,r,i){return xu(),H0(i),e.flags|=256,Ln(t,e,n,r),e.child}var Jv={dehydrated:null,treeContext:null,retryLane:0};function Zv(t){return{baseLanes:t,cachePool:null,transitions:null}}function pI(t,e,n){var r=e.pendingProps,i=yt.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),nt(yt,i&1),t===null)return Hv(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Dp(s,r,0,null),t=js(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Zv(n),e.memoizedState=Jv,t):o1(e,s));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return j3(t,e,s,r,a,i,n);if(o){o=r.fallback,s=e.mode,i=t.child,a=i.sibling;var u={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Lo(i,u),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Lo(a,o):(o=js(o,s,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=t.child.memoizedState,s=s===null?Zv(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~n,e.memoizedState=Jv,r}return o=t.child,t=o.sibling,r=Lo(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function o1(t,e){return e=Dp({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Zh(t,e,n,r){return r!==null&&H0(r),bu(e,t.child,null,n),t=o1(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function j3(t,e,n,r,i,o,s){if(n)return e.flags&256?(e.flags&=-257,r=cg(Error(re(422))),Zh(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=Dp({mode:"visible",children:r.children},i,0,null),o=js(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&bu(e,t.child,null,s),e.child.memoizedState=Zv(s),e.memoizedState=Jv,o);if(!(e.mode&1))return Zh(t,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(re(419)),r=cg(o,r,void 0),Zh(t,e,s,r)}if(a=(s&t.childLanes)!==0,Yn||a){if(r=nn,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Yi(t,i),Xr(r,t,i,-1))}return h1(),r=cg(Error(re(421))),Zh(t,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Z3.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,cr=Do(i.nextSibling),pr=e,gt=!0,Br=null,t!==null&&(Cr[Sr++]=Li,Cr[Sr++]=Vi,Cr[Sr++]=Gs,Li=t.id,Vi=t.overflow,Gs=e),e=o1(e,r.children),e.flags|=4096,e)}function Tb(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Gv(t.return,e,n)}function hg(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function mI(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Ln(t,e,r.children,n),r=yt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Tb(t,n,e);else if(t.tag===19)Tb(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(nt(yt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&dd(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),hg(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&dd(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}hg(e,!0,n,null,o);break;case"together":hg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vf(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Qi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ks|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(re(153));if(e.child!==null){for(t=e.child,n=Lo(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Lo(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function U3(t,e,n){switch(e.tag){case 3:dI(e),xu();break;case 5:UT(e);break;case 1:Zn(e.type)&&ad(e);break;case 4:Q0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;nt(cd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(nt(yt,yt.current&1),e.flags|=128,null):n&e.child.childLanes?pI(t,e,n):(nt(yt,yt.current&1),t=Qi(t,e,n),t!==null?t.sibling:null);nt(yt,yt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return mI(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),nt(yt,yt.current),r)break;return null;case 22:case 23:return e.lanes=0,hI(t,e,n)}return Qi(t,e,n)}var gI,ey,vI,yI;gI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ey=function(){};vI=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Ds(vi.current);var o=null;switch(n){case"input":i=bv(t,i),r=bv(t,r),o=[];break;case"select":i=Ct({},i,{value:void 0}),r=Ct({},r,{value:void 0}),o=[];break;case"textarea":i=Sv(t,i),r=Sv(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=od)}Iv(n,r);var s;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(fc.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(a=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==a&&(u!=null||a!=null))if(l==="style")if(a){for(s in a)!a.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&a[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(o||(o=[]),o.push(l,n)),n=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(o=o||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(fc.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&lt("scroll",t),o||a===u||(o=[])):(o=o||[]).push(l,u))}n&&(o=o||[]).push("style",n);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};yI=function(t,e,n,r){n!==r&&(e.flags|=4)};function wl(t,e){if(!gt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function vn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function W3(t,e,n){var r=e.pendingProps;switch($0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vn(e),null;case 1:return Zn(e.type)&&sd(),vn(e),null;case 3:return r=e.stateNode,Eu(),dt(Jn),dt(Nn),Z0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Qh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Br!==null&&(uy(Br),Br=null))),ey(t,e),vn(e),null;case 5:J0(e);var i=Ds(Cc.current);if(n=e.type,t!==null&&e.stateNode!=null)vI(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(re(166));return vn(e),null}if(t=Ds(vi.current),Qh(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[hi]=e,r[bc]=o,t=(e.mode&1)!==0,n){case"dialog":lt("cancel",r),lt("close",r);break;case"iframe":case"object":case"embed":lt("load",r);break;case"video":case"audio":for(i=0;i<Ll.length;i++)lt(Ll[i],r);break;case"source":lt("error",r);break;case"img":case"image":case"link":lt("error",r),lt("load",r);break;case"details":lt("toggle",r);break;case"input":Fx(r,o),lt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},lt("invalid",r);break;case"textarea":Lx(r,o),lt("invalid",r)}Iv(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&Yh(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Yh(r.textContent,a,t),i=["children",""+a]):fc.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&lt("scroll",r)}switch(n){case"input":Wh(r),Ox(r,o,!0);break;case"textarea":Wh(r),Vx(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=od)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=GS(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[hi]=e,t[bc]=r,gI(t,e,!1,!1),e.stateNode=t;e:{switch(s=Rv(n,r),n){case"dialog":lt("cancel",t),lt("close",t),i=r;break;case"iframe":case"object":case"embed":lt("load",t),i=r;break;case"video":case"audio":for(i=0;i<Ll.length;i++)lt(Ll[i],t);i=r;break;case"source":lt("error",t),i=r;break;case"img":case"image":case"link":lt("error",t),lt("load",t),i=r;break;case"details":lt("toggle",t),i=r;break;case"input":Fx(t,r),i=bv(t,r),lt("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Ct({},r,{value:void 0}),lt("invalid",t);break;case"textarea":Lx(t,r),i=Sv(t,r),lt("invalid",t);break;default:i=r}Iv(n,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var u=a[o];o==="style"?XS(t,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&qS(t,u)):o==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&dc(t,u):typeof u=="number"&&dc(t,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(fc.hasOwnProperty(o)?u!=null&&o==="onScroll"&&lt("scroll",t):u!=null&&A0(t,o,u,s))}switch(n){case"input":Wh(t),Ox(t,r,!1);break;case"textarea":Wh(t),Vx(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ko(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?eu(t,!!r.multiple,o,!1):r.defaultValue!=null&&eu(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=od)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return vn(e),null;case 6:if(t&&e.stateNode!=null)yI(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(re(166));if(n=Ds(Cc.current),Ds(vi.current),Qh(e)){if(r=e.stateNode,n=e.memoizedProps,r[hi]=e,(o=r.nodeValue!==n)&&(t=pr,t!==null))switch(t.tag){case 3:Yh(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Yh(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[hi]=e,e.stateNode=r}return vn(e),null;case 13:if(dt(yt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gt&&cr!==null&&e.mode&1&&!(e.flags&128))OT(),xu(),e.flags|=98560,o=!1;else if(o=Qh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(re(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(re(317));o[hi]=e}else xu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;vn(e),o=!1}else Br!==null&&(uy(Br),Br=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||yt.current&1?Wt===0&&(Wt=3):h1())),e.updateQueue!==null&&(e.flags|=4),vn(e),null);case 4:return Eu(),ey(t,e),t===null&&wc(e.stateNode.containerInfo),vn(e),null;case 10:return K0(e.type._context),vn(e),null;case 17:return Zn(e.type)&&sd(),vn(e),null;case 19:if(dt(yt),o=e.memoizedState,o===null)return vn(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)wl(o,!1);else{if(Wt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=dd(t),s!==null){for(e.flags|=128,wl(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return nt(yt,yt.current&1|2),e.child}t=t.sibling}o.tail!==null&&Pt()>Su&&(e.flags|=128,r=!0,wl(o,!1),e.lanes=4194304)}else{if(!r)if(t=dd(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),wl(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!gt)return vn(e),null}else 2*Pt()-o.renderingStartTime>Su&&n!==1073741824&&(e.flags|=128,r=!0,wl(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(n=o.last,n!==null?n.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Pt(),e.sibling=null,n=yt.current,nt(yt,r?n&1|2:n&1),e):(vn(e),null);case 22:case 23:return c1(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ar&1073741824&&(vn(e),e.subtreeFlags&6&&(e.flags|=8192)):vn(e),null;case 24:return null;case 25:return null}throw Error(re(156,e.tag))}function z3(t,e){switch($0(e),e.tag){case 1:return Zn(e.type)&&sd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Eu(),dt(Jn),dt(Nn),Z0(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return J0(e),null;case 13:if(dt(yt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(re(340));xu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return dt(yt),null;case 4:return Eu(),null;case 10:return K0(e.type._context),null;case 22:case 23:return c1(),null;case 24:return null;default:return null}}var ef=!1,bn=!1,$3=typeof WeakSet=="function"?WeakSet:Set,le=null;function Ga(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){At(t,e,r)}else n.current=null}function ty(t,e,n){try{n()}catch(r){At(t,e,r)}}var Ib=!1;function H3(t,e){if(Vv=nd,t=ET(),W0(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,a=-1,u=-1,l=0,c=0,h=t,f=null;t:for(;;){for(var d;h!==n||i!==0&&h.nodeType!==3||(a=s+i),h!==o||r!==0&&h.nodeType!==3||(u=s+r),h.nodeType===3&&(s+=h.nodeValue.length),(d=h.firstChild)!==null;)f=h,h=d;for(;;){if(h===t)break t;if(f===n&&++l===i&&(a=s),f===o&&++c===r&&(u=s),(d=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=d}n=a===-1||u===-1?null:{start:a,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Bv={focusedElem:t,selectionRange:n},nd=!1,le=e;le!==null;)if(e=le,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,le=t;else for(;le!==null;){e=le;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var v=m.memoizedProps,y=m.memoizedState,g=e.stateNode,_=g.getSnapshotBeforeUpdate(e.elementType===e.type?v:Lr(e.type,v),y);g.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(x){At(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,le=t;break}le=e.return}return m=Ib,Ib=!1,m}function Gl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&ty(e,n,o)}i=i.next}while(i!==r)}}function Pp(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ny(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function _I(t){var e=t.alternate;e!==null&&(t.alternate=null,_I(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[hi],delete e[bc],delete e[Wv],delete e[I3],delete e[R3])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function wI(t){return t.tag===5||t.tag===3||t.tag===4}function Rb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||wI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ry(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=od));else if(r!==4&&(t=t.child,t!==null))for(ry(t,e,n),t=t.sibling;t!==null;)ry(t,e,n),t=t.sibling}function iy(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(iy(t,e,n),t=t.sibling;t!==null;)iy(t,e,n),t=t.sibling}var sn=null,Vr=!1;function vo(t,e,n){for(n=n.child;n!==null;)xI(t,e,n),n=n.sibling}function xI(t,e,n){if(gi&&typeof gi.onCommitFiberUnmount=="function")try{gi.onCommitFiberUnmount(Ep,n)}catch{}switch(n.tag){case 5:bn||Ga(n,e);case 6:var r=sn,i=Vr;sn=null,vo(t,e,n),sn=r,Vr=i,sn!==null&&(Vr?(t=sn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):sn.removeChild(n.stateNode));break;case 18:sn!==null&&(Vr?(t=sn,n=n.stateNode,t.nodeType===8?ig(t.parentNode,n):t.nodeType===1&&ig(t,n),vc(t)):ig(sn,n.stateNode));break;case 4:r=sn,i=Vr,sn=n.stateNode.containerInfo,Vr=!0,vo(t,e,n),sn=r,Vr=i;break;case 0:case 11:case 14:case 15:if(!bn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&ty(n,e,s),i=i.next}while(i!==r)}vo(t,e,n);break;case 1:if(!bn&&(Ga(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){At(n,e,a)}vo(t,e,n);break;case 21:vo(t,e,n);break;case 22:n.mode&1?(bn=(r=bn)||n.memoizedState!==null,vo(t,e,n),bn=r):vo(t,e,n);break;default:vo(t,e,n)}}function Ab(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new $3),e.forEach(function(r){var i=eF.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Or(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:sn=a.stateNode,Vr=!1;break e;case 3:sn=a.stateNode.containerInfo,Vr=!0;break e;case 4:sn=a.stateNode.containerInfo,Vr=!0;break e}a=a.return}if(sn===null)throw Error(re(160));xI(o,s,i),sn=null,Vr=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){At(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)bI(e,t),e=e.sibling}function bI(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Or(e,t),oi(t),r&4){try{Gl(3,t,t.return),Pp(3,t)}catch(v){At(t,t.return,v)}try{Gl(5,t,t.return)}catch(v){At(t,t.return,v)}}break;case 1:Or(e,t),oi(t),r&512&&n!==null&&Ga(n,n.return);break;case 5:if(Or(e,t),oi(t),r&512&&n!==null&&Ga(n,n.return),t.flags&32){var i=t.stateNode;try{dc(i,"")}catch(v){At(t,t.return,v)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,s=n!==null?n.memoizedProps:o,a=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&$S(i,o),Rv(a,s);var l=Rv(a,o);for(s=0;s<u.length;s+=2){var c=u[s],h=u[s+1];c==="style"?XS(i,h):c==="dangerouslySetInnerHTML"?qS(i,h):c==="children"?dc(i,h):A0(i,c,h,l)}switch(a){case"input":Ev(i,o);break;case"textarea":HS(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var d=o.value;d!=null?eu(i,!!o.multiple,d,!1):f!==!!o.multiple&&(o.defaultValue!=null?eu(i,!!o.multiple,o.defaultValue,!0):eu(i,!!o.multiple,o.multiple?[]:"",!1))}i[bc]=o}catch(v){At(t,t.return,v)}}break;case 6:if(Or(e,t),oi(t),r&4){if(t.stateNode===null)throw Error(re(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(v){At(t,t.return,v)}}break;case 3:if(Or(e,t),oi(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{vc(e.containerInfo)}catch(v){At(t,t.return,v)}break;case 4:Or(e,t),oi(t);break;case 13:Or(e,t),oi(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(u1=Pt())),r&4&&Ab(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(bn=(l=bn)||c,Or(e,t),bn=l):Or(e,t),oi(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!c&&t.mode&1)for(le=t,c=t.child;c!==null;){for(h=le=c;le!==null;){switch(f=le,d=f.child,f.tag){case 0:case 11:case 14:case 15:Gl(4,f,f.return);break;case 1:Ga(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(v){At(r,n,v)}}break;case 5:Ga(f,f.return);break;case 22:if(f.memoizedState!==null){Pb(h);continue}}d!==null?(d.return=f,le=d):Pb(h)}c=c.sibling}e:for(c=null,h=t;;){if(h.tag===5){if(c===null){c=h;try{i=h.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=h.stateNode,u=h.memoizedProps.style,s=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=KS("display",s))}catch(v){At(t,t.return,v)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(v){At(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Or(e,t),oi(t),r&4&&Ab(t);break;case 21:break;default:Or(e,t),oi(t)}}function oi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(wI(n)){var r=n;break e}n=n.return}throw Error(re(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(dc(i,""),r.flags&=-33);var o=Rb(t);iy(t,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=Rb(t);ry(t,a,s);break;default:throw Error(re(161))}}catch(u){At(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function G3(t,e,n){le=t,EI(t)}function EI(t,e,n){for(var r=(t.mode&1)!==0;le!==null;){var i=le,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||ef;if(!s){var a=i.alternate,u=a!==null&&a.memoizedState!==null||bn;a=ef;var l=bn;if(ef=s,(bn=u)&&!l)for(le=i;le!==null;)s=le,u=s.child,s.tag===22&&s.memoizedState!==null?Nb(i):u!==null?(u.return=s,le=u):Nb(i);for(;o!==null;)le=o,EI(o),o=o.sibling;le=i,ef=a,bn=l}kb(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,le=o):kb(t)}}function kb(t){for(;le!==null;){var e=le;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bn||Pp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bn)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Lr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&pb(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}pb(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&vc(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}bn||e.flags&512&&ny(e)}catch(f){At(e,e.return,f)}}if(e===t){le=null;break}if(n=e.sibling,n!==null){n.return=e.return,le=n;break}le=e.return}}function Pb(t){for(;le!==null;){var e=le;if(e===t){le=null;break}var n=e.sibling;if(n!==null){n.return=e.return,le=n;break}le=e.return}}function Nb(t){for(;le!==null;){var e=le;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Pp(4,e)}catch(u){At(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){At(e,i,u)}}var o=e.return;try{ny(e)}catch(u){At(e,o,u)}break;case 5:var s=e.return;try{ny(e)}catch(u){At(e,s,u)}}}catch(u){At(e,e.return,u)}if(e===t){le=null;break}var a=e.sibling;if(a!==null){a.return=e.return,le=a;break}le=e.return}}var q3=Math.ceil,gd=to.ReactCurrentDispatcher,s1=to.ReactCurrentOwner,Pr=to.ReactCurrentBatchConfig,He=0,nn=null,Ot=null,dn=0,ar=0,qa=ss(0),Wt=0,Rc=null,Ks=0,Np=0,a1=0,ql=null,qn=null,u1=0,Su=1/0,Mi=null,vd=!1,oy=null,Fo=null,tf=!1,Io=null,yd=0,Kl=0,sy=null,Bf=-1,jf=0;function Bn(){return He&6?Pt():Bf!==-1?Bf:Bf=Pt()}function Oo(t){return t.mode&1?He&2&&dn!==0?dn&-dn:k3.transition!==null?(jf===0&&(jf=aT()),jf):(t=Je,t!==0||(t=window.event,t=t===void 0?16:pT(t.type)),t):1}function Xr(t,e,n,r){if(50<Kl)throw Kl=0,sy=null,Error(re(185));Qc(t,n,r),(!(He&2)||t!==nn)&&(t===nn&&(!(He&2)&&(Np|=n),Wt===4&&So(t,dn)),er(t,r),n===1&&He===0&&!(e.mode&1)&&(Su=Pt()+500,Rp&&as()))}function er(t,e){var n=t.callbackNode;k4(t,e);var r=td(t,t===nn?dn:0);if(r===0)n!==null&&Ux(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Ux(n),e===1)t.tag===0?A3(Db.bind(null,t)):DT(Db.bind(null,t)),S3(function(){!(He&6)&&as()}),n=null;else{switch(uT(r)){case 1:n=M0;break;case 4:n=oT;break;case 16:n=ed;break;case 536870912:n=sT;break;default:n=ed}n=PI(n,CI.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function CI(t,e){if(Bf=-1,jf=0,He&6)throw Error(re(327));var n=t.callbackNode;if(ou()&&t.callbackNode!==n)return null;var r=td(t,t===nn?dn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=_d(t,r);else{e=r;var i=He;He|=2;var o=TI();(nn!==t||dn!==e)&&(Mi=null,Su=Pt()+500,Bs(t,e));do try{Y3();break}catch(a){SI(t,a)}while(!0);q0(),gd.current=o,He=i,Ot!==null?e=0:(nn=null,dn=0,e=Wt)}if(e!==0){if(e===2&&(i=Dv(t),i!==0&&(r=i,e=ay(t,i))),e===1)throw n=Rc,Bs(t,0),So(t,r),er(t,Pt()),n;if(e===6)So(t,r);else{if(i=t.current.alternate,!(r&30)&&!K3(i)&&(e=_d(t,r),e===2&&(o=Dv(t),o!==0&&(r=o,e=ay(t,o))),e===1))throw n=Rc,Bs(t,0),So(t,r),er(t,Pt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(re(345));case 2:bs(t,qn,Mi);break;case 3:if(So(t,r),(r&130023424)===r&&(e=u1+500-Pt(),10<e)){if(td(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Bn(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Uv(bs.bind(null,t,qn,Mi),e);break}bs(t,qn,Mi);break;case 4:if(So(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var s=31-Kr(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Pt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*q3(r/1960))-r,10<r){t.timeoutHandle=Uv(bs.bind(null,t,qn,Mi),r);break}bs(t,qn,Mi);break;case 5:bs(t,qn,Mi);break;default:throw Error(re(329))}}}return er(t,Pt()),t.callbackNode===n?CI.bind(null,t):null}function ay(t,e){var n=ql;return t.current.memoizedState.isDehydrated&&(Bs(t,e).flags|=256),t=_d(t,e),t!==2&&(e=qn,qn=n,e!==null&&uy(e)),t}function uy(t){qn===null?qn=t:qn.push.apply(qn,t)}function K3(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Jr(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function So(t,e){for(e&=~a1,e&=~Np,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Kr(e),r=1<<n;t[n]=-1,e&=~r}}function Db(t){if(He&6)throw Error(re(327));ou();var e=td(t,0);if(!(e&1))return er(t,Pt()),null;var n=_d(t,e);if(t.tag!==0&&n===2){var r=Dv(t);r!==0&&(e=r,n=ay(t,r))}if(n===1)throw n=Rc,Bs(t,0),So(t,e),er(t,Pt()),n;if(n===6)throw Error(re(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,bs(t,qn,Mi),er(t,Pt()),null}function l1(t,e){var n=He;He|=1;try{return t(e)}finally{He=n,He===0&&(Su=Pt()+500,Rp&&as())}}function Xs(t){Io!==null&&Io.tag===0&&!(He&6)&&ou();var e=He;He|=1;var n=Pr.transition,r=Je;try{if(Pr.transition=null,Je=1,t)return t()}finally{Je=r,Pr.transition=n,He=e,!(He&6)&&as()}}function c1(){ar=qa.current,dt(qa)}function Bs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,C3(n)),Ot!==null)for(n=Ot.return;n!==null;){var r=n;switch($0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&sd();break;case 3:Eu(),dt(Jn),dt(Nn),Z0();break;case 5:J0(r);break;case 4:Eu();break;case 13:dt(yt);break;case 19:dt(yt);break;case 10:K0(r.type._context);break;case 22:case 23:c1()}n=n.return}if(nn=t,Ot=t=Lo(t.current,null),dn=ar=e,Wt=0,Rc=null,a1=Np=Ks=0,qn=ql=null,Ns!==null){for(e=0;e<Ns.length;e++)if(n=Ns[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}n.pending=r}Ns=null}return t}function SI(t,e){do{var n=Ot;try{if(q0(),Of.current=md,pd){for(var r=Et.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}pd=!1}if(qs=0,Jt=Ut=Et=null,Hl=!1,Sc=0,s1.current=null,n===null||n.return===null){Wt=1,Rc=e,Ot=null;break}e:{var o=t,s=n.return,a=n,u=e;if(e=dn,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=wb(s);if(d!==null){d.flags&=-257,xb(d,s,a,o,e),d.mode&1&&_b(o,l,e),e=d,u=l;var m=e.updateQueue;if(m===null){var v=new Set;v.add(u),e.updateQueue=v}else m.add(u);break e}else{if(!(e&1)){_b(o,l,e),h1();break e}u=Error(re(426))}}else if(gt&&a.mode&1){var y=wb(s);if(y!==null){!(y.flags&65536)&&(y.flags|=256),xb(y,s,a,o,e),H0(Cu(u,a));break e}}o=u=Cu(u,a),Wt!==4&&(Wt=2),ql===null?ql=[o]:ql.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var g=uI(o,u,e);db(o,g);break e;case 1:a=u;var _=o.type,w=o.stateNode;if(!(o.flags&128)&&(typeof _.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Fo===null||!Fo.has(w)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=lI(o,a,e);db(o,x);break e}}o=o.return}while(o!==null)}RI(n)}catch(S){e=S,Ot===n&&n!==null&&(Ot=n=n.return);continue}break}while(!0)}function TI(){var t=gd.current;return gd.current=md,t===null?md:t}function h1(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),nn===null||!(Ks&268435455)&&!(Np&268435455)||So(nn,dn)}function _d(t,e){var n=He;He|=2;var r=TI();(nn!==t||dn!==e)&&(Mi=null,Bs(t,e));do try{X3();break}catch(i){SI(t,i)}while(!0);if(q0(),He=n,gd.current=r,Ot!==null)throw Error(re(261));return nn=null,dn=0,Wt}function X3(){for(;Ot!==null;)II(Ot)}function Y3(){for(;Ot!==null&&!x4();)II(Ot)}function II(t){var e=kI(t.alternate,t,ar);t.memoizedProps=t.pendingProps,e===null?RI(t):Ot=e,s1.current=null}function RI(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=z3(n,e),n!==null){n.flags&=32767,Ot=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Wt=6,Ot=null;return}}else if(n=W3(n,e,ar),n!==null){Ot=n;return}if(e=e.sibling,e!==null){Ot=e;return}Ot=e=t}while(e!==null);Wt===0&&(Wt=5)}function bs(t,e,n){var r=Je,i=Pr.transition;try{Pr.transition=null,Je=1,Q3(t,e,n,r)}finally{Pr.transition=i,Je=r}return null}function Q3(t,e,n,r){do ou();while(Io!==null);if(He&6)throw Error(re(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(re(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(P4(t,o),t===nn&&(Ot=nn=null,dn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||tf||(tf=!0,PI(ed,function(){return ou(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Pr.transition,Pr.transition=null;var s=Je;Je=1;var a=He;He|=4,s1.current=null,H3(t,n),bI(n,t),v3(Bv),nd=!!Vv,Bv=Vv=null,t.current=n,G3(n),b4(),He=a,Je=s,Pr.transition=o}else t.current=n;if(tf&&(tf=!1,Io=t,yd=i),o=t.pendingLanes,o===0&&(Fo=null),S4(n.stateNode),er(t,Pt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(vd)throw vd=!1,t=oy,oy=null,t;return yd&1&&t.tag!==0&&ou(),o=t.pendingLanes,o&1?t===sy?Kl++:(Kl=0,sy=t):Kl=0,as(),null}function ou(){if(Io!==null){var t=uT(yd),e=Pr.transition,n=Je;try{if(Pr.transition=null,Je=16>t?16:t,Io===null)var r=!1;else{if(t=Io,Io=null,yd=0,He&6)throw Error(re(331));var i=He;for(He|=4,le=t.current;le!==null;){var o=le,s=o.child;if(le.flags&16){var a=o.deletions;if(a!==null){for(var u=0;u<a.length;u++){var l=a[u];for(le=l;le!==null;){var c=le;switch(c.tag){case 0:case 11:case 15:Gl(8,c,o)}var h=c.child;if(h!==null)h.return=c,le=h;else for(;le!==null;){c=le;var f=c.sibling,d=c.return;if(_I(c),c===l){le=null;break}if(f!==null){f.return=d,le=f;break}le=d}}}var m=o.alternate;if(m!==null){var v=m.child;if(v!==null){m.child=null;do{var y=v.sibling;v.sibling=null,v=y}while(v!==null)}}le=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,le=s;else e:for(;le!==null;){if(o=le,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Gl(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,le=g;break e}le=o.return}}var _=t.current;for(le=_;le!==null;){s=le;var w=s.child;if(s.subtreeFlags&2064&&w!==null)w.return=s,le=w;else e:for(s=_;le!==null;){if(a=le,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Pp(9,a)}}catch(S){At(a,a.return,S)}if(a===s){le=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,le=x;break e}le=a.return}}if(He=i,as(),gi&&typeof gi.onPostCommitFiberRoot=="function")try{gi.onPostCommitFiberRoot(Ep,t)}catch{}r=!0}return r}finally{Je=n,Pr.transition=e}}return!1}function Mb(t,e,n){e=Cu(n,e),e=uI(t,e,1),t=Mo(t,e,1),e=Bn(),t!==null&&(Qc(t,1,e),er(t,e))}function At(t,e,n){if(t.tag===3)Mb(t,t,n);else for(;e!==null;){if(e.tag===3){Mb(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Fo===null||!Fo.has(r))){t=Cu(n,t),t=lI(e,t,1),e=Mo(e,t,1),t=Bn(),e!==null&&(Qc(e,1,t),er(e,t));break}}e=e.return}}function J3(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Bn(),t.pingedLanes|=t.suspendedLanes&n,nn===t&&(dn&n)===n&&(Wt===4||Wt===3&&(dn&130023424)===dn&&500>Pt()-u1?Bs(t,0):a1|=n),er(t,e)}function AI(t,e){e===0&&(t.mode&1?(e=Hh,Hh<<=1,!(Hh&130023424)&&(Hh=4194304)):e=1);var n=Bn();t=Yi(t,e),t!==null&&(Qc(t,e,n),er(t,n))}function Z3(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),AI(t,n)}function eF(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(re(314))}r!==null&&r.delete(e),AI(t,n)}var kI;kI=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Jn.current)Yn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Yn=!1,U3(t,e,n);Yn=!!(t.flags&131072)}else Yn=!1,gt&&e.flags&1048576&&MT(e,ld,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Vf(t,e),t=e.pendingProps;var i=wu(e,Nn.current);iu(e,n),i=t1(null,e,r,t,i,n);var o=n1();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zn(r)?(o=!0,ad(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Y0(e),i.updater=kp,e.stateNode=i,i._reactInternals=e,Kv(e,r,t,n),e=Qv(null,e,r,!0,o,n)):(e.tag=0,gt&&o&&z0(e),Ln(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Vf(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=nF(r),t=Lr(r,t),i){case 0:e=Yv(null,e,r,t,n);break e;case 1:e=Cb(null,e,r,t,n);break e;case 11:e=bb(null,e,r,t,n);break e;case 14:e=Eb(null,e,r,Lr(r.type,t),n);break e}throw Error(re(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Lr(r,i),Yv(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Lr(r,i),Cb(t,e,r,i,n);case 3:e:{if(dI(e),t===null)throw Error(re(387));r=e.pendingProps,o=e.memoizedState,i=o.element,jT(t,e),fd(e,r,null,n);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Cu(Error(re(423)),e),e=Sb(t,e,r,n,i);break e}else if(r!==i){i=Cu(Error(re(424)),e),e=Sb(t,e,r,n,i);break e}else for(cr=Do(e.stateNode.containerInfo.firstChild),pr=e,gt=!0,Br=null,n=VT(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(xu(),r===i){e=Qi(t,e,n);break e}Ln(t,e,r,n)}e=e.child}return e;case 5:return UT(e),t===null&&Hv(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,jv(r,i)?s=null:o!==null&&jv(r,o)&&(e.flags|=32),fI(t,e),Ln(t,e,s,n),e.child;case 6:return t===null&&Hv(e),null;case 13:return pI(t,e,n);case 4:return Q0(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=bu(e,null,r,n):Ln(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Lr(r,i),bb(t,e,r,i,n);case 7:return Ln(t,e,e.pendingProps,n),e.child;case 8:return Ln(t,e,e.pendingProps.children,n),e.child;case 12:return Ln(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,nt(cd,r._currentValue),r._currentValue=s,o!==null)if(Jr(o.value,s)){if(o.children===i.children&&!Jn.current){e=Qi(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=Ui(-1,n&-n),u.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}o.lanes|=n,u=o.alternate,u!==null&&(u.lanes|=n),Gv(o.return,n,e),a.lanes|=n;break}u=u.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(re(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),Gv(s,n,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Ln(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,iu(e,n),i=Nr(i),r=r(i),e.flags|=1,Ln(t,e,r,n),e.child;case 14:return r=e.type,i=Lr(r,e.pendingProps),i=Lr(r.type,i),Eb(t,e,r,i,n);case 15:return cI(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Lr(r,i),Vf(t,e),e.tag=1,Zn(r)?(t=!0,ad(e)):t=!1,iu(e,n),aI(e,r,i),Kv(e,r,i,n),Qv(null,e,r,!0,t,n);case 19:return mI(t,e,n);case 22:return hI(t,e,n)}throw Error(re(156,e.tag))};function PI(t,e){return iT(t,e)}function tF(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rr(t,e,n,r){return new tF(t,e,n,r)}function f1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function nF(t){if(typeof t=="function")return f1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===P0)return 11;if(t===N0)return 14}return 2}function Lo(t,e){var n=t.alternate;return n===null?(n=Rr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Uf(t,e,n,r,i,o){var s=2;if(r=t,typeof t=="function")f1(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case La:return js(n.children,i,o,e);case k0:s=8,i|=8;break;case yv:return t=Rr(12,n,e,i|2),t.elementType=yv,t.lanes=o,t;case _v:return t=Rr(13,n,e,i),t.elementType=_v,t.lanes=o,t;case wv:return t=Rr(19,n,e,i),t.elementType=wv,t.lanes=o,t;case US:return Dp(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case BS:s=10;break e;case jS:s=9;break e;case P0:s=11;break e;case N0:s=14;break e;case xo:s=16,r=null;break e}throw Error(re(130,t==null?t:typeof t,""))}return e=Rr(s,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function js(t,e,n,r){return t=Rr(7,t,r,e),t.lanes=n,t}function Dp(t,e,n,r){return t=Rr(22,t,r,e),t.elementType=US,t.lanes=n,t.stateNode={isHidden:!1},t}function fg(t,e,n){return t=Rr(6,t,null,e),t.lanes=n,t}function dg(t,e,n){return e=Rr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function rF(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qm(0),this.expirationTimes=qm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qm(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function d1(t,e,n,r,i,o,s,a,u){return t=new rF(t,e,n,a,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Rr(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Y0(o),t}function iF(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oa,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function NI(t){if(!t)return Xo;t=t._reactInternals;e:{if(aa(t)!==t||t.tag!==1)throw Error(re(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(re(171))}if(t.tag===1){var n=t.type;if(Zn(n))return NT(t,n,e)}return e}function DI(t,e,n,r,i,o,s,a,u){return t=d1(n,r,!0,t,i,o,s,a,u),t.context=NI(null),n=t.current,r=Bn(),i=Oo(n),o=Ui(r,i),o.callback=e??null,Mo(n,o,i),t.current.lanes=i,Qc(t,i,r),er(t,r),t}function Mp(t,e,n,r){var i=e.current,o=Bn(),s=Oo(i);return n=NI(n),e.context===null?e.context=n:e.pendingContext=n,e=Ui(o,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Mo(i,e,s),t!==null&&(Xr(t,i,s,o),Ff(t,i,s)),s}function wd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Fb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function p1(t,e){Fb(t,e),(t=t.alternate)&&Fb(t,e)}function oF(){return null}var MI=typeof reportError=="function"?reportError:function(t){console.error(t)};function m1(t){this._internalRoot=t}Fp.prototype.render=m1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(re(409));Mp(t,e,null,null)};Fp.prototype.unmount=m1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Xs(function(){Mp(null,t,null,null)}),e[Xi]=null}};function Fp(t){this._internalRoot=t}Fp.prototype.unstable_scheduleHydration=function(t){if(t){var e=hT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Co.length&&e!==0&&e<Co[n].priority;n++);Co.splice(n,0,t),n===0&&dT(t)}};function g1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Op(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ob(){}function sF(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var l=wd(s);o.call(l)}}var s=DI(e,r,t,0,null,!1,!1,"",Ob);return t._reactRootContainer=s,t[Xi]=s.current,wc(t.nodeType===8?t.parentNode:t),Xs(),s}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var l=wd(u);a.call(l)}}var u=d1(t,0,!1,null,null,!1,!1,"",Ob);return t._reactRootContainer=u,t[Xi]=u.current,wc(t.nodeType===8?t.parentNode:t),Xs(function(){Mp(e,u,n,r)}),u}function Lp(t,e,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var u=wd(s);a.call(u)}}Mp(e,s,t,i)}else s=sF(n,e,t,i,r);return wd(s)}lT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ol(e.pendingLanes);n!==0&&(F0(e,n|1),er(e,Pt()),!(He&6)&&(Su=Pt()+500,as()))}break;case 13:Xs(function(){var r=Yi(t,1);if(r!==null){var i=Bn();Xr(r,t,1,i)}}),p1(t,1)}};O0=function(t){if(t.tag===13){var e=Yi(t,134217728);if(e!==null){var n=Bn();Xr(e,t,134217728,n)}p1(t,134217728)}};cT=function(t){if(t.tag===13){var e=Oo(t),n=Yi(t,e);if(n!==null){var r=Bn();Xr(n,t,e,r)}p1(t,e)}};hT=function(){return Je};fT=function(t,e){var n=Je;try{return Je=t,e()}finally{Je=n}};kv=function(t,e,n){switch(e){case"input":if(Ev(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Ip(r);if(!i)throw Error(re(90));zS(r),Ev(r,i)}}}break;case"textarea":HS(t,n);break;case"select":e=n.value,e!=null&&eu(t,!!n.multiple,e,!1)}};JS=l1;ZS=Xs;var aF={usingClientEntryPoint:!1,Events:[Zc,Ua,Ip,YS,QS,l1]},xl={findFiberByHostInstance:Ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},uF={bundleType:xl.bundleType,version:xl.version,rendererPackageName:xl.rendererPackageName,rendererConfig:xl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:to.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=nT(t),t===null?null:t.stateNode},findFiberByHostInstance:xl.findFiberByHostInstance||oF,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nf.isDisabled&&nf.supportsFiber)try{Ep=nf.inject(uF),gi=nf}catch{}}_r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aF;_r.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g1(e))throw Error(re(200));return iF(t,e,null,n)};_r.createRoot=function(t,e){if(!g1(t))throw Error(re(299));var n=!1,r="",i=MI;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=d1(t,1,!1,null,null,n,!1,r,i),t[Xi]=e.current,wc(t.nodeType===8?t.parentNode:t),new m1(e)};_r.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(re(188)):(t=Object.keys(t).join(","),Error(re(268,t)));return t=nT(e),t=t===null?null:t.stateNode,t};_r.flushSync=function(t){return Xs(t)};_r.hydrate=function(t,e,n){if(!Op(e))throw Error(re(200));return Lp(null,t,e,!0,n)};_r.hydrateRoot=function(t,e,n){if(!g1(t))throw Error(re(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",s=MI;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=DI(e,null,t,1,n??null,i,!1,o,s),t[Xi]=e.current,wc(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Fp(e)};_r.render=function(t,e,n){if(!Op(e))throw Error(re(200));return Lp(null,t,e,!1,n)};_r.unmountComponentAtNode=function(t){if(!Op(t))throw Error(re(40));return t._reactRootContainer?(Xs(function(){Lp(null,null,t,!1,function(){t._reactRootContainer=null,t[Xi]=null})}),!0):!1};_r.unstable_batchedUpdates=l1;_r.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Op(n))throw Error(re(200));if(t==null||t._reactInternals===void 0)throw Error(re(38));return Lp(t,e,n,!1,r)};_r.version="18.3.1-next-f1338f8080-20240426";function FI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(FI)}catch(t){console.error(t)}}FI(),FS.exports=_r;var lF=FS.exports,Lb=lF;gv.createRoot=Lb.createRoot,gv.hydrateRoot=Lb.hydrateRoot;const OI=Y.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),Vp=Y.createContext({}),Bp=Y.createContext(null),jp=typeof document<"u",v1=jp?Y.useLayoutEffect:Y.useEffect,LI=Y.createContext({strict:!1}),y1=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),cF="framerAppearId",VI="data-"+y1(cF);function hF(t,e,n,r){const{visualElement:i}=Y.useContext(Vp),o=Y.useContext(LI),s=Y.useContext(Bp),a=Y.useContext(OI).reducedMotion,u=Y.useRef();r=r||o.renderer,!u.current&&r&&(u.current=r(t,{visualState:e,parent:i,props:n,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:a}));const l=u.current;Y.useInsertionEffect(()=>{l&&l.update(n,s)});const c=Y.useRef(!!(n[VI]&&!window.HandoffComplete));return v1(()=>{l&&(l.render(),c.current&&l.animationState&&l.animationState.animateChanges())}),Y.useEffect(()=>{l&&(l.updateFeatures(),!c.current&&l.animationState&&l.animationState.animateChanges(),c.current&&(c.current=!1,window.HandoffComplete=!0))}),l}function Ka(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function fF(t,e,n){return Y.useCallback(r=>{r&&t.mount&&t.mount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Ka(n)&&(n.current=r))},[e])}function Ac(t){return typeof t=="string"||Array.isArray(t)}function Up(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const _1=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],w1=["initial",..._1];function Wp(t){return Up(t.animate)||w1.some(e=>Ac(t[e]))}function BI(t){return!!(Wp(t)||t.variants)}function dF(t,e){if(Wp(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Ac(n)?n:void 0,animate:Ac(r)?r:void 0}}return t.inherit!==!1?e:{}}function pF(t){const{initial:e,animate:n}=dF(t,Y.useContext(Vp));return Y.useMemo(()=>({initial:e,animate:n}),[Vb(e),Vb(n)])}function Vb(t){return Array.isArray(t)?t.join(" "):t}const Bb={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},kc={};for(const t in Bb)kc[t]={isEnabled:e=>Bb[t].some(n=>!!e[n])};function mF(t){for(const e in t)kc[e]={...kc[e],...t[e]}}const x1=Y.createContext({}),jI=Y.createContext({}),gF=Symbol.for("motionComponentSymbol");function vF({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:r,Component:i}){t&&mF(t);function o(a,u){let l;const c={...Y.useContext(OI),...a,layoutId:yF(a)},{isStatic:h}=c,f=pF(a),d=r(a,h);if(!h&&jp){f.visualElement=hF(i,d,c,e);const m=Y.useContext(jI),v=Y.useContext(LI).strict;f.visualElement&&(l=f.visualElement.loadFeatures(c,v,t,m))}return Y.createElement(Vp.Provider,{value:f},l&&f.visualElement?Y.createElement(l,{visualElement:f.visualElement,...c}):null,n(i,a,fF(d,f.visualElement,u),d,h,f.visualElement))}const s=Y.forwardRef(o);return s[gF]=i,s}function yF({layoutId:t}){const e=Y.useContext(x1).id;return e&&t!==void 0?e+"-"+t:t}function _F(t){function e(r,i={}){return vF(t(r,i))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(r,i)=>(n.has(i)||n.set(i,e(i)),n.get(i))})}const wF=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function b1(t){return typeof t!="string"||t.includes("-")?!1:!!(wF.indexOf(t)>-1||/[A-Z]/.test(t))}const xd={};function xF(t){Object.assign(xd,t)}const th=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ua=new Set(th);function UI(t,{layout:e,layoutId:n}){return ua.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!xd[t]||t==="opacity")}const nr=t=>!!(t&&t.getVelocity),bF={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},EF=th.length;function CF(t,{enableHardwareAcceleration:e=!0,allowTransformNone:n=!0},r,i){let o="";for(let s=0;s<EF;s++){const a=th[s];if(t[a]!==void 0){const u=bF[a]||a;o+=`${u}(${t[a]}) `}}return e&&!t.z&&(o+="translateZ(0)"),o=o.trim(),i?o=i(t,r?"":o):n&&r&&(o="none"),o}const WI=t=>e=>typeof e=="string"&&e.startsWith(t),zI=WI("--"),ly=WI("var(--"),SF=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,TF=(t,e)=>e&&typeof t=="number"?e.transform(t):t,Yo=(t,e,n)=>Math.min(Math.max(n,t),e),la={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Xl={...la,transform:t=>Yo(0,1,t)},rf={...la,default:1},Yl=t=>Math.round(t*1e5)/1e5,zp=/(-)?([\d]*\.?[\d])+/g,$I=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,IF=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function nh(t){return typeof t=="string"}const rh=t=>({test:e=>nh(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),wo=rh("deg"),yi=rh("%"),Te=rh("px"),RF=rh("vh"),AF=rh("vw"),jb={...yi,parse:t=>yi.parse(t)/100,transform:t=>yi.transform(t*100)},Ub={...la,transform:Math.round},HI={borderWidth:Te,borderTopWidth:Te,borderRightWidth:Te,borderBottomWidth:Te,borderLeftWidth:Te,borderRadius:Te,radius:Te,borderTopLeftRadius:Te,borderTopRightRadius:Te,borderBottomRightRadius:Te,borderBottomLeftRadius:Te,width:Te,maxWidth:Te,height:Te,maxHeight:Te,size:Te,top:Te,right:Te,bottom:Te,left:Te,padding:Te,paddingTop:Te,paddingRight:Te,paddingBottom:Te,paddingLeft:Te,margin:Te,marginTop:Te,marginRight:Te,marginBottom:Te,marginLeft:Te,rotate:wo,rotateX:wo,rotateY:wo,rotateZ:wo,scale:rf,scaleX:rf,scaleY:rf,scaleZ:rf,skew:wo,skewX:wo,skewY:wo,distance:Te,translateX:Te,translateY:Te,translateZ:Te,x:Te,y:Te,z:Te,perspective:Te,transformPerspective:Te,opacity:Xl,originX:jb,originY:jb,originZ:Te,zIndex:Ub,fillOpacity:Xl,strokeOpacity:Xl,numOctaves:Ub};function E1(t,e,n,r){const{style:i,vars:o,transform:s,transformOrigin:a}=t;let u=!1,l=!1,c=!0;for(const h in e){const f=e[h];if(zI(h)){o[h]=f;continue}const d=HI[h],m=TF(f,d);if(ua.has(h)){if(u=!0,s[h]=m,!c)continue;f!==(d.default||0)&&(c=!1)}else h.startsWith("origin")?(l=!0,a[h]=m):i[h]=m}if(e.transform||(u||r?i.transform=CF(t.transform,n,c,r):i.transform&&(i.transform="none")),l){const{originX:h="50%",originY:f="50%",originZ:d=0}=a;i.transformOrigin=`${h} ${f} ${d}`}}const C1=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function GI(t,e,n){for(const r in e)!nr(e[r])&&!UI(r,n)&&(t[r]=e[r])}function kF({transformTemplate:t},e,n){return Y.useMemo(()=>{const r=C1();return E1(r,e,{enableHardwareAcceleration:!n},t),Object.assign({},r.vars,r.style)},[e])}function PF(t,e,n){const r=t.style||{},i={};return GI(i,r,t),Object.assign(i,kF(t,e,n)),t.transformValues?t.transformValues(i):i}function NF(t,e,n){const r={},i=PF(t,e,n);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=i,r}const DF=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function bd(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||DF.has(t)}let qI=t=>!bd(t);function MF(t){t&&(qI=e=>e.startsWith("on")?!bd(e):t(e))}try{MF(require("@emotion/is-prop-valid").default)}catch{}function FF(t,e,n){const r={};for(const i in t)i==="values"&&typeof t.values=="object"||(qI(i)||n===!0&&bd(i)||!e&&!bd(i)||t.draggable&&i.startsWith("onDrag"))&&(r[i]=t[i]);return r}function Wb(t,e,n){return typeof t=="string"?t:Te.transform(e+n*t)}function OF(t,e,n){const r=Wb(e,t.x,t.width),i=Wb(n,t.y,t.height);return`${r} ${i}`}const LF={offset:"stroke-dashoffset",array:"stroke-dasharray"},VF={offset:"strokeDashoffset",array:"strokeDasharray"};function BF(t,e,n=1,r=0,i=!0){t.pathLength=1;const o=i?LF:VF;t[o.offset]=Te.transform(-r);const s=Te.transform(e),a=Te.transform(n);t[o.array]=`${s} ${a}`}function S1(t,{attrX:e,attrY:n,attrScale:r,originX:i,originY:o,pathLength:s,pathSpacing:a=1,pathOffset:u=0,...l},c,h,f){if(E1(t,l,c,f),h){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:d,style:m,dimensions:v}=t;d.transform&&(v&&(m.transform=d.transform),delete d.transform),v&&(i!==void 0||o!==void 0||m.transform)&&(m.transformOrigin=OF(v,i!==void 0?i:.5,o!==void 0?o:.5)),e!==void 0&&(d.x=e),n!==void 0&&(d.y=n),r!==void 0&&(d.scale=r),s!==void 0&&BF(d,s,a,u,!1)}const KI=()=>({...C1(),attrs:{}}),T1=t=>typeof t=="string"&&t.toLowerCase()==="svg";function jF(t,e,n,r){const i=Y.useMemo(()=>{const o=KI();return S1(o,e,{enableHardwareAcceleration:!1},T1(r),t.transformTemplate),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};GI(o,t.style,t),i.style={...o,...i.style}}return i}function UF(t=!1){return(n,r,i,{latestValues:o},s)=>{const u=(b1(n)?jF:NF)(r,o,s,n),c={...FF(r,typeof n=="string",t),...u,ref:i},{children:h}=r,f=Y.useMemo(()=>nr(h)?h.get():h,[h]);return Y.createElement(n,{...c,children:f})}}function XI(t,{style:e,vars:n},r,i){Object.assign(t.style,e,i&&i.getProjectionStyles(r));for(const o in n)t.style.setProperty(o,n[o])}const YI=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function QI(t,e,n,r){XI(t,e,void 0,r);for(const i in e.attrs)t.setAttribute(YI.has(i)?i:y1(i),e.attrs[i])}function I1(t,e){const{style:n}=t,r={};for(const i in n)(nr(n[i])||e.style&&nr(e.style[i])||UI(i,t))&&(r[i]=n[i]);return r}function JI(t,e){const n=I1(t,e);for(const r in t)if(nr(t[r])||nr(e[r])){const i=th.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[i]=t[r]}return n}function R1(t,e,n,r={},i={}){return typeof e=="function"&&(e=e(n!==void 0?n:t.custom,r,i)),typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"&&(e=e(n!==void 0?n:t.custom,r,i)),e}function ZI(t){const e=Y.useRef(null);return e.current===null&&(e.current=t()),e.current}const Ed=t=>Array.isArray(t),WF=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),zF=t=>Ed(t)?t[t.length-1]||0:t;function Wf(t){const e=nr(t)?t.get():t;return WF(e)?e.toValue():e}function $F({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},r,i,o){const s={latestValues:HF(r,i,o,t),renderState:e()};return n&&(s.mount=a=>n(r,a,s)),s}const eR=t=>(e,n)=>{const r=Y.useContext(Vp),i=Y.useContext(Bp),o=()=>$F(t,e,r,i);return n?o():ZI(o)};function HF(t,e,n,r){const i={},o=r(t,{});for(const f in o)i[f]=Wf(o[f]);let{initial:s,animate:a}=t;const u=Wp(t),l=BI(t);e&&l&&!u&&t.inherit!==!1&&(s===void 0&&(s=e.initial),a===void 0&&(a=e.animate));let c=n?n.initial===!1:!1;c=c||s===!1;const h=c?a:s;return h&&typeof h!="boolean"&&!Up(h)&&(Array.isArray(h)?h:[h]).forEach(d=>{const m=R1(t,d);if(!m)return;const{transitionEnd:v,transition:y,...g}=m;for(const _ in g){let w=g[_];if(Array.isArray(w)){const x=c?w.length-1:0;w=w[x]}w!==null&&(i[_]=w)}for(const _ in v)i[_]=v[_]}),i}const Nt=t=>t;class zb{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const n=this.order.indexOf(e);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function GF(t){let e=new zb,n=new zb,r=0,i=!1,o=!1;const s=new WeakSet,a={schedule:(u,l=!1,c=!1)=>{const h=c&&i,f=h?e:n;return l&&s.add(u),f.add(u)&&h&&i&&(r=e.order.length),u},cancel:u=>{n.remove(u),s.delete(u)},process:u=>{if(i){o=!0;return}if(i=!0,[e,n]=[n,e],n.clear(),r=e.order.length,r)for(let l=0;l<r;l++){const c=e.order[l];c(u),s.has(c)&&(a.schedule(c),t())}i=!1,o&&(o=!1,a.process(u))}};return a}const of=["prepare","read","update","preRender","render","postRender"],qF=40;function KF(t,e){let n=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=of.reduce((h,f)=>(h[f]=GF(()=>n=!0),h),{}),s=h=>o[h].process(i),a=()=>{const h=performance.now();n=!1,i.delta=r?1e3/60:Math.max(Math.min(h-i.timestamp,qF),1),i.timestamp=h,i.isProcessing=!0,of.forEach(s),i.isProcessing=!1,n&&e&&(r=!1,t(a))},u=()=>{n=!0,r=!0,i.isProcessing||t(a)};return{schedule:of.reduce((h,f)=>{const d=o[f];return h[f]=(m,v=!1,y=!1)=>(n||u(),d.schedule(m,v,y)),h},{}),cancel:h=>of.forEach(f=>o[f].cancel(h)),state:i,steps:o}}const{schedule:rt,cancel:Ji,state:_n,steps:pg}=KF(typeof requestAnimationFrame<"u"?requestAnimationFrame:Nt,!0),XF={useVisualState:eR({scrapeMotionValuesFromProps:JI,createRenderState:KI,onMount:(t,e,{renderState:n,latestValues:r})=>{rt.read(()=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),rt.render(()=>{S1(n,r,{enableHardwareAcceleration:!1},T1(e.tagName),t.transformTemplate),QI(e,n)})}})},YF={useVisualState:eR({scrapeMotionValuesFromProps:I1,createRenderState:C1})};function QF(t,{forwardMotionProps:e=!1},n,r){return{...b1(t)?XF:YF,preloadedFeatures:n,useRender:UF(e),createVisualElement:r,Component:t}}function Bi(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}const tR=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function $p(t,e="page"){return{point:{x:t[e+"X"],y:t[e+"Y"]}}}const JF=t=>e=>tR(e)&&t(e,$p(e));function Wi(t,e,n,r){return Bi(t,e,JF(n),r)}const ZF=(t,e)=>n=>e(t(n)),Vo=(...t)=>t.reduce(ZF);function nR(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const $b=nR("dragHorizontal"),Hb=nR("dragVertical");function rR(t){let e=!1;if(t==="y")e=Hb();else if(t==="x")e=$b();else{const n=$b(),r=Hb();n&&r?e=()=>{n(),r()}:(n&&n(),r&&r())}return e}function iR(){const t=rR(!0);return t?(t(),!1):!0}class us{constructor(e){this.isMounted=!1,this.node=e}update(){}}function Gb(t,e){const n="pointer"+(e?"enter":"leave"),r="onHover"+(e?"Start":"End"),i=(o,s)=>{if(o.pointerType==="touch"||iR())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e),a[r]&&rt.update(()=>a[r](o,s))};return Wi(t.current,n,i,{passive:!t.getProps()[r]})}class eO extends us{mount(){this.unmount=Vo(Gb(this.node,!0),Gb(this.node,!1))}unmount(){}}class tO extends us{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Vo(Bi(this.node.current,"focus",()=>this.onFocus()),Bi(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const oR=(t,e)=>e?t===e?!0:oR(t,e.parentElement):!1;function mg(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,$p(n))}class nO extends us{constructor(){super(...arguments),this.removeStartListeners=Nt,this.removeEndListeners=Nt,this.removeAccessibleListeners=Nt,this.startPointerPress=(e,n)=>{if(this.isPressing)return;this.removeEndListeners();const r=this.node.getProps(),o=Wi(window,"pointerup",(a,u)=>{if(!this.checkPressEnd())return;const{onTap:l,onTapCancel:c,globalTapTarget:h}=this.node.getProps();rt.update(()=>{!h&&!oR(this.node.current,a.target)?c&&c(a,u):l&&l(a,u)})},{passive:!(r.onTap||r.onPointerUp)}),s=Wi(window,"pointercancel",(a,u)=>this.cancelPress(a,u),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=Vo(o,s),this.startPress(e,n)},this.startAccessiblePress=()=>{const e=o=>{if(o.key!=="Enter"||this.isPressing)return;const s=a=>{a.key!=="Enter"||!this.checkPressEnd()||mg("up",(u,l)=>{const{onTap:c}=this.node.getProps();c&&rt.update(()=>c(u,l))})};this.removeEndListeners(),this.removeEndListeners=Bi(this.node.current,"keyup",s),mg("down",(a,u)=>{this.startPress(a,u)})},n=Bi(this.node.current,"keydown",e),r=()=>{this.isPressing&&mg("cancel",(o,s)=>this.cancelPress(o,s))},i=Bi(this.node.current,"blur",r);this.removeAccessibleListeners=Vo(n,i)}}startPress(e,n){this.isPressing=!0;const{onTapStart:r,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&rt.update(()=>r(e,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!iR()}cancelPress(e,n){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&rt.update(()=>r(e,n))}mount(){const e=this.node.getProps(),n=Wi(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),r=Bi(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Vo(n,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const cy=new WeakMap,gg=new WeakMap,rO=t=>{const e=cy.get(t.target);e&&e(t)},iO=t=>{t.forEach(rO)};function oO({root:t,...e}){const n=t||document;gg.has(n)||gg.set(n,{});const r=gg.get(n),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(iO,{root:t,...e})),r[i]}function sO(t,e,n){const r=oO(e);return cy.set(t,n),r.observe(t),()=>{cy.delete(t),r.unobserve(t)}}const aO={some:0,all:1};class uO extends us{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:i="some",once:o}=e,s={root:n?n.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:aO[i]},a=u=>{const{isIntersecting:l}=u;if(this.isInView===l||(this.isInView=l,o&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:c,onViewportLeave:h}=this.node.getProps(),f=l?c:h;f&&f(u)};return sO(this.node.current,s,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(lO(e,n))&&this.startObserver()}unmount(){}}function lO({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const cO={inView:{Feature:uO},tap:{Feature:nO},focus:{Feature:tO},hover:{Feature:eO}};function sR(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function hO(t){const e={};return t.values.forEach((n,r)=>e[r]=n.get()),e}function fO(t){const e={};return t.values.forEach((n,r)=>e[r]=n.getVelocity()),e}function Hp(t,e,n){const r=t.getProps();return R1(r,e,n!==void 0?n:r.custom,hO(t),fO(t))}let A1=Nt;const Us=t=>t*1e3,zi=t=>t/1e3,dO={current:!1},aR=t=>Array.isArray(t)&&typeof t[0]=="number";function uR(t){return!!(!t||typeof t=="string"&&lR[t]||aR(t)||Array.isArray(t)&&t.every(uR))}const Vl=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,lR={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Vl([0,.65,.55,1]),circOut:Vl([.55,0,1,.45]),backIn:Vl([.31,.01,.66,-.59]),backOut:Vl([.33,1.53,.69,.99])};function cR(t){if(t)return aR(t)?Vl(t):Array.isArray(t)?t.map(cR):lR[t]}function pO(t,e,n,{delay:r=0,duration:i,repeat:o=0,repeatType:s="loop",ease:a,times:u}={}){const l={[e]:n};u&&(l.offset=u);const c=cR(a);return Array.isArray(c)&&(l.easing=c),t.animate(l,{delay:r,duration:i,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:o+1,direction:s==="reverse"?"alternate":"normal"})}function mO(t,{repeat:e,repeatType:n="loop"}){const r=e&&n!=="loop"&&e%2===1?0:t.length-1;return t[r]}const hR=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,gO=1e-7,vO=12;function yO(t,e,n,r,i){let o,s,a=0;do s=e+(n-e)/2,o=hR(s,r,i)-t,o>0?n=s:e=s;while(Math.abs(o)>gO&&++a<vO);return s}function ih(t,e,n,r){if(t===e&&n===r)return Nt;const i=o=>yO(o,0,1,t,n);return o=>o===0||o===1?o:hR(i(o),e,r)}const _O=ih(.42,0,1,1),wO=ih(0,0,.58,1),fR=ih(.42,0,.58,1),xO=t=>Array.isArray(t)&&typeof t[0]!="number",dR=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,pR=t=>e=>1-t(1-e),k1=t=>1-Math.sin(Math.acos(t)),mR=pR(k1),bO=dR(k1),gR=ih(.33,1.53,.69,.99),P1=pR(gR),EO=dR(P1),CO=t=>(t*=2)<1?.5*P1(t):.5*(2-Math.pow(2,-10*(t-1))),SO={linear:Nt,easeIn:_O,easeInOut:fR,easeOut:wO,circIn:k1,circInOut:bO,circOut:mR,backIn:P1,backInOut:EO,backOut:gR,anticipate:CO},qb=t=>{if(Array.isArray(t)){A1(t.length===4);const[e,n,r,i]=t;return ih(e,n,r,i)}else if(typeof t=="string")return SO[t];return t},N1=(t,e)=>n=>!!(nh(n)&&IF.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),vR=(t,e,n)=>r=>{if(!nh(r))return r;const[i,o,s,a]=r.match(zp);return{[t]:parseFloat(i),[e]:parseFloat(o),[n]:parseFloat(s),alpha:a!==void 0?parseFloat(a):1}},TO=t=>Yo(0,255,t),vg={...la,transform:t=>Math.round(TO(t))},Ms={test:N1("rgb","red"),parse:vR("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+vg.transform(t)+", "+vg.transform(e)+", "+vg.transform(n)+", "+Yl(Xl.transform(r))+")"};function IO(t){let e="",n="",r="",i="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),i=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),i=t.substring(4,5),e+=e,n+=n,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const hy={test:N1("#"),parse:IO,transform:Ms.transform},Xa={test:N1("hsl","hue"),parse:vR("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+yi.transform(Yl(e))+", "+yi.transform(Yl(n))+", "+Yl(Xl.transform(r))+")"},On={test:t=>Ms.test(t)||hy.test(t)||Xa.test(t),parse:t=>Ms.test(t)?Ms.parse(t):Xa.test(t)?Xa.parse(t):hy.parse(t),transform:t=>nh(t)?t:t.hasOwnProperty("red")?Ms.transform(t):Xa.transform(t)},xt=(t,e,n)=>-n*t+n*e+t;function yg(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function RO({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let i=0,o=0,s=0;if(!e)i=o=s=n;else{const a=n<.5?n*(1+e):n+e-n*e,u=2*n-a;i=yg(u,a,t+1/3),o=yg(u,a,t),s=yg(u,a,t-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(s*255),alpha:r}}const _g=(t,e,n)=>{const r=t*t;return Math.sqrt(Math.max(0,n*(e*e-r)+r))},AO=[hy,Ms,Xa],kO=t=>AO.find(e=>e.test(t));function Kb(t){const e=kO(t);let n=e.parse(t);return e===Xa&&(n=RO(n)),n}const yR=(t,e)=>{const n=Kb(t),r=Kb(e),i={...n};return o=>(i.red=_g(n.red,r.red,o),i.green=_g(n.green,r.green,o),i.blue=_g(n.blue,r.blue,o),i.alpha=xt(n.alpha,r.alpha,o),Ms.transform(i))};function PO(t){var e,n;return isNaN(t)&&nh(t)&&(((e=t.match(zp))===null||e===void 0?void 0:e.length)||0)+(((n=t.match($I))===null||n===void 0?void 0:n.length)||0)>0}const _R={regex:SF,countKey:"Vars",token:"${v}",parse:Nt},wR={regex:$I,countKey:"Colors",token:"${c}",parse:On.parse},xR={regex:zp,countKey:"Numbers",token:"${n}",parse:la.parse};function wg(t,{regex:e,countKey:n,token:r,parse:i}){const o=t.tokenised.match(e);o&&(t["num"+n]=o.length,t.tokenised=t.tokenised.replace(e,r),t.values.push(...o.map(i)))}function Cd(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&wg(n,_R),wg(n,wR),wg(n,xR),n}function bR(t){return Cd(t).values}function ER(t){const{values:e,numColors:n,numVars:r,tokenised:i}=Cd(t),o=e.length;return s=>{let a=i;for(let u=0;u<o;u++)u<r?a=a.replace(_R.token,s[u]):u<r+n?a=a.replace(wR.token,On.transform(s[u])):a=a.replace(xR.token,Yl(s[u]));return a}}const NO=t=>typeof t=="number"?0:t;function DO(t){const e=bR(t);return ER(t)(e.map(NO))}const Qo={test:PO,parse:bR,createTransformer:ER,getAnimatableNone:DO},CR=(t,e)=>n=>`${n>0?e:t}`;function SR(t,e){return typeof t=="number"?n=>xt(t,e,n):On.test(t)?yR(t,e):t.startsWith("var(")?CR(t,e):IR(t,e)}const TR=(t,e)=>{const n=[...t],r=n.length,i=t.map((o,s)=>SR(o,e[s]));return o=>{for(let s=0;s<r;s++)n[s]=i[s](o);return n}},MO=(t,e)=>{const n={...t,...e},r={};for(const i in n)t[i]!==void 0&&e[i]!==void 0&&(r[i]=SR(t[i],e[i]));return i=>{for(const o in r)n[o]=r[o](i);return n}},IR=(t,e)=>{const n=Qo.createTransformer(e),r=Cd(t),i=Cd(e);return r.numVars===i.numVars&&r.numColors===i.numColors&&r.numNumbers>=i.numNumbers?Vo(TR(r.values,i.values),n):CR(t,e)},Pc=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r},Xb=(t,e)=>n=>xt(t,e,n);function FO(t){return typeof t=="number"?Xb:typeof t=="string"?On.test(t)?yR:IR:Array.isArray(t)?TR:typeof t=="object"?MO:Xb}function OO(t,e,n){const r=[],i=n||FO(t[0]),o=t.length-1;for(let s=0;s<o;s++){let a=i(t[s],t[s+1]);if(e){const u=Array.isArray(e)?e[s]||Nt:e;a=Vo(u,a)}r.push(a)}return r}function RR(t,e,{clamp:n=!0,ease:r,mixer:i}={}){const o=t.length;if(A1(o===e.length),o===1)return()=>e[0];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const s=OO(e,r,i),a=s.length,u=l=>{let c=0;if(a>1)for(;c<t.length-2&&!(l<t[c+1]);c++);const h=Pc(t[c],t[c+1],l);return s[c](h)};return n?l=>u(Yo(t[0],t[o-1],l)):u}function LO(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const i=Pc(0,e,r);t.push(xt(n,1,i))}}function VO(t){const e=[0];return LO(e,t.length-1),e}function BO(t,e){return t.map(n=>n*e)}function jO(t,e){return t.map(()=>e||fR).splice(0,t.length-1)}function Sd({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const i=xO(r)?r.map(qb):qb(r),o={done:!1,value:e[0]},s=BO(n&&n.length===e.length?n:VO(e),t),a=RR(s,e,{ease:Array.isArray(i)?i:jO(e,i)});return{calculatedDuration:t,next:u=>(o.value=a(u),o.done=u>=t,o)}}function AR(t,e){return e?t*(1e3/e):0}const UO=5;function kR(t,e,n){const r=Math.max(e-UO,0);return AR(n-t(r),e-r)}const xg=.001,WO=.01,zO=10,$O=.05,HO=1;function GO({duration:t=800,bounce:e=.25,velocity:n=0,mass:r=1}){let i,o,s=1-e;s=Yo($O,HO,s),t=Yo(WO,zO,zi(t)),s<1?(i=l=>{const c=l*s,h=c*t,f=c-n,d=fy(l,s),m=Math.exp(-h);return xg-f/d*m},o=l=>{const h=l*s*t,f=h*n+n,d=Math.pow(s,2)*Math.pow(l,2)*t,m=Math.exp(-h),v=fy(Math.pow(l,2),s);return(-i(l)+xg>0?-1:1)*((f-d)*m)/v}):(i=l=>{const c=Math.exp(-l*t),h=(l-n)*t+1;return-xg+c*h},o=l=>{const c=Math.exp(-l*t),h=(n-l)*(t*t);return c*h});const a=5/t,u=KO(i,o,a);if(t=Us(t),isNaN(u))return{stiffness:100,damping:10,duration:t};{const l=Math.pow(u,2)*r;return{stiffness:l,damping:s*2*Math.sqrt(r*l),duration:t}}}const qO=12;function KO(t,e,n){let r=n;for(let i=1;i<qO;i++)r=r-t(r)/e(r);return r}function fy(t,e){return t*Math.sqrt(1-e*e)}const XO=["duration","bounce"],YO=["stiffness","damping","mass"];function Yb(t,e){return e.some(n=>t[n]!==void 0)}function QO(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!Yb(t,YO)&&Yb(t,XO)){const n=GO(t);e={...e,...n,mass:1},e.isResolvedFromDuration=!0}return e}function PR({keyframes:t,restDelta:e,restSpeed:n,...r}){const i=t[0],o=t[t.length-1],s={done:!1,value:i},{stiffness:a,damping:u,mass:l,duration:c,velocity:h,isResolvedFromDuration:f}=QO({...r,velocity:-zi(r.velocity||0)}),d=h||0,m=u/(2*Math.sqrt(a*l)),v=o-i,y=zi(Math.sqrt(a/l)),g=Math.abs(v)<5;n||(n=g?.01:2),e||(e=g?.005:.5);let _;if(m<1){const w=fy(y,m);_=x=>{const S=Math.exp(-m*y*x);return o-S*((d+m*y*v)/w*Math.sin(w*x)+v*Math.cos(w*x))}}else if(m===1)_=w=>o-Math.exp(-y*w)*(v+(d+y*v)*w);else{const w=y*Math.sqrt(m*m-1);_=x=>{const S=Math.exp(-m*y*x),A=Math.min(w*x,300);return o-S*((d+m*y*v)*Math.sinh(A)+w*v*Math.cosh(A))/w}}return{calculatedDuration:f&&c||null,next:w=>{const x=_(w);if(f)s.done=w>=c;else{let S=d;w!==0&&(m<1?S=kR(_,w,x):S=0);const A=Math.abs(S)<=n,T=Math.abs(o-x)<=e;s.done=A&&T}return s.value=s.done?o:x,s}}}function Qb({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:s,min:a,max:u,restDelta:l=.5,restSpeed:c}){const h=t[0],f={done:!1,value:h},d=E=>a!==void 0&&E<a||u!==void 0&&E>u,m=E=>a===void 0?u:u===void 0||Math.abs(a-E)<Math.abs(u-E)?a:u;let v=n*e;const y=h+v,g=s===void 0?y:s(y);g!==y&&(v=g-h);const _=E=>-v*Math.exp(-E/r),w=E=>g+_(E),x=E=>{const C=_(E),I=w(E);f.done=Math.abs(C)<=l,f.value=f.done?g:I};let S,A;const T=E=>{d(f.value)&&(S=E,A=PR({keyframes:[f.value,m(f.value)],velocity:kR(w,E,f.value),damping:i,stiffness:o,restDelta:l,restSpeed:c}))};return T(0),{calculatedDuration:null,next:E=>{let C=!1;return!A&&S===void 0&&(C=!0,x(E),T(E)),S!==void 0&&E>S?A.next(E-S):(!C&&x(E),f)}}}const JO=t=>{const e=({timestamp:n})=>t(n);return{start:()=>rt.update(e,!0),stop:()=>Ji(e),now:()=>_n.isProcessing?_n.timestamp:performance.now()}},Jb=2e4;function Zb(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<Jb;)e+=n,r=t.next(e);return e>=Jb?1/0:e}const ZO={decay:Qb,inertia:Qb,tween:Sd,keyframes:Sd,spring:PR};function Td({autoplay:t=!0,delay:e=0,driver:n=JO,keyframes:r,type:i="keyframes",repeat:o=0,repeatDelay:s=0,repeatType:a="loop",onPlay:u,onStop:l,onComplete:c,onUpdate:h,...f}){let d=1,m=!1,v,y;const g=()=>{y=new Promise(Q=>{v=Q})};g();let _;const w=ZO[i]||Sd;let x;w!==Sd&&typeof r[0]!="number"&&(x=RR([0,100],r,{clamp:!1}),r=[0,100]);const S=w({...f,keyframes:r});let A;a==="mirror"&&(A=w({...f,keyframes:[...r].reverse(),velocity:-(f.velocity||0)}));let T="idle",E=null,C=null,I=null;S.calculatedDuration===null&&o&&(S.calculatedDuration=Zb(S));const{calculatedDuration:P}=S;let N=1/0,k=1/0;P!==null&&(N=P+s,k=N*(o+1)-s);let j=0;const W=Q=>{if(C===null)return;d>0&&(C=Math.min(C,Q)),d<0&&(C=Math.min(Q-k/d,C)),E!==null?j=E:j=Math.round(Q-C)*d;const te=j-e*(d>=0?1:-1),ie=d>=0?te<0:te>k;j=Math.max(te,0),T==="finished"&&E===null&&(j=k);let we=j,_e=S;if(o){const Se=Math.min(j,k)/N;let qe=Math.floor(Se),Ee=Se%1;!Ee&&Se>=1&&(Ee=1),Ee===1&&qe--,qe=Math.min(qe,o+1),!!(qe%2)&&(a==="reverse"?(Ee=1-Ee,s&&(Ee-=s/N)):a==="mirror"&&(_e=A)),we=Yo(0,1,Ee)*N}const ce=ie?{done:!1,value:r[0]}:_e.next(we);x&&(ce.value=x(ce.value));let{done:be}=ce;!ie&&P!==null&&(be=d>=0?j>=k:j<=0);const xe=E===null&&(T==="finished"||T==="running"&&be);return h&&h(ce.value),xe&&V(),ce},q=()=>{_&&_.stop(),_=void 0},X=()=>{T="idle",q(),v(),g(),C=I=null},V=()=>{T="finished",c&&c(),q(),v()},z=()=>{if(m)return;_||(_=n(W));const Q=_.now();u&&u(),E!==null?C=Q-E:(!C||T==="finished")&&(C=Q),T==="finished"&&g(),I=C,E=null,T="running",_.start()};t&&z();const U={then(Q,te){return y.then(Q,te)},get time(){return zi(j)},set time(Q){Q=Us(Q),j=Q,E!==null||!_||d===0?E=Q:C=_.now()-Q/d},get duration(){const Q=S.calculatedDuration===null?Zb(S):S.calculatedDuration;return zi(Q)},get speed(){return d},set speed(Q){Q===d||!_||(d=Q,U.time=zi(j))},get state(){return T},play:z,pause:()=>{T="paused",E=j},stop:()=>{m=!0,T!=="idle"&&(T="idle",l&&l(),X())},cancel:()=>{I!==null&&W(I),X()},complete:()=>{T="finished"},sample:Q=>(C=0,W(Q))};return U}function eL(t){let e;return()=>(e===void 0&&(e=t()),e)}const tL=eL(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),nL=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),sf=10,rL=2e4,iL=(t,e)=>e.type==="spring"||t==="backgroundColor"||!uR(e.ease);function oL(t,e,{onUpdate:n,onComplete:r,...i}){if(!(tL()&&nL.has(e)&&!i.repeatDelay&&i.repeatType!=="mirror"&&i.damping!==0&&i.type!=="inertia"))return!1;let s=!1,a,u,l=!1;const c=()=>{u=new Promise(w=>{a=w})};c();let{keyframes:h,duration:f=300,ease:d,times:m}=i;if(iL(e,i)){const w=Td({...i,repeat:0,delay:0});let x={done:!1,value:h[0]};const S=[];let A=0;for(;!x.done&&A<rL;)x=w.sample(A),S.push(x.value),A+=sf;m=void 0,h=S,f=A-sf,d="linear"}const v=pO(t.owner.current,e,h,{...i,duration:f,ease:d,times:m}),y=()=>{l=!1,v.cancel()},g=()=>{l=!0,rt.update(y),a(),c()};return v.onfinish=()=>{l||(t.set(mO(h,i)),r&&r(),g())},{then(w,x){return u.then(w,x)},attachTimeline(w){return v.timeline=w,v.onfinish=null,Nt},get time(){return zi(v.currentTime||0)},set time(w){v.currentTime=Us(w)},get speed(){return v.playbackRate},set speed(w){v.playbackRate=w},get duration(){return zi(f)},play:()=>{s||(v.play(),Ji(y))},pause:()=>v.pause(),stop:()=>{if(s=!0,v.playState==="idle")return;const{currentTime:w}=v;if(w){const x=Td({...i,autoplay:!1});t.setWithVelocity(x.sample(w-sf).value,x.sample(w).value,sf)}g()},complete:()=>{l||v.finish()},cancel:g}}function sL({keyframes:t,delay:e,onUpdate:n,onComplete:r}){const i=()=>(n&&n(t[t.length-1]),r&&r(),{time:0,speed:1,duration:0,play:Nt,pause:Nt,stop:Nt,then:o=>(o(),Promise.resolve()),cancel:Nt,complete:Nt});return e?Td({keyframes:[0,1],duration:0,delay:e,onComplete:i}):i()}const aL={type:"spring",stiffness:500,damping:25,restSpeed:10},uL=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),lL={type:"keyframes",duration:.8},cL={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},hL=(t,{keyframes:e})=>e.length>2?lL:ua.has(t)?t.startsWith("scale")?uL(e[1]):aL:cL,dy=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Qo.test(e)||e==="0")&&!e.startsWith("url(")),fL=new Set(["brightness","contrast","saturate","opacity"]);function dL(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(zp)||[];if(!r)return t;const i=n.replace(r,"");let o=fL.has(e)?1:0;return r!==n&&(o*=100),e+"("+o+i+")"}const pL=/([a-z-]*)\(.*?\)/g,py={...Qo,getAnimatableNone:t=>{const e=t.match(pL);return e?e.map(dL).join(" "):t}},mL={...HI,color:On,backgroundColor:On,outlineColor:On,fill:On,stroke:On,borderColor:On,borderTopColor:On,borderRightColor:On,borderBottomColor:On,borderLeftColor:On,filter:py,WebkitFilter:py},D1=t=>mL[t];function NR(t,e){let n=D1(t);return n!==py&&(n=Qo),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const DR=t=>/^0[^.\s]+$/.test(t);function gL(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||DR(t)}function vL(t,e,n,r){const i=dy(e,n);let o;Array.isArray(n)?o=[...n]:o=[null,n];const s=r.from!==void 0?r.from:t.get();let a;const u=[];for(let l=0;l<o.length;l++)o[l]===null&&(o[l]=l===0?s:o[l-1]),gL(o[l])&&u.push(l),typeof o[l]=="string"&&o[l]!=="none"&&o[l]!=="0"&&(a=o[l]);if(i&&u.length&&a)for(let l=0;l<u.length;l++){const c=u[l];o[c]=NR(e,a)}return o}function yL({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:i,repeat:o,repeatType:s,repeatDelay:a,from:u,elapsed:l,...c}){return!!Object.keys(c).length}function M1(t,e){return t[e]||t.default||t}const _L={skipAnimations:!1},F1=(t,e,n,r={})=>i=>{const o=M1(r,t)||{},s=o.delay||r.delay||0;let{elapsed:a=0}=r;a=a-Us(s);const u=vL(e,t,n,o),l=u[0],c=u[u.length-1],h=dy(t,l),f=dy(t,c);let d={keyframes:u,velocity:e.getVelocity(),ease:"easeOut",...o,delay:-a,onUpdate:m=>{e.set(m),o.onUpdate&&o.onUpdate(m)},onComplete:()=>{i(),o.onComplete&&o.onComplete()}};if(yL(o)||(d={...d,...hL(t,d)}),d.duration&&(d.duration=Us(d.duration)),d.repeatDelay&&(d.repeatDelay=Us(d.repeatDelay)),!h||!f||dO.current||o.type===!1||_L.skipAnimations)return sL(d);if(!r.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const m=oL(e,t,d);if(m)return m}return Td(d)};function Id(t){return!!(nr(t)&&t.add)}const MR=t=>/^\-?\d*\.?\d+$/.test(t);function O1(t,e){t.indexOf(e)===-1&&t.push(e)}function L1(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class V1{constructor(){this.subscriptions=[]}add(e){return O1(this.subscriptions,e),()=>L1(this.subscriptions,e)}notify(e,n,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,n,r);else for(let o=0;o<i;o++){const s=this.subscriptions[o];s&&s(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const wL=t=>!isNaN(parseFloat(t));class xL{constructor(e,n={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(r,i=!0)=>{this.prev=this.current,this.current=r;const{delta:o,timestamp:s}=_n;this.lastUpdated!==s&&(this.timeDelta=o,this.lastUpdated=s,rt.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>rt.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=wL(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new V1);const r=this.events[e].add(n);return e==="change"?()=>{r(),rt.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,r){this.set(n),this.prev=e,this.timeDelta=r}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?AR(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Tu(t,e){return new xL(t,e)}const FR=t=>e=>e.test(t),bL={test:t=>t==="auto",parse:t=>t},OR=[la,Te,yi,wo,AF,RF,bL],bl=t=>OR.find(FR(t)),EL=[...OR,On,Qo],CL=t=>EL.find(FR(t));function SL(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Tu(n))}function TL(t,e){const n=Hp(t,e);let{transitionEnd:r={},transition:i={},...o}=n?t.makeTargetAnimatable(n,!1):{};o={...o,...r};for(const s in o){const a=zF(o[s]);SL(t,s,a)}}function IL(t,e,n){var r,i;const o=Object.keys(e).filter(a=>!t.hasValue(a)),s=o.length;if(s)for(let a=0;a<s;a++){const u=o[a],l=e[u];let c=null;Array.isArray(l)&&(c=l[0]),c===null&&(c=(i=(r=n[u])!==null&&r!==void 0?r:t.readValue(u))!==null&&i!==void 0?i:e[u]),c!=null&&(typeof c=="string"&&(MR(c)||DR(c))?c=parseFloat(c):!CL(c)&&Qo.test(l)&&(c=NR(u,l)),t.addValue(u,Tu(c,{owner:t})),n[u]===void 0&&(n[u]=c),c!==null&&t.setBaseTarget(u,c))}}function RL(t,e){return e?(e[t]||e.default||e).from:void 0}function AL(t,e,n){const r={};for(const i in t){const o=RL(i,e);if(o!==void 0)r[i]=o;else{const s=n.getValue(i);s&&(r[i]=s.get())}}return r}function kL({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function PL(t,e){const n=t.get();if(Array.isArray(e)){for(let r=0;r<e.length;r++)if(e[r]!==n)return!0}else return n!==e}function LR(t,e,{delay:n=0,transitionOverride:r,type:i}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:s,...a}=t.makeTargetAnimatable(e);const u=t.getValue("willChange");r&&(o=r);const l=[],c=i&&t.animationState&&t.animationState.getState()[i];for(const h in a){const f=t.getValue(h),d=a[h];if(!f||d===void 0||c&&kL(c,h))continue;const m={delay:n,elapsed:0,...M1(o||{},h)};if(window.HandoffAppearAnimations){const g=t.getProps()[VI];if(g){const _=window.HandoffAppearAnimations(g,h,f,rt);_!==null&&(m.elapsed=_,m.isHandoff=!0)}}let v=!m.isHandoff&&!PL(f,d);if(m.type==="spring"&&(f.getVelocity()||m.velocity)&&(v=!1),f.animation&&(v=!1),v)continue;f.start(F1(h,f,d,t.shouldReduceMotion&&ua.has(h)?{type:!1}:m));const y=f.animation;Id(u)&&(u.add(h),y.then(()=>u.remove(h))),l.push(y)}return s&&Promise.all(l).then(()=>{s&&TL(t,s)}),l}function my(t,e,n={}){const r=Hp(t,e,n.custom);let{transition:i=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const o=r?()=>Promise.all(LR(t,r,n)):()=>Promise.resolve(),s=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:l=0,staggerChildren:c,staggerDirection:h}=i;return NL(t,e,l+u,c,h,n)}:()=>Promise.resolve(),{when:a}=i;if(a){const[u,l]=a==="beforeChildren"?[o,s]:[s,o];return u().then(()=>l())}else return Promise.all([o(),s(n.delay)])}function NL(t,e,n=0,r=0,i=1,o){const s=[],a=(t.variantChildren.size-1)*r,u=i===1?(l=0)=>l*r:(l=0)=>a-l*r;return Array.from(t.variantChildren).sort(DL).forEach((l,c)=>{l.notify("AnimationStart",e),s.push(my(l,e,{...o,delay:n+u(c)}).then(()=>l.notify("AnimationComplete",e)))}),Promise.all(s)}function DL(t,e){return t.sortNodePosition(e)}function ML(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(o=>my(t,o,n));r=Promise.all(i)}else if(typeof e=="string")r=my(t,e,n);else{const i=typeof e=="function"?Hp(t,e,n.custom):e;r=Promise.all(LR(t,i,n))}return r.then(()=>t.notify("AnimationComplete",e))}const FL=[..._1].reverse(),OL=_1.length;function LL(t){return e=>Promise.all(e.map(({animation:n,options:r})=>ML(t,n,r)))}function VL(t){let e=LL(t);const n=jL();let r=!0;const i=(u,l)=>{const c=Hp(t,l);if(c){const{transition:h,transitionEnd:f,...d}=c;u={...u,...d,...f}}return u};function o(u){e=u(t)}function s(u,l){const c=t.getProps(),h=t.getVariantContext(!0)||{},f=[],d=new Set;let m={},v=1/0;for(let g=0;g<OL;g++){const _=FL[g],w=n[_],x=c[_]!==void 0?c[_]:h[_],S=Ac(x),A=_===l?w.isActive:null;A===!1&&(v=g);let T=x===h[_]&&x!==c[_]&&S;if(T&&r&&t.manuallyAnimateOnMount&&(T=!1),w.protectedKeys={...m},!w.isActive&&A===null||!x&&!w.prevProp||Up(x)||typeof x=="boolean")continue;let C=BL(w.prevProp,x)||_===l&&w.isActive&&!T&&S||g>v&&S,I=!1;const P=Array.isArray(x)?x:[x];let N=P.reduce(i,{});A===!1&&(N={});const{prevResolvedValues:k={}}=w,j={...k,...N},W=q=>{C=!0,d.has(q)&&(I=!0,d.delete(q)),w.needsAnimating[q]=!0};for(const q in j){const X=N[q],V=k[q];if(m.hasOwnProperty(q))continue;let z=!1;Ed(X)&&Ed(V)?z=!sR(X,V):z=X!==V,z?X!==void 0?W(q):d.add(q):X!==void 0&&d.has(q)?W(q):w.protectedKeys[q]=!0}w.prevProp=x,w.prevResolvedValues=N,w.isActive&&(m={...m,...N}),r&&t.blockInitialAnimation&&(C=!1),C&&(!T||I)&&f.push(...P.map(q=>({animation:q,options:{type:_,...u}})))}if(d.size){const g={};d.forEach(_=>{const w=t.getBaseTarget(_);w!==void 0&&(g[_]=w)}),f.push({animation:g})}let y=!!f.length;return r&&(c.initial===!1||c.initial===c.animate)&&!t.manuallyAnimateOnMount&&(y=!1),r=!1,y?e(f):Promise.resolve()}function a(u,l,c){var h;if(n[u].isActive===l)return Promise.resolve();(h=t.variantChildren)===null||h===void 0||h.forEach(d=>{var m;return(m=d.animationState)===null||m===void 0?void 0:m.setActive(u,l)}),n[u].isActive=l;const f=s(c,u);for(const d in n)n[d].protectedKeys={};return f}return{animateChanges:s,setActive:a,setAnimateFunction:o,getState:()=>n}}function BL(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!sR(e,t):!1}function _s(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function jL(){return{animate:_s(!0),whileInView:_s(),whileHover:_s(),whileTap:_s(),whileDrag:_s(),whileFocus:_s(),exit:_s()}}class UL extends us{constructor(e){super(e),e.animationState||(e.animationState=VL(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),Up(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let WL=0;class zL extends us{constructor(){super(...arguments),this.id=WL++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n,custom:r}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const o=this.node.animationState.setActive("exit",!e,{custom:r??this.node.getProps().custom});n&&!e&&o.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const $L={animation:{Feature:UL},exit:{Feature:zL}},eE=(t,e)=>Math.abs(t-e);function HL(t,e){const n=eE(t.x,e.x),r=eE(t.y,e.y);return Math.sqrt(n**2+r**2)}class VR{constructor(e,n,{transformPagePoint:r,contextWindow:i,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Eg(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,d=HL(h.offset,{x:0,y:0})>=3;if(!f&&!d)return;const{point:m}=h,{timestamp:v}=_n;this.history.push({...m,timestamp:v});const{onStart:y,onMove:g}=this.handlers;f||(y&&y(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=bg(f,this.transformPagePoint),rt.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:d,onSessionEnd:m,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Eg(h.type==="pointercancel"?this.lastMoveEventInfo:bg(f,this.transformPagePoint),this.history);this.startEvent&&d&&d(h,y),m&&m(h,y)},!tR(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=r,this.contextWindow=i||window;const s=$p(e),a=bg(s,this.transformPagePoint),{point:u}=a,{timestamp:l}=_n;this.history=[{...u,timestamp:l}];const{onSessionStart:c}=n;c&&c(e,Eg(a,this.history)),this.removeListeners=Vo(Wi(this.contextWindow,"pointermove",this.handlePointerMove),Wi(this.contextWindow,"pointerup",this.handlePointerUp),Wi(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ji(this.updatePoint)}}function bg(t,e){return e?{point:e(t.point)}:t}function tE(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Eg({point:t},e){return{point:t,delta:tE(t,BR(e)),offset:tE(t,GL(e)),velocity:qL(e,.1)}}function GL(t){return t[0]}function BR(t){return t[t.length-1]}function qL(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const i=BR(t);for(;n>=0&&(r=t[n],!(i.timestamp-r.timestamp>Us(e)));)n--;if(!r)return{x:0,y:0};const o=zi(i.timestamp-r.timestamp);if(o===0)return{x:0,y:0};const s={x:(i.x-r.x)/o,y:(i.y-r.y)/o};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function yr(t){return t.max-t.min}function gy(t,e=0,n=.01){return Math.abs(t-e)<=n}function nE(t,e,n,r=.5){t.origin=r,t.originPoint=xt(e.min,e.max,t.origin),t.scale=yr(n)/yr(e),(gy(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=xt(n.min,n.max,t.origin)-t.originPoint,(gy(t.translate)||isNaN(t.translate))&&(t.translate=0)}function Ql(t,e,n,r){nE(t.x,e.x,n.x,r?r.originX:void 0),nE(t.y,e.y,n.y,r?r.originY:void 0)}function rE(t,e,n){t.min=n.min+e.min,t.max=t.min+yr(e)}function KL(t,e,n){rE(t.x,e.x,n.x),rE(t.y,e.y,n.y)}function iE(t,e,n){t.min=e.min-n.min,t.max=t.min+yr(e)}function Jl(t,e,n){iE(t.x,e.x,n.x),iE(t.y,e.y,n.y)}function XL(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?xt(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?xt(n,t,r.max):Math.min(t,n)),t}function oE(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function YL(t,{top:e,left:n,bottom:r,right:i}){return{x:oE(t.x,n,i),y:oE(t.y,e,r)}}function sE(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function QL(t,e){return{x:sE(t.x,e.x),y:sE(t.y,e.y)}}function JL(t,e){let n=.5;const r=yr(t),i=yr(e);return i>r?n=Pc(e.min,e.max-r,t.min):r>i&&(n=Pc(t.min,t.max-i,e.min)),Yo(0,1,n)}function ZL(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const vy=.35;function eV(t=vy){return t===!1?t=0:t===!0&&(t=vy),{x:aE(t,"left","right"),y:aE(t,"top","bottom")}}function aE(t,e,n){return{min:uE(t,e),max:uE(t,n)}}function uE(t,e){return typeof t=="number"?t:t[e]||0}const lE=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ya=()=>({x:lE(),y:lE()}),cE=()=>({min:0,max:0}),Ft=()=>({x:cE(),y:cE()});function Er(t){return[t("x"),t("y")]}function jR({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function tV({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function nV(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function Cg(t){return t===void 0||t===1}function yy({scale:t,scaleX:e,scaleY:n}){return!Cg(t)||!Cg(e)||!Cg(n)}function Es(t){return yy(t)||UR(t)||t.z||t.rotate||t.rotateX||t.rotateY}function UR(t){return hE(t.x)||hE(t.y)}function hE(t){return t&&t!=="0%"}function Rd(t,e,n){const r=t-n,i=e*r;return n+i}function fE(t,e,n,r,i){return i!==void 0&&(t=Rd(t,i,r)),Rd(t,n,r)+e}function _y(t,e=0,n=1,r,i){t.min=fE(t.min,e,n,r,i),t.max=fE(t.max,e,n,r,i)}function WR(t,{x:e,y:n}){_y(t.x,e.translate,e.scale,e.originPoint),_y(t.y,n.translate,n.scale,n.originPoint)}function rV(t,e,n,r=!1){const i=n.length;if(!i)return;e.x=e.y=1;let o,s;for(let a=0;a<i;a++){o=n[a],s=o.projectionDelta;const u=o.instance;u&&u.style&&u.style.display==="contents"||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Qa(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(e.x*=s.x.scale,e.y*=s.y.scale,WR(t,s)),r&&Es(o.latestValues)&&Qa(t,o.latestValues))}e.x=dE(e.x),e.y=dE(e.y)}function dE(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function Eo(t,e){t.min=t.min+e,t.max=t.max+e}function pE(t,e,[n,r,i]){const o=e[i]!==void 0?e[i]:.5,s=xt(t.min,t.max,o);_y(t,e[n],e[r],s,e.scale)}const iV=["x","scaleX","originX"],oV=["y","scaleY","originY"];function Qa(t,e){pE(t.x,e,iV),pE(t.y,e,oV)}function zR(t,e){return jR(nV(t.getBoundingClientRect(),e))}function sV(t,e,n){const r=zR(t,n),{scroll:i}=e;return i&&(Eo(r.x,i.offset.x),Eo(r.y,i.offset.y)),r}const $R=({current:t})=>t?t.ownerDocument.defaultView:null,aV=new WeakMap;class uV{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ft(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const i=c=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor($p(c,"page").point)},o=(c,h)=>{const{drag:f,dragPropagation:d,onDragStart:m}=this.getProps();if(f&&!d&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=rR(f),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Er(y=>{let g=this.getAxisMotionValue(y).get()||0;if(yi.test(g)){const{projection:_}=this.visualElement;if(_&&_.layout){const w=_.layout.layoutBox[y];w&&(g=yr(w)*(parseFloat(g)/100))}}this.originPoint[y]=g}),m&&rt.update(()=>m(c,h),!1,!0);const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},s=(c,h)=>{const{dragPropagation:f,dragDirectionLock:d,onDirectionLock:m,onDrag:v}=this.getProps();if(!f&&!this.openGlobalLock)return;const{offset:y}=h;if(d&&this.currentDirection===null){this.currentDirection=lV(y),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",h.point,y),this.updateAxis("y",h.point,y),this.visualElement.render(),v&&v(c,h)},a=(c,h)=>this.stop(c,h),u=()=>Er(c=>{var h;return this.getAnimationState(c)==="paused"&&((h=this.getAxisMotionValue(c).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:l}=this.getProps();this.panSession=new VR(e,{onSessionStart:i,onStart:o,onMove:s,onSessionEnd:a,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:l,contextWindow:$R(this.visualElement)})}stop(e,n){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&rt.update(()=>o(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:i}=this.getProps();if(!r||!af(e,i,this.currentDirection))return;const o=this.getAxisMotionValue(e);let s=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(s=XL(s,this.constraints[e],this.elastic[e])),o.set(s)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:r}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,o=this.constraints;n&&Ka(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&i?this.constraints=YL(i.layoutBox,n):this.constraints=!1,this.elastic=eV(r),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Er(s=>{this.getAxisMotionValue(s)&&(this.constraints[s]=ZL(i.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Ka(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=sV(r,i.root,this.visualElement.getTransformPagePoint());let s=QL(i.layout.layoutBox,o);if(n){const a=n(tV(s));this.hasMutatedConstraints=!!a,a&&(s=jR(a))}return s}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:i,dragTransition:o,dragSnapToOrigin:s,onDragTransitionEnd:a}=this.getProps(),u=this.constraints||{},l=Er(c=>{if(!af(c,n,this.currentDirection))return;let h=u&&u[c]||{};s&&(h={min:0,max:0});const f=i?200:1e6,d=i?40:1e7,m={type:"inertia",velocity:r?e[c]:0,bounceStiffness:f,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(c,m)});return Promise.all(l).then(a)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return r.start(F1(e,r,0,n))}stopAnimation(){Er(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Er(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n="_drag"+e.toUpperCase(),r=this.visualElement.getProps(),i=r[n];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Er(n=>{const{drag:r}=this.getProps();if(!af(n,r,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:s,max:a}=i.layout.layoutBox[n];o.set(e[n]-xt(s,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Ka(n)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Er(s=>{const a=this.getAxisMotionValue(s);if(a){const u=a.get();i[s]=JL({min:u,max:u},this.constraints[s])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Er(s=>{if(!af(s,e,null))return;const a=this.getAxisMotionValue(s),{min:u,max:l}=this.constraints[s];a.set(xt(u,l,i[s]))})}addListeners(){if(!this.visualElement.current)return;aV.set(this.visualElement,this);const e=this.visualElement.current,n=Wi(e,"pointerdown",u=>{const{drag:l,dragListener:c=!0}=this.getProps();l&&c&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();Ka(u)&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),r();const s=Bi(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",({delta:u,hasLayoutChanged:l})=>{this.isDragging&&l&&(Er(c=>{const h=this.getAxisMotionValue(c);h&&(this.originPoint[c]+=u[c].translate,h.set(h.get()+u[c].translate))}),this.visualElement.render())});return()=>{s(),n(),o(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:s=vy,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:i,dragConstraints:o,dragElastic:s,dragMomentum:a}}}function af(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function lV(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class cV extends us{constructor(e){super(e),this.removeGroupControls=Nt,this.removeListeners=Nt,this.controls=new uV(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Nt}unmount(){this.removeGroupControls(),this.removeListeners()}}const mE=t=>(e,n)=>{t&&rt.update(()=>t(e,n))};class hV extends us{constructor(){super(...arguments),this.removePointerDownListener=Nt}onPointerDown(e){this.session=new VR(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:$R(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:mE(e),onStart:mE(n),onMove:r,onEnd:(o,s)=>{delete this.session,i&&rt.update(()=>i(o,s))}}}mount(){this.removePointerDownListener=Wi(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function fV(){const t=Y.useContext(Bp);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:r}=t,i=Y.useId();return Y.useEffect(()=>r(i),[]),!e&&n?[!1,()=>n&&n(i)]:[!0]}const zf={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function gE(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const El={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Te.test(t))t=parseFloat(t);else return t;const n=gE(t,e.target.x),r=gE(t,e.target.y);return`${n}% ${r}%`}},dV={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,i=Qo.parse(t);if(i.length>5)return r;const o=Qo.createTransformer(t),s=typeof i[0]!="number"?1:0,a=n.x.scale*e.x,u=n.y.scale*e.y;i[0+s]/=a,i[1+s]/=u;const l=xt(a,u,.5);return typeof i[2+s]=="number"&&(i[2+s]/=l),typeof i[3+s]=="number"&&(i[3+s]/=l),o(i)}};class pV extends T0.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:i}=this.props,{projection:o}=e;xF(mV),o&&(n.group&&n.group.add(o),r&&r.register&&i&&r.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),zf.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:i,isPresent:o}=this.props,s=r.projection;return s&&(s.isPresent=o,i||e.layoutDependency!==n||n===void 0?s.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?s.promote():s.relegate()||rt.postRender(()=>{const a=s.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function HR(t){const[e,n]=fV(),r=Y.useContext(x1);return T0.createElement(pV,{...t,layoutGroup:r,switchLayoutGroup:Y.useContext(jI),isPresent:e,safeToRemove:n})}const mV={borderRadius:{...El,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:El,borderTopRightRadius:El,borderBottomLeftRadius:El,borderBottomRightRadius:El,boxShadow:dV},GR=["TopLeft","TopRight","BottomLeft","BottomRight"],gV=GR.length,vE=t=>typeof t=="string"?parseFloat(t):t,yE=t=>typeof t=="number"||Te.test(t);function vV(t,e,n,r,i,o){i?(t.opacity=xt(0,n.opacity!==void 0?n.opacity:1,yV(r)),t.opacityExit=xt(e.opacity!==void 0?e.opacity:1,0,_V(r))):o&&(t.opacity=xt(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,r));for(let s=0;s<gV;s++){const a=`border${GR[s]}Radius`;let u=_E(e,a),l=_E(n,a);if(u===void 0&&l===void 0)continue;u||(u=0),l||(l=0),u===0||l===0||yE(u)===yE(l)?(t[a]=Math.max(xt(vE(u),vE(l),r),0),(yi.test(l)||yi.test(u))&&(t[a]+="%")):t[a]=l}(e.rotate||n.rotate)&&(t.rotate=xt(e.rotate||0,n.rotate||0,r))}function _E(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const yV=qR(0,.5,mR),_V=qR(.5,.95,Nt);function qR(t,e,n){return r=>r<t?0:r>e?1:n(Pc(t,e,r))}function wE(t,e){t.min=e.min,t.max=e.max}function br(t,e){wE(t.x,e.x),wE(t.y,e.y)}function xE(t,e,n,r,i){return t-=e,t=Rd(t,1/n,r),i!==void 0&&(t=Rd(t,1/i,r)),t}function wV(t,e=0,n=1,r=.5,i,o=t,s=t){if(yi.test(e)&&(e=parseFloat(e),e=xt(s.min,s.max,e/100)-s.min),typeof e!="number")return;let a=xt(o.min,o.max,r);t===o&&(a-=e),t.min=xE(t.min,e,n,a,i),t.max=xE(t.max,e,n,a,i)}function bE(t,e,[n,r,i],o,s){wV(t,e[n],e[r],e[i],e.scale,o,s)}const xV=["x","scaleX","originX"],bV=["y","scaleY","originY"];function EE(t,e,n,r){bE(t.x,e,xV,n?n.x:void 0,r?r.x:void 0),bE(t.y,e,bV,n?n.y:void 0,r?r.y:void 0)}function CE(t){return t.translate===0&&t.scale===1}function KR(t){return CE(t.x)&&CE(t.y)}function EV(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function XR(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function SE(t){return yr(t.x)/yr(t.y)}class CV{constructor(){this.members=[]}add(e){O1(this.members,e),e.scheduleRender()}remove(e){if(L1(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(i=>e===i);if(n===0)return!1;let r;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){r=o;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function TE(t,e,n){let r="";const i=t.x.translate/e.x,o=t.y.translate/e.y;if((i||o)&&(r=`translate3d(${i}px, ${o}px, 0) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{rotate:u,rotateX:l,rotateY:c}=n;u&&(r+=`rotate(${u}deg) `),l&&(r+=`rotateX(${l}deg) `),c&&(r+=`rotateY(${c}deg) `)}const s=t.x.scale*e.x,a=t.y.scale*e.y;return(s!==1||a!==1)&&(r+=`scale(${s}, ${a})`),r||"none"}const SV=(t,e)=>t.depth-e.depth;class TV{constructor(){this.children=[],this.isDirty=!1}add(e){O1(this.children,e),this.isDirty=!0}remove(e){L1(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(SV),this.isDirty=!1,this.children.forEach(e)}}function IV(t,e){const n=performance.now(),r=({timestamp:i})=>{const o=i-n;o>=e&&(Ji(r),t(o-e))};return rt.read(r,!0),()=>Ji(r)}function RV(t){window.MotionDebug&&window.MotionDebug.record(t)}function AV(t){return t instanceof SVGElement&&t.tagName!=="svg"}function kV(t,e,n){const r=nr(t)?t:Tu(t);return r.start(F1("",r,e,n)),r.animation}const IE=["","X","Y","Z"],PV={visibility:"hidden"},RE=1e3;let NV=0;const Cs={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function YR({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(s={},a=e==null?void 0:e()){this.id=NV++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Cs.totalNodes=Cs.resolvedTargetDeltas=Cs.recalculatedProjection=0,this.nodes.forEach(FV),this.nodes.forEach(jV),this.nodes.forEach(UV),this.nodes.forEach(OV),RV(Cs)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=s,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new TV)}addEventListener(s,a){return this.eventHandlers.has(s)||this.eventHandlers.set(s,new V1),this.eventHandlers.get(s).add(a)}notifyListeners(s,...a){const u=this.eventHandlers.get(s);u&&u.notify(...a)}hasListeners(s){return this.eventHandlers.has(s)}mount(s,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=AV(s),this.instance=s;const{layoutId:u,layout:l,visualElement:c}=this.options;if(c&&!c.current&&c.mount(s),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(l||u)&&(this.isLayoutDirty=!0),t){let h;const f=()=>this.root.updateBlockedByResize=!1;t(s,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=IV(f,250),zf.hasAnimatedSinceResize&&(zf.hasAnimatedSinceResize=!1,this.nodes.forEach(kE))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&c&&(u||l)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:f,hasRelativeTargetChanged:d,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||c.getDefaultTransition()||GV,{onLayoutAnimationStart:y,onLayoutAnimationComplete:g}=c.getProps(),_=!this.targetLayout||!XR(this.targetLayout,m)||d,w=!f&&d;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||f&&(_||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,w);const x={...M1(v,"layout"),onPlay:y,onComplete:g};(c.shouldReduceMotion||this.options.layoutRoot)&&(x.delay=0,x.type=!1),this.startAnimation(x)}else f||kE(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const s=this.getStack();s&&s.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ji(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(WV),this.animationId++)}getTransformTemplate(){const{visualElement:s}=this.options;return s&&s.getProps().transformTemplate}willUpdate(s=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const h=this.path[c];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:a,layout:u}=this.options;if(a===void 0&&!u)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),s&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(AE);return}this.isUpdating||this.nodes.forEach(VV),this.isUpdating=!1,this.nodes.forEach(BV),this.nodes.forEach(DV),this.nodes.forEach(MV),this.clearAllSnapshots();const a=performance.now();_n.delta=Yo(0,1e3/60,a-_n.timestamp),_n.timestamp=a,_n.isProcessing=!0,pg.update.process(_n),pg.preRender.process(_n),pg.render.process(_n),_n.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(LV),this.sharedNodes.forEach(zV)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,rt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){rt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const s=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ft(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,s?s.layoutBox:void 0)}updateScroll(s="measure"){let a=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===s&&(a=!1),a&&(this.scroll={animationId:this.root.animationId,phase:s,isRoot:r(this.instance),offset:n(this.instance)})}resetTransform(){if(!i)return;const s=this.isLayoutDirty||this.shouldResetTransform,a=this.projectionDelta&&!KR(this.projectionDelta),u=this.getTransformTemplate(),l=u?u(this.latestValues,""):void 0,c=l!==this.prevTransformTemplateValue;s&&(a||Es(this.latestValues)||c)&&(i(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(s=!0){const a=this.measurePageBox();let u=this.removeElementScroll(a);return s&&(u=this.removeTransform(u)),qV(u),{animationId:this.root.animationId,measuredBox:a,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:s}=this.options;if(!s)return Ft();const a=s.measureViewportBox(),{scroll:u}=this.root;return u&&(Eo(a.x,u.offset.x),Eo(a.y,u.offset.y)),a}removeElementScroll(s){const a=Ft();br(a,s);for(let u=0;u<this.path.length;u++){const l=this.path[u],{scroll:c,options:h}=l;if(l!==this.root&&c&&h.layoutScroll){if(c.isRoot){br(a,s);const{scroll:f}=this.root;f&&(Eo(a.x,-f.offset.x),Eo(a.y,-f.offset.y))}Eo(a.x,c.offset.x),Eo(a.y,c.offset.y)}}return a}applyTransform(s,a=!1){const u=Ft();br(u,s);for(let l=0;l<this.path.length;l++){const c=this.path[l];!a&&c.options.layoutScroll&&c.scroll&&c!==c.root&&Qa(u,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),Es(c.latestValues)&&Qa(u,c.latestValues)}return Es(this.latestValues)&&Qa(u,this.latestValues),u}removeTransform(s){const a=Ft();br(a,s);for(let u=0;u<this.path.length;u++){const l=this.path[u];if(!l.instance||!Es(l.latestValues))continue;yy(l.latestValues)&&l.updateSnapshot();const c=Ft(),h=l.measurePageBox();br(c,h),EE(a,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,c)}return Es(this.latestValues)&&EE(a,this.latestValues),a}setTargetDelta(s){this.targetDelta=s,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(s){this.options={...this.options,...s,crossfade:s.crossfade!==void 0?s.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==_n.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(s=!1){var a;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==u;if(!(s||l&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:h,layoutId:f}=this.options;if(!(!this.layout||!(h||f))){if(this.resolvedRelativeTargetAt=_n.timestamp,!this.targetDelta&&!this.relativeTarget){const d=this.getClosestProjectingParent();d&&d.layout&&this.animationProgress!==1?(this.relativeParent=d,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ft(),this.relativeTargetOrigin=Ft(),Jl(this.relativeTargetOrigin,this.layout.layoutBox,d.layout.layoutBox),br(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ft(),this.targetWithTransforms=Ft()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),KL(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):br(this.target,this.layout.layoutBox),WR(this.target,this.targetDelta)):br(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const d=this.getClosestProjectingParent();d&&!!d.resumingFrom==!!this.resumingFrom&&!d.options.layoutScroll&&d.target&&this.animationProgress!==1?(this.relativeParent=d,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ft(),this.relativeTargetOrigin=Ft(),Jl(this.relativeTargetOrigin,this.target,d.target),br(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Cs.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||yy(this.parent.latestValues)||UR(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var s;const a=this.getLead(),u=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||!((s=this.parent)===null||s===void 0)&&s.isProjectionDirty)&&(l=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===_n.timestamp&&(l=!1),l)return;const{layout:c,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||h))return;br(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,d=this.treeScale.y;rV(this.layoutCorrected,this.treeScale,this.path,u),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox);const{target:m}=a;if(!m){this.projectionTransform&&(this.projectionDelta=Ya(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Ya(),this.projectionDeltaWithTransform=Ya());const v=this.projectionTransform;Ql(this.projectionDelta,this.layoutCorrected,m,this.latestValues),this.projectionTransform=TE(this.projectionDelta,this.treeScale),(this.projectionTransform!==v||this.treeScale.x!==f||this.treeScale.y!==d)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),Cs.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(s=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),s){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(s,a=!1){const u=this.snapshot,l=u?u.latestValues:{},c={...this.latestValues},h=Ya();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const f=Ft(),d=u?u.source:void 0,m=this.layout?this.layout.source:void 0,v=d!==m,y=this.getStack(),g=!y||y.members.length<=1,_=!!(v&&!g&&this.options.crossfade===!0&&!this.path.some(HV));this.animationProgress=0;let w;this.mixTargetDelta=x=>{const S=x/1e3;PE(h.x,s.x,S),PE(h.y,s.y,S),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Jl(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$V(this.relativeTarget,this.relativeTargetOrigin,f,S),w&&EV(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Ft()),br(w,this.relativeTarget)),v&&(this.animationValues=c,vV(c,l,this.latestValues,S,_,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(s){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ji(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=rt.update(()=>{zf.hasAnimatedSinceResize=!0,this.currentAnimation=kV(0,RE,{...s,onUpdate:a=>{this.mixTargetDelta(a),s.onUpdate&&s.onUpdate(a)},onComplete:()=>{s.onComplete&&s.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const s=this.getStack();s&&s.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(RE),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const s=this.getLead();let{targetWithTransforms:a,target:u,layout:l,latestValues:c}=s;if(!(!a||!u||!l)){if(this!==s&&this.layout&&l&&QR(this.options.animationType,this.layout.layoutBox,l.layoutBox)){u=this.target||Ft();const h=yr(this.layout.layoutBox.x);u.x.min=s.target.x.min,u.x.max=u.x.min+h;const f=yr(this.layout.layoutBox.y);u.y.min=s.target.y.min,u.y.max=u.y.min+f}br(a,u),Qa(a,c),Ql(this.projectionDeltaWithTransform,this.layoutCorrected,a,c)}}registerSharedNode(s,a){this.sharedNodes.has(s)||this.sharedNodes.set(s,new CV),this.sharedNodes.get(s).add(a);const l=a.options.initialPromotionConfig;a.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(a):void 0})}isLead(){const s=this.getStack();return s?s.lead===this:!0}getLead(){var s;const{layoutId:a}=this.options;return a?((s=this.getStack())===null||s===void 0?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:a}=this.options;return a?(s=this.getStack())===null||s===void 0?void 0:s.prevLead:void 0}getStack(){const{layoutId:s}=this.options;if(s)return this.root.sharedNodes.get(s)}promote({needsReset:s,transition:a,preserveFollowOpacity:u}={}){const l=this.getStack();l&&l.promote(this,u),s&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const s=this.getStack();return s?s.relegate(this):!1}resetRotation(){const{visualElement:s}=this.options;if(!s)return;let a=!1;const{latestValues:u}=s;if((u.rotate||u.rotateX||u.rotateY||u.rotateZ)&&(a=!0),!a)return;const l={};for(let c=0;c<IE.length;c++){const h="rotate"+IE[c];u[h]&&(l[h]=u[h],s.setStaticValue(h,0))}s.render();for(const c in l)s.setStaticValue(c,l[c]);s.scheduleRender()}getProjectionStyles(s){var a,u;if(!this.instance||this.isSVG)return;if(!this.isVisible)return PV;const l={visibility:""},c=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,l.opacity="",l.pointerEvents=Wf(s==null?void 0:s.pointerEvents)||"",l.transform=c?c(this.latestValues,""):"none",l;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=Wf(s==null?void 0:s.pointerEvents)||""),this.hasProjected&&!Es(this.latestValues)&&(v.transform=c?c({},""):"none",this.hasProjected=!1),v}const f=h.animationValues||h.latestValues;this.applyTransformsToTarget(),l.transform=TE(this.projectionDeltaWithTransform,this.treeScale,f),c&&(l.transform=c(f,l.transform));const{x:d,y:m}=this.projectionDelta;l.transformOrigin=`${d.origin*100}% ${m.origin*100}% 0`,h.animationValues?l.opacity=h===this?(u=(a=f.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&u!==void 0?u:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:l.opacity=h===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const v in xd){if(f[v]===void 0)continue;const{correct:y,applyTo:g}=xd[v],_=l.transform==="none"?f[v]:y(f[v],h);if(g){const w=g.length;for(let x=0;x<w;x++)l[g[x]]=_}else l[v]=_}return this.options.layoutId&&(l.pointerEvents=h===this?Wf(s==null?void 0:s.pointerEvents)||"":"none"),l}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(s=>{var a;return(a=s.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(AE),this.root.sharedNodes.clear()}}}function DV(t){t.updateLayout()}function MV(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=t.layout,{animationType:o}=t.options,s=n.source!==t.layout.source;o==="size"?Er(h=>{const f=s?n.measuredBox[h]:n.layoutBox[h],d=yr(f);f.min=r[h].min,f.max=f.min+d}):QR(o,n.layoutBox,r)&&Er(h=>{const f=s?n.measuredBox[h]:n.layoutBox[h],d=yr(r[h]);f.max=f.min+d,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[h].max=t.relativeTarget[h].min+d)});const a=Ya();Ql(a,r,n.layoutBox);const u=Ya();s?Ql(u,t.applyTransform(i,!0),n.measuredBox):Ql(u,r,n.layoutBox);const l=!KR(a);let c=!1;if(!t.resumeFrom){const h=t.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:d}=h;if(f&&d){const m=Ft();Jl(m,n.layoutBox,f.layoutBox);const v=Ft();Jl(v,r,d.layoutBox),XR(m,v)||(c=!0),h.options.layoutRoot&&(t.relativeTarget=v,t.relativeTargetOrigin=m,t.relativeParent=h)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:n,delta:u,layoutDelta:a,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function FV(t){Cs.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function OV(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function LV(t){t.clearSnapshot()}function AE(t){t.clearMeasurements()}function VV(t){t.isLayoutDirty=!1}function BV(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function kE(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function jV(t){t.resolveTargetDelta()}function UV(t){t.calcProjection()}function WV(t){t.resetRotation()}function zV(t){t.removeLeadSnapshot()}function PE(t,e,n){t.translate=xt(e.translate,0,n),t.scale=xt(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function NE(t,e,n,r){t.min=xt(e.min,n.min,r),t.max=xt(e.max,n.max,r)}function $V(t,e,n,r){NE(t.x,e.x,n.x,r),NE(t.y,e.y,n.y,r)}function HV(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const GV={duration:.45,ease:[.4,0,.1,1]},DE=t=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(t),ME=DE("applewebkit/")&&!DE("chrome/")?Math.round:Nt;function FE(t){t.min=ME(t.min),t.max=ME(t.max)}function qV(t){FE(t.x),FE(t.y)}function QR(t,e,n){return t==="position"||t==="preserve-aspect"&&!gy(SE(e),SE(n),.2)}const KV=YR({attachResizeListener:(t,e)=>Bi(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Sg={current:void 0},JR=YR({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Sg.current){const t=new KV({});t.mount(window),t.setOptions({layoutScroll:!0}),Sg.current=t}return Sg.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),XV={pan:{Feature:hV},drag:{Feature:cV,ProjectionNode:JR,MeasureLayout:HR}},YV=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function QV(t){const e=YV.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]}function wy(t,e,n=1){const[r,i]=QV(t);if(!r)return;const o=window.getComputedStyle(e).getPropertyValue(r);if(o){const s=o.trim();return MR(s)?parseFloat(s):s}else return ly(i)?wy(i,e,n+1):i}function JV(t,{...e},n){const r=t.current;if(!(r instanceof Element))return{target:e,transitionEnd:n};n&&(n={...n}),t.values.forEach(i=>{const o=i.get();if(!ly(o))return;const s=wy(o,r);s&&i.set(s)});for(const i in e){const o=e[i];if(!ly(o))continue;const s=wy(o,r);s&&(e[i]=s,n||(n={}),n[i]===void 0&&(n[i]=o))}return{target:e,transitionEnd:n}}const ZV=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),ZR=t=>ZV.has(t),eB=t=>Object.keys(t).some(ZR),OE=t=>t===la||t===Te,LE=(t,e)=>parseFloat(t.split(", ")[e]),VE=(t,e)=>(n,{transform:r})=>{if(r==="none"||!r)return 0;const i=r.match(/^matrix3d\((.+)\)$/);if(i)return LE(i[1],e);{const o=r.match(/^matrix\((.+)\)$/);return o?LE(o[1],t):0}},tB=new Set(["x","y","z"]),nB=th.filter(t=>!tB.has(t));function rB(t){const e=[];return nB.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}const Iu={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:VE(4,13),y:VE(5,14)};Iu.translateX=Iu.x;Iu.translateY=Iu.y;const iB=(t,e,n)=>{const r=e.measureViewportBox(),i=e.current,o=getComputedStyle(i),{display:s}=o,a={};s==="none"&&e.setStaticValue("display",t.display||"block"),n.forEach(l=>{a[l]=Iu[l](r,o)}),e.render();const u=e.measureViewportBox();return n.forEach(l=>{const c=e.getValue(l);c&&c.jump(a[l]),t[l]=Iu[l](u,o)}),t},oB=(t,e,n={},r={})=>{e={...e},r={...r};const i=Object.keys(e).filter(ZR);let o=[],s=!1;const a=[];if(i.forEach(u=>{const l=t.getValue(u);if(!t.hasValue(u))return;let c=n[u],h=bl(c);const f=e[u];let d;if(Ed(f)){const m=f.length,v=f[0]===null?1:0;c=f[v],h=bl(c);for(let y=v;y<m&&f[y]!==null;y++)d?A1(bl(f[y])===d):d=bl(f[y])}else d=bl(f);if(h!==d)if(OE(h)&&OE(d)){const m=l.get();typeof m=="string"&&l.set(parseFloat(m)),typeof f=="string"?e[u]=parseFloat(f):Array.isArray(f)&&d===Te&&(e[u]=f.map(parseFloat))}else h!=null&&h.transform&&(d!=null&&d.transform)&&(c===0||f===0)?c===0?l.set(d.transform(c)):e[u]=h.transform(f):(s||(o=rB(t),s=!0),a.push(u),r[u]=r[u]!==void 0?r[u]:e[u],l.jump(f))}),a.length){const u=a.indexOf("height")>=0?window.pageYOffset:null,l=iB(e,t,a);return o.length&&o.forEach(([c,h])=>{t.getValue(c).set(h)}),t.render(),jp&&u!==null&&window.scrollTo({top:u}),{target:l,transitionEnd:r}}else return{target:e,transitionEnd:r}};function sB(t,e,n,r){return eB(e)?oB(t,e,n,r):{target:e,transitionEnd:r}}const aB=(t,e,n,r)=>{const i=JV(t,e,r);return e=i.target,r=i.transitionEnd,sB(t,e,n,r)},xy={current:null},eA={current:!1};function uB(){if(eA.current=!0,!!jp)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>xy.current=t.matches;t.addListener(e),e()}else xy.current=!1}function lB(t,e,n){const{willChange:r}=e;for(const i in e){const o=e[i],s=n[i];if(nr(o))t.addValue(i,o),Id(r)&&r.add(i);else if(nr(s))t.addValue(i,Tu(o,{owner:t})),Id(r)&&r.remove(i);else if(s!==o)if(t.hasValue(i)){const a=t.getValue(i);!a.hasAnimated&&a.set(o)}else{const a=t.getStaticValue(i);t.addValue(i,Tu(a!==void 0?a:o,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const BE=new WeakMap,tA=Object.keys(kc),cB=tA.length,jE=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],hB=w1.length;class fB{constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:i,visualState:o},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>rt.render(this.render,!1,!0);const{latestValues:a,renderState:u}=o;this.latestValues=a,this.baseTarget={...a},this.initialValues=n.initial?{...a}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=s,this.isControllingVariants=Wp(n),this.isVariantNode=BI(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:l,...c}=this.scrapeMotionValuesFromProps(n,{});for(const h in c){const f=c[h];a[h]!==void 0&&nr(f)&&(f.set(a[h],!1),Id(l)&&l.add(h))}}scrapeMotionValuesFromProps(e,n){return{}}mount(e){this.current=e,BE.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,r)=>this.bindToMotionValue(r,n)),eA.current||uB(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:xy.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){BE.delete(this.current),this.projection&&this.projection.unmount(),Ji(this.notifyUpdate),Ji(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,n){const r=ua.has(e),i=n.on("change",s=>{this.latestValues[e]=s,this.props.onUpdate&&rt.update(this.notifyUpdate,!1,!0),r&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{i(),o()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},r,i,o){let s,a;for(let u=0;u<cB;u++){const l=tA[u],{isEnabled:c,Feature:h,ProjectionNode:f,MeasureLayout:d}=kc[l];f&&(s=f),c(n)&&(!this.features[l]&&h&&(this.features[l]=new h(this)),d&&(a=d))}if((this.type==="html"||this.type==="svg")&&!this.projection&&s){this.projection=new s(this.latestValues,this.parent&&this.parent.projection);const{layoutId:u,layout:l,drag:c,dragConstraints:h,layoutScroll:f,layoutRoot:d}=n;this.projection.setOptions({layoutId:u,layout:l,alwaysMeasureLayout:!!c||h&&Ka(h),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof l=="string"?l:"both",initialPromotionConfig:o,layoutScroll:f,layoutRoot:d})}return a}updateFeatures(){for(const e in this.features){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ft()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}makeTargetAnimatable(e,n=!0){return this.makeTargetAnimatableFromInstance(e,this.props,n)}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<jE.length;r++){const i=jE[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o=e["on"+i];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=lB(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const r=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(r.initial=this.props.initial),r}const n={};for(let r=0;r<hB;r++){const i=w1[r],o=this.props[i];(Ac(o)||o===!1)&&(n[i]=o)}return n}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){n!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,n)),this.values.set(e,n),this.latestValues[e]=n.get()}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=Tu(n,{owner:this}),this.addValue(e,r)),r}readValue(e){var n;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(n=this.getBaseTargetFromProps(this.props,e))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:r}=this.props,i=typeof r=="string"||typeof r=="object"?(n=R1(this.props,r))===null||n===void 0?void 0:n[e]:void 0;if(r&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!nr(o)?o:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new V1),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class nA extends fB{sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:n,...r},{transformValues:i},o){let s=AL(r,e||{},this);if(i&&(n&&(n=i(n)),r&&(r=i(r)),s&&(s=i(s))),o){IL(this,r,s);const a=aB(this,r,s,n);n=a.transitionEnd,r=a.target}return{transition:e,transitionEnd:n,...r}}}function dB(t){return window.getComputedStyle(t)}class pB extends nA{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,n){if(ua.has(n)){const r=D1(n);return r&&r.default||0}else{const r=dB(e),i=(zI(n)?r.getPropertyValue(n):r[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:n}){return zR(e,n)}build(e,n,r,i){E1(e,n,r,i.transformTemplate)}scrapeMotionValuesFromProps(e,n){return I1(e,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;nr(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,r,i){XI(e,n,r,i)}}class mB extends nA{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(ua.has(n)){const r=D1(n);return r&&r.default||0}return n=YI.has(n)?n:y1(n),e.getAttribute(n)}measureInstanceViewportBox(){return Ft()}scrapeMotionValuesFromProps(e,n){return JI(e,n)}build(e,n,r,i){S1(e,n,r,this.isSVGTag,i.transformTemplate)}renderInstance(e,n,r,i){QI(e,n,r,i)}mount(e){this.isSVGTag=T1(e.tagName),super.mount(e)}}const gB=(t,e)=>b1(t)?new mB(e,{enableHardwareAcceleration:!1}):new pB(e,{enableHardwareAcceleration:!0}),vB={layout:{ProjectionNode:JR,MeasureLayout:HR}},yB={...$L,...cO,...XV,...vB},de=_F((t,e)=>QF(t,e,yB,gB));function rA(){const t=Y.useRef(!1);return v1(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function _B(){const t=rA(),[e,n]=Y.useState(0),r=Y.useCallback(()=>{t.current&&n(e+1)},[e]);return[Y.useCallback(()=>rt.postRender(r),[r]),e]}class wB extends Y.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function xB({children:t,isPresent:e}){const n=Y.useId(),r=Y.useRef(null),i=Y.useRef({width:0,height:0,top:0,left:0});return Y.useInsertionEffect(()=>{const{width:o,height:s,top:a,left:u}=i.current;if(e||!r.current||!o||!s)return;r.current.dataset.motionPopId=n;const l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${s}px !important;
            top: ${a}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[e]),Y.createElement(wB,{isPresent:e,childRef:r,sizeRef:i},Y.cloneElement(t,{ref:r}))}const Tg=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:s})=>{const a=ZI(bB),u=Y.useId(),l=Y.useMemo(()=>({id:u,initial:e,isPresent:n,custom:i,onExitComplete:c=>{a.set(c,!0);for(const h of a.values())if(!h)return;r&&r()},register:c=>(a.set(c,!1),()=>a.delete(c))}),o?void 0:[n]);return Y.useMemo(()=>{a.forEach((c,h)=>a.set(h,!1))},[n]),Y.useEffect(()=>{!n&&!a.size&&r&&r()},[n]),s==="popLayout"&&(t=Y.createElement(xB,{isPresent:n},t)),Y.createElement(Bp.Provider,{value:l},t)};function bB(){return new Map}function EB(t){return Y.useEffect(()=>()=>t(),[])}const Ss=t=>t.key||"";function CB(t,e){t.forEach(n=>{const r=Ss(n);e.set(r,n)})}function SB(t){const e=[];return Y.Children.forEach(t,n=>{Y.isValidElement(n)&&e.push(n)}),e}const su=({children:t,custom:e,initial:n=!0,onExitComplete:r,exitBeforeEnter:i,presenceAffectsLayout:o=!0,mode:s="sync"})=>{const a=Y.useContext(x1).forceRender||_B()[0],u=rA(),l=SB(t);let c=l;const h=Y.useRef(new Map).current,f=Y.useRef(c),d=Y.useRef(new Map).current,m=Y.useRef(!0);if(v1(()=>{m.current=!1,CB(l,d),f.current=c}),EB(()=>{m.current=!0,d.clear(),h.clear()}),m.current)return Y.createElement(Y.Fragment,null,c.map(_=>Y.createElement(Tg,{key:Ss(_),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:o,mode:s},_)));c=[...c];const v=f.current.map(Ss),y=l.map(Ss),g=v.length;for(let _=0;_<g;_++){const w=v[_];y.indexOf(w)===-1&&!h.has(w)&&h.set(w,void 0)}return s==="wait"&&h.size&&(c=[]),h.forEach((_,w)=>{if(y.indexOf(w)!==-1)return;const x=d.get(w);if(!x)return;const S=v.indexOf(w);let A=_;if(!A){const T=()=>{h.delete(w);const E=Array.from(d.keys()).filter(C=>!y.includes(C));if(E.forEach(C=>d.delete(C)),f.current=l.filter(C=>{const I=Ss(C);return I===w||E.includes(I)}),!h.size){if(u.current===!1)return;a(),r&&r()}};A=Y.createElement(Tg,{key:Ss(x),isPresent:!1,onExitComplete:T,custom:e,presenceAffectsLayout:o,mode:s},x),h.set(w,A)}c.splice(S,0,A)}),c=c.map(_=>{const w=_.key;return h.has(w)?_:Y.createElement(Tg,{key:Ss(_),isPresent:!0,presenceAffectsLayout:o,mode:s},_)}),Y.createElement(Y.Fragment,null,h.size?c:c.map(_=>Y.cloneElement(_)))};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var iA=function(t,e){return(iA=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])})(t,e)};function ei(t,e){function n(){this.constructor=t}iA(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function he(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(l){try{u(r.next(l))}catch(c){o(c)}}function a(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(s,a)}u((r=r.apply(t,[])).next())})}function fe(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,r=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=e.call(t,s)}catch(h){c=[6,h],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var TB=function(){function t(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(e,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=e,this.platform=n},t.prototype.registerFlag=function(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},t.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},t.prototype.getNumber=function(e){return this.get(e)},t.prototype.getBool=function(e){return this.get(e)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(e,n){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)},t.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},t.prototype.setFlags=function(e){this.flags=Object.assign({},e)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,i=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return IB(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0],u=s[1];e.urlFlags[a]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(a,u)})}},t}();function IB(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function J(){return oA}var oA=null,Ad=new Map,by=new Map;function sA(t,e){var n=uA(t,e);return Ad.get(n)}function RB(t){return by.get(t)}function UE(t){for(var e=Ad.entries(),n=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var s=o[0],a=o[1];s.split("_")[0]===t&&n.push(a)}return n}function aA(t){var e=t.kernelName,n=t.backendName,r=uA(e,n);if(Ad.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");Ad.set(r,t)}function AB(t){var e=t.kernelName;by.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),by.set(e,t)}function uA(t,e){return e+"_"+t}function Ey(t,e,n){return Math.max(t,Math.min(e,n))}function lA(t){return t%2==0?t:t+1}function kB(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function O(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Qe(t,e,n){n===void 0&&(n=""),O(rn(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function $u(t){O(t!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ru(t,e,n){if(e===void 0&&(e=[]),n===void 0&&(n=!1),e==null&&(e=[]),Array.isArray(t)||_i(t)&&!n)for(var r=0;r<t.length;++r)Ru(t[r],e,n);else e.push(t);return e}function pe(t){if(t.length===0)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function rn(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Dt(t){return t%1==0}function PB(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function Cy(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function au(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function WE(t,e,n){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(t())r();else{o++;var a=e(o);n!=null&&o>=n?i():setTimeout(s,a)}};s()})}function NB(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(r===-1){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(n===0)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o}function qt(t,e){var n=e.length;return O((t=t==null?e.map(function(r,i){return i}):[].concat(t)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),O(t.every(function(r){return Dt(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?n+r:r})}function ks(t,e){for(var n=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:qt(e,t).sort(),s=0,a=0;a<t.length;++a){if(o!=null){if(o[s]===a&&t[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(o[s]==null||o[s]>a)&&t[a]===1&&(n.push(t[a]),r.push(a)),o[s]<=a&&s++}t[a]!==1&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function Nc(t,e){var n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else{if(t!=="bool")throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function kd(t,e){var n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else{if(t!=="string")throw new Error("Unknown data type "+t);n=new Array(e)}return n}function DB(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function MB(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function FB(t,e){return e!=="complex64"&&(e!=="float32"||t==="complex64")&&(e!=="int32"||t==="float32"||t==="complex64")&&(e!=="bool"||t!=="bool")}function _i(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function cA(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error("Unknown dtype "+t)}function OB(t){if(t==null)return 0;var e=0;return t.forEach(function(n){return e+=n.length}),e}function B1(t){return typeof t=="string"||t instanceof String}function LB(t){return typeof t=="boolean"}function VB(t){return typeof t=="number"}function oh(t){return Array.isArray(t)?oh(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":VB(t)?"float32":B1(t)?"string":LB(t)?"bool":"float32"}function Sy(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Ty(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function wi(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function hA(t,e,n){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ru(t)),n&&DB(t,e),function(o,s){return o instanceof Float32Array&&s==="float32"||o instanceof Int32Array&&s==="int32"||o instanceof Uint8Array&&s==="bool"}(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)Math.round(t[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function zE(t,e){if(t.length===0)return e[0];var n=t.reduce(function(r,i){return r*i});if(n===0)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)a[l]=s[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(f,d){return f*d});for(l=0;l<u;l++)a[l]=r(i+l*h,c,s)}return a}(0,t,e)}function fA(t,e){for(var n=sh(t,e),r=0;r<n.length;r++)n[r]=1;return n}function sh(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error("Unknown data type "+e)}function ci(){return J().platform.now()}function dA(t){t.forEach(function(e){O(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function BB(t,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",J().platform.encode(t,e)}function Pd(t,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",J().platform.decode(t,e)}function $E(t,e,n){if(e===0)return 0;if(e===1)return t[0];for(var r=t[t.length-1],i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function jB(t,e,n){if(e===0)return[];if(e===1)return[t];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}var UB=function(){function t(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new WB)}return t.prototype.profileKernel=function(e,n,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(l,c,h){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var d=l[f];if(isNaN(d)||!isFinite(d))return console.warn("Found "+d+" in the result of '"+h+"'"),!0}})(u,a.dtype,e),s.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,u,l.kernelMs,n,c)})})}),i},t}(),WB=function(){function t(){}return t.prototype.logKernelProfile=function(e,n,r,i,o,s){var a=typeof i=="number"?au(i+"ms",9):i.error,u=au(e,25),l=n.rank,c=n.size,h=au(n.shape.toString(),14),f="";for(var d in o){var m=o[d].shape||n.shape,v=m.length;f+=d+": "+v+"D "+(v>0?m:"")+" "}console.log("%c"+u+"	%c"+a+"	%c"+l+"D "+h+"	%c"+c+"	%c"+f+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),HE=20,Cl=3,Ig=7;function zB(t,e,n,r){var i=wi(e),o=function(l,c,h,f){var d=pe(c),m=f[f.length-1],v=new Array(m).fill(0),y=c.length,g=h==="complex64"?Tl(l):l;if(y>1)for(var _=0;_<d/m;_++)for(var w=_*m,x=0;x<m;x++)v[x]=Math.max(v[x],Sl(g[w+x],0,h).length);return v}(t,e,n,i),s=e.length,a=function l(c,h,f,d,m,v){v===void 0&&(v=!0);var y=f==="complex64"?2:1,g=h[0],_=h.length;if(_===0)return f==="complex64"?[Sl(Tl(c)[0],0,f)]:f==="bool"?[pA(c[0])]:[c[0].toString()];if(_===1){if(g>HE){var w=Cl*y,x=Array.from(c.slice(0,w)),S=Array.from(c.slice((g-Cl)*y,g*y));return f==="complex64"&&(x=Tl(x),S=Tl(S)),["["+x.map(function(W,q){return Sl(W,m[q],f)}).join(", ")+", ..., "+S.map(function(W,q){return Sl(W,m[g-Cl+q],f)}).join(", ")+"]"]}return["["+(f==="complex64"?Tl(c):Array.from(c)).map(function(W,q){return Sl(W,m[q],f)}).join(", ")+"]"]}var A=h.slice(1),T=d.slice(1),E=d[0]*y,C=[];if(g>HE){for(var I=0;I<Cl;I++){var P=(N=I*E)+E;C.push.apply(C,l(c.slice(N,P),A,f,T,m,!1))}for(C.push("..."),I=g-Cl;I<g;I++)P=(N=I*E)+E,C.push.apply(C,l(c.slice(N,P),A,f,T,m,I===g-1))}else for(I=0;I<g;I++){var N;P=(N=I*E)+E,C.push.apply(C,l(c.slice(N,P),A,f,T,m,I===g-1))}var k=_===2?",":"";for(C[0]="["+C[0]+k,I=1;I<C.length-1;I++)C[I]=" "+C[I]+k;var j=`,
`;for(I=2;I<_;I++)j+=`
`;return C[C.length-1]=" "+C[C.length-1]+"]"+(v?"":j),C}(t,e,n,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+s),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(a.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Sl(t,e,n){return au(Array.isArray(t)?parseFloat(t[0].toFixed(Ig))+" + "+parseFloat(t[1].toFixed(Ig))+"j":B1(t)?"'"+t+"'":n==="bool"?pA(t):parseFloat(t.toFixed(Ig)).toString(),e)}function pA(t){return t===0?"false":"true"}function Tl(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var Dc=function(){function t(e,n,r){var i=this;if(this.dtype=n,this.shape=e.slice(),this.size=pe(e),r!=null){var o=r.length;O(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||kd(n,this.size),this.strides=wi(e)}return t.prototype.set=function(e){for(var n=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),O(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var o=this.locToIndex(r);this.values[o]=e},t.prototype.get=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},t.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return n},t.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(e/this.strides[r]),e-=n[r]*this.strides[r];return n[n.length-1]=e,n},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return fi().makeTensor(this.values,this.shape,this.dtype)},t}(),fi=null,K=null,mA=null,_t=function(){function t(e,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=pe(e),this.strides=wi(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),O(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(e,n){return this.throwIfDisposed(),this.reshape([e,n])},t.prototype.as3D=function(e,n,r){return this.throwIfDisposed(),this.reshape([e,n,r])},t.prototype.as4D=function(e,n,r,i){return this.throwIfDisposed(),this.reshape([e,n,r,i])},t.prototype.as5D=function(e,n,r,i,o){return this.throwIfDisposed(),this.reshape([e,n,r,i,o])},t.prototype.asType=function(e){return this.throwIfDisposed(),K.cast(this,e)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return he(this,void 0,void 0,function(){var e;return fe(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return e=n.sent(),[2,K.buffer(this.shape,this.dtype,e)]}})})},t.prototype.bufferSync=function(){return K.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return he(this,void 0,void 0,function(){var e;return fe(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return e=n.sent(),[2,zE(this.shape,e)]}})})},t.prototype.arraySync=function(){return zE(this.shape,this.dataSync())},t.prototype.data=function(){return he(this,void 0,void 0,function(){var e,n;return fe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=fi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:n=r.sent();try{return[2,n.map(function(i){return Pd(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var e=fi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(n){return Pd(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},t.prototype.bytes=function(){return he(this,void 0,void 0,function(){var e;return fe(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,fi().read(this.dataId)];case 1:return e=n.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(fi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(e){return e===void 0&&(e=!1),K.print(this,e)},t.prototype.reshape=function(e){return this.throwIfDisposed(),K.reshape(this,e)},t.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},t.prototype.expandDims=function(e){return e===void 0&&(e=0),K.expandDims(this,e)},t.prototype.cumsum=function(e,n,r){return e===void 0&&(e=0),n===void 0&&(n=!1),r===void 0&&(r=!1),K.cumsum(this,e,n,r)},t.prototype.squeeze=function(e){return this.throwIfDisposed(),K.squeeze(this,e)},t.prototype.clone=function(){return this.throwIfDisposed(),K.clone(this)},t.prototype.oneHot=function(e,n,r){return this.throwIfDisposed(),K.oneHot(this,e,n,r)},t.prototype.toString=function(e){return e===void 0&&(e=!1),zB(this.dataSync(),this.shape,this.dtype,e)},t.prototype.tile=function(e){return this.throwIfDisposed(),K.tile(this,e)},t.prototype.gather=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),K.gather(this,e,n)},t.prototype.matMul=function(e,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),K.matMul(this,e,n,r)},t.prototype.dot=function(e){return this.throwIfDisposed(),K.dot(this,e)},t.prototype.norm=function(e,n,r){return e===void 0&&(e="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),K.norm(this,e,n,r)},t.prototype.slice=function(e,n){return this.throwIfDisposed(),K.slice(this,e,n)},t.prototype.reverse=function(e){return this.throwIfDisposed(),K.reverse(this,e)},t.prototype.concat=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),K.concat([this].concat(e),n)},t.prototype.split=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),K.split(this,e,n)},t.prototype.stack=function(e,n){return n===void 0&&(n=0),K.stack([this,e],n)},t.prototype.unstack=function(e){return e===void 0&&(e=0),K.unstack(this,e)},t.prototype.pad=function(e,n){return n===void 0&&(n=0),K.pad(this,e,n)},t.prototype.batchNormalization=function(e,n,r,i,o){return r===void 0&&(r=.001),mA("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,n,o,i,r)},t.prototype.batchNorm=function(e,n,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),K.batchNorm(this,e,n,r,i,o)},t.prototype.all=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.all(this,e,n)},t.prototype.any=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.any(this,e,n)},t.prototype.logSumExp=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.logSumExp(this,e,n)},t.prototype.sum=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.sum(this,e,n)},t.prototype.prod=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.prod(this,e,n)},t.prototype.mean=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.mean(this,e,n)},t.prototype.min=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.min(this,e,n)},t.prototype.max=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),K.max(this,e,n)},t.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),K.argMin(this,e)},t.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),K.argMax(this,e)},t.prototype.cast=function(e){return this.throwIfDisposed(),K.cast(this,e)},t.prototype.add=function(e){return this.throwIfDisposed(),K.add(this,e)},t.prototype.addStrict=function(e){return this.throwIfDisposed(),K.addStrict(this,e)},t.prototype.atan2=function(e){return this.throwIfDisposed(),K.atan2(this,e)},t.prototype.sub=function(e){return this.throwIfDisposed(),K.sub(this,e)},t.prototype.subStrict=function(e){return this.throwIfDisposed(),K.subStrict(this,e)},t.prototype.pow=function(e){return this.throwIfDisposed(),K.pow(this,e)},t.prototype.powStrict=function(e){return this.throwIfDisposed(),K.powStrict(this,e)},t.prototype.mul=function(e){return this.throwIfDisposed(),K.mul(this,e)},t.prototype.mulStrict=function(e){return this.throwIfDisposed(),K.mulStrict(this,e)},t.prototype.div=function(e){return this.throwIfDisposed(),K.div(this,e)},t.prototype.divNoNan=function(e){return this.throwIfDisposed(),K.divNoNan(this,e)},t.prototype.floorDiv=function(e){return this.throwIfDisposed(),K.floorDiv(this,e)},t.prototype.divStrict=function(e){return this.throwIfDisposed(),K.divStrict(this,e)},t.prototype.minimum=function(e){return this.throwIfDisposed(),K.minimum(this,e)},t.prototype.minimumStrict=function(e){return this.throwIfDisposed(),K.minimumStrict(this,e)},t.prototype.maximum=function(e){return this.throwIfDisposed(),K.maximum(this,e)},t.prototype.maximumStrict=function(e){return this.throwIfDisposed(),K.maximumStrict(this,e)},t.prototype.mod=function(e){return this.throwIfDisposed(),K.mod(this,e)},t.prototype.modStrict=function(e){return this.throwIfDisposed(),K.modStrict(this,e)},t.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),K.squaredDifferenceStrict(this,e)},t.prototype.transpose=function(e){return this.throwIfDisposed(),K.transpose(this,e)},t.prototype.notEqual=function(e){return this.throwIfDisposed(),K.notEqual(this,e)},t.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),K.notEqualStrict(this,e)},t.prototype.less=function(e){return this.throwIfDisposed(),K.less(this,e)},t.prototype.lessStrict=function(e){return this.throwIfDisposed(),K.lessStrict(this,e)},t.prototype.equal=function(e){return this.throwIfDisposed(),K.equal(this,e)},t.prototype.equalStrict=function(e){return this.throwIfDisposed(),K.equalStrict(this,e)},t.prototype.lessEqual=function(e){return this.throwIfDisposed(),K.lessEqual(this,e)},t.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),K.lessEqualStrict(this,e)},t.prototype.greater=function(e){return this.throwIfDisposed(),K.greater(this,e)},t.prototype.greaterStrict=function(e){return this.throwIfDisposed(),K.greaterStrict(this,e)},t.prototype.greaterEqual=function(e){return this.throwIfDisposed(),K.greaterEqual(this,e)},t.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),K.greaterEqualStrict(this,e)},t.prototype.logicalAnd=function(e){return this.throwIfDisposed(),K.logicalAnd(this,e)},t.prototype.logicalOr=function(e){return this.throwIfDisposed(),K.logicalOr(this,e)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),K.logicalNot(this)},t.prototype.logicalXor=function(e){return this.throwIfDisposed(),K.logicalXor(this,e)},t.prototype.where=function(e,n){return this.throwIfDisposed(),K.where(e,this,n)},t.prototype.neg=function(){return this.throwIfDisposed(),K.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),K.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),K.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),K.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),K.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),K.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),K.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),K.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),K.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),K.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),K.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),K.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),K.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),K.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),K.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),K.abs(this)},t.prototype.clipByValue=function(e,n){return this.throwIfDisposed(),K.clipByValue(this,e,n)},t.prototype.relu=function(){return this.throwIfDisposed(),K.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),K.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),K.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),K.selu(this)},t.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),K.leakyRelu(this,e)},t.prototype.prelu=function(e){return this.throwIfDisposed(),K.prelu(this,e)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),K.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),K.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),K.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),K.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),K.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),K.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),K.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),K.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),K.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),K.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),K.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),K.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),K.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),K.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),K.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),K.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),K.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),K.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),K.round(this)},t.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),K.step(this,e)},t.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),K.softmax(this,e)},t.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),K.logSoftmax(this,e)},t.prototype.resizeBilinear=function(e,n){return n===void 0&&(n=!1),this.throwIfDisposed(),K.image.resizeBilinear(this,e,n)},t.prototype.resizeNearestNeighbor=function(e,n){return n===void 0&&(n=!1),this.throwIfDisposed(),K.image.resizeNearestNeighbor(this,e,n)},t.prototype.conv1d=function(e,n,r,i,o,s){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),K.conv1d(this,e,n,r,i,o,s)},t.prototype.conv2d=function(e,n,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),K.conv2d(this,e,n,r,i,o,s)},t.prototype.conv2dTranspose=function(e,n,r,i,o){return this.throwIfDisposed(),K.conv2dTranspose(this,e,n,r,i,o)},t.prototype.depthwiseConv2D=function(e,n,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),K.depthwiseConv2d(this,e,n,r,i,o,s)},t.prototype.separableConv2d=function(e,n,r,i,o,s){return o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),K.separableConv2d(this,e,n,r,i,o,s)},t.prototype.avgPool=function(e,n,r,i){return this.throwIfDisposed(),K.avgPool(this,e,n,r,i)},t.prototype.maxPool=function(e,n,r,i){return this.throwIfDisposed(),K.maxPool(this,e,n,r,i)},t.prototype.localResponseNormalization=function(e,n,r,i){return e===void 0&&(e=5),n===void 0&&(n=1),r===void 0&&(r=1),i===void 0&&(i=.5),K.localResponseNormalization(this,e,n,r,i)},t.prototype.pool=function(e,n,r,i,o){return this.throwIfDisposed(),K.pool(this,e,n,r,i,o)},t.prototype.variable=function(e,n,r){return e===void 0&&(e=!0),this.throwIfDisposed(),fi().makeVariable(this,e,n,r)},t.prototype.unsortedSegmentSum=function(e,n){return this.throwIfDisposed(),K.unsortedSegmentSum(this,e,n)},t.prototype.batchToSpaceND=function(e,n){return this.throwIfDisposed(),K.batchToSpaceND(this,e,n)},t.prototype.spaceToBatchND=function(e,n){return this.throwIfDisposed(),K.spaceToBatchND(this,e,n)},t.prototype.topk=function(e,n){return e===void 0&&(e=1),n===void 0&&(n=!0),this.throwIfDisposed(),K.topk(this,e,n)},t.prototype.stridedSlice=function(e,n,r,i,o,s,a,u){return i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),this.throwIfDisposed(),K.stridedSlice(this,e,n,r,i,o,s,a,u)},t.prototype.depthToSpace=function(e,n){return this.throwIfDisposed(),K.depthToSpace(this,e,n)},t.prototype.fft=function(){return this.throwIfDisposed(),K.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),K.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),K.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),K.spectral.irfft(this)},t}();Object.defineProperty(_t,Symbol.hasInstance,{value:function(t){return!!t&&t.dataId!=null&&t.shape!=null&&t.dtype!=null}});var GE,Iy,Ry,Ay,ky,Au=function(t){function e(n,r,i,o){var s=t.call(this,n.shape,n.dtype,n.dataId,o)||this;return s.trainable=r,s.name=i,s}return ei(e,t),e.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!rn(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");fi().disposeTensor(this),this.dataId=n.dataId,fi().incRef(this,null)},e.prototype.dispose=function(){fi().disposeVariable(this),this.isDisposedInternal=!0},e}(_t);Object.defineProperty(Au,Symbol.hasInstance,{value:function(t){return t instanceof _t&&t.assign!=null&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(GE||(GE={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Iy||(Iy={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ry||(Ry={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Ay||(Ay={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(ky||(ky={}));var $B={float32:Ay,int32:Iy,bool:Ry,complex64:ky};function un(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error("Can not upcast "+t+" with "+e)}return $B[t][e]}function Rg(t){return un(t,"int32")}function St(t,e){if(t.dtype===e.dtype)return[t,e];var n=un(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function HB(t,e){O(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function gA(t){var e=[];return function n(r,i,o){if(r!=null){if(r instanceof _t)return void i.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,a=r;for(var u in a){var l=a[u];o.has(l)||(o.add(l),n(l,i,o))}}}}(t,e,new Set),e}var Ag,qE=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},t}(),GB=function(){function t(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new qE}return t.prototype.ready=function(){return he(this,void 0,void 0,function(){var e,n,r;return fe(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),n=0,i.label=1;case 1:return n<e.length?(r=e[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),n=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},t.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},t.prototype.registerBackend=function(e,n,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:n,priority:r},!0)},t.prototype.setBackend=function(e){return he(this,void 0,void 0,function(){var n,r,i;return fe(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(e),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new UB(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var e=this;UE(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},t.prototype.disposeRegisteredKernels=function(e){var n=this;UE(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[e])})},t.prototype.initializeBackend=function(e){var n=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<n.pendingBackendInitId)&&(n.registry[e]=a,n.pendingBackendInit=null,!0)}).catch(function(a){return!(o<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return e.registryFactory[r].priority-e.registryFactory[n].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),n=0;n<e.length;n++){var r=e[n],i=this.initializeBackend(r),o=i.success,s=i.asyncInit;if(s||o)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(e,n){var r=this.state.tensorInfo.get(n),i=r.backend,o=this.readSync(n);i.disposeData(n),r.backend=e,e.move(n,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(e,n){var r,i=this,o=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(e,n,r){e();try{var i=r();return n(),i}catch(o){throw n(),o}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(e){var n=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[n],function(i){return{x:function(){return i.toFloat()}}},[]),n},t.prototype.runKernel=function(e,n,r,i,o){return this.runKernelFunc(null,n,null,e,r,i,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(e,n,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-o-s;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},t.prototype.runKernelFunc=function(e,n,r,i,o,s,a){var u,l=this;s===void 0&&(s=[]),a===void 0&&(a=[]);var c=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var f,d=function(_){h&&(c=_.map(function(w){return l.keep(l.clone(w))}))},m=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,g=sA(i,this.backendName);return f=g!=null?function(){var _=l.backend.numDataIds();y=g.kernelFunc({inputs:n,attrs:o,backend:l.backend});var w=Array.isArray(y)?y:[y];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,_,w);var x=w.map(function(A){var T=A.dataId,E=A.shape,C=A.dtype;return l.makeTensorFromDataId(T,E,C)}),S=x.filter(function(A,T){return a[T]});return d((s||[]).slice().concat(S)),x}:function(){var _=l.backend.numDataIds();y=l.tidy(function(){return e(l.backend,d)});var w=Array.isArray(y)?y:[y];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,_,w),w},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,n,function(){return f()}):f()}),h&&this.addTapeNode(i,n,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(_){return n[_].shape}),outputShapes:u.map(function(_){return _.shape})}),Array.isArray(y)?u:u[0]},t.prototype.makeTensor=function(e,n,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&B1(e[0])&&(o=e.map(function(c){return BB(c)}));var s=i.write(o,n,r),a=new _t(n,r,s,this.nextTensorId());if(this.incRef(a,i),r==="string"){var u=this.state.tensorInfo.get(s),l=OB(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return a},t.prototype.makeTensorFromDataId=function(e,n,r,i){var o=new _t(n,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},t.prototype.makeVariable=function(e,n,r,i){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Au(e,n,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(e,n){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*cA(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Au||this.track(e)},t.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(e.dataId);n.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var n=this.state.registeredVariables[e];this.disposeVariable(n)}},t.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},t.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},t.prototype.profile=function(e){return he(this,void 0,void 0,function(){var n,r;return fe(this,function(i){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},t.prototype.addTapeNode=function(e,n,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:o},u=RB(e);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=function(l){return l=l.map(function(c,h){if(c==null){var f=r[h],d=sh(f.size,f.dtype);return s.makeTensor(d,f.shape,f.dtype)}return c}),i(l.length>1?l:l[0],o)}),this.state.activeTape.push(a)},t.prototype.keep=function(e){return e.kept=!0,e},t.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(e){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n},t.prototype.endScope=function(e){for(var n=this,r=gA(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||n.track(u)})},t.prototype.gradients=function(e,n,r,i){var o=this;if(i===void 0&&(i=!1),O(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});O(s instanceof _t,function(){return"The result y returned by f() must be a tensor."});var a=function(u,l,c){for(var h={},f={},d=0;d<l.length;d++)h[l[d].id]=!0;for(d=0;d<u.length;d++){var m=(A=u[d]).inputs;for(var v in m){for(var y=m[v],g=!1,_=0;_<l.length;_++)if(h[y.id]){A.outputs.forEach(function(I){return h[I.id]=!0}),g=!0,f[A.id]=!0;break}if(g)break}}var w={};w[c.id]=!0;var x={};for(d=u.length-1;d>=0;d--)for(m=(A=u[d]).inputs,_=0;_<A.outputs.length;_++)if(w[A.outputs[_].id]){for(var v in m)w[m[v].id]=!0,x[A.id]=!0;break}var S=[];for(d=0;d<u.length;d++){var A;if(f[(A=u[d]).id]&&x[A.id]){var T={};for(var v in A.inputs){var E=A.inputs[v];h[E.id]&&(T[v]=E)}var C=Object.assign({},A);C.inputs=T,C.outputs=A.outputs,S.push(C)}}return S}(this.state.activeTape,n,s);if(!i&&a.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[s.id]=r??(u=s.shape,l=fA(pe(u),"float32"),B.makeTensor(l,u,"float32")),function(f,d,m){for(var v=function(g){var _=d[g],w=[];if(_.outputs.forEach(function(T){var E=f[T.id];E!=null?w.push(E):w.push(null)}),_.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+_.kernelName+".");var x=_.gradient(w),S=function(T){if(!(T in x))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(x)+".");var E=m(function(){return x[T]()});if(E.dtype!=="float32")throw new Error("Error in gradient for op "+_.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+E.dtype+"'");var C=_.inputs[T];if(!rn(E.shape,C.shape))throw new Error("Error in gradient for op "+_.kernelName+". The gradient of input '"+T+"' has shape '"+E.shape+"', which does not match the shape of the input '"+C.shape+"'");if(f[C.id]==null)f[C.id]=E;else{var I=f[C.id];f[C.id]=I.add(E),I.dispose()}};for(var A in _.inputs)S(A)},y=d.length-1;y>=0;y--)v(y)}(c,a,function(f){return o.tidy(f)});var h=n.map(function(f){return c[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var d=0,m=f.saved;d<m.length;d++)m[d].dispose()}),o.state.activeTape=null),{value:s,grads:h}})},t.prototype.customGrad=function(e){var n=this;return O(Sy(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];O(i.every(function(a){return a instanceof _t}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),n.runKernelFunc(function(a,u){return O((r=e.apply(void 0,i.concat([u]))).value instanceof _t,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),O(Sy(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];O(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),O(c.every(function(f){return f instanceof _t}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(f,d){h[d]=function(){return f}}),h})}},t.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},t.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},t.prototype.time=function(e){return he(this,void 0,void 0,function(){var n,r;return fe(this,function(i){switch(i.label){case 0:return n=ci(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=ci()-n,[2,r]}})})},t.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new qE,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),B=function(){var t=function(){if(Ag==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}Ag=n}return Ag}();if(t._tfengine==null){var e=new TB(t);t._tfengine=new GB(e)}return function(n){oA=n}(t._tfengine.ENV),fi=function(){return t._tfengine},t._tfengine}();function vA(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Pi=J();Pi.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Pi.registerFlag("IS_BROWSER",function(){return vA()}),Pi.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Pi.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Pi.registerFlag("PROD",function(){return!1}),Pi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Pi.getBool("DEBUG")}),Pi.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Pi.registerFlag("IS_TEST",function(){return!1});var Mc,hr,lr,Ts={},kg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qB(t,e){Ts[t]=e}function Si(t){t in Ts||(Ts[t]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Ts[n]},!1),n===1?r.getContext("webgl",kg)||r.getContext("experimental-webgl",kg):r.getContext("webgl2",kg)}(t));var e=Ts[t];return e.isContextLost()?(delete Ts[t],Si(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Ts[t])}function Gp(t,e){return[e,t]}function Zl(t){var e=pe(t);return Cy(Math.ceil(e/4))}function ah(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function j1(t,e){var n,r,i,o,s,a,u,l,c,h=t;return J().getNumber("WEBGL_VERSION")===2?(n=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,s=h.RED,a=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(n=t.RGBA,r=t.RGBA,i=t.RGBA,o=h.RGBA,s=t.RGBA,a=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function ge(t,e,n){var r=n();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+QB(i,o))}(t),r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Mc||(Mc={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(hr||(hr={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(lr||(lr={}));var KB=596e-10,XB=65504;function YB(t){return!!(J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||KB<Math.abs(t)&&Math.abs(t)<XB)}function QB(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function uf(t,e,n){return no(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function JB(t,e,n){var r=no(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ge(t,e,function(){return t.shaderSource(r,n)}),ge(t,e,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ZB(t,e,n){var r=no(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ge(t,e,function(){return t.shaderSource(r,n)}),ge(t,e,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw function(i,o){var s=e6.exec(o);if(s==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(y,g){return au((g+1).toString(),l)+y}),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var d=c.slice(0,a-1),m=c.slice(a-1,a),v=c.slice(a);console.log(d.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+au(m[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Pg,Ng,e6=/ERROR: [0-9]+:([0-9]+):/g;function t6(t,e){return no(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function n6(t,e,n){if(ge(t,e,function(){return t.linkProgram(n)}),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Dg(t,e,n){if(ge(t,e,function(){return t.validateProgram(n)}),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function r6(t,e,n){var r=no(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ge(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),ge(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function i6(t,e,n){var r=no(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ge(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),ge(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function o6(t,e){return no(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function s6(t,e){var n=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function a6(t,e){return no(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function KE(t,e,n,r,i,o,s,a){var u=t.getAttribLocation(n,r);return u!==-1&&(ge(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),ge(t,e,function(){return t.vertexAttribPointer(u,o,t.FLOAT,!1,s,a)}),ge(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function u6(t,e,n,r){d6(t,r),ge(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),ge(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function l6(t,e,n,r){return no(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function c6(t,e,n){return t.getUniformLocation(e,n)}function h6(t,e,n,r,i,o){ge(t,e,function(){return u6(t,e,r,o)}),ge(t,e,function(){return t.uniform1i(i,o)})}function Mg(t,e,n,r){ge(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),ge(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function XE(t,e,n){ge(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),ge(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function lf(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+f6(t,e))}function f6(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function no(t,e,n,r){var i=ge(t,e,function(){return n()});if(i==null)throw new Error(r);return i}function d6(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function Nd(t,e){return e===void 0&&(e=2),pe(t.slice(0,t.length-e))}function Dd(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Fg(t){var e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Nd(t)].concat(Dd(t))),e}function p6(t,e){var n;e===void 0&&(e=!1);var r=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(t=t.map(function(l,c){return c>=t.length-2?lA(t[c]):t[c]})).length===1&&(t=[2,t[0]])),t.length!==2){var i=ks(t);t=i.newShape}var o=pe(t);if(t.length<=1&&o<=r)return[1,o];if(t.length===2&&t[0]<=r&&t[1]<=r)return t;if(t.length===3&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var s=Nd(t),a=2,u=2;return t.length&&(a=(n=Dd(t))[0],u=n[1]),Cy(o=s*(a/2)*(u/2)).map(function(l){return 2*l})}return Cy(o)}function cf(t){return t%2==0}function hf(t,e){if(rn(t=t.slice(-2),e=e.slice(-2))||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r||cf(n)&&cf(r)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&cf(t[0])&&cf(e[0])}function m6(t){if(Pg==null){var e=Si(t);Pg=e.getParameter(e.MAX_TEXTURE_SIZE)}return Pg}function g6(t){if(Ng==null){var e=Si(t);Ng=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ng)}function v6(t){if(t===0)return 0;var e=Si(t);return Ar(e,"EXT_disjoint_timer_query_webgl2")&&t===2?2:Ar(e,"EXT_disjoint_timer_query")?1:0}function Ar(t,e){return t.getExtension(e)!=null}function YE(t){try{if(Si(t)!=null)return!0}catch{return!1}return!1}function y6(t){if(t===0)return!1;var e=Si(t);if(t===1){if(!Ar(e,"OES_texture_float"))return!1}else if(!Ar(e,"EXT_color_buffer_float"))return!1;return Py(e)}function _6(t){if(t===0)return!1;var e=Si(t);if(t!==1){if(Ar(e,"EXT_color_buffer_float"))return Py(e);if(Ar(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=j1(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),u}(e,n)}return!1}return!!Ar(e,"OES_texture_float")&&!!Ar(e,"WEBGL_color_buffer_float")&&Py(e)}function Py(t){var e=j1(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function w6(t){return t===2&&Si(t).fenceSync!=null}var Ie=J();function yA(t){J().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ue(t,e){return B.tidy(t,e)}function tr(t){gA(t).forEach(function(e){return e.dispose()})}function x6(t){return B.keep(t)}function Md(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];J().getBool("IS_TEST")||console.warn.apply(console,t)}function ls(t,e){var n=t;if(_i(t))return e==="string"?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||_i(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&J().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],!Array.isArray(o)&&!_i(o))return void O(s.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"});O(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),O(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var u=s.slice(1),l=0;l<o.length;++l)i(o[l],u,a.concat(l))}(t,r,[]),r}function QE(t,e,n,r){if(t!=null&&(t!=="numeric"&&t!==e||t==="numeric"&&e==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function M(t,e,n,r){if(r===void 0&&(r="numeric"),t instanceof _t)return QE(r,t.dtype,e,n),t;var i=oh(t);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),QE(r,i,e,n),t==null||!_i(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){var o=t==null?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+o+"'")}var s=ls(t,i);_i(t)||Array.isArray(t)||(t=[t]);var a=i!=="string"?hA(t,i,J().getBool("DEBUG")):Ru(t,[],!0);return B.makeTensor(a,s,i)}function Fd(t,e,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(i,o){return M(i,e+"["+o+"]",n)},r)}function _A(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function b6(t,e,n){for(var r=t.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)n.indexOf(a)===-1?i.push(t[o++]):i.push(e[s++]);return i}function wn(t,e){for(var n=[],r=t.length,i=0;i<r;i++)e.indexOf(i)===-1&&n.push(t[i]);return[n,e.map(function(o){return t[o]})]}function rr(t,e){return b6(t,e.map(function(n){return 1}),e)}function ur(t,e,n){O(_A(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function Ti(t,e){if(_A(t,e))return null;for(var n=[],r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);return t.forEach(function(i){return n.push(i)}),n}function U1(t){return t.map(function(e,n){return[n,e]}).sort(function(e,n){return e[1]-n[1]}).map(function(e){return e[0]})}function Ii(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function E6(t,e){var n=t[0].length;t.forEach(function(i,o){O(i.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+n+")"})}),O(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(i,o){for(var s=0;s<n;s++)O(s===e||i[s]===r[s],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function ku(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function L(t){var e=Object.keys(t);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];B.startScope(n);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),B.endScope(a),a}catch(u){throw B.endScope(null),u}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Ie.registerFlag("HAS_WEBGL",function(){return Ie.getNumber("WEBGL_VERSION")>0}),Ie.registerFlag("WEBGL_VERSION",function(){return YE(2)?2:YE(1)?1:0}),Ie.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ie.get("WEBGL_VERSION")===2}),Ie.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ie.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ie.registerFlag("WEBGL_PACK",function(){return Ie.getBool("HAS_WEBGL")}),Ie.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_CLIP",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ie.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_REDUCE",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_CONV_IM2COL",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return m6(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return g6(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=Ie.getNumber("WEBGL_VERSION");return t===0?0:v6(t)}),Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ie.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),Ie.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return y6(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ie.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ie.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ie.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return _6(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return w6(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ie.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),mA=yA;var an=L({complex_:function(t,e){var n=M(t,"real","complex"),r=M(e,"imag","complex");return Qe(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),B.runKernelFunc(function(i){return i.complex(n,r)},{$real:n,$imag:r})}}),Ir=L({real_:function(t){var e=M(t,"input","real");return B.runKernelFunc(function(n){return n.real(e)},{$input:e})}}),di=L({imag_:function(t){var e=M(t,"input","imag");return B.runKernelFunc(function(n){return n.imag(e)},{$input:e})}});function cn(t,e,n){return cs(t,e,ls(t,n),n)}function cs(t,e,n,r){if(r==null&&(r=oh(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!_i(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){dA(e);var i=pe(e),o=pe(n);O(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<n.length;++s){var a=n[s],u=s!==n.length-1||a!==pe(e.slice(s));O(n[s]===e[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return _i(t)||Array.isArray(t)||(t=[t]),e=e||n,t=r!=="string"?hA(t,r,J().getBool("DEBUG")):Ru(t,[],!0),B.makeTensor(t,e,r)}function se(t,e){if((_i(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&_i(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return cs(t,[],[],e)}function Lt(t,e){$u(t);var n=ls(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return cs(t,null,n,e)}function Bo(t,e,n){if($u(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=ls(t,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return cs(t,e,r,n)}function W1(t,e,n){if($u(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=ls(t,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return cs(t,e,r,n)}function Kn(t,e,n){if($u(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=ls(t,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return cs(t,e,r,n)}function C6(t,e,n){if($u(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=ls(t,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return cs(t,e,r,n)}function S6(t,e,n){if($u(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=ls(t,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return cs(t,e=e||r,r,n)}function T6(t,e,n,r){return e===void 0&&(e=!0),B.makeVariable(t,e,n,r)}function Hu(t,e){if(e===void 0&&(e="float32"),e==="complex64"){var n=Hu(t,"float32"),r=ct(t,"float32");return an(n,r)}var i=fA(pe(t),e);return B.makeTensor(i,t,e)}function ct(t,e){if(e===void 0&&(e="float32"),e==="complex64"){var n=ct(t,"float32"),r=ct(t,"float32");return an(n,r)}var i=sh(pe(t),e);return B.makeTensor(i,t,e)}function xi(t,e,n){return B.runKernelFunc(function(r){return r.fill(t,e,n)},{})}function I6(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return B.runKernelFunc(function(r){return r.linspace(t,e,n)},{})}function Od(t,e,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return ct([0],r);var i=sh(Math.abs(Math.ceil((e-t)/n)),r);e<t&&n===1&&(n=-1),i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return Lt(i,r)}var wA=L({onesLike_:function(t){var e=M(t,"x","onesLike");if(e.dtype==="complex64"){var n=wA(Ir(e)),r=$e(di(e));return an(n,r)}return B.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return $e(i)}}})}}),$e=L({zerosLike_:function(t){var e=M(t,"x","zerosLike");return B.runKernelFunc(function(n){return n.zerosLike(e)},{$x:e},function(n,r){return{$x:function(){return $e(n)}}})}}),zt=L({concat_:function(t,e){e===void 0&&(e=0),O(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=Fd(t,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")}),e=qt(e,n[0].shape)[0];var r=ku(n.map(function(a){return a.shape}),e);if(pe(r)===0)return cn([],r);if((n=n.filter(function(a){return a.size>0})).length===1)return n[0];var i=n.map(function(a){return a.shape});E6(i,e);var o=n,s={axis:e};return B.runKernelFunc(function(a){return a.concat(n,e)},o,function(a){var u=i.map(function(l){return l[e]});return z1(a,u,e).map(function(l){return function(){return l}})},"Concat",s)}}),R6=L({concat1d_:function(t){return zt(t,0)}}),A6=L({concat2d_:function(t,e){return zt(t,e)}}),k6=L({concat3d_:function(t,e){return zt(t,e)}}),P6=L({concat4d_:function(t,e){return zt(t,e)}}),z1=L({split_:function(t,e,n){n===void 0&&(n=0);var r,i=M(t,"x","split");return n=qt(n,i.shape)[0],typeof e=="number"?(O(i.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[n]/e)):(O(i.shape[n]===e.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),B.runKernelFunc(function(o){return o.split(i,r,n)},{$x:i},function(o){return{$x:function(){return zt(o,n)}}})}});function ca(t,e){return t(e={exports:{}},e.exports),e.exports}var N6=ca(function(t){(function(e,n,r){function i(a){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var d=.02519603282416938*(u+=h.charCodeAt(f));d-=u=d>>>0,u=(d*=u)>>>0,u+=4294967296*(d-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var l=new i(a),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=s:this.alea=s})(0,t)}),D6=ca(function(t){(function(e,n,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=s:this.xor128=s})(0,t)}),M6=ca(function(t){(function(e,n,r){function i(a){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=s:this.xorwow=s})(0,t)}),F6=ca(function(t){(function(e,n,r){function i(a){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=s:this.xorshift7=s})(0,t)}),O6=ca(function(t){(function(e,n,r){function i(a){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,d=u.i;return u.w=h=h+1640531527|0,c=f[d+34&127],l=f[d=d+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[d]=c^l,u.i=d,c+(h^h>>>16)|0},function(l,c){var h,f,d,m,v,y=[],g=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,g=Math.max(g,c.length)),d=0,m=-32;m<g;++m)c&&(f^=c.charCodeAt((m+32)%c.length)),m===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(v=v+1640531527|0,d=(h=y[127&m]^=f+v)==0?d+1:0);for(d>=128&&(y[127&(c&&c.length||0)]=-1),d=127,m=512;m>0;--m)f=y[d+34&127],h=y[d=d+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,y[d]=f^h;l.w=v,l.X=y,l.i=d}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=s:this.xor4096=s})(0,t)}),L6=ca(function(t){(function(e,n,r){function i(a){var u=this,l="";u.next=function(){var h=u.b,f=u.c,d=u.d,m=u.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^m,m=m-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-d|0,u.d=d<<16^f>>>16^m,u.a=m-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):l+=a;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=s:this.tychei=s})(0,t)}),Is=ca(function(t){(function(e,n){var r,i=this,o=256,s=6,a="random",u=n.pow(o,s),l=n.pow(2,52),c=2*l,h=o-1;function f(g,_,w){var x=[],S=v(function E(C,I){var P,N=[],k=typeof C;if(I&&k=="object")for(P in C)try{N.push(E(C[P],I-1))}catch{}return N.length?N:k=="string"?C:C+"\0"}((_=_==1?{entropy:!0}:_||{}).entropy?[g,y(e)]:g??function(){try{var E;return r&&(E=r.randomBytes)?E=E(o):(E=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(E)),y(E)}catch{var C=i.navigator,I=C&&C.plugins;return[+new Date,i,I,i.screen,y(e)]}}(),3),x),A=new d(x),T=function(){for(var E=A.g(s),C=u,I=0;E<l;)E=(E+I)*o,C*=o,I=A.g(1);for(;E>=c;)E/=2,C/=2,I>>>=1;return(E+I)/C};return T.int32=function(){return 0|A.g(4)},T.quick=function(){return A.g(4)/4294967296},T.double=T,v(y(A.S),e),(_.pass||w||function(E,C,I,P){return P&&(P.S&&m(P,A),E.state=function(){return m(A,{})}),I?(n[a]=E,C):E})(T,S,"global"in _?_.global:this==n,_.state)}function d(g){var _,w=g.length,x=this,S=0,A=x.i=x.j=0,T=x.S=[];for(w||(g=[w++]);S<o;)T[S]=S++;for(S=0;S<o;S++)T[S]=T[A=h&A+g[S%w]+(_=T[S])],T[A]=_;(x.g=function(E){for(var C,I=0,P=x.i,N=x.j,k=x.S;E--;)C=k[P=h&P+1],I=I*o+k[h&(k[P]=k[N=h&N+C])+(k[N]=C)];return x.i=P,x.j=N,I})(o)}function m(g,_){return _.i=g.i,_.j=g.j,_.S=g.S.slice(),_}function v(g,_){for(var w,x=g+"",S=0;S<x.length;)_[h&S]=h&(w^=19*_[h&S])+x.charCodeAt(S++);return y(_)}function y(g){return String.fromCharCode.apply(0,g)}if(n["seed"+a]=f,v(n.random(),e),t.exports){t.exports=f;try{r=require("crypto")}catch{}}})([],Math)});Is.alea=N6,Is.xor128=D6,Is.xorwow=M6,Is.xorshift7=F6,Is.xor4096=O6,Is.tychei=L6;var qp=Is.alea,$1=function(){function t(e,n,r,i,o){this.mean=e,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=qp(s.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var n,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s;while(a>=1||a===0);var u=Math.sqrt(-2*Math.log(a)/a);n=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(n)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},t.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},t.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},t}(),V6=function(){function t(e,n,r,i){this.alpha=e,this.beta=1/n,this.dtype=r;var o=i||Math.random();this.randu=qp(o.toString()),this.randn=new $1(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var e,n,r,i,o,s;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,n=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-s+Math.log(s)),(o=this.randu())<n||Math.log(o)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},t.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},t}(),B6=function(){function t(e,n,r,i){var o=this;if(e===void 0&&(e=0),n===void 0&&(n=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=n-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+n+" <= 1 and dtype is not float");this.random=qp(i)}return t.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Ae(t,e,n){return e===void 0&&(e="float32"),e=e||"float32",dA(t),new Dc(t,e,n)}function j6(t,e){e===void 0&&(e=!1),console.log(t.toString(e))}var xA=L({batchToSpaceND_:function(t,e,n){var r=M(t,"x","batchToSpaceND"),i=e.reduce(function(o,s){return o*s});return O(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),O(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),O(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),B.runKernelFunc(function(o){return o.batchToSpaceND(r,e,n)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,n)}}})}}),U6=L({broadcastTo_:function(t,e){var n=M(t,"broadcastTo","x"),r=n.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=n.reshape(i)}for(var o=Array.from(e),s=e.length-1;s>=0;s--)if(n.shape[s]===e[s])o[s]=1;else if(n.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=o.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return a.length===0?n.clone():B.runKernelFunc(function(u){return u.tile(n,o)},{input:n},function(u){return{input:function(){return u.sum(a,!0)}}})}}),W6=L({cast_:function(t,e){var n=M(t,"x","cast");if(!MB(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return B.runKernelFunc(function(i){return i.cast(n,e)},{x:n},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),z6=L({clone_:function(t){var e=M(t,"x","clone",null);return B.runKernelFunc(function(){return B.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(n){return{$x:function(){return n.toFloat()}}})}}),$6=L({cumsum_:function(t,e,n,r){e===void 0&&(e=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var i=M(t,"x","cumsum"),o=Ti([e|=0],i.rank),s=i;o!=null&&(s=i.transpose(o));var a=Ii(1,i.rank)[0],u=B.runKernelFunc(function(l){return l.cumsum(s,a,n,r)},{permutedX:s},function(l){return{permutedX:function(){return l.cumsum(e,n,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),H6=L({depthToSpace_:function(t,e,n){n===void 0&&(n="NHWC");var r=M(t,"x","depthToSpace"),i=n==="NHWC"?r.shape[1]:r.shape[2],o=n==="NHWC"?r.shape[2]:r.shape[3],s=n==="NHWC"?r.shape[3]:r.shape[1];return O(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),O(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),O(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape}),B.runKernelFunc(function(a){return a.depthToSpace(r,e,n)},{$x:r})}}),Tr=L({expandDims_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","expandDims",null);O(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(O(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),Hr(n,r)}}),bA=L({eye_:function(t,e,n,r){r===void 0&&(r="float32"),e==null&&(e=t);for(var i=Ae([t,e],r),o=t<=e?t:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(t,e);if(n==null)return a;if(n.length===1)return uu(Tr(a,0),[n[0],1,1]);if(n.length===2)return uu(Tr(Tr(a,0),0),[n[0],n[1],1,1]);if(n.length===3)return uu(Tr(Tr(Tr(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),G6=L({multinomial_:function(t,e,n,r){r===void 0&&(r=!1);var i=M(t,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);n=n||Math.random();var a=s===1?i.as2D(1,-1):i,u=B.runKernelFunc(function(l){return l.multinomial(a,r,e,n)},{logits2D:a});return s===1?u.as1D():u}}),Ny=L({oneHot_:function(t,e,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=M(t,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),B.runKernelFunc(function(s){return s.oneHot(i,e,n,r)},{$indices:i},function(s){return{$indices:function(){return ct(i.shape,"float32")}}}).reshape(o)}}),ha=L({pad_:function(t,e,n){n===void 0&&(n=0);var r=M(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:n};return B.runKernelFunc(function(o){return o.pad(r,e,n)},{x:r},function(o){var s=e.map(function(a){return a[0]});return{x:function(){return o.slice(s,r.shape)}}},"PadV2",i)}}),q6=L({pad1d_:function(t,e,n){return n===void 0&&(n=0),O(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ha(t,[e],n)}}),K6=L({pad2d_:function(t,e,n){return n===void 0&&(n=0),O(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ha(t,e,n)}}),X6=L({pad3d_:function(t,e,n){return n===void 0&&(n=0),O(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ha(t,e,n)}}),Y6=L({pad4d_:function(t,e,n){return n===void 0&&(n=0),O(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ha(t,e,n)}}),Q6=L({rand_:function(t,e,n){var r=pe(t),i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return B.makeTensor(i,t,n)}}),J6=L({randomNormal_:function(t,e,n,r,i){if(e===void 0&&(e=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new $1(e,n,r,!1,i),s=Ae(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),Z6=L({randomGamma_:function(t,e,n,r,i){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new V6(e,n,r,i),s=Ae(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),EA=L({randomUniform_:function(t,e,n,r,i){e===void 0&&(e=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var o=Ae(t,r),s=new B6(e,n,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),Hr=L({reshape_:function(t,e){var n=M(t,"x","reshape",null);e=NB(e,n.size),O(n.size===pe(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return B.runKernelFunc(function(i){return i.reshape(n,e)},{x:n},function(i){return{x:function(){return i.reshape(n.shape)}}},"Reshape",r)}}),CA=L({spaceToBatchND_:function(t,e,n){var r=M(t,"x","spaceToBatchND");return O(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),O(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),O(r.shape.reduce(function(i,o,s){return s>0&&s<=e.length?i&&(o+n[s-1][0]+n[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),B.runKernelFunc(function(i){return i.spaceToBatchND(r,e,n)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,n)}}})}}),SA=L({squeeze_:function(t,e){var n=M(t,"x","squeeze");return Hr(n,ks(n.shape,e).newShape)}}),mr=L({stack_:function(t,e){e===void 0&&(e=0);var n=Fd(t,"tensors","stack");if(O(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;O(e<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(a){Qe(i,a.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(a){O(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=n.map(function(a){return a.expandDims(e)});return zt(s,e)}}),uu=L({tile_:function(t,e){var n=M(t,"x","tile",null);O(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."});var r=[n],i={reps:e};return B.runKernelFunc(function(o,s){var a=o.tile(n,e);return s([n]),a},{x:n},function(o,s){var a=s[0];return{x:function(){var u=$e(a);if(a.rank===1)for(var l=0;l<e[0];++l)u=u.add(o.slice([l*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(l=0;l<e[0];++l)for(var c=0;c<e[1];++c)u=u.add(o.slice([l*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(var h=0;h<e[2];++h)u=u.add(o.slice([l*a.shape[0],c*a.shape[1],h*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(h=0;h<e[2];++h)for(var f=0;f<e[3];++f)u=u.add(o.slice([l*a.shape[0],c*a.shape[1],h*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return u}}},"Tile",i,r)}}),e5=L({truncatedNormal_:function(t,e,n,r,i){if(e===void 0&&(e=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new $1(e,n,r,!0,i),s=Ae(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),$t=L({unstack_:function(t,e){e===void 0&&(e=0),e=e||0;var n=M(t,"x","unstack");O(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length);var r={axis:e};return B.runKernelFunc(function(i){return i.unstack(n,e)},{x:n},function(i){return{x:function(){return mr(i,e)}}},"Unpack",r)}}),t5=function(t,e){return he(this,void 0,void 0,function(){var n,r,i,o,s,a,u,l,c,h;return fe(this,function(f){switch(f.label){case 0:return n=M(t,"x","setdiff1d"),r=M(e,"y","setdiff1d"),O(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),O(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),O(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),s=new Set(o),a=0,c=0;c<i.length;c++)s.has(i[c])||a++;for(u=new Dc([a],n.dtype),l=new Dc([a],"int32"),c=0,h=0;c<i.length;c++)s.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Ld(t,e,n,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([t[s+1]/e[s],e[s]]);i=i.concat(t.slice(o+1))}return i}function Vd(t,e,n){n===void 0&&(n=!0);var r=[];if(n){r.push(e);for(var i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<t;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function Bd(t,e,n,r){r===void 0&&(r=!0);var i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(var o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function TA(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function IA(t,e,n){for(var r=t.slice(0,1),i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}function RA(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(t.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],i=1,o=0;o<n.length-1;++o)i*=n[o];var s=t.shape,a=n.slice();a.pop();var u=1;for(o=r;o<t.rank;++o)u*=s[o],a.push(s[o]);var l=wi(t.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[a,i,u,l]}var AA=30;function Og(t){return t<=AA?t:Ty(t,Math.floor(Math.sqrt(t)))}function n5(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(o+" update.rank < "+i+". ");if(t.length<r+(n.rank-i))throw new Error(o+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(var s=0;s<i;++s)if(n.shape[s]!==e.shape[s])throw new Error(o+" updates.shape["+s+"] ("+n.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<n.rank-i;++s)if(n.shape[s+i]!==t[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+n.shape[s+i]+") != shape["+(s+i)+"] ("+t[s+i]+")")}function r5(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(t.size===0)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}n5(n,e,t)}function jd(t,e,n){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length,s=1,a=i;a<o;++a)s*=n[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:pe(e.shape)/u,sliceSize:s,strides:wi(n.slice(0,i)).concat([1]),outputSize:pe(n)}}function i5(t,e,n){O(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),O(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(o){O(e[o]+n[o]<=t.shape[o],function(){return"Error in slice"+t.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+n[o])+") would overflow input.shape["+o+"] ("+t.shape[o]+")"})},i=0;i<t.rank;++i)r(i)}function JE(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function H1(t,e,n){for(var r=[],i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function o5(t,e,n,r,i){var o=e[i],s=n[i]||1;(t&1<<i||o==null)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=Ey(0,o,a-1)}function s5(t,e,n,r,i){var o=e[i],s=n[i]||1;(t&1<<i||o==null)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s>0?Ey(0,o,a):Ey(-1,o,a-1)}function kA(t,e,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function PA(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function a5(t,e){O(Sy(t),function(){return"The f passed in variableGrads(f) must be a function"}),O(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof Au}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=e!=null;if(!n)for(var r in e=[],B.registeredVariables)e.push(B.registeredVariables[r]);var i=n?e.filter(function(c){return!c.trainable}):null,o=e.length;O((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=B.gradients(t,e,null,!0),a=s.value,u=s.grads;O(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),O(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:a,grads:l}}function Kp(t){return B.customGrad(t)}var ro=L({softmax_:function(t,e){e===void 0&&(e=-1);var n=M(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return B.runKernelFunc(function(r,i){var o=r.softmax(n,e);return i([o]),o},{logits:n},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),u5=L({logSoftmax_:function(t,e){e===void 0&&(e=-1);var n=M(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return Kp(function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(n)}}),NA=function(){function t(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},t.prototype.set=function(e,n){this.dataIdsCount++,this.data.set(e,n)},t.prototype.has=function(e){return this.data.has(e)},t.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),DA=function(){function t(){}return t.prototype.time=function(e){return H("time")},t.prototype.read=function(e){return H("read")},t.prototype.readSync=function(e){return H("readSync")},t.prototype.numDataIds=function(){return H("numDataIds")},t.prototype.disposeData=function(e){return H("disposeData")},t.prototype.write=function(e,n,r){return H("write")},t.prototype.move=function(e,n,r,i){return H("move")},t.prototype.memory=function(){return H("memory")},t.prototype.floatPrecision=function(){return H("floatPrecision")},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.batchMatMul=function(e,n,r,i){return H("batchMatMul")},t.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,H("fusedBatchMatMul")},t.prototype.slice=function(e,n,r){return H("slice")},t.prototype.stridedSlice=function(e,n,r,i){return H("stridedSlice")},t.prototype.unstack=function(e,n){return H("unstack")},t.prototype.reverse=function(e,n){return H("reverse")},t.prototype.concat=function(e,n){return H("concat")},t.prototype.neg=function(e){return H("neg")},t.prototype.add=function(e,n){return H("add")},t.prototype.addN=function(e){return H("addN")},t.prototype.subtract=function(e,n){return H("subtract")},t.prototype.multiply=function(e,n){return H("multiply")},t.prototype.realDivide=function(e,n){return H("realDivide")},t.prototype.floorDiv=function(e,n){return H("floorDiv")},t.prototype.sum=function(e,n){return H("sum")},t.prototype.prod=function(e,n){return H("prod")},t.prototype.unsortedSegmentSum=function(e,n,r){return H("unsortedSegmentSum")},t.prototype.argMin=function(e,n){return H("argMin")},t.prototype.argMax=function(e,n){return H("argMax")},t.prototype.equal=function(e,n){return H("equal")},t.prototype.notEqual=function(e,n){return H("notEqual")},t.prototype.less=function(e,n){return H("less")},t.prototype.lessEqual=function(e,n){return H("lessEqual")},t.prototype.greater=function(e,n){return H("greater")},t.prototype.greaterEqual=function(e,n){return H("greaterEqual")},t.prototype.logicalNot=function(e){return H("logicalNot")},t.prototype.logicalAnd=function(e,n){return H("logicalAnd")},t.prototype.logicalOr=function(e,n){return H("logicalOr")},t.prototype.where=function(e){return H("where")},t.prototype.select=function(e,n,r){return H("select")},t.prototype.topk=function(e,n,r){return H("topk")},t.prototype.min=function(e,n){return H("min")},t.prototype.minimum=function(e,n){return H("minimum")},t.prototype.mod=function(e,n){return H("mod")},t.prototype.max=function(e,n){return H("max")},t.prototype.maximum=function(e,n){return H("maximum")},t.prototype.all=function(e,n){return H("all")},t.prototype.any=function(e,n){return H("any")},t.prototype.squaredDifference=function(e,n){return H("squaredDifference")},t.prototype.ceil=function(e){return H("ceil")},t.prototype.floor=function(e){return H("floor")},t.prototype.round=function(e){return H("round")},t.prototype.sign=function(e){return H("sign")},t.prototype.isNaN=function(e){return H("isNaN")},t.prototype.isInf=function(e){return H("isInf")},t.prototype.isFinite=function(e){return H("isFinite")},t.prototype.pow=function(e,n){return H("pow")},t.prototype.exp=function(e){return H("exp")},t.prototype.expm1=function(e){return H("expm1")},t.prototype.softmax=function(e,n){return H("softmax")},t.prototype.log=function(e){return H("log")},t.prototype.log1p=function(e){return H("log1p")},t.prototype.sqrt=function(e){return H("sqrt")},t.prototype.rsqrt=function(e){return H("rsqrt")},t.prototype.square=function(e){return H("square")},t.prototype.reciprocal=function(e){return H("reciprocal")},t.prototype.relu=function(e){return H("relu")},t.prototype.relu6=function(e){return H("relu6")},t.prototype.prelu=function(e,n){return H("prelu")},t.prototype.elu=function(e){return H("elu")},t.prototype.eluDer=function(e,n){return H("eluDer")},t.prototype.selu=function(e){return H("selu")},t.prototype.int=function(e){return H("int")},t.prototype.clip=function(e,n,r){return H("clip")},t.prototype.abs=function(e){return H("abs")},t.prototype.complexAbs=function(e){return H("complexAbs")},t.prototype.sigmoid=function(e){return H("sigmoid")},t.prototype.softplus=function(e){return H("softplus")},t.prototype.sin=function(e){return H("sin")},t.prototype.cos=function(e){return H("cos")},t.prototype.tan=function(e){return H("tan")},t.prototype.asin=function(e){return H("asin")},t.prototype.acos=function(e){return H("acos")},t.prototype.atan=function(e){return H("atan")},t.prototype.atan2=function(e,n){return H("atan2")},t.prototype.sinh=function(e){return H("sinh")},t.prototype.cosh=function(e){return H("cosh")},t.prototype.tanh=function(e){return H("tanh")},t.prototype.asinh=function(e){return H("asinh")},t.prototype.acosh=function(e){return H("acosh")},t.prototype.atanh=function(e){return H("atanh")},t.prototype.erf=function(e){return H("erf")},t.prototype.step=function(e,n){return H("step")},t.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,H("fusedConv2d")},t.prototype.conv2d=function(e,n,r){return H("conv2d")},t.prototype.conv2dDerInput=function(e,n,r){return H("conv2dDerInput")},t.prototype.conv2dDerFilter=function(e,n,r){return H("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,H("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(e,n,r){return H("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(e,n,r){return H("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(e,n,r){return H("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(e,n,r){return H("conv3d")},t.prototype.conv3dDerInput=function(e,n,r){return H("conv3dDerInput")},t.prototype.conv3dDerFilter=function(e,n,r){return H("conv3dDerFilter")},t.prototype.maxPool=function(e,n){return H("maxPool")},t.prototype.maxPoolBackprop=function(e,n,r,i){return H("maxPoolBackprop")},t.prototype.avgPool=function(e,n){return H("avgPool")},t.prototype.avgPoolBackprop=function(e,n,r){return H("avgPoolBackprop")},t.prototype.avgPool3d=function(e,n){return H("avgPool3d")},t.prototype.avgPool3dBackprop=function(e,n,r){return H("avgPool3dBackprop")},t.prototype.maxPool3d=function(e,n){return H("maxPool3d")},t.prototype.maxPool3dBackprop=function(e,n,r,i){return H("maxPool3dBackprop")},t.prototype.reshape=function(e,n){return H("reshape")},t.prototype.cast=function(e,n){return H("cast")},t.prototype.tile=function(e,n){return H("tile")},t.prototype.pad=function(e,n,r){return H("pad")},t.prototype.transpose=function(e,n){return H("transpose")},t.prototype.gather=function(e,n,r){return H("gather")},t.prototype.gatherND=function(e,n){return H("gatherND")},t.prototype.scatterND=function(e,n,r){return H("scatterND")},t.prototype.batchToSpaceND=function(e,n,r){return H("batchToSpaceND")},t.prototype.spaceToBatchND=function(e,n,r){return H("spaceToBatchND")},t.prototype.resizeBilinear=function(e,n,r,i){return H("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(e,n,r){return H("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(e,n,r,i){return H("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(e,n,r){return H("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(e,n,r,i,o,s){return H("batchNormalization")},t.prototype.localResponseNormalization4D=function(e,n,r,i,o){return H("localResponseNormalization4D")},t.prototype.LRNGrad=function(e,n,r,i,o,s,a){return H("LRNGrad")},t.prototype.multinomial=function(e,n,r,i){return H("multinomial")},t.prototype.oneHot=function(e,n,r,i){return H("oneHot")},t.prototype.cumsum=function(e,n,r,i){return H("cumsum")},t.prototype.nonMaxSuppression=function(e,n,r,i,o){return H("nonMaxSuppression")},t.prototype.fft=function(e){return H("fft")},t.prototype.ifft=function(e){return H("ifft")},t.prototype.complex=function(e,n){return H("complex")},t.prototype.real=function(e){return H("real")},t.prototype.imag=function(e){return H("imag")},t.prototype.cropAndResize=function(e,n,r,i,o,s){return H("cropAndResize")},t.prototype.depthToSpace=function(e,n,r){return H("depthToSpace")},t.prototype.split=function(e,n,r){return H("split")},t.prototype.sparseToDense=function(e,n,r,i){return H("sparseToDense")},t.prototype.diag=function(e){return H("diag")},t.prototype.fill=function(e,n,r){return H("fill")},t.prototype.onesLike=function(e){return H("onesLike")},t.prototype.zerosLike=function(e){return H("zerosLike")},t.prototype.linspace=function(e,n,r){return H("linspace")},t.prototype.dispose=function(){return H("dispose")},t}();function H(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ro(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,s=t[o]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(o)}return r}function Ht(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,s=e[o];(i==null||i===1&&s>1)&&n.unshift(o)}return n}function Fe(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var o=t[t.length-i-1];o==null&&(o=1);var s=e[e.length-i-1];if(s==null&&(s=1),o===1)n.unshift(s);else if(s===1)n.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(o)}}return n}function Fc(t,e,n,r,i,o,s){s===void 0&&(s="channelsLast");var a,u=zd(e),l=u[0],c=u[1];if(s==="channelsLast")a=[l,c,t[3],t[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);a=[l,c,t[1],t[1]]}return fa(t,a,n,r,i,o,!1,s)}function Ud(t,e,n,r,i,o,s){s===void 0&&(s="NDHWC");var a,u,l=Dy(e),c=l[0],h=l[1],f=l[2];if(s==="NDHWC")u="channelsLast",a=[c,h,f,t[4],t[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);u="channelsFirst",a=[c,h,f,t[1],t[1]]}return Wd(t,a,n,r,i,!1,u,o)}function fa(t,e,n,r,i,o,s,a){s===void 0&&(s=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(a==="channelsLast")l=t[0],c=t[1],h=t[2],f=t[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=t[0],f=t[1],c=t[2],h=t[3]}var d,m=e[0],v=e[1],y=e[3],g=zd(n),_=g[0],w=g[1],x=zd(r),S=x[0],A=x[1],T=lu(m,S),E=lu(v,A),C=function(j,W,q,X,V,z,U,Q){var te,ie,we;if(typeof j=="number"){te={top:j,bottom:j,left:j,right:j,type:j===0?"VALID":"NUMBER"};var _e=function(Ee,Le,Ve,st,at){st==null&&(st=MA(Ee,Le,Ve));var et=Ee[0],Wn=Ee[1],or=ec((et-Le+2*st)/Ve+1,at);O(Dt(or),function(){return"The output # of rows ("+or+") must be an integer. Change the stride and/or zero pad parameters"});var Ke=ec((Wn-Le+2*st)/Ve+1,at);return O(Dt(Ke),function(){return"The output # of columns ("+Ke+") must be an integer. Change the stride and/or zero pad parameters"}),[or,Ke]}([W,q],z,X,j,Q);ie=_e[0],we=_e[1]}else if(j==="same"){ie=Math.ceil(W/X),we=Math.ceil(q/V);var ce=Math.max(0,(ie-1)*X+z-W),be=Math.max(0,(we-1)*V+U-q),xe=Math.floor(ce/2),Se=ce-xe,qe=Math.floor(be/2);te={top:xe,bottom:Se,left:qe,right:be-qe,type:"SAME"}}else{if(j!=="valid")throw Error("Unknown padding parameter: "+j);te={top:0,bottom:0,left:0,right:0,type:"VALID"},ie=Math.ceil((W-z+1)/X),we=Math.ceil((q-U+1)/V)}return{padInfo:te,outHeight:ie,outWidth:we}}(i,c,h,_,w,T,E,o),I=C.padInfo,P=C.outHeight,N=C.outWidth,k=s?y*f:y;return a==="channelsFirst"?d=[l,k,P,N]:a==="channelsLast"&&(d=[l,P,N,k]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:h,inChannels:f,outHeight:P,outWidth:N,outChannels:k,padInfo:I,strideHeight:_,strideWidth:w,filterHeight:m,filterWidth:v,effectiveFilterHeight:T,effectiveFilterWidth:E,dilationHeight:S,dilationWidth:A,inShape:t,outShape:d,filterShape:e}}function Wd(t,e,n,r,i,o,s,a){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3],d=u[4];if(s==="channelsLast")l=t[0],c=t[1],h=t[2],f=t[3],d=t[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=t[0],d=t[1],c=t[2],h=t[3],f=t[4]}var m,v=e[0],y=e[1],g=e[2],_=e[4],w=Dy(n),x=w[0],S=w[1],A=w[2],T=Dy(r),E=T[0],C=T[1],I=T[2],P=lu(v,E),N=lu(y,C),k=lu(g,I),j=function(U,Q,te,ie,we,_e,ce,be,xe,Se,qe){var Ee,Le,Ve,st;if(typeof U=="number"){Ee={top:U,bottom:U,left:U,right:U,front:U,back:U,type:U===0?"VALID":"NUMBER"};var at=function(lo,Mn,_a,Ai,$n,Zu){$n==null&&($n=MA(lo,Mn,Ai));var Im=lo[0],Ih=lo[1],Rh=lo[2],ki=ec((Im-Mn+2*$n)/Ai+1,Zu);O(Dt(ki),function(){return"The output # of depths ("+ki+") must be an integer. Change the stride and/or zero pad parameters"});var fs=ec((Ih-Mn+2*$n)/Ai+1,Zu);O(Dt(fs),function(){return"The output # of rows ("+fs+") must be an integer. Change the stride and/or zero pad parameters"});var ds=ec((Rh-Mn+2*$n)/Ai+1,Zu);return O(Dt(ds),function(){return"The output # of columns ("+ds+") must be an integer. Change the stride and/or zero pad parameters"}),[ki,fs,ds,_a]}([Q,te,ie,1],be,1,we,U,qe);Le=at[0],Ve=at[1],st=at[2]}else if(U==="same"){Le=Math.ceil(Q/we),Ve=Math.ceil(te/_e),st=Math.ceil(ie/ce);var et=(Le-1)*we+be-Q,Wn=(Ve-1)*_e+xe-te,or=(st-1)*ce+Se-ie,Ke=Math.floor(et/2),Tt=et-Ke,zn=Math.floor(Wn/2),ni=Wn-zn,xr=Math.floor(or/2);Ee={top:zn,bottom:ni,left:xr,right:or-xr,front:Ke,back:Tt,type:"SAME"}}else{if(U!=="valid")throw Error("Unknown padding parameter: "+U);Ee={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Le=Math.ceil((Q-be+1)/we),Ve=Math.ceil((te-xe+1)/_e),st=Math.ceil((ie-Se+1)/ce)}return{padInfo:Ee,outDepth:Le,outHeight:Ve,outWidth:st}}(i,c,h,f,x,S,A,P,N,k,a),W=j.padInfo,q=j.outDepth,X=j.outHeight,V=j.outWidth,z=o?_*d:_;return s==="channelsFirst"?m=[l,z,q,X,V]:s==="channelsLast"&&(m=[l,q,X,V,z]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:h,inWidth:f,inChannels:d,outDepth:q,outHeight:X,outWidth:V,outChannels:z,padInfo:W,strideDepth:x,strideHeight:S,strideWidth:A,filterDepth:v,filterHeight:y,filterWidth:g,effectiveFilterDepth:P,effectiveFilterHeight:N,effectiveFilterWidth:k,dilationDepth:E,dilationHeight:C,dilationWidth:I,inShape:t,outShape:m,filterShape:e}}function MA(t,e,n,r){r===void 0&&(r=1);var i=lu(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function zd(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function Dy(t){return typeof t=="number"?[t,t,t]:t}function lu(t,e){return e<=1?t:t+(t-1)*(e-1)}function ec(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function Pu(t){var e=zd(t),n=e[0],r=e[1],i=e[2];return n===1&&r===1&&i===1}function ir(t,e){return Pu(t)||Pu(e)}function G1(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function FA(t,e,n){if(e==="complex64"){if(t.dtype==="complex64")return t.clone();var r=ct(t.shape),i=t.toFloat(),o=n.complex(i,r);return r.dispose(),i.dispose(),o}if(!FB(t.dtype,e))return B.makeTensorFromDataId(t.dataId,t.shape,e);if(t.dtype==="complex64"){var s=n.real(t);return o=s.cast(e),s.dispose(),o}if(e==="int32")return n.int(t);if(e==="bool"){var a=se(0,t.dtype);return o=n.notEqual(t,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function My(t,e){return B.makeTensorFromDataId(t.dataId,e,t.dtype)}function OA(t,e,n){var r=(e-t)/(n-1),i=sh(n,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Lt(i,"float32")}function Fy(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function ZE(t,e){return{real:t[2*e],imag:t[2*e+1]}}function l5(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function c5(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function h5(t,e,n){var r=function(o,s,a){return function(u,l,c){for(var h=0,f=u.length,d=0,m=!1;h<f;){var v=c(l,u[d=h+(f-h>>>1)]);v>0?h=d+1:(f=d,m=!v)}return m?h:-h-1}(o,s,a||f5)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function f5(t,e){return t>e?1:t<e?-1:0}function q1(t,e,n,r,i){return LA(t,e,n,r,i,0).selectedIndices}function K1(t,e,n,r,i,o){var s=LA(t,e,n,r,i,o);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function LA(t,e,n,r,i,o,s,a){a===void 0&&(a=!1);for(var u=Array.from(e).map(function(x,S){return{score:x,boxIndex:S,suppressBeginIndex:0}}).filter(function(x){return x.score>i}).sort(eC),l=o>0?-.5/o:0,c=[],h=[];c.length<n&&u.length>0;){var f=u.pop(),d=f.score,m=f.boxIndex,v=f.suppressBeginIndex;if(d<i)break;for(var y=!1,g=c.length-1;g>=v;--g){var _=d5(t,m,c[g]);if(_>=r){y=!0;break}if(f.score=f.score*p5(r,l,_),f.score<=i)break}f.suppressBeginIndex=c.length,y||(f.score===d?(c.push(m),h.push(f.score)):f.score>i&&h5(u,f,eC))}var w=c.length;return a&&(c.fill(0,w),h.fill(0,w)),{selectedIndices:Lt(c,"int32"),selectedScores:Lt(h,"float32"),numValidOutputs:se(w,"int32")}}function d5(t,e,n){var r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),d=(a-o)*(u-s),m=(h-l)*(f-c);if(d<=0||m<=0)return 0;var v=Math.max(o,l),y=Math.max(s,c),g=Math.min(a,h),_=Math.min(u,f),w=Math.max(g-v,0)*Math.max(_-y,0);return w/(d+m-w)}function p5(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function eC(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function VA(t,e,n){var r=new Array(t.rank).fill(0),i=t.shape.slice();return e.map(function(o){i[n]=o;var s=t.slice(r,i);return r[n]+=o,s})}function BA(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=Ae(n,t.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(t.rank),a=0;a<s.length;a++)s[a]=o[a]%t.shape[a];var u=t.locToIndex(s);i.values[r]=t.values[u]}return i.toTensor()}function jA(t,e,n,r,i){for(var o=e[e.length-1],s=[t.length/o,o],a=s[0],u=s[1],l=Nc(n,a*r),c=Nc("int32",a*r),h=0;h<a;h++){for(var f=h*u,d=t.subarray(f,f+u),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});m.sort(function(x,S){return S.value-x.value});var y=h*r,g=l.subarray(y,y+r),_=c.subarray(y,y+r);for(v=0;v<r;v++)g[v]=m[v].value,_[v]=m[v].index}var w=e.slice();return w[w.length-1]=r,[cn(l,w,n),cn(c,w,"int32")]}function X1(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var i=Ae(t,"int32"),o=Ae([n.length,t.length],"int32");for(r=0;r<n.length;r++){var s=i.indexToLoc(n[r]),a=r*t.length;o.values.set(s,a)}return o.toTensor()}var m5=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},g5=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},v5=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,s=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var a=e==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function UA(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(n){return t+"."+n})}function Xn(t,e){return e===1?[t]:UA(t,e)}function In(){var t,e,n,r,i,o,s,a,u,l;return J().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}function Fs(t,e,n){n===void 0&&(n="index");var r=wi(e);return r.map(function(i,o){return"int "+t[o]+" = "+n+" / "+i+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+i:"index -= "+t[o]+" * "+i)+";"}).join("")}function Y1(t){var e=wi(t).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var WA=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function y5(t,e,n,r){var i=[];t.forEach(function(d){var m=pe(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?i.push("uniform float "+d.name+(m>1?"["+m+"]":"")+";"):(i.push("uniform sampler2D "+d.name+";"),i.push("uniform int offset"+d.name+";"))});var o,s,a=i.join(`
`),u=t.map(function(d){return function(m,v,y){y===void 0&&(y=!1);var g="";g+=y?zA(m):ka(m);var _=m.shapeInfo.logicalShape,w=v.logicalShape;return _.length<=w.length&&(g+=y?function(x,S){var A,T=x.name,E=T.charAt(0).toUpperCase()+T.slice(1),C="get"+E+"AtOutCoords",I=x.shapeInfo.logicalShape.length,P=S.logicalShape.length,N=Ro(x.shapeInfo.logicalShape,S.logicalShape),k=it(P),j=P-I,W=["x","y","z","w","u","v"];A=I===0?"":P<2&&N.length>=1?"coords = 0;":N.map(function(te){return"coords."+W[te+j]+" = 0;"}).join(`
`);var q="";q=P<2&&I>0?"coords":x.shapeInfo.logicalShape.map(function(te,ie){return"coords."+W[ie+j]}).join(", ");var X="return outputValue;",V=pe(x.shapeInfo.logicalShape)===1,z=pe(S.logicalShape)===1;if(I!==1||V||z){if(V&&!z)X=P===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(N.length){var U=I-2,Q=I-1;N.indexOf(U)>-1&&N.indexOf(Q)>-1?X="return vec4(outputValue.x);":N.indexOf(U)>-1?X="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":N.indexOf(Q)>-1&&(X="return vec4(outputValue.xx, outputValue.zz);")}}else X=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+C+`() {
      `+k+` coords = getOutputCoords();
      `+A+`
      vec4 outputValue = get`+E+"("+q+`);
      `+X+`
    }
  `}(m,v):function(x,S){var A=x.name,T=A.charAt(0).toUpperCase()+A.slice(1),E="get"+T+"AtOutCoords",C=S.texShape,I=x.shapeInfo.texShape,P=x.shapeInfo.logicalShape.length,N=S.logicalShape.length;if(!x.shapeInfo.isUniform&&P===N&&x.shapeInfo.flatOffset==null&&rn(I,C))return`
      float `+E+`() {
        return sampleTexture(`+A+`, resultUV);
      }
    `;var k,j=it(N),W=Ro(x.shapeInfo.logicalShape,S.logicalShape),q=N-P,X=["x","y","z","w","u","v"];k=P===0?"":N<2&&W.length>=1?"coords = 0;":W.map(function(z){return"coords."+X[z+q]+" = 0;"}).join(`
`);var V="";return V=N<2&&P>0?"coords":x.shapeInfo.logicalShape.map(function(z,U){return"coords."+X[U+q]}).join(", "),`
    float `+E+`() {
      `+j+` coords = getOutputCoords();
      `+k+`
      return get`+T+"("+V+`);
    }
  `}(m,v)),g}(d,e,r)}).join(`
`),l=e.texShape,c=In(),h=function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+d.defineSpecialNaN+`
    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+_5+`
    `+w5+`
    `+x5+`
  `}(c);return e.isPacked?(o=function(d,m){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(x,S){var A=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];return A[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+A[1]+`.0);
      }
    `:A[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+A[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+A[0]+", "+A[1]+`));
      return 2 * (resTexRC.x * `+A[1]+` + resTexRC.y);
    }
  `}(0,m);case 2:return function(x,S){var A=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];if(rn(x,S))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+A[0]+", "+A[1]+`));
      }
    `;var T=Math.ceil(x[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+A[0]+", "+A[1]+`));

      int index = resTexRC.x * `+A[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `}(d,m);case 3:return v=d,y=m,g=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],_=Math.ceil(v[2]/2),w=_*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+w+`;
      index -= b * `+w+`;

      int r = 2 * (index / `+_+`);
      int c = imod(index, `+_+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(x,S){for(var A=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)],T=Math.ceil(x[x.length-1]/2),E=T*Math.ceil(x[x.length-2]/2),C=E,I="",P="b, r, c",N=2;N<x.length-1;N++)C*=x[x.length-N-1],I=`
      int b`+N+" = index / "+C+`;
      index -= b`+N+" * "+C+`;
    `+I,P="b"+N+", "+P;return`
    ivec`+x.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+A[0]+", "+A[1]+`));
      int index = resTexRC.x * `+A[1]+` + resTexRC.y;

      `+I+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+x.length+"("+P+`);
    }
  `}(d,m)}var v,y,g,_,w}(e.logicalShape,l),s=function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `}(c)):(o=function(d,m){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,_){return _[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return resTexRC.x * `+_[1]+` + resTexRC.y;
    }
  `}(0,m);case 2:return function(g,_){return rn(g,_)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(d,m);case 3:return v=m,y=Fs(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,_){var w=Fs(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      `+w+`
      return ivec4(r, c, d, d2);
    }
  `}(d,m);case 5:return function(g,_){var w=Fs(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+_[0]+`,
                             `+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+w+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(d,m);case 6:return function(g,_){var w=Fs(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+w+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(d,m);default:throw new Error(d.length+"-D output sampling is not yet supported")}var v,y}(e.logicalShape,l),s=function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=b5),[f,h,s,a,o,u,n].join(`
`)}function ka(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(n){var r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=n.shapeInfo.texShape,s=o[0],a=o[1];if(s===1&&a===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,l=u[0],c=u[1],h=ws(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 1:return function(n){var r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Ca(n)+`
      }
    `;var o=n.shapeInfo.texShape,s=o[0],a=o[1];if(a===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=ws(r);return a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+a+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 2:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n.shapeInfo.texShape;if(s!=null&&rn(r,s)){var a=s[0],u=s[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+a+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=ks(r),c=l.newShape,h=l.keptDims,f=c;if(f.length<r.length){var d=Pa(n,f);return`
      `+ka(d)+`
      float `+o+`(int row, int col) {
        return `+o+"("+Na(["row","col"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Ca(n)+`
      }
    `;var m=s[0],v=s[1],y=ws(i);return v===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+m+", "+v+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(t);case 3:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=ks(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var f=Pa(n,h);return`
        `+ka(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+Na(["row","col","depth"],c)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+a+`, 1)));
        `+Ca(n)+`
      }
    `;var d=n.shapeInfo.texShape,m=d[0],v=d[1],y=n.shapeInfo.flatOffset;if(v===s&&y==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+m+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(v===a&&y==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var g=ws(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+a+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+m+", "+v+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(t);case 4:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,l=ks(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var f=Pa(n,c);return`
      `+ka(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+Na(["row","col","depth","depth2"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+a+", "+s+`, 1)));
        `+Ca(n)+`
      }
    `;var d=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,v=m[0],y=m[1];if(y===u&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===s&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var g=ws(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+a+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+y+", index + "+g+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);case 5:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,l=r[1]*u,c=ks(r),h=c.newShape,f=c.keptDims;if(h.length<r.length){var d=Pa(n,h);return`
      `+ka(d)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+Na(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+a+", "+s+`)) +
          depth3;
        `+Ca(n)+`
      }
    `;var m=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,y=v[0],g=v[1];if(g===l&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===s&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=ws(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+a+` +
          depth2 * `+s+" + depth3 + "+_+`;
      vec2 uv = uvFromFlat(`+y+", "+g+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);case 6:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=ks(r),a=s.newShape,u=s.keptDims;if(a.length<r.length){var l=Pa(n,a);return`
      `+ka(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+Na(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,f=r[3]*h,d=r[2]*f,m=r[1]*d;if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+d+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Ca(n)+`
      }
    `;var v=n.shapeInfo.flatOffset,y=n.shapeInfo.texShape,g=y[0],_=y[1];if(_===m&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(_===c&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var w=ws(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+d+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+w+`;
      vec2 uv = uvFromFlat(`+g+", "+_+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function zA(t){var e,n,r;switch(t.shapeInfo.logicalShape.length){case 0:return e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=In(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=In();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(t);case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=In();if(u!=null&&rn(o,u))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+s+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=Math.ceil(o[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+s+`, uv);
    }
  `}(t);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=Pa(i,c);return`
        `+zA(h)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Na(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],d=l[1],m=Math.ceil(o[2]/2),v=m*Math.ceil(o[1]/2),y=In();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+d+", "+v+", "+m+`, b, row, col);
      return `+y.texture2D+"("+s+`, uv);
    }
  `}(t);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],d=Math.ceil(o[s-1]/2),m=d*Math.ceil(o[s-2]/2),v="int b, int row, int col",y="b * "+m+" + (row / 2) * "+d+" + (col / 2)",g=2;g<s-1;g++)v="int b"+g+", "+v,m*=o[s-g-1],y="b"+g+" * "+m+" + "+y;var _=In();return`
    vec4 `+u+"("+v+`) {
      int index = `+y+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+_.texture2D+"("+a+`, uv);
    }
  `}(t)}}var _5=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,w5=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,x5=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,b5=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ws(t){return"offset"+t}function Ca(t){var e=t.name,n=pe(t.shapeInfo.logicalShape);return n<2?"return "+e+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function it(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Pa(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Na(t,e){return e.map(function(n){return t[n]}).join(", ")}var E5=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,l=u.length,c=it(l),h=Xn("coords",l);if(o===1){var f=it(a=l+1);s=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else a=l,s=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,a),m="."+d[a-1],v=d.map(function(E){return"int "+E}),y=Xn("sourceLocR",a-1).concat("inIdx.r"),g=Xn("sourceLocG",a-1).concat("inIdx.g"),_=Xn("sourceLocB",a-1).concat("inIdx.b"),w=Xn("sourceLocA",a-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+_.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",A=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+_.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+m+", sourceLocG"+m+`,
          sourceLocB`+m+", sourceLocA"+m+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+A+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+S+`
          vec4 candidate = `+A+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+x+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},C5=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=a-1-t.padInfo.top,c=u-1-t.padInfo.left,h=1/(e*n);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},S5=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=c-1-t.padInfo.front,m=h-1-t.padInfo.top,v=f-1-t.padInfo.left,y=1/(e*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+m+", "+v+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},T5=function(t,e,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Fe(t,e),Fe(t,n);var s="0.0";r!=null&&(Fe(t,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";i!=null&&(Fe(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},I5=function(t,e,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Fe(t,e),Fe(t,n);var s="vec4(0.0)";r!=null&&(Fe(t,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";i!=null&&(Fe(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},R5="return areal * breal - aimag * bimag;",A5="return areal * bimag + aimag * breal;",tC=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Fe(e,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+t+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Lg="return a + b;",Vg="return a - b;",nC="return a * b;",$A="return (a < 0.) ? b * a : a;",Rt=function(t,e,n){this.variableNames=["A","B"],this.outputShape=Fe(e,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+t+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},HA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ni=function(t,e,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Fe(e,n);var i=this.outputShape.length,o="";if(r)if(i===0||pe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+it(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=Xn("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+t+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},k5=function(){function t(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return t.prototype.getCustomSetupFunc=function(e,n){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,n)}},t}(),P5=function(){function t(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return t.prototype.getCustomSetupFunc=function(e,n){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,n)}},t}(),N5=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},D5=function(t){this.outputShape=[],this.outputShape=ku(t,1),this.variableNames=t.map(function(a,u){return"T"+u});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var i=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var o=e.length,s=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},M5=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ku(t,e);var n=this.outputShape,r=n.length,i=it(r),o=Xn("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(y,g){return"T"+g});var a=new Array(t.length-1);a[0]=t[0][e];for(var u=1;u<a.length;u++)a[u]=a[u-1]+t[u][e];var l=s[e],c=s.slice(-2),h=s.join(),f="if ("+l+" < "+a[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<a.length;u++){var d=a[u-1];f+=`
        if (`+l+" < "+a[u]+"  && "+l+" >= "+a[u-1]+`) {
          return getChannel(
            getT`+u+"("+ff(s,l,d)+`),
            vec2(`+ff(c,l,d)+`));
        }`}var m=a.length,v=a[a.length-1];f+=`
        return getChannel(
          getT`+m+"("+ff(s,l,v)+`),
          vec2(`+ff(c,l,v)+"));",this.userCode=`
      float getValue(`+s.map(function(y){return"int "+y})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+n[r-2]+` &&
            `+o[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function ff(t,e,n){var r=t.indexOf(e);return t.map(function(i,o){return o===r?i+" - "+n:i}).join()}var F5=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},O5=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dataFormat==="channelsLast",s=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},L5=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yF = 0; yF < `+t.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+t.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+t.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+o+`;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+t.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},V5=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=e-1-t.padInfo.front,u=n-1-t.padInfo.top,l=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+t.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},B5=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},j5=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,s=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},rC=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,s=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterHeight,h=t.filterWidth,f=4*Math.floor(t.inChannels/4),d=t.inChannels%4,m=t.dataFormat==="channelsLast",v=m?1:2,y=m?2:3,g=m?3:1,_="",w="";n&&(_=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,w="result = activation(result);");var x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+_+`

      const ivec2 strides = ivec2(`+s+", "+a+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+t.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+m+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(d===1)+`) {

              if (`+m+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(d===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+m+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(d===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+m+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+x+`
        `+w+`
        setOutput(result);
      }
    `},U5=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,h=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(m===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(m===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(m===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},iC=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,m=t.outChannels/t.inChannels,v="",y="";n&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,y="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+m+`;
        int q = d2 - d1 * `+m+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+y+`
        setOutput(result);
      }
    `},oC=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,m=d,v="int xR; int xC; int xCOffset;",y=0;y<f;y++)for(var g=0;g<d;g++)v+=`
          vec4 xTexelR`+y+"C"+2*g+` = vec4(0.);
          vec4 wR`+y+"C"+g+` = vec4(0.);
          vec4 xR`+y+"C"+g+" = vec4(0.);";for(y=0;y<f;y++)for(var _=0;_<m;_++){if(v+=`
          xR = xRCorner + `+y*c+`;
          xC = xCCorner + `+(g=2*_)*h+`;
        `,l===1){if(g<d&&(v+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+y+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+g+" = vec4(previous.zw, xTexelR"+y+"C"+g+`.xy);
                } else {
                  xR`+y+"C"+g+" = vec4(0, 0, xTexelR"+y+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                xR`+y+"C"+g+" = xTexelR"+y+"C"+g+`;
              `,g+1<d)){var w=a%2==0?lA(h):h;h%2==0&&a%2==1||h%2!=0&&a%2!=1?(v+=`
                  xCOffset = xC + `+a%2+" + "+w+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+y+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+g+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+y+"C"+(g+1)+` = vec4(
                    xTexelR`+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+w+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(g+1)+" = xTexelR"+y+"C"+(g+2)+`;
                `}}else g<d&&(v+=`
              if(xR >= 0 && xR < `+i+`) {
            `,a%2==1?(v+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(g+2)+` = vec4(0.);
                }

                xR`+y+"C"+g+` = vec4(
                  xTexelR`+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+`.zw);
              `,g+1<d&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(g+1)+" = vec4(xTexelR"+y+"C"+(g+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(g+2)+` = vec4(0.);
                }

                xR`+y+"C"+g+` = vec4(
                  xTexelR`+y+"C"+g+".xy, xTexelR"+y+"C"+(g+2)+`.xy);
              `,g+1<d&&(v+=`
                  xR`+y+"C"+(g+1)+` = vec4(
                    xTexelR`+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+`.zw);
                `)),v+="}");g<d&&(v+=`
            vec4 wTexelR`+y+"C"+g+" = getW("+y+", "+g+`, d1, q);
            wR`+y+"C"+g+" = vec4(wTexelR"+y+"C"+g+".xz, wTexelR"+y+"C"+g+`.xz);
          `,g+1<d&&(v+=`
              vec4 wTexelR`+y+"C"+(g+1)+" = getW("+y+", "+(g+1)+`, d1, q);
              wR`+y+"C"+(g+1)+` =
                vec4(wTexelR`+y+"C"+(g+1)+".xz, wTexelR"+y+"C"+(g+1)+".xz);"))}for(y=0;y<f;y++)for(g=0;g<d;g++)v+="dotProd += xR"+y+"C"+g+" * wR"+y+"C"+g+";";var x="",S="";n&&(x=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,S="result = activation(result);");var A=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+A+`
        `+S+`
        setOutput(result);
      }
    `},W5=function(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],s=t[1],a=t[2],u=t[3],l=e[0],c=n[0],h=n[1];this.outputShape=[l,c,h,u];var f=r==="bilinear"?1:0,d=[s-1+".0",a-1+".0"],m=d[0],v=d[1],y=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*"+m+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+m],g=y[0],_=y[1],w=y[2],x=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],S=x[0],A=x[1],T=x[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+S+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+_+`;
        float width_scale = `+A+`;

        float in_y = `+w+`;
        if( in_y < 0.0 || in_y > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},z5=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+it(r)+` coords = getOutputCoords();
        int end = `+sC(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+sC(r,"coords")+` = idx;
          val += getX(`+function(s,a){if(s===1)return""+a;if(s===2)return a+".x, "+a+".y";if(s===3)return a+".x, "+a+".y, "+a+".z";if(s===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function sC(t,e){if(t===1)return""+e;if(t===2)return e+".y";if(t===3)return e+".z";if(t===4)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var $5=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Mc.DENSE;var e=Zl(t),n=In();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Fs(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},H5=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Mc.DENSE;var e=Zl(t),n=In();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Fs(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},G5=function(){function t(e,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return t.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),q5=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},K5=function(t){this.variableNames=["A"],this.outTexUsage=hr.DOWNLOAD;var e=In();this.outputShape=t,this.userCode=`
      `+WA+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},X5=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=hr.DOWNLOAD;var e=In();this.outputShape=t,this.userCode=`
      `+WA+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},Y5=function(t,e,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=In(),i=e[0],o=e[1];this.outputShape=t;var s="result";n&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+Y1(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},Q5=function(t,e,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=In(),i=e[0],o=e[1];this.outputShape=t;var s="",a="result";n&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;s+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+t[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+t[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Y1(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+r.output+" = "+a+`;
      }
    `},J5="return real * expR - imag * expI;",Z5="return real * expI + imag * expR;",aC=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+t+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},ej=function(){function t(e,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;return function(r,i){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(n.valueLoc,e)}},t}(),tj=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var i=it(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<s.length;h++)h===a?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(t,n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},nj=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=it(e.length),i=it(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function rj(t,e){var n=In();return JB(t,e,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function ij(t,e){return r6(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function oj(t,e){return i6(t,e,new Uint16Array([0,1,2,2,1,3]))}function uh(t,e,n,r,i,o,s){s6(n,r);var a=o6(t,e),u=t.TEXTURE_2D;return ge(t,e,function(){return t.bindTexture(u,a)}),ge(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),ge(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),ge(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),ge(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),ge(t,e,function(){return t.texImage2D(u,0,i,n,r,0,o,s,null)}),ge(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function sj(t,e,n,r,i){var o=Gp(n,r);return uh(t,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,t.FLOAT)}function aj(t,e,n,r,i){var o=Gp(n,r);return uh(t,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function uj(t,e,n,r,i){var o=Gp(n,r);return uh(t,e,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function lj(t,e,n,r,i){var o=ah(n,r);return uh(t,e,o[0],o[1],i.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function cj(t,e,n,r,i){var o=ah(n,r);return uh(t,e,o[0],o[1],i.internalFormatPackedHalfFloat,t.RGBA,i.textureTypeHalfFloat)}function hj(t,e,n,r){return ge(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),KE(t,e,n,"clipSpacePos",r,3,20,0)&&KE(t,e,n,"uv",r,2,20,12)}function fj(t,e,n,r,i,o,s){var a,u,l;ge(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=t.UNSIGNED_BYTE,l=t.RGBA):(a=new Float32Array(r*i*4),u=t.FLOAT,l=s.internalFormatPackedFloat),a.set(o),ge(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,l,r,i,0,t.RGBA,u,a)}),ge(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function dj(t,e,n,r){ge(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?ge(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):ge(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),ge(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function pj(t,e,n,r,i){var o=t.createBuffer();ge(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,o)});var s=16*n*r;return ge(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ)}),ge(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),ge(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),o}function mj(t,e,n){var r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function gj(t,e,n,r,i){var o=Gp(n,r),s=o[0],a=o[1],u=new Uint8Array(n*r*4);return ge(t,e,function(){return t.readPixels(0,0,s,a,i.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function vj(t,e,n,r,i,o,s,a){var u=t,l=new Float32Array(function(c,h){var f=ah(c,h);return f[0]*f[1]*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function yj(t,e,n,r){var i=new Float32Array(n*r*4);return ge(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i)}),i}var _j=function(){function t(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=J().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,qB(n,e)):this.gl=Si(n);var r="WEBGL_color_buffer_float";if(J().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=uf(this.gl,this.debug,"OES_texture_float"),Ar(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=uf(this.gl,this.debug,"OES_texture_half_float");else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ar(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=uf(this.gl,this.debug,"EXT_color_buffer_half_float");else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ar(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Ar(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=ij(this.gl,this.debug),this.indexBuffer=oj(this.gl,this.debug),this.framebuffer=a6(this.gl,this.debug),this.textureConfig=j1(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return J().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;ge(n,this.debug,function(){return n.finish()}),ge(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),ge(n,this.debug,function(){return n.deleteFramebuffer(e.framebuffer)}),ge(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),ge(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),ge(n,this.debug,function(){return n.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(e,n){return this.throwIfDisposed(),sj(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(e,n){return this.throwIfDisposed(),aj(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(e,n){return this.throwIfDisposed(),uj(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(e,n){this.throwIfDisposed(),dj(this.gl,this.debug,e,n)},t.prototype.uploadDenseMatrixToTexture=function(e,n,r,i){this.throwIfDisposed(),fj(this.gl,this.debug,e,n,r,i,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(e,n){return this.throwIfDisposed(),cj(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(e,n){return this.throwIfDisposed(),lj(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.deleteMatrixTexture=function(e){var n=this;this.throwIfDisposed(),this.outputTexture===e&&(XE(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ge(this.gl,this.debug,function(){return n.gl.deleteTexture(e)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,n,r){var i=this;return this.downloadMatrixDriver(e,function(){return gj(i.gl,i.debug,n,r,i.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(e,n,r,i,o,s){return vj(this.gl,e,0,0,0,o,s,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(e,n){return mj(this.gl,e,n)},t.prototype.createBufferFromTexture=function(e,n,r){this.bindTextureToFrameBuffer(e);var i=pj(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},t.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},t.prototype.createFence=function(e){var n,r,i=this;if(J().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},n=s}else J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(n,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(e,n,r){var i=this;return this.downloadMatrixDriver(e,function(){return yj(i.gl,i.debug,n,r)})},t.prototype.createProgram=function(e){this.throwIfDisposed();var n=this.gl,r=ZB(n,this.debug,e),i=rj(n,this.debug),o=t6(n,this.debug);return ge(n,this.debug,function(){return n.attachShader(o,i)}),ge(n,this.debug,function(){return n.attachShader(o,r)}),n6(n,this.debug,o),this.debug&&Dg(n,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=hj(n,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(e){var n=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&ge(this.gl,this.debug,function(){return n.gl.deleteProgram(e)})},t.prototype.setProgram=function(e){var n=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Dg(this.gl,this.debug,this.program),ge(this.gl,this.debug,function(){return n.gl.useProgram(e)})},t.prototype.getUniformLocation=function(e,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?l6(this.gl,this.debug,e,n):c6(this.gl,e,n)},t.prototype.getAttributeLocation=function(e,n){var r=this;return this.throwIfDisposed(),ge(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,n)})},t.prototype.getUniformLocationNoThrow=function(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)},t.prototype.setInputMatrixTexture=function(e,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),h6(this.gl,this.debug,this.program,e,n,r)},t.prototype.setOutputMatrixTexture=function(e,n,r){this.setOutputMatrixTextureDriver(e,r,n)},t.prototype.setOutputPackedMatrixTexture=function(e,n,r){this.throwIfDisposed();var i=ah(n,r),o=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,o,s)},t.prototype.setOutputMatrixWriteRegion=function(e,n,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,n)},t.prototype.setOutputPackedMatrixWriteRegion=function(e,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){this.program!=null&&Dg(this.gl,this.debug,this.program),lf(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),ge(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),ge(this.gl,this.debug,function(){return e.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=uf(this.gl,this.debug,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(n.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(e){return he(this,void 0,void 0,function(){var n=this;return fe(this,function(r){switch(r.label){case 0:return[4,WE(function(){return n.disposed||n.isQueryAvailable(e,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(e,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(e,n){if(n===0)return!0;if(n===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(e){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=e;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},t.prototype.addItemToPoll=function(e,n){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1||WE(function(){return r.pollItems(),r.itemsToPoll.length===0})},t.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Mg(this.gl,this.debug,e,this.framebuffer),this.debug&&lf(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Mg(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&lf(this.gl)):XE(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(e,n){this.bindTextureToFrameBuffer(e);var r=n();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(e,n,r){this.throwIfDisposed();var i=this.gl;Mg(i,this.debug,e,this.framebuffer),this.debug&&lf(i),this.outputTexture=e,ge(i,this.debug,function(){return i.viewport(0,0,n,r)}),ge(i,this.debug,function(){return i.scissor(0,0,n,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(e,n,r,i){var o=this;this.throwIfDisposed(),ge(this.gl,this.debug,function(){return o.gl.scissor(e,n,r,i)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},t}();function uC(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(n,r){var i=n.logicalShape,o=e[r],s=o.shape;if(!rn(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!n.isUniform||!o.isUniform){var a=n.texShape,u=o.isUniform?null:o.texData.texShape;if(!rn(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var wj=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,i=n.inChannels,o=n.strideWidth,s=n.strideHeight,a=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,h=n.dataFormat,f=a.left,d=a.top,m=i*r,v=In(),y=h==="channelsLast",g=y?0:1,_=y?1:2,w="",x=0;x<=1;x++)for(var S=0;S<=1;S++)w+=`
          blockIndex = rc.y + `+S+`;
          pos = rc.x + `+x+`;

          if(blockIndex < `+t[1]+" && pos < "+t[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+s+" - "+d+`;
            d0 = offsetY + `+c+" * (pos / "+m+`);

            if(d0 < `+e[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+m+".) / "+i+`.));

              if(d1 < `+e[_]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*x+S)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*x+S)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+w+`

        `+v.output+` = result;
      }
    `},xj=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,s=e,a=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},bj=function(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Ej=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=e,a=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},Cj=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,a=o-1-t.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},Sj=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=a-1-t.padInfo.front,h=u-1-t.padInfo.top,f=l-1-t.padInfo.left,d=a*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Bg=function(t,e,n,r,i,o,s){n===void 0&&(n=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=n?t[1]:t[2],u=Math.ceil(a/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",m="";o&&(d=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,m="result = activation(result);");var v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+d+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+m+`

        setOutput(result);
      }
    `},Tj=function(){function t(e,n,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;return function(r,i){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(n.seedLoc,e)}},t}(),Ij=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},Rj=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=Xn("rc",e),r=it(e),i=function(a,u,l){if(a===1)return"rc > "+u[0];for(var c="",h=a-2;h<a;h++)c+=l[h]+" >= "+u[h],h<a-1&&(c+="||");return c}(e,t,n),o=function(a,u,l,c){if(a===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,t[t.length-1],t[t.length-2],n),s=function(a,u){var l=a.length,c=function(h,f){for(var d=[],m=0;m<=1;m++)for(var v=0;v<=1;v++){for(var y=(m===0?"r":"rp1")+", "+(v===0?"c":"cp1"),g=2;g<h;g++)y=f[f.length-1-g]+","+y;d.push(y)}return d}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(t,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},Aj=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+t[l]+u[1]});var r=t.length,i=it(r),o=e.map(function(u){return u[0]}).join(","),s=e.map(function(u,l){return u[0]+t[l]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},kj=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(y,g){return y[0]+t[g]+y[1]});for(var r=t.length,i=it(r),o=e.map(function(y){return y[0]}).join(","),s=e.map(function(y,g){return y[0]+t[g]}).join(","),a=Xn("rc",r),u=Xn("source",r),l=a[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=r===1?2:4;m<v;m++)d+=`
        `+h[m]+`
        if (`+f+`) {
          result[`+m+"] = float("+n+`);
        } else {
          `+i+` source = rc - start;
          result[`+m+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;d+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `},jg=function(t,e,n){if(this.variableNames=["x"],e==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var f=e==="avg",d="0.0";if(f||(d="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var m=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(m="avgValue / count");var v=4*Math.floor(r/4),y=r%4,g=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+d+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+d+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+m+`);
      }
    `}},Ug=function(t,e,n){if(this.variableNames=["x"],e==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,m=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;var y=e==="avg",g="0.0";if(y||(g="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+s+`);
        const ivec3 pads = ivec3(`+d+", "+m+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+t.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(_="avgValue / count");var w=4*Math.floor(r/4),x=r%4,S=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+d+", "+m+", "+v+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+w+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+S+`
            }

            int xC = xCCorner + `+w+`;
            if (`+(x===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+S+`
            } else if (`+(x===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+S+`
            } else if (`+(x===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+S+`
            }
          }
          setOutput(`+_+`);
        }
      }
    `}},Pj=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var s="0.0",a="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",a="min"):e==="max"&&(s="-1.0 / 1e-20",a="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},Nj=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Fs(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Y1(t)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+t[1]+`;
        int cols = `+t[2]+`;

        `+n+`

        setOutput(result);
      }
    `},Dj=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=t.shape,a=s[1],u=s[2],l=[n&&a>1?i-1:i,n&&u>1?o-1:o],c=[n&&a>1?a-1:a,n&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,m=1/f,v=2*Math.ceil(d)+2,y=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Mj=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=[r&&e>1?o-1:o,r&&n>1?s-1:s],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},Fj=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=[r&&e>1?o-1:o,r&&n>1?s-1:s],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},Oj=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=t.shape,a=s[1],u=s[2],l=[n&&a>1?i-1:i,n&&u>1?o-1:o],c=[n&&a>1?a-1:a,n&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,m=1/f,v=2*Math.ceil(d)+2,y=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Lj=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=[r&&e>1?o-1:o,r&&n>1?s-1:s],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},Vj=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,n!==1){var r=t.map(function(o,s){return function(a){return e.indexOf(a)!==-1&&t[a]!==1?t[a]+" - coords["+a+"] - 1":"coords["+a+"]"}(s)}).join(","),i=it(n);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+t[0]+` - coord - 1));
        }
      `},Bj=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=Xn("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],o=r[n-2]+" + 1 < "+this.outputShape[n-2],s=it(n);function a(u){var l=t.map(function(c,h){return function(f,d){return e.indexOf(f)!==-1&&t[f]!==1?t[f]+" - "+d[f]+" - 1":""+d[f]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+t[0]+` - rc - 1),
            `+t[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+t[0]+` - (rc  + 1) - 1),
                `+t[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return a(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",a(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",a(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",a(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},lC=function(t,e,n,r,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=it(i.length),u=it(o.length),l="";n===1?l="i":n===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",d=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+t+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},jj=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/n);this.outputShape=[r,s];var a=4*Math.floor(n/4),u=n%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%n>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},Uj=function(t,e,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<e.length;u++)a.push(""+o[u]),u<t&&s.push(""+o[u]);r=s.join(),i=a.join()}var l=it(n);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},Wj=function(){function t(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var n,r=it(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(s===1)return"sourceLoc";if(s<=6)return Wg.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(s,a){return"sourceLoc."+Wg[a]+" = start["+a+"] + coords."+Wg[a]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+n+`
        setOutput(getSource(`+o+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(i,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,e)}},t}(),Wg=["x","y","z","w","u","v"],zj=function(){function t(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var n=it(this.rank),r=Xn("coords",this.rank),i=Xn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+n+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+a+`
        `+u+`
        setOutput(result);
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(i,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,e)}},t}(),$j=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=it(n.length),o=it(n.length),s="";if(r===1)s="coords * strides + begin";else{var a=0;s=n.map(function(u,l){return a++,n.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(a-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+t+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},Hj=function(){function t(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(e,n,r){var i,o=cC(n,r),s=hC(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===lr.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===lr.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===lr.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===lr.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===lr.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},t.prototype.releaseTexture=function(e,n,r,i){if(this.freeTextures!=null){var o=hC(n,cC(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function cC(t,e){if(t===hr.UPLOAD)return lr.PACKED_2X2_FLOAT32;if(t===hr.RENDER||t==null)return function(n){return J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?lr.PACKED_2X2_FLOAT32:lr.UNPACKED_FLOAT32:n?lr.PACKED_2X2_FLOAT16:lr.UNPACKED_FLOAT16}(e);if(t===hr.DOWNLOAD||t===hr.PIXELS)return lr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function hC(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var Gj=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var i=it(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<s.length;c++)l.push("imod("+u[c]+", "+s[c]+")");return l.join()}(t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},qj=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var i=it(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(a),c=0;c<s.length;c++)l[s[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},Kj=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=it(this.rank),o=UA("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+s.join()+"), "+a+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Q1=1.7580993408473768,J1=1.0507009873554805,ke=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},ti="if (isnan(x)) return x;",Xj="return x;",fC="return abs(x);",GA=ti+`
  return (x < 0.0) ? 0.0 : x;
`,qA=ti+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,KA="return (x >= 0.0) ? x : (exp(x) - 1.0);",Yj=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Q1+`;
  float scale = `+J1+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,dC="return -x;",pC="return ceil(x);",mC="return floor(x);",gC="return exp(x);",vC="return exp(x) - 1.0;",Qj=ti+`
  return sin(x);
`,Jj=ti+`
  return cos(x);
`,Zj=ti+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,eU=ti+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,tU=ti+`
  return atan(x);
`,nU=ti+"return log(x + sqrt(x * x + 1.0));",rU=ti+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,iU=ti+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,df="return x;",oU="return x;",XA=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,YA=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,QA=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Il=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},sU=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=Xn("rc",e),r=it(e),i=function(a,u){if(a===1)return"rc";for(var l="",c=0;c<a;c++)l+=u[c],c<a-1&&(l+=",");return l}(e,n),o=n.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},pf={};function mf(t,e){if(e===void 0&&(e=!1),t==="linear")return e?oU:Xj;if(t==="relu")return e?XA:GA;if(t==="elu")return e?QA:KA;if(t==="relu6")return e?YA:qA;if(t==="prelu")return e?HA:$A;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var aU=600,uU=function(t){function e(n){var r,i=t.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!J().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var o=Si(J().getNumber("WEBGL_VERSION"));i.binaryCache=((r=J().getNumber("WEBGL_VERSION"))in pf||(pf[r]={}),pf[r]),i.gpgpu=new _j(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=n,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=n.gl.canvas;return i.textureManager=new Hj(i.gpgpu),i.numMBBeforeWarning=J().global.screen==null?1024:J().global.screen.height*J().global.screen.width*window.devicePixelRatio*aU/1024/1024,i.texData=new NA(i,B),i}return ei(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(n,r,i){if(J().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:n,usage:hr.UPLOAD}),o},e.prototype.move=function(n,r,i,o){if(J().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:i,dtype:o,values:r,usage:hr.UPLOAD})},e.prototype.readSync=function(n){var r=this.texData.get(n),i=r.values,o=r.dtype,s=r.complexTensors,a=r.slice,u=r.shape,l=r.isPacked;if(a!=null){var c=void 0;c=l?new Il(u,df):new ke(u,df);var h=this.runWebGLProgram(c,[{dataId:n,shape:u,dtype:o}],o),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(n);if(o==="string")return i;var d,m,v=this.activeTimers!=null;return v&&(d=ci()),o==="complex64"?m=Fy(s.real.dataSync(),s.imag.dataSync()):m=this.getValuesFromTexture(n),v&&(this.downloadWaitMs+=ci()-d),this.convertAndCacheOnCPU(n,m)},e.prototype.read=function(n){return he(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h,f,d,m,v,y,g,_,w,x,S,A,T,E;return fe(this,function(C){switch(C.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(I){return r.push(I)})];if(i=this.texData.get(n),o=i.values,s=i.shape,a=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,a!=null)return h=void 0,h=c?new Il(s,df):new ke(s,df),f=this.runWebGLProgram(h,[{dataId:n,shape:s,dtype:u}],u),d=this.read(f.dataId),this.disposeData(f.dataId),[2,d];if(o!=null)return[2,this.convertAndCacheOnCPU(n)];if(!J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&J().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,u!=="complex64"&&J().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(n),y=this.texData.get(v.dataId),m=(E=this.gpgpu).createBufferFromTexture.apply(E,[y.texture].concat(Zl(s)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return _=C.sent(),w=_[0],x=_[1],g=Fy(w,x),[3,5];case 4:m==null?g=this.getValuesFromTexture(n):(S=pe(s),g=this.gpgpu.downloadFloat32MatrixFromBuffer(m,S)),C.label=5;case 5:return v!=null&&this.disposeData(v.dataId),A=this.convertAndCacheOnCPU(n,g),T=this.pendingRead.get(n),this.pendingRead.delete(n),T.forEach(function(I){return I(A)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,A]}})})},e.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var i=n[r];if(!YB(i))throw J().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(n){var r,i=this.texData.get(n),o=i.shape,s=i.dtype,a=i.isPacked,u=pe(o);if(J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(n),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Zl(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=J().getBool("WEBGL_PACK")&&a===!0,d=f?Fg(o):o,m=f?new X5(d):new K5(d),v=this.runWebGLProgram(m,[{shape:d,dtype:s,dataId:n}],"float32"),y=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),g},e.prototype.time=function(n){return he(this,void 0,void 0,function(){var r,i,o,s,a,u,l;return fe(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,n(),s=Ru(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),a=Ru(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=c.sent(),u.kernelMs=kB(l),u.getExtraProfileInfo=function(){return l.map(function(h,f){return{name:a[f],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ci(),endMs:null}},e.prototype.endTimer=function(n){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=ci(),n)},e.prototype.getQueryTime=function(n){return he(this,void 0,void 0,function(){var r;return fe(this,function(i){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},e.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},e.prototype.releaseGPUData=function(n){var r=this.texData.get(n),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||n,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,u)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},e.prototype.getDataInfo=function(n){return this.texData.get(n)},e.prototype.getCPUBackend=function(){return J().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=B.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(n,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(n,r){var i=this.makeOutput(n.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:B.keep(n.clone()),imag:B.keep(r.clone())},i},e.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},e.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},e.prototype.slice=function(n,r,i){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,i);if(pe(i)===0)return cn([],i,n.dtype);var o=this.texData.get(n.dataId).isPacked,s=kA(n.shape,r,i);if(o||!s){var a=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zj(i):new Wj(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,i)},e.prototype.shallowSlice=function(n,r,i){var o=this.texData.get(n.dataId),s=this.makeOutput(i,n.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=n.dtype;var u=PA(r,n.strides);o.slice&&(u+=o.slice.flatOffset),a.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||n.dataId};var l=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,l+1),s},e.prototype.stridedSlice=function(n,r,i,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,i,o);var s=H1(r,i,o);if(s.some(function(u){return u===0}))return cn([],s);var a=new $j(r,o,s);return this.compileAndRun(a,[n])},e.prototype.reverse=function(n,r){var i=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Bj(n.shape,r):new Vj(n.shape,r);return this.compileAndRun(i,[n])},e.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var i=n.map(function(d){return Ir(d)}),o=n.map(function(d){return di(d)});return an(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>J().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(n.length/2),a=this.concat(n.slice(0,s),r),u=this.concat(n.slice(s),r);return this.concat([a,u],r)}if(J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var l=new M5(n.map(function(d){return d.shape}),r);return this.compileAndRun(l,n)}var c=ku(n.map(function(d){return d.shape}),r),h=n.map(function(d){return d.as2D(-1,pe(d.shape.slice(r)))}),f=new D5(h.map(function(d){return d.shape}));return this.compileAndRun(f,h).reshape(c)},e.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,dC,n.dtype);var r=new ke(n.shape,dC);return this.compileAndRun(r,[n])},e.prototype.batchMatMul=function(n,r,i,o){var s=i?n.shape[2]:n.shape[1],a=o?r.shape[1]:r.shape[2],u=i?n.shape[1]:n.shape[2],l=n.shape[0];if((s===1||a===1)&&u>1e3){i&&(n=n.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var c=a===1?n:n.as3D(l,u,1),h=a===1?2:1,f=a===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(h,!0)}var d=un(n.dtype,r.dtype),m=new Bg(n.shape,[l,s,a],i,o);return this.compileAndRun(m,[n,r],d)},e.prototype.fusedBatchMatMul=function(n){var r=n.a,i=n.b,o=n.transposeA,s=n.transposeB,a=n.bias,u=n.activation,l=n.preluActivationWeights,c=o?r.shape[2]:r.shape[1],h=s?i.shape[1]:i.shape[2],f=r.shape[0],d=un(r.dtype,i.dtype),m=a!=null,v=l!=null,y=u?mf(u,!0):null,g=new Bg(r.shape,[f,c,h],o,s,m,y,v),_=[r,i];return a&&_.push(a),l&&_.push(l),this.compileAndRun(g,_,d)},e.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var i=this.texData.get(n.dataId),o=this.texData.get(r.dataId),s=new tC(R5,n.shape,r.shape),a=new tC(A5,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(s,u),c=this.compileAndRun(a,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,nC,n.dtype);var f=new Rt(nC,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},e.prototype.batchNormalization=function(n,r,i,o,s,a){var u=[n,r,i],l=null;a!=null&&(l=a.shape,u.push(a));var c=null;if(s!=null&&(c=s.shape,u.push(s)),J().getBool("WEBGL_PACK_NORMALIZATION")){var h=new I5(n.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)}var f=new T5(n.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(f,u)},e.prototype.localResponseNormalization4D=function(n,r,i,o,s){var a=J().getBool("WEBGL_PACK_NORMALIZATION")?new Ej(n.shape,r,i,o,s):new xj(n.shape,r,i,o,s);return this.compileAndRun(a,[n])},e.prototype.LRNGrad=function(n,r,i,o,s,a,u){var l=new bj(r.shape,o,s,a,u);return this.compileAndRun(l,[r,i,n])},e.prototype.tile=function(n,r){if(n.dtype==="string"){var i=this.readSync(n.dataId).map(function(s){return Pd(s)});return BA(Ae(n.shape,n.dtype,i),r)}var o=new Gj(n.shape,r);return this.compileAndRun(o,[n])},e.prototype.pad=function(n,r,i){var o=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kj(n.shape,r,i):new Aj(n.shape,r,i);return this.compileAndRun(o,[n])},e.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var i=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Kj(n.shape,r):new qj(n.shape,r);return this.compileAndRun(i,[n])},e.prototype.gather=function(n,r,i){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,i);var o=new tj(n.shape,r.size,i);return this.compileAndRun(o,[n,r])},e.prototype.batchToSpaceND=function(n,r,i){O(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(h,f){return h*f}),s=Ld(n.shape,r,o),a=Vd(s.length,r.length),u=Bd(n.shape,r,o),l=TA(i,r.length),c=IA(u,i,r.length);return n.reshape(s).transpose(a).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(n,r,i){O(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(f,d){return f*d}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<n.shape.length;++a)s.push([0,0]);var u=n.pad(s),l=Ld(u.shape,r,o,!1),c=Vd(l.length,r.length,!1),h=Bd(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(h)},e.prototype.reduce=function(n,r,i){var o=n.shape[0],s=n.shape[1],a=Og(s),u=new Pj({windowSize:a,inSize:s,batchSize:o},r),l=this.compileAndRun(u,[n],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(n,r,i){i===void 0&&(i=null);var o=n.shape[0],s=n.shape[1];i!=null&&(o=i.shape[0],s=i.shape[1]);var a=Og(s),u=new v5({windowSize:a,inSize:s,batchSize:o},r,i==null),l=[n];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(n,r,c)},e.prototype.argReducePacked=function(n,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:n.shape,s=Og(o[o.length-1]),a=new E5(o,s,r,i==null),u=i==null?[n]:[n,i],l=this.compileAndRun(a,u,"int32");return l.rank===n.rank?this.argReducePacked(n,r,l):l},e.prototype.sum=function(n,r){ur("sum",r,n.rank);var i=wn(n.shape,r),o=i[0],s=pe(i[1]),a=n.as2D(-1,s),u=Rg(n.dtype);return this.reduce(a,"sum",u).reshape(o)},e.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var i=wn(n.shape,r),o=i[0],s=pe(i[1]),a=n.as2D(-1,s),u=Rg(n.dtype);return this.reduce(a,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(n,r,i){var o=0,s=Ti([o],n.rank),a=n;s!=null&&(a=n.transpose(s),o=Ii(1,n.rank)[0]);var u=function(d,m,v){for(var y=[],g=d.length,_=0;_<g;_++)_!==m?y.push(d[_]):y.push(v);return y}(a.shape,o,i),l=pe([a.shape[o]]),c=a.as2D(-1,l),h=Rg(n.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,h,i).reshape(u);return s!=null&&(f=f.transpose(U1(s))),f},e.prototype.segOpCompute=function(n,r,i,o,s){var a=n.shape[0],u=n.shape[1],l=function(f,d){var m,v=!1;for(f<=AA?(m=f,v=!0):m=Ty(f,Math.floor(Math.sqrt(f)));!v;)m>d||m===f?v=!0:m=Ty(f,m+1);return m}(u,s),c=new jj({windowSize:l,inSize:u,batchSize:a,numSegments:s}),h=this.compileAndRun(c,[n,i],o);return h.shape[1]===s?h:(i=Od(0,s).tile([u/l]),this.segOpCompute(h,r,i,o,s))},e.prototype.argMinMaxReduce=function(n,r,i){var o=[r];if(ur("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,n.rank),!J().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var s=wn(n.shape,o),a=s[0],u=pe(s[1]),l=n.as2D(-1,u);return this.argReduce(l,i).reshape(a)}return this.argReducePacked(n,i)},e.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},e.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},e.prototype.cumsum=function(n,r,i,o){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var s=new z5(n.shape,i,o);return this.compileAndRun(s,[n])},e.prototype.equal=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var i=new Rt("return float(a == b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.notEqual=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new Rt("return float(a != b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new Rt("return float(a < b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.lessEqual=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new Rt("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new Rt("return float(a > b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.greaterEqual=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new Rt("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.logicalNot=function(n){var r=new ke(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},e.prototype.logicalAnd=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new Rt("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.logicalOr=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new Rt("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.select=function(n,r,i){var o=new Uj(n.rank,r.shape,r.rank);return this.compileAndRun(o,[n,r,i],un(r.dtype,i.dtype))},e.prototype.where=function(n){Md("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return X1(n.shape,r)},e.prototype.topk=function(n,r,i){return jA(n.dataSync(),n.shape,n.dtype,r)},e.prototype.min=function(n,r){ur("min",r,n.rank);var i=wn(n.shape,r),o=i[0],s=pe(i[1]),a=n.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Rt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.mod=function(n,r){var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Rt(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);ur("max",r,n.rank);var i=wn(n.shape,r),o=i[0],s=pe(i[1]),a=n.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Rt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.all=function(n,r){ur("all",r,n.rank);var i=wn(n.shape,r),o=i[0],s=pe(i[1]),a=n.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(n,r){ur("any",r,n.rank);var i=wn(n.shape,r),o=i[0],s=pe(i[1]),a=n.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.realDivide=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new Rt(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(i,[n,r],"float32")},e.prototype.floorDiv=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new Rt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(i,[n,r],"int32")},e.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Lg);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var i=un(n.dtype,r.dtype);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Lg,i);var o=new Rt(Lg,n.shape,r.shape);return this.compileAndRun(o,[n,r],i)},e.prototype.packedUnaryOp=function(n,r,i){var o=new Il(n.shape,r);return this.compileAndRun(o,[n],i)},e.prototype.packedBinaryOp=function(n,r,i,o,s){s===void 0&&(s=!1);var a=new Ni(i,n.shape,r.shape,s);return this.compileAndRun(a,[n,r],o)},e.prototype.complexSeparableBinaryOp=function(n,r,i){var o=this,s=this.texData.get(n.dataId),a=this.texData.get(r.dataId),u=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(f){var d=f[0],m=f[1],v=o.makeComplexComponentTensorInfo(n,d),y=o.makeComplexComponentTensorInfo(r,m),g=new Rt(i,n.shape,r.shape);return o.compileAndRun(g,[v,y],un(d.dtype,m.dtype))}),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},e.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>J().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),i=this.addN(n.slice(0,r)),o=this.addN(n.slice(r));return this.addN([i,o])}var s=n.map(function(l){return l.dtype}).reduce(function(l,c){return un(l,c)}),a=n.map(function(l){return l.shape}),u=J().getBool("WEBGL_PACK")?new g5(n[0].shape,a):new m5(n[0].shape,a);return this.compileAndRun(u,n,s)},e.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Vg);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var i=un(n.dtype,r.dtype);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Vg,n.dtype);var o=new Rt(Vg,n.shape,r.shape);return this.compileAndRun(o,[n,r],i)},e.prototype.pow=function(n,r){var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Rt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),o=un(n.dtype,r.dtype);return this.compileAndRun(i,[n,r],o)},e.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,pC,n.dtype);var r=new ke(n.shape,pC);return this.compileAndRun(r,[n])},e.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,mC,n.dtype);var r=new ke(n.shape,mC);return this.compileAndRun(r,[n])},e.prototype.sign=function(n){var r=new ke(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},e.prototype.isNaN=function(n){var r=new ke(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.isInf=function(n){var r=new ke(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.isFinite=function(n){var r=new ke(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.round=function(n){var r=new ke(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},e.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,gC,n.dtype);var r=new ke(n.shape,gC);return this.compileAndRun(r,[n])},e.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,vC,n.dtype);var r=new ke(n.shape,vC);return this.compileAndRun(r,[n])},e.prototype.softmax=function(n,r){var i=qt([r],n.shape),o=this.max(n,i),s=rr(o.shape,i),a=this.subtract(n,o.reshape(s)),u=this.exp(a),l=this.sum(u,i).reshape(s);return this.realDivide(u,l)},e.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new ke(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},e.prototype.log1p=function(n){var r=new ke(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},e.prototype.sqrt=function(n){var r=new ke(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},e.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new ke(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},e.prototype.reciprocal=function(n){var r=new ke(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},e.prototype.relu=function(n){var r;return r=J().getBool("WEBGL_PACK")?new Il(n.shape,XA):new ke(n.shape,GA),this.compileAndRun(r,[n])},e.prototype.relu6=function(n){var r;return r=J().getBool("WEBGL_PACK")?new Il(n.shape,YA):new ke(n.shape,qA),this.compileAndRun(r,[n])},e.prototype.prelu=function(n,r){var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(HA,n.shape,r.shape):new Rt($A,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.elu=function(n){if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,QA,n.dtype);var r=new ke(n.shape,KA);return this.compileAndRun(r,[n])},e.prototype.eluDer=function(n,r){var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new Rt("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.selu=function(n){var r=new ke(n.shape,Yj);return this.compileAndRun(r,[n])},e.prototype.int=function(n){var r=new ke(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},e.prototype.clip=function(n,r,i){var o,s=(o=J().getBool("WEBGL_PACK_CLIP")?new P5(n.shape):new k5(n.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[n],null,s)},e.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,fC,n.dtype);var r=new ke(n.shape,fC);return this.compileAndRun(r,[n])},e.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),i=new N5(n.shape),o=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(n){var r=new ke(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},e.prototype.softplus=function(n){var r=new ke(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},e.prototype.sin=function(n){var r=new ke(n.shape,Qj);return this.compileAndRun(r,[n])},e.prototype.cos=function(n){var r=new ke(n.shape,Jj);return this.compileAndRun(r,[n])},e.prototype.tan=function(n){var r=new ke(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},e.prototype.asin=function(n){var r=new ke(n.shape,Zj);return this.compileAndRun(r,[n])},e.prototype.acos=function(n){var r=new ke(n.shape,eU);return this.compileAndRun(r,[n])},e.prototype.atan=function(n){var r=new ke(n.shape,tU);return this.compileAndRun(r,[n])},e.prototype.atan2=function(n,r){var i=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Rt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.sinh=function(n){var r=new ke(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},e.prototype.cosh=function(n){var r=new ke(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},e.prototype.tanh=function(n){var r=new ke(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},e.prototype.asinh=function(n){var r=new ke(n.shape,nU);return this.compileAndRun(r,[n])},e.prototype.acosh=function(n){var r=new ke(n.shape,rU);return this.compileAndRun(r,[n])},e.prototype.atanh=function(n){var r=new ke(n.shape,iU);return this.compileAndRun(r,[n])},e.prototype.erf=function(n){var r=new ke(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},e.prototype.step=function(n,r){var i=new ke(n.shape,function(o){return o===void 0&&(o=0),ti+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[n])},e.prototype.conv2dByMatMul=function(n,r,i,o,s,a){var u=n.shape,l=this.texData.get(n.dataId),c=i.inChannels,h=u[0]*u[1]*u[2],f=i.outChannels,d=i.dataFormat==="channelsLast",m=(h===1||f===1)&&c>1e3,v=u[2]%2!=0&&!!l.isPacked;if(m||!J().getBool("WEBGL_LAZILY_UNPACK")||!J().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var y=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(n,[1,y,i.inChannels]),_=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:_,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var w=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),x={dataId:n.dataId,shape:[1,w,i.inChannels],dtype:n.dtype},S=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,O(hf(l.shape,x.shape),function(){return"packed reshape "+l.shape+" to "+x.shape+" isn't free"});var A=this.reshape(r,[1,i.inChannels,i.outChannels]),T=this.fusedBatchMatMul({a:x,b:A,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),E=this.texData.get(T.dataId);return O(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=S,E.shape=i.outShape,B.makeTensorFromDataId(T.dataId,i.outShape,T.dtype)},e.prototype.conv2dWithIm2Row=function(n,r,i,o,s,a){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,h=i.outWidth,f=i.outHeight,d=i.dataFormat==="channelsLast",m=u*l*c,v=f*h,y=[m,v],g=n.squeeze([0]),_=r.reshape([1,m,-1]),w=new wj(y,g.shape,i),x=this.compileAndRun(w,[g]).reshape([1,y[0],y[1]]),S=o!=null,A=a!=null,T=s?mf(s,!0):null,E=new Bg(x.shape,[1,v,i.outChannels],!0,!1,S,T,A),C=[x,_];o&&C.push(o),A&&C.push(a);var I=this.compileAndRun(E,C);return d?I.reshape([1,f,h,i.outChannels]):I.reshape([1,i.outChannels,f,h])},e.prototype.fusedConv2d=function(n){var r=n.input,i=n.filter,o=n.convInfo,s=n.bias,a=n.activation,u=n.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,s,a,u);if(J().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,s,a,u);var l=s!=null,c=u!=null,h=a?mf(a,!1):null,f=new rC(o,l,h,c),d=[r,i];return s&&d.push(s),u&&d.push(u),this.compileAndRun(f,d)},e.prototype.conv2d=function(n,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,i);if(J().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,i);var o=new rC(i);return this.compileAndRun(o,[n,r])},e.prototype.conv2dDerInput=function(n,r,i){var o=new O5(i);return this.compileAndRun(o,[n,r])},e.prototype.conv2dDerFilter=function(n,r,i){var o=new F5(i);return this.compileAndRun(o,[n,r])},e.prototype.fusedDepthwiseConv2D=function(n){var r,i=n.input,o=n.filter,s=n.convInfo,a=n.bias,u=n.activation,l=n.preluActivationWeights,c=J().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,h=u?mf(u,c):null,f=[i,o],d=a!=null,m=l!=null;return d&&f.push(a),m&&f.push(l),c?(r=new oC(s,d,h,m),this.compileAndRun(r,f)):(r=new iC(s,d,h,m),this.compileAndRun(r,f))},e.prototype.depthwiseConv2D=function(n,r,i){var o;return J().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new oC(i),this.compileAndRun(o,[n,r])):(o=new iC(i),this.compileAndRun(o,[n,r]))},e.prototype.depthwiseConv2DDerInput=function(n,r,i){var o=new j5(i);return this.compileAndRun(o,[n,r])},e.prototype.depthwiseConv2DDerFilter=function(n,r,i){var o=new B5(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3d=function(n,r,i){var o=new U5(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3dDerInput=function(n,r,i){var o=new V5(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3dDerFilter=function(n,r,i){var o=new L5(i);return this.compileAndRun(o,[n,r])},e.prototype.maxPool=function(n,r){var i=new jg(r,"max",!1);return this.compileAndRun(i,[n])},e.prototype.avgPool=function(n,r){var i=new jg(r,"avg",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.maxPoolBackprop=function(n,r,i,o){var s=new jg(o,"max",!0),a=this.compileAndRun(s,[r]),u=new Cj(o),l=this.compileAndRun(u,[n,a],r.dtype);return a.dispose(),l},e.prototype.avgPoolBackprop=function(n,r,i){var o=new C5(i);return this.compileAndRun(o,[n],r.dtype)},e.prototype.cast=function(n,r){return FA(n,r,this)},e.prototype.unstack=function(n,r){for(var i=n.shape[r],o=new Array(n.rank-1),s=0,a=0;a<n.rank;a++)a!==r&&(o[s++]=n.shape[a]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(n,u,l).reshape(o);return c},e.prototype.avgPool3d=function(n,r){var i=new Ug(r,"avg",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.avgPool3dBackprop=function(n,r,i){var o=new S5(i);return this.compileAndRun(o,[n],r.dtype)},e.prototype.maxPool3d=function(n,r){var i=new Ug(r,"max",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.maxPool3dBackprop=function(n,r,i,o){var s=new Ug(o,"max",!0),a=this.compileAndRun(s,[r]),u=new Sj(o),l=this.compileAndRun(u,[n,a],r.dtype);return a.dispose(),l},e.prototype.reshape=function(n,r){var i=this.texData.get(n.dataId);if(i.isPacked&&!hf(n.shape,r)&&(i.texture===null||!hf(i.shape,r))){var o=this.packedReshape(n,r);return B.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return My(n,r)},e.prototype.resizeBilinear=function(n,r,i,o){var s=J().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Fj(n.shape,r,i,o):new Mj(n.shape,r,i,o);return this.compileAndRun(s,[n],"float32")},e.prototype.resizeBilinearBackprop=function(n,r,i){var o=new Dj(n,r,i);return this.compileAndRun(o,[n])},e.prototype.resizeNearestNeighbor=function(n,r,i,o){var s=new Lj(n.shape,r,i,o);return this.compileAndRun(s,[n])},e.prototype.resizeNearestNeighborBackprop=function(n,r,i){var o=new Oj(n,r,i);return this.compileAndRun(o,[n])},e.prototype.multinomial=function(n,r,i,o){var s=r?n:ro(n),a=s.shape[0],u=s.shape[1],l=new Tj(a,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[s],"int32",c)},e.prototype.oneHot=function(n,r,i,o){var s=new Ij(n.size,r,i,o);return this.compileAndRun(s,[n])},e.prototype.diag=function(n){var r=new q5(n.size);return this.compileAndRun(r,[n])},e.prototype.nonMaxSuppression=function(n,r,i,o,s){return Md("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),q1(n.dataSync(),r.dataSync(),i,o,s)},e.prototype.cropAndResize=function(n,r,i,o,s,a){var u=new W5(n.shape,r.shape,o,s,a);return this.compileAndRun(u,[n,r,i],"float32")},e.prototype.depthToSpace=function(n,r,i){O(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=n.shape[0],s=i==="NHWC"?n.shape[1]:n.shape[2],a=i==="NHWC"?n.shape[2]:n.shape[3],u=i==="NHWC"?n.shape[3]:n.shape[1],l=s*r,c=a*r,h=u/(r*r),f=new G5(i==="NHWC"?[o,l,c,h]:[o,h,l,c],r,i);return this.compileAndRun(f,[n])},e.prototype.split=function(n,r,i){return VA(n,r,i)},e.prototype.scatterND=function(n,r,i){var o=jd(0,n,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=[c/u,u],f=n.reshape([a,s]),d=r.reshape([a,u]);if(c===0)return My(cn([]),i);var m=se(0),v=new lC(a,s,f.rank,d.rank,l,h);return this.compileAndRun(v,[d,f,m]).reshape(i)},e.prototype.sparseToDense=function(n,r,i,o){var s=jd(0,n,i),a=s.sliceRank,u=s.numUpdates,l=s.strides,c=s.outputSize,h=new lC(u,a,n.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,n,o]).reshape(i)},e.prototype.fft=function(n){return this.fftImpl(n,!1)},e.prototype.ifft=function(n){return this.fftImpl(n,!0)},e.prototype.fftImpl=function(n,r){var i=this.texData.get(n.dataId),o=new aC(J5,n.shape,r),s=new aC(Z5,n.shape,r),a=[this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag)],u=this.compileAndRun(o,a),l=this.compileAndRun(s,a),c=this.complex(u,l).as2D(n.shape[0],n.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(n,r){var i=r.shape,o=i[i.length-1],s=RA(n,r),a=s[0],u=s[1],l=s[2],c=s[3],h=r.reshape([u,o]),f=n.reshape([n.size/l,l]),d=new nj(o,c,[u,l]);return this.compileAndRun(d,[f,h]).reshape(a)},e.prototype.fill=function(n,r,i){if((i=i||oh(r))==="string"){var o=kd(i,pe(n));return o.fill(r),B.makeTensor(o,n,i,this)}var s=new ej(n,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},e.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},e.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},e.prototype.linspace=function(n,r,i){return OA(n,r,i)},e.prototype.makeTensorInfo=function(n,r){var i=this.write(null,n,r);return this.texData.get(i).usage=null,{dataId:i,shape:n,dtype:r}},e.prototype.makeOutput=function(n,r){var i=this.makeTensorInfo(n,r).dataId;return B.makeTensorFromDataId(i,n,r,this)},e.prototype.unpackTensor=function(n){var r=new sU(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},e.prototype.packTensor=function(n){var r=new Rj(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},e.prototype.packedReshape=function(n,r){var i=[Nd(n.shape)].concat(Dd(n.shape)),o={dtype:n.dtype,shape:i,dataId:n.dataId},s=[Nd(r)].concat(Dd(r)),a=new Nj(s,i),u=this.runWebGLProgram(a,[o],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(n){var r,i=this.texData.get(n),o=i.isPacked,s=i.shape,a=i.dtype,u=Fg(s);return r=o?new H5(u):new $5(u),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:n}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(n,r,i,o,s){var a=this;s===void 0&&(s=!1);var u=this.makeTensorInfo(n.outputShape,i),l=this.texData.get(u.dataId);if(n.packedOutput&&(l.isPacked=!0),n.outPackingScheme===Mc.DENSE){var c=Zl(n.outputShape);l.texShape=c.map(function(w){return 2*w})}if(n.outTexUsage!=null&&(l.usage=n.outTexUsage),pe(u.shape)===0)return l.values=Nc(u.dtype,0),u;var h=[],f=r.map(function(w){if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var x=a.texData.get(w.dataId);if(x.texture==null){if(!n.packedInputs&&pe(w.shape)<=J().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:x.values};n.packedInputs&&(x.isPacked=!0,x.shape=w.shape)}else if(!!x.isPacked!=!!n.packedInputs)w=x.isPacked?a.unpackTensor(w):a.packTensor(w),h.push(w),x=a.texData.get(w.dataId);else if(x.isPacked&&!hf(x.shape,w.shape)){var S=w,A=w.shape;w.shape=x.shape,w=a.packedReshape(w,A),h.push(w),x=a.texData.get(w.dataId),S.shape=A}return a.uploadToGPU(w.dataId),{shape:w.shape,texData:x,isUniform:!1}});this.uploadToGPU(u.dataId);var d,m={shape:u.shape,texData:l,isUniform:!1},v=function(w,x,S){var A="";x.concat(S).forEach(function(C){var I=C.texData!=null&&C.texData.slice!=null&&C.texData.slice.flatOffset>0,P=C.isUniform?"uniform":C.texData.texShape;A+=C.shape+"_"+P+"_"+I});var T=w.userCode,E=w.constructor.name;return E+="_"+A+"_"+T}(n,f,m),y=this.getAndSaveBinary(v,function(){return function(w,x,S,A){var T=x.userCode,E=S.map(function(V,z){var U={logicalShape:V.shape,texShape:V.isUniform?null:V.texData.texShape,isUniform:V.isUniform,isPacked:!V.isUniform&&V.texData.isPacked,flatOffset:null};return V.texData!=null&&V.texData.slice!=null&&V.texData.slice.flatOffset>0&&(U.flatOffset=V.texData.slice.flatOffset),{name:x.variableNames[z],shapeInfo:U}}),C=E.map(function(V){return V.shapeInfo}),I={logicalShape:A.shape,texShape:A.texData.texShape,isUniform:!1,isPacked:A.texData.isPacked,flatOffset:null},P=y5(E,I,T,x.packedInputs),N=w.createProgram(P),k=null,j=w.getUniformLocation(N,"NAN",!1);J().getNumber("WEBGL_VERSION")===1&&(k=w.getUniformLocation(N,"INFINITY",!1));for(var W={},q=0;q<x.variableNames.length;q++){var X=x.variableNames[q];W[X]=w.getUniformLocation(N,X,!1),W["offset"+X]=w.getUniformLocation(N,"offset"+X,!1)}return{program:x,source:P,webGLProgram:N,uniformLocations:W,inShapeInfos:C,outShapeInfo:I,infLoc:k,nanLoc:j}}(a.gpgpu,n,f,m)}),g=this.activeTimers!=null;if(g&&(d=this.startTimer()),function(w,x,S,A,T){uC(x.inShapeInfos,S),uC([x.outShapeInfo],[A]);var E=A.texData.texture,C=A.texData.texShape;A.texData.isPacked?w.setOutputPackedMatrixTexture(E,C[0],C[1]):w.setOutputMatrixTexture(E,C[0],C[1]),w.setProgram(x.webGLProgram),J().getNumber("WEBGL_VERSION")===1&&x.infLoc!==null&&w.gl.uniform1f(x.infLoc,1/0),x.nanLoc!==null&&w.gl.uniform1f(x.nanLoc,NaN),S.forEach(function(I,P){var N=x.program.variableNames[P],k=x.uniformLocations[N],j=x.uniformLocations["offset"+N];if(k!=null)if(I.isUniform)if(pe(I.shape)<2)w.gl.uniform1f(k,I.uniformValues[0]);else{var W=I.uniformValues;W instanceof Float32Array||(W=new Float32Array(W)),w.gl.uniform1fv(k,W)}else I.texData.slice!=null&&j!=null&&w.gl.uniform1i(j,I.texData.slice.flatOffset),w.setInputMatrixTexture(I.texData.texture,k,P)}),T!=null&&T(w,x.webGLProgram),w.executeProgram()}(this.gpgpu,y,f,m,o),h.forEach(function(w){return a.disposeData(w.dataId)}),g&&(d=this.endTimer(d),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(d)})),!J().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){var _=this.unpackTensor(u);return this.disposeData(u.dataId),_}return u},e.prototype.compileAndRun=function(n,r,i,o,s){s===void 0&&(s=!1),i=i||r[0].dtype;var a=this.runWebGLProgram(n,r,i,o,s);return B.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var n=this;this.disposed||(J().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ue(function(){if(!J().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=J().getBool("DEBUG");J().set("DEBUG",!1);var i=n.abs(se(1e-8)).dataSync()[0];if(J().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(n){var r,i=this.texData.get(n),o=i.shape,s=i.dtype,a=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var h,f=this.activeTimers!=null;f&&(h=ci());var d=i.texShape;if(d==null&&(d=p6(o,c),i.texShape=d),a!=null){var m=Fg(o),v=void 0,y=d[1],g=d[0],_=a instanceof Uint8Array;c?(y=(r=ah(d[0],d[1]))[0],g=r[1],v=new Q5(m,[g,y],_)):v=new Y5(m,[g,y],_);var w=this.makeTensorInfo([g,y],s);this.texData.get(w.dataId).usage=_?hr.PIXELS:hr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),y,g,a);var x=this.runWebGLProgram(v,[w],s,null,!0),S=this.texData.get(x.dataId);i.texture=S.texture,i.texShape=S.texShape,i.isPacked=S.isPacked,i.usage=S.usage,this.disposeData(w.dataId),this.texData.delete(x.dataId),i.values=null,f&&(this.uploadWaitMs+=ci()-h)}else{var A=this.acquireTexture(d,l,s,c);i.texture=A}}},e.prototype.convertAndCacheOnCPU=function(n,r){var i=this.texData.get(n),o=i.dtype;return this.releaseGPUData(n),r!=null&&(i.values=function(s,a){if(a==="float32"||a==="complex64")return s;if(a==="int32"||a==="bool"){for(var u=a==="int32"?new Int32Array(s.length):new Uint8Array(s.length),l=0;l<u.length;++l)u[l]=Math.round(s[l]);return u}throw new Error("Unknown dtype "+a)}(r,o)),i.values},e.prototype.acquireTexture=function(n,r,i,o){if(this.numBytesInGPU+=this.computeBytes(n,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,o)},e.prototype.computeBytes=function(n,r){return n[0]*n[1]*cA(r)},e}(DA);vA()&&B.registerBackend("webgl",function(){return new uU},2);var lU=L({square_:function(t){var e=M(t,"x","square"),n=[e];return B.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},n,[])}}),Oc="SquaredDifference",JA=L({squaredDifference_:function(t,e){var n,r=M(t,"a","squaredDifference"),i=M(e,"b","squaredDifference");n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape);var o={a:r,b:i},s=[r,i];return B.runKernelFunc(function(a,u){var l=a.squaredDifference(r,i);return u([r,i]),l},o,function(a,u){var l=u[0],c=u[1],h=se(2);return{a:function(){return a.mul(l.sub(c).mul(h))},b:function(){return a.mul(c.sub(l).mul(h))}}},Oc,{},s,[])}}),cU=L({abs_:function(t){var e=M(t,"x","abs");return e.dtype==="complex64"?B.runKernelFunc(function(n){return n.complexAbs(e)},{$x:e}):B.runKernelFunc(function(n,r){var i=n.abs(e);return r([e]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mul(i.toFloat().step(-1))}}},"Abs")}}),hU=L({acos_:function(t){var e=M(t,"x","acos");return B.runKernelFunc(function(n,r){var i=n.acos(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(se(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),fU=L({acosh_:function(t){var e=M(t,"x","acosh");return B.runKernelFunc(function(n,r){var i=n.acosh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),dU=L({asin_:function(t){var e=M(t,"x","asin");return B.runKernelFunc(function(n,r){var i=n.asin(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(se(1).sub(i.toFloat().square()).sqrt())}}})}}),pU=L({asinh_:function(t){var e=M(t,"x","asinh");return B.runKernelFunc(function(n,r){var i=n.asinh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(se(1).add(i.toFloat().square()).sqrt())}}})}}),mU=L({atan_:function(t){var e=M(t,"x","atan");return B.runKernelFunc(function(n,r){var i=n.atan(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.toFloat().square().add(1))}}})}}),gU=L({atanh_:function(t){var e=M(t,"x","atanh");return B.runKernelFunc(function(n,r){var i=n.atanh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(se(1).sub(i.toFloat().square()))}}})}}),vU=L({ceil_:function(t){var e=M(t,"x","ceil");return B.runKernelFunc(function(n){return n.ceil(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),Z1=L({clipByValue_:function(t,e,n){var r=M(t,"x","clipByValue");O(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."});var i=[r],o={min:e,max:n};return B.runKernelFunc(function(s,a){var u=s.clip(r,e,n);return a([r]),u},{x:r},function(s,a){var u=a[0];return{x:function(){return s.where(u.greaterEqual(e).logicalAnd(u.lessEqual(n)),$e(s))}}},"ClipByValue",o,i)}}),yU=L({cos_:function(t){var e=M(t,"x","cos"),n=[e];return B.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),_U=L({cosh_:function(t){var e=M(t,"x","cosh");return B.runKernelFunc(function(n,r){var i=n.cosh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(n)}}})}}),wU=L({erf_:function(t){var e=M(t,"x","erf");return O(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),B.runKernelFunc(function(n,r){var i=n.erf(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Oy=L({exp_:function(t){var e=M(t,"x","exp");return B.runKernelFunc(function(n,r){var i=n.exp(e);return r([i]),i},{x:e},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),xU=L({expm1_:function(t){var e=M(t,"x","expm1");return B.runKernelFunc(function(n,r){var i=n.expm1(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.exp())}}})}}),bU=L({floor_:function(t){var e=M(t,"x","floor");return B.runKernelFunc(function(n){return n.floor(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),EU=L({log_:function(t){var e=M(t,"x","log"),n=[e];return B.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},n)}}),CU=L({log1p_:function(t){var e=M(t,"x","log1p");return B.runKernelFunc(function(n,r){var i=n.log1p(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.add(1))}}})}}),SU=L({logSigmoid_:function(t){var e=M(t,"x","logSigmoid");return B.runKernelFunc(function(n,r){var i=n.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.neg().sigmoid())}}})}}),$d=L({neg_:function(t){var e=M(t,"x","neg"),n=[e];return B.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),TU=L({reciprocal_:function(t){var e=M(t,"x","reciprocal");return B.runKernelFunc(function(n,r){var i=n.reciprocal(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.square().neg())}}})}}),IU=L({round_:function(t){var e=M(t,"x","round");return B.runKernelFunc(function(n){return n.round(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),ZA=L({rsqrt_:function(t){var e=M(t,"x","rsqrt"),n=[e];return B.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),ek=L({sigmoid_:function(t){var e=M(t,"x","sigmoid");return B.runKernelFunc(function(n,r){var i=n.sigmoid(e);return r([i]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mul(i.mul(se(1).sub(i)))}}},"Sigmoid")}}),RU=L({sign_:function(t){var e=M(t,"x","sign");return B.runKernelFunc(function(n){return n.sign(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),AU=L({isNaN_:function(t){var e=M(t,"x","isNaN");return B.runKernelFunc(function(n){return n.isNaN(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),kU=L({isInf_:function(t){var e=M(t,"x","isInf");return B.runKernelFunc(function(n){return n.isInf(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),PU=L({isFinite_:function(t){var e=M(t,"x","isFinite");return B.runKernelFunc(function(n){return n.isFinite(e)},{$x:e},function(n){return{$x:function(){return $e(n)}}})}}),NU=L({sin_:function(t){var e=M(t,"x","sin"),n=[e];return B.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},n)}}),DU=L({sinh_:function(t){var e=M(t,"x","sinh");return B.runKernelFunc(function(n,r){var i=n.sinh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(n)}}})}}),MU=L({softplus_:function(t){var e=M(t,"x","softplus");return B.runKernelFunc(function(n,r){var i=n.softplus(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.sigmoid())}}})}}),FU=L({sqrt_:function(t){var e=M(t,"x","sqrt");return B.runKernelFunc(function(n,r){var i=n.sqrt(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.toFloat().sqrt().mul(2))}}})}}),OU=L({step_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","step");return B.runKernelFunc(function(r){return r.step(n,e)},{$x:n},function(r){return{$x:function(){return $e(r)}}})}}),LU=L({tan_:function(t){var e=M(t,"x","tan");return B.runKernelFunc(function(n,r){var i=n.tan(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.cos().square())}}})}}),VU=L({tanh_:function(t){var e=M(t,"x","tanh");return B.runKernelFunc(function(n,r){var i=n.tanh(e);return r([i]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return se(1).sub(i.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function tk(t,e,n,r,i,o){var s,a,u=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(n,"variance","batchNorm");return i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),O(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),O(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),O(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),s!=null&&O(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),a!=null&&O(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),lh(u,l,c,a,s,o)}function nk(t,e,n,r,i,o){var s,a,u=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(n,"variance","batchNorm");return i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),O(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),O(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),O(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),s!=null&&O(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),a!=null&&O(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),lh(u,l,c,a,s,o)}function rk(t,e,n,r,i,o){var s,a,u=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(n,"variance","batchNorm");return i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),O(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),O(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),O(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),s!=null&&O(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),a!=null&&O(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),lh(u,l,c,a,s,o)}function lh(t,e,n,r,i,o){o==null&&(o=.001);var s,a,u,l=M(t,"x","batchNorm"),c=M(e,"mean","batchNorm"),h=M(n,"variance","batchNorm");i!=null&&(s=M(i,"scale","batchNorm")),r!=null&&(a=M(r,"offset","batchNorm")),O(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),O(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),O(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,c,h,s];return B.runKernelFunc(function(d,m){var v=d.batchNormalization(u,gf(c),gf(h),o,gf(s),gf(a));return m([l,c,h,s]),v},{x:l,mean:c,variance:h,scale:s,offset:a},function(d,m){var v=m,y=v[0],g=v[1],_=v[2],w=v[3],x=w??se(1),S=Ht(g.shape,u.shape),A=[];if(g.rank===1){for(var T=0;T<u.shape.length-1;++T)A.push(u.shape[T]);A.push(1)}var E=y.sub(g),C=d.mul(x),I=ZA(_.add(se(o))),P=I.mul(I).mul(I).mul(se(-.5));return{x:function(){return g.rank===1?d.mul(uu(I.as4D(1,1,1,g.shape[0]),A)).mul(x).reshape(y.shape):d.mul(I).mul(x).reshape(y.shape)},mean:function(){var N=I.mul(se(-1)).mul(C);return g.rank===1&&(N=N.sum(S)),N.reshape(g.shape)},variance:function(){var N=P.mul(E).mul(C);return g.rank===1&&(N=N.sum(S)),N.reshape(g.shape)},scale:function(){var N=E.mul(I),k=d.mul(N);return g.rank===1&&(k=k.sum(S)),k.reshape(g.shape)},offset:function(){var N=d;return g.rank===1&&(N=N.sum(S)),N.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:o},f).reshape(l.shape)}function gf(t){return t==null?null:t.rank===0?t.as1D():t.rank===1?t:t.rank===2?t.as4D(1,1,t.shape[0],t.shape[1]):t.rank===3?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Xp(){yA("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var BU=L({batchNormalization2d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Xp(),tk(t,e,n,o,i,r)}}),jU=L({batchNormalization3d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Xp(),nk(t,e,n,o,i,r)}}),UU=L({batchNormalization4d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Xp(),rk(t,e,n,o,i,r)}}),WU=L({batchNormalization_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Xp(),lh(t,e,n,o,i,r)}}),ik=L({batchNorm_:lh}),zU=L({batchNorm2d_:tk}),$U=L({batchNorm3d_:nk}),HU=L({batchNorm4d_:rk}),Yp=L({logicalAnd_:function(t,e){var n=M(t,"a","logicalAnd","bool"),r=M(e,"b","logicalAnd","bool");return Fe(n.shape,r.shape),B.runKernelFunc(function(i){return i.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),GU=L({logicalNot_:function(t){var e=M(t,"x","logicalNot","bool");return B.runKernelFunc(function(n){return n.logicalNot(e)},{$x:e})}}),ok=L({logicalOr_:function(t,e){var n=M(t,"a","logicalOr","bool"),r=M(e,"b","logicalOr","bool");return Fe(n.shape,r.shape),B.runKernelFunc(function(i){return i.logicalOr(n,r)},{$a:n,$b:r})}}),qU=L({logicalXor_:function(t,e){var n=M(t,"a","logicalXor","bool"),r=M(e,"b","logicalXor","bool");return Fe(n.shape,r.shape),ok(t,e).logicalAnd(Yp(t,e).logicalNot())}}),Ys=L({where_:function(t,e,n){var r=M(e,"a","where"),i=M(n,"b","where"),o=M(t,"condition","where","bool");return Qe(r.shape,i.shape,"Error in where: "),o.rank===1?O(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Qe(o.shape,i.shape,"Error in where: "),B.runKernelFunc(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return $e(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),sk=function(t){return he(this,void 0,void 0,function(){var e,n,r;return fe(this,function(i){switch(i.label){case 0:return[4,(e=M(t,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=X1(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},Me=L({add_:function(t,e){var n,r=M(t,"a","add"),i=M(e,"b","add");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s){return s.add(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=Ht(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=Ht(i.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}},"Add")}}),KU=L({addN_:function(t){O(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),O(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(i,o){return M(i,"tensors"+o,"addN")}),n=e[0];e.forEach(function(i){if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!rn(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return B.runKernelFunc(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(s,a){o[a]=function(){return i.clone()}}),o},"AddN")}}),XU=L({addStrict_:function(t,e){var n=M(t,"a","addStrict"),r=M(e,"b","addStrict");return Qe(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),YU=L({atan2_:function(t,e){var n,r=M(t,"a","atan2"),i=M(e,"b","atan2");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=Me(u.square(),l.square()),h=s.mul(l.div(c)),f=Ht(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=Me(u.square(),l.square()),h=$d(s.mul(u.div(c))),f=Ht(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),jr=L({div_:function(t,e){var n,r=M(t,"a","div"),i=M(e,"b","div");if(n=St(r,i),r=n[0],i=n[1],r.dtype==="int32"&&i.dtype==="int32")return ak(r,i);var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.div(l.toFloat()),h=Ht(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),h=Ht(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"Div")}}),QU=L({divNoNan_:function(t,e){var n,r=M(t,"a","div"),i=M(e,"b","div");r=(n=St(r,i))[0],i=n[1];var o=jr(r,i),s=$e(o),a=i.equal(s);return Ys(a,s,o)}}),JU=L({divStrict_:function(t,e){var n=M(t,"a","div"),r=M(e,"b","div");return Qe(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),ak=L({floorDiv_:function(t,e){var n,r=M(t,"a","floorDiv"),i=M(e,"b","floorDiv");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.div(l.toFloat()),h=Ht(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),h=Ht(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),e_=L({maximum_:function(t,e){var n,r=M(t,"a","maximum"),i=M(e,"b","maximum");return n=St(r,i),r=n[0],i=n[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Fe(r.shape,i.shape),B.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.greaterEqual(u).toFloat())},b:function(){return o.mul(a.less(u).toFloat())}}},"Maximum")}}),ZU=L({maximumStrict_:function(t,e){var n=M(t,"a","maximumStrict"),r=M(e,"b","maximumStrict");return Qe(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),uk=L({minimum_:function(t,e){var n,r=M(t,"a","minimum"),i=M(e,"b","minimum");return n=St(r,i),r=n[0],i=n[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Fe(r.shape,i.shape),B.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.lessEqual(u).toFloat())},b:function(){return o.mul(a.greater(u).toFloat())}}},"Minimum")}}),eW=L({minimumStrict_:function(t,e){var n=M(t,"a","minimumStrict"),r=M(e,"b","minimumStrict");return Qe(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),tW=L({mod_:function(t,e){var n,r=M(t,"a","mod"),i=M(e,"b","mod");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=Ht(u.shape,o);return c.length>0?s.sum(c).reshape(u.shape):s},$b:function(){var c=s.mul(u.div(l).floor().neg()),h=Ht(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),nW=L({modStrict_:function(t,e){var n=M(t,"a","modStrict"),r=M(e,"b","modStrict");return Qe(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),An=L({mul_:function(t,e){var n,r=M(t,"a","mul"),i=M(e,"b","mul");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.mul(l.toFloat()),h=Ht(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),h=Ht(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}},"Mul")}}),rW=L({mulStrict_:function(t,e){var n=M(t,"a","mul"),r=M(e,"b","mul");return Qe(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Hd=L({pow_:function(t,e){var n,r=M(t,"base","pow"),i=M(e,"exp","pow");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape),s=[r,i];return B.runKernelFunc(function(a,u){var l=a.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(a,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var f=c.toFloat(),d=a.mul(f.mul(l.pow(f.sub(se(1))))),m=Ht(l.shape,o);return m.length>0&&(d=d.sum(m)),d.reshape(l.shape)},b:function(){var f=l.greater(0),d=l.log().where(f,$e(l)),m=a.mul(h.mul(d)),v=Ht(c.shape,o);return v.length>0&&(m=m.sum(v)),m.reshape(c.shape)}}},"Pow",{},s,[!0])}}),iW=L({powStrict_:function(t,e){return Qe(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),oW=L({squaredDifferenceStrict_:function(t,e){var n=M(t,"a","squaredDifferenceStrict"),r=M(e,"b","squaredDifferenceStrict");return Qe(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Gt=L({sub_:function(t,e){var n,r=M(t,"a","sub"),i=M(e,"b","sub");n=St(r,i),r=n[0],i=n[1];var o=Fe(r.shape,i.shape);return B.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=Ht(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=Ht(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),sW=L({subStrict_:function(t,e){var n=M(t,"a","subStrict"),r=M(e,"b","subStrict");return Qe(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),lk=L({equal_:function(t,e){var n,r=M(t,"a","equal"),i=M(e,"b","equal");return n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape),B.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),aW=L({equalStrict_:function(t,e){var n=M(t,"a","equalStrict"),r=M(e,"b","equalStrict");return Qe(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),uW=L({greater_:function(t,e){var n,r=M(t,"a","greater"),i=M(e,"b","greater");return n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape),B.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),ck=L({greaterEqual_:function(t,e){var n,r=M(t,"a","greaterEqual"),i=M(e,"b","greaterEqual");return n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape),B.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return $e(a)},b:function(){return $e(u)}}},"GreaterEqual")}}),lW=L({greaterEqualStrict_:function(t,e){var n=M(t,"a","greaterEqualStrict"),r=M(e,"b","greaterEqualStrict");return Qe(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),cW=L({greaterStrict_:function(t,e){var n=M(t,"a","greaterStrict"),r=M(e,"b","greaterStrict");return Qe(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),hW=L({less_:function(t,e){var n,r=M(t,"a","less"),i=M(e,"b","less");return n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape),B.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),fW=L({lessEqual_:function(t,e){var n,r=M(t,"a","lessEqual"),i=M(e,"b","lessEqual");return n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape),B.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),dW=L({lessEqualStrict_:function(t,e){var n=M(t,"a","lessEqualStrict"),r=M(e,"b","lessEqualStrict");return Qe(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),pW=L({lessStrict_:function(t,e){var n=M(t,"a","lessStrict"),r=M(e,"b","lessStrict");return Qe(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),mW=L({notEqual_:function(t,e){var n,r=M(t,"a","notEqual"),i=M(e,"b","notEqual");return n=St(r,i),r=n[0],i=n[1],Fe(r.shape,i.shape),B.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),gW=L({notEqualStrict_:function(t,e){var n=M(t,"a","notEqualStrict"),r=M(e,"b","notEqualStrict");return Qe(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function yC(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function _C(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var t_=L({gather_:function(t,e,n){n===void 0&&(n=0);var r=M(t,"x","gather"),i=M(e,"indices","gather","int32");n=qt(n,r.shape)[0];var o=function(s,a,u){for(var l=s.shape[u],c=[],h=1,f=1,d=0;d<u;d++)c.push(s.shape[d]),h*=s.shape[d];for(d=0;d<a.rank;d++)c.push(a.shape[d]);for(d=u+1;d<s.rank;d++)c.push(s.shape[d]),f*=s.shape[d];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}}(r,i,n);return B.runKernelFunc(function(s,a){var u=s.gather(r,i.flatten(),n);return a([i]),u},{x:r,indices:i},function(s,a){var u=a[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,n),f=h.length,d=l.slice(n,l.length).slice(1),m=d.length,v=yC(0,f),y=yC(f+1,f+1+m),g=_C([h,[c],d]),_=s.reshape(g),w=u.reshape([c]),x=_C([[f],v,y]),S=_.transpose(x),A=hk(S,w,r.shape[n]),T=U1(x);return A=A.transpose(T)},indices:function(){return u}}},"Gather",{axis:n}).reshape(o.outputShape)}}),hk=L({unsortedSegmentSum_:function(t,e,n){var r=M(t,"x","unsortedSegmentSum"),i=M(e,"segmentIds","unsortedSegmentSum","int32");return O(Dt(n),function(){return"numSegments must be of dtype int"}),B.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,n);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,l){for(var c=e_(l,$e(l)),h=t_(u,c),f=ck(l,se(0,"int32")),d=h.rank-f.rank,m=0;m<d;++m)f=Tr(f,m+1);f=Yp(f,Hu(h.shape,"bool"));var v=$e(h);return Ys(f,h,v)}(o,a)}}})}}),vW=function(t,e,n){return he(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h,f,d,m,v;return fe(this,function(y){switch(y.label){case 0:for(r=M(t,"tensor","boolMask"),i=M(e,"mask","boolMask","bool"),o=n??0,s=i.rank,a=r.shape,O(s>0,function(){return"mask cannot be scalar"}),Qe(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+s;l++)u*=a[l];return c=a.slice(0,o).concat([u],a.slice(o+s)),h=r.reshape(c),f=i.reshape([-1]),[4,sk(f)];case 1:return d=y.sent(),m=d.squeeze([1]),v=t_(h,m,o),t!==r&&r.dispose(),e!==i&&i.dispose(),m.dispose(),h.dispose(),f.dispose(),d.dispose(),[2,v]}})})};function fk(t,e,n,r,i,o,s){o===void 0&&(o="NHWC"),O(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var a=t,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,t[0],t[1],t[2]]),O(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),O(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),O(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?u.shape[3]:u.shape[1];O(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),O(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),s!=null&&O(Dt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var f=G1(o),d=fa(a,n.shape,r,1,i,s,!1,f),m=B.runKernelFunc(function(v,y){var g=v.conv2dDerInput(u,n,d);return y([n,u]),g},{dy4D:u,filter:n},function(v,y){var g=y[0],_=y[1];return{dy4D:function(){return Fr(v,g,r,i,o,1,s)},filter:function(){return n_(v,_,g.shape,r,i,o,s)}}});return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function zg(t){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(t),n=e[0],r=e[1],i=e[2];return n===1&&r===1&&i===1}function dk(t,e,n,r,i){O(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var o=t,s=e,a=!1;e.rank===4&&(a=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,t[0],t[1],t[2],t[3]]);var u=o[4],l=s.shape[4];O(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),O(s.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),O(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),O(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),O(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Wd(o,n.shape,r,1,i),h=B.runKernelFunc(function(f){return f.conv3dDerInput(s,n,c)},{dy5D:s});return a?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var yW=L({conv1d_:function(t,e,n,r,i,o,s){i===void 0&&(i="NWC"),o===void 0&&(o=1);var a=M(t,"x","conv1d"),u=M(e,"filter","conv1d"),l=a,c=!1;a.rank===2&&(c=!0,l=a.as3D(1,a.shape[0],a.shape[1])),O(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),O(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),s!=null&&O(Dt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),O(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),O(ir(n,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"}),O(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=Fr(f,h,[1,n],r,"NHWC",[1,o],s);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Fr=L({conv2d_:function(t,e,n,r,i,o,s){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var a=M(t,"x","conv2d"),u=M(e,"filter","conv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),O(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),O(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),s!=null&&O(Dt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var h=i==="NHWC"?l.shape[3]:l.shape[1];O(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),O(ir(n,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"});var f=G1(i),d=fa(l.shape,u.shape,n,o,r,s,!1,f),m=[u,l],v=B.runKernelFunc(function(y,g){var _=y.conv2d(l,u,d);return g([u,l]),_},{x:l,filter:u},function(y,g){var _=g,w=_[0],x=_[1];return O(Pu(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return pk(x.shape,y,w,n,r,i)},filter:function(){return n_(x,y,w.shape,n,r,i)}}},"Conv2D",d,m);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),_W=L({conv3d_:function(t,e,n,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var s=M(t,"x","conv3d"),a=M(e,"filter","conv3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),O(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),O(a.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),O(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),O(function(f,d){return zg(f)||zg(d)}(n,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),O(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=Wd(u.shape,a.shape,n,o,r),h=B.runKernelFunc(function(f,d){var m=f.conv3d(u,a,c);return d([u,a]),m},{x:u,$filter:a},function(f,d){O(zg(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var m=d[0],v=d[1];return{x:function(){return dk(m.shape,f,v,n,r)},$filter:function(){return function(y,g,_,w,x){var S=y;y.rank===4&&(S=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var A=g;A.rank===4&&(A=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),O(S.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+S.shape+"."}),O(A.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+A.shape+"."}),O(_.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+_+"."}),O(S.shape[4]===_[3],function(){return"Error in conv3dDerFilter: depth of input "+S.shape[4]+") must match input depth in filter ("+_[3]+"."}),O(A.shape[4]===_[4],function(){return"Error in conv3dDerFilter: depth of dy ("+A.shape[4]+") must match output depth for filter ("+_[4]+")."});var T=Wd(S.shape,_,w,1,x);return B.runKernelFunc(function(E){return E.conv3dDerFilter(S,A,T)},{x5D:S,dy5D:A})}(m,f,v.shape,n,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),n_=L({conv2dDerFilter_:function(t,e,n,r,i,o,s){o===void 0&&(o="NHWC");var a=t;t.rank===3&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),O(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),O(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),O(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l=o==="NHWC"?a.shape[3]:a.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];O(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),O(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),s!=null&&O(Dt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var h=G1(o),f=fa(a.shape,n,r,1,i,s,!1,h);return B.runKernelFunc(function(d){return d.conv2dDerFilter(a,u,f)},{x4D:a,dy4D:u})}}),pk=L({conv2dDerInput_:fk}),Qp=L({depthwiseConv2d_:function(t,e,n,r,i,o,s){o===void 0&&(o=[1,1]);var a=M(t,"x","depthwiseConv2d"),u=M(e,"filter","depthwiseConv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),O(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),O(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),O(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),O(ir(n,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),s!=null&&O(Dt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var h=fa(l.shape,u.shape,n,o,r,s,!0),f=[l,u],d=B.runKernelFunc(function(m,v){var y=m.depthwiseConv2D(l,u,h);return v([l,u]),y},{x:l,filter:u},function(m,v){O(Pu(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var y=v[0],g=v[1];return{x:function(){return mk(y.shape,m,g,h)},filter:function(){return gk(y,m,g.shape,h)}}},"DepthwiseConv2dNative",h,f);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),mk=L({depthwiseConv2dDerInput_:function(t,e,n,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=B.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),gk=L({depthwiseConv2dDerFilter_:function(t,e,n,r){var i=t;t.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),B.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),r_=L({separableConv2d_:function(t,e,n,r,i,o,s){o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC");var a=M(t,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),l=M(n,"pointwiseFilter","separableConv2d"),c=a,h=!1;if(a.rank===3&&(h=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),O(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),O(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),O(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),O(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],d=u.shape[3];O(l.shape[2]===f*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+l.shape[2]+"."});var m=Qp(c,u,r,i,s,o),v=Fr(m,l,1,"valid",s);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),wW=L({conv2dTranspose_:function(t,e,n,r,i,o){return fk(n,M(t,"x","conv2dTranspose"),M(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),xW=L({conv3dTranspose_:function(t,e,n,r,i){return dk(n,M(t,"x","conv3dTranspose"),M(e,"filter","conv3dTranspose"),r,i)}}),Jp=L({matMul_:function(t,e,n,r){var i;n===void 0&&(n=!1),r===void 0&&(r=!1);var o=M(t,"a","matMul"),s=M(e,"b","matMul");i=St(o,s),o=i[0],s=i[1];var a=n?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],l=n?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?s.shape[s.rank-2]:s.shape[s.rank-1],h=o.shape.slice(0,-2),f=s.shape.slice(0,-2),d=pe(h),m=pe(f);O(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),O(rn(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),O(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=o.shape.slice(0,-2).concat([l,c]),y=n?o.as3D(d,a,l):o.as3D(d,l,a),g=r?s.as3D(m,c,u):s.as3D(m,u,c),_={transposeA:n,transposeB:r};return B.runKernelFunc(function(w,x){var S=w.batchMatMul(y,g,n,r);return x([y,g]),S},{a:y,b:g},function(w,x){var S=x,A=S[0],T=S[1];return n||r?!n&&r?{a:function(){return w.matMul(T,!1,!1)},b:function(){return w.matMul(A,!0,!1)}}:n&&!r?{a:function(){return T.matMul(w,!1,!0)},b:function(){return A.matMul(w,!1,!1)}}:{a:function(){return T.matMul(w,!0,!0)},b:function(){return w.matMul(A,!0,!0)}}:{a:function(){return w.matMul(T,!1,!0)},b:function(){return A.matMul(w,!0,!1)}}},"BatchMatMul",_).reshape(v)}}),bW=L({dot_:function(t,e){var n=M(t,"t1","dot"),r=M(e,"t2","dot");O(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var i=n.rank===1?n.size:n.shape[1],o=r.rank===1?r.size:r.shape[0];return O(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),EW=L({outerProduct_:function(t,e){var n=M(t,"v1","outerProduct"),r=M(e,"v2","outerProduct");return O(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),ch=L({reverse_:function(t,e){var n=M(t,"x","reverse");if(n.rank===0)return n.clone();var r=qt(e,n.shape);return B.runKernelFunc(function(i){return i.reverse(n,r)},{$x:n},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(n)}}),CW=L({reverse1d_:function(t){var e=M(t,"x","reverse");return O(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),ch(e,0)}}),SW=L({reverse2d_:function(t,e){var n=M(t,"x","reverse");return O(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),ch(n,e)}}),TW=L({reverse3d_:function(t,e){var n=M(t,"x","reverse");return O(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),ch(n,e)}}),IW=L({reverse4d_:function(t,e){var n=M(t,"x","reverse");return O(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),ch(n,e)}});function vk(t,e,n,r,i,o){var s=M(t,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(a.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),O(ir(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),o!=null&&O(Dt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Fc(a.shape,e,n,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&rn(l.inShape,l.outShape))return s.clone();var c=[a],h=B.runKernelFunc(function(f,d){var m=f.maxPool(a,l);return d([a,m]),m},{x:a},function(f,d){var m=d[0],v=d[1];return{x:function(){return function(y,g,_,w,x,S,A,T){var E=M(y,"dy","maxPoolBackprop"),C=M(g,"input","maxPoolBackprop"),I=M(_,"output","maxPoolBackprop");O(C.rank===E.rank,function(){return"Rank of input ("+C.rank+") does not match rank of dy ("+E.rank+")"}),O(ir(x,S),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+S+"'"}),O(E.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),O(C.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+C.rank+"."});var P=Fc(C.shape,w,x,S,A,T);return B.runKernelFunc(function(N){return N.maxPoolBackprop(E,C,I,P)},{$dy:E,$input:C})}(f,m,v,e,n,r,i)}}},"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function yk(t,e,n,r,i,o){var s=M(t,"x","avgPool","float32");O(ir(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(a.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),o!=null&&O(Dt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Fc(a.shape,e,n,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&rn(l.inShape,l.outShape))return s.clone();var c=B.runKernelFunc(function(h){return h.avgPool(a,l)},{x:a},function(h){return{x:function(){return function(f,d,m,v,y,g){var _=M(f,"dy","avgPoolBackprop"),w=M(d,"input","avgPoolBackprop");O(w.rank===_.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+_.rank+")"}),O(ir(v,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+y+"'"});var x=w,S=_,A=!1;w.rank===3&&(A=!0,x=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),S=_.as4D(1,_.shape[0],_.shape[1],_.shape[2])),O(S.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),O(x.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+x.rank+"."});var T=Fc(x.shape,m,v,y,g),E=B.runKernelFunc(function(C){return C.avgPoolBackprop(S,x,T)},{dy4D:S,input4D:x});return A?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(h,a,e,n,r,i)}}},"AvgPool",l);return c=c.cast(s.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Xt=L({maxPool_:function(t,e,n,r,i){return vk(t,e,n,1,r,i)}}),hh=L({avgPool_:function(t,e,n,r,i){return yk(t,e,n,1,r,i)}}),RW=L({pool_:function(t,e,n,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var s=M(t,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(ir(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=Fc(a.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(x,S){var A=x.map(function(C,I){return C+(C-1)*(S[I]-1)}).map(function(C){return C-1}),T=A.map(function(C){return Math.floor(C/2)}),E=A.map(function(C,I){return C-T[I]});return A.map(function(C,I){return[T[I],E[I]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,d=function(x,S,A){var T=A.map(function(j){return j[0]}),E=A.map(function(j){return j[1]}),C=x.concat(T,E),I=S.map(function(j,W){return(j-C[W]%j)%j}),P=E.map(function(j,W){return j+I[W]}),N=S.map(function(j,W){return[T[W],P[W]]}),k=S.map(function(j,W){return[0,I[W]]});return[N,k]}([c.inHeight,c.inWidth],h,l),m=d[0],v=d[1],y=f?r:"valid",g=f?a:CA(a,h,m),_=(n==="avg"?function(){return yk(g,e,o,1,y)}:function(){return vk(g,e,o,1,y)})(),w=f?_:xA(_,h,v);return u?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),AW=L({maxPool3d_:function(t,e,n,r,i,o,s){o===void 0&&(o="NDHWC");var a=M(t,"x","maxPool3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),O(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),O(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),O(ir(n,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),i!=null&&O(Dt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=Ud(u.shape,e,n,s,r,i,o),h=B.runKernelFunc(function(f,d){var m=f.maxPool3d(u,c);return d([u,m]),m},{x:u},function(f,d){var m=d[0],v=d[1];return{x:function(){return function(y,g,_,w,x,S,A,T){var E=M(y,"dy","maxPool3dBackprop"),C=M(g,"input","maxPool3dBackprop"),I=M(_,"output","maxPool3dBackprop"),P=E,N=C,k=I,j=!1;C.rank===4&&(j=!0,P=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),N=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),k=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3])),O(P.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+P.rank+"."}),O(N.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+N.rank+"."}),O(k.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+k.rank+"."}),S==null&&(S=[1,1,1]),O(ir(x,S),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+S+"'"}),T!=null&&O(Dt(A),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+A+"."});var W=Ud(N.shape,w,x,S,A,T),q=B.runKernelFunc(function(X){return X.maxPool3dBackprop(P,N,k,W)},{dy5D:P,input5D:N});return j?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q}(f,m,v,e,n,s,r,i)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),kW=L({avgPool3d_:function(t,e,n,r,i,o,s){o===void 0&&(o="NDHWC");var a=M(t,"x","avgPool3d","float32"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),O(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),O(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),O(ir(n,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),i!=null&&O(Dt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=Ud(u.shape,e,n,s,r,i,o),h=B.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(d,m,v,y,g,_,w){var x=M(d,"dy","avgPool3dBackprop"),S=M(m,"input","avgPool3dBackprop"),A=x,T=S,E=!1;S.rank===4&&(E=!0,A=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]),T=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),O(A.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."}),O(T.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),g==null&&(g=[1,1,1]),O(ir(y,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+g+"'"}),w!=null&&O(Dt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+_+"."});var C=Ud(T.shape,v,y,g,_,w),I=B.runKernelFunc(function(P){return P.avgPool3dBackprop(A,T,C)},{dy5D:A,input5D:T});return E?I.as4D(I.shape[1],I.shape[2],I.shape[3],I.shape[4]):I}(f,u,e,n,s,r,i)}}});return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),bi=L({slice_:function(t,e,n){var r,i,o=M(t,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){O(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=n==null?new Array(o.rank).fill(-1):typeof n=="number"?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(u,l){return u>=0?u:(O(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),i5(o,r,i);var s=o.shape,a={begin:r,size:i};return B.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],s[c]-r[c]-i[c]]);return{x:function(){return u.pad(l)}}},"Slice",a)}}),PW=L({slice1d_:function(t,e,n){var r=M(t,"x","slice1d");return O(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,[e],[n])}}),NW=L({slice2d_:function(t,e,n){var r=M(t,"x","slice2d");return O(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,e,n)}}),_k=L({slice3d_:function(t,e,n){var r=M(t,"x","slice3d");return O(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,e,n)}}),DW=L({slice4d_:function(t,e,n){var r=M(t,"x","slice4d");return O(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,e,n)}});function wk(t,e,n,r,i){return e.rank<n.rank&&(e=e.reshape(rr(e.shape,r))),t.rank<n.rank&&(t=t.reshape(rr(t.shape,r))),{x:function(){var o=t.mul(n.equal(e).cast(t.dtype));return i==null?o:o.transpose(i)}}}var MW=L({all_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","all","bool"),i=qt(e,r.shape),o=i,s=Ti(o,r.rank);s!=null&&(r=r.transpose(s),o=Ii(o.length,r.rank));var a=B.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(n){var u=rr(a.shape,i);return a.reshape(u)}return a}}),FW=L({any_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","any","bool"),i=qt(e,r.shape),o=i,s=Ti(o,r.rank);s!=null&&(r=r.transpose(s),o=Ii(o.length,r.rank));var a=B.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(n){var u=rr(a.shape,i);return a.reshape(u)}return a}}),OW=L({argMax_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","argMax");e==null&&(e=0);var r=qt(e,n.shape),i=Ti(r,n.rank);i!=null&&(n=n.transpose(i),r=Ii(r.length,n.rank));var o={axis:r[0]},s=[n];return B.runKernelFunc(function(a,u){var l=a.argMax(n,r[0]);return u([n]),l},{x:n},function(a,u){var l=u[0];return{x:function(){return $e(l)}}},"ArgMax",o,s)}}),LW=L({argMin_:function(t,e){e===void 0&&(e=0);var n=M(t,"x","argMin");e==null&&(e=0);var r=qt(e,n.shape),i=Ti(r,n.rank);return i!=null&&(n=n.transpose(i),r=Ii(r.length,n.rank)),B.runKernelFunc(function(o,s){var a=o.argMin(n,r[0]);return s([n]),a},{$x:n},function(o,s){var a=s[0];return{$x:function(){return $e(a)}}})}}),VW=L({logSumExp_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","logSumExp"),i=qt(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(n){var u=rr(a.shape,i);return a.reshape(u)}return a}}),Zp=L({max_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","max"),i=r,o=qt(e,r.shape),s=o,a=Ti(s,r.rank);a!=null&&(r=r.transpose(a),s=Ii(s.length,r.rank));var u=[r],l=B.runKernelFunc(function(h,f){var d=h.max(r,s);return f([i,d]),d},{x:r},function(h,f){return wk(h,f[1],f[0],o,a)},"Max",{axes:s},u,[!0]);if(n){var c=rr(l.shape,o);l=l.reshape(c)}return l}}),BW=L({mean_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","mean"),i=qt(e,r.shape),o=pe(wn(r.shape,i)[1]);return Kp(function(s){var a=se(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,n),gradFunc:function(u){var l=s.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Hu(s.shape,"float32")).div(o)}}})(r)}}),jW=L({min_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","min"),i=r,o=qt(e,r.shape),s=o,a=Ti(s,r.rank);a!=null&&(r=r.transpose(a),s=Ii(s.length,r.rank));var u=[r],l=B.runKernelFunc(function(h,f){var d=h.min(r,s);return f([i,d]),d},{x:r},function(h,f){return wk(h,f[1],f[0],o,a)},"Min",{axes:s},u,[!0]);if(n){var c=rr(l.shape,o);l=l.reshape(c)}return l}}),UW=L({moments_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=qt(e,(t=M(t,"x","moments")).shape),i=t.mean(r,n),o=i.shape;n||(o=rr(i.shape,r));var s=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,n)}}}),xk=L({sum_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=qt(e,r.shape);return Kp(function(o){var s=Ti(i,o.rank),a=i,u=o;s!=null&&(u=o.transpose(s),a=Ii(a.length,o.rank));var l=function(d){var m=o.shape.slice();return i.forEach(function(v){m[v]=1}),d.reshape(m).mul(Hu(o.shape,"float32"))},c={axes:a},h=B.runKernelFunc(function(d){return d.sum(u,a)},{x:u},function(d){return{x:function(){return l(d)}}},"Sum",c);if(n){var f=rr(h.shape,i);h=h.reshape(f)}return{value:h,gradFunc:l}})(r)}}),WW=L({prod_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=M(t,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=qt(e,r.shape),o=Ti(i,r.rank),s=i,a=r;o!=null&&(a=r.transpose(o),s=Ii(s.length,r.rank));var u=B.runKernelFunc(function(c){return c.prod(a,s)},{permutedX:a});if(n){var l=rr(u.shape,i);u=u.reshape(l)}return u}}),bk=L({elu_:function(t){var e=M(t,"x","elu");return B.runKernelFunc(function(n,r){var i=n.elu(e);return r([i]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return B.runKernelFunc(function(o){return o.eluDer(n,i)},{dy:n,y:i})}}})}}),zW=L({leakyRelu_:function(t,e){e===void 0&&(e=.2);var n=M(t,"x","leakyRelu");return e_(se(e).mul(n),n)}}),Ek=L({prelu_:function(t,e){var n=M(t,"x","prelu"),r=M(e,"alpha","prelu");return B.runKernelFunc(function(i,o){var s=i.prelu(n,r);return o([n,r]),s},{x:n,alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{x:function(){return Ys(u,i,i.mul(a))},alpha:function(){var l=Ys(u,$e(i),i.mul(s)),c=Ht(a.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}},"Prelu")}}),bt=L({relu_:function(t){var e=M(t,"x","relu");return e.dtype==="bool"?e.toInt():B.runKernelFunc(function(n,r){var i=n.relu(e);return r([e]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mulStrict(i.step().toFloat())}}},"Relu")}}),Ck=L({relu6_:function(t){var e=M(t,"x","relu6");return e.dtype==="bool"?e.toInt():B.runKernelFunc(function(n,r){var i=n.relu6(e);return r([e]),i},{x:e},function(n,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return n.mulStrict(o.toFloat())}}},"Relu6")}}),$W=L({selu_:function(t){var e=M(t,"x","selu");return B.runKernelFunc(function(n,r){var i=n.selu(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){var o=i.greater(se(0)),s=se(Q1),a=se(J1),u=n.mul(a),l=n.mul(s).mul(i.toFloat().exp());return Ys(o,u,l)}}})}}),Jo=L({transpose_:function(t,e){var n=M(t,"x","transpose");if(e==null&&(e=n.shape.map(function(i,o){return o}).reverse()),O(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(i){O(i>=0&&i<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1)return n.clone();var r={perm:e};return B.runKernelFunc(function(i){return i.transpose(n,e)},{x:n},function(i){var o=U1(e);return{x:function(){return i.transpose(o)}}},"Transpose",r)}}),HW=L({localResponseNormalization_:function(t,e,n,r,i){e===void 0&&(e=5),n===void 0&&(n=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=M(t,"x","localResponseNormalization");O(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),O(Dt(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=o,a=!1;o.rank===3&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=B.runKernelFunc(function(l,c){var h=l.localResponseNormalization4D(s,e,n,r,i);return c([s,h]),h},{x4D:s},function(l,c){var h=c[0],f=c[1];return{x4D:function(){return B.runKernelFunc(function(d){return d.LRNGrad(l,h,f,e,n,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Sk=L({norm_:function(t,e,n,r){e===void 0&&(e="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var i=function a(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return a(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(se(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(t=M(t,"x","norm"),e,n),o=i.shape;if(r){var s=qt(n,t.shape);o=rr(i.shape,s)}return i.reshape(o)}}),GW=L({basicLSTMCell_:function(t,e,n,r,i,o){var s=M(t,"forgetBias","basicLSTMCell"),a=M(e,"lstmKernel","basicLSTMCell"),u=M(n,"lstmBias","basicLSTMCell"),l=M(r,"data","basicLSTMCell"),c=M(i,"c","basicLSTMCell"),h=M(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(a).add(u),d=f.shape[0],m=f.shape[1]/4,v=[d,m],y=f.slice([0,0],v),g=f.slice([0,m],v),_=f.slice([0,2*m],v),w=f.slice([0,3*m],v),x=y.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(s.add(_).sigmoid())),S=x.tanh().mulStrict(w.sigmoid());return[x,S]}}),qW=L({multiRNNCell_:function(t,e,n,r){for(var i=M(e,"data","multiRNNCell"),o=Fd(n,"c","multiRNNCell"),s=Fd(r,"h","multiRNNCell"),a=i,u=[],l=0;l<t.length;l++){var c=t[l](a,o[l],s[l]);u.push(c[0]),u.push(c[1]),a=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),KW=L({movingAverage_:function(t,e,n,r,i){i===void 0&&(i=!0);var o=M(t,"v","movingAverage"),s=M(e,"x","movingAverage"),a=M(n,"decay","movingAverage");HB(o,s),O(rn(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=se(1),l=u.sub(a),c=s.sub(o).mul(l);if(i){O(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=M(r,"step","movingAverage");c=c.div(u.sub(Hd(a,h)))}return o.add(c)}}),XW=L({stridedSlice_:function(t,e,n,r,i,o,s,a,u){if(i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var l=M(t,"x","stridedSlice"),c=JE(a),h=l.shape.slice();c.forEach(function(y){e[y]=0,n[y]=1,h.splice(y,0,1)}),l=l.reshape(h);for(var f=0;f<l.rank;f++)e[f]=o5(i,e,r,l.shape,f),n[f]=s5(o,n,r,l.shape,f),r[f]=r[f]||1;var d=JE(u);d.forEach(function(y){n[y]=e[y]+1,r[y]=1});var m=H1(e,n,r),v=m.filter(function(y,g){return d.indexOf(g)===-1});return r.every(function(y){return y===1})?bi(l,e,m).reshape(v):B.runKernelFunc(function(y){return y.stridedSlice(l,e,n,r)},{$x:l}).reshape(v)}}),YW=L({topk_:function(t,e,n){e===void 0&&(e=1),n===void 0&&(n=!0);var r=M(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=B.runKernelFunc(function(s){return s.topk(r,e,n)},{$x:r});return{values:o[0],indices:o[1]}}}),QW=L({scatterND_:function(t,e,n){var r=M(t,"indices","scatterND","int32"),i=M(e,"updates","scatterND");return r5(i,r,n),B.runKernelFunc(function(o){return o.scatterND(r,i,n)},{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),i_=L({fft_:function(t){O(t.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return B.runKernelFunc(function(i){return i.fft(r)},{input:t}).reshape(t.shape)}}),Gd=L({ifft_:function(t){O(t.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return B.runKernelFunc(function(i){return i.ifft(r)},{input:t}).reshape(t.shape)}}),o_=L({rfft_:function(t,e){O(t.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],i=t.size/r;if(e!=null&&e<r){var o=t.shape.map(function(g){return 0}),s=t.shape.map(function(g){return g});s[t.shape.length-1]=e,n=t.slice(o,s),r=e}else if(e!=null&&e>r){var a=t.shape.map(function(g){return g});a[t.shape.length-1]=e-r,n=t.concat(ct(a),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),l=an(n,u).as2D(i,r),c=i_(l),h=Math.floor(r/2)+1,f=Ir(c),d=di(c),m=f.split([h,r-h],f.shape.length-1),v=d.split([h,r-h],d.shape.length-1),y=n.shape.slice();return y[n.shape.length-1]=h,an(m[0],v[0]).reshape(y)}}),Tk=L({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),i=Gd(r);return Ir(i)}var o=[n,2*(e-1)],s=Ir(t).as2D(n,e),a=di(t).as2D(n,e),u=s.slice([0,1],[n,e-2]).reverse(1),l=a.slice([0,1],[n,e-2]).reverse(1).mul(se(-1)),c=s.concat(u,1),h=a.concat(l,1);return r=an(c,h).as2D(o[0],o[1]),i=Gd(r),Ir(i)}}),JW=Object.freeze({fft:i_,ifft:Gd,rfft:o_,irfft:Tk}),ZW=L({sparseToDense_:function(t,e,n,r){r===void 0&&(r=0);var i=M(t,"sparseIndices","sparseToDense","int32"),o=M(e,"sparseValues","sparseToDense"),s=M(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,l,c){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var h=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var d=u.size;if(u.rank!==0&&(u.rank!==1||d!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,s),B.runKernelFunc(function(a){return a.sparseToDense(i,o,n,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),ez=L({gatherND_:function(t,e){var n=M(e,"indices","gatherND","int32"),r=M(t,"x","gatherND");return B.runKernelFunc(function(i){return i.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),tz=L({diag_:function(t){var e=M(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return B.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(n)}}),nz=L({dropout_:function(t,e,n,r){var i=M(t,"x","dropout");if(O(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),O(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return t instanceof _t?i.clone():i;var o=function(u,l){if(l==null)return u.shape.slice();if(rn(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l}(i,n),s=1-e,a=EA(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function Ik(t,e,n){for(var r=1-t%2,i=new Float32Array(t),o=0;o<t;++o){var s=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(s)}return Lt(i,"float32")}var s_=L({hannWindow_:function(t){return Ik(t,.5,.5)}}),Rk=L({hammingWindow_:function(t){return Ik(t,.54,.46)}}),a_=L({frame_:function(t,e,n,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,s=[];o+e<=t.size;)s.push(bi(t,o,e)),o+=n;if(r)for(;o<t.size;){var a=o+e-t.size,u=zt([bi(t,o,e-a),xi([a],i)]);s.push(u),o+=n}return s.length===0?Bo([],[0,e]):zt(s).as2D(s.length,e)}}),Ak=L({stft_:function(t,e,n,r,i){var o;i===void 0&&(i=s_),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var s=a_(t,e,n),a=An(s,i(e)),u=[],l=0;l<s.shape[0];l++)u.push(o_(a.slice([l,0],[1,e]),r));return zt(u)}}),rz=Object.freeze({hannWindow:s_,hammingWindow:Rk,frame:a_,stft:Ak}),Rn,iz=function(t,e,n){return n===void 0&&(n=1),he(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h,f,d,m,v,y;return fe(this,function(g){switch(g.label){case 0:return r=M(t,"predictions","inTopK"),i=M(e,"targets","inTopK"),O(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),O(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Qe(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],O(n>0&&n<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+n}),[4,r.data()];case 1:return s=g.sent(),[4,i.data()];case 2:for(a=g.sent(),u=[s.length/o,o],c=u[1],h=Nc("bool",l=u[0]),f=0;f<l;f++){for(d=f*c,m=s.subarray(d,d+c),v=[],y=0;y<m.length;y++)v.push({value:m[y],index:y});for(v.sort(function(_,w){return w.value-_.value}),h[f]=0,y=0;y<n;y++)if(v[y].index===a[f]){h[f]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),[2,cn(h,i.shape,"bool")]}})})};(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Rn||(Rn={}));var oz=L({absoluteDifference_:function(t,e,n,r){r===void 0&&(r=Rn.SUM_BY_NONZERO_WEIGHTS);var i=M(t,"labels","absoluteDifference"),o=M(e,"predictions","absoluteDifference"),s=null;n!=null&&(s=M(n,"weights","absoluteDifference")),Qe(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return io(a,s,r)}}),io=L({computeWeightedLoss_:function(t,e,n){n===void 0&&(n=Rn.SUM_BY_NONZERO_WEIGHTS);var r=M(t,"losses","computeWeightedLoss"),i=null;e!=null&&(i=M(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(n===Rn.NONE)return o;if(n===Rn.SUM)return o.sum();if(n===Rn.MEAN){if(i==null)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(se(s)):a}if(n===Rn.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(se(r.size));var u=i.mul(Hu(r.shape)).notEqual(se(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+n)}}),sz=L({cosineDistance_:function(t,e,n,r,i){i===void 0&&(i=Rn.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"labels","cosineDistance"),s=M(e,"predictions","cosineDistance"),a=null;r!=null&&(a=M(r,"weights","cosineDistance")),Qe(o.shape,s.shape,"Error in cosineDistance: ");var u=se(1).sub(o.mul(s).sum(n,!0));return io(u,a,i)}}),az=L({hingeLoss_:function(t,e,n,r){r===void 0&&(r=Rn.SUM_BY_NONZERO_WEIGHTS);var i=M(t,"labels","hingeLoss"),o=M(e,"predictions","hingeLoss"),s=null;n!=null&&(s=M(n,"weights","hingeLoss")),Qe(i.shape,o.shape,"Error in hingeLoss: ");var a=se(1);i=se(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return io(u,s,r)}}),uz=L({huberLoss_:function(t,e,n,r,i){r===void 0&&(r=1),i===void 0&&(i=Rn.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"labels","huberLoss"),s=M(e,"predictions","huberLoss"),a=null;n!=null&&(a=M(n,"weights","huberLoss")),Qe(o.shape,s.shape,"Error in huberLoss: ");var u=se(r),l=s.sub(o).abs(),c=uk(l,u),h=l.sub(c),f=se(.5).mul(c.square()).add(u.mul(h));return io(f,a,i)}}),lz=L({logLoss_:function(t,e,n,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Rn.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"labels","logLoss"),s=M(e,"predictions","logLoss"),a=null;n!=null&&(a=M(n,"weights","logLoss")),Qe(o.shape,s.shape,"Error in logLoss: ");var u=se(1),l=se(r),c=o.mul(s.add(l).log()).neg().sub(u.sub(o).mul(u.sub(s).add(l).log()));return io(c,a,i)}}),cz=L({meanSquaredError_:function(t,e,n,r){r===void 0&&(r=Rn.SUM_BY_NONZERO_WEIGHTS);var i=M(t,"labels","meanSquaredError"),o=M(e,"predictions","meanSquaredError"),s=null;n!=null&&(s=M(n,"weights","meanSquaredError")),Qe(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return io(a,s,r)}}),hz=L({sigmoidCrossEntropy_:function(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=Rn.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"multiClassLabels","sigmoidCrossEntropy"),s=M(e,"logits","sigmoidCrossEntropy"),a=null;if(n!=null&&(a=M(n,"weights","sigmoidCrossEntropy")),Qe(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=se(r),l=se(1),c=se(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=function(f,d){var m=M(f,"labels","sigmoidCrossEntropyWithLogits"),v=M(d,"logits","sigmoidCrossEntropyWithLogits");Qe(m.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=v.relu(),g=v.mul(m),_=v.abs().neg().exp().log1p();return y.sub(g).add(_)}(o,s);return io(h,a,i)}}),fz=L({softmaxCrossEntropy_:function(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=Rn.SUM_BY_NONZERO_WEIGHTS);var o=M(t,"onehotLabels","softmaxCrossEntropy"),s=M(e,"logits","softmaxCrossEntropy"),a=null;if(n!=null&&(a=M(n,"weights","softmaxCrossEntropy")),Qe(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=se(r),l=se(1),c=se(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=function(f,d,m){if(m===void 0&&(m=-1),m===-1&&(m=d.rank-1),m!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+m);return Kp(function(v,y,g){var _=y.logSumExp([m],!0),w=y.toFloat().sub(_);return g([v,w]),{value:w.mul(v).neg().sum([m]),gradFunc:function(x,S){var A=S[0],T=S[1],E=rr(x.shape,[m]);return[x.reshape(E).mul(A.toFloat().sub(T.exp())),x.reshape(E).mul(T.exp().sub(A.toFloat()))]}}})(f,d)}(o,s);return io(h,a,i)}}),dz=Object.freeze({get Reduction(){return Rn},absoluteDifference:oz,computeWeightedLoss:io,cosineDistance:sz,hingeLoss:az,huberLoss:uz,logLoss:lz,meanSquaredError:cz,sigmoidCrossEntropy:hz,softmaxCrossEntropy:fz});function wC(t,e){return e===void 0&&(e=!1),B.tidy(function(){if(t.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=bA(n),o=t.clone(),s=Bo([[1]],[1,1]),a=s.clone(),u=n>=r?r:n,l=function(h){var f,d=o,m=a,v=i;f=B.tidy(function(){var y=o.slice([h,h],[n-h,1]),g=y.norm(),_=o.slice([h,h],[1,1]),w=Bo([[-1]]).where(_.greater(0),Bo([[1]])),x=_.sub(w.mul(g)),S=y.div(x);a=S.shape[0]===1?s.clone():s.concat(S.slice([1,0],[S.shape[0]-1,S.shape[1]]),0);var A=w.matMul(x).div(g).neg(),T=o.slice([h,0],[n-h,r]),E=A.mul(a);if(h===0)o=T.sub(E.matMul(a.transpose().matMul(T)));else{var C=T.sub(E.matMul(a.transpose().matMul(T)));o=o.slice([0,0],[h,r]).concat(C,0)}var I=i.slice([0,h],[n,i.shape[1]-h]);if(h===0)i=I.sub(I.matMul(a).matMul(E.transpose()));else{var P=I.sub(I.matMul(a).matMul(E.transpose()));i=i.slice([0,0],[n,h]).concat(P,1)}return[a,o,i]}),a=f[0],o=f[1],i=f[2],tr([d,m,v])},c=0;c<u;++c)l(c);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}var pz=L({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=M(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(n<=a))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+a+").");e<0&&(e=s),n<0&&(n=a);var u=Od(0,s,1,"int32").reshape([-1,1]),l=Od(0,a,1,"int32"),c=Gt(u,l),h=Yp(c.lessEqual(se(+e,"int32")),c.greaterEqual(se(-n,"int32"))),f=ct([s,a],r.dtype);return mr($t(r.reshape([-1,s,a])).map(function(d){return Ys(h,d,f)})).reshape(i)}}),mz=L({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,O(t!=null&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(u){O(t[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+n+")"})},i=1;i<t.length;++i)r(i)}else e=!0,t=z1(t,t.shape[0],0).map(function(u){return SA(u,[0])});O(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var o=[],s=t,a=function(u){o.push(B.tidy(function(){var l=s[u];if(u>0)for(var c=0;c<u;++c){var h=xk(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(Sk(l,"euclidean"))}))};for(i=0;i<t.length;++i)a(i);return e?mr(o,0):o}}),gz=L({qr_:function(t,e){if(e===void 0&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(t.rank===2)return wC(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(s,a){return s*a}),r=$t(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=wC(s,e),u=a[0],l=a[1];i.push(u),o.push(l)}),[mr(i,0).reshape(t.shape),mr(o,0).reshape(t.shape)]}}),vz=Object.freeze({bandPart:pz,gramSchmidt:mz,qr:gz});function em(t,e,n,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var s=t.shape[0];return n=Math.min(n,s),O(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),O(t.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),O(t.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),O(e.rank===1,function(){return"scores must be a 1D tensor"}),O(e.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]}),O(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var yz=L({resizeBilinear_:function(t,e,n){n===void 0&&(n=!1);var r=M(t,"images","resizeBilinear");O(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),O(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=B.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,s,a,n)},{x:i},function(l,c){return{x:function(){return B.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,c[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:s,newWidth:a});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),_z=L({resizeNearestNeighbor_:function(t,e,n){n===void 0&&(n=!1);var r=M(t,"images","resizeNearestNeighbor");O(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),O(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),O(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=B.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,s,a,n)},{batchImages:i},function(l,c){return{batchImages:function(){return B.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,c[0],n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),wz=L({nonMaxSuppression_:function(t,e,n,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=M(t,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),a=em(o,s,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return B.runKernelFunc(function(l){return l.nonMaxSuppression(o,s,n,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",u)}}),xz=function(t,e,n,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),he(this,void 0,void 0,function(){var o,s,a,u,l,c,h;return fe(this,function(f){switch(f.label){case 0:return o=M(t,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),a=em(o,s,n,r,i),n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],h=q1(l,c,n,r,i),o!==t&&o.dispose(),s!==e&&s.dispose(),[2,h]}})})},bz=L({nonMaxSuppressionWithScore_:function(t,e,n,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var s=M(t,"boxes","nonMaxSuppression"),a=M(e,"scores","nonMaxSuppression"),u=em(s,a,n,r,i,o),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=B.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),Ez=function(t,e,n,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),he(this,void 0,void 0,function(){var s,a,u,l,c,h,f;return fe(this,function(d){switch(d.label){case 0:return s=M(t,"boxes","nonMaxSuppressionAsync"),a=M(e,"scores","nonMaxSuppressionAsync"),u=em(s,a,n,r,i,o),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return l=d.sent(),c=l[0],h=l[1],f=K1(c,h,n,r,i,o),s!==t&&s.dispose(),a!==e&&a.dispose(),[2,f]}})})},Cz=L({cropAndResize_:function(t,e,n,r,i,o){var s=M(t,"image","cropAndResize"),a=M(e,"boxes","cropAndResize","float32"),u=M(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=a.shape[0];return O(s.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),O(a.rank===2&&a.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+a.shape+"."}),O(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+a.shape+"."}),O(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),O(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),O(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),B.runKernelFunc(function(c,h){return c.cropAndResize(s,a,u,r,i,o)},{images:s,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),u_=Object.freeze({resizeBilinear:yz,resizeNearestNeighbor:_z,nonMaxSuppression:wz,nonMaxSuppressionAsync:xz,nonMaxSuppressionWithScore:bz,nonMaxSuppressionWithScoreAsync:Ez,cropAndResize:Cz}),l_=function(t,e){return!(t>0)||e==="linear"},c_=function(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},h_=function(t,e){var n=e,r=Ht(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},f_=function(t,e,n){if(e==="linear")return t;if(e==="relu")return bt(t);if(e==="elu")return bk(t);if(e==="relu6")return Ck(t);if(e==="prelu")return Ek(t,n);throw new Error("Unknown fused activation "+e+".")},Sz=L({fusedMatMul_:function(t){var e,n=t.a,r=t.b,i=t.transposeA,o=i!==void 0&&i,s=t.transposeB,a=s!==void 0&&s,u=t.bias,l=t.activation,c=l===void 0?"linear":l,h=t.preluActivationWeights;if(l_(B.state.gradientDepth,c)===!1){var f=Jp(n,r,o,a);return u!=null&&(f=Me(f,u)),f_(f,c,h)}var d=M(n,"a","fused matMul"),m=M(r,"b","fused matMul");e=St(d,m),d=e[0],m=e[1];var v=o?d.shape[d.rank-2]:d.shape[d.rank-1],y=a?m.shape[m.rank-1]:m.shape[m.rank-2],g=o?d.shape[d.rank-1]:d.shape[d.rank-2],_=a?m.shape[m.rank-2]:m.shape[m.rank-1],w=d.shape.slice(0,-2),x=m.shape.slice(0,-2),S=pe(w),A=pe(x);O(d.rank>=2&&m.rank>=2&&d.rank===m.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+m.rank+"."}),O(rn(w,x),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+x+") of Tensors with shapes "+d.shape+" and "+m.shape+" must match."}),O(v===y,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+y+") of Tensors with shapes "+d.shape+" and "+m.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var T,E,C=d.shape.slice(0,-2).concat([g,_]),I=o?d.as3D(S,v,g):d.as3D(S,g,v),P=a?m.as3D(A,_,y):m.as3D(A,y,_);u!=null&&Fe(C,(T=St(T=M(u,"bias","fused matMul"),d)[0]).shape),h!=null&&(E=M(h,"prelu weights","fused matMul"));var N={a:I,b:P};u!=null&&(N.bias=T),h!=null&&(N.preluActivationWeights=E);var k=[I,P];return B.runKernelFunc(function(j,W){var q=j.fusedBatchMatMul({a:I,b:P,transposeA:o,transposeB:a,bias:T,activation:c,preluActivationWeights:E});return W([I,P,q]),q},N,function(j,W){var q=W[0],X=W[1],V=W[2],z=c_(j,V,c),U={};return u!=null&&(U={bias:function(){return h_(T,z)}}),Object.assign(o||a?!o&&a?{a:function(){return z.matMul(X,!1,!1)},b:function(){return z.matMul(q,!0,!1)}}:o&&!a?{a:function(){return X.matMul(z,!1,!0)},b:function(){return q.matMul(z,!1,!1)}}:{a:function(){return X.matMul(z,!0,!0)},b:function(){return z.matMul(q,!0,!0)}}:{a:function(){return z.matMul(X,!1,!0)},b:function(){return q.matMul(z,!0,!1)}},U)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:c},k,[!0]).reshape(C)}}),Tz=L({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,s=o===void 0?"NHWC":o,a=t.dilations,u=a===void 0?[1,1]:a,l=t.dimRoundingMode,c=t.bias,h=t.activation,f=h===void 0?"linear":h,d=t.preluActivationWeights;if(f=f||"linear",l_(B.state.gradientDepth,f)===!1){var m=Fr(e,n,r,i,s,u,l);return c!=null&&(m=Me(m,c)),f_(m,f,d)}var v=M(e,"x","conv2d"),y=M(n,"filter","conv2d"),g=v,_=!1;v.rank===3&&(_=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),O(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),O(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),l!=null&&O(Dt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),O(g.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),O(ir(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),O(s==="NHWC",function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var w,x,S=fa(g.shape,y.shape,r,u,i,l);c!=null&&(w=St(w=M(c,"bias","fused conv2d"),v)[0],Fe(S.outShape,w.shape)),d!=null&&(x=M(d,"prelu weights","fused conv2d"));var A={x:g,filter:y};c!=null&&(A.bias=w),d!=null&&(A.preluActivationWeights=x);var T=[y,g],E=B.runKernelFunc(function(C,I){var P=C.fusedConv2d({input:g,filter:y,convInfo:S,bias:w,activation:f,preluActivationWeights:x});return I([y,g,P]),P},A,function(C,I){var P=I,N=P[0],k=P[1],j=P[2],W=c_(C,j,f);O(Pu(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var q={};return c!=null&&(q={bias:function(){return h_(w,W)}}),Object.assign({x:function(){return pk(k.shape,W,N,r,i)},filter:function(){return n_(k,W,N.shape,r,i)}},q)},"FusedConv2D",{convInfo:S,activation:f},T,[!0]);return _?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Iz=L({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,s=o===void 0?"NHWC":o,a=t.dilations,u=a===void 0?[1,1]:a,l=t.dimRoundingMode,c=t.bias,h=t.activation,f=h===void 0?"linear":h,d=t.preluActivationWeights;if(l_(B.state.gradientDepth,f)===!1){var m=Qp(e,n,r,i,s,u,l);return c!=null&&(m=Me(m,c)),f_(m,f,d)}var v=M(e,"x","depthwiseConv2d"),y=M(n,"filter","depthwiseConv2d"),g=v,_=!1;v.rank===3&&(_=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),O(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),O(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),O(g.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),u==null&&(u=[1,1]),O(ir(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&O(Dt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var w,x,S=fa(g.shape,y.shape,r,u,i,l,!0);c!=null&&(w=St(w=M(c,"bias","fused conv2d"),v)[0],Fe(S.outShape,w.shape)),d!=null&&(x=M(d,"prelu weights","fused depthwiseConv2d"));var A={x:g,filter:y};c!=null&&(A.bias=w),d!=null&&(A.preluActivationWeights=x);var T=[y,g],E=B.runKernelFunc(function(C,I){var P=C.fusedDepthwiseConv2D({input:g,filter:y,convInfo:S,bias:w,activation:f,preluActivationWeights:x});return I([y,g,P]),P},A,function(C,I){O(Pu(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var P=I[0],N=I[1],k=I[2],j=c_(C,k,f),W={};return c!=null&&(W={bias:function(){return h_(w,j)}}),Object.assign({x:function(){return mk(N.shape,j,P,S)},filter:function(){return gk(N,j,P.shape,S)}},W)},"FusedDepthwiseConv2D",{convInfo:S,activation:f},T,[!0]);return _?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Rz=Object.freeze({matMul:Sz,conv2d:Tz,depthwiseConv2d:Iz}),Az=Object.freeze({image:u_,linalg:vz,losses:dz,spectral:JW,fused:Rz,signal:rz,square:lU,squaredDifference:JA,conv1d:yW,conv2d:Fr,conv3d:_W,depthwiseConv2d:Qp,separableConv2d:r_,conv2dTranspose:wW,conv3dTranspose:xW,op:L,batchNormalization2d:BU,batchNormalization3d:jU,batchNormalization4d:UU,batchNormalization:WU,batchNorm:ik,batchNorm2d:zU,batchNorm3d:$U,batchNorm4d:HU,booleanMaskAsync:vW,complex:an,real:Ir,imag:di,concat:zt,concat1d:R6,concat2d:A6,concat3d:k6,concat4d:P6,split:z1,matMul:Jp,dot:bW,outerProduct:EW,reverse:ch,reverse1d:CW,reverse2d:SW,reverse3d:TW,reverse4d:IW,maxPool:Xt,avgPool:hh,pool:RW,maxPool3d:AW,avgPool3d:kW,slice:bi,slice1d:PW,slice2d:NW,slice3d:_k,slice4d:DW,abs:cU,acos:hU,acosh:fU,asin:dU,asinh:pU,atan:mU,atanh:gU,ceil:vU,clipByValue:Z1,cos:yU,cosh:_U,erf:wU,exp:Oy,expm1:xU,floor:bU,log:EU,log1p:CU,logSigmoid:SU,neg:$d,reciprocal:TU,round:IU,rsqrt:ZA,sigmoid:ek,sign:RU,isNaN:AU,isInf:kU,isFinite:PU,sin:NU,sinh:DU,softplus:MU,sqrt:FU,step:OU,tan:LU,tanh:VU,all:MW,any:FW,argMax:OW,argMin:LW,logSumExp:VW,max:Zp,mean:BW,min:jW,moments:UW,sum:xk,prod:WW,equal:lk,equalStrict:aW,greater:uW,greaterEqual:ck,greaterEqualStrict:lW,greaterStrict:cW,less:hW,lessEqual:fW,lessEqualStrict:dW,lessStrict:pW,notEqual:mW,notEqualStrict:gW,add:Me,addN:KU,addStrict:XU,atan2:YU,div:jr,divNoNan:QU,divStrict:JU,floorDiv:ak,maximum:e_,maximumStrict:ZU,minimum:uk,minimumStrict:eW,mod:tW,modStrict:nW,mul:An,mulStrict:rW,pow:Hd,powStrict:iW,squaredDifferenceStrict:oW,sub:Gt,subStrict:sW,elu:bk,leakyRelu:zW,prelu:Ek,relu:bt,relu6:Ck,selu:$W,logicalAnd:Yp,logicalNot:GU,logicalOr:ok,logicalXor:qU,where:Ys,whereAsync:sk,buffer:Ae,print:j6,batchToSpaceND:xA,broadcastTo:U6,cast:W6,clone:z6,cumsum:$6,depthToSpace:H6,expandDims:Tr,eye:bA,multinomial:G6,oneHot:Ny,pad:ha,pad1d:q6,pad2d:K6,pad3d:X6,pad4d:Y6,rand:Q6,randomNormal:J6,randomGamma:Z6,randomUniform:EA,reshape:Hr,spaceToBatchND:CA,squeeze:SA,stack:mr,tile:uu,truncatedNormal:e5,unstack:$t,setdiff1dAsync:t5,fill:xi,linspace:I6,ones:Hu,range:Od,scalar:se,tensor:cn,tensor1d:Lt,tensor2d:Bo,tensor3d:W1,tensor4d:Kn,tensor5d:C6,tensor6d:S6,variable:T6,zeros:ct,onesLike:wA,zerosLike:$e,transpose:Jo,softmax:ro,logSoftmax:u5,localResponseNormalization:HW,norm:Sk,gather:t_,unsortedSegmentSum:hk,basicLSTMCell:GW,multiRNNCell:qW,movingAverage:KW,stridedSlice:XW,topk:YW,scatterND:QW,fft:i_,ifft:Gd,rfft:o_,irfft:Tk,sparseToDense:ZW,gatherND:ez,diag:tz,dropout:nz,hannWindow:s_,hammingWindow:Rk,frame:a_,stft:Ak,inTopKAsync:iz});function Z(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(n){n!=null&&O(n.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function $g(t,e,n,r){if(n==="linear")return t.linear(e);if(n==="relu")return t.relu(e);if(n==="elu")return t.elu(e);if(n==="relu6")return t.relu6(e);if(n==="prelu")return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var kz=function(t){function e(){var n=t.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new NA(n,B),n}return ei(e,t),e.prototype.write=function(n,r,i){this.firstUse&&(this.firstUse=!1,J().get("IS_NODE")&&Md(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:n,dtype:i}),o},e.prototype.move=function(n,r,i,o){this.data.set(n,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(n){return he(this,void 0,void 0,function(){return fe(this,function(r){return[2,this.readSync(n)]})})},e.prototype.readSync=function(n){var r=this.data.get(n),i=r.dtype,o=r.complexTensors;return i==="complex64"?Fy(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(n).values},e.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),i=r;if(n.dtype==="string")try{i=r.map(function(o){return Pd(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ae(n.shape,n.dtype,i)},e.prototype.makeOutput=function(n,r,i){var o=this.write(n,r,i);return B.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},e.prototype.time=function(n){return he(this,void 0,void 0,function(){var r;return fe(this,function(i){return r=ci(),n(),[2,{kernelMs:ci()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(n,r){var i=this.makeOutput(null,n.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:B.keep(n.clone()),imag:B.keep(r.clone())},i},e.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},e.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},e.prototype.slice=function(n,r,i){if(Z(n,"slice"),kA(n.shape,r,i)){var o=PA(r,n.strides),s=pe(i);return cn(this.readSync(n.dataId).subarray(o,o+s),i,n.dtype)}for(var a=Ae(i,n.dtype),u=this.bufferSync(n),l=0;l<a.size;++l){var c=a.indexToLoc(l).map(function(h,f){return h+r[f]});a.values[l]=u.get.apply(u,c)}return a.toTensor()},e.prototype.stridedSlice=function(n,r,i,o){Z(n,"stridedSlice");var s=H1(r,i,o);if(s.some(function(d){return d===0}))return cn([],s);for(var a=Ae(s,n.dtype),u=this.bufferSync(n),l=0;l<a.size;l++){for(var c=a.indexToLoc(l),h=new Array(c.length),f=0;f<h.length;f++)h[f]=c[f]*o[f]+r[f];a.set.apply(a,[u.get.apply(u,h)].concat(c))}return a.toTensor()},e.prototype.diag=function(n){for(var r=this.readSync(n.dataId),i=Ae([n.size,n.size],n.dtype),o=i.values,s=0;s<r.length;s++)o[s*n.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(n,r){for(var i=n.shape[r],o=new Array(n.rank-1),s=0,a=0;a<n.rank;a++)a!==r&&(o[s++]=n.shape[a]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(n,u,l).reshape(o);return c},e.prototype.reverse=function(n,r){Z(n,"reverse");for(var i=Ae(n.shape,n.dtype),o=this.bufferSync(n),s=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(h){return c[h]=n.shape[h]-1-c[h]}),i.set.apply(i,[o.get.apply(o,c)].concat(l))},a=0;a<i.size;a++)s(a);return i.toTensor()},e.prototype.concat=function(n,r){var i=this;if(n[0].dtype==="complex64"){var o=n.map(function(d){return Ir(d)}),s=n.map(function(d){return di(d)});return an(this.concat(o,r),this.concat(s,r))}var a=n.map(function(d){var m=pe(d.shape.slice(r));return d.as2D(-1,m)}),u=ku(a.map(function(d){return d.shape}),1),l=Ae(u,n[0].dtype).values;if(a[0].shape[0]===1){var c=0;a.forEach(function(d){l.set(i.readSync(d.dataId),c),c+=d.size})}else{var h=0;a.forEach(function(d){for(var m=i.readSync(d.dataId),v=0,y=0;y<d.shape[0];++y)for(var g=y*u[1]+h,_=0;_<d.shape[1];++_)l[g+_]=m[v++];h+=d.shape[1]})}var f=ku(n.map(function(d){return d.shape}),r);return cn(l,f,n[0].dtype)},e.prototype.neg=function(n){return Z(n,"neg"),this.multiply(se(-1),n)},e.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(n,r,un(n.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(n){var r=this;Z(n,"addN");for(var i=n.map(function(c){return r.readSync(c.dataId)}),o=Ae(n[0].shape,n[0].dtype),s=o.values,a=0;a<n.length;a++)for(var u=i[a],l=0;l<s.length;l++)s[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(n,r){var i=qt([r],n.shape),o=this.max(n,i),s=rr(o.shape,i),a=this.subtract(n,o.reshape(s)),u=this.exp(a),l=this.sum(u,i).reshape(s);return this.realDivide(u,l)},e.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(n,r,un(n.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(n,r){return Z([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(n,r,i,o){Z([n,r],"matMul");for(var s=i?n.shape[1]:n.shape[2],a=i?n.shape[2]:n.shape[1],u=o?r.shape[1]:r.shape[2],l=n.shape[0],c=this.readSync(n.dataId),h=this.readSync(r.dataId),f=i?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],d=f[0],m=f[1],v=f[2],y=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=y[0],_=y[1],w=y[2],x=a*u,S=Ae([l,a,u],n.dtype),A=S.values,T=this.blockSize,E=0;E<l;E++)for(var C=0;C<a;C+=T)for(var I=0;I<u;I+=T)for(var P=0;P<s;P+=T)for(var N=Math.min(C+T,a),k=Math.min(I+T,u),j=Math.min(P+T,s),W=C;W<N;W++)for(var q=I;q<k;q++){for(var X=0,V=P;V<j;V++)X+=c[E*d+W*m+V*v]*h[V*g+q*_+E*w];A[E*x+(W*u+q)]+=X}return S.toTensor()},e.prototype.fusedBatchMatMul=function(n){var r=n.a,i=n.b,o=n.transposeA,s=n.transposeB,a=n.bias,u=n.activation,l=n.preluActivationWeights,c=this.batchMatMul(r,i,o,s);return a&&(c=this.add(c,a)),u&&(c=$g(this,c,u,l)),c},e.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(n,r,un(n.dtype,r.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(n,r){return Z([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(n,r){return Z([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(n,r){Z(n,"sum"),ur("sum",r,n.rank);for(var i=wn(n.shape,r),o=i[0],s=i[1],a=ct(o,un(n.dtype,"int32")),u=pe(s),l=this.readSync(a.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=0,m=0;m<u;++m)d+=c[f+m];l[h]=d}return a},e.prototype.prod=function(n,r){Z(n,"sum");for(var i=wn(n.shape,r),o=i[0],s=i[1],a=ct(o,un(n.dtype,"int32")),u=pe(s),l=this.readSync(a.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=1,m=0;m<u;++m)d*=c[f+m];l[h]=d}return a},e.prototype.unsortedSegmentSum=function(n,r,i){Z(n,"unsortedSegmentSum");for(var o=[],s=n.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=se(a,"int32"),l=lk(u,r).asType("float32").mul(n).sum(0);o.push(l)}return mr(o)},e.prototype.argMin=function(n,r){Z(n,"argMin");var i=[r];ur("argMin",i,n.rank);for(var o=wn(n.shape,i),s=o[0],a=o[1],u=ct(s,"int32"),l=pe(a),c=this.readSync(u.dataId),h=this.readSync(n.dataId),f=0;f<c.length;++f){for(var d=f*l,m=h[d],v=0,y=0;y<l;++y){var g=h[d+y];g<m&&(m=g,v=y)}c[f]=v}return u},e.prototype.argMax=function(n,r){Z(n,"argMax");var i=[r];ur("argMax",i,n.rank);for(var o=wn(n.shape,i),s=o[0],a=o[1],u=ct(s,"int32"),l=pe(a),c=this.readSync(u.dataId),h=this.readSync(n.dataId),f=0;f<c.length;++f){for(var d=f*l,m=h[d],v=0,y=0;y<l;++y){var g=h[d+y];g>m&&(m=g,v=y)}c[f]=v}return u},e.prototype.cumsum=function(n,r,i,o){if(Z(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var s=un(n.dtype,"int32"),a=ct(n.shape,s),u=this.readSync(a.dataId),l=this.readSync(n.dataId),c=n.shape[n.rank-1],h=o?function(y,g){return y+c-g-1}:function(y,g){return y+g},f=0;f<l.length;f+=c)for(var d=0;d<c;d++){var m=h(f,d);if(d===0)u[m]=i?0:l[m];else{var v=h(f,d-1);u[m]=i?l[v]+u[v]:l[m]+u[v]}}return a},e.prototype.equal=function(n,r){return Z([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(n,r){return Z([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(n,r){return Z([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(n,r){return Z([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(n,r){return Z([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(n,r){return Z([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(n){Z(n,"logicalNot");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,n.shape,"bool")},e.prototype.logicalAnd=function(n,r){return Z([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(n,r){return Z([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i||o})},e.prototype.select=function(n,r,i){Z([n,r,i],"select");for(var o=this.readSync(n.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),u=ct(r.shape,un(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,h=n.rank===0||n.rank>1||r.rank===1?1:pe(r.shape.slice(1)),f=0;f<o.length;f++)for(var d=0;d<h;d++)o[f]===1?l[c++]=s[f]:l[c++]=a[f];return u},e.prototype.where=function(n){Z([n],"where");var r=this.readSync(n.dataId);return X1(n.shape,r)},e.prototype.topk=function(n,r,i){return Z(n,"topk"),jA(this.readSync(n.dataId),n.shape,n.dtype,r)},e.prototype.min=function(n,r){Z(n,"min"),ur("min",r,n.rank);for(var i=wn(n.shape,r),o=i[0],s=i[1],a=ct(o,n.dtype),u=pe(s),l=this.readSync(a.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],m=0;m<u;++m){var v=c[f+m];v<d&&(d=v)}l[h]=d}return a},e.prototype.minimum=function(n,r){return Z([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(n,r){return Z([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},e.prototype.max=function(n,r){Z(n,"max"),ur("max",r,n.rank);for(var i=wn(n.shape,r),o=i[0],s=i[1],a=ct(o,n.dtype),u=pe(s),l=this.readSync(a.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],m=0;m<u;++m){var v=c[f+m];v>d&&(d=v)}l[h]=d}return a},e.prototype.maximum=function(n,r){return Z([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(n,r){Z(n,"all"),ur("all",r,n.rank);for(var i=wn(n.shape,r),o=i[0],s=i[1],a=ct(o,n.dtype),u=pe(s),l=this.readSync(a.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],m=0;m<u;++m){var v=c[f+m];d=d&&v}l[h]=d}return a},e.prototype.any=function(n,r){Z(n,"any"),ur("any",r,n.rank);for(var i=wn(n.shape,r),o=i[0],s=i[1],a=ct(o,n.dtype),u=pe(s),l=this.readSync(a.dataId),c=this.readSync(n.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],m=0;m<u;++m){var v=c[f+m];d=d||v}l[h]=d}return a},e.prototype.squaredDifference=function(n,r){return Z([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){var s=i-o;return s*s})},e.prototype.ceil=function(n){Z(n,"ceil");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.floor=function(n){Z(n,"floor");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.sign=function(n){Z(n,"x");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,n.shape,"float32")},e.prototype.isNaN=function(n){Z(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.isInf=function(n){Z(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.isFinite=function(n){Z(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.round=function(n){Z(n,"round");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);r[o]-s<.5?i[o]=Math.floor(r[o]):r[o]-s>.5?i[o]=Math.ceil(r[o]):i[o]=s%2==0?s:s+1}return this.makeOutput(i,n.shape,"float32")},e.prototype.exp=function(n){Z(n,"exp");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.expm1=function(n){Z(n,"expm1");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.log=function(n){Z(n,"log");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.log1p=function(n){Z(n,"log1p");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log1p(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.sqrt=function(n){Z(n,"sqrt");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.sqrt(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.rsqrt=function(n){Z(n,"rsqrt");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=1/Math.sqrt(s)}return this.makeOutput(i,n.shape,"float32")},e.prototype.reciprocal=function(n){Z(n,"reciprocal");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,n.shape,"float32")},e.prototype.linear=function(n){return n},e.prototype.relu=function(n){Z(n,"relu");for(var r=ct(n.shape,n.dtype),i=this.readSync(r.dataId),o=this.readSync(n.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},e.prototype.relu6=function(n){Z(n,"relu");for(var r=ct(n.shape,n.dtype),i=this.readSync(r.dataId),o=this.readSync(n.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},e.prototype.prelu=function(n,r){return Z([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(n){Z(n,"elu");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,n.shape,"float32")},e.prototype.eluDer=function(n,r){Z([n,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(n.dataId),a=0;a<o.length;++a){var u=o[a];i[a]=u>=1?s[a]:s[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(n){Z(n,"selu");for(var r=Q1,i=J1,o=new Float32Array(n.size),s=this.readSync(n.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,n.shape,"float32")},e.prototype.clip=function(n,r,i){Z(n,"clip");for(var o=new Float32Array(n.size),s=this.readSync(n.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>i?i:u<r?r:u}return this.makeOutput(o,n.shape,"float32")},e.prototype.abs=function(n){for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<n.size;++o){var s=i[2*o],a=i[2*o+1];r[o]=Math.hypot(s,a)}return this.makeOutput(r,n.shape,"float32")},e.prototype.int=function(n){Z(n,"int");for(var r=new Int32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,n.shape,"int32")},e.prototype.sigmoid=function(n){Z(n,"sigmoid");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,n.shape,"float32")},e.prototype.softplus=function(n){Z(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(n.size),o=this.readSync(n.dataId),s=0;s<o.length;++s){var a=o[s]>-r,u=o[s]<r,l=Math.exp(o[s]),c=void 0;c=u?l:a?o[s]:Math.log(1+l),i[s]=c}return this.makeOutput(i,n.shape,"float32")},e.prototype.sin=function(n){Z(n,"sin");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.cos=function(n){Z(n,"cos");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.tan=function(n){Z(n,"tan");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.asin=function(n){Z(n,"asin");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.acos=function(n){Z(n,"acos");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atan=function(n){Z(n,"atan");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atan2=function(n,r){return Z([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(n){Z(n,"sinh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.cosh=function(n){Z(n,"cosh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.tanh=function(n){Z(n,"tanh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=PB(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.asinh=function(n){Z(n,"asinh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.acosh=function(n){Z(n,"acosh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atanh=function(n){Z(n,"atanh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.erf=function(n){Z(n,"erf");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),u=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,n.shape,"float32")},e.prototype.step=function(n,r){r===void 0&&(r=0),Z(n,"step");for(var i=new Float32Array(n.size),o=this.readSync(n.dataId),s=0;s<o.length;++s){var a=o[s];isNaN(a)?i[s]=NaN:i[s]=a>0?1:r}return this.makeOutput(i,n.shape,"float32")},e.prototype.fusedConv2d=function(n){var r=n.input,i=n.filter,o=n.convInfo,s=n.bias,a=n.activation,u=n.preluActivationWeights,l=this.conv2d(r,i,o);return s&&(l=this.add(l,s)),a&&(l=$g(this,l,a,u)),l},e.prototype.conv2d=function(n,r,i){Z([n,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.dataFormat==="channelsLast",f=Ae(i.outShape,n.dtype),d=n.strides[0],m=h?n.strides[1]:n.strides[2],v=h?n.strides[2]:1,y=h?1:n.strides[1],g=f.strides[0],_=h?f.strides[1]:f.strides[2],w=h?f.strides[2]:1,x=h?1:f.strides[1],S=this.readSync(n.dataId),A=this.readSync(r.dataId),T=f.values,E=0;E<i.batchSize;++E)for(var C=E*d,I=E*g,P=0;P<i.outHeight;++P)for(var N=I+P*_,k=P*i.strideHeight-c,j=0;j<o;j++){var W=k+j*a;if(!(W<0||W>=i.inHeight))for(var q=j*r.strides[0],X=C+W*m,V=0;V<i.outWidth;++V)for(var z=N+V*w,U=V*i.strideWidth-l,Q=0;Q<s;Q++){var te=U+Q*u;if(!(te<0||te>=i.inWidth))for(var ie=X+te*v,we=q+Q*r.strides[1],_e=0;_e<i.inChannels;++_e){for(var ce=S[ie+_e*y],be=0;be<i.outChannels;++be)T[z+be*x]+=ce*A[we+be];we+=i.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(n,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.front,f=i.padInfo.left,d=i.padInfo.top,m=Ae(i.outShape,n.dtype),v=this.readSync(n.dataId),y=this.readSync(r.dataId),g=m.values,_=0;_<i.batchSize;++_)for(var w=_*n.strides[0],x=_*m.strides[0],S=0;S<i.outDepth;++S)for(var A=x+S*m.strides[1],T=S*i.strideDepth-h,E=0;E<o;E++){var C=T+E*u;if(!(C<0||C>=i.inDepth))for(var I=E*r.strides[0],P=w+C*n.strides[1],N=0;N<i.outHeight;++N)for(var k=A+N*m.strides[2],j=N*i.strideHeight-d,W=0;W<s;W++){var q=j+W*l;if(!(q<0||q>=i.inHeight))for(var X=I+W*r.strides[1],V=P+q*n.strides[2],z=0;z<i.outWidth;++z)for(var U=k+z*i.outChannels,Q=z*i.strideWidth-f,te=0;te<a;te++){var ie=Q+te*c;if(!(ie<0||ie>=i.inWidth))for(var we=X+te*r.strides[2],_e=V+ie*i.inChannels,ce=we,be=0;be<i.inChannels;++be){for(var xe=v[_e+be],Se=0;Se<i.outChannels;++Se)g[U+Se]+=xe*y[ce+Se];ce+=i.outChannels}}}}return m.toTensor()},e.prototype.conv2dDerInput=function(n,r,i){Z([n,r],"conv2dDerInput");for(var o=Ae(i.inShape,"float32"),s=o.values,a=this.readSync(n.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],f=l[2],d=i.batchSize,m=i.filterHeight,v=i.filterWidth,y=i.inChannels,g=i.inHeight,_=i.inWidth,w=i.outChannels,x=i.outHeight,S=i.outWidth,A=i.strideHeight,T=i.strideWidth,E=i.dataFormat,C=m-1-i.padInfo.top,I=v-1-i.padInfo.left,P=E==="channelsLast",N=o.strides[0],k=P?o.strides[1]:o.strides[2],j=P?o.strides[2]:1,W=P?1:o.strides[1],q=n.strides[0],X=P?n.strides[1]:n.strides[2],V=P?n.strides[2]:1,z=P?1:n.strides[1],U=0;U<d;++U)for(var Q=0;Q<y;++Q)for(var te=0;te<g;++te)for(var ie=te-C,we=Math.max(0,Math.ceil(ie/A)),_e=Math.min(x,(m+ie)/A),ce=0;ce<_;++ce){for(var be=ce-I,xe=Math.max(0,Math.ceil(be/T)),Se=Math.min(S,(v+be)/T),qe=0,Ee=we;Ee<_e;++Ee)for(var Le=Ee*A-ie,Ve=xe;Ve<Se;++Ve)for(var st=q*U+X*Ee+V*Ve,at=c*(m-1-Le)+h*(v-1-(Ve*T-be))+f*Q,et=0;et<w;++et)qe+=a[st+z*et]*u[at+et];s[N*U+k*te+j*ce+W*Q]=qe}return o.toTensor()},e.prototype.conv3dDerInput=function(n,r,i){for(var o=Ae(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],l=a[1],c=a[2],h=a[3],f=this.readSync(n.dataId),d=n.strides,m=d[0],v=d[1],y=d[2],g=d[3],_=this.readSync(r.dataId),w=r.strides,x=w[0],S=w[1],A=w[2],T=w[3],E=i.batchSize,C=i.filterDepth,I=i.filterHeight,P=i.filterWidth,N=i.inChannels,k=i.inDepth,j=i.inHeight,W=i.inWidth,q=i.outChannels,X=i.outDepth,V=i.outHeight,z=i.outWidth,U=i.strideDepth,Q=i.strideHeight,te=i.strideWidth,ie=C-1-i.padInfo.front,we=I-1-i.padInfo.top,_e=P-1-i.padInfo.left,ce=0;ce<E;++ce)for(var be=0;be<N;++be)for(var xe=0;xe<k;++xe)for(var Se=xe-ie,qe=Math.max(0,Math.ceil(Se/U)),Ee=Math.min(X,(C+Se)/U),Le=0;Le<j;++Le)for(var Ve=Le-we,st=Math.max(0,Math.ceil(Ve/Q)),at=Math.min(V,(I+Ve)/Q),et=0;et<W;++et){for(var Wn=et-_e,or=Math.max(0,Math.ceil(Wn/te)),Ke=Math.min(z,(P+Wn)/te),Tt=0,zn=qe;zn<Ee;++zn)for(var ni=zn*U-Se,xr=st;xr<at;++xr)for(var lo=xr*Q-Ve,Mn=or;Mn<Ke;++Mn)for(var _a=m*ce+v*zn+y*xr+g*Mn,Ai=x*(C-1-ni)+S*(I-1-lo)+A*(P-1-(Mn*te-Wn))+T*be,$n=0;$n<q;++$n)Tt+=f[_a+$n]*_[Ai+$n];s[u*ce+l*xe+c*Le+h*et+be]=Tt}return o.toTensor()},e.prototype.conv2dDerFilter=function(n,r,i){Z([n,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=Ae(i.filterShape,"float32"),h=i.padInfo.left,f=i.padInfo.top,d=this.bufferSync(n),m=this.bufferSync(r),v=0;v<a;++v)for(var y=Math.max(0,Math.ceil((f-v)/o)),g=Math.min(i.outHeight,(i.inHeight+f-v)/o),_=0;_<u;++_)for(var w=Math.max(0,Math.ceil((h-_)/s)),x=Math.min(i.outWidth,(i.inWidth+h-_)/s),S=0;S<i.inChannels;++S)for(var A=0;A<i.outChannels;++A){for(var T=0,E=0;E<i.batchSize;++E)for(var C=y;C<g;++C)for(var I=v+C*o-f,P=w;P<x;++P){var N=_+P*s-h;T+=l?d.get(E,I,N,S)*m.get(E,C,P,A):d.get(E,S,I,N)*m.get(E,A,C,P)}c.set(T,v,_,S,A)}return c.toTensor()},e.prototype.conv3dDerFilter=function(n,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=Ae(i.filterShape,"float32"),f=h.values,d=h.strides,m=d[0],v=d[1],y=d[2],g=d[3],_=this.readSync(r.dataId),w=r.strides,x=w[0],S=w[1],A=w[2],T=w[3],E=this.readSync(n.dataId),C=n.strides,I=C[0],P=C[1],N=C[2],k=C[3],j=i.padInfo.front,W=i.padInfo.left,q=i.padInfo.top,X=0;X<u;++X)for(var V=Math.max(0,Math.ceil((j-X)/o)),z=Math.min(i.outDepth,(i.inDepth+j-X)/o),U=X*m,Q=0;Q<l;++Q)for(var te=Math.max(0,Math.ceil((q-Q)/s)),ie=Math.min(i.outHeight,(i.inHeight+q-Q)/s),we=Q*v+U,_e=0;_e<c;++_e)for(var ce=Math.max(0,Math.ceil((W-_e)/a)),be=Math.min(i.outWidth,(i.inWidth+W-_e)/a),xe=_e*y+we,Se=0;Se<i.inChannels;++Se)for(var qe=Se*g+xe,Ee=0;Ee<i.outChannels;++Ee){for(var Le=0,Ve=0;Ve<i.batchSize;++Ve)for(var st=Ve*I,at=Ve*x,et=V;et<z;++et)for(var Wn=(X+et*o-j)*P+st,or=et*S+at,Ke=te;Ke<ie;++Ke)for(var Tt=(Q+Ke*s-q)*N+Wn,zn=Ke*A+or,ni=ce;ni<be;++ni){var xr=ni*T+zn;Le+=E[(_e+ni*a-W)*k+Tt+Se]*_[xr+Ee]}f[qe+Ee]=Le}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,i=n.filter,o=n.convInfo,s=n.bias,a=n.activation,u=n.preluActivationWeights,l=this.depthwiseConv2D(r,i,o);return s&&(l=this.add(l,s)),a&&(l=$g(this,l,a,u)),l},e.prototype.depthwiseConv2D=function(n,r,i){Z([n,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.outChannels/i.inChannels,f=Ae(i.outShape,n.dtype),d=this.readSync(n.dataId),m=this.readSync(r.dataId),v=f.values,y=0;y<i.batchSize;++y)for(var g=y*n.strides[0],_=y*f.strides[0],w=0;w<i.outHeight;++w)for(var x=_+w*f.strides[1],S=w*i.strideHeight-l,A=0;A<o;++A){var T=S+A*a;if(!(T<0||T>=i.inHeight))for(var E=A*r.strides[0],C=g+T*n.strides[1],I=0;I<i.outWidth;++I)for(var P=x+I*f.strides[2],N=I*i.strideWidth-c,k=0;k<s;++k){var j=N+k*u;if(!(j<0||j>=i.inWidth))for(var W=E+k*r.strides[1],q=C+j*i.inChannels,X=P,V=W,z=0;z<i.inChannels;++z){for(var U=d[q+z],Q=0;Q<h;++Q)v[X+Q]+=U*m[V+Q];X+=h,V+=h}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(n,r,i){Z([n,r],"depthwiseConv2DDerInput");for(var o=Ae(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],l=a[1],c=a[2],h=this.readSync(n.dataId),f=n.strides,d=f[0],m=f[1],v=f[2],y=this.readSync(r.dataId),g=r.strides,_=g[0],w=g[1],x=g[2],S=i.batchSize,A=i.filterHeight,T=i.filterWidth,E=i.inChannels,C=i.inHeight,I=i.inWidth,P=i.outChannels,N=i.outHeight,k=i.outWidth,j=i.strideHeight,W=i.strideWidth,q=A-1-i.padInfo.top,X=T-1-i.padInfo.left,V=P/E,z=0;z<S;++z)for(var U=0;U<E;++U)for(var Q=0;Q<C;++Q)for(var te=Q-q,ie=Math.max(0,Math.ceil(te/j)),we=Math.min(N,(A+te)/j),_e=0;_e<I;++_e){for(var ce=_e-X,be=Math.max(0,Math.ceil(ce/W)),xe=Math.min(k,(T+ce)/W),Se=0,qe=ie;qe<we;++qe)for(var Ee=qe*j-te,Le=be;Le<xe;++Le)for(var Ve=d*z+m*qe+v*Le,st=_*(A-1-Ee)+w*(T-1-(Le*W-ce))+x*U,at=0;at<V;++at)Se+=h[Ve+(U*V+at)]*y[st+at];s[u*z+l*Q+c*_e+U]=Se}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(n,r,i){Z([n,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=Ae(i.filterShape,"float32"),c=i.padInfo.left,h=i.padInfo.top,f=i.outChannels/i.inChannels,d=this.bufferSync(n),m=this.bufferSync(r),v=0;v<a;++v)for(var y=Math.max(0,Math.ceil((h-v)/o)),g=Math.min(i.outHeight,(i.inHeight+h-v)/o),_=0;_<u;++_)for(var w=Math.max(0,Math.ceil((c-_)/s)),x=Math.min(i.outWidth,(i.inWidth+c-_)/s),S=0;S<i.outChannels;++S){for(var A=Math.trunc(S/f),T=S%f,E=0,C=0;C<i.batchSize;++C)for(var I=y;I<g;++I)for(var P=v+I*o-h,N=w;N<x;++N){var k=_+N*s-c;E+=d.get(C,P,k,A)*m.get(C,I,N,S)}l.set(E,v,_,A,T)}return l.toTensor()},e.prototype.tile=function(n,r){return Z(n,"tile"),BA(this.bufferSync(n),r)},e.prototype.pad=function(n,r,i){Z(n,"pad");var o=r.map(function(f,d){return f[0]+n.shape[d]+f[1]}),s=r.map(function(f){return f[0]}),a=this.bufferSync(n),u=Ae(o,n.dtype);i!==0&&u.values.fill(i);for(var l=0;l<n.size;l++){var c=a.indexToLoc(l),h=c.map(function(f,d){return f+s[d]});u.set.apply(u,[a.get.apply(a,c)].concat(h))}return u.toTensor()},e.prototype.transpose=function(n,r){Z(n,"transpose");for(var i=new Array(n.rank),o=0;o<i.length;o++)i[o]=n.shape[r[o]];var s=this.readSync(n.dataId),a=Ae(i,n.dtype),u=this.bufferSync(n);for(o=0;o<n.size;++o){for(var l=u.indexToLoc(o),c=new Array(l.length),h=0;h<c.length;h++)c[h]=l[r[h]];var f=a.locToIndex(c);a.values[f]=s[o]}return a.toTensor()},e.prototype.gather=function(n,r,i){Z([n,r],"gather");var o=n.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=Ae(o,n.dtype),u=this.bufferSync(n),l=0;l<a.size;++l){var c=a.indexToLoc(l),h=c.slice();h[i]=s[c[i]];var f=u.locToIndex(h);a.values[l]=u.values[f]}return a.toTensor()},e.prototype.batchToSpaceND=function(n,r,i){Z([n],"batchToSpaceND");var o=r.reduce(function(h,f){return h*f}),s=Ld(n.shape,r,o),a=Vd(s.length,r.length),u=Bd(n.shape,r,o),l=TA(i,r.length),c=IA(u,i,r.length);return n.reshape(s).transpose(a).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(n,r,i){Z([n],"spaceToBatchND");var o=r.reduce(function(f,d){return f*d}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<n.shape.length;++a)s.push([0,0]);var u=n.pad(s),l=Ld(u.shape,r,o,!1),c=Vd(l.length,r.length,!1),h=Bd(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(h)},e.prototype.pool=function(n,r,i){Z(n,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(n.dataId),v=Ae(r.outShape,n.dtype),y=v.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],_=r.outShape[2]*r.outShape[3],w=r.outShape[3],x=0;x<r.batchSize;++x)for(var S=x*g,A=x*n.strides[0],T=0;T<r.inChannels;++T)for(var E=0;E<r.outHeight;++E)for(var C=E*o-h,I=Math.max(0,C),P=Math.min(r.inHeight,l+C),N=S+E*_,k=0;k<r.outWidth;++k){for(var j=k*s-f,W=Math.max(0,j),q=Math.min(r.inWidth,c+j),X=d,V=0,z=0,U=I;U<P;U+=a){for(var Q=A+U*n.strides[1],te=W;te<q;te+=u){var ie=m[Q+te*n.strides[2]+T];i==="max"&&ie>X?X=ie:i==="avg"&&(V+=ie,z++)}if(isNaN(X))break}y[N+k*w+T]=i==="avg"?V/z:X}return v.toTensor()},e.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},e.prototype.maxPoolPositions=function(n,r){for(var i=Ae(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,d=this.bufferSync(n),m=0;m<r.batchSize;++m)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.outHeight;++y){for(var g=y*o-h,_=g;_<0;)_+=a;for(var w=Math.min(r.inHeight,l+g),x=0;x<r.outWidth;++x){for(var S=x*s-f,A=S;A<0;)A+=u;for(var T=Math.min(r.inWidth,c+S),E=Number.NEGATIVE_INFINITY,C=-1,I=_;I<w;I+=a)for(var P=I-g,N=A;N<T;N+=u){var k=N-S,j=d.get(m,I,N,v);j>E&&(E=j,C=P*c+k)}i.set(C,m,y,x,v)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(n,r,i,o){Z([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,u=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,h=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=f-1-o.padInfo.left,m=h-1-o.padInfo.top,v=Ae(r.shape,"float32"),y=this.bufferSync(s),g=this.bufferSync(n),_=0;_<o.batchSize;++_)for(var w=0;w<o.inChannels;++w)for(var x=0;x<o.inHeight;++x)for(var S=0;S<o.inWidth;++S){for(var A=x-m,T=S-d,E=0,C=0;C<h;C+=l){var I=(A+C)/a;if(!(I<0||I>=o.outHeight||Math.floor(I)!==I))for(var P=0;P<f;P+=c){var N=(T+P)/u;if(!(N<0||N>=o.outWidth||Math.floor(N)!==N)){var k=h*f-1-y.get(_,I,N,w)===C*f+P?1:0;k!==0&&(E+=g.get(_,I,N,w)*k)}}}v.set(E,_,x,S,w)}return v.toTensor()},e.prototype.avgPoolBackprop=function(n,r,i){Z([n,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,f=i.effectiveFilterWidth,d=f-1-i.padInfo.left,m=h-1-i.padInfo.top,v=Ae(r.shape,"float32"),y=1/(a*u),g=this.bufferSync(n),_=0;_<i.batchSize;++_)for(var w=0;w<i.inChannels;++w)for(var x=0;x<i.inHeight;++x)for(var S=0;S<i.inWidth;++S){for(var A=x-m,T=S-d,E=0,C=0;C<h;C+=l){var I=(A+C)/o;if(!(I<0||I>=i.outHeight||Math.floor(I)!==I))for(var P=0;P<f;P+=c){var N=(T+P)/s;N<0||N>=i.outWidth||Math.floor(N)!==N||(E+=g.get(_,I,N,w))}}v.set(E*y,_,x,S,w)}return v.toTensor()},e.prototype.pool3d=function(n,r,i){Z(n,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,m=r.padInfo.front,v=r.padInfo.top,y=r.padInfo.left,g=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,_=this.readSync(n.dataId),w=Ae(r.outShape,n.dtype),x=w.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],E=r.outShape[4],C=0;C<r.batchSize;++C)for(var I=C*S,P=C*n.strides[0],N=0;N<r.inChannels;++N)for(var k=0;k<r.outDepth;++k){for(var j=k*o-m,W=j;W<0;)W+=u;for(var q=Math.min(r.inDepth,h+j),X=I+k*A,V=0;V<r.outHeight;++V){for(var z=V*s-v,U=z;U<0;)U+=l;for(var Q=Math.min(r.inHeight,f+z),te=X+V*T,ie=0;ie<r.outWidth;++ie){for(var we=ie*a-y,_e=we;_e<0;)_e+=c;for(var ce=Math.min(r.inWidth,d+we),be=te+ie*E,xe=g,Se=0,qe=0,Ee=W;Ee<q;Ee+=u){for(var Le=P+Ee*n.strides[1],Ve=U;Ve<Q;Ve+=l){for(var st=Le+Ve*n.strides[2],at=_e;at<ce;at+=c){var et=_[st+at*n.strides[3]+N];if(i==="max"&&et>xe?xe=et:i==="avg"&&(Se+=et,qe++),isNaN(xe))break}if(isNaN(xe))break}if(isNaN(xe))break}x[be+N]=i==="avg"?Se/qe:xe}}}return w.toTensor()},e.prototype.avgPool3d=function(n,r){return Z(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(n,r,i){Z([n,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=i.dilationDepth,f=i.dilationHeight,d=i.dilationWidth,m=i.effectiveFilterDepth,v=i.effectiveFilterHeight,y=i.effectiveFilterWidth,g=m-1-i.padInfo.front,_=y-1-i.padInfo.left,w=v-1-i.padInfo.top,x=Ae(r.shape,"float32"),S=1/(u*l*c),A=this.bufferSync(n),T=0;T<i.batchSize;++T)for(var E=0;E<i.inChannels;++E)for(var C=0;C<i.inDepth;++C)for(var I=0;I<i.inHeight;++I)for(var P=0;P<i.inWidth;++P){for(var N=C-g,k=I-w,j=P-_,W=0,q=0;q<m;q+=h){var X=(N+q)/o;if(!(X<0||X>=i.outDepth||Math.floor(X)!==X))for(var V=0;V<v;V+=f){var z=(k+V)/s;if(!(z<0||z>=i.outHeight||Math.floor(z)!==z))for(var U=0;U<y;U+=d){var Q=(j+U)/a;Q<0||Q>=i.outWidth||Math.floor(Q)!==Q||(W+=A.get(T,X,z,Q,E))}}}x.set(W*S,T,C,I,P,E)}return x.toTensor()},e.prototype.maxPool3d=function(n,r){return Z(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(n,r){for(var i=Ae(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,m=r.padInfo.front,v=r.padInfo.top,y=r.padInfo.left,g=this.bufferSync(n),_=0;_<r.batchSize;++_)for(var w=0;w<r.inChannels;++w)for(var x=0;x<r.outDepth;++x){for(var S=x*o-m,A=S;A<0;)A+=u;for(var T=Math.min(r.inDepth,h+S),E=0;E<r.outHeight;++E){for(var C=E*s-v,I=C;I<0;)I+=l;for(var P=Math.min(r.inHeight,f+C),N=0;N<r.outWidth;++N){for(var k=N*a-y,j=k;j<0;)j+=c;for(var W=Math.min(r.inWidth,d+k),q=Number.NEGATIVE_INFINITY,X=-1,V=A;V<T;V+=u)for(var z=V-S,U=I;U<P;U+=l)for(var Q=U-C,te=j;te<W;te+=c){var ie=te-k,we=g.get(_,V,U,te,w);we>=q&&(q=we,X=z*f*d+Q*f+ie)}i.set(X,_,x,E,N,w)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(n,r,i,o){Z([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,f=o.dilationWidth,d=o.effectiveFilterDepth,m=o.effectiveFilterHeight,v=o.effectiveFilterWidth,y=d-1-o.padInfo.front,g=v-1-o.padInfo.left,_=m-1-o.padInfo.top,w=Ae(r.shape,"float32"),x=this.bufferSync(s),S=this.bufferSync(n),A=0;A<o.batchSize;++A)for(var T=0;T<o.inChannels;++T)for(var E=0;E<o.inDepth;++E)for(var C=0;C<o.inHeight;++C)for(var I=0;I<o.inWidth;++I){for(var P=E-y,N=C-_,k=I-g,j=0,W=0;W<d;W+=c){var q=(P+W)/a;if(!(q<0||q>=o.outDepth||Math.floor(q)!==q))for(var X=0;X<m;X+=h){var V=(N+X)/u;if(!(V<0||V>=o.outHeight||Math.floor(V)!==V))for(var z=0;z<v;z+=f){var U=(k+z)/l;if(!(U<0||U>=o.outWidth||Math.floor(U)!==U)){var Q=d*m*v-1-x.get(A,q,V,U,T)===W*m*v+X*v+z?1:0;Q!==0&&(j+=S.get(A,q,V,U,T)*Q)}}}}w.set(j,A,E,C,I,T)}return w.toTensor()},e.prototype.cast=function(n,r){return FA(n,r,this)},e.prototype.reshape=function(n,r){return My(n,r)},e.prototype.avgPool=function(n,r){return Z(n,"avgPool"),this.pool(n,r,"avg").toFloat()},e.prototype.resizeBilinear=function(n,r,i,o){Z(n,"resizeBilinear");for(var s=n.shape,a=s[0],u=s[1],l=s[2],c=s[3],h=this.readSync(n.dataId),f=new Float32Array(pe([a,r,i,c])),d=[o&&r>1?u-1:u,o&&i>1?l-1:l],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],v=0,y=d[0]/m[0],g=d[1]/m[1],_=0;_<a;_++)for(var w=0;w<r;w++)for(var x=y*w,S=Math.floor(x),A=x-S,T=Math.min(u-1,Math.ceil(x)),E=_*n.strides[0]+S*n.strides[1],C=_*n.strides[0]+T*n.strides[1],I=0;I<i;I++)for(var P=g*I,N=Math.floor(P),k=P-N,j=Math.min(l-1,Math.ceil(P)),W=E+N*n.strides[2],q=C+N*n.strides[2],X=E+j*n.strides[2],V=C+j*n.strides[2],z=0;z<c;z++){var U=h[W+z],Q=h[q+z],te=U+(h[X+z]-U)*k,ie=te+(Q+(h[V+z]-Q)*k-te)*A;f[v++]=ie}return cn(f,[a,r,i,c])},e.prototype.resizeBilinearBackprop=function(n,r,i){Z([n,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=n.shape,h=c[1],f=c[2],d=new Float32Array(s*a*u*l),m=[i&&h>1?a-1:a,i&&f>1?u-1:u],v=[i&&h>1?h-1:h,i&&f>1?f-1:f],y=m[0]/v[0],g=m[1]/v[1],_=this.readSync(n.dataId),w=0,x=0;x<s;x++)for(var S=x*r.strides[0],A=0;A<h;A++)for(var T=A*y,E=Math.floor(T),C=Math.min(Math.ceil(T),a-1),I=S+E*r.strides[1],P=S+C*r.strides[1],N=T-E,k=1-N,j=0;j<f;j++)for(var W=j*g,q=Math.floor(W),X=Math.min(Math.ceil(W),u-1),V=W-q,z=1-V,U=I+q*r.strides[2],Q=I+X*r.strides[2],te=P+q*r.strides[2],ie=P+X*r.strides[2],we=k*z,_e=k*V,ce=N*z,be=N*V,xe=0;xe<l;xe++){var Se=_[w++];d[U+xe]+=Se*we,d[Q+xe]+=Se*_e,d[te+xe]+=Se*ce,d[ie+xe]+=Se*be}return Kn(d,[s,u,a,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(n,r,i,o){Z(n,"resizeNearestNeighbor");for(var s=n.shape,a=s[0],u=s[1],l=s[2],c=s[3],h=this.readSync(n.dataId),f=new Float32Array(a*r*i*c),d=[o&&r>1?u-1:u,o&&i>1?l-1:l],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],v=d[0]/m[0],y=d[1]/m[1],g=0,_=0;_<a;_++)for(var w=_*n.strides[0],x=0;x<r;x++)for(var S=v*x,A=w+Math.min(u-1,o?Math.round(S):Math.floor(S))*n.strides[1],T=0;T<i;T++)for(var E=y*T,C=A+Math.min(l-1,o?Math.round(E):Math.floor(E))*n.strides[2],I=0;I<c;I++){var P=h[C+I];f[g++]=P}return cn(f,[a,r,i,c],n.dtype)},e.prototype.resizeNearestNeighborBackprop=function(n,r,i){Z([n,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=n.shape,h=c[1],f=c[2],d=new Float32Array(s*a*u*l),m=this.readSync(n.dataId),v=[i&&h>1?a-1:a,i&&f>1?u-1:u],y=[i&&h>1?h-1:h,i&&f>1?f-1:f],g=v[0]/y[0],_=v[1]/y[1],w=1/g,x=1/_,S=2*Math.ceil(w)+2,A=2*Math.ceil(x)+2,T=0;T<s;T++)for(var E=T*r.strides[0],C=0;C<a;C++)for(var I=E+C*r.strides[1],P=Math.floor(C*w),N=Math.floor(P-S/2),k=0;k<u;k++)for(var j=I+k*r.strides[2],W=Math.floor(k*x),q=Math.floor(W-A/2),X=0;X<l;X++){for(var V=0,z=0;z<S;z++){var U=z+N;if(!(U<0||U>=h)){var Q=E+U*n.strides[1],te=U*g;if(C===Math.min(a-1,i?Math.round(te):Math.floor(te)))for(var ie=0;ie<A;ie++){var we=ie+q;if(!(we<0||we>=f)){var _e=Q+we*n.strides[2],ce=we*_;k===Math.min(u-1,i?Math.round(ce):Math.floor(ce))&&(V+=m[_e+X])}}}}d[j+X]=V}return Kn(d,r.shape,r.dtype)},e.prototype.batchNormalization=function(n,r,i,o,s,a){Z([n,r,i,s,a],"batchNorm");for(var u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),h=s?this.readSync(s.dataId):new Float32Array([1]),f=a?this.readSync(a.dataId):new Float32Array([0]),d=new Float32Array(u.length),m=f.length,v=h.length,y=c.length,g=l.length,_=0,w=0,x=0,S=0,A=0;A<u.length;++A)d[A]=f[_++]+(u[A]-l[w++])*h[x++]/Math.sqrt(c[S++]+o),_>=m&&(_=0),w>=g&&(w=0),x>=v&&(x=0),S>=y&&(S=0);return Kn(d,n.shape)},e.prototype.localResponseNormalization4D=function(n,r,i,o,s){Z(n,"localResponseNormalization4D");var a=n.shape[3],u=a-1,l=this.readSync(n.dataId),c=n.size,h=new Float32Array(c);function f(y){for(var g=y%a,_=y-g+Math.max(0,g-r),w=y-g+Math.min(g+r,u),x=0;_<=w;_++){var S=l[_];x+=S*S}return x}for(var d=0;d<c;d++){var m=f(d),v=l[d]*Math.pow(i+o*m,-s);h[d]=v}return Kn(h,n.shape)},e.prototype.LRNGrad=function(n,r,i,o,s,a,u){Z(n,"LRNGrad");for(var l=n.shape[3],c=this.readSync(n.dataId),h=this.readSync(r.dataId),f=this.readSync(i.dataId),d=new Float32Array(n.size),m=n.size,v=0;v<m;v++){for(var y=v%l,g=v-y+Math.max(0,y-o),_=v-y+Math.min(l,y+o+1),w=0,x=g;x<_;x++)w+=Math.pow(h[x],2);for(w=a*w+s,x=g;x<_;x++){var S=-2*a*u*h[x]*f[v]/w;v===x&&(S+=Math.pow(w,-u)),S*=c[v],d[x]+=S}}return Kn(d,n.shape)},e.prototype.multinomial=function(n,r,i,o){Z(n,"multinomial");for(var s=r?n:ro(n),a=s.shape[0],u=s.shape[1],l=ct([a,i],"int32"),c=this.readSync(l.dataId),h=this.readSync(s.dataId),f=0;f<a;++f){var d=f*u,m=new Float32Array(u-1);m[0]=h[d];for(var v=1;v<m.length;++v)m[v]=m[v-1]+h[d+v];for(var y=qp(o.toString()),g=f*i,_=0;_<i;++_){var w=y();c[g+_]=m.length;for(var x=0;x<m.length;x++)if(w<m[x]){c[g+_]=x;break}}}return l},e.prototype.oneHot=function(n,r,i,o){Z(n,"oneHot");var s=new Float32Array(n.size*r);s.fill(o);for(var a=this.readSync(n.dataId),u=0;u<n.size;++u)a[u]>=0&&a[u]<r&&(s[u*r+a[u]]=i);return Bo(s,[n.size,r],"int32")},e.prototype.nonMaxSuppression=function(n,r,i,o,s){return Z(n,"nonMaxSuppression"),q1(this.readSync(n.dataId),this.readSync(r.dataId),i,o,s)},e.prototype.fft=function(n){return this.fftBatch(n,!1)},e.prototype.ifft=function(n){return this.fftBatch(n,!0)},e.prototype.fftBatch=function(n,r){for(var i=n.shape[0],o=n.shape[1],s=Ae(n.shape,"float32"),a=Ae(n.shape,"float32"),u=Ir(n).as2D(i,o),l=di(n).as2D(i,o),c=0;c<i;c++)for(var h=u.slice([c,0],[1,o]),f=l.slice([c,0],[1,o]),d=an(h,f),m=this.readSync(this.fftImpl(d,r).dataId),v=0;v<o;v++){var y=ZE(m,v);s.values[c*o+v]=y.real,a.values[c*o+v]=y.imag}return an(s.toTensor(),a.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(n,r){var i=n.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(n.shape[0],n.shape[1]);return r&&(s=an(Ir(s).div(se(o)),di(s).div(se(o)))),s}var a=this.readSync(n.dataId),u=function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],h[f/2]=l[f+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(a,o,r));return an(u.real,u.imag).as2D(n.shape[0],n.shape[1])},e.prototype.isExponentOf2=function(n){return(n&n-1)==0},e.prototype.fftRadix2=function(n,r,i){if(r===1)return n;var o=this.readSync(n.dataId),s=r/2,a=function(g){for(var _=Math.ceil(g.length/4),w=new Float32Array(_),x=new Float32Array(_),S=0;S<g.length;S+=4)w[Math.floor(S/4)]=g[S],x[Math.floor(S/4)]=g[S+1];return{real:w,imag:x}}(o),u=an(a.real,a.imag).as1D(),l=function(g){for(var _=Math.floor(g.length/4),w=new Float32Array(_),x=new Float32Array(_),S=2;S<g.length;S+=4)w[Math.floor(S/4)]=g[S],x[Math.floor(S/4)]=g[S+1];return{real:w,imag:x}}(o),c=an(l.real,l.imag).as1D();u=this.fftRadix2(u,s,i),c=this.fftRadix2(c,s,i);var h=function(g,_){for(var w=new Float32Array(g/2),x=new Float32Array(g/2),S=0;S<Math.ceil(g/2);S++){var A=(_?2:-2)*Math.PI*(S/g);w[S]=Math.cos(A),x[S]=Math.sin(A)}return{real:w,imag:x}}(r,i),f=an(h.real,h.imag).mul(c),d=u.add(f),m=u.sub(f),v=Ir(d).concat(Ir(m)),y=di(d).concat(di(m));return an(v,y).as1D()},e.prototype.fourierTransformByMatmul=function(n,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,u=0,l=0;l<r;l++){var c=c5(s*l,r,i),h=ZE(n,l);a+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}i&&(a/=r,u/=r),l5(o,a,u,s)}return o},e.prototype.depthToSpace=function(n,r,i){O(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),O(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=n.shape[0],s=n.shape[1],a=n.shape[2],u=n.shape[3],l=s*r,c=a*r,h=u/(r*r),f=this.readSync(n.dataId),d=new Float32Array(o*l*c*h),m=0,v=0;v<o;++v)for(var y=0;y<l;++y)for(var g=Math.floor(y/r),_=y%r,w=0;w<c;++w)for(var x=Math.floor(w/r),S=(_*r+w%r)*h,A=0;A<h;++A){var T=A+S+u*(x+a*(g+s*v));d[m++]=f[T]}return Kn(d,[o,l,c,h])},e.prototype.broadcastedBinaryOp=function(n,r,i,o){var s=Fe(n.shape,r.shape),a=Ae(s,i),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Ro(n.shape,s),h=Ro(r.shape,s),f=a.values;if(c.length+h.length===0)for(var d=0;d<f.length;++d)f[d]=o(u[d%u.length],l[d%l.length]);else{var m=this.bufferSync(n),v=this.bufferSync(r),y=function(g){var _=a.indexToLoc(g),w=_.slice(-n.rank);c.forEach(function(T){return w[T]=0});var x=m.locToIndex(w),S=_.slice(-r.rank);h.forEach(function(T){return S[T]=0});var A=v.locToIndex(S);f[g]=o(u[x],l[A])};for(d=0;d<f.length;++d)y(d)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(n,r,i){var o=Fe(n.shape,r.shape),s=Ae(o,"float32"),a=Ae(o,"float32"),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Ro(n.shape,o),h=Ro(r.shape,o),f=s.values,d=a.values;if(c.length+h.length===0)for(var m=0;m<f.length;m++){var v=m%u.length,y=m%l.length,g=i(u[2*v],u[2*v+1],l[2*y],l[2*y+1]);f[m]=g.real,d[m]=g.imag}else{var _=this.bufferSync(this.data.get(n.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),x=function(S){var A=s.indexToLoc(S),T=A.slice(-n.rank);c.forEach(function(N){return T[N]=0});var E=_.locToIndex(T),C=A.slice(-r.rank);h.forEach(function(N){return C[N]=0});var I=w.locToIndex(C),P=i(u[2*E],u[2*E+1],l[2*I],l[2*I+1]);f[S]=P.real,d[S]=P.imag};for(m=0;m<f.length;m++)x(m)}return this.complex(s.toTensor(),a.toTensor())},e.prototype.split=function(n,r,i){return VA(n,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(n,r,i,o,s,a){for(var u=n.shape,l=u[0],c=u[1],h=u[2],f=u[3],d=r.shape[0],m=o[0],v=o[1],y=Ae([d,m,v,f],"float32"),g=this.readSync(r.dataId),_=this.readSync(i.dataId),w=this.readSync(n.dataId),x=n.strides,S=y.strides,A=0;A<d;A++){var T=4*A,E=g[T],C=g[T+1],I=g[T+2],P=g[T+3],N=_[A];if(!(N>=l))for(var k=m>1?(I-E)*(c-1)/(m-1):0,j=v>1?(P-C)*(h-1)/(v-1):0,W=0;W<m;W++){var q=m>1?E*(c-1)+W*k:.5*(E+I)*(c-1);if(q<0||q>c-1)for(var X=0;X<v;X++)for(var V=0;V<f;V++){var z=V+X*S[2]+W*S[1]+A*S[0];y.values[z]=a}else if(s==="bilinear"){var U=Math.floor(q),Q=Math.ceil(q),te=q-U;for(X=0;X<v;X++)if((Ee=v>1?C*(h-1)+X*j:.5*(C+P)*(h-1))<0||Ee>h-1)for(V=0;V<f;V++)z=V+X*S[2]+W*S[1]+A*S[0],y.values[z]=a;else{var ie=Math.floor(Ee),we=Math.ceil(Ee),_e=Ee-ie;for(V=0;V<f;V++){var ce=w[z=V+ie*x[2]+U*x[1]+N*x[0]],be=w[z=V+we*x[2]+U*x[1]+N*x[0]],xe=w[z=V+ie*x[2]+Q*x[1]+N*x[0]],Se=ce+(be-ce)*_e,qe=xe+(w[z=V+we*x[2]+Q*x[1]+N*x[0]]-xe)*_e;z=V+X*S[2]+W*S[1]+A*S[0],y.values[z]=Se+(qe-Se)*te}}}else for(X=0;X<v;++X){var Ee;if((Ee=v>1?C*(h-1)+X*j:.5*(C+P)*(h-1))<0||Ee>h-1)for(V=0;V<f;V++)z=V+X*S[2]+W*S[1]+A*S[0],y.values[z]=a;else{var Le=Math.round(Ee),Ve=Math.round(q);for(V=0;V<f;V++){var st=V+Le*x[2]+Ve*x[1]+N*x[0],at=V+X*S[2]+W*S[1]+A*S[0];y.values[at]=w[st]}}}}}return y.toTensor()},e.prototype.sparseToDense=function(n,r,i,o){var s=jd(0,n,i),a=s.sliceRank,u=s.numUpdates,l=s.sliceSize,c=s.strides,h=s.outputSize;return this.scatter(n,r,i,h,l,u,a,c,o,!1)},e.prototype.gatherND=function(n,r){var i=r.shape,o=i[i.length-1],s=RA(n,r),a=s[0],u=s[1],l=s[2],c=s[3];if(u===0)return cn([],a,n.dtype);for(var h=new Dc([u,l],n.dtype),f=this.readSync(r.dataId),d=this.readSync(n.dataId),m=0;m<u;m++){for(var v=[],y=0,g=0;g<o;g++){var _=f[m*o+g];y+=_*c[g],v.push(_)}if(y<0||y>=n.size/l)throw new Error("Invalid indices: "+v+" does not index into "+n.shape);for(var w=0;w<l;w++)h.values[m*l+w]=d[y*l+w]}return h.toTensor().reshape(a)},e.prototype.scatterND=function(n,r,i){var o=jd(0,n,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=se(0);return this.scatter(n,r,i,c,u,a,s,l,h,!0)},e.prototype.fill=function(n,r,i){var o=kd(i=i||oh(r),pe(n));return o.fill(r),B.makeTensor(o,n,i,this)},e.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},e.prototype.zerosLike=function(n){var r=kd(n.dtype,pe(n.shape));return this.makeOutput(r,n.shape,n.dtype)},e.prototype.linspace=function(n,r,i){return OA(n,r,i)},e.prototype.scatter=function(n,r,i,o,s,a,u,l,c,h){var f=[o/s,s],d=this.readSync(n.dataId),m=this.readSync(r.dataId);if(o===0)return cn([],i,r.dtype);var v=new Dc(f,r.dtype);v.values.fill(this.readSync(c.dataId)[0]);for(var y=0;y<a;y++){for(var g=[],_=0,w=0;w<u;w++){var x=d[y*u+w];g.push(x),_+=x*l[w]}if(_<0||_>=o/s)throw new Error("Invalid indices: "+g+" does not index into "+i);for(var S=0;S<s;S++)h?v.values[_*s+S]+=m[y*s+S]:v.values[_*s+S]=r.rank===0?m[0]:m[y*s+S]}return v.toTensor().reshape(i)},e}(DA);B.registerBackend("cpu",function(){return new kz},1);for(var Hg=0,xC=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e,o=i.boxes,s=i.scores,a=r,u=a.maxOutputSize,l=a.iouThreshold,c=a.scoreThreshold,h=a.softNmsSigma,f=n;Z(o,"NonMaxSuppressionWithScore");var d=K1(f.data.get(o.dataId).values,f.data.get(s.dataId).values,u,l,c,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n;Z(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var u=o[a];s[a]=u*u}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Oc,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,s=n;Z([i,o],Oc);var a=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values,l=function(f,d,m,v,y,g){var _=Fe(f,d),w=_.length,x=wi(_),S=Nc(y,pe(_)),A=f.length,T=d.length,E=wi(f),C=wi(d),I=Ro(f,_),P=Ro(d,_);if(I.length+P.length===0)for(var N=0;N<S.length;++N)S[N]=g(m[N%m.length],v[N%v.length]);else{var k=function(j){var W=jB(j,w,x),q=W.slice(-A);I.forEach(function(U){return q[U]=0});var X=$E(q,A,E),V=W.slice(-T);P.forEach(function(U){return V[U]=0});var z=$E(V,T,C);S[j]=g(m[X],v[z])};for(N=0;N<S.length;++N)k(N)}return[S,_]}(i.shape,o.shape,a,u,i.dtype,function(f,d){var m=f-d;return m*m}),c=l[0],h=l[1];return{dataId:s.write(c,h,i.dtype),shape:h,dtype:i.dtype}}}];Hg<xC.length;Hg++)aA(xC[Hg]);var Sa,Pz=function(t){this.variableNames=["A"];var e=In(),n=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},Nz=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=In(),n=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var Gg=0,bC=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e.pixels,o=r.numChannels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],h=[c,l],f=[c,l,o];(a||s)&&(Sa==null&&(Sa=document.createElement("canvas").getContext("2d")),Sa.canvas.width=l,Sa.canvas.height=c,Sa.drawImage(i,0,0,l,c),i=Sa.canvas);var d=n.makeTensorInfo(h,"int32");n.texData.get(d.dataId).usage=hr.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);var m=J().getBool("WEBGL_PACK")?new Nz(f):new Pz(f),v=n.runWebGLProgram(m,[d],"int32");return n.disposeData(d.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;Md("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,s=i.scores,a=r,u=a.maxOutputSize,l=a.iouThreshold,c=a.scoreThreshold,h=a.softNmsSigma,f=n,d=K1(f.readSync(o.dataId),f.readSync(s.dataId),u,l,c,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n,o=new ke(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Oc,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,s=n,a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ni("return (a - b) * (a - b);",i.shape,o.shape):new Rt("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];Gg<bC.length;Gg++)aA(bC[Gg]);for(var qg=0,EC=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:Oc,gradFunc:function(t,e){var n=e[0],r=e[1],i=se(2);return{a:function(){return An(t,An(i,Gt(n,r)))},b:function(){return An(t,An(i,Gt(r,n)))}}}}];qg<EC.length;qg++)AB(EC[qg]);var Dz=function(){function t(){}return t.prototype.fetch=function(e,n){return fetch(e,n)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},t.prototype.decode=function(e,n){return new TextDecoder(n).decode(e)},t}();J().get("IS_BROWSER")&&J().setPlatform("browser",new Dz);var Kg,Mz=function(){return require("node-fetch")},Fz=function(){function t(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(e,n){return J().global.fetch!=null?J().global.fetch(e,n):(Kg==null&&(Kg=Mz()),Kg(e,n))},t.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},t.prototype.encode=function(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(e)},t.prototype.decode=function(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)},t}();J().get("IS_NODE")&&J().setPlatform("node",new Fz);var Ly={float32:4,int32:4,uint16:2,uint8:1,bool:1},qd=4;function kk(t,e){for(var n={},r=0,i=function(a){var u=a.name,l=a.dtype,c=a.shape,h=pe(c),f=void 0;if("quantization"in a){var d=a.quantization;if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+d.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var m=Ly[d.dtype],v=t.slice(r,r+h*m),y=d.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(l==="float32")f=Float32Array.from(y,function(A){return A*d.scale+d.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(y,function(A){return Math.round(A*d.scale+d.min)})}r+=h*m}else if(l==="string"){var g=pe(a.shape);f=[];for(var _=0;_<g;_++){var w=new Uint32Array(t.slice(r,r+qd))[0];r+=qd;var x=new Uint8Array(t.slice(r,r+w));f.push(x),r+=w}}else{var S=Ly[l];if(v=t.slice(r,r+h*S),l==="float32")f=new Float32Array(v);else if(l==="int32")f=new Int32Array(v);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(v)}r+=h*S}n[u]=cn(f,c,l)},o=0,s=e;o<s.length;o++)i(s[o]);return n}function Oz(t){if(t===null)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(o){if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return n.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var Vy=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function CC(t){return Vy?Buffer.byteLength(t):new Blob([t]).size}function d_(t){var e=0;t.forEach(function(i){e+=i.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(i){n.set(new Uint8Array(i),r),r+=i.byteLength}),n.buffer}function SC(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function fh(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:CC(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:CC(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}var fr=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var i=[];return(n==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(o){var s=o(e,r);s!==null&&i.push(s)}),i},t}(),cu="://",jo=function(){function t(){this.managers={}}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerManager=function(e,n){O(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(cu)&&(e=e.slice(0,e.indexOf(cu))),O(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();O(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(e){var n=this.getInstance().managers[e];if(n==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return n},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function $f(t){if(t.indexOf(cu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+jo.getSchemes().join(","));return{scheme:t.split(cu)[0],path:t.split(cu)[1]}}function TC(t,e,n){return n===void 0&&(n=!1),he(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h;return fe(this,function(f){switch(f.label){case 0:return O(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),O((r=fr.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),O(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),i=r[0],O((o=fr.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),O(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),s=o[0],a=$f(t).scheme,u=$f(t).path,l=a===$f(t).scheme,[4,i.load()];case 1:return c=f.sent(),n&&l?[4,jo.getManager(a).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,s.save(c)];case 4:return h=f.sent(),!n||l?[3,6]:[4,jo.getManager(a).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Os="models_store",Ao="model_info_store";function Pk(){if(!J().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function By(t){var e=t.result;e.createObjectStore(Os,{keyPath:"modelPath"}),e.createObjectStore(Ao,{keyPath:"modelPath"})}var hu=function(){function t(e){if(this.indexedDB=Pk(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return t.prototype.save=function(e){return he(this,void 0,void 0,function(){return fe(this,function(n){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},t.prototype.load=function(){return he(this,void 0,void 0,function(){return fe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(e,n){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return By(s)},s.onsuccess=function(){var a=s.result;if(n==null){var u=a.transaction(Os,"readonly"),l=u.objectStore(Os).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(v){return a.close(),o(l.error)},u.oncomplete=function(){return a.close()}}else{var c,h=fh(n),f=a.transaction(Ao,"readwrite"),d=f.objectStore(Ao),m=d.put({modelPath:r.modelPath,modelArtifactsInfo:h});m.onsuccess=function(){var v=(c=a.transaction(Os,"readwrite")).objectStore(Os).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:h});v.onsuccess=function(){return i({modelArtifactsInfo:h})},v.onerror=function(y){var g=(d=f.objectStore(Ao)).delete(r.modelPath);g.onsuccess=function(){return a.close(),o(v.error)},g.onerror=function(_){return a.close(),o(v.error)}}},m.onerror=function(v){return a.close(),o(m.error)},f.oncomplete=function(){c==null?a.close():c.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},t.URL_SCHEME="indexeddb://",t}(),IC=function(t){return J().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hu.URL_SCHEME)?(e=t.slice(hu.URL_SCHEME.length),new hu(e)):null;var e};fr.registerSaveRouter(IC),fr.registerLoadRouter(IC);var Lz=function(){function t(){this.indexedDB=Pk()}return t.prototype.listModels=function(){return he(this,void 0,void 0,function(){var e=this;return fe(this,function(n){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return By(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(Ao,"readonly"),u=a.objectStore(Ao).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},t.prototype.removeModel=function(e){return he(this,void 0,void 0,function(){var n=this;return fe(this,function(r){var i;return e=(i=e).startsWith(hu.URL_SCHEME)?i.slice(hu.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return By(a)},a.onsuccess=function(){var u,l=a.result,c=l.transaction(Ao,"readwrite"),h=c.objectStore(Ao),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var d=h.delete(e),m=function(){var v=(u=l.transaction(Os,"readwrite")).objectStore(Os).delete(e);v.onsuccess=function(){return o(f.result.modelArtifactsInfo)},v.onerror=function(y){return s(f.error)}};d.onsuccess=m,d.onerror=function(v){return m(),l.close(),s(f.error)}},f.onerror=function(d){return l.close(),s(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},a.onerror=function(u){return s(a.error)}})]})})},t}();if(J().getBool("IS_BROWSER"))try{jo.registerManager(hu.URL_SCHEME,new Lz)}catch{}var Oi="/",Da="tensorflowjs_models",Nk="info",Vz="model_topology",Bz="weight_specs",jz="weight_data",Uz="model_metadata";function Dk(t){return{info:[Da,t,Nk].join(Oi),topology:[Da,t,Vz].join(Oi),weightSpecs:[Da,t,Bz].join(Oi),weightData:[Da,t,jz].join(Oi),modelMetadata:[Da,t,Uz].join(Oi)}}function Wz(t){var e=t.split(Oi);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Oi)}var fu=function(){function t(e){if(!J().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Dk(this.modelPath)}return t.prototype.save=function(e){return he(this,void 0,void 0,function(){var n,r,i;return fe(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=fh(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(Vy)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),u="",l=0,c=a.length;l<c;l++)u+=String.fromCharCode(a[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return he(this,void 0,void 0,function(){var e,n,r,i,o,s,a;return fe(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(o),n.format=s.format,n.generatedBy=s.generatedBy,n.convertedBy=s.convertedBy,n.userDefinedMetadata=s.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(l){if(Vy){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),d=0;d<h.length;++d)f.set([h.charCodeAt(d)],d);return f.buffer}(a),[2,n]})})},t.URL_SCHEME="localstorage://",t}(),RC=function(t){return J().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(fu.URL_SCHEME)?(e=t.slice(fu.URL_SCHEME.length),new fu(e)):null;var e};fr.registerSaveRouter(RC),fr.registerLoadRouter(RC);var zz=function(){function t(){O(J().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),O(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return he(this,void 0,void 0,function(){var e,n,r,i,o,s;return fe(this,function(a){for(e={},n=Da+Oi,r=Oi+Nk,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(n)&&o.endsWith(r)&&(s=Wz(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},t.prototype.removeModel=function(e){return he(this,void 0,void 0,function(){var n,r;return fe(this,function(i){var o;if(e=(o=e).startsWith(fu.URL_SCHEME)?o.slice(fu.URL_SCHEME.length):o,n=Dk(e),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},t}();if(J().getBool("IS_BROWSER"))try{jo.registerManager(fu.URL_SCHEME,new zz)}catch{}var $z="model",Hz=".json",Gz=".weights.bin";function AC(t){return new Promise(function(e){return setTimeout(e)}).then(t)}var Xg=function(){function t(e){if(!J().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),e!=null&&e.length!==0||(e=$z),this.modelTopologyFileName=e+Hz,this.weightDataFileName=e+Gz}return t.prototype.save=function(e){return he(this,void 0,void 0,function(){var n,r,i,o,s,a;return fe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,AC(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=n,[4,AC(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:fh(e)}]}})})},t.URL_SCHEME="downloads://",t}(),qz=function(){function t(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return t.prototype.load=function(){return he(this,void 0,void 0,function(){var e,n,r=this;return fe(this,function(i){return e=this.files[0],n=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){n.length===0&&o({modelTopology:c});var h=l.weightsManifest;if(h!=null){var f;try{f=r.checkManifestAndWeightFiles(h,n)}catch(y){return void s(y)}var d=[],m=[],v=[];h.forEach(function(y){y.paths.forEach(function(g){m.push(g),v.push(null)}),d.push.apply(d,y.weights)}),h.forEach(function(y){y.paths.forEach(function(g){var _=new FileReader;_.onload=function(w){var x=w.target.result,S=m.indexOf(g);v[S]=x,v.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:d,weightData:d_(v),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},_.onerror=function(w){return s("Failed to weights data from file of path '"+g+"'.")},_.readAsArrayBuffer(f[g])})})}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(u){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},t.prototype.checkManifestAndWeightFiles=function(e,n){for(var r=[],i=n.map(function(u){return SC(u.name)}),o={},s=0,a=e;s<a.length;s++)a[s].paths.forEach(function(u){var l=SC(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=n[i.indexOf(l)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return o},t}();function kC(t,e,n,r){(function(o){O(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(t),function(o,s){O(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),O(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),O(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(n=n??0,r=r??1);var i=0;return Promise.all(t.map(function(o){return o.then(function(s){var a=n+ ++i/t.length*(r-n);return e(a),s}),o}))}function Mk(t,e){return he(this,void 0,void 0,function(){var n,r,i,o,s,a,u,l,c;return fe(this,function(h){switch(h.label){case 0:return e==null&&(e={}),n=e.fetchFunc==null?J().platform.fetch:e.fetchFunc,r=t.map(function(f){return n(f,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=h.sent(),[3,4];case 2:return[4,kC(r,e.onProgress,i,o)];case 3:s=h.sent(),h.label=4;case 4:return a=s.map(function(f){return f.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return c=h.sent(),[3,8];case 6:return[4,kC(a,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function PC(t){var e=this;return function(n,r,i){return r===void 0&&(r=""),he(e,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,m;return fe(this,function(v){switch(v.label){case 0:if(o=n.map(function(){return!1}),s={},a=i!=null?i.map(function(){return!1}):[],u=[],n.forEach(function(y,g){var _=0;y.weights.forEach(function(w){var x="quantization"in w?w.quantization.dtype:w.dtype,S=Ly[x]*pe(w.shape),A=function(){o[g]=!0,s[g]==null&&(s[g]=[]),s[g].push({manifestEntry:w,groupOffset:_,sizeBytes:S})};i!=null?i.forEach(function(T,E){T===w.name&&(A(),a[E]=!0)}):A(),u.push(w.name),_+=S})}),!a.every(function(y){return y}))throw l=i.filter(function(y,g){return!a[g]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce(function(y,g,_){return g&&y.push(_),y},[]),h=[],c.forEach(function(y){n[y].paths.forEach(function(g){var _=r+(r.endsWith("/")?"":"/")+g;h.push(_)})}),[4,t(h)];case 1:return f=v.sent(),d={},m=0,c.forEach(function(y){for(var g=n[y].paths.length,_=0,w=0;w<g;w++)_+=f[m+w].byteLength;for(var x=new ArrayBuffer(_),S=new Uint8Array(x),A=0,T=0;T<g;T++){var E=new Uint8Array(f[m+T]);S.set(E,A),A+=E.byteLength}s[y].forEach(function(C){var I=kk(x.slice(C.groupOffset,C.groupOffset+C.sizeBytes),[C.manifestEntry]);for(var P in I)d[P]=I[P]}),m+=g}),[2,d]}})})}}fr.registerSaveRouter(function(t){return J().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Xg.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new Xg(e)}(t.slice(Xg.URL_SCHEME.length)):null});var Fk=function(){function t(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(O(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=J().platform.fetch,O(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&O(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return t.prototype.save=function(e){return he(this,void 0,void 0,function(){var n,r,i,o;return fe(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&n.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:fh(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},t.prototype.load=function(){return he(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,l,c,h,f;return fe(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return n=d.sent(),[3,5];case 4:throw d.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=n.modelTopology,o=n.weightsManifest,s=n.generatedBy,a=n.convertedBy,u=n.format,l=n.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=d.sent(),c=f[0],h=f[1],d.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:s,convertedBy:a,format:u}]}})})},t.prototype.loadWeights=function(e){return he(this,void 0,void 0,function(){var n,r,i,o,s,a,u,l,c,h,f;return fe(this,function(d){switch(d.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(m){var v=m.lastIndexOf("/"),y=m.lastIndexOf("?"),g=m.substring(0,v),_=y>v?m.substring(y):"";return[g+"/",_]}(n),i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,l=e;u<l.length;u++)c=l[u],a.push.apply(a,c.weights);return h=[],e.forEach(function(m){m.paths.forEach(function(v){h.push(s+v+o)})}),[4,Mk(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[a,d_(f)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function jy(t){return t.match(Fk.URL_SCHEME_REGEX)!=null}var NC=function(t,e){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(n){return jy(n)}):jy(t))?Uy(t,{onProgress:e}):null};function Uy(t,e){return new Fk(t,e)}fr.registerSaveRouter(NC),fr.registerLoadRouter(NC);var Yg=function(){function t(e){this.modelArtifacts=e}return t.prototype.load=function(){return he(this,void 0,void 0,function(){return fe(this,function(e){return[2,this.modelArtifacts]})})},t}(),Kz=function(){function t(e){this.saveHandler=e}return t.prototype.save=function(e){return he(this,void 0,void 0,function(){return fe(this,function(n){return[2,this.saveHandler(e)]})})},t}(),Ok=Object.freeze({browserFiles:function(t){return new qz(t)},browserHTTPRequest:function(t,e){return Uy(t,e)},concatenateArrayBuffers:d_,decodeWeights:kk,encodeWeights:function(t,e){return he(this,void 0,void 0,function(){var n,r,i,o,s,a=this;return fe(this,function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(t)?t.map(function(l){return l.name}):Object.keys(t),o=function(l){var c=i[l],h=Array.isArray(t)?t[l].tensor:t[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var f={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(m){return he(a,void 0,void 0,function(){var v,y,g,_,w,x,S;return fe(this,function(A){switch(A.label){case 0:return[4,h.bytes()];case 1:for(v=A.sent(),y=v.reduce(function(T,E){return T+E.length},0)+qd*v.length,g=new Uint8Array(y),_=0,w=0;w<v.length;w++)x=v[w],S=new Uint8Array(new Uint32Array([x.length]).buffer),g.set(S,_),_+=qd,g.set(x,_),_+=x.length;return m(g),[2]}})})});r.push(d)}else r.push(h.data());e!=null&&(f.group=e),n.push(f)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:Oz(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new Yg(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Yg({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Yg({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return fr.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:fh,getSaveHandlers:function(t){return fr.getSaveHandlers(t)},http:Uy,isHTTPScheme:jy,loadWeights:function(t,e,n,r){return e===void 0&&(e=""),he(this,void 0,void 0,function(){return fe(this,function(i){return[2,PC(function(o){return Mk(o,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return fr.registerLoadRouter(t)},registerSaveRouter:function(t){return fr.registerSaveRouter(t)},weightsLoaderFactory:PC,withSaveHandler:function(t){return new Kz(t)},copyModel:function(t,e){return he(this,void 0,void 0,function(){return fe(this,function(n){return[2,TC(t,e,!1)]})})},listModels:function(){return he(this,void 0,void 0,function(){var t,e,n,r,i,o,s;return fe(this,function(a){switch(a.label){case 0:t=jo.getSchemes(),e={},n=0,r=t,a.label=1;case 1:return n<r.length?(i=r[n],[4,jo.getManager(i).listModels()]):[3,4];case 2:for(s in o=a.sent())e[i+cu+s]=o[s];a.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return he(this,void 0,void 0,function(){return fe(this,function(n){return[2,TC(t,e,!0)]})})},removeModel:function(t){return he(this,void 0,void 0,function(){var e;return fe(this,function(n){return e=$f(t),[2,jo.getManager(e.scheme).removeModel(e.path)]})})}}),Ta;L({confusionMatrix_:function(t,e,n){var r=M(t,"labels","confusionMatrix"),i=M(e,"predictions","confusionMatrix");O(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),O(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),O(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),O(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),O(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var o=Ny(r.asType("int32"),n),s=Ny(i.asType("int32"),n);return o.transpose().matMul(s).asType("int32")}});var Xz=L({fromPixels_:function(t,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,o=!1,s=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)o=!0;else{if(t.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);s=!0}if(i&&i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(sA("FromPixels",B.backendName)!=null)return B.runKernel("FromPixels",{pixels:t},{numChannels:e});var a,u,l=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],c=l[0],h=l[1];if(s?a=t.getContext("2d").getImageData(0,0,c,h).data:r||n?a=t.data:(o||i)&&(Ta==null&&(Ta=document.createElement("canvas").getContext("2d")),Ta.canvas.width=c,Ta.canvas.height=h,Ta.drawImage(t,0,0,c,h),a=Ta.getImageData(0,0,c,h).data),e===4)u=new Int32Array(a);else{var f=c*h;u=new Int32Array(f*e);for(var d=0;d<f;d++)for(var m=0;m<e;++m)u[d*e+m]=a[4*d+m]}return W1(u,[h,c,e],"int32")}}),p_=Object.freeze({toPixels:function(t,e){return he(this,void 0,void 0,function(){var n,r,i,o,s,a,u,l,c,h,f,d,m,v,y,g,_,w,x,S,A,T,E;return fe(this,function(C){switch(C.label){case 0:if(n=M(t,"img","toPixels"),t instanceof _t||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],(s=n.rank===2?1:n.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,n.data()];case 1:return a=C.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=C.sent(),h=c[0],f=c[1],d=h[0],m=f[0],u.dispose(),l.dispose(),n.dtype==="float32"){if(d<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+m+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(d<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+m+"].")}for(v=n.dtype==="float32"?255:1,y=new Uint8ClampedArray(o*i*4),g=0;g<i*o;++g)_=void 0,w=void 0,x=void 0,S=void 0,s===1?(_=a[g]*v,w=a[g]*v,x=a[g]*v,S=255):s===3?(_=a[3*g]*v,w=a[3*g+1]*v,x=a[3*g+2]*v,S=255):s===4&&(_=a[4*g]*v,w=a[4*g+1]*v,x=a[4*g+2]*v,S=a[4*g+3]*v),y[(A=4*g)+0]=Math.round(_),y[A+1]=Math.round(w),y[A+2]=Math.round(x),y[A+3]=Math.round(S);return e!=null&&(e.width=o,e.height=i,T=e.getContext("2d"),E=new ImageData(y,o,i),T.putImageData(E,0,0)),n!==t&&n.dispose(),[2,y]}})})},fromPixels:Xz}),Yz=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(e,n){return new e(n)},t}(),Qz=function(){function t(){this.classNameMap={}}return t.getMap=function(){return t.instance==null&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function da(t){O(t.className!=null,function(){return"Class being registered does not have the static className property defined."}),O(typeof t.className=="string",function(){return"className is required to be a string, but got type "+typeof t.className}),O(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Qz.register(t)}var pa=function(t){function e(){return t!==null&&t.apply(this,arguments)||this}return ei(e,t),e.prototype.minimize=function(n,r,i){r===void 0&&(r=!1);var o=this.computeGradients(n,i),s=o.value,a=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:a[l.name]}});this.applyGradients(u)}else this.applyGradients(a);return tr(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(n,r){return a5(n,r)},e.prototype.dispose=function(){this.iterations_!=null&&tr(this.iterations_)},e.prototype.saveIterations=function(){return he(this,void 0,void 0,function(){return fe(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:se(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){return fe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(n){return he(this,void 0,void 0,function(){var r;return fe(this,function(i){switch(i.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,n.slice(1)]}})})},e}(Yz);Object.defineProperty(pa,Symbol.hasInstance,{value:function(t){return t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null}});var Jz=function(t){function e(n,r,i){i===void 0&&(i=null);var o=t.call(this)||this;return o.learningRate=n,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=B.backend.epsilon()),o}return ei(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=B.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:ue(function(){return $e(s).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:ue(function(){return $e(s).variable(!1)})});var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;ue(function(){var c=u.mul(r.rho).add(a.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),f=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(f);var d=h.mul(-r.learningRate).add(s);s.assign(d)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(tr(this.accumulatedGrads.map(function(n){return n.variable})),tr(this.accumulatedUpdates.map(function(n){return n.variable})))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var n;return fe(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){var r;return fe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(pa);da(Jz);var Zz=function(t){function e(n,r){r===void 0&&(r=.1);var i=t.call(this)||this;return i.learningRate=n,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return ei(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=B.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:ue(function(){return xi(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var u=r.accumulatedGrads[o].variable;ue(function(){var l=u.add(a.square());u.assign(l);var c=a.div(l.add(B.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&tr(this.accumulatedGrads.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){return fe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(pa);da(Zz);var e9=function(t){function e(n,r,i,o){o===void 0&&(o=null);var s=t.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],ue(function(){s.accBeta1=se(r).variable(),s.accBeta2=se(i).variable()}),o==null&&(s.epsilon=B.backend.epsilon()),s}return ei(e,t),e.prototype.applyGradients=function(n){var r=this,i=Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n);ue(function(){var o=Gt(1,r.accBeta1),s=Gt(1,r.accBeta2);i.forEach(function(a,u){var l=B.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:ue(function(){return $e(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:ue(function(){return $e(l).variable(!1)})});var c=Array.isArray(n)?n[u].tensor:n[a];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),m=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),v=d.div(o),y=m.div(s);h.assign(d),f.assign(m);var g=v.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(g)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&tr(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&tr(this.accumulatedSecondMoment.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var n;return fe(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){var r,i=this;return fe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),ue(function(){i.accBeta1.assign(Hd(i.beta1,i.iterations_+1)),i.accBeta2.assign(Hd(i.beta2,i.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(pa);da(e9);var t9=function(t){function e(n,r,i,o,s){o===void 0&&(o=null),s===void 0&&(s=0);var a=t.call(this)||this;return a.learningRate=n,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],ue(function(){a.iteration=se(0).variable(),a.accBeta1=se(r).variable()}),o==null&&(a.epsilon=B.backend.epsilon()),a}return ei(e,t),e.prototype.applyGradients=function(n){var r=this,i=Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n);ue(function(){var o=Gt(1,r.accBeta1),s=jr(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var l=B.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:$e(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:$e(l).variable(!1)});var c=Array.isArray(n)?n[u].tensor:n[a];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),m=f.mul(r.beta2),v=c.abs(),y=m.maximum(v);h.assign(d),f.assign(y);var g=s.div(o).mul(d.div(y.add(r.epsilon))).add(l);l.assign(g)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&tr(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&tr(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){return fe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(pa);da(t9);var Lk=function(t){function e(n){var r=t.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return ei(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=Array.isArray(n)?n[o].tensor:n[i];if(s!=null){var a=B.registeredVariables[i];ue(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=x6(se(-n))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){return fe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(n,r){return new n(r.learningRate)},e.className="SGD",e}(pa);da(Lk);var n9=function(t){function e(n,r,i){i===void 0&&(i=!1);var o=t.call(this,n)||this;return o.learningRate=n,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=se(o.momentum),o}return ei(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=B.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:ue(function(){return $e(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(n)?n[o].tensor:n[i];u!=null&&ue(function(){var l,c=r.m.mul(a).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(s):r.c.mul(c).add(s),a.assign(c),s.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&tr(this.accumulations.map(function(n){return n.variable}))},e.prototype.setMomentum=function(n){this.momentum=n},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return fe(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){return fe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(Lk);da(n9);var r9=function(t){function e(n,r,i,o,s){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),s===void 0&&(s=!1);var a=t.call(this)||this;if(a.learningRate=n,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,o==null&&(a.epsilon=B.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return ei(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var s=B.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:ue(function(){return $e(s).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:ue(function(){return $e(s).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:ue(function(){return $e(s).variable(!1)})});var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;ue(function(){var c=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,f=h.mul(r.decay).add(a.mul(1-r.decay)),d=l.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(d);var m=s.sub(d);s.assign(m)}else{var v=u.mul(r.decay).add(a.square().mul(1-r.decay));d=l.mul(r.momentum).add(a.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),l.assign(d),m=s.sub(d),s.assign(m)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&tr(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&tr(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&tr(this.accumulatedMoments.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var n;return fe(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return he(this,void 0,void 0,function(){var r;return fe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(pa);da(r9);_t.prototype.squaredDifference=function(t){return JA(this,t)},K=Az;var Wy=function(t,e){return Wy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Wy(t,e)};function Re(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Wy(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var En=function(){return En=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},En.apply(this,arguments)};function ve(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(c){try{l(r.next(c))}catch(h){s(h)}}function u(c){try{l(r.throw(c))}catch(h){s(h)}}function l(c){c.done?o(c.value):i(c.value).then(a,u)}l((r=r.apply(t,e||[])).next())})}function ye(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function tc(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var du=function(){function t(e,n){if(!Ws(e)||!Ws(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:n}));this._width=e,this._height=n}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function tm(t,e){return t instanceof _t&&t.shape.length===e}function i9(t){return tm(t,2)}function nm(t){return tm(t,3)}function Uo(t){return tm(t,4)}function o9(t){return t%1!==0}function DC(t){return t%2===0}function s9(t,e){e===void 0&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function MC(t){return t&&t.width&&t.height}function a9(t,e){var n=t.width,r=t.height,i=e/Math.max(r,n);return new du(Math.round(n*i),Math.round(r*i))}function m_(t){return t.reduce(function(e,n){return e.add(n)},new Ge(0,0)).div(new Ge(t.length,t.length))}function Lc(t,e,n){return Array(t).fill(0).map(function(r,i){return e+i*n})}function Ws(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||t===0}function FC(t){return Ws(t)&&0<=t&&t<=1}var Ge=function(){function t(e,n){this._x=e,this._y=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),Zo=function(){function t(e,n){n===void 0&&(n=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Ws),o=[r.x,r.y,r.width,r.height].every(Ws);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],u=s[1],l=s[2],c=s[3];t.assertIsValidBox({x:a,y:u,width:l,height:c},"Box.constructor",n),this._x=a,this._y=u,this._width=l,this._height=c}return t.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Ws)},t.assertIsValidBox=function(e,n,r){if(r===void 0&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new Ge(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new Ge(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new Ge(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new Ge(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),n=e[0],r=e[1],i=e[2],o=e[3];return new t({x:n,y:r,width:i,height:o})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),n=e[0],r=e[1],i=e[2],o=e[3];return new t({x:n,y:r,width:i,height:o})},t.prototype.toSquare=function(){var e=this,n=e.x,r=e.y,i=e.width,o=e.height,s=Math.abs(i-o);return i<o&&(n-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new t({x:n,y:r,width:i,height:o})},t.prototype.rescale=function(e){var n=MC(e)?e.width:e,r=MC(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n],i=r[0],o=r[1],s=r[2],a=r[3];return new t({x:i,y:o,width:s,height:a})},t.prototype.clipAtImageBorders=function(e,n){var r=this,i=r.x,o=r.y,s=r.right,a=r.bottom,u=Math.max(i,0),l=Math.max(o,0),c=s-u,h=a-l,f=Math.min(c,e-u),d=Math.min(h,n-l);return new t({x:u,y:l,width:f,height:d}).floor()},t.prototype.shift=function(e,n){var r=this,i=r.width,o=r.height,s=this.x+e,a=this.y+n;return new t({x:s,y:a,width:i,height:o})},t.prototype.padAtBorders=function(e,n){var r=this.width+1,i=this.height+1,o=1,s=1,a=r,u=i,l=this.left,c=this.top,h=this.right,f=this.bottom;return h>n&&(a=-h+n+r,h=n),f>e&&(u=-f+e+i,f=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:s,edy:u,dx:o,edx:a,y:c,ey:f,x:l,ex:h,w:r,h:i}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),rm=function(t){Re(e,t);function e(n,r,i,o,s){return s===void 0&&(s=!1),t.call(this,{left:n,top:r,right:i,bottom:o},s)||this}return e}(Zo),Vk=function(){function t(e,n,r,i,o){this._imageDims=new du(o.width,o.height),this._score=e,this._classScore=n,this._className=r,this._box=new Zo(i).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new Zo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),Ri=function(t){Re(e,t);function e(n,r,i){return t.call(this,n,n,"",r,i)||this}return e.prototype.forSize=function(n,r){var i=t.prototype.forSize.call(this,n,r),o=i.score,s=i.relativeBox,a=i.imageDims;return new e(o,s,a)},e}(Vk);function u9(t,e,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left)),i=Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top)),o=r*i;return n?o/(t.area+e.area-o):o/Math.min(t.area,e.area)}function l9(t){var e=t.map(function(a){return a.x}),n=t.map(function(a){return a.y}),r=e.reduce(function(a,u){return u<a?u:a},1/0),i=n.reduce(function(a,u){return u<a?u:a},1/0),o=e.reduce(function(a,u){return a<u?u:a},0),s=n.reduce(function(a,u){return a<u?u:a},0);return new rm(r,i,o,s)}function Vc(t,e,n,r){r===void 0&&(r=!0);for(var i=e.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var u=i,l=[],c=0;c<u.length;c++){var h=u[c],f=t[a],d=t[h];l.push(u9(f,d,r))}i=i.filter(function(m,v){return l[v]<=n})};i.length>0;)s();return o}function dh(t,e){return ue(function(){var n=e[0],r=e[1],i=e[2],o=xi(tc(t.shape.slice(0,3),[1]),n),s=xi(tc(t.shape.slice(0,3),[1]),r),a=xi(tc(t.shape.slice(0,3),[1]),i),u=zt([o,s,a],3);return Gt(t,u)})}function c9(t,e){return e===void 0&&(e=!1),ue(function(){var n=t.shape.slice(1),r=n[0],i=n[1];if(r===i)return t;var o=Math.abs(r-i),s=Math.round(o*(e?.5:1)),a=r>i?2:1,u=function(d){var m=t.shape.slice();return m[a]=d,xi(m,0)},l=u(s),c=o-l.shape[a],h=e&&c?u(c):null,f=[h,t,l].filter(function(d){return!!d}).map(function(d){return d.toFloat()});return zt(f,a)})}function Qg(t){return 1/(1+Math.exp(-t))}var g_=function(t){Re(e,t);function e(n,r,i,o,s){return s===void 0&&(s=!1),t.call(this,{x:n,y:r,width:i,height:o},s)||this}return e}(Zo),h9=.5,f9=.43,d9=.45,Kd=function(){function t(e,n,r){r===void 0&&(r=new Ge(0,0));var i=n.width,o=n.height;this._imgDims=new du(i,o),this._shift=r,this._positions=e.map(function(s){return s.mul(new Ge(i,o)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new Ge(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(n){return n.sub(e._shift).div(new Ge(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new this.constructor(this.relativePositions,{width:e,height:n})},t.prototype.shiftBy=function(e,n){return new this.constructor(this.relativePositions,this._imgDims,new Ge(e,n))},t.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},t.prototype.align=function(e,n){if(n===void 0&&(n={}),e){var r=e instanceof Ri?e.box.floor():new Zo(e);return this.shiftBy(r.x,r.y).align(null,n)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),o=i.useDlibAlignment,s=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(s)},t.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),n=e[0],r=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},s=(o(n)+o(r))/2,a=Math.floor(s/d9),u=m_(e),l=Math.floor(Math.max(0,u.x-h9*a)),c=Math.floor(Math.max(0,u.y-f9*a));return new g_(l,c,Math.min(a,this.imageWidth+l),Math.min(a,this.imageHeight+c))},t.prototype.alignMinBbox=function(e){var n=l9(this.positions);return n.pad(n.width*e,n.height*e)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),p9=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],m_([n[3],n[4]])]},e}(Kd),m9=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(m_)},e}(Kd),OC=function(){function t(e,n){this._label=e,this._distance=n}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+s9(this.distance)+")":"")},t}(),LC=function(t){Re(e,t);function e(n,r){var i=t.call(this,n)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(n,r){if(Zo.assertIsValidBox(n,r),!Ws(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Zo),vf=function(){function t(e,n){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=n}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(r){return new Float32Array(r)});return new t(e.label,n)},t}();(function(t){Re(e,t);function e(n,r,i,o){var s=t.call(this,n,r)||this;return s._score=i,s._classScore=o,s}return e.assertIsValidPredictedBox=function(n,r){if(LC.assertIsValidLabeledBox(n,r),!FC(n.score)||!FC(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(LC);function g9(t){return t.detection instanceof Ri}function v_(t,e){var n={detection:e};return Object.assign({},t,n)}function Bk(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:e}}function jk(t){var e="";if(!t)try{t=require("fs")}catch(r){e=r.toString()}var n=t?function(r){return new Promise(function(i,o){t.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:n}}function Uk(){var t=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,n=function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=jk();return En({Canvas:t||function(){function s(){}return s}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function s(){}return s}(),Image:e||function(){function s(){}return s}(),ImageData:global.ImageData||function(){function s(){}return s}(),Video:global.HTMLVideoElement||function(){function s(){}return s}(),createCanvasElement:n,createImageElement:r,fetch:i},o)}function Wk(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function zk(){return typeof global=="object"&&typeof require=="function"&&typeof dM<"u"&&typeof process<"u"&&!!process.version}var jt;function v9(){if(!jt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return jt}function zy(t){jt=t}function y_(){Wk()&&zy(Bk()),zk()&&zy(Uk())}function y9(t){if(jt||y_(),!jt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=e===void 0?jt.Canvas:e,r=t.Image,i=r===void 0?jt.Image:r;jt.Canvas=n,jt.Image=i,jt.createCanvasElement=t.createCanvasElement||function(){return new n},jt.createImageElement=t.createImageElement||function(){return new i},jt.ImageData=t.ImageData||jt.ImageData,jt.Video=t.Video||jt.Video,jt.fetch=t.fetch||jt.fetch,jt.readFile=t.readFile||jt.readFile}var Dn={getEnv:v9,setEnv:zy,initialize:y_,createBrowserEnv:Bk,createFileSystem:jk,createNodejsEnv:Uk,monkeyPatch:y9,isBrowser:Wk,isNodejs:zk};y_();function $k(t){return!Dn.isNodejs()&&typeof t=="string"?document.getElementById(t):t}function Qs(t){var e=Dn.getEnv(),n=e.Canvas,r=e.CanvasRenderingContext2D;if(t instanceof r)return t;var i=$k(t);if(!(i instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var VC;(function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"})(VC||(VC={}));function Hk(t){var e=Dn.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function _9(t){return new Promise(function(e,n){if(t instanceof Dn.getEnv().Canvas||Hk(t))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),n(o))}t.addEventListener("load",r),t.addEventListener("error",i)})}function Gk(t){var e=Dn.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new du(t.naturalWidth,t.naturalHeight):t instanceof r?new du(t.videoWidth,t.videoHeight):new du(t.width,t.height)}function im(t){var e=t.width,n=t.height,r=Dn.getEnv().createCanvasElement,i=r();return i.width=e,i.height=n,i}function __(t,e){var n=Dn.getEnv().ImageData;if(!(t instanceof n)&&!Hk(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=Gk(t),i=r.width,o=r.height,s=im({width:i,height:o});return t instanceof n?Qs(s).putImageData(t,0,0):Qs(s).drawImage(t,0,0,i,o),s}function w9(t,e){return ve(this,void 0,void 0,function(){var n,r,i,o,s,a;return ye(this,function(u){switch(u.label){case 0:return n=Dn.getEnv().createCanvasElement(),r=t.shape.slice(Uo(t)?1:0),i=r[0],o=r[1],s=r[2],a=ue(function(){return t.as3D(i,o,s).toInt()}),[4,p_.toPixels(a,n)];case 1:return u.sent(),a.dispose(),[2,n]}})})}function BC(t){var e=Dn.getEnv(),n=e.Image,r=e.Canvas,i=e.Video;return t instanceof n||t instanceof r||t instanceof i}function x9(t,e,n){n===void 0&&(n=!1);var r=Dn.getEnv(),i=r.Image,o=r.Canvas;if(!(t instanceof i||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=Gk(t),a=e/Math.max(s.height,s.width),u=a*s.width,l=a*s.height,c=im({width:e,height:e}),h=t instanceof o?t:__(t),f=Math.abs(u-l)/2,d=n&&u<l?f:0,m=n&&l<u?f:0;return Qs(c).drawImage(h,d,m,u,l),c}var Xd=function(){function t(e,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=n,this._batchSize=e.length,e.forEach(function(i,o){if(nm(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(Uo(i)){var s=i.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var a=i instanceof Dn.getEnv().Canvas?i:__(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Lc(this.batchSize,0,1).map(function(n,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},t.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},t.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},t.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},t.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(e),r=this.getInputHeight(e);return a9({width:n,height:r},this.inputSize)},t.prototype.toBatchTensor=function(e,n){var r=this;return n===void 0&&(n=!0),this._inputSize=e,ue(function(){var i=Lc(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof _t){var u=Uo(a)?a:a.expandDims();return u=c9(u,n),(u.shape[1]!==e||u.shape[2]!==e)&&(u=u_.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(a instanceof Dn.getEnv().Canvas)return p_.fromPixels(x9(a,e,n));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),o=mr(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3);return o})},t}();function on(t){return ve(this,void 0,void 0,function(){var e,n,r;return ye(this,function(i){switch(i.label){case 0:if(t instanceof Xd)return[2,t];if(e=Array.isArray(t)?t:[t],!e.length)throw new Error("toNetInput - empty array passed as input");return n=function(o){return Array.isArray(t)?" at input index "+o+":":""},r=e.map($k),r.forEach(function(o,s){if(!BC(o)&&!nm(o)&&!Uo(o))throw typeof e[s]=="string"?new Error("toNetInput -"+n(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+n(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Uo(o)){var a=o.shape[0];if(a!==1)throw new Error("toNetInput -"+n(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return BC(o)&&_9(o)}))];case 1:return i.sent(),[2,new Xd(r,Array.isArray(t))]}})})}function w_(t,e){return ve(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return ye(this,function(l){switch(l.label){case 0:return n=Dn.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,on(t)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof n?(s=o,[3,4]):[3,2];case 2:return[4,w9(o)];case 3:s=l.sent(),l.label=4;case 4:r=s,l.label=5;case 5:return a=Qs(r),u=e.map(function(c){return c instanceof Ri?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,f=c.y,d=c.width,m=c.height,v=im({width:d,height:m});return Qs(v).putImageData(a.getImageData(h,f,d,m),0,0),v})]}})})}function x_(t,e){return ve(this,void 0,void 0,function(){return ye(this,function(n){if(!nm(t)&&!Uo(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Uo(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ue(function(){var r=t.shape.slice(Uo(t)?1:0),i=r[0],o=r[1],s=r[2],a=e.map(function(l){return l instanceof Ri?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=a.map(function(l){var c=l.x,h=l.y,f=l.width,d=l.height;return _k(t.as3D(i,o,s),[h,c,0],[d,f,s])});return u})]})})}function b9(t,e){return ve(this,void 0,void 0,function(){var n,r;return ye(this,function(i){switch(i.label){case 0:return n=Dn.getEnv().fetch,[4,n(t,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function E9(t){return ve(this,void 0,void 0,function(){return ye(this,function(e){switch(e.label){case 0:return[4,b9(t)];case 1:return[2,e.sent().json()]}})})}function qk(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if(t==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"";t=t.replace(r,"");var i=t.split("/").filter(function(a){return a}),o=t.endsWith(".json")?i[i.length-1]:n,s=r+(t.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=t.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+o:s+"/"+o}}function C9(t,e){return ve(this,void 0,void 0,function(){var n,r,i,o;return ye(this,function(s){switch(s.label){case 0:return n=qk(t,e),r=n.manifestUri,i=n.modelBaseUri,[4,E9(r)];case 1:return o=s.sent(),[2,Ok.loadWeights(o,i)]}})})}var oo=function(){function t(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(e){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;return r[i]},t.prototype.reassignParamFromPath=function(e,n){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=n},t.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Au})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Au)})},t.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(n){var r=n.path,i=n.tensor;e.reassignParamFromPath(r,i.variable())})},t.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(n){var r=n.path,i=n.tensor,o=cn(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(n){if(e&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var n=e.tensor;return Array.from(n.dataSync())}).reduce(function(e,n){return e.concat(n)}))},t.prototype.load=function(e){return ve(this,void 0,void 0,function(){return ye(this,function(n){switch(n.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return n.sent(),[2]}})})},t.prototype.loadFromUri=function(e){return ve(this,void 0,void 0,function(){var n;return ye(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,C9(e,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},t.prototype.loadFromDisk=function(e){return ve(this,void 0,void 0,function(){var n,r,i,o,s,a,u,l,c,h;return ye(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Dn.getEnv().readFile,r=qk(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,s=function(d){return Promise.all(d.map(function(m){return n(m).then(function(v){return v.buffer})}))},a=Ok.weightsLoaderFactory(s),c=(l=JSON).parse,[4,n(i)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,a(u,o)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},t.prototype.loadFromWeightMap=function(e){var n=this.extractParamsFromWeigthMap(e),r=n.paramMappings,i=n.params;this._paramMappings=r,this._params=i},t.prototype.extractWeights=function(e){var n=this.extractParams(e),r=n.paramMappings,i=n.params;this._paramMappings=r,this._params=i},t.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=e.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=n.obj,i=n.objProp;if(!r||!i||!(r[i]instanceof _t))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},t}();function dr(t,e,n){return ue(function(){var r=r_(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=Me(r,e.bias),r})}function Jg(t,e,n){return n===void 0&&(n=!1),ue(function(){var r=bt(n?Me(Fr(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):dr(t,e.conv0,[2,2])),i=dr(r,e.conv1,[1,1]),o=bt(Me(r,i)),s=dr(o,e.conv2,[1,1]);return bt(Me(r,Me(i,s)))})}function yf(t,e,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),ue(function(){var i=bt(n?Me(Fr(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):dr(t,e.conv0,r?[2,2]:[1,1])),o=dr(i,e.conv1,[1,1]),s=bt(Me(i,o)),a=dr(s,e.conv2,[1,1]),u=bt(Me(i,Me(o,a))),l=dr(u,e.conv3,[1,1]);return bt(Me(i,Me(o,Me(a,l))))})}function Yr(t,e,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),ue(function(){var i=Me(Fr(t,e.filters,[1,1],n),e.bias);return r?bt(i):i})}function so(t,e){Object.keys(t).forEach(function(n){e.some(function(r){return r.originalPath===n})||t[n].dispose()})}function om(t,e){return function(n,r,i,o){var s=Kn(t(n*r*i*i),[i,i,n,r]),a=Lt(t(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function b_(t,e){return function(n,r,i){var o=Bo(t(n*r),[n,r]),s=Lt(t(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var Kk=function(){function t(e,n,r){this.depthwise_filter=e,this.pointwise_filter=n,this.bias=r}return t}();function E_(t,e){return function(n,r,i){var o=Kn(t(9*n),[3,3,n,1]),s=Kn(t(n*r),[1,1,n,r]),a=Lt(t(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new Kk(o,s,a)}}function C_(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),i=t(e+"/bias",1);return new Kk(n,r,i)}}function hs(t,e){return function(n,r,i){var o=t[n];if(!tm(o,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:n,paramPath:i||n}),o}}function ao(t){var e=t;function n(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:n,getRemainingWeights:r}}function Xk(t,e){var n=om(t,e),r=E_(t,e);function i(s,a,u,l){l===void 0&&(l=!1);var c=l?n(s,a,3,u+"/conv0"):r(s,a,u+"/conv0"),h=r(a,a,u+"/conv1"),f=r(a,a,u+"/conv2");return{conv0:c,conv1:h,conv2:f}}function o(s,a,u,l){l===void 0&&(l=!1);var c=i(s,a,u,l),h=c.conv0,f=c.conv1,d=c.conv2,m=r(a,a,u+"/conv3");return{conv0:h,conv1:f,conv2:d,conv3:m}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function S9(t){var e=[],n=ao(t),r=n.extractWeights,i=n.getRemainingWeights,o=Xk(r,e).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u,dense3:l}}}function Yk(t){return function(e){var n=t(e+"/filters",4),r=t(e+"/bias",1);return{filters:n,bias:r}}}function Qk(t,e){var n=hs(t,e),r=Yk(n),i=C_(n);function o(a,u){u===void 0&&(u=!1);var l=u?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),h=i(a+"/conv2");return{conv0:l,conv1:c,conv2:h}}function s(a,u){u===void 0&&(u=!1);var l=u?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),h=i(a+"/conv2"),f=i(a+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:s}}function T9(t){var e=[],n=Qk(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return so(t,e),{params:r,paramMappings:e}}var Jk=function(t){Re(e,t);function e(){return t.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ue(function(){var i=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=dh(i,o).div(se(255)),a=yf(s,r.dense0,!0);return a=yf(a,r.dense1),a=yf(a,r.dense2),a=yf(a,r.dense3),a=hh(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(n){return T9(n)},e.prototype.extractParams=function(n){return S9(n)},e}(oo);function pi(t,e){return ue(function(){return Me(Jp(t,e.weights),e.bias)})}function I9(t,e,n){var r=[],i=ao(t),o=i.extractWeights,s=i.getRemainingWeights,a=b_(o,r),u=a(e,n,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:u}}}function R9(t){var e=[],n=hs(t,e);function r(o){var s=n(o+"/weights",2),a=n(o+"/bias",1);return{weights:s,bias:a}}var i={fc:r("fc")};return so(t,e),{params:i,paramMappings:e}}function Zk(t){var e={},n={};return Object.keys(t).forEach(function(r){var i=r.startsWith("fc")?n:e;i[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var eP=function(t){Re(e,t);function e(n,r){var i=t.call(this,n)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(n){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ue(function(){var o=n instanceof Xd?r.faceFeatureExtractor.forwardInput(n):n;return pi(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),t.prototype.dispose.call(this,n)},e.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(n){return I9(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(n){var r=Zk(n),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),R9(o)},e.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=n.slice(0,n.length-o),a=n.slice(n.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e}(oo),jC=["neutral","happy","sad","angry","fearful","disgusted","surprised"],A9=function(){function t(e){var n=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);jC.forEach(function(r,i){n[r]=e[i]})}return t.prototype.asSortedArray=function(){var e=this;return jC.map(function(n){return{expression:n,probability:e[n]}}).sort(function(n,r){return r.probability-n.probability})},t}(),k9=function(t){Re(e,t);function e(n){return n===void 0&&(n=new Jk),t.call(this,"FaceExpressionNet",n)||this}return e.prototype.forwardInput=function(n){var r=this;return ue(function(){return ro(r.runNet(n))})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(n){return ve(this,void 0,void 0,function(){var r,i,o,s,a=this;return ye(this,function(u){switch(u.label){case 0:return[4,on(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all($t(i).map(function(l){return ve(a,void 0,void 0,function(){var c;return ye(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),s=o.map(function(l){return new A9(l)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(eP);function tP(t,e){var n={expressions:e};return Object.assign({},t,n)}function P9(t){return g9(t)&&t.landmarks instanceof Kd&&t.unshiftedLandmarks instanceof Kd&&t.alignedRect instanceof Ri}function S_(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),i=r.align(),o=t.detection.imageDims,s=new Ri(t.detection.score,i.rescale(o.reverse()),o),a={landmarks:r,unshiftedLandmarks:e,alignedRect:s};return Object.assign({},t,a)}function N9(t,e){var n=om(t,e),r=E_(t,e);function i(s,a,u){var l=r(s,a,u+"/separable_conv0"),c=r(a,a,u+"/separable_conv1"),h=n(s,a,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function o(s,a){var u=r(s,s,a+"/separable_conv0"),l=r(s,s,a+"/separable_conv1"),c=r(s,s,a+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function D9(t,e){var n=[],r=ao(t),i=r.extractWeights,o=r.getRemainingWeights,s=N9(i,n),a=s.extractConvParams,u=s.extractSeparableConvParams,l=s.extractReductionBlockParams,c=s.extractMainBlockParams,h=a(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),d=l(64,128,"entry_flow/reduction_block_1"),m={conv_in:h,reduction_block_0:f,reduction_block_1:d},v={};Lc(e,0,1).forEach(function(w){v["main_block_"+w]=c(128,"middle_flow/main_block_"+w)});var y=l(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),_={reduction_block:y,separable_conv:g};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{entry_flow:m,middle_flow:v,exit_flow:_}}}function M9(t,e){var n=hs(t,e),r=Yk(n),i=C_(n);function o(a){var u=i(a+"/separable_conv0"),l=i(a+"/separable_conv1"),c=r(a+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function s(a){var u=i(a+"/separable_conv0"),l=i(a+"/separable_conv1"),c=i(a+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:s}}function F9(t,e){var n=[],r=M9(t,n),i=r.extractConvParams,o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=s("entry_flow/reduction_block_0"),c=s("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};Lc(e,0,1).forEach(function(y){f["main_block_"+y]=a("middle_flow/main_block_"+y)});var d=s("exit_flow/reduction_block"),m=o("exit_flow/separable_conv"),v={reduction_block:d,separable_conv:m};return so(t,n),{params:{entry_flow:h,middle_flow:f,exit_flow:v},paramMappings:n}}function nP(t,e,n){return Me(Fr(t,e.filters,n,"same"),e.bias)}function Zg(t,e,n){n===void 0&&(n=!0);var r=n?bt(t):t;return r=dr(r,e.separable_conv0,[1,1]),r=dr(bt(r),e.separable_conv1,[1,1]),r=Xt(r,[3,3],[2,2],"same"),r=Me(r,nP(t,e.expansion_conv,[2,2])),r}function O9(t,e){var n=dr(bt(t),e.separable_conv0,[1,1]);return n=dr(bt(n),e.separable_conv1,[1,1]),n=dr(bt(n),e.separable_conv2,[1,1]),n=Me(n,t),n}var L9=function(t){Re(e,t);function e(n){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return e.prototype.forwardInput=function(n){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return ue(function(){var o=n.toBatchTensor(112,!0),s=[122.782,117.001,104.298],a=dh(o,s).div(se(256)),u=bt(nP(a,i.entry_flow.conv_in,[2,2]));return u=Zg(u,i.entry_flow.reduction_block_0,!1),u=Zg(u,i.entry_flow.reduction_block_1),Lc(r._numMainBlocks,0,1).forEach(function(l){u=O9(u,i.middle_flow["main_block_"+l])}),u=Zg(u,i.exit_flow.reduction_block),u=bt(dr(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(n){return F9(n,this._numMainBlocks)},e.prototype.extractParams=function(n){return D9(n,this._numMainBlocks)},e}(oo);function V9(t){var e=[],n=ao(t),r=n.extractWeights,i=n.getRemainingWeights,o=b_(r,e),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:a}}}}function B9(t){var e=[],n=hs(t,e);function r(o){var s=n(o+"/weights",2),a=n(o+"/bias",1);return{weights:s,bias:a}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return so(t,e),{params:i,paramMappings:e}}var Yd;(function(t){t.FEMALE="female",t.MALE="male"})(Yd||(Yd={}));var j9=function(t){Re(e,t);function e(n){n===void 0&&(n=new L9(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(n){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ue(function(){var o=n instanceof Xd?r.faceFeatureExtractor.forwardInput(n):n,s=hh(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),a=pi(s,i.fc.age).as1D(),u=pi(s,i.fc.gender);return{age:a,gender:u}})},e.prototype.forwardInput=function(n){var r=this;return ue(function(){var i=r.runNet(n),o=i.age,s=i.gender;return{age:o,gender:ro(s)}})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(n){return ve(this,void 0,void 0,function(){var r,i,o,s,a,u,l=this;return ye(this,function(c){switch(c.label){case 0:return[4,on(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=$t(i.age),s=$t(i.gender),a=o.map(function(h,f){return{ageTensor:h,genderTensor:s[f]}}),[4,Promise.all(a.map(function(h){var f=h.ageTensor,d=h.genderTensor;return ve(l,void 0,void 0,function(){var m,v,y,g,_;return ye(this,function(w){switch(w.label){case 0:return[4,f.data()];case 1:return m=w.sent()[0],[4,d.data()];case 2:return v=w.sent()[0],y=v>.5,g=y?Yd.MALE:Yd.FEMALE,_=y?v:1-v,f.dispose(),d.dispose(),[2,{age:m,gender:g,genderProbability:_}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),t.prototype.dispose.call(this,n)},e.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(n){return V9(n)},e.prototype.extractParamsFromWeigthMap=function(n){var r=Zk(n),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),B9(o)},e.prototype.extractParams=function(n){var r=1539,i=n.slice(0,n.length-r),o=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(oo),rP=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.postProcess=function(n,r,i){var o=i.map(function(a){var u=a.width,l=a.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),s=o.length;return ue(function(){var a=function(f,d){return mr([xi([68],f),xi([68],d)],1).as2D(1,136).as1D()},u=function(f,d){var m=o[f],v=m.width,y=m.height;return d(v,y)?Math.abs(v-y)/2:0},l=function(f){return u(f,function(d,m){return d<m})},c=function(f){return u(f,function(d,m){return m<d})},h=n.mul(xi([s,136],r)).sub(mr(Array.from(Array(s),function(f,d){return a(l(d),c(d))}))).div(mr(Array.from(Array(s),function(f,d){return a(o[d].width,o[d].height)})));return h})},e.prototype.forwardInput=function(n){var r=this;return ue(function(){var i=r.runNet(n);return r.postProcess(i,n.inputSize,n.inputDimensions.map(function(o){var s=o[0],a=o[1];return{height:s,width:a}}))})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(n){return ve(this,void 0,void 0,function(){var r,i,o,s=this;return ye(this,function(a){switch(a.label){case 0:return[4,on(n)];case 1:return r=a.sent(),i=ue(function(){return $t(s.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return ve(s,void 0,void 0,function(){var c,h,f,d,m;return ye(this,function(v){switch(v.label){case 0:return f=(h=Array).from,[4,u.data()];case 1:return c=f.apply(h,[v.sent()]),d=c.filter(function(y,g){return DC(g)}),m=c.filter(function(y,g){return!DC(g)}),[2,new m9(Array(68).fill(0).map(function(y,g){return new Ge(d[g],m[g])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(eP),iP=function(t){Re(e,t);function e(n){return n===void 0&&(n=new Jk),t.call(this,"FaceLandmark68Net",n)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(rP);function U9(t){var e=[],n=Qk(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return so(t,e),{params:r,paramMappings:e}}function W9(t){var e=[],n=ao(t),r=n.extractWeights,i=n.getRemainingWeights,o=Xk(r,e).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u}}}var z9=function(t){Re(e,t);function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ue(function(){var i=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=dh(i,o).div(se(255)),a=Jg(s,r.dense0,!0);return a=Jg(a,r.dense1),a=Jg(a,r.dense2),a=hh(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(n){return U9(n)},e.prototype.extractParams=function(n){return W9(n)},e}(oo),$9=function(t){Re(e,t);function e(n){return n===void 0&&(n=new z9),t.call(this,"FaceLandmark68TinyNet",n)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(rP);(function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(iP);function H9(t,e){return Me(An(t,e.weights),e.biases)}function T_(t,e,n,r,i){i===void 0&&(i="same");var o=e.conv,s=o.filters,a=o.bias,u=Fr(t,s,n,i);return u=Me(u,a),u=H9(u,e.scale),r?bt(u):u}function G9(t,e){return T_(t,e,[1,1],!0)}function oP(t,e){return T_(t,e,[1,1],!1)}function sP(t,e){return T_(t,e,[2,2],!0,"valid")}function q9(t,e){function n(a,u,l){var c=t(a),h=c.length/(u*l*l);if(o9(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return ue(function(){return Jo(Kn(c,[u,h,l,l]),[2,3,1,0])})}function r(a,u,l,c){var h=n(a,u,l),f=Lt(t(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:f}}function i(a,u){var l=Lt(t(a)),c=Lt(t(a));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(a,u,l,c){var h=r(a,u,l,c+"/conv"),f=i(u,c+"/scale");return{conv:h,scale:f}}function s(a,u,l,c,h){h===void 0&&(h=!1);var f=o((h?.5:1)*a,u,l,c+"/conv1"),d=o(a,u,l,c+"/conv2");return{conv1:f,conv2:d}}return{extractConvLayerParams:o,extractResidualLayerParams:s}}function K9(t){var e=ao(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=q9(n,i),s=o.extractConvLayerParams,a=o.extractResidualLayerParams,u=s(4704,32,7,"conv32_down"),l=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),h=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),d=a(36864,64,3,"conv64_1"),m=a(36864,64,3,"conv64_2"),v=a(36864,64,3,"conv64_3"),y=a(147456,128,3,"conv128_down",!0),g=a(147456,128,3,"conv128_1"),_=a(147456,128,3,"conv128_2"),w=a(589824,256,3,"conv256_down",!0),x=a(589824,256,3,"conv256_1"),S=a(589824,256,3,"conv256_2"),A=a(589824,256,3,"conv256_down_out"),T=ue(function(){return Jo(Bo(n(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:f,conv64_1:d,conv64_2:m,conv64_3:v,conv128_down:y,conv128_1:g,conv128_2:_,conv256_down:w,conv256_1:x,conv256_2:S,conv256_down_out:A,fc:T};return{params:E,paramMappings:i}}function X9(t,e){var n=hs(t,e);function r(s){var a=n(s+"/scale/weights",1),u=n(s+"/scale/biases",1);return{weights:a,biases:u}}function i(s){var a=n(s+"/conv/filters",4),u=n(s+"/conv/bias",1),l=r(s);return{conv:{filters:a,bias:u},scale:l}}function o(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function Y9(t){var e=[],n=X9(t,e),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,o=r("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),h=i("conv64_2"),f=i("conv64_3"),d=i("conv128_down"),m=i("conv128_1"),v=i("conv128_2"),y=i("conv256_down"),g=i("conv256_1"),_=i("conv256_2"),w=i("conv256_down_out"),x=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!i9(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var S={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:f,conv128_down:d,conv128_1:m,conv128_2:v,conv256_down:y,conv256_1:g,conv256_2:_,conv256_down_out:w,fc:x};return so(t,e),{params:S,paramMappings:e}}function si(t,e){var n=G9(t,e.conv1);return n=oP(n,e.conv2),n=Me(n,t),n=bt(n),n}function _f(t,e){var n=sP(t,e.conv1);n=oP(n,e.conv2);var r=hh(t,2,2,"valid"),i=ct(r.shape),o=r.shape[3]!==n.shape[3],s=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(s){var a=tc(n.shape);a[1]=1;var u=ct(a);n=zt([n,u],1);var l=tc(n.shape);l[2]=1;var c=ct(l);n=zt([n,c],2)}return r=o?zt([r,i],3):r,n=Me(r,n),n=bt(n),n}var Q9=function(t){Re(e,t);function e(){return t.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ue(function(){var i=n.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],s=dh(i,o).div(se(256)),a=sP(s,r.conv32_down);a=Xt(a,3,2,"valid"),a=si(a,r.conv32_1),a=si(a,r.conv32_2),a=si(a,r.conv32_3),a=_f(a,r.conv64_down),a=si(a,r.conv64_1),a=si(a,r.conv64_2),a=si(a,r.conv64_3),a=_f(a,r.conv128_down),a=si(a,r.conv128_1),a=si(a,r.conv128_2),a=_f(a,r.conv256_down),a=si(a,r.conv256_1),a=si(a,r.conv256_2),a=_f(a,r.conv256_down_out);var u=a.mean([1,2]),l=Jp(u,r.fc);return l})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(n){return ve(this,void 0,void 0,function(){var r,i,o,s=this;return ye(this,function(a){switch(a.label){case 0:return[4,on(n)];case 1:return r=a.sent(),i=ue(function(){return $t(s.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(n){return Y9(n)},e.prototype.extractParams=function(n){return K9(n)},e}(oo);function aP(t,e){var n={descriptor:e};return Object.assign({},t,n)}function uP(t,e){var n={age:e};return Object.assign({},t,n)}function lP(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var cP=function(){function t(e){var n=e===void 0?{}:e,r=n.minFaceSize,i=n.scaleFactor,o=n.maxNumScales,s=n.scoreThresholds,a=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function J9(t,e){function n(u,l){var c=Kn(t(9*u),[3,3,u,1]),h=Lt(t(u)),f=Lt(t(u)),d=Lt(t(u)),m=Lt(t(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:d,batch_norm_variance:m}}function r(u,l,c,h,f){var d=Kn(t(u*l*c*c),[c,c,u,l]),m=Lt(t(l));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:d,bias:m}}function i(u,l,c,h){var f=r(u,l,c,h,!0),d=f.filters,m=f.bias;return{filters:d,batch_norm_offset:m}}function o(u,l,c){var h=n(u,c+"/depthwise_conv"),f=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function s(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),d=o(256,256,"mobilenetv1/conv_5"),m=o(256,512,"mobilenetv1/conv_6"),v=o(512,512,"mobilenetv1/conv_7"),y=o(512,512,"mobilenetv1/conv_8"),g=o(512,512,"mobilenetv1/conv_9"),_=o(512,512,"mobilenetv1/conv_10"),w=o(512,512,"mobilenetv1/conv_11"),x=o(512,1024,"mobilenetv1/conv_12"),S=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:d,conv_6:m,conv_7:v,conv_8:y,conv_9:g,conv_10:_,conv_11:w,conv_12:x,conv_13:S}}function a(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),f=i(256,128,1,"prediction_layer/conv_4"),d=i(128,256,3,"prediction_layer/conv_5"),m=i(256,64,1,"prediction_layer/conv_6"),v=i(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),_=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),w=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),x=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),S=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),A=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),I=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),P=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),N={box_encoding_predictor:y,class_predictor:g},k={box_encoding_predictor:_,class_predictor:w},j={box_encoding_predictor:x,class_predictor:S},W={box_encoding_predictor:A,class_predictor:T},q={box_encoding_predictor:E,class_predictor:C},X={box_encoding_predictor:I,class_predictor:P};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:d,conv_6:m,conv_7:v,box_predictor_0:N,box_predictor_1:k,box_predictor_2:j,box_predictor_3:W,box_predictor_4:q,box_predictor_5:X}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:a}}function Z9(t){var e=[],n=ao(t),r=n.extractWeights,i=n.getRemainingWeights,o=J9(r,e),s=o.extractMobilenetV1Params,a=o.extractPredictionLayerParams,u=s(),l=a(),c=W1(r(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:e}}function e$(t,e){var n=hs(t,e);function r(l,c,h){var f=n(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),d=n(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:d}}function i(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",d=c+"/pointwise_conv",m=n(h+"/depthwise_weights",4,f+"/filters"),v=n(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),y=n(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),g=n(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),_=n(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:m,batch_norm_scale:v,batch_norm_offset:y,batch_norm_mean:g,batch_norm_variance:_},pointwise_conv:r("MobilenetV1",l,d)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(l,c){var h=n(l+"/weights",4,c+"/filters"),f=n(l+"/biases",1,c+"/bias");return{filters:h,bias:f}}function a(l){var c=s("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=s("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function t$(t){var e=[],n=e$(t,e),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,o=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!nm(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return so(t,e),{params:s,paramMappings:e}}function ui(t,e,n){return ue(function(){var r=Fr(t,e.filters,n,"same");return r=Me(r,e.batch_norm_offset),Z1(r,0,6)})}var n$=.0010000000474974513;function r$(t,e,n){return ue(function(){var r=Qp(t,e.filters,n,"same");return r=ik(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,n$),Z1(r,0,6)})}function i$(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}function o$(t,e){return ue(function(){var n=null,r=ui(t,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,s){var a=s+1,u=i$(a);r=r$(r,o.depthwise_conv,u),r=ui(r,o.pointwise_conv,[1,1]),a===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function s$(t,e,n,r,i){var o=t.shape[0],s=Math.min(n,o),a=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>i}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return a.forEach(function(c){if(!(l.length>=s)){for(var h=c.score,f=l.length-1;f>=0;--f){var d=a$(t,c.boxIndex,l[f]);if(d!==0&&(c.score*=u(d),c.score<=i))break}h===c.score&&l.push(c.boxIndex)}}),l}function a$(t,e,n){var r=t.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),f=(s-i)*(a-o),d=(c-u)*(h-l);if(f<=0||d<=0)return 0;var m=Math.max(i,u),v=Math.max(o,l),y=Math.min(s,c),g=Math.min(a,h),_=Math.max(y-m,0)*Math.max(g-v,0);return _/(f+d-_)}function u$(t){var e=$t(Jo(t,[1,0])),n=[Gt(e[2],e[0]),Gt(e[3],e[1])],r=[Me(e[0],jr(n[0],se(2))),Me(e[1],jr(n[1],se(2)))];return{sizes:n,centers:r}}function l$(t,e){var n=u$(t),r=n.sizes,i=n.centers,o=$t(Jo(e,[1,0])),s=jr(An(Oy(jr(o[2],se(5))),r[0]),se(2)),a=Me(An(jr(o[0],se(10)),r[0]),i[0]),u=jr(An(Oy(jr(o[3],se(5))),r[1]),se(2)),l=Me(An(jr(o[1],se(10)),r[1]),i[1]);return Jo(mr([Gt(a,s),Gt(l,u),Me(a,s),Me(l,u)]),[1,0])}function c$(t,e,n){return ue(function(){var r=t.shape[0],i=l$(Hr(uu(n.extra_dim,[r,1,1]),[-1,4]),Hr(t,[-1,4]));i=Hr(i,[r,i.shape[0]/r,4]);var o=ek(bi(e,[0,0,1],[-1,-1,-1])),s=bi(o,[0,0,0],[-1,-1,1]);s=Hr(s,[r,s.shape[1]]);var a=$t(i),u=$t(s);return{boxes:a,scores:u}})}function Ia(t,e){return ue(function(){var n=t.shape[0],r=Hr(Yr(t,e.box_encoding_predictor),[n,-1,1,4]),i=Hr(Yr(t,e.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function h$(t,e,n){return ue(function(){var r=ui(t,n.conv_0,[1,1]),i=ui(r,n.conv_1,[2,2]),o=ui(i,n.conv_2,[1,1]),s=ui(o,n.conv_3,[2,2]),a=ui(s,n.conv_4,[1,1]),u=ui(a,n.conv_5,[2,2]),l=ui(u,n.conv_6,[1,1]),c=ui(l,n.conv_7,[2,2]),h=Ia(e,n.box_predictor_0),f=Ia(t,n.box_predictor_1),d=Ia(i,n.box_predictor_2),m=Ia(s,n.box_predictor_3),v=Ia(u,n.box_predictor_4),y=Ia(c,n.box_predictor_5),g=zt([h.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding,y.boxPredictionEncoding],1),_=zt([h.classPrediction,f.classPrediction,d.classPrediction,m.classPrediction,v.classPrediction,y.classPrediction],1);return{boxPredictions:g,classPredictions:_}})}var sm=function(){function t(e){var n=e===void 0?{}:e,r=n.minConfidence,i=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),hP=function(t){Re(e,t);function e(){return t.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ue(function(){var i=n.toBatchTensor(512,!1).toFloat(),o=Gt(An(i,se(.007843137718737125)),se(1)),s=o$(o,r.mobilenetv1),a=h$(s.out,s.conv11,r.prediction_layer),u=a.boxPredictions,l=a.classPredictions;return c$(u,l,r.output_layer)})},e.prototype.forward=function(n){return ve(this,void 0,void 0,function(){var r;return ye(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,on(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,d,m,v,y,g,_,w,x,S,A,T,E;return ye(this,function(C){switch(C.label){case 0:return i=new sm(r),o=i.maxResults,s=i.minConfidence,[4,on(n)];case 1:for(a=C.sent(),u=this.forwardInput(a),l=u.boxes,c=u.scores,h=l[0],f=c[0],d=1;d<l.length;d++)l[d].dispose(),c[d].dispose();return y=(v=Array).from,[4,f.data()];case 2:return m=y.apply(v,[C.sent()]),g=.5,_=s$(h,m,o,g,s),w=a.getReshapedInputDimensions(0),x=a.inputSize,S=x/w.width,A=x/w.height,T=h.arraySync(),E=_.map(function(I){var P=[Math.max(0,T[I][0]),Math.min(1,T[I][2])].map(function(X){return X*A}),N=P[0],k=P[1],j=[Math.max(0,T[I][1]),Math.min(1,T[I][3])].map(function(X){return X*S}),W=j[0],q=j[1];return new Ri(m[I],new g_(W,N,q-W,k-N),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(n){return t$(n)},e.prototype.extractParams=function(n){return Z9(n)},e}(oo);(function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(hP);var f$=.4,d$=[new Ge(.738768,.874946),new Ge(2.42204,2.65704),new Ge(4.30971,7.04493),new Ge(10.246,4.59428),new Ge(12.6868,11.8741)],p$=[new Ge(1.603231,2.094468),new Ge(6.041143,7.080126),new Ge(2.882459,3.518061),new Ge(4.266906,5.178857),new Ge(9.041765,10.66308)],m$=[117.001,114.697,97.404],g$="tiny_yolov2_model",v$="tiny_yolov2_separable_conv_model",wf=function(t){return typeof t=="number"};function y$(t){if(!t)throw new Error("invalid config: "+t);if(typeof t.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!wf(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(e){return e||{}}).every(function(e){return wf(e.x)&&wf(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||t.meanRgb.length!==3||!t.meanRgb.every(wf)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}function I_(t){return ue(function(){var e=An(t,se(.10000000149011612));return Me(bt(Gt(t,e)),e)})}function yo(t,e){return ue(function(){var n=ha(t,[[0,0],[1,1],[1,1],[0,0]]);return n=Fr(n,e.conv.filters,[1,1],"valid"),n=Gt(n,e.bn.sub),n=An(n,e.bn.truediv),n=Me(n,e.conv.bias),I_(n)})}function _o(t,e){return ue(function(){var n=ha(t,[[0,0],[1,1],[1,1],[0,0]]);return n=r_(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),n=Me(n,e.bias),I_(n)})}function _$(t,e){var n=om(t,e);function r(s,a){var u=Lt(t(s)),l=Lt(t(s));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:l}}function i(s,a,u){var l=n(s,a,3,u+"/conv"),c=r(a,u+"/bn");return{conv:l,bn:c}}var o=E_(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function w$(t,e,n,r){var i=ao(t),o=i.extractWeights,s=i.getRemainingWeights,a=[],u=_$(o,a),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,f;if(e.withSeparableConvs){var d=r[0],m=r[1],v=r[2],y=r[3],g=r[4],_=r[5],w=r[6],x=r[7],S=r[8],A=e.isFirstLayerConv2d?l(d,m,3,"conv0"):h(d,m,"conv0"),T=h(m,v,"conv1"),E=h(v,y,"conv2"),C=h(y,g,"conv3"),I=h(g,_,"conv4"),P=h(_,w,"conv5"),N=x?h(w,x,"conv6"):void 0,k=S?h(x,S,"conv7"):void 0,j=l(S||x||w,5*n,1,"conv8");f={conv0:A,conv1:T,conv2:E,conv3:C,conv4:I,conv5:P,conv6:N,conv7:k,conv8:j}}else{var d=r[0],m=r[1],v=r[2],y=r[3],g=r[4],_=r[5],w=r[6],x=r[7],S=r[8],A=c(d,m,"conv0"),T=c(m,v,"conv1"),E=c(v,y,"conv2"),C=c(y,g,"conv3"),I=c(g,_,"conv4"),P=c(_,w,"conv5"),N=c(w,x,"conv6"),k=c(x,S,"conv7"),j=l(S,5*n,1,"conv8");f={conv0:A,conv1:T,conv2:E,conv3:C,conv4:I,conv5:P,conv6:N,conv7:k,conv8:j}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:f,paramMappings:a}}function x$(t,e){var n=hs(t,e);function r(a){var u=n(a+"/sub",1),l=n(a+"/truediv",1);return{sub:u,truediv:l}}function i(a){var u=n(a+"/filters",4),l=n(a+"/bias",1);return{filters:u,bias:l}}function o(a){var u=i(a+"/conv"),l=r(a+"/bn");return{conv:u,bn:l}}var s=C_(n);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:s}}function b$(t,e){var n=[],r=x$(t,n),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return so(t,n),{params:a,paramMappings:n}}var UC;(function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"})(UC||(UC={}));var R_=function(){function t(e){var n=e===void 0?{}:e,r=n.inputSize,i=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),fP=function(t){Re(e,t);function e(n){var r=t.call(this,"TinyYolov2")||this;return y$(n),r._config=n,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(n,r){var i=yo(n,r.conv0);return i=Xt(i,[2,2],[2,2],"same"),i=yo(i,r.conv1),i=Xt(i,[2,2],[2,2],"same"),i=yo(i,r.conv2),i=Xt(i,[2,2],[2,2],"same"),i=yo(i,r.conv3),i=Xt(i,[2,2],[2,2],"same"),i=yo(i,r.conv4),i=Xt(i,[2,2],[2,2],"same"),i=yo(i,r.conv5),i=Xt(i,[2,2],[1,1],"same"),i=yo(i,r.conv6),i=yo(i,r.conv7),Yr(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(n,r){var i=this.config.isFirstLayerConv2d?I_(Yr(n,r.conv0,"valid",!1)):_o(n,r.conv0);return i=Xt(i,[2,2],[2,2],"same"),i=_o(i,r.conv1),i=Xt(i,[2,2],[2,2],"same"),i=_o(i,r.conv2),i=Xt(i,[2,2],[2,2],"same"),i=_o(i,r.conv3),i=Xt(i,[2,2],[2,2],"same"),i=_o(i,r.conv4),i=Xt(i,[2,2],[2,2],"same"),i=_o(i,r.conv5),i=Xt(i,[2,2],[1,1],"same"),i=r.conv6?_o(i,r.conv6):i,i=r.conv7?_o(i,r.conv7):i,Yr(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(n,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return ue(function(){var s=n.toBatchTensor(r,!1).toFloat();return s=i.config.meanRgb?dh(s,i.config.meanRgb):s,s=s.div(se(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},e.prototype.forward=function(n,r){return ve(this,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,on(n)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(n,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,d,m,v,y,g,_=this;return ye(this,function(w){switch(w.label){case 0:return i=new R_(r),o=i.inputSize,s=i.scoreThreshold,[4,on(n)];case 1:return a=w.sent(),[4,this.forwardInput(a,o)];case 2:return u=w.sent(),l=ue(function(){return $t(u)[0].expandDims()}),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(l,a.getReshapedInputDimensions(0),s)];case 3:return h=w.sent(),u.dispose(),l.dispose(),f=h.map(function(x){return x.box}),d=h.map(function(x){return x.score}),m=h.map(function(x){return x.classScore}),v=h.map(function(x){return _.config.classes[x.label]}),y=Vc(f.map(function(x){return x.rescale(o)}),d,this.config.iouThreshold,!0),g=y.map(function(x){return new Vk(d[x],m[x],v[x],f[x],c)}),[2,g]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(n){return b$(n,this.config)},e.prototype.extractParams=function(n){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return w$(n,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(n,r,i){return ve(this,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,m,v,y,g,_,w,x,S,A,T,E,C,I,P,N,k,j,W,q,X,V=this;return ye(this,function(z){switch(z.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),u=a/o,l=a/s,c=n.shape[1],h=this.config.anchors.length,f=ue(function(){var U=n.reshape([c,c,h,V.boxEncodingSize]),Q=U.slice([0,0,0,0],[c,c,h,4]),te=U.slice([0,0,0,4],[c,c,h,1]),ie=V.withClassScores?ro(U.slice([0,0,0,5],[c,c,h,V.config.classes.length]),3):se(0);return[Q,te,ie]}),d=f[0],m=f[1],v=f[2],y=[],[4,m.array()];case 1:return g=z.sent(),[4,d.array()];case 2:_=z.sent(),w=0,z.label=3;case 3:if(!(w<c))return[3,12];x=0,z.label=4;case 4:if(!(x<c))return[3,11];S=0,z.label=5;case 5:return S<h?(A=Qg(g[w][x][S][0]),!i||A>i?(T=(x+Qg(_[w][x][S][0]))/c*u,E=(w+Qg(_[w][x][S][1]))/c*l,C=Math.exp(_[w][x][S][2])*this.config.anchors[S].x/c*u,I=Math.exp(_[w][x][S][3])*this.config.anchors[S].y/c*l,P=T-C/2,N=E-I/2,k={row:w,col:x,anchor:S},this.withClassScores?[4,this.extractPredictedClass(v,k)]:[3,7]):[3,9]):[3,10];case 6:return X=z.sent(),[3,8];case 7:X={classScore:1,label:0},z.label=8;case 8:j=X,W=j.classScore,q=j.label,y.push(En({box:new rm(P,N,P+C,N+I),score:A,classScore:A*W,label:q},k)),z.label=9;case 9:return S++,[3,5];case 10:return x++,[3,4];case 11:return w++,[3,3];case 12:return d.dispose(),m.dispose(),v.dispose(),[2,y]}})})},e.prototype.extractPredictedClass=function(n,r){return ve(this,void 0,void 0,function(){var i,o,s,a;return ye(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,n.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return a[i][o][s][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(oo),E$=function(t){Re(e,t);function e(n){n===void 0&&(n=!0);var r=this,i=Object.assign({},{withSeparableConvs:n,iouThreshold:f$,classes:["face"]},n?{anchors:p$,meanRgb:m$}:{anchors:d$,withClassScores:!0});return r=t.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(n,r){return ve(this,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return[4,this.detect(n,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new Ri(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?v$:g$},e.prototype.extractParamsFromWeigthMap=function(n){return t.prototype.extractParamsFromWeigthMap.call(this,n)},e}(fP),dP=function(t){Re(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return e}(R_),ph=function(){function t(){}return t.prototype.then=function(e){return ve(this,void 0,void 0,function(){var n;return ye(this,function(r){switch(r.label){case 0:return n=e,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return ve(this,void 0,void 0,function(){return ye(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},t}();function am(t,e,n,r,i){return i===void 0&&(i=function(o){var s=o.alignedRect;return s}),ve(this,void 0,void 0,function(){var o,s,a,u,l;return ye(this,function(c){switch(c.label){case 0:return o=t.map(function(h){return P9(h)?i(h):h.detection}),a=r,a?[3,5]:e instanceof _t?[4,x_(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,w_(e,o)];case 3:u=c.sent(),c.label=4;case 4:a=u,c.label=5;case 5:return s=a,[4,n(s)];case 6:return l=c.sent(),s.forEach(function(h){return h instanceof _t&&h.dispose()}),[2,l]}})})}function A_(t,e,n,r,i){return ve(this,void 0,void 0,function(){var o=this;return ye(this,function(s){return[2,am([t],e,function(a){return ve(o,void 0,void 0,function(){return ye(this,function(u){return[2,n(a[0])]})})},r,i)]})})}function C$(t){return ue(function(){return mr($t(t,3).reverse(),3)})}var xf=2,Qd=12;function S$(t,e){var n=om(t,e),r=b_(t,e);function i(l,c){var h=Lt(t(l));return e.push({paramPath:c}),h}function o(l,c,h){h===void 0&&(h=!1);var f=n(l[0],l[1],3,c+"/conv1"),d=i(l[1],c+"/prelu1_alpha"),m=n(l[1],l[2],3,c+"/conv2"),v=i(l[2],c+"/prelu2_alpha"),y=n(l[2],l[3],h?2:3,c+"/conv3"),g=i(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:m,prelu2_alpha:v,conv3:y,prelu3_alpha:g}}function s(){var l=o([3,10,16,32],"pnet"),c=n(32,2,1,"pnet/conv4_1"),h=n(32,4,1,"pnet/conv4_2");return En(En({},l),{conv4_1:c,conv4_2:h})}function a(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),d=r(128,4,"rnet/fc2_2");return En(En({},l),{fc1:c,prelu4_alpha:h,fc2_1:f,fc2_2:d})}function u(){var l=o([3,32,64,64],"onet"),c=n(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),d=i(256,"onet/prelu5_alpha"),m=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return En(En({},l),{conv4:c,prelu4_alpha:h,fc1:f,prelu5_alpha:d,fc2_1:m,fc2_2:v,fc2_3:y})}return{extractPNetParams:s,extractRNetParams:a,extractONetParams:u}}function T$(t){var e=ao(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=S$(n,i),s=o.extractPNetParams,a=o.extractRNetParams,u=o.extractONetParams,l=s(),c=a(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:i}}function I$(t,e){var n=hs(t,e);function r(c){var h=n(c+"/weights",4,c+"/filters"),f=n(c+"/bias",1);return{filters:h,bias:f}}function i(c){var h=n(c+"/weights",2),f=n(c+"/bias",1);return{weights:h,bias:f}}function o(c){return n(c,1)}function s(c){var h=r(c+"/conv1"),f=o(c+"/prelu1_alpha"),d=r(c+"/conv2"),m=o(c+"/prelu2_alpha"),v=r(c+"/conv3"),y=o(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:d,prelu2_alpha:m,conv3:v,prelu3_alpha:y}}function a(){var c=s("pnet"),h=r("pnet/conv4_1"),f=r("pnet/conv4_2");return En(En({},c),{conv4_1:h,conv4_2:f})}function u(){var c=s("rnet"),h=i("rnet/fc1"),f=o("rnet/prelu4_alpha"),d=i("rnet/fc2_1"),m=i("rnet/fc2_2");return En(En({},c),{fc1:h,prelu4_alpha:f,fc2_1:d,fc2_2:m})}function l(){var c=s("onet"),h=r("onet/conv4"),f=o("onet/prelu4_alpha"),d=i("onet/fc1"),m=o("onet/prelu5_alpha"),v=i("onet/fc2_1"),y=i("onet/fc2_2"),g=i("onet/fc2_3");return En(En({},c),{conv4:h,prelu4_alpha:f,fc1:d,prelu5_alpha:m,fc2_1:v,fc2_2:y,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:u,extractONetParams:l}}function R$(t){var e=[],n=I$(t,e),r=n.extractPNetParams,i=n.extractRNetParams,o=n.extractONetParams,s=r(),a=i(),u=o();return so(t,e),{params:{pnet:s,rnet:a,onet:u},paramMappings:e}}function $y(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}function A$(t,e,n){for(var r=n[0],i=n[1],o=Qd/t,s=[],a=Math.min(r,i)*o,u=0;a>=12;)s.push(o*Math.pow(e,u)),a=a*e,u+=1;return s}var k_=function(t){Re(e,t);function e(n,r,i,o){return t.call(this,{left:n,top:r,right:i,bottom:o},!0)||this}return e}(Zo);function pP(t){return ue(function(){return An(Gt(t,se(127.5)),se(.0078125))})}function pu(t,e){return ue(function(){return Me(bt(t),An(e,$d(bt($d(t)))))})}function P_(t,e,n){return n===void 0&&(n=!1),ue(function(){var r=Yr(t,e.conv1,"valid");return r=pu(r,e.prelu1_alpha),r=Xt(r,n?[2,2]:[3,3],[2,2],"same"),r=Yr(r,e.conv2,"valid"),r=pu(r,e.prelu2_alpha),r=n?r:Xt(r,[3,3],[2,2],"valid"),r=Yr(r,e.conv3,"valid"),r=pu(r,e.prelu3_alpha),r})}function k$(t,e){return ue(function(){var n=P_(t,e,!0),r=Yr(n,e.conv4_1,"valid"),i=Tr(Zp(r,3),3),o=ro(Gt(r,i),3),s=Yr(n,e.conv4_2,"valid");return{prob:o,regions:s}})}function P$(t,e){return ue(function(){var n=$y(e,t.shape.slice(1)),r=n.height,i=n.width,o=u_.resizeBilinear(t,[r,i]),s=pP(o);return Jo(s,[0,2,1,3])})}function N$(t,e,n,r){for(var i=[],o=t.arraySync(),s=0;s<t.shape[0];s++)for(var a=0;a<t.shape[1];a++)o[s][a]>=r&&i.push(new Ge(a,s));var u=i.map(function(l){var c=new rm(Math.round((l.y*xf+1)/n),Math.round((l.x*xf+1)/n),Math.round((l.y*xf+Qd)/n),Math.round((l.x*xf+Qd)/n)),h=o[l.y][l.x],f=e.arraySync(),d=new k_(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:h,region:d}});return u}function D$(t,e,n,r,i){i.stage1=[];var o=e.map(function(f){return ue(function(){var d={scale:f},m=P$(t,f),v=Date.now(),y=k$(m,r),g=y.prob,_=y.regions;d.pnet=Date.now()-v;var w=$t($t(g,3)[1])[0],x=$t(_)[0];return{scoresTensor:w,regionsTensor:x,scale:f,statsForScale:d}})}),s=o.map(function(f){var d=f.scoresTensor,m=f.regionsTensor,v=f.scale,y=f.statsForScale,g=N$(d,m,v,n);if(d.dispose(),m.dispose(),!g.length)return i.stage1.push(y),[];var _=Date.now(),w=Vc(g.map(function(x){return x.cell}),g.map(function(x){return x.score}),.5);return y.nms=Date.now()-_,y.numBoxes=w.length,i.stage1.push(y),w.map(function(x){return g[x]})}),a=s.reduce(function(f,d){return f.concat(d)},[]),u=[],l=[];if(a.length>0){var c=Date.now(),h=Vc(a.map(function(f){return f.cell}),a.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-c,l=h.map(function(f){return a[f].score}),u=h.map(function(f){return a[f]}).map(function(f){var d=f.cell,m=f.region;return new rm(d.left+m.left*d.width,d.top+m.top*d.height,d.right+m.right*d.width,d.bottom+m.bottom*d.height).toSquare().round()})}return{boxes:u,scores:l}}function mP(t,e,n){var r=n.width,i=n.height;return ve(this,void 0,void 0,function(){var o,s,a,u=this;return ye(this,function(l){switch(l.label){case 0:return o=Qs(t),[4,Promise.all(e.map(function(c){return ve(u,void 0,void 0,function(){var h,f,d,m,v,y,g,_;return ye(this,function(w){return h=c.padAtBorders(t.height,t.width),f=h.y,d=h.ey,m=h.x,v=h.ex,y=m-1,g=f-1,_=o.getImageData(y,g,v-y,d-g),[2,Dn.isNodejs()?__(_):createImageBitmap(_)]})})}))];case 1:return s=l.sent(),a=[],s.forEach(function(c){var h=im({width:r,height:i}),f=Qs(h);f.drawImage(c,0,0,r,i);for(var d=f.getImageData(0,0,r,i).data,m=[],v=0;v<d.length;v+=4)m.push(d[v+2]),m.push(d[v+1]),m.push(d[v]);a.push(m)}),[2,a.map(function(c){var h=ue(function(){var f=Jo(Kn(c,[1,r,i,3]),[0,2,1,3]).toFloat();return pP(f)});return h})]}})})}function M$(t,e){return ue(function(){var n=P_(t,e),r=Hr(n,[n.shape[0],e.fc1.weights.shape[0]]),i=pi(r,e.fc1),o=pu(i,e.prelu4_alpha),s=pi(o,e.fc2_1),a=Tr(Zp(s,1),1),u=ro(Gt(s,a),1),l=pi(o,e.fc2_2),c=$t(u,1)[1];return{scores:c,regions:l}})}function F$(t,e,n,r,i){return ve(this,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,m,v,y,g,_;return ye(this,function(w){switch(w.label){case 0:return o=Date.now(),[4,mP(t,e,{width:24,height:24})];case 1:return s=w.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(x){var S=M$(x,r);return x.dispose(),S}),i.stage2_rnet=Date.now()-o,u=a.length>1?zt(a.map(function(x){return x.scores})):a[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[w.sent()]),u.dispose(),f=l.map(function(x,S){return{score:x,idx:S}}).filter(function(x){return x.score>n}).map(function(x){var S=x.idx;return S}),d=f.map(function(x){return e[x]}),m=f.map(function(x){return l[x]}),v=[],y=[],d.length>0&&(o=Date.now(),g=Vc(d,m,.7),i.stage2_nms=Date.now()-o,_=g.map(function(x){var S=a[f[x]].regions.arraySync();return new k_(S[0][0],S[0][1],S[0][2],S[0][3])}),y=g.map(function(x){return m[x]}),v=g.map(function(x,S){return d[x].calibrate(_[S])})),a.forEach(function(x){x.regions.dispose(),x.scores.dispose()}),[2,{boxes:v,scores:y}]}})})}function O$(t,e){return ue(function(){var n=P_(t,e);n=Xt(n,[2,2],[2,2],"same"),n=Yr(n,e.conv4,"valid"),n=pu(n,e.prelu4_alpha);var r=Hr(n,[n.shape[0],e.fc1.weights.shape[0]]),i=pi(r,e.fc1),o=pu(i,e.prelu5_alpha),s=pi(o,e.fc2_1),a=Tr(Zp(s,1),1),u=ro(Gt(s,a),1),l=pi(o,e.fc2_2),c=pi(o,e.fc2_3),h=$t(u,1)[1];return{scores:h,regions:l,points:c}})}function L$(t,e,n,r,i){return ve(this,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,m,v,y,g,_,w;return ye(this,function(x){switch(x.label){case 0:return o=Date.now(),[4,mP(t,e,{width:48,height:48})];case 1:return s=x.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(S){var A=O$(S,r);return S.dispose(),A}),i.stage3_onet=Date.now()-o,u=a.length>1?zt(a.map(function(S){return S.scores})):a[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[x.sent()]),u.dispose(),f=l.map(function(S,A){return{score:S,idx:A}}).filter(function(S){return S.score>n}).map(function(S){var A=S.idx;return A}),d=f.map(function(S){var A=a[S].regions.arraySync();return new k_(A[0][0],A[0][1],A[0][2],A[0][3])}),m=f.map(function(S,A){return e[S].calibrate(d[A])}),v=f.map(function(S){return l[S]}),y=[],g=[],_=[],m.length>0&&(o=Date.now(),w=Vc(m,v,.7,!1),i.stage3_nms=Date.now()-o,y=w.map(function(S){return m[S]}),g=w.map(function(S){return v[S]}),_=w.map(function(S,A){return Array(5).fill(0).map(function(T,E){var C=a[S].points.arraySync();return new Ge(C[0][E]*(y[A].width+1)+y[A].left,C[0][E+5]*(y[A].height+1)+y[A].top)})})),a.forEach(function(S){S.regions.dispose(),S.scores.dispose(),S.points.dispose()}),[2,{boxes:y,scores:g,points:_}]}})})}var V$=function(t){Re(e,t);function e(){return t.call(this,"Mtcnn")||this}return e.prototype.load=function(n){return ve(this,void 0,void 0,function(){return ye(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,n)]})})},e.prototype.loadFromDisk=function(n){return ve(this,void 0,void 0,function(){return ye(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,n)]})})},e.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,d,m,v,y,g,_,w,x,S,A,T,E;return ye(this,function(C){switch(C.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=n.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),u=ue(function(){return C$(Tr(p_.fromPixels(o)).toFloat())}),l=function(I){return u.dispose(),s.total=Date.now()-a,I},c=u.shape.slice(1),h=c[0],f=c[1],d=new cP(r),m=d.minFaceSize,v=d.scaleFactor,y=d.maxNumScales,g=d.scoreThresholds,_=d.scaleSteps,w=(_||A$(m,v,[h,f])).filter(function(I){var P=$y(I,[h,f]);return Math.min(P.width,P.height)>Qd}).slice(0,y),s.scales=w,s.pyramid=w.map(function(I){return $y(I,[h,f])}),x=Date.now(),[4,D$(u,w,g[0],i.pnet,s)];case 1:return S=C.sent(),s.total_stage1=Date.now()-x,S.boxes.length?(s.stage2_numInputBoxes=S.boxes.length,x=Date.now(),[4,F$(o,S.boxes,g[1],i.rnet,s)]):[2,l({results:[],stats:s})];case 2:return A=C.sent(),s.total_stage2=Date.now()-x,A.boxes.length?(s.stage3_numInputBoxes=A.boxes.length,x=Date.now(),[4,L$(o,A.boxes,g[2],i.onet,s)]):[2,l({results:[],stats:s})];case 3:return T=C.sent(),s.total_stage3=Date.now()-x,E=T.boxes.map(function(I,P){return S_(v_({},new Ri(T.scores[P],new g_(I.left/f,I.top/h,I.width/f,I.height/h),{height:h,width:f})),new p9(T.points[P].map(function(N){return N.sub(new Ge(I.left,I.top)).div(new Ge(I.width,I.height))}),{width:I.width,height:I.height}))}),[2,l({results:E,stats:s})]}})})},e.prototype.forward=function(n,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,on(n)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),ve(this,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,on(n)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(n){return R$(n)},e.prototype.extractParams=function(n){return T$(n)},e}(oo),B$=.4,j$=[new Ge(1.603231,2.094468),new Ge(6.041143,7.080126),new Ge(2.882459,3.518061),new Ge(4.266906,5.178857),new Ge(9.041765,10.66308)],U$=[117.001,114.697,97.404],W$=function(t){Re(e,t);function e(){var n=this,r={withSeparableConvs:!0,iouThreshold:B$,classes:["face"],anchors:j$,meanRgb:U$,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=t.call(this,r)||this,n}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(n,r){return ve(this,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return[4,this.detect(n,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new Ri(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(n){return t.prototype.extractParamsFromWeigthMap.call(this,n)},e}(fP),Vn={ssdMobilenetv1:new hP,tinyFaceDetector:new W$,tinyYolov2:new E$,mtcnn:new V$,faceLandmark68Net:new iP,faceLandmark68TinyNet:new $9,faceRecognitionNet:new Q9,faceExpressionNet:new k9,ageGenderNet:new j9},gP=function(t){Re(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.extractedFaces=i,o}return e}(ph),N_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r,i=this;return ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,am(n,this.input,function(s){return ve(i,void 0,void 0,function(){return ye(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return Vn.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,n.map(function(s,a){return tP(s,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new O_(this,this.input)},e}(gP),D_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r;return ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),n?[4,A_(n,this.input,function(o){return Vn.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,tP(n,r)]}})})},e.prototype.withAgeAndGender=function(){return new L_(this,this.input)},e}(gP),M_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new V_(this,this.input)},e.prototype.withFaceDescriptors=function(){return new j_(this,this.input)},e}(N_),F_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new B_(this,this.input)},e.prototype.withFaceDescriptor=function(){return new U_(this,this.input)},e}(D_),vP=function(t){Re(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.extractedFaces=i,o}return e}(ph),O_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r,i=this;return ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,am(n,this.input,function(s){return ve(i,void 0,void 0,function(){return ye(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return Vn.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,n.map(function(s,a){var u=r[a],l=u.age,c=u.gender,h=u.genderProbability;return uP(lP(s,c,h),l)})]}})})},e.prototype.withFaceExpressions=function(){return new N_(this,this.input)},e}(vP),L_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r,i,o,s;return ye(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?[4,A_(n,this.input,function(u){return Vn.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,o=r.gender,s=r.genderProbability,[2,uP(lP(n,o,s),i)]}})})},e.prototype.withFaceExpressions=function(){return new D_(this,this.input)},e}(vP),V_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new M_(this,this.input)},e.prototype.withFaceDescriptors=function(){return new j_(this,this.input)},e}(O_),B_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new F_(this,this.input)},e.prototype.withFaceDescriptor=function(){return new U_(this,this.input)},e}(L_),yP=function(t){Re(e,t);function e(n,r){var i=t.call(this)||this;return i.parentTask=n,i.input=r,i}return e}(ph),j_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r;return ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,am(n,this.input,function(o){return Promise.all(o.map(function(s){return Vn.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,s){return aP(n[s],o)})]}})})},e.prototype.withFaceExpressions=function(){return new M_(this,this.input)},e.prototype.withAgeAndGender=function(){return new V_(this,this.input)},e}(yP),U_=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r;return ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),n?[4,A_(n,this.input,function(o){return Vn.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,aP(n,r)]}})})},e.prototype.withFaceExpressions=function(){return new F_(this,this.input)},e.prototype.withAgeAndGender=function(){return new B_(this,this.input)},e}(yP),_P=function(t){Re(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Vn.faceLandmark68TinyNet:Vn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(ph),z$=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r,i,o,s,a=this;return ye(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(l){return l.detection}),this.input instanceof _t?[4,x_(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,w_(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return a.landmarkNet.detectLandmarks(l)}))];case 6:return s=u.sent(),i.forEach(function(l){return l instanceof _t&&l.dispose()}),[2,n.map(function(l,c){return S_(l,s[c])})]}})})},e.prototype.withFaceExpressions=function(){return new M_(this,this.input)},e.prototype.withAgeAndGender=function(){return new V_(this,this.input)},e.prototype.withFaceDescriptors=function(){return new j_(this,this.input)},e}(_P),$$=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r,i,o,s;return ye(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?(r=n.detection,this.input instanceof _t?[4,x_(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,w_(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return s=a.sent(),i.forEach(function(u){return u instanceof _t&&u.dispose()}),[2,S_(n,s)]}})})},e.prototype.withFaceExpressions=function(){return new F_(this,this.input)},e.prototype.withAgeAndGender=function(){return new B_(this,this.input)},e.prototype.withFaceDescriptor=function(){return new U_(this,this.input)},e}(_P),wP=function(t){Re(e,t);function e(n,r){r===void 0&&(r=new sm);var i=t.call(this)||this;return i.input=n,i.options=r,i}return e}(ph),H$=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r,i,o;return ye(this,function(s){switch(s.label){case 0:return n=this,r=n.input,i=n.options,i instanceof cP?[4,Vn.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(o=i instanceof dP?function(a){return Vn.tinyFaceDetector.locateFaces(a,i)}:i instanceof sm?function(a){return Vn.ssdMobilenetv1.locateFaces(a,i)}:i instanceof R_?function(a){return Vn.tinyYolov2.locateFaces(a,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return ve(n,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return v_({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new z$(this.runAndExtendWithFaceDetections(),this.input,n)},e.prototype.withFaceExpressions=function(){return new N_(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new O_(this.runAndExtendWithFaceDetections(),this.input)},e}(wP),G$=function(t){Re(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ve(this,void 0,void 0,function(){var n,r;return ye(this,function(i){switch(i.label){case 0:return[4,new H$(this.input,this.options)];case 1:return n=i.sent(),r=n[0],n.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return ve(n,void 0,void 0,function(){var i;return ye(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?v_({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new $$(this.runAndExtendWithFaceDetection(),this.input,n)},e.prototype.withFaceExpressions=function(){return new D_(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new L_(this.runAndExtendWithFaceDetection(),this.input)},e}(wP);function q$(t,e){return e===void 0&&(e=new sm),new G$(t,e)}function K$(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function t(e,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof vf)return s;if(s instanceof Float32Array)return new vf(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new vf(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(e,n){return n.map(function(r){return K$(r,e)}).reduce(function(r,i){return r+i},0)/(n.length||1)},t.prototype.matchDescriptor=function(e){var n=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new OC(o,n.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},t.prototype.findBestMatch=function(e){var n=this.matchDescriptor(e);return n.distance<this.distanceThreshold?n:new OC("unknown",n.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},t.fromJSON=function(e){var n=e.labeledDescriptors.map(function(r){return vf.fromJSON(r)});return new t(n,e.distanceThreshold)},t})();const X$={apiKey:"YOUR_API_KEY",authDomain:"YOUR_PROJECT_ID.firebaseapp.com",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_PROJECT_ID.appspot.com",messagingSenderId:"YOUR_SENDER_ID",appId:"YOUR_APP_ID",databaseURL:"https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com"},Y$="AIzaSyBfeYBUKx7re4wOj7drifj4oXZbPe99Q0o",Ra={enabled:!0,defaultLanguage:"th",thai:{voice:"Thai Female",rate:1.1,pitch:1.2,volume:1},english:{voice:"US English Female",rate:1.15,pitch:1.1,volume:1},chinese:{voice:"Chinese Female",rate:1,pitch:1,volume:1}},Rl={KIDS_3_7:{ageRange:[3,7],uiType:"KidsMode",features:["simple_animation","big_buttons","emoji_focused","no_text"],requiresConsent:!0,layout:"fullscreen_simplified",colors:["#FF6B6B","#4ECDC4","#FFE66D","#95E1D3"]},KIDS_8_12:{ageRange:[8,12],uiType:"ExploreMode",features:["interactive_games","career_exploration","simple_content","animation"],requiresConsent:!0,layout:"grid_cards",colors:["#3498db","#2ecc71","#f39c12","#e74c3c"]},TEENS_13_18:{ageRange:[13,18],uiType:"StandardMode",features:["career_cards","avatar_chat","tuition_info","analytics"],requiresConsent:!1,layout:"standard",colors:["#667eea","#764ba2","#f093fb","#4facfe"]},ADULTS_18_PLUS:{ageRange:[18,100],uiType:"ParentMode",features:["scholarship_info","roi_data","admission_requirements","career_stats"],requiresConsent:!1,layout:"parent_dashboard",colors:["#2c3e50","#34495e","#3498db","#2ecc71"]}},Q$=t=>t>=3&&t<=7?Rl.KIDS_3_7:t>=8&&t<=12?Rl.KIDS_8_12:t>=13&&t<=18?Rl.TEENS_13_18:t>=18?Rl.ADULTS_18_PLUS:Rl.KIDS_3_7,Jd=[{id:"au",name:"",code:"Au",category:"",icon:"",color:"#ef4444",gradient:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",description:"    3 /     ",keywords:["","","","","","auto","car"]},{id:"ev",name:"",code:"Ev",category:"",icon:"",color:"#22c55e",gradient:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",description:"  EV    EV  ",keywords:["EV","","","","","electric","battery"]},{id:"ep",name:"",code:"Ep",category:"",icon:"",color:"#fbbf24",gradient:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",description:"      ",keywords:["","","","","PLC","electric","power"]},{id:"el",name:"",code:"El",category:"",icon:"",color:"#3b82f6",gradient:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",description:"          ",keywords:["","","Arduino","IoT","","electronics","circuit"]},{id:"co",name:"",code:"Co",category:"",icon:"",color:"#78716c",gradient:"linear-gradient(135deg, #78716c 0%, #57534e 100%)",description:"    Draftman   ",keywords:["","","","","","construction","building"]},{id:"ar",name:"",code:"Ar",category:"",icon:"",color:"#8b5cf6",gradient:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",description:"           ",keywords:["","","","3D","Revit","architecture","design"]},{id:"ct",name:"",code:"Ct",category:"",icon:"",color:"#06b6d4",gradient:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",description:"    C, Java, Python     IoT ",keywords:["","code","Python","Java","","coding","programming"]},{id:"it",name:"",code:"It",category:"",icon:"",color:"#14b8a6",gradient:"linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)",description:"  .      IT    e-Commerce  IT     ",keywords:["IT","network","server","","","tech","computer",""]},{id:"ac",name:"",code:"Ac",category:"",icon:"",color:"#10b981",gradient:"linear-gradient(135deg, #10b981 0%, #059669 100%)",description:"       ",keywords:["","","","","SAP","accounting","finance"]},{id:"mk",name:"",code:"Mk",category:"",icon:"",color:"#ec4899",gradient:"linear-gradient(135deg, #ec4899 0%, #db2777 100%)",description:" E-Commerce           ",keywords:["","","digital","content","","marketing","social"]},{id:"dt",name:"",code:"Dt",category:"",icon:"",color:"#f97316",gradient:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",description:"       ",keywords:["","","startup","ecommerce","social","digital","business"]},{id:"tg",name:"",code:"Tg",category:"",icon:"",color:"#0ea5e9",gradient:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",description:"       ",keywords:["","","","","","tourism","travel"]},{id:"hm",name:"",code:"Hm",category:"",icon:"",color:"#a855f7",gradient:"linear-gradient(135deg, #a855f7 0%, #9333ea 100%)",description:"      ",keywords:["","","","","","hotel","hospitality"]}],Gn={certificate:{industrial:{tuition:9e3,entrance:3100,total:12100,name:""},business:{tuition:7e3,entrance:3100,total:10100,name:""},tourism:{tuition:7e3,entrance:3100,total:10100,name:""}},diploma:{industrial:{tuition:18700,entrance:3e3,total:21700,name:""},business:{tuition:16e3,entrance:3e3,total:19e3,name:""},tourism:{tuition:16e3,entrance:3e3,total:19e3,name:""}},scholarships:[{id:"cert-m3",name:" .3  .",description:" .3",icon:"",color:"#10b981"},{id:"quota-m6",name:" .6",description:" .6",icon:"",color:"#f59e0b"},{id:"quota-diploma",name:" .",description:" .",icon:"",color:"#8b5cf6"},{id:"student-loan",name:" (.)",description:" ",icon:"",color:"#3b82f6"},{id:"kalyanamitr",name:"",description:"",icon:"",color:"#ec4899"}],benefits:[" 1 ",""," 2 "," 1 "],documents:[".1 "," (, , )"," (, , )",""],applicationMethods:[{method:"walk-in",name:"",icon:"",description:""},{method:"online",name:"",icon:"",description:" "}],notes:["","  "," "]},J$=()=>{};var WC={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xP={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae=function(t,e){if(!t)throw Gu(e)},Gu=function(t){return new Error("Firebase Database ("+xP.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Z$=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],s=t[n++],a=t[n++],u=((i&7)<<18|(o&63)<<12|(s&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const o=t[n++],s=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|s&63)}}return e.join("")},W_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,l=u?t[i+2]:0,c=o>>2,h=(o&3)<<4|a>>4;let f=(a&15)<<2|l>>6,d=l&63;u||(d=64,s||(f=64)),r.push(n[c],n[h],n[f],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(bP(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Z$(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const l=i<t.length?n[t.charAt(i)]:64;++i;const h=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||a==null||l==null||h==null)throw new e8;const f=o<<2|a>>4;if(r.push(f),l!==64){const d=a<<4&240|l>>2;if(r.push(d),h!==64){const m=l<<6&192|h;r.push(m)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class e8 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const EP=function(t){const e=bP(t);return W_.encodeByteArray(e,!0)},Zd=function(t){return EP(t).replace(/\./g,"")},Hy=function(t){try{return W_.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t8(t){return CP(void 0,t)}function CP(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!n8(n)||(t[n]=CP(t[n],e[n]));return t}function n8(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r8(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i8=()=>r8().__FIREBASE_DEFAULTS__,o8=()=>{if(typeof process>"u"||typeof WC>"u")return;const t=WC.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},s8=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Hy(t[1]);return e&&JSON.parse(e)},z_=()=>{try{return J$()||i8()||o8()||s8()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},a8=t=>{var e,n;return(n=(e=z_())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},SP=t=>{const e=a8(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},TP=()=>{var t;return(t=z_())==null?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mh(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function IP(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RP(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Zd(JSON.stringify(n)),Zd(JSON.stringify(s)),""].join(".")}const nc={};function u8(){const t={prod:[],emulator:[]};for(const e of Object.keys(nc))nc[e]?t.emulator.push(e):t.prod.push(e);return t}function l8(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let zC=!1;function AP(t,e){if(typeof window>"u"||typeof document>"u"||!mh(window.location.host)||nc[t]===e||nc[t]||zC)return;nc[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",o=u8().prod.length>0;function s(){const f=document.getElementById(r);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function u(f,d){f.setAttribute("width","24"),f.setAttribute("id",d),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function l(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{zC=!0,s()},f}function c(f,d){f.setAttribute("id",d),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=l8(r),d=n("text"),m=document.getElementById(d)||document.createElement("span"),v=n("learnmore"),y=document.getElementById(v)||document.createElement("a"),g=n("preprendIcon"),_=document.getElementById(g)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const w=f.element;a(w),c(y,v);const x=l();u(_,g),w.append(_,m,y,x),document.body.appendChild(w)}o?(m.innerText="Preview backend disconnected.",_.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(_.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,m.innerText="Preview backend running in this workspace."),m.setAttribute("id",d)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kP(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function PP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(kP())}function c8(){var e;const t=(e=z_())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function h8(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function f8(){return xP.NODE_ADMIN===!0}function d8(){return!c8()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function p8(){try{return typeof indexedDB=="object"}catch{return!1}}function m8(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var o;e(((o=i.error)==null?void 0:o.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g8="FirebaseError";class qu extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=g8,Object.setPrototypeOf(this,qu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,NP.prototype.create)}}class NP{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],s=o?v8(o,r):"Error",a=`${this.serviceName}: ${s} (${i}).`;return new qu(i,a,r)}}function v8(t,e){return t.replace(y8,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const y8=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(t){return JSON.parse(t)}function hn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DP=function(t){let e={},n={},r={},i="";try{const o=t.split(".");e=Bc(Hy(o[0])||""),n=Bc(Hy(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:i}},_8=function(t){const e=DP(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},w8=function(t){const e=DP(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uo(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Nu(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function $C(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ep(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function jc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],s=e[i];if(HC(o)&&HC(s)){if(!jc(o,s))return!1}else if(o!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function HC(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x8(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b8{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let i=this.chain_[0],o=this.chain_[1],s=this.chain_[2],a=this.chain_[3],u=this.chain_[4],l,c;for(let h=0;h<80;h++){h<40?h<20?(l=a^o&(s^a),c=1518500249):(l=o^s^a,c=1859775393):h<60?(l=o&s|a&(o|s),c=2400959708):(l=o^s^a,c=3395469782);const f=(i<<5|i>>>27)+l+u+c+r[h]&4294967295;u=a,a=s,s=(o<<30|o>>>2)&4294967295,o=i,i=f}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+s&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let i=0;const o=this.buf_;let s=this.inbuf_;for(;i<n;){if(s===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(o[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(o),s=0;break}}else for(;i<n;)if(o[s]=e[i],++s,++i,s===this.blockSize){this.compress_(o),s=0;break}}this.inbuf_=s,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let o=24;o>=0;o-=8)e[r]=this.chain_[i]>>o&255,++r;return e}}function E8(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C8=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const o=i-55296;r++,ae(r<t.length,"Surrogate pair missing trail surrogate.");const s=t.charCodeAt(r)-56320;i=65536+(o<<10)+s}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},um=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Js(t){return t&&t._delegate?t._delegate:t}class Du{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S8{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new $_;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(I8(e))try{this.getOrInitializeService({instanceIdentifier:Rs})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Rs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Rs){return this.instances.has(e)}getOptions(e=Rs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,s]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(o);r===a&&s.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:T8(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Rs){return this.component?this.component.multipleInstances?e:Rs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function T8(t){return t===Rs?void 0:t}function I8(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R8{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new S8(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Be;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Be||(Be={}));const A8={debug:Be.DEBUG,verbose:Be.VERBOSE,info:Be.INFO,warn:Be.WARN,error:Be.ERROR,silent:Be.SILENT},k8=Be.INFO,P8={[Be.DEBUG]:"log",[Be.VERBOSE]:"log",[Be.INFO]:"info",[Be.WARN]:"warn",[Be.ERROR]:"error"},N8=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=P8[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class H_{constructor(e){this.name=e,this._logLevel=k8,this._logHandler=N8,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Be))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?A8[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Be.DEBUG,...e),this._logHandler(this,Be.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Be.VERBOSE,...e),this._logHandler(this,Be.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Be.INFO,...e),this._logHandler(this,Be.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Be.WARN,...e),this._logHandler(this,Be.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Be.ERROR,...e),this._logHandler(this,Be.ERROR,...e)}}const D8=(t,e)=>e.some(n=>t instanceof n);let GC,qC;function M8(){return GC||(GC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function F8(){return qC||(qC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const MP=new WeakMap,Gy=new WeakMap,FP=new WeakMap,ev=new WeakMap,G_=new WeakMap;function O8(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{n(Wo(t.result)),i()},s=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",s)});return e.then(n=>{n instanceof IDBCursor&&MP.set(n,t)}).catch(()=>{}),G_.set(e,t),e}function L8(t){if(Gy.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{n(),i()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)});Gy.set(t,e)}let qy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Gy.get(t);if(e==="objectStoreNames")return t.objectStoreNames||FP.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Wo(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function V8(t){qy=t(qy)}function B8(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(tv(this),e,...n);return FP.set(r,e.sort?e.sort():[e]),Wo(r)}:F8().includes(t)?function(...e){return t.apply(tv(this),e),Wo(MP.get(this))}:function(...e){return Wo(t.apply(tv(this),e))}}function j8(t){return typeof t=="function"?B8(t):(t instanceof IDBTransaction&&L8(t),D8(t,M8())?new Proxy(t,qy):t)}function Wo(t){if(t instanceof IDBRequest)return O8(t);if(ev.has(t))return ev.get(t);const e=j8(t);return e!==t&&(ev.set(t,e),G_.set(e,t)),e}const tv=t=>G_.get(t);function U8(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(t,e),a=Wo(s);return r&&s.addEventListener("upgradeneeded",u=>{r(Wo(s.result),u.oldVersion,u.newVersion,Wo(s.transaction),u)}),n&&s.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),a.then(u=>{o&&u.addEventListener("close",()=>o()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const W8=["get","getKey","getAll","getAllKeys","count"],z8=["put","add","delete","clear"],nv=new Map;function KC(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(nv.get(e))return nv.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=z8.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||W8.includes(n)))return;const o=async function(s,...a){const u=this.transaction(s,i?"readwrite":"readonly");let l=u.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),i&&u.done]))[0]};return nv.set(e,o),o}V8(t=>({...t,get:(e,n,r)=>KC(e,n)||t.get(e,n,r),has:(e,n)=>!!KC(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $8{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(H8(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function H8(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ky="@firebase/app",XC="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi=new H_("@firebase/app"),G8="@firebase/app-compat",q8="@firebase/analytics-compat",K8="@firebase/analytics",X8="@firebase/app-check-compat",Y8="@firebase/app-check",Q8="@firebase/auth",J8="@firebase/auth-compat",Z8="@firebase/database",eH="@firebase/data-connect",tH="@firebase/database-compat",nH="@firebase/functions",rH="@firebase/functions-compat",iH="@firebase/installations",oH="@firebase/installations-compat",sH="@firebase/messaging",aH="@firebase/messaging-compat",uH="@firebase/performance",lH="@firebase/performance-compat",cH="@firebase/remote-config",hH="@firebase/remote-config-compat",fH="@firebase/storage",dH="@firebase/storage-compat",pH="@firebase/firestore",mH="@firebase/ai",gH="@firebase/firestore-compat",vH="firebase",yH="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy="[DEFAULT]",_H={[Ky]:"fire-core",[G8]:"fire-core-compat",[K8]:"fire-analytics",[q8]:"fire-analytics-compat",[Y8]:"fire-app-check",[X8]:"fire-app-check-compat",[Q8]:"fire-auth",[J8]:"fire-auth-compat",[Z8]:"fire-rtdb",[eH]:"fire-data-connect",[tH]:"fire-rtdb-compat",[nH]:"fire-fn",[rH]:"fire-fn-compat",[iH]:"fire-iid",[oH]:"fire-iid-compat",[sH]:"fire-fcm",[aH]:"fire-fcm-compat",[uH]:"fire-perf",[lH]:"fire-perf-compat",[cH]:"fire-rc",[hH]:"fire-rc-compat",[fH]:"fire-gcs",[dH]:"fire-gcs-compat",[pH]:"fire-fst",[gH]:"fire-fst-compat",[mH]:"fire-vertex","fire-js":"fire-js",[vH]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tp=new Map,wH=new Map,Yy=new Map;function YC(t,e){try{t.container.addComponent(e)}catch(n){Zi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Uc(t){const e=t.name;if(Yy.has(e))return Zi.debug(`There were multiple attempts to register component ${e}.`),!1;Yy.set(e,t);for(const n of tp.values())YC(n,t);for(const n of wH.values())YC(n,t);return!0}function OP(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function LP(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xH={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zo=new NP("app","Firebase",xH);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bH{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Du("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw zo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VP=yH;function BP(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Xy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw zo.create("bad-app-name",{appName:String(i)});if(n||(n=TP()),!n)throw zo.create("no-options");const o=tp.get(i);if(o){if(jc(n,o.options)&&jc(r,o.config))return o;throw zo.create("duplicate-app",{appName:i})}const s=new R8(i);for(const u of Yy.values())s.addComponent(u);const a=new bH(n,r,s);return tp.set(i,a),a}function jP(t=Xy){const e=tp.get(t);if(!e&&t===Xy&&TP())return BP();if(!e)throw zo.create("no-app",{appName:t});return e}function $o(t,e,n){let r=_H[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const s=[`Unable to register library "${r}" with version "${e}":`];i&&s.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&s.push("and"),o&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zi.warn(s.join(" "));return}Uc(new Du(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EH="firebase-heartbeat-database",CH=1,Wc="firebase-heartbeat-store";let rv=null;function UP(){return rv||(rv=U8(EH,CH,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Wc)}catch(n){console.warn(n)}}}}).catch(t=>{throw zo.create("idb-open",{originalErrorMessage:t.message})})),rv}async function SH(t){try{const n=(await UP()).transaction(Wc),r=await n.objectStore(Wc).get(WP(t));return await n.done,r}catch(e){if(e instanceof qu)Zi.warn(e.message);else{const n=zo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zi.warn(n.message)}}}async function QC(t,e){try{const r=(await UP()).transaction(Wc,"readwrite");await r.objectStore(Wc).put(e,WP(t)),await r.done}catch(n){if(n instanceof qu)Zi.warn(n.message);else{const r=zo.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Zi.warn(r.message)}}}function WP(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TH=1024,IH=30;class RH{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new kH(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=JC();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(s=>s.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>IH){const s=PH(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Zi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=JC(),{heartbeatsToSend:r,unsentEntries:i}=AH(this._heartbeatsCache.heartbeats),o=Zd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(n){return Zi.warn(n),""}}}function JC(){return new Date().toISOString().substring(0,10)}function AH(t,e=TH){const n=[];let r=t.slice();for(const i of t){const o=n.find(s=>s.agent===i.agent);if(o){if(o.dates.push(i.date),ZC(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ZC(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class kH{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return p8()?m8().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await SH(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return QC(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return QC(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function ZC(t){return Zd(JSON.stringify({version:2,heartbeats:t})).length}function PH(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NH(t){Uc(new Du("platform-logger",e=>new $8(e),"PRIVATE")),Uc(new Du("heartbeat",e=>new RH(e),"PRIVATE")),$o(Ky,XC,t),$o(Ky,XC,"esm2020"),$o("fire-js","")}NH("");var DH="firebase",MH="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$o(DH,MH,"app");var e2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var q_;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,E){function C(){}C.prototype=E.prototype,T.F=E.prototype,T.prototype=new C,T.prototype.constructor=T,T.D=function(I,P,N){for(var k=Array(arguments.length-2),j=2;j<arguments.length;j++)k[j-2]=arguments[j];return E.prototype[P].apply(I,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,E,C){C||(C=0);const I=Array(16);if(typeof E=="string")for(var P=0;P<16;++P)I[P]=E.charCodeAt(C++)|E.charCodeAt(C++)<<8|E.charCodeAt(C++)<<16|E.charCodeAt(C++)<<24;else for(P=0;P<16;++P)I[P]=E[C++]|E[C++]<<8|E[C++]<<16|E[C++]<<24;E=T.g[0],C=T.g[1],P=T.g[2];let N=T.g[3],k;k=E+(N^C&(P^N))+I[0]+3614090360&4294967295,E=C+(k<<7&4294967295|k>>>25),k=N+(P^E&(C^P))+I[1]+3905402710&4294967295,N=E+(k<<12&4294967295|k>>>20),k=P+(C^N&(E^C))+I[2]+606105819&4294967295,P=N+(k<<17&4294967295|k>>>15),k=C+(E^P&(N^E))+I[3]+3250441966&4294967295,C=P+(k<<22&4294967295|k>>>10),k=E+(N^C&(P^N))+I[4]+4118548399&4294967295,E=C+(k<<7&4294967295|k>>>25),k=N+(P^E&(C^P))+I[5]+1200080426&4294967295,N=E+(k<<12&4294967295|k>>>20),k=P+(C^N&(E^C))+I[6]+2821735955&4294967295,P=N+(k<<17&4294967295|k>>>15),k=C+(E^P&(N^E))+I[7]+4249261313&4294967295,C=P+(k<<22&4294967295|k>>>10),k=E+(N^C&(P^N))+I[8]+1770035416&4294967295,E=C+(k<<7&4294967295|k>>>25),k=N+(P^E&(C^P))+I[9]+2336552879&4294967295,N=E+(k<<12&4294967295|k>>>20),k=P+(C^N&(E^C))+I[10]+4294925233&4294967295,P=N+(k<<17&4294967295|k>>>15),k=C+(E^P&(N^E))+I[11]+2304563134&4294967295,C=P+(k<<22&4294967295|k>>>10),k=E+(N^C&(P^N))+I[12]+1804603682&4294967295,E=C+(k<<7&4294967295|k>>>25),k=N+(P^E&(C^P))+I[13]+4254626195&4294967295,N=E+(k<<12&4294967295|k>>>20),k=P+(C^N&(E^C))+I[14]+2792965006&4294967295,P=N+(k<<17&4294967295|k>>>15),k=C+(E^P&(N^E))+I[15]+1236535329&4294967295,C=P+(k<<22&4294967295|k>>>10),k=E+(P^N&(C^P))+I[1]+4129170786&4294967295,E=C+(k<<5&4294967295|k>>>27),k=N+(C^P&(E^C))+I[6]+3225465664&4294967295,N=E+(k<<9&4294967295|k>>>23),k=P+(E^C&(N^E))+I[11]+643717713&4294967295,P=N+(k<<14&4294967295|k>>>18),k=C+(N^E&(P^N))+I[0]+3921069994&4294967295,C=P+(k<<20&4294967295|k>>>12),k=E+(P^N&(C^P))+I[5]+3593408605&4294967295,E=C+(k<<5&4294967295|k>>>27),k=N+(C^P&(E^C))+I[10]+38016083&4294967295,N=E+(k<<9&4294967295|k>>>23),k=P+(E^C&(N^E))+I[15]+3634488961&4294967295,P=N+(k<<14&4294967295|k>>>18),k=C+(N^E&(P^N))+I[4]+3889429448&4294967295,C=P+(k<<20&4294967295|k>>>12),k=E+(P^N&(C^P))+I[9]+568446438&4294967295,E=C+(k<<5&4294967295|k>>>27),k=N+(C^P&(E^C))+I[14]+3275163606&4294967295,N=E+(k<<9&4294967295|k>>>23),k=P+(E^C&(N^E))+I[3]+4107603335&4294967295,P=N+(k<<14&4294967295|k>>>18),k=C+(N^E&(P^N))+I[8]+1163531501&4294967295,C=P+(k<<20&4294967295|k>>>12),k=E+(P^N&(C^P))+I[13]+2850285829&4294967295,E=C+(k<<5&4294967295|k>>>27),k=N+(C^P&(E^C))+I[2]+4243563512&4294967295,N=E+(k<<9&4294967295|k>>>23),k=P+(E^C&(N^E))+I[7]+1735328473&4294967295,P=N+(k<<14&4294967295|k>>>18),k=C+(N^E&(P^N))+I[12]+2368359562&4294967295,C=P+(k<<20&4294967295|k>>>12),k=E+(C^P^N)+I[5]+4294588738&4294967295,E=C+(k<<4&4294967295|k>>>28),k=N+(E^C^P)+I[8]+2272392833&4294967295,N=E+(k<<11&4294967295|k>>>21),k=P+(N^E^C)+I[11]+1839030562&4294967295,P=N+(k<<16&4294967295|k>>>16),k=C+(P^N^E)+I[14]+4259657740&4294967295,C=P+(k<<23&4294967295|k>>>9),k=E+(C^P^N)+I[1]+2763975236&4294967295,E=C+(k<<4&4294967295|k>>>28),k=N+(E^C^P)+I[4]+1272893353&4294967295,N=E+(k<<11&4294967295|k>>>21),k=P+(N^E^C)+I[7]+4139469664&4294967295,P=N+(k<<16&4294967295|k>>>16),k=C+(P^N^E)+I[10]+3200236656&4294967295,C=P+(k<<23&4294967295|k>>>9),k=E+(C^P^N)+I[13]+681279174&4294967295,E=C+(k<<4&4294967295|k>>>28),k=N+(E^C^P)+I[0]+3936430074&4294967295,N=E+(k<<11&4294967295|k>>>21),k=P+(N^E^C)+I[3]+3572445317&4294967295,P=N+(k<<16&4294967295|k>>>16),k=C+(P^N^E)+I[6]+76029189&4294967295,C=P+(k<<23&4294967295|k>>>9),k=E+(C^P^N)+I[9]+3654602809&4294967295,E=C+(k<<4&4294967295|k>>>28),k=N+(E^C^P)+I[12]+3873151461&4294967295,N=E+(k<<11&4294967295|k>>>21),k=P+(N^E^C)+I[15]+530742520&4294967295,P=N+(k<<16&4294967295|k>>>16),k=C+(P^N^E)+I[2]+3299628645&4294967295,C=P+(k<<23&4294967295|k>>>9),k=E+(P^(C|~N))+I[0]+4096336452&4294967295,E=C+(k<<6&4294967295|k>>>26),k=N+(C^(E|~P))+I[7]+1126891415&4294967295,N=E+(k<<10&4294967295|k>>>22),k=P+(E^(N|~C))+I[14]+2878612391&4294967295,P=N+(k<<15&4294967295|k>>>17),k=C+(N^(P|~E))+I[5]+4237533241&4294967295,C=P+(k<<21&4294967295|k>>>11),k=E+(P^(C|~N))+I[12]+1700485571&4294967295,E=C+(k<<6&4294967295|k>>>26),k=N+(C^(E|~P))+I[3]+2399980690&4294967295,N=E+(k<<10&4294967295|k>>>22),k=P+(E^(N|~C))+I[10]+4293915773&4294967295,P=N+(k<<15&4294967295|k>>>17),k=C+(N^(P|~E))+I[1]+2240044497&4294967295,C=P+(k<<21&4294967295|k>>>11),k=E+(P^(C|~N))+I[8]+1873313359&4294967295,E=C+(k<<6&4294967295|k>>>26),k=N+(C^(E|~P))+I[15]+4264355552&4294967295,N=E+(k<<10&4294967295|k>>>22),k=P+(E^(N|~C))+I[6]+2734768916&4294967295,P=N+(k<<15&4294967295|k>>>17),k=C+(N^(P|~E))+I[13]+1309151649&4294967295,C=P+(k<<21&4294967295|k>>>11),k=E+(P^(C|~N))+I[4]+4149444226&4294967295,E=C+(k<<6&4294967295|k>>>26),k=N+(C^(E|~P))+I[11]+3174756917&4294967295,N=E+(k<<10&4294967295|k>>>22),k=P+(E^(N|~C))+I[2]+718787259&4294967295,P=N+(k<<15&4294967295|k>>>17),k=C+(N^(P|~E))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+E&4294967295,T.g[1]=T.g[1]+(P+(k<<21&4294967295|k>>>11))&4294967295,T.g[2]=T.g[2]+P&4294967295,T.g[3]=T.g[3]+N&4294967295}r.prototype.v=function(T,E){E===void 0&&(E=T.length);const C=E-this.blockSize,I=this.C;let P=this.h,N=0;for(;N<E;){if(P==0)for(;N<=C;)i(this,T,N),N+=this.blockSize;if(typeof T=="string"){for(;N<E;)if(I[P++]=T.charCodeAt(N++),P==this.blockSize){i(this,I),P=0;break}}else for(;N<E;)if(I[P++]=T[N++],P==this.blockSize){i(this,I),P=0;break}}this.h=P,this.o+=E},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var E=1;E<T.length-8;++E)T[E]=0;E=this.o*8;for(var C=T.length-8;C<T.length;++C)T[C]=E&255,E/=256;for(this.v(T),T=Array(16),E=0,C=0;C<4;++C)for(let I=0;I<32;I+=8)T[E++]=this.g[C]>>>I&255;return T};function o(T,E){var C=a;return Object.prototype.hasOwnProperty.call(C,T)?C[T]:C[T]=E(T)}function s(T,E){this.h=E;const C=[];let I=!0;for(let P=T.length-1;P>=0;P--){const N=T[P]|0;I&&N==E||(C[P]=N,I=!1)}this.g=C}var a={};function u(T){return-128<=T&&T<128?o(T,function(E){return new s([E|0],E<0?-1:0)}):new s([T|0],T<0?-1:0)}function l(T){if(isNaN(T)||!isFinite(T))return h;if(T<0)return y(l(-T));const E=[];let C=1;for(let I=0;T>=C;I++)E[I]=T/C|0,C*=4294967296;return new s(E,0)}function c(T,E){if(T.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(T.charAt(0)=="-")return y(c(T.substring(1),E));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const C=l(Math.pow(E,8));let I=h;for(let N=0;N<T.length;N+=8){var P=Math.min(8,T.length-N);const k=parseInt(T.substring(N,N+P),E);P<8?(P=l(Math.pow(E,P)),I=I.j(P).add(l(k))):(I=I.j(C),I=I.add(l(k)))}return I}var h=u(0),f=u(1),d=u(16777216);t=s.prototype,t.m=function(){if(v(this))return-y(this).m();let T=0,E=1;for(let C=0;C<this.g.length;C++){const I=this.i(C);T+=(I>=0?I:4294967296+I)*E,E*=4294967296}return T},t.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(m(this))return"0";if(v(this))return"-"+y(this).toString(T);const E=l(Math.pow(T,6));var C=this;let I="";for(;;){const P=x(C,E).g;C=g(C,P.j(E));let N=((C.g.length>0?C.g[0]:C.h)>>>0).toString(T);if(C=P,m(C))return N+I;for(;N.length<6;)N="0"+N;I=N+I}},t.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function m(T){if(T.h!=0)return!1;for(let E=0;E<T.g.length;E++)if(T.g[E]!=0)return!1;return!0}function v(T){return T.h==-1}t.l=function(T){return T=g(this,T),v(T)?-1:m(T)?0:1};function y(T){const E=T.g.length,C=[];for(let I=0;I<E;I++)C[I]=~T.g[I];return new s(C,~T.h).add(f)}t.abs=function(){return v(this)?y(this):this},t.add=function(T){const E=Math.max(this.g.length,T.g.length),C=[];let I=0;for(let P=0;P<=E;P++){let N=I+(this.i(P)&65535)+(T.i(P)&65535),k=(N>>>16)+(this.i(P)>>>16)+(T.i(P)>>>16);I=k>>>16,N&=65535,k&=65535,C[P]=k<<16|N}return new s(C,C[C.length-1]&-2147483648?-1:0)};function g(T,E){return T.add(y(E))}t.j=function(T){if(m(this)||m(T))return h;if(v(this))return v(T)?y(this).j(y(T)):y(y(this).j(T));if(v(T))return y(this.j(y(T)));if(this.l(d)<0&&T.l(d)<0)return l(this.m()*T.m());const E=this.g.length+T.g.length,C=[];for(var I=0;I<2*E;I++)C[I]=0;for(I=0;I<this.g.length;I++)for(let P=0;P<T.g.length;P++){const N=this.i(I)>>>16,k=this.i(I)&65535,j=T.i(P)>>>16,W=T.i(P)&65535;C[2*I+2*P]+=k*W,_(C,2*I+2*P),C[2*I+2*P+1]+=N*W,_(C,2*I+2*P+1),C[2*I+2*P+1]+=k*j,_(C,2*I+2*P+1),C[2*I+2*P+2]+=N*j,_(C,2*I+2*P+2)}for(T=0;T<E;T++)C[T]=C[2*T+1]<<16|C[2*T];for(T=E;T<2*E;T++)C[T]=0;return new s(C,0)};function _(T,E){for(;(T[E]&65535)!=T[E];)T[E+1]+=T[E]>>>16,T[E]&=65535,E++}function w(T,E){this.g=T,this.h=E}function x(T,E){if(m(E))throw Error("division by zero");if(m(T))return new w(h,h);if(v(T))return E=x(y(T),E),new w(y(E.g),y(E.h));if(v(E))return E=x(T,y(E)),new w(y(E.g),E.h);if(T.g.length>30){if(v(T)||v(E))throw Error("slowDivide_ only works with positive integers.");for(var C=f,I=E;I.l(T)<=0;)C=S(C),I=S(I);var P=A(C,1),N=A(I,1);for(I=A(I,2),C=A(C,2);!m(I);){var k=N.add(I);k.l(T)<=0&&(P=P.add(C),N=k),I=A(I,1),C=A(C,1)}return E=g(T,P.j(E)),new w(P,E)}for(P=h;T.l(E)>=0;){for(C=Math.max(1,Math.floor(T.m()/E.m())),I=Math.ceil(Math.log(C)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),N=l(C),k=N.j(E);v(k)||k.l(T)>0;)C-=I,N=l(C),k=N.j(E);m(N)&&(N=f),P=P.add(N),T=g(T,k)}return new w(P,T)}t.B=function(T){return x(this,T).h},t.and=function(T){const E=Math.max(this.g.length,T.g.length),C=[];for(let I=0;I<E;I++)C[I]=this.i(I)&T.i(I);return new s(C,this.h&T.h)},t.or=function(T){const E=Math.max(this.g.length,T.g.length),C=[];for(let I=0;I<E;I++)C[I]=this.i(I)|T.i(I);return new s(C,this.h|T.h)},t.xor=function(T){const E=Math.max(this.g.length,T.g.length),C=[];for(let I=0;I<E;I++)C[I]=this.i(I)^T.i(I);return new s(C,this.h^T.h)};function S(T){const E=T.g.length+1,C=[];for(let I=0;I<E;I++)C[I]=T.i(I)<<1|T.i(I-1)>>>31;return new s(C,T.h)}function A(T,E){const C=E>>5;E%=32;const I=T.g.length-C,P=[];for(let N=0;N<I;N++)P[N]=E>0?T.i(N+C)>>>E|T.i(N+C+1)<<32-E:T.i(N+C);return new s(P,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=l,s.fromString=c,q_=s}).apply(typeof e2<"u"?e2:typeof self<"u"?self:typeof window<"u"?window:{});var bf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zP,Bl,$P,Hf,Qy,HP,GP,qP;(function(){var t,e=Object.defineProperty;function n(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof bf=="object"&&bf];for(var b=0;b<p.length;++b){var R=p[b];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var r=n(this);function i(p,b){if(b)e:{var R=r;p=p.split(".");for(var F=0;F<p.length-1;F++){var $=p[F];if(!($ in R))break e;R=R[$]}p=p[p.length-1],F=R[p],b=b(F),b!=F&&b!=null&&e(R,p,{configurable:!0,writable:!0,value:b})}}i("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(p){return p||function(b){var R=[],F;for(F in b)Object.prototype.hasOwnProperty.call(b,F)&&R.push([F,b[F]]);return R}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},s=this||self;function a(p){var b=typeof p;return b=="object"&&p!=null||b=="function"}function u(p,b,R){return p.call.apply(p.bind,arguments)}function l(p,b,R){return l=u,l.apply(null,arguments)}function c(p,b){var R=Array.prototype.slice.call(arguments,1);return function(){var F=R.slice();return F.push.apply(F,arguments),p.apply(this,F)}}function h(p,b){function R(){}R.prototype=b.prototype,p.Z=b.prototype,p.prototype=new R,p.prototype.constructor=p,p.Ob=function(F,$,G){for(var oe=Array(arguments.length-2),Ne=2;Ne<arguments.length;Ne++)oe[Ne-2]=arguments[Ne];return b.prototype[$].apply(F,oe)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function d(p){const b=p.length;if(b>0){const R=Array(b);for(let F=0;F<b;F++)R[F]=p[F];return R}return[]}function m(p,b){for(let F=1;F<arguments.length;F++){const $=arguments[F];var R=typeof $;if(R=R!="object"?R:$?Array.isArray($)?"array":R:"null",R=="array"||R=="object"&&typeof $.length=="number"){R=p.length||0;const G=$.length||0;p.length=R+G;for(let oe=0;oe<G;oe++)p[R+oe]=$[oe]}else p.push($)}}class v{constructor(b,R){this.i=b,this.j=R,this.h=0,this.g=null}get(){let b;return this.h>0?(this.h--,b=this.g,this.g=b.next,b.next=null):b=this.i(),b}}function y(p){s.setTimeout(()=>{throw p},0)}function g(){var p=T;let b=null;return p.g&&(b=p.g,p.g=p.g.next,p.g||(p.h=null),b.next=null),b}class _{constructor(){this.h=this.g=null}add(b,R){const F=w.get();F.set(b,R),this.h?this.h.next=F:this.g=F,this.h=F}}var w=new v(()=>new x,p=>p.reset());class x{constructor(){this.next=this.g=this.h=null}set(b,R){this.h=b,this.g=R,this.next=null}reset(){this.next=this.g=this.h=null}}let S,A=!1,T=new _,E=()=>{const p=Promise.resolve(void 0);S=()=>{p.then(C)}};function C(){for(var p;p=g();){try{p.h.call(p.g)}catch(R){y(R)}var b=w;b.j(p),b.h<100&&(b.h++,p.next=b.g,b.g=p)}A=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function P(p,b){this.type=p,this.g=this.target=b,this.defaultPrevented=!1}P.prototype.h=function(){this.defaultPrevented=!0};var N=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var p=!1,b=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const R=()=>{};s.addEventListener("test",R,b),s.removeEventListener("test",R,b)}catch{}return p}();function k(p){return/^[\s\xa0]*$/.test(p)}function j(p,b){P.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,b)}h(j,P),j.prototype.init=function(p,b){const R=this.type=p.type,F=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=b,b=p.relatedTarget,b||(R=="mouseover"?b=p.fromElement:R=="mouseout"&&(b=p.toElement)),this.relatedTarget=b,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&j.Z.h.call(this)},j.prototype.h=function(){j.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var W="closure_listenable_"+(Math.random()*1e6|0),q=0;function X(p,b,R,F,$){this.listener=p,this.proxy=null,this.src=b,this.type=R,this.capture=!!F,this.ha=$,this.key=++q,this.da=this.fa=!1}function V(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function z(p,b,R){for(const F in p)b.call(R,p[F],F,p)}function U(p,b){for(const R in p)b.call(void 0,p[R],R,p)}function Q(p){const b={};for(const R in p)b[R]=p[R];return b}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(p,b){let R,F;for(let $=1;$<arguments.length;$++){F=arguments[$];for(R in F)p[R]=F[R];for(let G=0;G<te.length;G++)R=te[G],Object.prototype.hasOwnProperty.call(F,R)&&(p[R]=F[R])}}function we(p){this.src=p,this.g={},this.h=0}we.prototype.add=function(p,b,R,F,$){const G=p.toString();p=this.g[G],p||(p=this.g[G]=[],this.h++);const oe=ce(p,b,F,$);return oe>-1?(b=p[oe],R||(b.fa=!1)):(b=new X(b,this.src,G,!!F,$),b.fa=R,p.push(b)),b};function _e(p,b){const R=b.type;if(R in p.g){var F=p.g[R],$=Array.prototype.indexOf.call(F,b,void 0),G;(G=$>=0)&&Array.prototype.splice.call(F,$,1),G&&(V(b),p.g[R].length==0&&(delete p.g[R],p.h--))}}function ce(p,b,R,F){for(let $=0;$<p.length;++$){const G=p[$];if(!G.da&&G.listener==b&&G.capture==!!R&&G.ha==F)return $}return-1}var be="closure_lm_"+(Math.random()*1e6|0),xe={};function Se(p,b,R,F,$){if(Array.isArray(b)){for(let G=0;G<b.length;G++)Se(p,b[G],R,F,$);return null}return R=or(R),p&&p[W]?p.J(b,R,a(F)?!!F.capture:!1,$):qe(p,b,R,!1,F,$)}function qe(p,b,R,F,$,G){if(!b)throw Error("Invalid event type");const oe=a($)?!!$.capture:!!$;let Ne=et(p);if(Ne||(p[be]=Ne=new we(p)),R=Ne.add(b,R,F,oe,G),R.proxy)return R;if(F=Ee(),R.proxy=F,F.src=p,F.listener=R,p.addEventListener)N||($=oe),$===void 0&&($=!1),p.addEventListener(b.toString(),F,$);else if(p.attachEvent)p.attachEvent(st(b.toString()),F);else if(p.addListener&&p.removeListener)p.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return R}function Ee(){function p(R){return b.call(p.src,p.listener,R)}const b=at;return p}function Le(p,b,R,F,$){if(Array.isArray(b))for(var G=0;G<b.length;G++)Le(p,b[G],R,F,$);else F=a(F)?!!F.capture:!!F,R=or(R),p&&p[W]?(p=p.i,G=String(b).toString(),G in p.g&&(b=p.g[G],R=ce(b,R,F,$),R>-1&&(V(b[R]),Array.prototype.splice.call(b,R,1),b.length==0&&(delete p.g[G],p.h--)))):p&&(p=et(p))&&(b=p.g[b.toString()],p=-1,b&&(p=ce(b,R,F,$)),(R=p>-1?b[p]:null)&&Ve(R))}function Ve(p){if(typeof p!="number"&&p&&!p.da){var b=p.src;if(b&&b[W])_e(b.i,p);else{var R=p.type,F=p.proxy;b.removeEventListener?b.removeEventListener(R,F,p.capture):b.detachEvent?b.detachEvent(st(R),F):b.addListener&&b.removeListener&&b.removeListener(F),(R=et(b))?(_e(R,p),R.h==0&&(R.src=null,b[be]=null)):V(p)}}}function st(p){return p in xe?xe[p]:xe[p]="on"+p}function at(p,b){if(p.da)p=!0;else{b=new j(b,this);const R=p.listener,F=p.ha||p.src;p.fa&&Ve(p),p=R.call(F,b)}return p}function et(p){return p=p[be],p instanceof we?p:null}var Wn="__closure_events_fn_"+(Math.random()*1e9>>>0);function or(p){return typeof p=="function"?p:(p[Wn]||(p[Wn]=function(b){return p.handleEvent(b)}),p[Wn])}function Ke(){I.call(this),this.i=new we(this),this.M=this,this.G=null}h(Ke,I),Ke.prototype[W]=!0,Ke.prototype.removeEventListener=function(p,b,R,F){Le(this,p,b,R,F)};function Tt(p,b){var R,F=p.G;if(F)for(R=[];F;F=F.G)R.push(F);if(p=p.M,F=b.type||b,typeof b=="string")b=new P(b,p);else if(b instanceof P)b.target=b.target||p;else{var $=b;b=new P(F,p),ie(b,$)}$=!0;let G,oe;if(R)for(oe=R.length-1;oe>=0;oe--)G=b.g=R[oe],$=zn(G,F,!0,b)&&$;if(G=b.g=p,$=zn(G,F,!0,b)&&$,$=zn(G,F,!1,b)&&$,R)for(oe=0;oe<R.length;oe++)G=b.g=R[oe],$=zn(G,F,!1,b)&&$}Ke.prototype.N=function(){if(Ke.Z.N.call(this),this.i){var p=this.i;for(const b in p.g){const R=p.g[b];for(let F=0;F<R.length;F++)V(R[F]);delete p.g[b],p.h--}}this.G=null},Ke.prototype.J=function(p,b,R,F){return this.i.add(String(p),b,!1,R,F)},Ke.prototype.K=function(p,b,R,F){return this.i.add(String(p),b,!0,R,F)};function zn(p,b,R,F){if(b=p.i.g[String(b)],!b)return!0;b=b.concat();let $=!0;for(let G=0;G<b.length;++G){const oe=b[G];if(oe&&!oe.da&&oe.capture==R){const Ne=oe.listener,Bt=oe.ha||oe.src;oe.fa&&_e(p.i,oe),$=Ne.call(Bt,F)!==!1&&$}}return $&&!F.defaultPrevented}function ni(p,b){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=l(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(b)>2147483647?-1:s.setTimeout(p,b||0)}function xr(p){p.g=ni(()=>{p.g=null,p.i&&(p.i=!1,xr(p))},p.l);const b=p.h;p.h=null,p.m.apply(null,b)}class lo extends I{constructor(b,R){super(),this.m=b,this.l=R,this.h=null,this.i=!1,this.g=null}j(b){this.h=arguments,this.g?this.i=!0:xr(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mn(p){I.call(this),this.h=p,this.g={}}h(Mn,I);var _a=[];function Ai(p){z(p.g,function(b,R){this.g.hasOwnProperty(R)&&Ve(b)},p),p.g={}}Mn.prototype.N=function(){Mn.Z.N.call(this),Ai(this)},Mn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var $n=s.JSON.stringify,Zu=s.JSON.parse,Im=class{stringify(p){return s.JSON.stringify(p,void 0)}parse(p){return s.JSON.parse(p,void 0)}};function Ih(){}function Rh(){}var ki={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function fs(){P.call(this,"d")}h(fs,P);function ds(){P.call(this,"c")}h(ds,P);var ps={},jw=null;function Ah(){return jw=jw||new Ke}ps.Ia="serverreachability";function Uw(p){P.call(this,ps.Ia,p)}h(Uw,P);function el(p){const b=Ah();Tt(b,new Uw(b))}ps.STAT_EVENT="statevent";function Ww(p,b){P.call(this,ps.STAT_EVENT,p),this.stat=b}h(Ww,P);function Fn(p){const b=Ah();Tt(b,new Ww(b,p))}ps.Ja="timingevent";function zw(p,b){P.call(this,ps.Ja,p),this.size=b}h(zw,P);function tl(p,b){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){p()},b)}function nl(){this.g=!0}nl.prototype.ua=function(){this.g=!1};function pM(p,b,R,F,$,G){p.info(function(){if(p.g)if(G){var oe="",Ne=G.split("&");for(let tt=0;tt<Ne.length;tt++){var Bt=Ne[tt].split("=");if(Bt.length>1){const Kt=Bt[0];Bt=Bt[1];const ii=Kt.split("_");oe=ii.length>=2&&ii[1]=="type"?oe+(Kt+"="+Bt+"&"):oe+(Kt+"=redacted&")}}}else oe=null;else oe=G;return"XMLHTTP REQ ("+F+") [attempt "+$+"]: "+b+`
`+R+`
`+oe})}function mM(p,b,R,F,$,G,oe){p.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+$+"]: "+b+`
`+R+`
`+G+" "+oe})}function wa(p,b,R,F){p.info(function(){return"XMLHTTP TEXT ("+b+"): "+vM(p,R)+(F?" "+F:"")})}function gM(p,b){p.info(function(){return"TIMEOUT: "+b})}nl.prototype.info=function(){};function vM(p,b){if(!p.g)return b;if(!b)return null;try{const G=JSON.parse(b);if(G){for(p=0;p<G.length;p++)if(Array.isArray(G[p])){var R=G[p];if(!(R.length<2)){var F=R[1];if(Array.isArray(F)&&!(F.length<1)){var $=F[0];if($!="noop"&&$!="stop"&&$!="close")for(let oe=1;oe<F.length;oe++)F[oe]=""}}}}return $n(G)}catch{return b}}var kh={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},$w={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Hw;function Rm(){}h(Rm,Ih),Rm.prototype.g=function(){return new XMLHttpRequest},Hw=new Rm;function rl(p){return encodeURIComponent(String(p))}function yM(p){var b=1;p=p.split(":");const R=[];for(;b>0&&p.length;)R.push(p.shift()),b--;return p.length&&R.push(p.join(":")),R}function co(p,b,R,F){this.j=p,this.i=b,this.l=R,this.S=F||1,this.V=new Mn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Gw}function Gw(){this.i=null,this.g="",this.h=!1}var qw={},Am={};function km(p,b,R){p.M=1,p.A=Nh(ri(b)),p.u=R,p.R=!0,Kw(p,null)}function Kw(p,b){p.F=Date.now(),Ph(p),p.B=ri(p.A);var R=p.B,F=p.S;Array.isArray(F)||(F=[String(F)]),ax(R.i,"t",F),p.C=0,R=p.j.L,p.h=new Gw,p.g=Sx(p.j,R?b:null,!p.u),p.P>0&&(p.O=new lo(l(p.Y,p,p.g),p.P)),b=p.V,R=p.g,F=p.ba;var $="readystatechange";Array.isArray($)||($&&(_a[0]=$.toString()),$=_a);for(let G=0;G<$.length;G++){const oe=Se(R,$[G],F||b.handleEvent,!1,b.h||b);if(!oe)break;b.g[oe.key]=oe}b=p.J?Q(p.J):{},p.u?(p.v||(p.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,b)):(p.v="GET",p.g.ea(p.B,p.v,null,b)),el(),pM(p.i,p.v,p.B,p.l,p.S,p.u)}co.prototype.ba=function(p){p=p.target;const b=this.O;b&&po(p)==3?b.j():this.Y(p)},co.prototype.Y=function(p){try{if(p==this.g)e:{const Ne=po(this.g),Bt=this.g.ya(),tt=this.g.ca();if(!(Ne<3)&&(Ne!=3||this.g&&(this.h.h||this.g.la()||px(this.g)))){this.K||Ne!=4||Bt==7||(Bt==8||tt<=0?el(3):el(2)),Pm(this);var b=this.g.ca();this.X=b;var R=_M(this);if(this.o=b==200,mM(this.i,this.v,this.B,this.l,this.S,Ne,b),this.o){if(this.U&&!this.L){t:{if(this.g){var F,$=this.g;if((F=$.g?$.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(F)){var G=F;break t}}G=null}if(p=G)wa(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Nm(this,p);else{this.o=!1,this.m=3,Fn(12),ms(this),il(this);break e}}if(this.R){p=!0;let Kt;for(;!this.K&&this.C<R.length;)if(Kt=wM(this,R),Kt==Am){Ne==4&&(this.m=4,Fn(14),p=!1),wa(this.i,this.l,null,"[Incomplete Response]");break}else if(Kt==qw){this.m=4,Fn(15),wa(this.i,this.l,R,"[Invalid Chunk]"),p=!1;break}else wa(this.i,this.l,Kt,null),Nm(this,Kt);if(Xw(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ne!=4||R.length!=0||this.h.h||(this.m=1,Fn(16),p=!1),this.o=this.o&&p,!p)wa(this.i,this.l,R,"[Invalid Chunked Response]"),ms(this),il(this);else if(R.length>0&&!this.W){this.W=!0;var oe=this.j;oe.g==this&&oe.aa&&!oe.P&&(oe.j.info("Great, no buffering proxy detected. Bytes received: "+R.length),jm(oe),oe.P=!0,Fn(11))}}else wa(this.i,this.l,R,null),Nm(this,R);Ne==4&&ms(this),this.o&&!this.K&&(Ne==4?xx(this.j,this):(this.o=!1,Ph(this)))}else MM(this.g),b==400&&R.indexOf("Unknown SID")>0?(this.m=3,Fn(12)):(this.m=0,Fn(13)),ms(this),il(this)}}}catch{}finally{}};function _M(p){if(!Xw(p))return p.g.la();const b=px(p.g);if(b==="")return"";let R="";const F=b.length,$=po(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return ms(p),il(p),"";p.h.i=new s.TextDecoder}for(let G=0;G<F;G++)p.h.h=!0,R+=p.h.i.decode(b[G],{stream:!($&&G==F-1)});return b.length=0,p.h.g+=R,p.C=0,p.h.g}function Xw(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function wM(p,b){var R=p.C,F=b.indexOf(`
`,R);return F==-1?Am:(R=Number(b.substring(R,F)),isNaN(R)?qw:(F+=1,F+R>b.length?Am:(b=b.slice(F,F+R),p.C=F+R,b)))}co.prototype.cancel=function(){this.K=!0,ms(this)};function Ph(p){p.T=Date.now()+p.H,Yw(p,p.H)}function Yw(p,b){if(p.D!=null)throw Error("WatchDog timer not null");p.D=tl(l(p.aa,p),b)}function Pm(p){p.D&&(s.clearTimeout(p.D),p.D=null)}co.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(gM(this.i,this.B),this.M!=2&&(el(),Fn(17)),ms(this),this.m=2,il(this)):Yw(this,this.T-p)};function il(p){p.j.I==0||p.K||xx(p.j,p)}function ms(p){Pm(p);var b=p.O;b&&typeof b.dispose=="function"&&b.dispose(),p.O=null,Ai(p.V),p.g&&(b=p.g,p.g=null,b.abort(),b.dispose())}function Nm(p,b){try{var R=p.j;if(R.I!=0&&(R.g==p||Dm(R.h,p))){if(!p.L&&Dm(R.h,p)&&R.I==3){try{var F=R.Ba.g.parse(b)}catch{F=null}if(Array.isArray(F)&&F.length==3){var $=F;if($[0]==0){e:if(!R.v){if(R.g)if(R.g.F+3e3<p.F)Lh(R),Fh(R);else break e;Bm(R),Fn(18)}}else R.xa=$[1],0<R.xa-R.K&&$[2]<37500&&R.F&&R.A==0&&!R.C&&(R.C=tl(l(R.Va,R),6e3));Zw(R.h)<=1&&R.ta&&(R.ta=void 0)}else vs(R,11)}else if((p.L||R.g==p)&&Lh(R),!k(b))for($=R.Ba.g.parse(b),b=0;b<$.length;b++){let tt=$[b];const Kt=tt[0];if(!(Kt<=R.K))if(R.K=Kt,tt=tt[1],R.I==2)if(tt[0]=="c"){R.M=tt[1],R.ba=tt[2];const ii=tt[3];ii!=null&&(R.ka=ii,R.j.info("VER="+R.ka));const ys=tt[4];ys!=null&&(R.za=ys,R.j.info("SVER="+R.za));const mo=tt[5];mo!=null&&typeof mo=="number"&&mo>0&&(F=1.5*mo,R.O=F,R.j.info("backChannelRequestTimeoutMs_="+F)),F=R;const go=p.g;if(go){const Bh=go.g?go.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bh){var G=F.h;G.g||Bh.indexOf("spdy")==-1&&Bh.indexOf("quic")==-1&&Bh.indexOf("h2")==-1||(G.j=G.l,G.g=new Set,G.h&&(Mm(G,G.h),G.h=null))}if(F.G){const Um=go.g?go.g.getResponseHeader("X-HTTP-Session-Id"):null;Um&&(F.wa=Um,ut(F.J,F.G,Um))}}R.I=3,R.l&&R.l.ra(),R.aa&&(R.T=Date.now()-p.F,R.j.info("Handshake RTT: "+R.T+"ms")),F=R;var oe=p;if(F.na=Cx(F,F.L?F.ba:null,F.W),oe.L){ex(F.h,oe);var Ne=oe,Bt=F.O;Bt&&(Ne.H=Bt),Ne.D&&(Pm(Ne),Ph(Ne)),F.g=oe}else _x(F);R.i.length>0&&Oh(R)}else tt[0]!="stop"&&tt[0]!="close"||vs(R,7);else R.I==3&&(tt[0]=="stop"||tt[0]=="close"?tt[0]=="stop"?vs(R,7):Vm(R):tt[0]!="noop"&&R.l&&R.l.qa(tt),R.A=0)}}el(4)}catch{}}var xM=class{constructor(p,b){this.g=p,this.map=b}};function Qw(p){this.l=p||10,s.PerformanceNavigationTiming?(p=s.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Jw(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function Zw(p){return p.h?1:p.g?p.g.size:0}function Dm(p,b){return p.h?p.h==b:p.g?p.g.has(b):!1}function Mm(p,b){p.g?p.g.add(b):p.h=b}function ex(p,b){p.h&&p.h==b?p.h=null:p.g&&p.g.has(b)&&p.g.delete(b)}Qw.prototype.cancel=function(){if(this.i=tx(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function tx(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let b=p.i;for(const R of p.g.values())b=b.concat(R.G);return b}return d(p.i)}var nx=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bM(p,b){if(p){p=p.split("&");for(let R=0;R<p.length;R++){const F=p[R].indexOf("=");let $,G=null;F>=0?($=p[R].substring(0,F),G=p[R].substring(F+1)):$=p[R],b($,G?decodeURIComponent(G.replace(/\+/g," ")):"")}}}function ho(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let b;p instanceof ho?(this.l=p.l,ol(this,p.j),this.o=p.o,this.g=p.g,sl(this,p.u),this.h=p.h,Fm(this,ux(p.i)),this.m=p.m):p&&(b=String(p).match(nx))?(this.l=!1,ol(this,b[1]||"",!0),this.o=al(b[2]||""),this.g=al(b[3]||"",!0),sl(this,b[4]),this.h=al(b[5]||"",!0),Fm(this,b[6]||"",!0),this.m=al(b[7]||"")):(this.l=!1,this.i=new ll(null,this.l))}ho.prototype.toString=function(){const p=[];var b=this.j;b&&p.push(ul(b,rx,!0),":");var R=this.g;return(R||b=="file")&&(p.push("//"),(b=this.o)&&p.push(ul(b,rx,!0),"@"),p.push(rl(R).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R=this.u,R!=null&&p.push(":",String(R))),(R=this.h)&&(this.g&&R.charAt(0)!="/"&&p.push("/"),p.push(ul(R,R.charAt(0)=="/"?SM:CM,!0))),(R=this.i.toString())&&p.push("?",R),(R=this.m)&&p.push("#",ul(R,IM)),p.join("")},ho.prototype.resolve=function(p){const b=ri(this);let R=!!p.j;R?ol(b,p.j):R=!!p.o,R?b.o=p.o:R=!!p.g,R?b.g=p.g:R=p.u!=null;var F=p.h;if(R)sl(b,p.u);else if(R=!!p.h){if(F.charAt(0)!="/")if(this.g&&!this.h)F="/"+F;else{var $=b.h.lastIndexOf("/");$!=-1&&(F=b.h.slice(0,$+1)+F)}if($=F,$==".."||$==".")F="";else if($.indexOf("./")!=-1||$.indexOf("/.")!=-1){F=$.lastIndexOf("/",0)==0,$=$.split("/");const G=[];for(let oe=0;oe<$.length;){const Ne=$[oe++];Ne=="."?F&&oe==$.length&&G.push(""):Ne==".."?((G.length>1||G.length==1&&G[0]!="")&&G.pop(),F&&oe==$.length&&G.push("")):(G.push(Ne),F=!0)}F=G.join("/")}else F=$}return R?b.h=F:R=p.i.toString()!=="",R?Fm(b,ux(p.i)):R=!!p.m,R&&(b.m=p.m),b};function ri(p){return new ho(p)}function ol(p,b,R){p.j=R?al(b,!0):b,p.j&&(p.j=p.j.replace(/:$/,""))}function sl(p,b){if(b){if(b=Number(b),isNaN(b)||b<0)throw Error("Bad port number "+b);p.u=b}else p.u=null}function Fm(p,b,R){b instanceof ll?(p.i=b,RM(p.i,p.l)):(R||(b=ul(b,TM)),p.i=new ll(b,p.l))}function ut(p,b,R){p.i.set(b,R)}function Nh(p){return ut(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function al(p,b){return p?b?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function ul(p,b,R){return typeof p=="string"?(p=encodeURI(p).replace(b,EM),R&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function EM(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var rx=/[#\/\?@]/g,CM=/[#\?:]/g,SM=/[#\?]/g,TM=/[#\?@]/g,IM=/#/g;function ll(p,b){this.h=this.g=null,this.i=p||null,this.j=!!b}function gs(p){p.g||(p.g=new Map,p.h=0,p.i&&bM(p.i,function(b,R){p.add(decodeURIComponent(b.replace(/\+/g," ")),R)}))}t=ll.prototype,t.add=function(p,b){gs(this),this.i=null,p=xa(this,p);let R=this.g.get(p);return R||this.g.set(p,R=[]),R.push(b),this.h+=1,this};function ix(p,b){gs(p),b=xa(p,b),p.g.has(b)&&(p.i=null,p.h-=p.g.get(b).length,p.g.delete(b))}function ox(p,b){return gs(p),b=xa(p,b),p.g.has(b)}t.forEach=function(p,b){gs(this),this.g.forEach(function(R,F){R.forEach(function($){p.call(b,$,F,this)},this)},this)};function sx(p,b){gs(p);let R=[];if(typeof b=="string")ox(p,b)&&(R=R.concat(p.g.get(xa(p,b))));else for(p=Array.from(p.g.values()),b=0;b<p.length;b++)R=R.concat(p[b]);return R}t.set=function(p,b){return gs(this),this.i=null,p=xa(this,p),ox(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[b]),this.h+=1,this},t.get=function(p,b){return p?(p=sx(this,p),p.length>0?String(p[0]):b):b};function ax(p,b,R){ix(p,b),R.length>0&&(p.i=null,p.g.set(xa(p,b),d(R)),p.h+=R.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],b=Array.from(this.g.keys());for(let F=0;F<b.length;F++){var R=b[F];const $=rl(R);R=sx(this,R);for(let G=0;G<R.length;G++){let oe=$;R[G]!==""&&(oe+="="+rl(R[G])),p.push(oe)}}return this.i=p.join("&")};function ux(p){const b=new ll;return b.i=p.i,p.g&&(b.g=new Map(p.g),b.h=p.h),b}function xa(p,b){return b=String(b),p.j&&(b=b.toLowerCase()),b}function RM(p,b){b&&!p.j&&(gs(p),p.i=null,p.g.forEach(function(R,F){const $=F.toLowerCase();F!=$&&(ix(this,F),ax(this,$,R))},p)),p.j=b}function AM(p,b){const R=new nl;if(s.Image){const F=new Image;F.onload=c(fo,R,"TestLoadImage: loaded",!0,b,F),F.onerror=c(fo,R,"TestLoadImage: error",!1,b,F),F.onabort=c(fo,R,"TestLoadImage: abort",!1,b,F),F.ontimeout=c(fo,R,"TestLoadImage: timeout",!1,b,F),s.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=p}else b(!1)}function kM(p,b){const R=new nl,F=new AbortController,$=setTimeout(()=>{F.abort(),fo(R,"TestPingServer: timeout",!1,b)},1e4);fetch(p,{signal:F.signal}).then(G=>{clearTimeout($),G.ok?fo(R,"TestPingServer: ok",!0,b):fo(R,"TestPingServer: server error",!1,b)}).catch(()=>{clearTimeout($),fo(R,"TestPingServer: error",!1,b)})}function fo(p,b,R,F,$){try{$&&($.onload=null,$.onerror=null,$.onabort=null,$.ontimeout=null),F(R)}catch{}}function PM(){this.g=new Im}function Om(p){this.i=p.Sb||null,this.h=p.ab||!1}h(Om,Ih),Om.prototype.g=function(){return new Dh(this.i,this.h)};function Dh(p,b){Ke.call(this),this.H=p,this.o=b,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Dh,Ke),t=Dh.prototype,t.open=function(p,b){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=b,this.readyState=1,hl(this)},t.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const b={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(b.body=p),(this.H||s).fetch(new Request(this.D,b)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,cl(this)),this.readyState=0},t.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,hl(this)),this.g&&(this.readyState=3,hl(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;lx(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function lx(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}t.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var b=p.value?p.value:new Uint8Array(0);(b=this.B.decode(b,{stream:!p.done}))&&(this.response=this.responseText+=b)}p.done?cl(this):hl(this),this.readyState==3&&lx(this)}},t.Oa=function(p){this.g&&(this.response=this.responseText=p,cl(this))},t.Na=function(p){this.g&&(this.response=p,cl(this))},t.ga=function(){this.g&&cl(this)};function cl(p){p.readyState=4,p.l=null,p.j=null,p.B=null,hl(p)}t.setRequestHeader=function(p,b){this.A.append(p,b)},t.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],b=this.h.entries();for(var R=b.next();!R.done;)R=R.value,p.push(R[0]+": "+R[1]),R=b.next();return p.join(`\r
`)};function hl(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Dh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function cx(p){let b="";return z(p,function(R,F){b+=F,b+=":",b+=R,b+=`\r
`}),b}function Lm(p,b,R){e:{for(F in R){var F=!1;break e}F=!0}F||(R=cx(R),typeof p=="string"?R!=null&&rl(R):ut(p,b,R))}function It(p){Ke.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(It,Ke);var NM=/^https?$/i,DM=["POST","PUT"];t=It.prototype,t.Fa=function(p){this.H=p},t.ea=function(p,b,R,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);b=b?b.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Hw.g(),this.g.onreadystatechange=f(l(this.Ca,this));try{this.B=!0,this.g.open(b,String(p),!0),this.B=!1}catch(G){hx(this,G);return}if(p=R||"",R=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var $ in F)R.set($,F[$]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const G of F.keys())R.set(G,F.get(G));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from(R.keys()).find(G=>G.toLowerCase()=="content-type"),$=s.FormData&&p instanceof s.FormData,!(Array.prototype.indexOf.call(DM,b,void 0)>=0)||F||$||R.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,oe]of R)this.g.setRequestHeader(G,oe);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(G){hx(this,G)}};function hx(p,b){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=b,p.o=5,fx(p),Mh(p)}function fx(p){p.A||(p.A=!0,Tt(p,"complete"),Tt(p,"error"))}t.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,Tt(this,"complete"),Tt(this,"abort"),Mh(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mh(this,!0)),It.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?dx(this):this.Xa())},t.Xa=function(){dx(this)};function dx(p){if(p.h&&typeof o<"u"){if(p.v&&po(p)==4)setTimeout(p.Ca.bind(p),0);else if(Tt(p,"readystatechange"),po(p)==4){p.h=!1;try{const G=p.ca();e:switch(G){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var R;if(!(R=b)){var F;if(F=G===0){let oe=String(p.D).match(nx)[1]||null;!oe&&s.self&&s.self.location&&(oe=s.self.location.protocol.slice(0,-1)),F=!NM.test(oe?oe.toLowerCase():"")}R=F}if(R)Tt(p,"complete"),Tt(p,"success");else{p.o=6;try{var $=po(p)>2?p.g.statusText:""}catch{$=""}p.l=$+" ["+p.ca()+"]",fx(p)}}finally{Mh(p)}}}}function Mh(p,b){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const R=p.g;p.g=null,b||Tt(p,"ready");try{R.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function po(p){return p.g?p.g.readyState:0}t.ca=function(){try{return po(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(p){if(this.g){var b=this.g.responseText;return p&&b.indexOf(p)==0&&(b=b.substring(p.length)),Zu(b)}};function px(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function MM(p){const b={};p=(p.g&&po(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<p.length;F++){if(k(p[F]))continue;var R=yM(p[F]);const $=R[0];if(R=R[1],typeof R!="string")continue;R=R.trim();const G=b[$]||[];b[$]=G,G.push(R)}U(b,function(F){return F.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function fl(p,b,R){return R&&R.internalChannelParams&&R.internalChannelParams[p]||b}function mx(p){this.za=0,this.i=[],this.j=new nl,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=fl("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=fl("baseRetryDelayMs",5e3,p),this.Za=fl("retryDelaySeedMs",1e4,p),this.Ta=fl("forwardChannelMaxRetries",2,p),this.va=fl("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new Qw(p&&p.concurrentRequestLimit),this.Ba=new PM,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=mx.prototype,t.ka=8,t.I=1,t.connect=function(p,b,R,F){Fn(0),this.W=p,this.H=b||{},R&&F!==void 0&&(this.H.OSID=R,this.H.OAID=F),this.F=this.X,this.J=Cx(this,null,this.W),Oh(this)};function Vm(p){if(gx(p),p.I==3){var b=p.V++,R=ri(p.J);if(ut(R,"SID",p.M),ut(R,"RID",b),ut(R,"TYPE","terminate"),dl(p,R),b=new co(p,p.j,b),b.M=2,b.A=Nh(ri(R)),R=!1,s.navigator&&s.navigator.sendBeacon)try{R=s.navigator.sendBeacon(b.A.toString(),"")}catch{}!R&&s.Image&&(new Image().src=b.A,R=!0),R||(b.g=Sx(b.j,null),b.g.ea(b.A)),b.F=Date.now(),Ph(b)}Ex(p)}function Fh(p){p.g&&(jm(p),p.g.cancel(),p.g=null)}function gx(p){Fh(p),p.v&&(s.clearTimeout(p.v),p.v=null),Lh(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&s.clearTimeout(p.m),p.m=null)}function Oh(p){if(!Jw(p.h)&&!p.m){p.m=!0;var b=p.Ea;S||E(),A||(S(),A=!0),T.add(b,p),p.D=0}}function FM(p,b){return Zw(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=b.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=tl(l(p.Ea,p,b),bx(p,p.D)),p.D++,!0)}t.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const $=new co(this,this.j,p);let G=this.o;if(this.U&&(G?(G=Q(G),ie(G,this.U)):G=this.U),this.u!==null||this.R||($.J=G,G=null),this.S)e:{for(var b=0,R=0;R<this.i.length;R++){t:{var F=this.i[R];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(b+=F,b>4096){b=R;break e}if(b===4096||R===this.i.length-1){b=R+1;break e}}b=1e3}else b=1e3;b=yx(this,$,b),R=ri(this.J),ut(R,"RID",p),ut(R,"CVER",22),this.G&&ut(R,"X-HTTP-Session-Id",this.G),dl(this,R),G&&(this.R?b="headers="+rl(cx(G))+"&"+b:this.u&&Lm(R,this.u,G)),Mm(this.h,$),this.Ra&&ut(R,"TYPE","init"),this.S?(ut(R,"$req",b),ut(R,"SID","null"),$.U=!0,km($,R,null)):km($,R,b),this.I=2}}else this.I==3&&(p?vx(this,p):this.i.length==0||Jw(this.h)||vx(this))};function vx(p,b){var R;b?R=b.l:R=p.V++;const F=ri(p.J);ut(F,"SID",p.M),ut(F,"RID",R),ut(F,"AID",p.K),dl(p,F),p.u&&p.o&&Lm(F,p.u,p.o),R=new co(p,p.j,R,p.D+1),p.u===null&&(R.J=p.o),b&&(p.i=b.G.concat(p.i)),b=yx(p,R,1e3),R.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),Mm(p.h,R),km(R,F,b)}function dl(p,b){p.H&&z(p.H,function(R,F){ut(b,F,R)}),p.l&&z({},function(R,F){ut(b,F,R)})}function yx(p,b,R){R=Math.min(p.i.length,R);const F=p.l?l(p.l.Ka,p.l,p):null;e:{var $=p.i;let Ne=-1;for(;;){const Bt=["count="+R];Ne==-1?R>0?(Ne=$[0].g,Bt.push("ofs="+Ne)):Ne=0:Bt.push("ofs="+Ne);let tt=!0;for(let Kt=0;Kt<R;Kt++){var G=$[Kt].g;const ii=$[Kt].map;if(G-=Ne,G<0)Ne=Math.max(0,$[Kt].g-100),tt=!1;else try{G="req"+G+"_"||"";try{var oe=ii instanceof Map?ii:Object.entries(ii);for(const[ys,mo]of oe){let go=mo;a(mo)&&(go=$n(mo)),Bt.push(G+ys+"="+encodeURIComponent(go))}}catch(ys){throw Bt.push(G+"type="+encodeURIComponent("_badmap")),ys}}catch{F&&F(ii)}}if(tt){oe=Bt.join("&");break e}}oe=void 0}return p=p.i.splice(0,R),b.G=p,oe}function _x(p){if(!p.g&&!p.v){p.Y=1;var b=p.Da;S||E(),A||(S(),A=!0),T.add(b,p),p.A=0}}function Bm(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=tl(l(p.Da,p),bx(p,p.A)),p.A++,!0)}t.Da=function(){if(this.v=null,wx(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=tl(l(this.Wa,this),p)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Fn(10),Fh(this),wx(this))};function jm(p){p.B!=null&&(s.clearTimeout(p.B),p.B=null)}function wx(p){p.g=new co(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var b=ri(p.na);ut(b,"RID","rpc"),ut(b,"SID",p.M),ut(b,"AID",p.K),ut(b,"CI",p.F?"0":"1"),!p.F&&p.ia&&ut(b,"TO",p.ia),ut(b,"TYPE","xmlhttp"),dl(p,b),p.u&&p.o&&Lm(b,p.u,p.o),p.O&&(p.g.H=p.O);var R=p.g;p=p.ba,R.M=1,R.A=Nh(ri(b)),R.u=null,R.R=!0,Kw(R,p)}t.Va=function(){this.C!=null&&(this.C=null,Fh(this),Bm(this),Fn(19))};function Lh(p){p.C!=null&&(s.clearTimeout(p.C),p.C=null)}function xx(p,b){var R=null;if(p.g==b){Lh(p),jm(p),p.g=null;var F=2}else if(Dm(p.h,b))R=b.G,ex(p.h,b),F=1;else return;if(p.I!=0){if(b.o)if(F==1){R=b.u?b.u.length:0,b=Date.now()-b.F;var $=p.D;F=Ah(),Tt(F,new zw(F,R)),Oh(p)}else _x(p);else if($=b.m,$==3||$==0&&b.X>0||!(F==1&&FM(p,b)||F==2&&Bm(p)))switch(R&&R.length>0&&(b=p.h,b.i=b.i.concat(R)),$){case 1:vs(p,5);break;case 4:vs(p,10);break;case 3:vs(p,6);break;default:vs(p,2)}}}function bx(p,b){let R=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(R*=2),R*b}function vs(p,b){if(p.j.info("Error code "+b),b==2){var R=l(p.bb,p),F=p.Ua;const $=!F;F=new ho(F||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||ol(F,"https"),Nh(F),$?AM(F.toString(),R):kM(F.toString(),R)}else Fn(2);p.I=0,p.l&&p.l.pa(b),Ex(p),gx(p)}t.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Fn(2)):(this.j.info("Failed to ping google.com"),Fn(1))};function Ex(p){if(p.I=0,p.ja=[],p.l){const b=tx(p.h);(b.length!=0||p.i.length!=0)&&(m(p.ja,b),m(p.ja,p.i),p.h.i.length=0,d(p.i),p.i.length=0),p.l.oa()}}function Cx(p,b,R){var F=R instanceof ho?ri(R):new ho(R);if(F.g!="")b&&(F.g=b+"."+F.g),sl(F,F.u);else{var $=s.location;F=$.protocol,b=b?b+"."+$.hostname:$.hostname,$=+$.port;const G=new ho(null);F&&ol(G,F),b&&(G.g=b),$&&sl(G,$),R&&(G.h=R),F=G}return R=p.G,b=p.wa,R&&b&&ut(F,R,b),ut(F,"VER",p.ka),dl(p,F),F}function Sx(p,b,R){if(b&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return b=p.Aa&&!p.ma?new It(new Om({ab:R})):new It(p.ma),b.Fa(p.L),b}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tx(){}t=Tx.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Vh(){}Vh.prototype.g=function(p,b){return new sr(p,b)};function sr(p,b){Ke.call(this),this.g=new mx(b),this.l=p,this.h=b&&b.messageUrlParams||null,p=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(p?p["X-WebChannel-Content-Type"]=b.messageContentType:p={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.sa&&(p?p["X-WebChannel-Client-Profile"]=b.sa:p={"X-WebChannel-Client-Profile":b.sa}),this.g.U=p,(p=b&&b.Qb)&&!k(p)&&(this.g.u=p),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!k(b)&&(this.g.G=b,p=this.h,p!==null&&b in p&&(p=this.h,b in p&&delete p[b])),this.j=new ba(this)}h(sr,Ke),sr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},sr.prototype.close=function(){Vm(this.g)},sr.prototype.o=function(p){var b=this.g;if(typeof p=="string"){var R={};R.__data__=p,p=R}else this.v&&(R={},R.__data__=$n(p),p=R);b.i.push(new xM(b.Ya++,p)),b.I==3&&Oh(b)},sr.prototype.N=function(){this.g.l=null,delete this.j,Vm(this.g),delete this.g,sr.Z.N.call(this)};function Ix(p){fs.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var b=p.__sm__;if(b){e:{for(const R in b){p=R;break e}p=void 0}(this.i=p)&&(p=this.i,b=b!==null&&p in b?b[p]:void 0),this.data=b}else this.data=p}h(Ix,fs);function Rx(){ds.call(this),this.status=1}h(Rx,ds);function ba(p){this.g=p}h(ba,Tx),ba.prototype.ra=function(){Tt(this.g,"a")},ba.prototype.qa=function(p){Tt(this.g,new Ix(p))},ba.prototype.pa=function(p){Tt(this.g,new Rx)},ba.prototype.oa=function(){Tt(this.g,"b")},Vh.prototype.createWebChannel=Vh.prototype.g,sr.prototype.send=sr.prototype.o,sr.prototype.open=sr.prototype.m,sr.prototype.close=sr.prototype.close,qP=function(){return new Vh},GP=function(){return Ah()},HP=ps,Qy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},kh.NO_ERROR=0,kh.TIMEOUT=8,kh.HTTP_ERROR=6,Hf=kh,$w.COMPLETE="complete",$P=$w,Rh.EventType=ki,ki.OPEN="a",ki.CLOSE="b",ki.ERROR="c",ki.MESSAGE="d",Ke.prototype.listen=Ke.prototype.J,Bl=Rh,It.prototype.listenOnce=It.prototype.K,It.prototype.getLastError=It.prototype.Ha,It.prototype.getLastErrorCode=It.prototype.ya,It.prototype.getStatus=It.prototype.ca,It.prototype.getResponseJson=It.prototype.La,It.prototype.getResponseText=It.prototype.la,It.prototype.send=It.prototype.ea,It.prototype.setWithCredentials=It.prototype.Fa,zP=It}).apply(typeof bf<"u"?bf:typeof self<"u"?self:typeof window<"u"?window:{});const t2="@firebase/firestore",n2="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xn.UNAUTHENTICATED=new xn(null),xn.GOOGLE_CREDENTIALS=new xn("google-credentials-uid"),xn.FIRST_PARTY=new xn("first-party-uid"),xn.MOCK_USER=new xn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ku="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zs=new H_("@firebase/firestore");function Ma(){return Zs.logLevel}function me(t,...e){if(Zs.logLevel<=Be.DEBUG){const n=e.map(K_);Zs.debug(`Firestore (${Ku}): ${t}`,...n)}}function ea(t,...e){if(Zs.logLevel<=Be.ERROR){const n=e.map(K_);Zs.error(`Firestore (${Ku}): ${t}`,...n)}}function lm(t,...e){if(Zs.logLevel<=Be.WARN){const n=e.map(K_);Zs.warn(`Firestore (${Ku}): ${t}`,...n)}}function K_(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function De(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,KP(t,r,n)}function KP(t,e,n){let r=`FIRESTORE (${Ku}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw ea(r),new Error(r)}function kt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||KP(e,i,r)}function ot(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ce extends qu{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class FH{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(xn.UNAUTHENTICATED))}shutdown(){}}class OH{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class LH{constructor(e){this.t=e,this.currentUser=xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){kt(this.o===void 0,42304);let r=this.i;const i=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let o=new zs;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new zs,e.enqueueRetryable(()=>i(this.currentUser))};const s=()=>{const u=o;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},a=u=>{me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?a(u):(me("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new zs)}},0),s()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(kt(typeof r.accessToken=="string",31837,{l:r}),new XP(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return kt(e===null||typeof e=="string",2055,{h:e}),new xn(e)}}class VH{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=xn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class BH{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new VH(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(xn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class r2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jH{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,LP(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){kt(this.o===void 0,3512);const r=o=>{o.error!=null&&me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const s=o.token!==this.m;return this.m=o.token,me("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new r2(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(kt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new r2(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UH(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=UH(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function Xe(t,e){return t<e?-1:t>e?1:0}function Jy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return iv(i)===iv(o)?Xe(i,o):iv(i)?1:-1}return Xe(t.length,e.length)}const WH=55296,zH=57343;function iv(t){const e=t.charCodeAt(0);return e>=WH&&e<=zH}function Mu(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i2="__name__";class li{constructor(e,n,r){n===void 0?n=0:n>e.length&&De(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&De(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return li.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof li?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=li.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return Xe(e.length,n.length)}static compareSegments(e,n){const r=li.isNumericId(e),i=li.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?li.extractNumericId(e).compare(li.extractNumericId(n)):Jy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return q_.fromString(e.substring(4,e.length-2))}}class wt extends li{construct(e,n,r){return new wt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ce(ne.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new wt(n)}static emptyPath(){return new wt([])}}const $H=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fn extends li{construct(e,n,r){return new fn(e,n,r)}static isValidIdentifier(e){return $H.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===i2}static keyField(){return new fn([i2])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Ce(ne.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let s=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new Ce(ne.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Ce(ne.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(s=!s,i++):a!=="."||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Ce(ne.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fn(n)}static emptyPath(){return new fn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.path=e}static fromPath(e){return new Pe(wt.fromString(e))}static fromName(e){return new Pe(wt.fromString(e).popFirst(5))}static empty(){return new Pe(wt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&wt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return wt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pe(new wt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YP(t,e,n){if(!n)throw new Ce(ne.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function HH(t,e,n,r){if(e===!0&&r===!0)throw new Ce(ne.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function o2(t){if(!Pe.isDocumentKey(t))throw new Ce(ne.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function s2(t){if(Pe.isDocumentKey(t))throw new Ce(ne.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function QP(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Y_(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":De(12329,{type:typeof t})}function JP(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ce(ne.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Y_(t);throw new Ce(ne.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vt(t,e){const n={typeString:t};return e&&(n.value=e),n}function gh(t,e){if(!QP(t))throw new Ce(ne.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const s=t[r];if(i&&typeof s!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&s!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Ce(ne.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a2=-62135596800,u2=1e6;class vt{static now(){return vt.fromMillis(Date.now())}static fromDate(e){return vt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*u2);return new vt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Ce(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Ce(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<a2)throw new Ce(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ce(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/u2}_compareTo(e){return this.seconds===e.seconds?Xe(this.nanoseconds,e.nanoseconds):Xe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:vt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(gh(e,vt._jsonSchema))return new vt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-a2;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}vt._jsonSchemaVersion="firestore/timestamp/1.0",vt._jsonSchema={type:Vt("string",vt._jsonSchemaVersion),seconds:Vt("number"),nanoseconds:Vt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{static fromTimestamp(e){return new mt(e)}static min(){return new mt(new vt(0,0))}static max(){return new mt(new vt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc=-1;function GH(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=mt.fromTimestamp(r===1e9?new vt(n+1,0):new vt(n,r));return new es(i,Pe.empty(),e)}function qH(t){return new es(t.readTime,t.key,zc)}class es{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new es(mt.min(),Pe.empty(),zc)}static max(){return new es(mt.max(),Pe.empty(),zc)}}function KH(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Pe.comparator(t.documentKey,e.documentKey),n!==0?n:Xe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XH="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class YH{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q_(t){if(t.code!==ne.FAILED_PRECONDITION||t.message!==XH)throw t;me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&De(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ee((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ee?n:ee.resolve(n)}catch(n){return ee.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ee.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ee.reject(n)}static resolve(e){return new ee((n,r)=>{n(e)})}static reject(e){return new ee((n,r)=>{r(e)})}static waitFor(e){return new ee((n,r)=>{let i=0,o=0,s=!1;e.forEach(a=>{++i,a.next(()=>{++o,s&&o===i&&n()},u=>r(u))}),s=!0,o===i&&n()})}static or(e){let n=ee.resolve(!1);for(const r of e)n=n.next(i=>i?ee.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,o)=>{r.push(n.call(this,i,o))}),this.waitFor(r)}static mapArray(e,n){return new ee((r,i)=>{const o=e.length,s=new Array(o);let a=0;for(let u=0;u<o;u++){const l=u;n(e[l]).next(c=>{s[l]=c,++a,a===o&&r(s)},c=>i(c))}})}static doWhile(e,n){return new ee((r,i)=>{const o=()=>{e()===!0?n().next(()=>{o()},i):r()};o()})}}function QH(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function vh(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}J_.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z_=-1;function ew(t){return t==null}function np(t){return t===0&&1/t==-1/0}function JH(t){return typeof t=="number"&&Number.isInteger(t)&&!np(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZP="";function ZH(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=l2(e)),e=eG(t.get(n),e);return l2(e)}function eG(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case ZP:n+="";break;default:n+=o}}return n}function l2(t){return t+ZP+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c2(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xu(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function eN(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zr=class Zy{constructor(e,n){this.comparator=e,this.root=n||Ho.EMPTY}insert(e,n){return new Zy(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ho.BLACK,null,null))}remove(e){return new Zy(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ho.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ef(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ef(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ef(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ef(this.root,e,this.comparator,!0)}},Ef=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ho=class Di{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Di.RED,this.left=i??Di.EMPTY,this.right=o??Di.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Di(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Di.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Di.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Di.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Di.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw De(43730,{key:this.key,value:this.value});if(this.right.isRed())throw De(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw De(27949);return e+(this.isRed()?0:1)}};Ho.EMPTY=null,Ho.RED=!0,Ho.BLACK=!1;Ho.EMPTY=new class{constructor(){this.size=0}get key(){throw De(57766)}get value(){throw De(16141)}get color(){throw De(16727)}get left(){throw De(29726)}get right(){throw De(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Ho(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.comparator=e,this.data=new Zr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new h2(this.data.getIterator())}getIteratorFrom(e){return new h2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof pn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new pn(this.comparator);return n.data=e,n}}class h2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e){this.fields=e,e.sort(fn.comparator)}static empty(){return new Gr([])}unionWith(e){let n=new pn(fn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Gr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Mu(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new tG("Invalid base64 string: "+o):o}}(e);return new Ei(n)}static fromUint8Array(e){const n=function(i){let o="";for(let s=0;s<i.length;++s)o+=String.fromCharCode(i[s]);return o}(e);return new Ei(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ei.EMPTY_BYTE_STRING=new Ei("");const nG=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ta(t){if(kt(!!t,39018),typeof t=="string"){let e=0;const n=nG.exec(t);if(kt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ln(t.seconds),nanos:ln(t.nanos)}}function ln(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Fu(t){return typeof t=="string"?Ei.fromBase64String(t):Ei.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tN="server_timestamp",nN="__type__",rN="__previous_value__",iN="__local_write_time__";function tw(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[nN])==null?void 0:r.stringValue)===tN}function nw(t){const e=t.mapValue.fields[rN];return tw(e)?nw(e):e}function rp(t){const e=ta(t.mapValue.fields[iN].timestampValue);return new vt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rG{constructor(e,n,r,i,o,s,a,u,l,c){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=l,this.isUsingEmulator=c}}const ip="(default)";class op{constructor(e,n){this.projectId=e,this.database=n||ip}static empty(){return new op("","")}get isDefaultDatabase(){return this.database===ip}isEqual(e){return e instanceof op&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN="__type__",iG="__max__",Cf={mapValue:{}},sN="__vector__",e0="value";function na(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?tw(t)?4:sG(t)?9007199254740991:oG(t)?10:11:De(28295,{value:t})}function Ci(t,e){if(t===e)return!0;const n=na(t);if(n!==na(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return rp(t).isEqual(rp(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const s=ta(i.timestampValue),a=ta(o.timestampValue);return s.seconds===a.seconds&&s.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,o){return Fu(i.bytesValue).isEqual(Fu(o.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,o){return ln(i.geoPointValue.latitude)===ln(o.geoPointValue.latitude)&&ln(i.geoPointValue.longitude)===ln(o.geoPointValue.longitude)}(t,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return ln(i.integerValue)===ln(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const s=ln(i.doubleValue),a=ln(o.doubleValue);return s===a?np(s)===np(a):isNaN(s)&&isNaN(a)}return!1}(t,e);case 9:return Mu(t.arrayValue.values||[],e.arrayValue.values||[],Ci);case 10:case 11:return function(i,o){const s=i.mapValue.fields||{},a=o.mapValue.fields||{};if(c2(s)!==c2(a))return!1;for(const u in s)if(s.hasOwnProperty(u)&&(a[u]===void 0||!Ci(s[u],a[u])))return!1;return!0}(t,e);default:return De(52216,{left:t})}}function $c(t,e){return(t.values||[]).find(n=>Ci(n,e))!==void 0}function Ou(t,e){if(t===e)return 0;const n=na(t),r=na(e);if(n!==r)return Xe(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Xe(t.booleanValue,e.booleanValue);case 2:return function(o,s){const a=ln(o.integerValue||o.doubleValue),u=ln(s.integerValue||s.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(t,e);case 3:return f2(t.timestampValue,e.timestampValue);case 4:return f2(rp(t),rp(e));case 5:return Jy(t.stringValue,e.stringValue);case 6:return function(o,s){const a=Fu(o),u=Fu(s);return a.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(o,s){const a=o.split("/"),u=s.split("/");for(let l=0;l<a.length&&l<u.length;l++){const c=Xe(a[l],u[l]);if(c!==0)return c}return Xe(a.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(o,s){const a=Xe(ln(o.latitude),ln(s.latitude));return a!==0?a:Xe(ln(o.longitude),ln(s.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return d2(t.arrayValue,e.arrayValue);case 10:return function(o,s){var f,d,m,v;const a=o.fields||{},u=s.fields||{},l=(f=a[e0])==null?void 0:f.arrayValue,c=(d=u[e0])==null?void 0:d.arrayValue,h=Xe(((m=l==null?void 0:l.values)==null?void 0:m.length)||0,((v=c==null?void 0:c.values)==null?void 0:v.length)||0);return h!==0?h:d2(l,c)}(t.mapValue,e.mapValue);case 11:return function(o,s){if(o===Cf.mapValue&&s===Cf.mapValue)return 0;if(o===Cf.mapValue)return 1;if(s===Cf.mapValue)return-1;const a=o.fields||{},u=Object.keys(a),l=s.fields||{},c=Object.keys(l);u.sort(),c.sort();for(let h=0;h<u.length&&h<c.length;++h){const f=Jy(u[h],c[h]);if(f!==0)return f;const d=Ou(a[u[h]],l[c[h]]);if(d!==0)return d}return Xe(u.length,c.length)}(t.mapValue,e.mapValue);default:throw De(23264,{he:n})}}function f2(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Xe(t,e);const n=ta(t),r=ta(e),i=Xe(n.seconds,r.seconds);return i!==0?i:Xe(n.nanos,r.nanos)}function d2(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Ou(n[i],r[i]);if(o)return o}return Xe(n.length,r.length)}function Lu(t){return t0(t)}function t0(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=ta(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Fu(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Pe.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=t0(o);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const s of r)o?o=!1:i+=",",i+=`${s}:${t0(n.fields[s])}`;return i+"}"}(t.mapValue):De(61005,{value:t})}function Gf(t){switch(na(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=nw(t);return e?16+Gf(e):16;case 5:return 2*t.stringValue.length;case 6:return Fu(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+Gf(o),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Xu(r.fields,(o,s)=>{i+=o.length+Gf(s)}),i}(t.mapValue);default:throw De(13486,{value:t})}}function n0(t){return!!t&&"integerValue"in t}function rw(t){return!!t&&"arrayValue"in t}function qf(t){return!!t&&"mapValue"in t}function oG(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[oN])==null?void 0:r.stringValue)===sN}function rc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Xu(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=rc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=rc(t.arrayValue.values[n]);return e}return{...t}}function sG(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===iG}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e){this.value=e}static empty(){return new Wr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!qf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=rc(n)}setAll(e){let n=fn.emptyPath(),r={},i=[];e.forEach((s,a)=>{if(!n.isImmediateParentOf(a)){const u=this.getFieldsMap(n);this.applyChanges(u,r,i),r={},i=[],n=a.popLast()}s?r[a.lastSegment()]=rc(s):i.push(a.lastSegment())});const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());qf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ci(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];qf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Xu(n,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new Wr(rc(this.value))}}function aN(t){const e=[];return Xu(t.fields,(n,r)=>{const i=new fn([n]);if(qf(r)){const o=aN(r.mapValue).fields;if(o.length===0)e.push(i);else for(const s of o)e.push(i.child(s))}else e.push(i)}),new Gr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e,n,r,i,o,s,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=s,this.documentState=a}static newInvalidDocument(e){return new Ur(e,0,mt.min(),mt.min(),mt.min(),Wr.empty(),0)}static newFoundDocument(e,n,r,i){return new Ur(e,1,n,mt.min(),r,i,0)}static newNoDocument(e,n){return new Ur(e,2,n,mt.min(),mt.min(),Wr.empty(),0)}static newUnknownDocument(e,n){return new Ur(e,3,n,mt.min(),mt.min(),Wr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(mt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Wr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Wr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=mt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ur&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ur(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{constructor(e,n){this.position=e,this.inclusive=n}}function p2(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],s=t.position[i];if(o.field.isKeyField()?r=Pe.comparator(Pe.fromName(s.referenceValue),n.key):r=Ou(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function m2(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ci(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(e,n="asc"){this.field=e,this.dir=n}}function aG(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{}class en extends uN{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new lG(e,n,r):n==="array-contains"?new fG(e,r):n==="in"?new dG(e,r):n==="not-in"?new pG(e,r):n==="array-contains-any"?new mG(e,r):new en(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new cG(e,r):new hG(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Ou(n,this.value)):n!==null&&na(this.value)===na(n)&&this.matchesComparison(Ou(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return De(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ts extends uN{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ts(e,n)}matches(e){return lN(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function lN(t){return t.op==="and"}function cN(t){return uG(t)&&lN(t)}function uG(t){for(const e of t.filters)if(e instanceof ts)return!1;return!0}function r0(t){if(t instanceof en)return t.field.canonicalString()+t.op.toString()+Lu(t.value);if(cN(t))return t.filters.map(e=>r0(e)).join(",");{const e=t.filters.map(n=>r0(n)).join(",");return`${t.op}(${e})`}}function hN(t,e){return t instanceof en?function(r,i){return i instanceof en&&r.op===i.op&&r.field.isEqual(i.field)&&Ci(r.value,i.value)}(t,e):t instanceof ts?function(r,i){return i instanceof ts&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,s,a)=>o&&hN(s,i.filters[a]),!0):!1}(t,e):void De(19439)}function fN(t){return t instanceof en?function(n){return`${n.field.canonicalString()} ${n.op} ${Lu(n.value)}`}(t):t instanceof ts?function(n){return n.op.toString()+" {"+n.getFilters().map(fN).join(" ,")+"}"}(t):"Filter"}class lG extends en{constructor(e,n,r){super(e,n,r),this.key=Pe.fromName(r.referenceValue)}matches(e){const n=Pe.comparator(e.key,this.key);return this.matchesComparison(n)}}class cG extends en{constructor(e,n){super(e,"in",n),this.keys=dN("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class hG extends en{constructor(e,n){super(e,"not-in",n),this.keys=dN("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function dN(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>Pe.fromName(r.referenceValue))}class fG extends en{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return rw(n)&&$c(n.arrayValue,this.value)}}class dG extends en{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&$c(this.value.arrayValue,n)}}class pG extends en{constructor(e,n){super(e,"not-in",n)}matches(e){if($c(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!$c(this.value.arrayValue,n)}}class mG extends en{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!rw(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>$c(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gG{constructor(e,n=null,r=[],i=[],o=null,s=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=s,this.endAt=a,this.Te=null}}function g2(t,e=null,n=[],r=[],i=null,o=null,s=null){return new gG(t,e,n,r,i,o,s)}function iw(t){const e=ot(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>r0(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ew(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Lu(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Lu(r)).join(",")),e.Te=n}return e.Te}function ow(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!aG(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!hN(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!m2(t.startAt,e.startAt)&&m2(t.endAt,e.endAt)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,n=null,r=[],i=[],o=null,s="F",a=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=s,this.startAt=a,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function vG(t,e,n,r,i,o,s,a){return new cm(t,e,n,r,i,o,s,a)}function yG(t){return new cm(t)}function v2(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function _G(t){return t.collectionGroup!==null}function ic(t){const e=ot(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let a=new pn(fn.comparator);return s.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new ap(o,r))}),n.has(fn.keyField().canonicalString())||e.Ie.push(new ap(fn.keyField(),r))}return e.Ie}function $s(t){const e=ot(t);return e.Ee||(e.Ee=wG(e,ic(t))),e.Ee}function wG(t,e){if(t.limitType==="F")return g2(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const o=i.dir==="desc"?"asc":"desc";return new ap(i.field,o)});const n=t.endAt?new sp(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new sp(t.startAt.position,t.startAt.inclusive):null;return g2(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function i0(t,e,n){return new cm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function pN(t,e){return ow($s(t),$s(e))&&t.limitType===e.limitType}function mN(t){return`${iw($s(t))}|lt:${t.limitType}`}function Al(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>fN(i)).join(", ")}]`),ew(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>Lu(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>Lu(i)).join(",")),`Target(${r})`}($s(t))}; limitType=${t.limitType})`}function sw(t,e){return e.isFoundDocument()&&function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Pe.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(t,e)&&function(r,i){for(const o of ic(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(s,a,u){const l=p2(s,a,u);return s.inclusive?l<=0:l<0}(r.startAt,ic(r),i)||r.endAt&&!function(s,a,u){const l=p2(s,a,u);return s.inclusive?l>=0:l>0}(r.endAt,ic(r),i))}(t,e)}function xG(t){return(e,n)=>{let r=!1;for(const i of ic(t)){const o=bG(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function bG(t,e,n){const r=t.field.isKeyField()?Pe.comparator(e.key,n.key):function(o,s,a){const u=s.data.field(o),l=a.data.field(o);return u!==null&&l!==null?Ou(u,l):De(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return De(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Xu(this.inner,(n,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return eN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EG=new Zr(Pe.comparator);function up(){return EG}const gN=new Zr(Pe.comparator);function Sf(...t){let e=gN;for(const n of t)e=e.insert(n.key,n);return e}function vN(t){let e=gN;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Ls(){return oc()}function yN(){return oc()}function oc(){return new ma(t=>t.toString(),(t,e)=>t.isEqual(e))}const CG=new Zr(Pe.comparator),SG=new pn(Pe.comparator);function Cn(...t){let e=SG;for(const n of t)e=e.add(n);return e}const TG=new pn(Xe);function IG(){return TG}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aw(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:np(e)?"-0":e}}function _N(t){return{integerValue:""+t}}function RG(t,e){return JH(e)?_N(e):aw(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(){this._=void 0}}function AG(t,e,n){return t instanceof Hc?function(i,o){const s={fields:{[nN]:{stringValue:tN},[iN]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&tw(o)&&(o=nw(o)),o&&(s.fields[rN]=o),{mapValue:s}}(n,e):t instanceof Gc?xN(t,e):t instanceof qc?bN(t,e):function(i,o){const s=wN(i,o),a=y2(s)+y2(i.Ae);return n0(s)&&n0(i.Ae)?_N(a):aw(i.serializer,a)}(t,e)}function kG(t,e,n){return t instanceof Gc?xN(t,e):t instanceof qc?bN(t,e):n}function wN(t,e){return t instanceof lp?function(r){return n0(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class Hc extends hm{}class Gc extends hm{constructor(e){super(),this.elements=e}}function xN(t,e){const n=EN(e);for(const r of t.elements)n.some(i=>Ci(i,r))||n.push(r);return{arrayValue:{values:n}}}class qc extends hm{constructor(e){super(),this.elements=e}}function bN(t,e){let n=EN(e);for(const r of t.elements)n=n.filter(i=>!Ci(i,r));return{arrayValue:{values:n}}}class lp extends hm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function y2(t){return ln(t.integerValue||t.doubleValue)}function EN(t){return rw(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PG{constructor(e,n){this.field=e,this.transform=n}}function NG(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof Gc&&i instanceof Gc||r instanceof qc&&i instanceof qc?Mu(r.elements,i.elements,Ci):r instanceof lp&&i instanceof lp?Ci(r.Ae,i.Ae):r instanceof Hc&&i instanceof Hc}(t.transform,e.transform)}class DG{constructor(e,n){this.version=e,this.transformResults=n}}class $i{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new $i}static exists(e){return new $i(void 0,e)}static updateTime(e){return new $i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Kf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class fm{}function CN(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new TN(t.key,$i.none()):new yh(t.key,t.data,$i.none());{const n=t.data,r=Wr.empty();let i=new pn(fn.comparator);for(let o of e.fields)if(!i.has(o)){let s=n.field(o);s===null&&o.length>1&&(o=o.popLast(),s=n.field(o)),s===null?r.delete(o):r.set(o,s),i=i.add(o)}return new ga(t.key,r,new Gr(i.toArray()),$i.none())}}function MG(t,e,n){t instanceof yh?function(i,o,s){const a=i.value.clone(),u=w2(i.fieldTransforms,o,s.transformResults);a.setAll(u),o.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(t,e,n):t instanceof ga?function(i,o,s){if(!Kf(i.precondition,o))return void o.convertToUnknownDocument(s.version);const a=w2(i.fieldTransforms,o,s.transformResults),u=o.data;u.setAll(SN(i)),u.setAll(a),o.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(t,e,n):function(i,o,s){o.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,n)}function sc(t,e,n,r){return t instanceof yh?function(o,s,a,u){if(!Kf(o.precondition,s))return a;const l=o.value.clone(),c=x2(o.fieldTransforms,u,s);return l.setAll(c),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null}(t,e,n,r):t instanceof ga?function(o,s,a,u){if(!Kf(o.precondition,s))return a;const l=x2(o.fieldTransforms,u,s),c=s.data;return c.setAll(SN(o)),c.setAll(l),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),a===null?null:a.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(o,s,a){return Kf(o.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):a}(t,e,n)}function FG(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=wN(r.transform,i||null);o!=null&&(n===null&&(n=Wr.empty()),n.set(r.field,o))}return n||null}function _2(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Mu(r,i,(o,s)=>NG(o,s))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class yh extends fm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ga extends fm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function SN(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function w2(t,e,n){const r=new Map;kt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,kG(s,a,n[i]))}return r}function x2(t,e,n){const r=new Map;for(const i of t){const o=i.transform,s=n.data.field(i.field);r.set(i.field,AG(o,s,e))}return r}class TN extends fm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class OG extends fm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LG{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&MG(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=sc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=sc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=yN();return this.mutations.forEach(i=>{const o=e.get(i.key),s=o.overlayedDocument;let a=this.applyToLocalView(s,o.mutatedFields);a=n.has(i.key)?null:a;const u=CN(s,a);u!==null&&r.set(i.key,u),s.isValidDocument()||s.convertToNoDocument(mt.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Cn())}isEqual(e){return this.batchId===e.batchId&&Mu(this.mutations,e.mutations,(n,r)=>_2(n,r))&&Mu(this.baseMutations,e.baseMutations,(n,r)=>_2(n,r))}}class uw{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){kt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return CG}();const o=e.mutations;for(let s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new uw(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VG{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mt,Ue;function BG(t){switch(t){case ne.OK:return De(64938);case ne.CANCELLED:case ne.UNKNOWN:case ne.DEADLINE_EXCEEDED:case ne.RESOURCE_EXHAUSTED:case ne.INTERNAL:case ne.UNAVAILABLE:case ne.UNAUTHENTICATED:return!1;case ne.INVALID_ARGUMENT:case ne.NOT_FOUND:case ne.ALREADY_EXISTS:case ne.PERMISSION_DENIED:case ne.FAILED_PRECONDITION:case ne.ABORTED:case ne.OUT_OF_RANGE:case ne.UNIMPLEMENTED:case ne.DATA_LOSS:return!0;default:return De(15467,{code:t})}}function jG(t){if(t===void 0)return ea("GRPC error has no .code"),ne.UNKNOWN;switch(t){case Mt.OK:return ne.OK;case Mt.CANCELLED:return ne.CANCELLED;case Mt.UNKNOWN:return ne.UNKNOWN;case Mt.DEADLINE_EXCEEDED:return ne.DEADLINE_EXCEEDED;case Mt.RESOURCE_EXHAUSTED:return ne.RESOURCE_EXHAUSTED;case Mt.INTERNAL:return ne.INTERNAL;case Mt.UNAVAILABLE:return ne.UNAVAILABLE;case Mt.UNAUTHENTICATED:return ne.UNAUTHENTICATED;case Mt.INVALID_ARGUMENT:return ne.INVALID_ARGUMENT;case Mt.NOT_FOUND:return ne.NOT_FOUND;case Mt.ALREADY_EXISTS:return ne.ALREADY_EXISTS;case Mt.PERMISSION_DENIED:return ne.PERMISSION_DENIED;case Mt.FAILED_PRECONDITION:return ne.FAILED_PRECONDITION;case Mt.ABORTED:return ne.ABORTED;case Mt.OUT_OF_RANGE:return ne.OUT_OF_RANGE;case Mt.UNIMPLEMENTED:return ne.UNIMPLEMENTED;case Mt.DATA_LOSS:return ne.DATA_LOSS;default:return De(39323,{code:t})}}(Ue=Mt||(Mt={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new q_([4294967295,4294967295],0);class UG{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function o0(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function WG(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function zG(t,e){return o0(t,e.toTimestamp())}function mu(t){return kt(!!t,49232),mt.fromTimestamp(function(n){const r=ta(n);return new vt(r.seconds,r.nanos)}(t))}function IN(t,e){return s0(t,e).canonicalString()}function s0(t,e){const n=function(i){return new wt(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function $G(t){const e=wt.fromString(t);return kt(JG(e),10190,{key:e.toString()}),e}function a0(t,e){return IN(t.databaseId,e.path)}function HG(t){const e=$G(t);return e.length===4?wt.emptyPath():qG(e)}function GG(t){return new wt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function qG(t){return kt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function b2(t,e,n){return{name:a0(t,e),fields:n.value.mapValue.fields}}function KG(t,e){let n;if(e instanceof yh)n={update:b2(t,e.key,e.value)};else if(e instanceof TN)n={delete:a0(t,e.key)};else if(e instanceof ga)n={update:b2(t,e.key,e.data),updateMask:QG(e.fieldMask)};else{if(!(e instanceof OG))return De(16599,{Vt:e.type});n={verify:a0(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(o,s){const a=s.transform;if(a instanceof Hc)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Gc)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof qc)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof lp)return{fieldPath:s.field.canonicalString(),increment:a.Ae};throw De(20930,{transform:s.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:zG(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:De(27497)}(t,e.precondition)),n}function XG(t,e){return t&&t.length>0?(kt(e!==void 0,14353),t.map(n=>function(i,o){let s=i.updateTime?mu(i.updateTime):mu(o);return s.isEqual(mt.min())&&(s=mu(o)),new DG(s,i.transformResults||[])}(n,e))):[]}function YG(t){let e=HG(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){kt(r===1,65062);const c=n.from[0];c.allDescendants?i=c.collectionId:e=e.child(c.collectionId)}let o=[];n.where&&(o=function(h){const f=RN(h);return f instanceof ts&&cN(f)?f.getFilters():[f]}(n.where));let s=[];n.orderBy&&(s=function(h){return h.map(f=>function(m){return new ap(Fa(m.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(m.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,ew(f)?null:f}(n.limit));let u=null;n.startAt&&(u=function(h){const f=!!h.before,d=h.values||[];return new sp(d,f)}(n.startAt));let l=null;return n.endAt&&(l=function(h){const f=!h.before,d=h.values||[];return new sp(d,f)}(n.endAt)),vG(e,i,s,o,a,"F",u,l)}function RN(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Fa(n.unaryFilter.field);return en.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Fa(n.unaryFilter.field);return en.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Fa(n.unaryFilter.field);return en.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Fa(n.unaryFilter.field);return en.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return De(61313);default:return De(60726)}}(t):t.fieldFilter!==void 0?function(n){return en.create(Fa(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return De(58110);default:return De(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return ts.create(n.compositeFilter.filters.map(r=>RN(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return De(1026)}}(n.compositeFilter.op))}(t):De(30097,{filter:t})}function Fa(t){return fn.fromServerFormat(t.fieldPath)}function QG(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function JG(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZG{constructor(e){this.yt=e}}function e7(t){const e=YG({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?i0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t7{constructor(){this.Cn=new n7}addToCollectionParentIndex(e,n){return this.Cn.add(n),ee.resolve()}getCollectionParents(e,n){return ee.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ee.resolve()}deleteFieldIndex(e,n){return ee.resolve()}deleteAllFieldIndexes(e){return ee.resolve()}createTargetIndexes(e,n){return ee.resolve()}getDocumentsMatchingTarget(e,n){return ee.resolve(null)}getIndexType(e,n){return ee.resolve(0)}getFieldIndexes(e,n){return ee.resolve([])}getNextCollectionGroupToUpdate(e){return ee.resolve(null)}getMinOffset(e,n){return ee.resolve(es.min())}getMinOffsetFromCollectionGroup(e,n){return ee.resolve(es.min())}updateCollectionGroup(e,n,r){return ee.resolve()}updateIndexEntries(e,n){return ee.resolve()}}class n7{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new pn(wt.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new pn(wt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},AN=41943040;class Hn{static withCacheSize(e){return new Hn(e,Hn.DEFAULT_COLLECTION_PERCENTILE,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hn.DEFAULT_COLLECTION_PERCENTILE=10,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hn.DEFAULT=new Hn(AN,Hn.DEFAULT_COLLECTION_PERCENTILE,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hn.DISABLED=new Hn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Vu(0)}static cr(){return new Vu(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2="LruGarbageCollector",r7=1048576;function S2([t,e],[n,r]){const i=Xe(t,n);return i===0?Xe(e,r):i}class i7{constructor(e){this.Ir=e,this.buffer=new pn(S2),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();S2(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class o7{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){me(C2,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){vh(n)?me(C2,"Ignoring IndexedDB error during garbage collection: ",n):await Q_(n)}await this.Vr(3e5)})}}class s7{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ee.resolve(J_.ce);const r=new i7(n);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(me("LruGarbageCollector","Garbage collection skipped; disabled"),ee.resolve(E2)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(me("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),E2):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,s,a,u,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,s=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,n))).next(h=>(o=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(l=Date.now(),Ma()<=Be.DEBUG&&me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-c}ms
	Determined least recently used ${i} in `+(a-s)+`ms
	Removed ${o} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(l-u)+`ms
Total Duration: ${l-c}ms`),ee.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:h})))}}function a7(t,e){return new s7(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u7{constructor(){this.changes=new ma(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ur.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ee.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l7{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c7{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&sc(r.mutation,i,Gr.empty(),vt.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Cn()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Cn()){const i=Ls();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(o=>{let s=Sf();return o.forEach((a,u)=>{s=s.insert(a,u.overlayedDocument)}),s}))}getOverlayedDocuments(e,n){const r=Ls();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Cn()))}populateOverlays(e,n,r){const i=[];return r.forEach(o=>{n.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((s,a)=>{n.set(s,a)})})}computeViews(e,n,r,i){let o=up();const s=oc(),a=function(){return oc()}();return n.forEach((u,l)=>{const c=r.get(l.key);i.has(l.key)&&(c===void 0||c.mutation instanceof ga)?o=o.insert(l.key,l):c!==void 0?(s.set(l.key,c.mutation.getFieldMask()),sc(c.mutation,l,c.mutation.getFieldMask(),vt.now())):s.set(l.key,Gr.empty())}),this.recalculateAndSaveOverlays(e,o).next(u=>(u.forEach((l,c)=>s.set(l,c)),n.forEach((l,c)=>a.set(l,new l7(c,s.get(l)??null))),a))}recalculateAndSaveOverlays(e,n){const r=oc();let i=new Zr((s,a)=>s-a),o=Cn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(s=>{for(const a of s)a.keys().forEach(u=>{const l=n.get(u);if(l===null)return;let c=r.get(u)||Gr.empty();c=a.applyToLocalView(l,c),r.set(u,c);const h=(i.get(a.batchId)||Cn()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const s=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),l=u.key,c=u.value,h=yN();c.forEach(f=>{if(!o.has(f)){const d=CN(n.get(f),r.get(f));d!==null&&h.set(f,d),o=o.add(f)}}),s.push(this.documentOverlayCache.saveOverlays(e,l,h))}return ee.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(s){return Pe.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):_G(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(o=>{const s=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ee.resolve(Ls());let a=zc,u=o;return s.next(l=>ee.forEach(l,(c,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),o.get(c)?ee.resolve():this.remoteDocumentCache.getEntry(e,c).next(f=>{u=u.insert(c,f)}))).next(()=>this.populateOverlays(e,l,o)).next(()=>this.computeViews(e,u,l,Cn())).next(c=>({batchId:a,changes:vN(c)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Pe(n)).next(r=>{let i=Sf();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let s=Sf();return this.indexManager.getCollectionParents(e,o).next(a=>ee.forEach(a,u=>{const l=function(h,f){return new cm(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,u.child(o));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(c=>{c.forEach((h,f)=>{s=s.insert(h,f)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(s=>(o=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i))).next(s=>{o.forEach((u,l)=>{const c=l.getKey();s.get(c)===null&&(s=s.insert(c,Ur.newInvalidDocument(c)))});let a=Sf();return s.forEach((u,l)=>{const c=o.get(u);c!==void 0&&sc(c.mutation,l,Gr.empty(),vt.now()),sw(n,l)&&(a=a.insert(u,l))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h7{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ee.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:mu(i.createTime)}}(n)),ee.resolve()}getNamedQuery(e,n){return ee.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(i){return{name:i.name,query:e7(i.bundledQuery),readTime:mu(i.readTime)}}(n)),ee.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f7{constructor(){this.overlays=new Zr(Pe.comparator),this.qr=new Map}getOverlay(e,n){return ee.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Ls();return ee.forEach(n,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,o)=>{this.St(e,n,o)}),ee.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),ee.resolve()}getOverlaysForCollection(e,n,r){const i=Ls(),o=n.length+1,s=new Pe(n.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const u=a.getNext().value,l=u.getKey();if(!n.isPrefixOf(l.path))break;l.path.length===o&&u.largestBatchId>r&&i.set(u.getKey(),u)}return ee.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new Zr((l,c)=>l-c);const s=this.overlays.getIterator();for(;s.hasNext();){const l=s.getNext().value;if(l.getKey().getCollectionGroup()===n&&l.largestBatchId>r){let c=o.get(l.largestBatchId);c===null&&(c=Ls(),o=o.insert(l.largestBatchId,c)),c.set(l.getKey(),l)}}const a=Ls(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,c)=>a.set(l,c)),!(a.size()>=i)););return ee.resolve(a)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const s=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,s)}this.overlays=this.overlays.insert(r.key,new VG(n,r));let o=this.qr.get(n);o===void 0&&(o=Cn(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d7{constructor(){this.sessionToken=Ei.EMPTY_BYTE_STRING}getSessionToken(e){return ee.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ee.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{constructor(){this.Qr=new pn(Qt.$r),this.Ur=new pn(Qt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Qt(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new Qt(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new Pe(new wt([])),r=new Qt(n,e),i=new Qt(n,e+1),o=[];return this.Ur.forEachInRange([r,i],s=>{this.Gr(s),o.push(s.key)}),o}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Pe(new wt([])),r=new Qt(n,e),i=new Qt(n,e+1);let o=Cn();return this.Ur.forEachInRange([r,i],s=>{o=o.add(s.key)}),o}containsKey(e){const n=new Qt(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Qt{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Pe.comparator(e.key,n.key)||Xe(e.Yr,n.Yr)}static Kr(e,n){return Xe(e.Yr,n.Yr)||Pe.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p7{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new pn(Qt.$r)}checkEmpty(e){return ee.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new LG(o,n,r,i);this.mutationQueue.push(s);for(const a of i)this.Zr=this.Zr.add(new Qt(a.key,o)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ee.resolve(s)}lookupMutationBatch(e,n){return ee.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ee.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ee.resolve(this.mutationQueue.length===0?Z_:this.tr-1)}getAllMutationBatches(e){return ee.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Qt(n,0),i=new Qt(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],s=>{const a=this.Xr(s.Yr);o.push(a)}),ee.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new pn(Xe);return n.forEach(i=>{const o=new Qt(i,0),s=new Qt(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,s],a=>{r=r.add(a.Yr)})}),ee.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Pe.isDocumentKey(o)||(o=o.child(""));const s=new Qt(new Pe(o),0);let a=new pn(Xe);return this.Zr.forEachWhile(u=>{const l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(u.Yr)),!0)},s),ee.resolve(this.ti(a))}ti(e){const n=[];return e.forEach(r=>{const i=this.Xr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){kt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ee.forEach(n.mutations,i=>{const o=new Qt(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new Qt(n,0),i=this.Zr.firstAfterOrEqual(r);return ee.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ee.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m7{constructor(e){this.ri=e,this.docs=function(){return new Zr(Pe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,s=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:s}),this.size+=s-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ee.resolve(r?r.document.mutableCopy():Ur.newInvalidDocument(n))}getEntries(e,n){let r=up();return n.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Ur.newInvalidDocument(i))}),ee.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=up();const s=n.path,a=new Pe(s.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:l,value:{document:c}}=u.getNext();if(!s.isPrefixOf(l.path))break;l.path.length>s.length+1||KH(qH(c),r)<=0||(i.has(c.key)||sw(n,c))&&(o=o.insert(c.key,c.mutableCopy()))}return ee.resolve(o)}getAllFromCollectionGroup(e,n,r,i){De(9500)}ii(e,n){return ee.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new g7(this)}getSize(e){return ee.resolve(this.size)}}class g7 extends u7{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),ee.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v7{constructor(e){this.persistence=e,this.si=new ma(n=>iw(n),ow),this.lastRemoteSnapshotVersion=mt.min(),this.highestTargetId=0,this.oi=0,this._i=new lw,this.targetCount=0,this.ai=Vu.ur()}forEachTarget(e,n){return this.si.forEach((r,i)=>n(i)),ee.resolve()}getLastRemoteSnapshotVersion(e){return ee.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ee.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ee.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ee.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Vu(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ee.resolve()}updateTargetData(e,n){return this.Pr(n),ee.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ee.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.si.delete(s),o.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),ee.waitFor(o).next(()=>i)}getTargetCount(e){return ee.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ee.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ee.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach(s=>{o.push(i.markPotentiallyOrphaned(e,s))}),ee.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ee.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ee.resolve(r)}containsKey(e,n){return ee.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(e,n){this.ui={},this.overlays={},this.ci=new J_(0),this.li=!1,this.li=!0,this.hi=new d7,this.referenceDelegate=e(this),this.Pi=new v7(this),this.indexManager=new t7,this.remoteDocumentCache=function(i){return new m7(i)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new ZG(n),this.Ii=new h7(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new f7,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new p7(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){me("MemoryPersistence","Starting transaction:",e);const i=new y7(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(o=>this.referenceDelegate.di(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ai(e,n){return ee.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class y7 extends YH{constructor(e){super(),this.currentSequenceNumber=e}}class cw{constructor(e){this.persistence=e,this.Ri=new lw,this.Vi=null}static mi(e){return new cw(e)}get fi(){if(this.Vi)return this.Vi;throw De(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ee.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ee.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ee.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(i=>this.fi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ee.forEach(this.fi,r=>{const i=Pe.fromPath(r);return this.gi(e,i).next(o=>{o||n.removeEntry(i,mt.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return ee.or([()=>ee.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class cp{constructor(e,n){this.persistence=e,this.pi=new ma(r=>ZH(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=a7(this,n)}static mi(e,n){return new cp(e,n)}Ei(){}di(e){return ee.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return ee.forEach(this.pi,(r,i)=>this.br(e,r,i).next(o=>o?ee.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,s=>this.br(e,s,n).next(a=>{a||(r++,o.removeEntry(s,mt.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ee.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ee.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ee.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ee.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Gf(e.data.value)),n}br(e,n,r){return ee.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ee.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=Cn(),i=Cn();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new hw(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _7{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w7{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return d8()?8:QH(kP())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next(s=>{o.result=s}).next(()=>{if(!o.result)return this.ws(e,n,i,r).next(s=>{o.result=s})}).next(()=>{if(o.result)return;const s=new _7;return this.Ss(e,n,s).next(a=>{if(o.result=a,this.Vs)return this.bs(e,n,s,a.size)})}).next(()=>o.result)}bs(e,n,r,i){return r.documentReadCount<this.fs?(Ma()<=Be.DEBUG&&me("QueryEngine","SDK will not create cache indexes for query:",Al(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ee.resolve()):(Ma()<=Be.DEBUG&&me("QueryEngine","Query:",Al(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Ma()<=Be.DEBUG&&me("QueryEngine","The SDK decides to create cache indexes for query:",Al(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$s(n))):ee.resolve())}ys(e,n){if(v2(n))return ee.resolve(null);let r=$s(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=i0(n,null,"F"),r=$s(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const s=Cn(...o);return this.ps.getDocuments(e,s).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const l=this.Ds(n,a);return this.Cs(n,l,s,u.readTime)?this.ys(e,i0(n,null,"F")):this.vs(e,l,n,u)}))})))}ws(e,n,r,i){return v2(n)||i.isEqual(mt.min())?ee.resolve(null):this.ps.getDocuments(e,r).next(o=>{const s=this.Ds(n,o);return this.Cs(n,s,r,i)?ee.resolve(null):(Ma()<=Be.DEBUG&&me("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Al(n)),this.vs(e,s,n,GH(i,zc)).next(a=>a))})}Ds(e,n){let r=new pn(xG(e));return n.forEach((i,o)=>{sw(e,o)&&(r=r.add(o))}),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Ma()<=Be.DEBUG&&me("QueryEngine","Using full collection scan to execute query:",Al(n)),this.ps.getDocumentsMatchingQuery(e,n,es.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(o=>(n.forEach(s=>{o=o.insert(s.key,s)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x7="LocalStore";class b7{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new Zr(Xe),this.xs=new ma(o=>iw(o),ow),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new c7(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function E7(t,e,n,r){return new b7(t,e,n,r)}async function PN(t,e){const n=ot(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(o=>{const s=[],a=[];let u=Cn();for(const l of i){s.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}for(const l of o){a.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}return n.localDocuments.getDocuments(r,u).next(l=>({Ls:l,removedBatchIds:s,addedBatchIds:a}))})})}function C7(t,e){const n=ot(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return function(a,u,l,c){const h=l.batch,f=h.keys();let d=ee.resolve();return f.forEach(m=>{d=d.next(()=>c.getEntry(u,m)).next(v=>{const y=l.docVersions.get(m);kt(y!==null,48541),v.version.compareTo(y)<0&&(h.applyToRemoteDocument(v,l),v.isValidDocument()&&(v.setReadTime(l.commitVersion),c.addEntry(v)))})}),d.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(n,r,e,o).next(()=>o.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=Cn();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(u=u.add(a.batch.mutations[l].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function S7(t){const e=ot(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function T7(t,e){const n=ot(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Z_),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}class T2{constructor(){this.activeTargetIds=IG()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class I7{constructor(){this.Mo=new T2,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new T2,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R7{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2="ConnectivityMonitor";class R2{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){me(I2,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){me(I2,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tf=null;function u0(){return Tf===null?Tf=function(){return 268435456+Math.round(2147483648*Math.random())}():Tf++,"0x"+Tf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ov="RestConnection",A7={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class k7{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===ip?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const s=u0(),a=this.zo(e,n.toUriEncodedString());me(ov,`Sending RPC '${e}' ${s}:`,a,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,o);const{host:l}=new URL(a),c=mh(l);return this.Jo(e,a,u,r,c).then(h=>(me(ov,`Received RPC '${e}' ${s}: `,h),h),h=>{throw lm(ov,`RPC '${e}' ${s} failed with error: `,h,"url: ",a,"request:",r),h})}Ho(e,n,r,i,o,s){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ku}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}zo(e,n){const r=A7[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P7{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yn="WebChannelConnection";class N7 extends k7{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const s=u0();return new Promise((a,u)=>{const l=new zP;l.setWithCredentials(!0),l.listenOnce($P.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Hf.NO_ERROR:const h=l.getResponseJson();me(yn,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),a(h);break;case Hf.TIMEOUT:me(yn,`RPC '${e}' ${s} timed out`),u(new Ce(ne.DEADLINE_EXCEEDED,"Request time out"));break;case Hf.HTTP_ERROR:const f=l.getStatus();if(me(yn,`RPC '${e}' ${s} failed with status:`,f,"response text:",l.getResponseText()),f>0){let d=l.getResponseJson();Array.isArray(d)&&(d=d[0]);const m=d==null?void 0:d.error;if(m&&m.status&&m.message){const v=function(g){const _=g.toLowerCase().replace(/_/g,"-");return Object.values(ne).indexOf(_)>=0?_:ne.UNKNOWN}(m.status);u(new Ce(v,m.message))}else u(new Ce(ne.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new Ce(ne.UNAVAILABLE,"Connection failed."));break;default:De(9055,{l_:e,streamId:s,h_:l.getLastErrorCode(),P_:l.getLastError()})}}finally{me(yn,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);me(yn,`RPC '${e}' ${s} sending request:`,i),l.send(n,"POST",c,r,15)})}T_(e,n,r){const i=u0(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=qP(),a=GP(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const c=o.join("");me(yn,`Creating RPC '${e}' stream ${i}: ${c}`,u);const h=s.createWebChannel(c,u);this.I_(h);let f=!1,d=!1;const m=new P7({Yo:y=>{d?me(yn,`Not sending because RPC '${e}' stream ${i} is closed:`,y):(f||(me(yn,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),me(yn,`RPC '${e}' stream ${i} sending:`,y),h.send(y))},Zo:()=>h.close()}),v=(y,g,_)=>{y.listen(g,w=>{try{_(w)}catch(x){setTimeout(()=>{throw x},0)}})};return v(h,Bl.EventType.OPEN,()=>{d||(me(yn,`RPC '${e}' stream ${i} transport opened.`),m.o_())}),v(h,Bl.EventType.CLOSE,()=>{d||(d=!0,me(yn,`RPC '${e}' stream ${i} transport closed`),m.a_(),this.E_(h))}),v(h,Bl.EventType.ERROR,y=>{d||(d=!0,lm(yn,`RPC '${e}' stream ${i} transport errored. Name:`,y.name,"Message:",y.message),m.a_(new Ce(ne.UNAVAILABLE,"The operation could not be completed")))}),v(h,Bl.EventType.MESSAGE,y=>{var g;if(!d){const _=y.data[0];kt(!!_,16349);const w=_,x=(w==null?void 0:w.error)||((g=w[0])==null?void 0:g.error);if(x){me(yn,`RPC '${e}' stream ${i} received error:`,x);const S=x.status;let A=function(C){const I=Mt[C];if(I!==void 0)return jG(I)}(S),T=x.message;A===void 0&&(A=ne.INTERNAL,T="Unknown error status: "+S+" with message "+x.message),d=!0,m.a_(new Ce(A,T)),h.close()}else me(yn,`RPC '${e}' stream ${i} received:`,_),m.u_(_)}}),v(a,HP.STAT_EVENT,y=>{y.stat===Qy.PROXY?me(yn,`RPC '${e}' stream ${i} detected buffering proxy`):y.stat===Qy.NOPROXY&&me(yn,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{m.__()},0),m}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}function sv(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(t){return new UG(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&me("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2="PersistentStream";class D7{constructor(e,n,r,i,o,s,a,u){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new NN(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===ne.RESOURCE_EXHAUSTED?(ea(n.toString()),ea("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===ne.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===n&&this.G_(r,i)},r=>{e(()=>{const i=new Ce(ne.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return me(A2,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(me(A2,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class M7 extends D7{constructor(e,n,r,i,o,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,s),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return kt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,kt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){kt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=XG(e.writeResults,e.commitTime),r=mu(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=GG(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>KG(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{}class O7 extends F7{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Ce(ne.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,s])=>this.connection.Go(e,s0(n,r),i,o,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ce(ne.UNKNOWN,o.toString())})}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,s0(n,r),i,s,a,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Ce(ne.UNKNOWN,s.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class L7{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ea(n),this.aa=!1):me("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h="RemoteStore";class V7{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(s=>{r.enqueueAndForget(async()=>{xh(this)&&(me(_h,"Restarting streams for network reachability change."),await async function(u){const l=ot(u);l.Ea.add(4),await wh(l),l.Ra.set("Unknown"),l.Ea.delete(4),await pm(l)}(this))})}),this.Ra=new L7(r,i)}}async function pm(t){if(xh(t))for(const e of t.da)await e(!0)}async function wh(t){for(const e of t.da)await e(!1)}function xh(t){return ot(t).Ea.size===0}async function DN(t,e,n){if(!vh(e))throw e;t.Ea.add(1),await wh(t),t.Ra.set("Offline"),n||(n=()=>S7(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{me(_h,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await pm(t)})}function MN(t,e){return e().catch(n=>DN(t,n,e))}async function mm(t){const e=ot(t),n=ns(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Z_;for(;B7(e);)try{const i=await T7(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,j7(e,i)}catch(i){await DN(e,i)}FN(e)&&ON(e)}function B7(t){return xh(t)&&t.Ta.length<10}function j7(t,e){t.Ta.push(e);const n=ns(t);n.O_()&&n.X_&&n.ea(e.mutations)}function FN(t){return xh(t)&&!ns(t).x_()&&t.Ta.length>0}function ON(t){ns(t).start()}async function U7(t){ns(t).ra()}async function W7(t){const e=ns(t);for(const n of t.Ta)e.ea(n.mutations)}async function z7(t,e,n){const r=t.Ta.shift(),i=uw.from(r,e,n);await MN(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await mm(t)}async function $7(t,e){e&&ns(t).X_&&await async function(r,i){if(function(s){return BG(s)&&s!==ne.ABORTED}(i.code)){const o=r.Ta.shift();ns(r).B_(),await MN(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await mm(r)}}(t,e),FN(t)&&ON(t)}async function k2(t,e){const n=ot(t);n.asyncQueue.verifyOperationInProgress(),me(_h,"RemoteStore received new credentials");const r=xh(n);n.Ea.add(3),await wh(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await pm(n)}async function H7(t,e){const n=ot(t);e?(n.Ea.delete(2),await pm(n)):e||(n.Ea.add(2),await wh(n),n.Ra.set("Unknown"))}function ns(t){return t.fa||(t.fa=function(n,r,i){const o=ot(n);return o.sa(),new M7(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:U7.bind(null,t),r_:$7.bind(null,t),ta:W7.bind(null,t),na:z7.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await mm(t)):(await t.fa.stop(),t.Ta.length>0&&(me(_h,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new zs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(s=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const s=Date.now()+r,a=new fw(e,n,s,i,o);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ce(ne.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function LN(t,e){if(ea("AsyncQueue",`${e}: ${t}`),vh(t))return new Ce(ne.UNAVAILABLE,`${e}: ${t}`);throw t}class G7{constructor(){this.queries=P2(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=ot(n),o=i.queries;i.queries=P2(),o.forEach((s,a)=>{for(const u of a.Sa)u.onError(r)})})(this,new Ce(ne.ABORTED,"Firestore shutting down"))}}function P2(){return new ma(t=>mN(t),pN)}function q7(t){t.Ca.forEach(e=>{e.next()})}var N2,D2;(D2=N2||(N2={})).Ma="default",D2.Cache="cache";const K7="SyncEngine";class X7{constructor(e,n,r,i,o,s){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new ma(a=>mN(a),pN),this.Iu=new Map,this.Eu=new Set,this.du=new Zr(Pe.comparator),this.Au=new Map,this.Ru=new lw,this.Vu={},this.mu=new Map,this.fu=Vu.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Y7(t,e,n){const r=eq(t);try{const i=await function(s,a){const u=ot(s),l=vt.now(),c=a.reduce((d,m)=>d.add(m.key),Cn());let h,f;return u.persistence.runTransaction("Locally write mutations","readwrite",d=>{let m=up(),v=Cn();return u.Ns.getEntries(d,c).next(y=>{m=y,m.forEach((g,_)=>{_.isValidDocument()||(v=v.add(g))})}).next(()=>u.localDocuments.getOverlayedDocuments(d,m)).next(y=>{h=y;const g=[];for(const _ of a){const w=FG(_,h.get(_.key).overlayedDocument);w!=null&&g.push(new ga(_.key,w,aN(w.value.mapValue),$i.exists(!0)))}return u.mutationQueue.addMutationBatch(d,l,g,a)}).next(y=>{f=y;const g=y.applyToLocalDocumentSet(h,v);return u.documentOverlayCache.saveOverlays(d,y.batchId,g)})}).then(()=>({batchId:f.batchId,changes:vN(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,a,u){let l=s.Vu[s.currentUser.toKey()];l||(l=new Zr(Xe)),l=l.insert(a,u),s.Vu[s.currentUser.toKey()]=l}(r,i.batchId,n),await gm(r,i.changes),await mm(r.remoteStore)}catch(i){const o=LN(i,"Failed to persist write");n.reject(o)}}function M2(t,e,n){const r=ot(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach((o,s)=>{const a=s.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(s,a){const u=ot(s);u.onlineState=a;let l=!1;u.queries.forEach((c,h)=>{for(const f of h.Sa)f.va(a)&&(l=!0)}),l&&q7(u)}(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Q7(t,e){const n=ot(t),r=e.batch.batchId;try{const i=await C7(n.localStore,e);BN(n,r,null),VN(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await gm(n,i)}catch(i){await Q_(i)}}async function J7(t,e,n){const r=ot(t);try{const i=await function(s,a){const u=ot(s);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return u.mutationQueue.lookupMutationBatch(l,a).next(h=>(kt(h!==null,37113),c=h.keys(),u.mutationQueue.removeMutationBatch(l,h))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,c,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>u.localDocuments.getDocuments(l,c))})}(r.localStore,e);BN(r,e,n),VN(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await gm(r,i)}catch(i){await Q_(i)}}function VN(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function BN(t,e,n){const r=ot(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}async function gm(t,e,n){const r=ot(t),i=[],o=[],s=[];r.Tu.isEmpty()||(r.Tu.forEach((a,u)=>{s.push(r.pu(u,e,n).then(l=>{var c;if((l||n)&&r.isPrimaryClient){const h=l?!l.fromCache:(c=n==null?void 0:n.targetChanges.get(u.targetId))==null?void 0:c.current;r.sharedClientState.updateQueryState(u.targetId,h?"current":"not-current")}if(l){i.push(l);const h=hw.As(u.targetId,l);o.push(h)}}))}),await Promise.all(s),r.Pu.H_(i),await async function(u,l){const c=ot(u);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>ee.forEach(l,f=>ee.forEach(f.Es,d=>c.persistence.referenceDelegate.addReference(h,f.targetId,d)).next(()=>ee.forEach(f.ds,d=>c.persistence.referenceDelegate.removeReference(h,f.targetId,d)))))}catch(h){if(!vh(h))throw h;me(x7,"Failed to update sequence numbers: "+h)}for(const h of l){const f=h.targetId;if(!h.fromCache){const d=c.Ms.get(f),m=d.snapshotVersion,v=d.withLastLimboFreeSnapshotVersion(m);c.Ms=c.Ms.insert(f,v)}}}(r.localStore,o))}async function Z7(t,e){const n=ot(t);if(!n.currentUser.isEqual(e)){me(K7,"User change. New user:",e.toKey());const r=await PN(n.localStore,e);n.currentUser=e,function(o,s){o.mu.forEach(a=>{a.forEach(u=>{u.reject(new Ce(ne.CANCELLED,s))})}),o.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await gm(n,r.Ls)}}function eq(t){const e=ot(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Q7.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=J7.bind(null,e),e}class hp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return E7(this.persistence,new w7,e.initialUser,this.serializer)}Cu(e){return new kN(cw.mi,this.serializer)}Du(e){return new I7}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hp.provider={build:()=>new hp};class tq extends hp{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){kt(this.persistence.referenceDelegate instanceof cp,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new o7(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Hn.withCacheSize(this.cacheSizeBytes):Hn.DEFAULT;return new kN(r=>cp.mi(r,n),this.serializer)}}class l0{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>M2(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Z7.bind(null,this.syncEngine),await H7(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new G7}()}createDatastore(e){const n=dm(e.databaseInfo.databaseId),r=function(o){return new N7(o)}(e.databaseInfo);return function(o,s,a,u){return new O7(o,s,a,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,o,s,a){return new V7(r,i,o,s,a)}(this.localStore,this.datastore,e.asyncQueue,n=>M2(this.syncEngine,n,0),function(){return R2.v()?new R2:new R7}())}createSyncEngine(e,n){return function(i,o,s,a,u,l,c){const h=new X7(i,o,s,a,u,l);return c&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const o=ot(i);me(_h,"RemoteStore shutting down."),o.Ea.add(5),await wh(o),o.Aa.shutdown(),o.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}l0.provider={build:()=>new l0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rs="FirestoreClient";class nq{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=xn.UNAUTHENTICATED,this.clientId=X_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async s=>{me(rs,"Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(me(rs,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=LN(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function av(t,e){t.asyncQueue.verifyOperationInProgress(),me(rs,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await PN(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function F2(t,e){t.asyncQueue.verifyOperationInProgress();const n=await rq(t);me(rs,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>k2(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>k2(e.remoteStore,i)),t._onlineComponents=e}async function rq(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){me(rs,"Using user provided OfflineComponentProvider");try{await av(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===ne.FAILED_PRECONDITION||i.code===ne.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;lm("Error using user provided cache. Falling back to memory cache: "+n),await av(t,new hp)}}else me(rs,"Using default OfflineComponentProvider"),await av(t,new tq(void 0));return t._offlineComponents}async function iq(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(me(rs,"Using user provided OnlineComponentProvider"),await F2(t,t._uninitializedComponentsProvider._online)):(me(rs,"Using default OnlineComponentProvider"),await F2(t,new l0))),t._onlineComponents}function oq(t){return iq(t).then(e=>e.syncEngine)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN="firestore.googleapis.com",L2=!0;class V2{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Ce(ne.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=UN,this.ssl=L2}else this.host=e.host,this.ssl=e.ssl??L2;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=AN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<r7)throw new Ce(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}HH("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jN(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Ce(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Ce(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Ce(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new V2({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ce(ne.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ce(ne.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new V2(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new FH;switch(r.type){case"firstParty":return new BH(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ce(ne.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=O2.get(n);r&&(me("ComponentProvider","Removing Datastore"),O2.delete(n),r.terminate())}(this),Promise.resolve()}}function sq(t,e,n,r={}){var l;t=JP(t,vm);const i=mh(e),o=t._getSettings(),s={...o,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;i&&(IP(`https://${a}`),AP("Firestore",!0)),o.host!==UN&&o.host!==a&&lm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...o,host:a,ssl:i,emulatorOptions:r};if(!jc(u,s)&&(t._setSettings(u),r.mockUserToken)){let c,h;if(typeof r.mockUserToken=="string")c=r.mockUserToken,h=xn.MOCK_USER;else{c=RP(r.mockUserToken,(l=t._app)==null?void 0:l.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new Ce(ne.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new xn(f)}t._authCredentials=new OH(new XP(c,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dw(this.firestore,e,this._query)}}class kn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Go(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new kn(this.firestore,e,this._key)}toJSON(){return{type:kn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(gh(n,kn._jsonSchema))return new kn(e,r||null,new Pe(wt.fromString(n.referencePath)))}}kn._jsonSchemaVersion="firestore/documentReference/1.0",kn._jsonSchema={type:Vt("string",kn._jsonSchemaVersion),referencePath:Vt("string")};class Go extends dw{constructor(e,n,r){super(e,n,yG(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new kn(this.firestore,null,new Pe(e))}withConverter(e){return new Go(this.firestore,e,this._path)}}function ym(t,e,...n){if(t=Js(t),YP("collection","path",e),t instanceof vm){const r=wt.fromString(e,...n);return s2(r),new Go(t,null,r)}{if(!(t instanceof kn||t instanceof Go))throw new Ce(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(wt.fromString(e,...n));return s2(r),new Go(t.firestore,null,r)}}function aq(t,e,...n){if(t=Js(t),arguments.length===1&&(e=X_.newId()),YP("doc","path",e),t instanceof vm){const r=wt.fromString(e,...n);return o2(r),new kn(t,null,new Pe(r))}{if(!(t instanceof kn||t instanceof Go))throw new Ce(ne.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(wt.fromString(e,...n));return o2(r),new kn(t.firestore,t instanceof Go?t.converter:null,new Pe(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2="AsyncQueue";class j2{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new NN(this,"async_queue_retry"),this._c=()=>{const r=sv();r&&me(B2,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=sv();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=sv();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new zs;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!vh(e))throw e;me(B2,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,ea("INTERNAL UNHANDLED ERROR: ",U2(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=fw.createAndSchedule(this,e,n,r,o=>this.hc(o));return this.tc.push(i),i}uc(){this.nc&&De(47125,{Pc:U2(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function U2(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class WN extends vm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new j2,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new j2(e),this._firestoreClient=void 0,await e}}}function uq(t,e){const n=typeof t=="object"?t:jP(),r=typeof t=="string"?t:ip,i=OP(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=SP("firestore");o&&sq(i,...o)}return i}function lq(t){if(t._terminated)throw new Ce(ne.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||cq(t),t._firestoreClient}function cq(t){var r,i,o;const e=t._freezeSettings(),n=function(a,u,l,c){return new rG(a,u,l,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,jN(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((o=e.localCache)!=null&&o._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new nq(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(a){const u=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new zr(Ei.fromBase64String(e))}catch(n){throw new Ce(ne.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new zr(Ei.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:zr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(gh(e,zr._jsonSchema))return zr.fromBase64String(e.bytes)}}zr._jsonSchemaVersion="firestore/bytes/1.0",zr._jsonSchema={type:Vt("string",zr._jsonSchemaVersion),bytes:Vt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Ce(ne.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Ce(ne.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Ce(ne.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Xe(this._lat,e._lat)||Xe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hi._jsonSchemaVersion}}static fromJSON(e){if(gh(e,Hi._jsonSchema))return new Hi(e.latitude,e.longitude)}}Hi._jsonSchemaVersion="firestore/geoPoint/1.0",Hi._jsonSchema={type:Vt("string",Hi._jsonSchemaVersion),latitude:Vt("number"),longitude:Vt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Gi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(gh(e,Gi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Gi(e.vectorValues);throw new Ce(ne.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gi._jsonSchemaVersion="firestore/vectorValue/1.0",Gi._jsonSchema={type:Vt("string",Gi._jsonSchemaVersion),vectorValues:Vt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hq=/^__.*__$/;class fq{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new ga(e,this.data,this.fieldMask,n,this.fieldTransforms):new yh(e,this.data,n,this.fieldTransforms)}}function zN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw De(40011,{Ac:t})}}class gw{constructor(e,n,r,i,o,s){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new gw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return fp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(zN(this.Ac)&&hq.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class dq{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||dm(e)}Cc(e,n,r,i=!1){return new gw({Ac:e,methodName:n,Dc:r,path:fn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pq(t){const e=t._freezeSettings(),n=dm(t._databaseId);return new dq(t._databaseId,!!e.ignoreUndefinedProperties,n)}function mq(t,e,n,r,i,o={}){const s=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);qN("Data must be an object, but it was:",s,r);const a=HN(r,s);let u,l;if(o.merge)u=new Gr(s.fieldMask),l=s.fieldTransforms;else if(o.mergeFields){const c=[];for(const h of o.mergeFields){const f=gq(e,h,n);if(!s.contains(f))throw new Ce(ne.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);yq(c,f)||c.push(f)}u=new Gr(c),l=s.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,l=s.fieldTransforms;return new fq(new Wr(a),u,l)}class vw extends mw{_toFieldTransform(e){return new PG(e.path,new Hc)}isEqual(e){return e instanceof vw}}function $N(t,e){if(GN(t=Js(t)))return qN("Unsupported field value:",e,t),HN(t,e);if(t instanceof mw)return function(r,i){if(!zN(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,i){const o=[];let s=0;for(const a of r){let u=$N(a,i.wc(s));u==null&&(u={nullValue:"NULL_VALUE"}),o.push(u),s++}return{arrayValue:{values:o}}}(t,e)}return function(r,i){if((r=Js(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return RG(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=vt.fromDate(r);return{timestampValue:o0(i.serializer,o)}}if(r instanceof vt){const o=new vt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:o0(i.serializer,o)}}if(r instanceof Hi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof zr)return{bytesValue:WG(i.serializer,r._byteString)};if(r instanceof kn){const o=i.databaseId,s=r.firestore._databaseId;if(!s.isEqual(o))throw i.Sc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:IN(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gi)return function(s,a){return{mapValue:{fields:{[oN]:{stringValue:sN},[e0]:{arrayValue:{values:s.toArray().map(l=>{if(typeof l!="number")throw a.Sc("VectorValues must only contain numeric values.");return aw(a.serializer,l)})}}}}}}(r,i);throw i.Sc(`Unsupported field value: ${Y_(r)}`)}(t,e)}function HN(t,e){const n={};return eN(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Xu(t,(r,i)=>{const o=$N(i,e.mc(r));o!=null&&(n[r]=o)}),{mapValue:{fields:n}}}function GN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof vt||t instanceof Hi||t instanceof zr||t instanceof kn||t instanceof mw||t instanceof Gi)}function qN(t,e,n){if(!GN(n)||!QP(n)){const r=Y_(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function gq(t,e,n){if((e=Js(e))instanceof pw)return e._internalPath;if(typeof e=="string")return KN(t,e);throw fp("Field path arguments must be of type string or ",t,!1,void 0,n)}const vq=new RegExp("[~\\*/\\[\\]]");function KN(t,e,n){if(e.search(vq)>=0)throw fp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new pw(...e.split("."))._internalPath}catch{throw fp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function fp(t,e,n,r,i){const o=r&&!r.isEmpty(),s=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(o||s)&&(u+=" (found",o&&(u+=` in field ${r}`),s&&(u+=` in document ${i}`),u+=")"),new Ce(ne.INVALID_ARGUMENT,a+t+u)}function yq(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new kn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new _q(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(YN("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class _q extends XN{data(){return super.data()}}function YN(t,e){return typeof e=="string"?KN(t,e):e instanceof pw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wq(t,e,n){let r;return r=t?t.toFirestore(e):e,r}class If{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gu extends XN{constructor(e,n,r,i,o,s){super(e,n,r,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Xf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(YN("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ce(ne.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=gu._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}gu._jsonSchemaVersion="firestore/documentSnapshot/1.0",gu._jsonSchema={type:Vt("string",gu._jsonSchemaVersion),bundleSource:Vt("string","DocumentSnapshot"),bundleName:Vt("string"),bundle:Vt("string")};class Xf extends gu{data(e={}){return super.data(e)}}class ac{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new If(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Xf(this._firestore,this._userDataWriter,r.key,r,new If(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Ce(ne.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(a=>{const u=new Xf(i._firestore,i._userDataWriter,a.doc.key,a.doc,new If(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:s++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>o||a.type!==3).map(a=>{const u=new Xf(i._firestore,i._userDataWriter,a.doc.key,a.doc,new If(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,c=-1;return a.type!==0&&(l=s.indexOf(a.doc.key),s=s.delete(a.doc.key)),a.type!==1&&(s=s.add(a.doc),c=s.indexOf(a.doc.key)),{type:xq(a.type),doc:u,oldIndex:l,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ce(ne.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ac._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=X_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function xq(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return De(61501,{type:t})}}ac._jsonSchemaVersion="firestore/querySnapshot/1.0",ac._jsonSchema={type:Vt("string",ac._jsonSchemaVersion),bundleSource:Vt("string","QuerySnapshot"),bundleName:Vt("string"),bundle:Vt("string")};function _m(t,e){const n=JP(t.firestore,WN),r=aq(t),i=wq(t.converter,e);return bq(n,[mq(pq(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,$i.exists(!1))]).then(()=>r)}function bq(t,e){return function(r,i){const o=new zs;return r.asyncQueue.enqueueAndForget(async()=>Y7(await oq(r),i,o)),o.promise}(lq(t),e)}function QN(){return new vw("serverTimestamp")}(function(e,n=!0){(function(i){Ku=i})(VP),Uc(new Du("firestore",(r,{instanceIdentifier:i,options:o})=>{const s=r.getProvider("app").getImmediate(),a=new WN(new LH(r.getProvider("auth-internal")),new jH(s,r.getProvider("app-check-internal")),function(l,c){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new Ce(ne.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new op(l.options.projectId,c)}(s,i),s);return o={useFetchStreams:n,...o},a._setSettings(o),a},"PUBLIC").setMultipleInstances(!0)),$o(t2,n2,e),$o(t2,n2,"esm2020")})();var W2={};const z2="@firebase/database",$2="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JN="";function Eq(t){JN=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cq{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),hn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Bc(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return uo(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Cq(e)}}catch{}return new Sq},Vs=ZN("localStorage"),Tq=ZN("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vu=new H_("@firebase/database"),Iq=function(){let t=1;return function(){return t++}}(),eD=function(t){const e=C8(t),n=new b8;n.update(e);const r=n.digest();return W_.encodeByteArray(r)},bh=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=bh.apply(null,r):typeof r=="object"?e+=hn(r):e+=r,e+=" "}return e};let uc=null,H2=!0;const Rq=function(t,e){ae(!0,"Can't turn on custom loggers persistently."),vu.logLevel=Be.VERBOSE,uc=vu.log.bind(vu)},Sn=function(...t){if(H2===!0&&(H2=!1,uc===null&&Tq.get("logging_enabled")===!0&&Rq()),uc){const e=bh.apply(null,t);uc(e)}},Eh=function(t){return function(...e){Sn(t,...e)}},c0=function(...t){const e="FIREBASE INTERNAL ERROR: "+bh(...t);vu.error(e)},eo=function(...t){const e=`FIREBASE FATAL ERROR: ${bh(...t)}`;throw vu.error(e),new Error(e)},gr=function(...t){const e="FIREBASE WARNING: "+bh(...t);vu.warn(e)},Aq=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&gr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},tD=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},kq=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Bu="[MIN_NAME]",ra="[MAX_NAME]",Yu=function(t,e){if(t===e)return 0;if(t===Bu||e===ra)return-1;if(e===Bu||t===ra)return 1;{const n=G2(t),r=G2(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},Pq=function(t,e){return t===e?0:t<e?-1:1},kl=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+hn(e))},yw=function(t){if(typeof t!="object"||t===null)return hn(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=hn(e[r]),n+=":",n+=yw(t[e[r]]);return n+="}",n},nD=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Mr(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const rD=function(t){ae(!tD(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let i,o,s,a,u;t===0?(o=0,s=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),o=a+r,s=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(o=0,s=Math.round(t/Math.pow(2,1-r-n))));const l=[];for(u=n;u;u-=1)l.push(s%2?1:0),s=Math.floor(s/2);for(u=e;u;u-=1)l.push(o%2?1:0),o=Math.floor(o/2);l.push(i?1:0),l.reverse();const c=l.join("");let h="";for(u=0;u<64;u+=8){let f=parseInt(c.substr(u,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},Nq=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Dq=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},Mq=new RegExp("^-?(0*)\\d{1,10}$"),Fq=-2147483648,Oq=2147483647,G2=function(t){if(Mq.test(t)){const e=Number(t);if(e>=Fq&&e<=Oq)return e}return null},Ch=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw gr("Exception was thrown by user callback.",n),e},Math.floor(0))}},Lq=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},lc=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vq{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,LP(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){gr(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bq{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Sn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',gr(e)}}class Yf{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Yf.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _w="5",iD="v",oD="s",sD="r",aD="f",uD=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,lD="ls",cD="p",h0="ac",hD="websocket",fD="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e,n,r,i,o=!1,s="",a=!1,u=!1,l=null){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=o,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Vs.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Vs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function jq(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function pD(t,e,n){ae(typeof e=="string","typeof type must == string"),ae(typeof n=="object","typeof params must == object");let r;if(e===hD)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===fD)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);jq(t)&&(n.ns=t.namespace);const i=[];return Mr(n,(o,s)=>{i.push(o+"="+s)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uq{constructor(){this.counters_={}}incrementCounter(e,n=1){uo(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return t8(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uv={},lv={};function ww(t){const e=t.toString();return uv[e]||(uv[e]=new Uq),uv[e]}function Wq(t,e){const n=t.toString();return lv[n]||(lv[n]=e()),lv[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zq{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Ch(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2="start",$q="close",Hq="pLPCommand",Gq="pRTLPCB",mD="id",gD="pw",vD="ser",qq="cb",Kq="seg",Xq="ts",Yq="d",Qq="dframe",yD=1870,_D=30,Jq=yD-_D,Zq=25e3,eK=3e4;class Ja{constructor(e,n,r,i,o,s,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Eh(e),this.stats_=ww(n),this.urlFn=u=>(this.appCheckToken&&(u[h0]=this.appCheckToken),pD(n,fD,u))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new zq(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(eK)),kq(()=>{if(this.isClosed_)return;this.scriptTagHolder=new xw((...o)=>{const[s,a,u,l,c]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,s===q2)this.id=a,this.password=u;else if(s===$q)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+s)},(...o)=>{const[s,a]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(s,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[q2]="t",r[vD]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[qq]=this.scriptTagHolder.uniqueCallbackIdentifier),r[iD]=_w,this.transportSessionId&&(r[oD]=this.transportSessionId),this.lastSessionId&&(r[lD]=this.lastSessionId),this.applicationId&&(r[cD]=this.applicationId),this.appCheckToken&&(r[h0]=this.appCheckToken),typeof location<"u"&&location.hostname&&uD.test(location.hostname)&&(r[sD]=aD);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ja.forceAllow_=!0}static forceDisallow(){Ja.forceDisallow_=!0}static isAvailable(){return Ja.forceAllow_?!0:!Ja.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Nq()&&!Dq()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=hn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=EP(n),i=nD(r,Jq);for(let o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[Qq]="t",r[mD]=e,r[gD]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=hn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class xw{constructor(e,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Iq(),window[Hq+this.uniqueCallbackIdentifier]=e,window[Gq+this.uniqueCallbackIdentifier]=n,this.myIFrame=xw.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(a){Sn("frame writing exception"),a.stack&&Sn(a.stack),Sn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Sn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[mD]=this.myID,e[gD]=this.myPW,e[vD]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+_D+r.length<=yD;){const s=this.pendingSegs.shift();r=r+"&"+Kq+i+"="+s.seg+"&"+Xq+i+"="+s.ts+"&"+Yq+i+"="+s.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(Zq)),o=()=>{clearTimeout(i),r()};this.addTag(e,o)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{Sn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tK=16384,nK=45e3;let dp=null;typeof MozWebSocket<"u"?dp=MozWebSocket:typeof WebSocket<"u"&&(dp=WebSocket);class $r{constructor(e,n,r,i,o,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Eh(this.connId),this.stats_=ww(n),this.connURL=$r.connectionURL_(n,s,a,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,i,o){const s={};return s[iD]=_w,typeof location<"u"&&location.hostname&&uD.test(location.hostname)&&(s[sD]=aD),n&&(s[oD]=n),r&&(s[lD]=r),i&&(s[h0]=i),o&&(s[cD]=o),pD(e,hD,s)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Vs.set("previous_websocket_failure",!0);try{let r;f8(),this.mySock=new dp(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){$r.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&dp!==null&&!$r.forceDisallow_}static previouslyFailed(){return Vs.isInMemoryStorage||Vs.get("previous_websocket_failure")===!0}markConnectionHealthy(){Vs.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Bc(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ae(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=hn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=nD(n,tK);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(nK))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}$r.responsesRequiredToBeHealthy=2;$r.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{static get ALL_TRANSPORTS(){return[Ja,$r]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=$r&&$r.isAvailable();let r=n&&!$r.previouslyFailed();if(e.webSocketOnly&&(n||gr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[$r];else{const i=this.transports_=[];for(const o of Kc.ALL_TRANSPORTS)o&&o.isAvailable()&&i.push(o);Kc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Kc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rK=6e4,iK=5e3,oK=10*1024,sK=100*1024,cv="t",K2="d",aK="s",X2="r",uK="e",Y2="o",Q2="a",J2="n",Z2="p",lK="h";class cK{constructor(e,n,r,i,o,s,a,u,l,c){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=o,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=u,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Eh("c:"+this.id+":"),this.transportManager_=new Kc(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=lc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>sK?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>oK?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(cv in e){const n=e[cv];n===Q2?this.upgradeIfSecondaryHealthy_():n===X2?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Y2&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=kl("t",e),r=kl("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Z2,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Q2,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:J2,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=kl("t",e),r=kl("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=kl(cv,e);if(K2 in e){const r=e[K2];if(n===lK){const i={...r};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===J2){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===aK?this.onConnectionShutdown_(r):n===X2?this.onReset_(r):n===uK?c0("Server Error: "+r):n===Y2?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):c0("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),_w!==r&&gr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),lc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(rK))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):lc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(iK))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Z2,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Vs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(e){this.allowedEvents_=e,this.listeners_={},ae(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let o=0;o<i.length;o++)if(i[o].callback===n&&(!r||r===i[o].context)){i.splice(o,1);return}}validateEventType_(e){ae(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp extends xD{static getInstance(){return new pp}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!PP()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ae(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS=32,tS=768;class pt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Ze(){return new pt("")}function We(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function is(t){return t.pieces_.length-t.pieceNum_}function ft(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new pt(t.pieces_,e)}function bD(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function hK(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function ED(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function CD(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new pt(e,0)}function tn(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof pt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new pt(n,0)}function je(t){return t.pieceNum_>=t.pieces_.length}function kr(t,e){const n=We(t),r=We(e);if(n===null)return e;if(n===r)return kr(ft(t),ft(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function SD(t,e){if(is(t)!==is(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function qr(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(is(t)>is(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class fK{constructor(e,n){this.errorPrefix_=n,this.parts_=ED(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=um(this.parts_[r]);TD(this)}}function dK(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=um(e),TD(t)}function pK(t){const e=t.parts_.pop();t.byteLength_-=um(e),t.parts_.length>0&&(t.byteLength_-=1)}function TD(t){if(t.byteLength_>tS)throw new Error(t.errorPrefix_+"has a key path longer than "+tS+" bytes ("+t.byteLength_+").");if(t.parts_.length>eS)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+eS+") or object contains a cycle "+As(t))}function As(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw extends xD{static getInstance(){return new bw}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ae(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl=1e3,mK=60*5*1e3,nS=30*1e3,gK=1.3,vK=3e4,yK="server_kill",rS=3;class qi extends wD{constructor(e,n,r,i,o,s,a,u){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=o,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=u,this.id=qi.nextPersistentConnectionId_++,this.log_=Eh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Pl,this.maxReconnectDelay_=mK,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");bw.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&pp.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const i=++this.requestNumber_,o={r:i,a:e,b:n};this.log_(hn(o)),ae(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const n=new $_,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:s=>{const a=s.d;s.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),n.promise}listen(e,n,r,i){this.initConnection_();const o=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+o),this.listens.has(s)||this.listens.set(s,new Map),ae(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ae(!this.listens.get(s).has(o),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:e,tag:r};this.listens.get(s).set(o,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const o={p:r},s="q";e.tag&&(o.q=n._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(s,o,a=>{const u=a.d,l=a.s;qi.warnOnListenWarnings_(u,n),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(l,u))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&uo(e,"w")){const r=Nu(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',o=n._path.toString();gr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||w8(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=nS)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=_8(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,i=>{const o=i.s,s=i.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,s))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),ae(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,n)}sendUnlisten_(e,n,r,i){this.log_("Unlisten on "+e+" for "+n);const o={p:e},s="n";i&&(o.q=r,o.t=i),this.sendRequest(s,o)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,i){const o={p:n,d:r};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,s=>{i&&setTimeout(()=>{i(s.s,s.d)},Math.floor(0))})}put(e,n,r,i){this.putInternal("p",e,n,r,i)}merge(e,n,r,i){this.putInternal("m",e,n,r,i)}putInternal(e,n,r,i,o){this.initConnection_();const s={p:n,d:r};o!==void 0&&(s.h=o),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,o=>{this.log_(n+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(o.s,o.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+hn(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):c0("Unrecognized action received from server: "+hn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ae(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Pl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Pl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>vK&&(this.reconnectDelay_=Pl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*gK)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+qi.nextConnectionId_++,o=this.lastSessionId;let s=!1,a=null;const u=function(){a?a.close():(s=!0,r())},l=function(h){ae(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:u,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);s?Sn("getToken() completed but was canceled"):(Sn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,a=new cK(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,d=>{gr(d+" ("+this.repoInfo_.toString()+")"),this.interrupt(yK)},o))}catch(h){this.log_("Failed to get token: "+h),s||(this.repoInfo_.nodeAdmin&&gr(h),u())}}}interrupt(e){Sn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Sn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],$C(this.interruptReasons_)&&(this.reconnectDelay_=Pl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(o=>yw(o)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const r=new pt(e).toString();let i;if(this.listens.has(r)){const o=this.listens.get(r);i=o.get(n),o.delete(n),o.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,n){Sn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=rS&&(this.reconnectDelay_=nS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Sn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=rS&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+JN.replace(/\./g,"-")]=1,PP()?e["framework.cordova"]=1:h8()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=pp.getInstance().currentlyOnline();return $C(this.interruptReasons_)&&e}}qi.nextPersistentConnectionId_=0;qi.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new ze(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new ze(Bu,e),i=new ze(Bu,n);return this.compare(r,i)!==0}minPost(){return ze.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rf;class ID extends wm{static get __EMPTY_NODE(){return Rf}static set __EMPTY_NODE(e){Rf=e}compare(e,n){return Yu(e.name,n.name)}isDefinedOn(e){throw Gu("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return ze.MIN}maxPost(){return new ze(ra,Rf)}makePost(e,n){return ae(typeof e=="string","KeyIndex indexValue must always be a string."),new ze(e,Rf)}toString(){return".key"}}const yu=new ID;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e,n,r,i,o=null){this.isReverse_=i,this.resultGenerator_=o,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=n?r(e.key,n):1,i&&(s*=-1),s<0)this.isReverse_?e=e.left:e=e.right;else if(s===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Zt{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Zt.RED,this.left=i??Qn.EMPTY_NODE,this.right=o??Qn.EMPTY_NODE}copy(e,n,r,i,o){return new Zt(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return o<0?i=i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Qn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,i;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Qn.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Zt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Zt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Zt.RED=!0;Zt.BLACK=!1;class _K{copy(e,n,r,i,o){return this}insert(e,n,r){return new Zt(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Qn{constructor(e,n=Qn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Qn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Zt.BLACK,null,null))}remove(e){return new Qn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Zt.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Af(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Af(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Af(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Af(this.root_,null,this.comparator_,!0,e)}}Qn.EMPTY_NODE=new _K;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wK(t,e){return Yu(t.name,e.name)}function Ew(t,e){return Yu(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f0;function xK(t){f0=t}const RD=function(t){return typeof t=="number"?"number:"+rD(t):"string:"+t},AD=function(t){if(t.isLeafNode()){const e=t.val();ae(typeof e=="string"||typeof e=="number"||typeof e=="object"&&uo(e,".sv"),"Priority must be a string or number.")}else ae(t===f0||t.isEmpty(),"priority of unexpected type.");ae(t===f0||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iS;class Yt{static set __childrenNodeConstructor(e){iS=e}static get __childrenNodeConstructor(){return iS}constructor(e,n=Yt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ae(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),AD(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Yt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Yt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return je(e)?this:We(e)===".priority"?this.priorityNode_:Yt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Yt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=We(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ae(r!==".priority"||is(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Yt.__childrenNodeConstructor.EMPTY_NODE.updateChild(ft(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+RD(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=rD(this.value_):e+=this.value_,this.lazyHash_=eD(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Yt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Yt.__childrenNodeConstructor?-1:(ae(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,i=Yt.VALUE_TYPE_ORDER.indexOf(n),o=Yt.VALUE_TYPE_ORDER.indexOf(r);return ae(i>=0,"Unknown leaf type: "+n),ae(o>=0,"Unknown leaf type: "+r),i===o?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Yt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kD,PD;function bK(t){kD=t}function EK(t){PD=t}class CK extends wm{compare(e,n){const r=e.node.getPriority(),i=n.node.getPriority(),o=r.compareTo(i);return o===0?Yu(e.name,n.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return ze.MIN}maxPost(){return new ze(ra,new Yt("[PRIORITY-POST]",PD))}makePost(e,n){const r=kD(e);return new ze(n,new Yt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Pn=new CK;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SK=Math.log(2);class TK{constructor(e){const n=o=>parseInt(Math.log(o)/SK,10),r=o=>parseInt(Array(o+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const mp=function(t,e,n,r){t.sort(e);const i=function(u,l){const c=l-u;let h,f;if(c===0)return null;if(c===1)return h=t[u],f=n?n(h):h,new Zt(f,h.node,Zt.BLACK,null,null);{const d=parseInt(c/2,10)+u,m=i(u,d),v=i(d+1,l);return h=t[d],f=n?n(h):h,new Zt(f,h.node,Zt.BLACK,m,v)}},o=function(u){let l=null,c=null,h=t.length;const f=function(m,v){const y=h-m,g=h;h-=m;const _=i(y+1,g),w=t[y],x=n?n(w):w;d(new Zt(x,w.node,v,null,_))},d=function(m){l?(l.left=m,l=m):(c=m,l=m)};for(let m=0;m<u.count;++m){const v=u.nextBitIsOne(),y=Math.pow(2,u.count-(m+1));v?f(y,Zt.BLACK):(f(y,Zt.BLACK),f(y,Zt.RED))}return c},s=new TK(t.length),a=o(s);return new Qn(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hv;const Aa={};class ji{static get Default(){return ae(Aa&&Pn,"ChildrenNode.ts has not been loaded"),hv=hv||new ji({".priority":Aa},{".priority":Pn}),hv}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Nu(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Qn?n:null}hasIndex(e){return uo(this.indexSet_,e.toString())}addIndex(e,n){ae(e!==yu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const o=n.getIterator(ze.Wrap);let s=o.getNext();for(;s;)i=i||e.isDefinedOn(s.node),r.push(s),s=o.getNext();let a;i?a=mp(r,e.getCompare()):a=Aa;const u=e.toString(),l={...this.indexSet_};l[u]=e;const c={...this.indexes_};return c[u]=a,new ji(c,l)}addToIndexes(e,n){const r=ep(this.indexes_,(i,o)=>{const s=Nu(this.indexSet_,o);if(ae(s,"Missing index implementation for "+o),i===Aa)if(s.isDefinedOn(e.node)){const a=[],u=n.getIterator(ze.Wrap);let l=u.getNext();for(;l;)l.name!==e.name&&a.push(l),l=u.getNext();return a.push(e),mp(a,s.getCompare())}else return Aa;else{const a=n.get(e.name);let u=i;return a&&(u=u.remove(new ze(e.name,a))),u.insert(e,e.node)}});return new ji(r,this.indexSet_)}removeFromIndexes(e,n){const r=ep(this.indexes_,i=>{if(i===Aa)return i;{const o=n.get(e.name);return o?i.remove(new ze(e.name,o)):i}});return new ji(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nl;class Ye{static get EMPTY_NODE(){return Nl||(Nl=new Ye(new Qn(Ew),null,ji.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&AD(this.priorityNode_),this.children_.isEmpty()&&ae(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Nl}updatePriority(e){return this.children_.isEmpty()?this:new Ye(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Nl:n}}getChild(e){const n=We(e);return n===null?this:this.getImmediateChild(n).getChild(ft(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ae(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new ze(e,n);let i,o;n.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_));const s=i.isEmpty()?Nl:this.priorityNode_;return new Ye(i,s,o)}}updateChild(e,n){const r=We(e);if(r===null)return n;{ae(We(e)!==".priority"||is(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(ft(e),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,i=0,o=!0;if(this.forEachChild(Pn,(s,a)=>{n[s]=a.val(e),r++,o&&Ye.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!e&&o&&i<2*r){const s=[];for(const a in n)s[a]=n[a];return s}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+RD(this.getPriority().val())+":"),this.forEachChild(Pn,(n,r)=>{const i=r.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":eD(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const i=this.resolveIndex_(r);if(i){const o=i.getPredecessorKey(new ze(e,n));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new ze(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new ze(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,ze.Wrap);let o=i.peek();for(;o!=null&&n.compare(o,e)<0;)i.getNext(),o=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,ze.Wrap);let o=i.peek();for(;o!=null&&n.compare(o,e)>0;)i.getNext(),o=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Sh?-1:0}withIndex(e){if(e===yu||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Ye(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===yu||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Pn),i=n.getIterator(Pn);let o=r.getNext(),s=i.getNext();for(;o&&s;){if(o.name!==s.name||!o.node.equals(s.node))return!1;o=r.getNext(),s=i.getNext()}return o===null&&s===null}else return!1;else return!1}}resolveIndex_(e){return e===yu?null:this.indexMap_.get(e.toString())}}Ye.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class IK extends Ye{constructor(){super(new Qn(Ew),Ye.EMPTY_NODE,ji.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ye.EMPTY_NODE}isEmpty(){return!1}}const Sh=new IK;Object.defineProperties(ze,{MIN:{value:new ze(Bu,Ye.EMPTY_NODE)},MAX:{value:new ze(ra,Sh)}});ID.__EMPTY_NODE=Ye.EMPTY_NODE;Yt.__childrenNodeConstructor=Ye;xK(Sh);EK(Sh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RK=!0;function Tn(t,e=null){if(t===null)return Ye.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ae(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Yt(n,Tn(e))}if(!(t instanceof Array)&&RK){const n=[];let r=!1;if(Mr(t,(s,a)=>{if(s.substring(0,1)!=="."){const u=Tn(a);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),n.push(new ze(s,u)))}}),n.length===0)return Ye.EMPTY_NODE;const o=mp(n,wK,s=>s.name,Ew);if(r){const s=mp(n,Pn.getCompare());return new Ye(o,Tn(e),new ji({".priority":s},{".priority":Pn}))}else return new Ye(o,Tn(e),ji.Default)}else{let n=Ye.EMPTY_NODE;return Mr(t,(r,i)=>{if(uo(t,r)&&r.substring(0,1)!=="."){const o=Tn(i);(o.isLeafNode()||!o.isEmpty())&&(n=n.updateImmediateChild(r,o))}}),n.updatePriority(Tn(e))}}bK(Tn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AK extends wm{constructor(e){super(),this.indexPath_=e,ae(!je(e)&&We(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),i=this.extractChild(n.node),o=r.compareTo(i);return o===0?Yu(e.name,n.name):o}makePost(e,n){const r=Tn(e),i=Ye.EMPTY_NODE.updateChild(this.indexPath_,r);return new ze(n,i)}maxPost(){const e=Ye.EMPTY_NODE.updateChild(this.indexPath_,Sh);return new ze(ra,e)}toString(){return ED(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kK extends wm{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Yu(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return ze.MIN}maxPost(){return ze.MAX}makePost(e,n){const r=Tn(e);return new ze(n,r)}toString(){return".value"}}const PK=new kK;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NK(t){return{type:"value",snapshotNode:t}}function DK(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function MK(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function oS(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function FK(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Pn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ae(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ae(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Bu}hasEnd(){return this.endSet_}getIndexEndValue(){return ae(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ae(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ra}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ae(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Pn}copy(){const e=new Cw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function sS(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Pn?n="$priority":t.index_===PK?n="$value":t.index_===yu?n="$key":(ae(t.index_ instanceof AK,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=hn(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=hn(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+hn(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=hn(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+hn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function aS(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Pn&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp extends wD{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ae(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Eh("p:rest:"),this.listens_={}}listen(e,n,r,i){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const s=gp.getListenId_(e,r),a={};this.listens_[s]=a;const u=sS(e._queryParams);this.restRequest_(o+".json",u,(l,c)=>{let h=c;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(o,h,!1,r),Nu(this.listens_,s)===a){let f;l?l===401?f="permission_denied":f="rest_error:"+l:f="ok",i(f,null)}})}unlisten(e,n){const r=gp.getListenId_(e,n);delete this.listens_[r]}get(e){const n=sS(e._queryParams),r=e._path.toString(),i=new $_;return this.restRequest_(r+".json",n,(o,s)=>{let a=s;o===404&&(a=null,o=null),o===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,o])=>{i&&i.accessToken&&(n.auth=i.accessToken),o&&o.token&&(n.ac=o.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+x8(n);this.log_("Sending REST request for "+s);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=Bc(a.responseText)}catch{gr("Failed to parse JSON response for "+s+": "+a.responseText)}r(null,u)}else a.status!==401&&a.status!==404&&gr("Got unsuccessful REST response for "+s+" Status: "+a.status),r(a.status);r=null}},a.open("GET",s,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(){this.rootNode_=Ye.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vp(){return{value:null,children:new Map}}function ND(t,e,n){if(je(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=We(e);t.children.has(r)||t.children.set(r,vp());const i=t.children.get(r);e=ft(e),ND(i,e,n)}}function d0(t,e,n){t.value!==null?n(e,t.value):LK(t,(r,i)=>{const o=new pt(e.toString()+"/"+r);d0(i,o,n)})}function LK(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VK{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&Mr(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uS=10*1e3,BK=30*1e3,jK=5*60*1e3;class UK{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new VK(e);const r=uS+(BK-uS)*Math.random();lc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;Mr(e,(i,o)=>{o>0&&uo(this.statsToReport_,i)&&(n[i]=o,r=!0)}),r&&this.server_.reportStats(n),lc(this.reportStats_.bind(this),Math.floor(Math.random()*2*jK))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mi;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(mi||(mi={}));function DD(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function MD(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function FD(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=mi.ACK_USER_WRITE,this.source=DD()}operationForChild(e){if(je(this.path)){if(this.affectedTree.value!=null)return ae(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new pt(e));return new yp(Ze(),n,this.revert)}}else return ae(We(this.path)===e,"operationForChild called for unrelated child."),new yp(ft(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=mi.OVERWRITE}operationForChild(e){return je(this.path)?new ia(this.source,Ze(),this.snap.getImmediateChild(e)):new ia(this.source,ft(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=mi.MERGE}operationForChild(e){if(je(this.path)){const n=this.children.subtree(new pt(e));return n.isEmpty()?null:n.value?new ia(this.source,Ze(),n.value):new Xc(this.source,Ze(),n)}else return ae(We(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Xc(this.source,ft(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(je(e))return this.isFullyInitialized()&&!this.filtered_;const n=We(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function WK(t,e,n,r){const i=[],o=[];return e.forEach(s=>{s.type==="child_changed"&&t.index_.indexedValueChanged(s.oldSnap,s.snapshotNode)&&o.push(FK(s.childName,s.snapshotNode))}),Dl(t,i,"child_removed",e,r,n),Dl(t,i,"child_added",e,r,n),Dl(t,i,"child_moved",o,r,n),Dl(t,i,"child_changed",e,r,n),Dl(t,i,"value",e,r,n),i}function Dl(t,e,n,r,i,o){const s=r.filter(a=>a.type===n);s.sort((a,u)=>$K(t,a,u)),s.forEach(a=>{const u=zK(t,a,o);i.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(u,t.query_))})})}function zK(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function $K(t,e,n){if(e.childName==null||n.childName==null)throw Gu("Should only compare child_ events.");const r=new ze(e.childName,e.snapshotNode),i=new ze(n.childName,n.snapshotNode);return t.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OD(t,e){return{eventCache:t,serverCache:e}}function cc(t,e,n,r){return OD(new Sw(e,n,r),t.serverCache)}function LD(t,e,n,r){return OD(t.eventCache,new Sw(e,n,r))}function p0(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function oa(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fv;const HK=()=>(fv||(fv=new Qn(Pq)),fv);class ht{static fromObject(e){let n=new ht(null);return Mr(e,(r,i)=>{n=n.set(new pt(r),i)}),n}constructor(e,n=HK()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Ze(),value:this.value};if(je(e))return null;{const r=We(e),i=this.children.get(r);if(i!==null){const o=i.findRootMostMatchingPathAndValue(ft(e),n);return o!=null?{path:tn(new pt(r),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(je(e))return this;{const n=We(e),r=this.children.get(n);return r!==null?r.subtree(ft(e)):new ht(null)}}set(e,n){if(je(e))return new ht(n,this.children);{const r=We(e),o=(this.children.get(r)||new ht(null)).set(ft(e),n),s=this.children.insert(r,o);return new ht(this.value,s)}}remove(e){if(je(e))return this.children.isEmpty()?new ht(null):new ht(null,this.children);{const n=We(e),r=this.children.get(n);if(r){const i=r.remove(ft(e));let o;return i.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,i),this.value===null&&o.isEmpty()?new ht(null):new ht(this.value,o)}else return this}}get(e){if(je(e))return this.value;{const n=We(e),r=this.children.get(n);return r?r.get(ft(e)):null}}setTree(e,n){if(je(e))return n;{const r=We(e),o=(this.children.get(r)||new ht(null)).setTree(ft(e),n);let s;return o.isEmpty()?s=this.children.remove(r):s=this.children.insert(r,o),new ht(this.value,s)}}fold(e){return this.fold_(Ze(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((i,o)=>{r[i]=o.fold_(tn(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Ze(),n)}findOnPath_(e,n,r){const i=this.value?r(n,this.value):!1;if(i)return i;if(je(e))return null;{const o=We(e),s=this.children.get(o);return s?s.findOnPath_(ft(e),tn(n,o),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Ze(),n)}foreachOnPath_(e,n,r){if(je(e))return this;{this.value&&r(n,this.value);const i=We(e),o=this.children.get(i);return o?o.foreachOnPath_(ft(e),tn(n,i),r):new ht(null)}}foreach(e){this.foreach_(Ze(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(tn(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e){this.writeTree_=e}static empty(){return new Qr(new ht(null))}}function hc(t,e,n){if(je(e))return new Qr(new ht(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let o=r.value;const s=kr(i,e);return o=o.updateChild(s,n),new Qr(t.writeTree_.set(i,o))}else{const i=new ht(n),o=t.writeTree_.setTree(e,i);return new Qr(o)}}}function lS(t,e,n){let r=t;return Mr(n,(i,o)=>{r=hc(r,tn(e,i),o)}),r}function cS(t,e){if(je(e))return Qr.empty();{const n=t.writeTree_.setTree(e,new ht(null));return new Qr(n)}}function m0(t,e){return va(t,e)!=null}function va(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(kr(n.path,e)):null}function hS(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Pn,(r,i)=>{e.push(new ze(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new ze(r,i.value))}),e}function qo(t,e){if(je(e))return t;{const n=va(t,e);return n!=null?new Qr(new ht(n)):new Qr(t.writeTree_.subtree(e))}}function g0(t){return t.writeTree_.isEmpty()}function ju(t,e){return VD(Ze(),t.writeTree_,e)}function VD(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,o)=>{i===".priority"?(ae(o.value!==null,"Priority writes must always be leaf nodes"),r=o.value):n=VD(tn(t,i),o,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(tn(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(t,e){return $D(e,t)}function GK(t,e,n,r,i){ae(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=hc(t.visibleWrites,e,n)),t.lastWriteId=r}function qK(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function KK(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ae(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,o=!1,s=t.allWrites.length-1;for(;i&&s>=0;){const a=t.allWrites[s];a.visible&&(s>=n&&XK(a,r.path)?i=!1:qr(r.path,a.path)&&(o=!0)),s--}if(i){if(o)return YK(t),!0;if(r.snap)t.visibleWrites=cS(t.visibleWrites,r.path);else{const a=r.children;Mr(a,u=>{t.visibleWrites=cS(t.visibleWrites,tn(r.path,u))})}return!0}else return!1}function XK(t,e){if(t.snap)return qr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&qr(tn(t.path,n),e))return!0;return!1}function YK(t){t.visibleWrites=jD(t.allWrites,QK,Ze()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function QK(t){return t.visible}function jD(t,e,n){let r=Qr.empty();for(let i=0;i<t.length;++i){const o=t[i];if(e(o)){const s=o.path;let a;if(o.snap)qr(n,s)?(a=kr(n,s),r=hc(r,a,o.snap)):qr(s,n)&&(a=kr(s,n),r=hc(r,Ze(),o.snap.getChild(a)));else if(o.children){if(qr(n,s))a=kr(n,s),r=lS(r,a,o.children);else if(qr(s,n))if(a=kr(s,n),je(a))r=lS(r,Ze(),o.children);else{const u=Nu(o.children,We(a));if(u){const l=u.getChild(ft(a));r=hc(r,Ze(),l)}}}else throw Gu("WriteRecord should have .snap or .children")}}return r}function UD(t,e,n,r,i){if(!r&&!i){const o=va(t.visibleWrites,e);if(o!=null)return o;{const s=qo(t.visibleWrites,e);if(g0(s))return n;if(n==null&&!m0(s,Ze()))return null;{const a=n||Ye.EMPTY_NODE;return ju(s,a)}}}else{const o=qo(t.visibleWrites,e);if(!i&&g0(o))return n;if(!i&&n==null&&!m0(o,Ze()))return null;{const s=function(l){return(l.visible||i)&&(!r||!~r.indexOf(l.writeId))&&(qr(l.path,e)||qr(e,l.path))},a=jD(t.allWrites,s,e),u=n||Ye.EMPTY_NODE;return ju(a,u)}}}function JK(t,e,n){let r=Ye.EMPTY_NODE;const i=va(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Pn,(o,s)=>{r=r.updateImmediateChild(o,s)}),r;if(n){const o=qo(t.visibleWrites,e);return n.forEachChild(Pn,(s,a)=>{const u=ju(qo(o,new pt(s)),a);r=r.updateImmediateChild(s,u)}),hS(o).forEach(s=>{r=r.updateImmediateChild(s.name,s.node)}),r}else{const o=qo(t.visibleWrites,e);return hS(o).forEach(s=>{r=r.updateImmediateChild(s.name,s.node)}),r}}function ZK(t,e,n,r,i){ae(r||i,"Either existingEventSnap or existingServerSnap must exist");const o=tn(e,n);if(m0(t.visibleWrites,o))return null;{const s=qo(t.visibleWrites,o);return g0(s)?i.getChild(n):ju(s,i.getChild(n))}}function eX(t,e,n,r){const i=tn(e,n),o=va(t.visibleWrites,i);if(o!=null)return o;if(r.isCompleteForChild(n)){const s=qo(t.visibleWrites,i);return ju(s,r.getNode().getImmediateChild(n))}else return null}function tX(t,e){return va(t.visibleWrites,e)}function nX(t,e,n,r,i,o,s){let a;const u=qo(t.visibleWrites,e),l=va(u,Ze());if(l!=null)a=l;else if(n!=null)a=ju(u,n);else return[];if(a=a.withIndex(s),!a.isEmpty()&&!a.isLeafNode()){const c=[],h=s.getCompare(),f=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s);let d=f.getNext();for(;d&&c.length<i;)h(d,r)!==0&&c.push(d),d=f.getNext();return c}else return[]}function rX(){return{visibleWrites:Qr.empty(),allWrites:[],lastWriteId:-1}}function v0(t,e,n,r){return UD(t.writeTree,t.treePath,e,n,r)}function WD(t,e){return JK(t.writeTree,t.treePath,e)}function fS(t,e,n,r){return ZK(t.writeTree,t.treePath,e,n,r)}function _p(t,e){return tX(t.writeTree,tn(t.treePath,e))}function iX(t,e,n,r,i,o){return nX(t.writeTree,t.treePath,e,n,r,i,o)}function Tw(t,e,n){return eX(t.writeTree,t.treePath,e,n)}function zD(t,e){return $D(tn(t.treePath,e),t.writeTree)}function $D(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oX{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ae(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ae(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const o=i.type;if(n==="child_added"&&o==="child_removed")this.changeMap.set(r,oS(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&o==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&o==="child_changed")this.changeMap.set(r,MK(r,i.oldSnap));else if(n==="child_changed"&&o==="child_added")this.changeMap.set(r,DK(r,e.snapshotNode));else if(n==="child_changed"&&o==="child_changed")this.changeMap.set(r,oS(r,e.snapshotNode,i.oldSnap));else throw Gu("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sX{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const HD=new sX;class Iw{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Sw(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Tw(this.writes_,e,r)}}getChildAfterChild(e,n,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:oa(this.viewCache_),o=iX(this.writes_,i,n,1,r,e);return o.length===0?null:o[0]}}function aX(t,e){ae(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ae(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function uX(t,e,n,r,i){const o=new oX;let s,a;if(n.type===mi.OVERWRITE){const l=n;l.source.fromUser?s=y0(t,e,l.path,l.snap,r,i,o):(ae(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!je(l.path),s=wp(t,e,l.path,l.snap,r,i,a,o))}else if(n.type===mi.MERGE){const l=n;l.source.fromUser?s=cX(t,e,l.path,l.children,r,i,o):(ae(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),s=_0(t,e,l.path,l.children,r,i,a,o))}else if(n.type===mi.ACK_USER_WRITE){const l=n;l.revert?s=dX(t,e,l.path,r,i,o):s=hX(t,e,l.path,l.affectedTree,r,i,o)}else if(n.type===mi.LISTEN_COMPLETE)s=fX(t,e,n.path,r,o);else throw Gu("Unknown operation type: "+n.type);const u=o.getChanges();return lX(e,s,u),{viewCache:s,changes:u}}function lX(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=p0(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(NK(p0(e)))}}function GD(t,e,n,r,i,o){const s=e.eventCache;if(_p(r,n)!=null)return e;{let a,u;if(je(n))if(ae(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=oa(e),c=l instanceof Ye?l:Ye.EMPTY_NODE,h=WD(r,c);a=t.filter.updateFullNode(e.eventCache.getNode(),h,o)}else{const l=v0(r,oa(e));a=t.filter.updateFullNode(e.eventCache.getNode(),l,o)}else{const l=We(n);if(l===".priority"){ae(is(n)===1,"Can't have a priority with additional path components");const c=s.getNode();u=e.serverCache.getNode();const h=fS(r,n,c,u);h!=null?a=t.filter.updatePriority(c,h):a=s.getNode()}else{const c=ft(n);let h;if(s.isCompleteForChild(l)){u=e.serverCache.getNode();const f=fS(r,n,s.getNode(),u);f!=null?h=s.getNode().getImmediateChild(l).updateChild(c,f):h=s.getNode().getImmediateChild(l)}else h=Tw(r,l,e.serverCache);h!=null?a=t.filter.updateChild(s.getNode(),l,h,c,i,o):a=s.getNode()}}return cc(e,a,s.isFullyInitialized()||je(n),t.filter.filtersNodes())}}function wp(t,e,n,r,i,o,s,a){const u=e.serverCache;let l;const c=s?t.filter:t.filter.getIndexedFilter();if(je(n))l=c.updateFullNode(u.getNode(),r,null);else if(c.filtersNodes()&&!u.isFiltered()){const d=u.getNode().updateChild(n,r);l=c.updateFullNode(u.getNode(),d,null)}else{const d=We(n);if(!u.isCompleteForPath(n)&&is(n)>1)return e;const m=ft(n),y=u.getNode().getImmediateChild(d).updateChild(m,r);d===".priority"?l=c.updatePriority(u.getNode(),y):l=c.updateChild(u.getNode(),d,y,m,HD,null)}const h=LD(e,l,u.isFullyInitialized()||je(n),c.filtersNodes()),f=new Iw(i,h,o);return GD(t,h,n,i,f,a)}function y0(t,e,n,r,i,o,s){const a=e.eventCache;let u,l;const c=new Iw(i,e,o);if(je(n))l=t.filter.updateFullNode(e.eventCache.getNode(),r,s),u=cc(e,l,!0,t.filter.filtersNodes());else{const h=We(n);if(h===".priority")l=t.filter.updatePriority(e.eventCache.getNode(),r),u=cc(e,l,a.isFullyInitialized(),a.isFiltered());else{const f=ft(n),d=a.getNode().getImmediateChild(h);let m;if(je(f))m=r;else{const v=c.getCompleteChild(h);v!=null?bD(f)===".priority"&&v.getChild(CD(f)).isEmpty()?m=v:m=v.updateChild(f,r):m=Ye.EMPTY_NODE}if(d.equals(m))u=e;else{const v=t.filter.updateChild(a.getNode(),h,m,f,c,s);u=cc(e,v,a.isFullyInitialized(),t.filter.filtersNodes())}}}return u}function dS(t,e){return t.eventCache.isCompleteForChild(e)}function cX(t,e,n,r,i,o,s){let a=e;return r.foreach((u,l)=>{const c=tn(n,u);dS(e,We(c))&&(a=y0(t,a,c,l,i,o,s))}),r.foreach((u,l)=>{const c=tn(n,u);dS(e,We(c))||(a=y0(t,a,c,l,i,o,s))}),a}function pS(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function _0(t,e,n,r,i,o,s,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,l;je(n)?l=r:l=new ht(null).setTree(n,r);const c=e.serverCache.getNode();return l.children.inorderTraversal((h,f)=>{if(c.hasChild(h)){const d=e.serverCache.getNode().getImmediateChild(h),m=pS(t,d,f);u=wp(t,u,new pt(h),m,i,o,s,a)}}),l.children.inorderTraversal((h,f)=>{const d=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!c.hasChild(h)&&!d){const m=e.serverCache.getNode().getImmediateChild(h),v=pS(t,m,f);u=wp(t,u,new pt(h),v,i,o,s,a)}}),u}function hX(t,e,n,r,i,o,s){if(_p(i,n)!=null)return e;const a=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(je(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return wp(t,e,n,u.getNode().getChild(n),i,o,a,s);if(je(n)){let l=new ht(null);return u.getNode().forEachChild(yu,(c,h)=>{l=l.set(new pt(c),h)}),_0(t,e,n,l,i,o,a,s)}else return e}else{let l=new ht(null);return r.foreach((c,h)=>{const f=tn(n,c);u.isCompleteForPath(f)&&(l=l.set(c,u.getNode().getChild(f)))}),_0(t,e,n,l,i,o,a,s)}}function fX(t,e,n,r,i){const o=e.serverCache,s=LD(e,o.getNode(),o.isFullyInitialized()||je(n),o.isFiltered());return GD(t,s,n,r,HD,i)}function dX(t,e,n,r,i,o){let s;if(_p(r,n)!=null)return e;{const a=new Iw(r,e,i),u=e.eventCache.getNode();let l;if(je(n)||We(n)===".priority"){let c;if(e.serverCache.isFullyInitialized())c=v0(r,oa(e));else{const h=e.serverCache.getNode();ae(h instanceof Ye,"serverChildren would be complete if leaf node"),c=WD(r,h)}c=c,l=t.filter.updateFullNode(u,c,o)}else{const c=We(n);let h=Tw(r,c,e.serverCache);h==null&&e.serverCache.isCompleteForChild(c)&&(h=u.getImmediateChild(c)),h!=null?l=t.filter.updateChild(u,c,h,ft(n),a,o):e.eventCache.getNode().hasChild(c)?l=t.filter.updateChild(u,c,Ye.EMPTY_NODE,ft(n),a,o):l=u,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(s=v0(r,oa(e)),s.isLeafNode()&&(l=t.filter.updateFullNode(l,s,o)))}return s=e.serverCache.isFullyInitialized()||_p(r,Ze())!=null,cc(e,l,s,t.filter.filtersNodes())}}function pX(t,e){const n=oa(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!je(e)&&!n.getImmediateChild(We(e)).isEmpty())?n.getChild(e):null}function mS(t,e,n,r){e.type===mi.MERGE&&e.source.queryId!==null&&(ae(oa(t.viewCache_),"We should always have a full cache before handling merges"),ae(p0(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,o=uX(t.processor_,i,e,n,r);return aX(t.processor_,o.viewCache),ae(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=o.viewCache,mX(t,o.changes,o.viewCache.eventCache.getNode())}function mX(t,e,n,r){const i=t.eventRegistrations_;return WK(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gS;function gX(t){ae(!gS,"__referenceConstructor has already been defined"),gS=t}function Rw(t,e,n,r){const i=e.source.queryId;if(i!==null){const o=t.views.get(i);return ae(o!=null,"SyncTree gave us an op for an invalid query."),mS(o,e,n,r)}else{let o=[];for(const s of t.views.values())o=o.concat(mS(s,e,n,r));return o}}function Aw(t,e){let n=null;for(const r of t.views.values())n=n||pX(r,e);return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vS;function vX(t){ae(!vS,"__referenceConstructor has already been defined"),vS=t}class yS{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ht(null),this.pendingWriteTree_=rX(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function yX(t,e,n,r,i){return GK(t.pendingWriteTree_,e,n,r,i),i?bm(t,new ia(DD(),e,n)):[]}function Za(t,e,n=!1){const r=qK(t.pendingWriteTree_,e);if(KK(t.pendingWriteTree_,e)){let o=new ht(null);return r.snap!=null?o=o.set(Ze(),!0):Mr(r.children,s=>{o=o.set(new pt(s),!0)}),bm(t,new yp(r.path,o,n))}else return[]}function xm(t,e,n){return bm(t,new ia(MD(),e,n))}function _X(t,e,n){const r=ht.fromObject(n);return bm(t,new Xc(MD(),e,r))}function wX(t,e,n,r){const i=YD(t,r);if(i!=null){const o=QD(i),s=o.path,a=o.queryId,u=kr(s,e),l=new ia(FD(a),u,n);return JD(t,s,l)}else return[]}function xX(t,e,n,r){const i=YD(t,r);if(i){const o=QD(i),s=o.path,a=o.queryId,u=kr(s,e),l=ht.fromObject(n),c=new Xc(FD(a),u,l);return JD(t,s,c)}else return[]}function qD(t,e,n){const i=t.pendingWriteTree_,o=t.syncPointTree_.findOnPath(e,(s,a)=>{const u=kr(s,e),l=Aw(a,u);if(l)return l});return UD(i,e,o,n,!0)}function bm(t,e){return KD(e,t.syncPointTree_,null,BD(t.pendingWriteTree_,Ze()))}function KD(t,e,n,r){if(je(t.path))return XD(t,e,n,r);{const i=e.get(Ze());n==null&&i!=null&&(n=Aw(i,Ze()));let o=[];const s=We(t.path),a=t.operationForChild(s),u=e.children.get(s);if(u&&a){const l=n?n.getImmediateChild(s):null,c=zD(r,s);o=o.concat(KD(a,u,l,c))}return i&&(o=o.concat(Rw(i,t,r,n))),o}}function XD(t,e,n,r){const i=e.get(Ze());n==null&&i!=null&&(n=Aw(i,Ze()));let o=[];return e.children.inorderTraversal((s,a)=>{const u=n?n.getImmediateChild(s):null,l=zD(r,s),c=t.operationForChild(s);c&&(o=o.concat(XD(c,a,u,l)))}),i&&(o=o.concat(Rw(i,t,r,n))),o}function YD(t,e){return t.tagToQueryMap.get(e)}function QD(t){const e=t.indexOf("$");return ae(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new pt(t.substr(0,e))}}function JD(t,e,n){const r=t.syncPointTree_.get(e);ae(r,"Missing sync point for query tag that we're tracking");const i=BD(t.pendingWriteTree_,e);return Rw(r,n,i,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new kw(n)}node(){return this.node_}}class Pw{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=tn(this.path_,e);return new Pw(this.syncTree_,n)}node(){return qD(this.syncTree_,this.path_)}}const bX=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},_S=function(t,e,n){if(!t||typeof t!="object")return t;if(ae(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return EX(t[".sv"],e,n);if(typeof t[".sv"]=="object")return CX(t[".sv"],e);ae(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},EX=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ae(!1,"Unexpected server value: "+t)}},CX=function(t,e,n){t.hasOwnProperty("increment")||ae(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ae(!1,"Unexpected increment value: "+r);const i=e.node();if(ae(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return typeof s!="number"?r:s+r},SX=function(t,e,n,r){return Nw(e,new Pw(n,t),r)},TX=function(t,e,n){return Nw(t,new kw(e),n)};function Nw(t,e,n){const r=t.getPriority().val(),i=_S(r,e.getImmediateChild(".priority"),n);let o;if(t.isLeafNode()){const s=t,a=_S(s.getValue(),e,n);return a!==s.getValue()||i!==s.getPriority().val()?new Yt(a,Tn(i)):t}else{const s=t;return o=s,i!==s.getPriority().val()&&(o=o.updatePriority(new Yt(i))),s.forEachChild(Pn,(a,u)=>{const l=Nw(u,e.getImmediateChild(a),n);l!==u&&(o=o.updateImmediateChild(a,l))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function Mw(t,e){let n=e instanceof pt?e:new pt(e),r=t,i=We(n);for(;i!==null;){const o=Nu(r.node.children,i)||{children:{},childCount:0};r=new Dw(i,r,o),n=ft(n),i=We(n)}return r}function Qu(t){return t.node.value}function ZD(t,e){t.node.value=e,w0(t)}function eM(t){return t.node.childCount>0}function IX(t){return Qu(t)===void 0&&!eM(t)}function Em(t,e){Mr(t.node.children,(n,r)=>{e(new Dw(n,t,r))})}function tM(t,e,n,r){n&&e(t),Em(t,i=>{tM(i,e,!0)})}function RX(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Th(t){return new pt(t.parent===null?t.name:Th(t.parent)+"/"+t.name)}function w0(t){t.parent!==null&&AX(t.parent,t.name,t)}function AX(t,e,n){const r=IX(n),i=uo(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,w0(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,w0(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kX=/[\[\].#$\/\u0000-\u001F\u007F]/,PX=/[\[\].#$\u0000-\u001F\u007F]/,dv=10*1024*1024,nM=function(t){return typeof t=="string"&&t.length!==0&&!kX.test(t)},NX=function(t){return typeof t=="string"&&t.length!==0&&!PX.test(t)},DX=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),NX(t)},rM=function(t,e,n){const r=n instanceof pt?new fK(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+As(r));if(typeof e=="function")throw new Error(t+"contains a function "+As(r)+" with contents = "+e.toString());if(tD(e))throw new Error(t+"contains "+e.toString()+" "+As(r));if(typeof e=="string"&&e.length>dv/3&&um(e)>dv)throw new Error(t+"contains a string greater than "+dv+" utf8 bytes "+As(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,o=!1;if(Mr(e,(s,a)=>{if(s===".value")i=!0;else if(s!==".priority"&&s!==".sv"&&(o=!0,!nM(s)))throw new Error(t+" contains an invalid key ("+s+") "+As(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);dK(r,s),rM(t,a,r),pK(r)}),i&&o)throw new Error(t+' contains ".value" child '+As(r)+" in addition to actual children.")}},MX=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!nM(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!DX(n))throw new Error(E8(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FX{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function OX(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],o=i.getPath();n!==null&&!SD(o,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:o}),n.events.push(i)}n&&t.eventLists_.push(n)}function ya(t,e,n){OX(t,n),LX(t,r=>qr(r,e)||qr(e,r))}function LX(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){const o=i.path;e(o)?(VX(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function VX(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();uc&&Sn("event: "+n.toString()),Ch(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BX="repo_interrupt",jX=25;class UX{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new FX,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=vp(),this.transactionQueueTree_=new Dw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function WX(t,e,n){if(t.stats_=ww(t.repoInfo_),t.forceRestClient_||Lq())t.server_=new gp(t.repoInfo_,(r,i,o,s)=>{wS(t,r,i,o,s)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>xS(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{hn(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new qi(t.repoInfo_,e,(r,i,o,s)=>{wS(t,r,i,o,s)},r=>{xS(t,r)},r=>{$X(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=Wq(t.repoInfo_,()=>new UK(t.stats_,t.server_)),t.infoData_=new OK,t.infoSyncTree_=new yS({startListening:(r,i,o,s)=>{let a=[];const u=t.infoData_.getNode(r._path);return u.isEmpty()||(a=xm(t.infoSyncTree_,r._path,u),setTimeout(()=>{s("ok")},0)),a},stopListening:()=>{}}),Fw(t,"connected",!1),t.serverSyncTree_=new yS({startListening:(r,i,o,s)=>(t.server_.listen(r,o,i,(a,u)=>{const l=s(a,u);ya(t.eventQueue_,r._path,l)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function zX(t){const n=t.infoData_.getNode(new pt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function iM(t){return bX({timestamp:zX(t)})}function wS(t,e,n,r,i){t.dataUpdateCount++;const o=new pt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let s=[];if(i)if(r){const u=ep(n,l=>Tn(l));s=xX(t.serverSyncTree_,o,u,i)}else{const u=Tn(n);s=wX(t.serverSyncTree_,o,u,i)}else if(r){const u=ep(n,l=>Tn(l));s=_X(t.serverSyncTree_,o,u)}else{const u=Tn(n);s=xm(t.serverSyncTree_,o,u)}let a=o;s.length>0&&(a=Lw(t,o)),ya(t.eventQueue_,a,s)}function xS(t,e){Fw(t,"connected",e),e===!1&&GX(t)}function $X(t,e){Mr(e,(n,r)=>{Fw(t,n,r)})}function Fw(t,e,n){const r=new pt("/.info/"+e),i=Tn(n);t.infoData_.updateSnapshot(r,i);const o=xm(t.infoSyncTree_,r,i);ya(t.eventQueue_,r,o)}function HX(t){return t.nextWriteId_++}function GX(t){oM(t,"onDisconnectEvents");const e=iM(t),n=vp();d0(t.onDisconnect_,Ze(),(i,o)=>{const s=SX(i,o,t.serverSyncTree_,e);ND(n,i,s)});let r=[];d0(n,Ze(),(i,o)=>{r=r.concat(xm(t.serverSyncTree_,i,o));const s=YX(t,i);Lw(t,s)}),t.onDisconnect_=vp(),ya(t.eventQueue_,Ze(),r)}function qX(t){t.persistentConnection_&&t.persistentConnection_.interrupt(BX)}function oM(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Sn(n,...e)}function sM(t,e,n){return qD(t.serverSyncTree_,e,n)||Ye.EMPTY_NODE}function Ow(t,e=t.transactionQueueTree_){if(e||Cm(t,e),Qu(e)){const n=uM(t,e);ae(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&KX(t,Th(e),n)}else eM(e)&&Em(e,n=>{Ow(t,n)})}function KX(t,e,n){const r=n.map(l=>l.currentWriteId),i=sM(t,e,r);let o=i;const s=i.hash();for(let l=0;l<n.length;l++){const c=n[l];ae(c.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=1,c.retryCount++;const h=kr(e,c.path);o=o.updateChild(h,c.currentOutputSnapshotRaw)}const a=o.val(!0),u=e;t.server_.put(u.toString(),a,l=>{oM(t,"transaction put response",{path:u.toString(),status:l});let c=[];if(l==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,c=c.concat(Za(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Cm(t,Mw(t.transactionQueueTree_,e)),Ow(t,t.transactionQueueTree_),ya(t.eventQueue_,e,c);for(let f=0;f<h.length;f++)Ch(h[f])}else{if(l==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{gr("transaction at "+u.toString()+" failed: "+l);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=l}Lw(t,e)}},s)}function Lw(t,e){const n=aM(t,e),r=Th(n),i=uM(t,n);return XX(t,i,r),r}function XX(t,e,n){if(e.length===0)return;const r=[];let i=[];const s=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const u=e[a],l=kr(n,u.path);let c=!1,h;if(ae(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)c=!0,h=u.abortReason,i=i.concat(Za(t.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=jX)c=!0,h="maxretry",i=i.concat(Za(t.serverSyncTree_,u.currentWriteId,!0));else{const f=sM(t,u.path,s);u.currentInputSnapshot=f;const d=e[a].update(f.val());if(d!==void 0){rM("transaction failed: Data returned ",d,u.path);let m=Tn(d);typeof d=="object"&&d!=null&&uo(d,".priority")||(m=m.updatePriority(f.getPriority()));const y=u.currentWriteId,g=iM(t),_=TX(m,f,g);u.currentOutputSnapshotRaw=m,u.currentOutputSnapshotResolved=_,u.currentWriteId=HX(t),s.splice(s.indexOf(y),1),i=i.concat(yX(t.serverSyncTree_,u.path,_,u.currentWriteId,u.applyLocally)),i=i.concat(Za(t.serverSyncTree_,y,!0))}else c=!0,h="nodata",i=i.concat(Za(t.serverSyncTree_,u.currentWriteId,!0))}ya(t.eventQueue_,n,i),i=[],c&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(h),!1,null))))}Cm(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)Ch(r[a]);Ow(t,t.transactionQueueTree_)}function aM(t,e){let n,r=t.transactionQueueTree_;for(n=We(e);n!==null&&Qu(r)===void 0;)r=Mw(r,n),e=ft(e),n=We(e);return r}function uM(t,e){const n=[];return lM(t,e,n),n.sort((r,i)=>r.order-i.order),n}function lM(t,e,n){const r=Qu(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Em(e,i=>{lM(t,i,n)})}function Cm(t,e){const n=Qu(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,ZD(e,n.length>0?n:void 0)}Em(e,r=>{Cm(t,r)})}function YX(t,e){const n=Th(aM(t,e)),r=Mw(t.transactionQueueTree_,e);return RX(r,i=>{pv(t,i)}),pv(t,r),tM(r,i=>{pv(t,i)}),n}function pv(t,e){const n=Qu(e);if(n){const r=[];let i=[],o=-1;for(let s=0;s<n.length;s++)n[s].status===3||(n[s].status===1?(ae(o===s-1,"All SENT items should be at beginning of queue."),o=s,n[s].status=3,n[s].abortReason="set"):(ae(n[s].status===0,"Unexpected transaction status in abort"),n[s].unwatcher(),i=i.concat(Za(t.serverSyncTree_,n[s].currentWriteId,!0)),n[s].onComplete&&r.push(n[s].onComplete.bind(null,new Error("set"),!1,null))));o===-1?ZD(e,void 0):n.length=o+1,ya(t.eventQueue_,Th(e),i);for(let s=0;s<r.length;s++)Ch(r[s])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QX(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function JX(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):gr(`Invalid query segment '${n}' in query '${t}'`)}return e}const bS=function(t,e){const n=ZX(t),r=n.namespace;n.domain==="firebase.com"&&eo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&eo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Aq();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new dD(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new pt(n.pathString)}},ZX=function(t){let e="",n="",r="",i="",o="",s=!0,a="https",u=443;if(typeof t=="string"){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let c=t.indexOf("/");c===-1&&(c=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=QX(t.substring(c,h)));const f=JX(t.substring(Math.min(t.length,h)));l=e.indexOf(":"),l>=0?(s=a==="https"||a==="wss",u=parseInt(e.substring(l+1),10)):l=e.length;const d=e.slice(0,l);if(d.toLowerCase()==="localhost")n="localhost";else if(d.split(".").length<=2)n=d;else{const m=e.indexOf(".");r=e.substring(0,m).toLowerCase(),n=e.substring(m+1),o=r}"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return je(this._path)?null:bD(this._path)}get ref(){return new Ju(this._repo,this._path)}get _queryIdentifier(){const e=aS(this._queryParams),n=yw(e);return n==="{}"?"default":n}get _queryObject(){return aS(this._queryParams)}isEqual(e){if(e=Js(e),!(e instanceof Vw))return!1;const n=this._repo===e._repo,r=SD(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+hK(this._path)}}class Ju extends Vw{constructor(e,n){super(e,n,new Cw,!1)}get parent(){const e=CD(this._path);return e===null?null:new Ju(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}gX(Ju);vX(Ju);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eY="FIREBASE_DATABASE_EMULATOR_HOST",x0={};let tY=!1;function nY(t,e,n,r){const i=e.lastIndexOf(":"),o=e.substring(0,i),s=mh(o);t.repoInfo_=new dD(e,s,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function rY(t,e,n,r,i){let o=r||t.options.databaseURL;o===void 0&&(t.options.projectId||eo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Sn("Using default host for project ",t.options.projectId),o=`${t.options.projectId}-default-rtdb.firebaseio.com`);let s=bS(o,i),a=s.repoInfo,u;typeof process<"u"&&W2&&(u=W2[eY]),u?(o=`http://${u}?ns=${a.namespace}`,s=bS(o,i),a=s.repoInfo):s.repoInfo.secure;const l=new Bq(t.name,t.options,e);MX("Invalid Firebase Database URL",s),je(s.path)||eo("Database URL must point to the root of a Firebase Database (not including a child path).");const c=oY(a,t,l,new Vq(t,n));return new sY(c,t)}function iY(t,e){const n=x0[e];(!n||n[t.key]!==t)&&eo(`Database ${e}(${t.repoInfo_}) has already been deleted.`),qX(t),delete n[t.key]}function oY(t,e,n,r){let i=x0[e.name];i||(i={},x0[e.name]=i);let o=i[t.toURLString()];return o&&eo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new UX(t,tY,n,r),i[t.toURLString()]=o,o}class sY{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(WX(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ju(this._repo,Ze())),this._rootInternal}_delete(){return this._rootInternal!==null&&(iY(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&eo("Cannot call "+e+" on a deleted database.")}}function aY(t=jP(),e){const n=OP(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=SP("database");r&&uY(n,...r)}return n}function uY(t,e,n,r={}){t=Js(t),t._checkNotDeleted("useEmulator");const i=`${e}:${n}`,o=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&jc(r,o.repoInfo_.emulatorOptions))return;eo("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let s;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&eo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Yf(Yf.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:RP(r.mockUserToken,t.app.options.projectId);s=new Yf(a)}mh(e)&&(IP(e),AP("Database",!0)),nY(o,i,r,s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lY(t){Eq(VP),Uc(new Du("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return rY(r,i,o,n)},"PUBLIC").setMultipleInstances(!0)),$o(z2,$2,t),$o(z2,$2,"esm2020")}qi.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};qi.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};lY();const cM=BP(X$),Sm=uq(cM);aY(cM);const hM=async(t,e,n)=>{try{await _m(ym(Sm,"heatmap"),{x:t,y:e,page:n,timestamp:QN()})}catch(r){console.error("Error recording heatmap:",r)}},cY=async t=>{try{await _m(ym(Sm,"sessions"),{...t,timestamp:QN()})}catch(e){console.error("Error saving session:",e)}},xp=async(t,e,n={})=>{try{await _m(ym(Sm,"conversion_funnel"),{step:t,sessionId:e,timestamp:new Date,...n}),console.log(` Logged conversion step: ${t}`)}catch(r){console.error(" Error logging conversion step:",r)}},hY=async(t,e,n)=>{try{await _m(ym(Sm,"page_transitions"),{sessionId:t,from:e,to:n,timestamp:new Date}),console.log(` Logged page transition: ${e}  ${n}`)}catch(r){console.error(" Error logging page transition:",r)}},fY=({onDetected:t})=>{const e=Y.useRef(null),n=Y.useRef(null),[r,i]=Y.useState(!0),[o,s]=Y.useState(!1),[a,u]=Y.useState(null),[l,c]=Y.useState(0),[h,f]=Y.useState(""),[d,m]=Y.useState(0),[v,y]=Y.useState(!0),[g,_]=Y.useState(!1),[w,x]=Y.useState(0),[S,A]=Y.useState(null),[T,E]=Y.useState(null),[C,I]=Y.useState(!1),[P,N]=Y.useState(!1),k=Y.useRef(null);Y.useEffect(()=>(g&&j().then(()=>{setTimeout(()=>{X()},1e3)}),()=>{e.current&&e.current.srcObject&&e.current.srcObject.getTracks().forEach(U=>U.stop()),k.current&&clearInterval(k.current)}),[g]);const j=async()=>{try{console.log(" Starting to load Face-API models...");const U="/models";console.log(" Loading tinyFaceDetector from:",U),await Vn.tinyFaceDetector.loadFromUri(U),console.log(" tinyFaceDetector loaded"),console.log(" Loading ageGenderNet from:",U),await Vn.ageGenderNet.loadFromUri(U),console.log(" ageGenderNet loaded"),console.log(" Loading faceExpressionNet from:",U),await Vn.faceExpressionNet.loadFromUri(U),console.log(" faceExpressionNet loaded"),console.log(" Starting video..."),await W(),console.log(" Models loaded successfully"),i(!1)}catch(U){console.error(" Error loading models:",U),console.error("Error details:",U.message),alert(`  AI models 
 model  /public/models/

Error: ${U.message}`),i(!1)}},W=async()=>{try{console.log(" Requesting camera access...");const U=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"}});e.current&&(e.current.srcObject=U,console.log(" Camera started"))}catch(U){console.error(" Error accessing camera:",U),console.error("Camera error code:",U.name),alert(` :
${U.message}`)}},q=()=>{u(null),s(!1),c(0),f(""),x(0),m(0),A(null),n.current&&n.current.getContext("2d").clearRect(0,0,n.current.width,n.current.height)},X=async()=>{if(o||!e.current){console.warn(" detectFace: isDetecting="+o+", videoRef="+(e.current?"ready":"null"));return}if(e.current.readyState!==e.current.HAVE_ENOUGH_DATA){console.warn(" Video not ready, readyState:",e.current.readyState),f(" ..."),setTimeout(()=>X(),500);return}s(!0),c(0),f("");try{console.log(" Starting face detection..."),f(" ..."),c(20);const U=await q$(e.current,new dP({inputSize:416,scoreThreshold:.3})).withAgeAndGender().withFaceExpressions();if(!U){console.log(" No face detected, retrying..."),f("  ..."),s(!1),setTimeout(()=>{X()},1e3);return}console.log(" Face detected:",U);const Q=e.current,te=document.createElement("canvas");te.width=200,te.height=200,te.getContext("2d").drawImage(Q,0,0,200,200);const we=te.toDataURL("image/jpeg",.8);A(we),f(" ..."),c(60),await new Promise(Ee=>setTimeout(Ee,1e3));const _e=Math.round(U.age),ce=U.gender,be=U.expressions;f(" "),c(90),await new Promise(Ee=>setTimeout(Ee,500));const xe=V(_e,ce,be),Se=Object.keys(be).reduce((Ee,Le)=>be[Ee]>be[Le]?Ee:Le);E(Se),c(100),f(" "),await new Promise(Ee=>setTimeout(Ee,400));const qe={age:_e,gender:ce,expressions:be,interests:xe,emotion:Se};await xp("scanned",sessionStorage.getItem("sessionId")||"temp-session",{age:_e,gender:ce,emotion:Se}),u(qe),hM(0,0,"face-scan"),_e<13?(I(!0),x(0)):(setTimeout(()=>x(1),1e3),setTimeout(()=>x(2),3e3),setTimeout(()=>x(3),5500),setTimeout(()=>{x(4),t&&t(xe)},8e3))}catch(U){console.error("Error detecting face:",U)}s(!1)},V=(U,Q,te)=>{const ie=[];switch(U<=16?ie.push("co","it","dt"):U<=18?ie.push("ev","it","mk"):U<=20?ie.push("ac","mk","au"):ie.push("au","ep","ac"),Q==="male"?ie.push("au","ev","ep","el","co","ct","it"):ie.push("ac","mk","dt","hm","tg","it","co"),Object.keys(te).reduce((xe,Se)=>te[xe]>te[Se]?xe:Se)){case"happy":ie.push("hm","tg","mk","dt");break;case"neutral":ie.push("ep","el","ac","au","co");break;case"surprised":ie.push("it","dt","co","ev","ar");break;case"sad":ie.push("ar","ct","el","ep");break;default:ie.push("co","au","ac","mk")}const _e={};ie.forEach(xe=>{_e[xe]=(_e[xe]||0)+1});const ce=Object.entries(_e).sort((xe,Se)=>Se[1]-xe[1]).slice(0,3).map(([xe])=>xe),be=["au","ev","ep","el","co","ar","ct","it","ac","mk","dt","tg","hm"];for(;ce.length<3;){const xe=be[Math.floor(Math.random()*be.length)];ce.includes(xe)||ce.push(xe)}return ce},z=U=>{switch(Object.keys(U).reduce((te,ie)=>U[te]>U[ie]?te:ie)){case"happy":return"  ";case"neutral":return"  ";case"surprised":return"  ";default:return"  "}};return D.jsxs("div",{className:"face-detection-container",children:[v&&!g&&D.jsxs(de.div,{className:"consent-card",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:[D.jsxs("div",{className:"consent-header",children:[D.jsx("div",{className:"consent-icon",children:""}),D.jsx("h2",{className:"consent-title",children:"Privacy & Data Protection"}),D.jsx("p",{className:"consent-subtitle",children:"PDPA Compliance Notice"})]}),D.jsxs("div",{className:"consent-body",children:[D.jsx("p",{className:"consent-text",children:D.jsx("strong",{children:"We will use the following data:"})}),D.jsxs("ul",{className:"consent-list",children:[D.jsx("li",{className:"consent-item",children:"Facial scan for age and gender detection"}),D.jsx("li",{className:"consent-item",children:"Facial expression analysis"}),D.jsx("li",{className:"consent-item",children:"Temporary video recording during scan"})]}),D.jsx("p",{className:"consent-text",children:D.jsx("strong",{children:"We do NOT:"})}),D.jsxs("ul",{className:"consent-list",children:[D.jsx("li",{className:"consent-item",children:"Store your personal data"}),D.jsx("li",{className:"consent-item",children:"Use microphone or record audio"}),D.jsx("li",{className:"consent-item",children:"Share information with third parties"})]}),D.jsx("p",{className:"consent-text",children:"By accepting, you consent to temporary facial analysis for career recommendations."})]}),D.jsxs("div",{className:"consent-actions",children:[D.jsx("button",{className:"btn btn-decline",onClick:()=>{y(!1),t&&t({skipScan:!0,goToInfo:!0})},children:"Decline"}),D.jsx("button",{className:"btn btn-accept",onClick:()=>{_(!0),y(!1)},children:"Accept & Proceed"})]})]}),C&&a&&a.age<13&&D.jsx(de.div,{className:"parental-consent-modal",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:D.jsxs("div",{className:"parental-consent-card",children:[D.jsxs("div",{className:"parental-header",children:[D.jsx("div",{className:"parental-icon",children:""}),D.jsx("h2",{className:"parental-title",children:"Parent/Guardian Permission Required"}),D.jsx("p",{className:"parental-subtitle",children:"This feature requires parental consent"})]}),D.jsxs("div",{className:"parental-body",children:[D.jsxs("div",{className:"child-info",children:[D.jsx("h3",{children:"Detected Information:"}),D.jsxs("p",{children:[D.jsx("strong",{children:"Age:"})," ",a.age," years old"]}),D.jsxs("p",{children:[D.jsx("strong",{children:"Gender:"})," ",a.gender==="male"?"Male":"Female"]}),D.jsxs("p",{children:[D.jsx("strong",{children:"Mood:"})," ",z(a.expressions)]})]}),D.jsxs("div",{className:"parental-notice",children:[D.jsx("p",{children:D.jsx("strong",{children:" What We Will Do:"})}),D.jsxs("ul",{children:[D.jsx("li",{children:"Show age-appropriate career recommendations"}),D.jsx("li",{children:"Track engagement with interactive content"}),D.jsx("li",{children:"Display gamified learning interface"})]})]}),D.jsxs("div",{className:"parental-privacy",children:[D.jsx("p",{children:D.jsx("strong",{children:" Privacy Assurance:"})}),D.jsxs("ul",{children:[D.jsx("li",{children:"No personal data is permanently stored"}),D.jsx("li",{children:"Face image deleted after analysis"}),D.jsx("li",{children:"No external data sharing"}),D.jsx("li",{children:"PDPA compliant"})]})]}),D.jsxs("label",{className:"parental-checkbox",children:[D.jsx("input",{type:"checkbox",onChange:U=>{U.target.checked&&N(!0)}}),D.jsx("span",{children:"I am the parent/guardian and I consent to this experience"})]})]}),D.jsxs("div",{className:"parental-actions",children:[D.jsx("button",{className:"btn btn-decline",onClick:()=>{I(!1),q(),t&&t({skipScan:!0,goToInfo:!0})},children:"Not Now"}),D.jsx("button",{className:"btn btn-accept",disabled:!P,onClick:()=>{I(!1),setTimeout(()=>x(1),500),setTimeout(()=>x(2),2e3),setTimeout(()=>x(3),4e3),setTimeout(()=>{x(4),t&&t(a.interests)},6e3)},children:"I Agree & Continue"})]})]})}),g&&!a&&!C&&D.jsxs("div",{className:"scanning-view",children:[D.jsxs("div",{className:"scan-header",children:[D.jsx("h2",{className:"scan-title",children:"Face Detection"}),D.jsx("p",{className:"scan-subtitle",children:"Look at the camera for personalized recommendations"})]}),D.jsxs("div",{className:"video-scanner",children:[D.jsxs("div",{className:"scanner-frame",children:[D.jsx("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0,className:"scanner-video"}),D.jsx("div",{className:"scan-circle",children:o&&D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"scan-line"}),D.jsxs("div",{className:"scan-corners",children:[D.jsx("div",{className:"corner corner-tl"}),D.jsx("div",{className:"corner corner-tr"}),D.jsx("div",{className:"corner corner-bl"}),D.jsx("div",{className:"corner corner-br"})]}),D.jsx("div",{className:"scan-grid"}),D.jsx("div",{className:"scan-particles",children:[...Array(20)].map((U,Q)=>D.jsx("div",{className:"particle",style:{"--delay":`${Q*.1}s`,"--angle":`${Q*18}deg`}},Q))})]})})]}),D.jsx("p",{className:"scan-status",children:o?h||"Analyzing...":r?"Loading AI Models...":"Ready to Scan"}),!o&&!r&&D.jsx("button",{className:"btn-scan-manual",onClick:X,children:" Start Scan"})]}),D.jsx("canvas",{ref:n,style:{display:"none"}})]}),a&&D.jsxs(de.div,{className:"detection-result",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[D.jsx("div",{className:"result-hero",children:D.jsxs("h2",{className:"hero-title",children:["FIND YOUR PATH.",D.jsx("br",{}),D.jsx("span",{className:"hero-highlight",children:"UNLOCK & FUTURE."})]})}),D.jsxs("div",{className:"recommendation-card",children:[D.jsx("div",{className:"card-header",children:"PERSONALIZED RECOMMENDATION"}),D.jsx("div",{className:"card-body",children:D.jsxs("div",{className:"profile-section",children:[D.jsx("div",{className:"profile-avatar",children:D.jsx("div",{className:"avatar-circle",children:S?D.jsx("img",{src:S,alt:"Scanned face",className:"avatar-image"}):D.jsx("span",{className:"avatar-placeholder",children:""})})}),D.jsxs("div",{className:"profile-info",children:[w>=1&&D.jsxs(de.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[D.jsx("span",{className:"info-label",children:"Age:"}),D.jsx("span",{className:"info-value",children:a.age})]}),w>=2&&D.jsxs(de.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:[D.jsx("span",{className:"info-label",children:"Gender:"}),D.jsx("span",{className:"info-value",children:a.gender==="male"?"Male":"Female"})]}),w>=3&&D.jsxs(de.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:[D.jsx("span",{className:"info-label",children:"Mood:"}),D.jsx("span",{className:"info-value",children:z(a.expressions)})]}),w>=4&&D.jsxs(de.div,{className:"interests-section",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[D.jsx("p",{className:"interests-title",children:"Based on your profile, you might interested in:"}),D.jsx("ul",{className:"interests-list",children:a.interests.map((U,Q)=>{const te=Jd.find(ie=>ie.id===U);return D.jsx(de.li,{className:"interest-item",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Q*.1},children:te==null?void 0:te.name},U)})})]})]})]})})]}),w>=4&&D.jsxs(de.div,{className:"reset-actions",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[D.jsx("button",{className:"btn-reset",onClick:q,children:"Not Interested, Explore All"}),D.jsx("button",{className:"btn-next",onClick:()=>{t&&t(a.interests)},children:"Show Me!"})]}),w>=4&&D.jsxs(de.div,{className:"result-footer",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:[D.jsx("div",{className:"footer-note",children:"AI-Powered Career Recommendations"}),D.jsx("div",{className:"footer-icon",children:""})]})]})]})};class dY{constructor(){this.apiKey=Y$,this.endpoint="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent",this.conversationHistory=[],this.systemContext=this.buildSystemContext()}buildSystemContext(){const e=Jd.map(i=>`- ${i.name} (${i.code}): ${i.description}`).join(`
`),r=(Gn||{}).contact||{phone:"053-277-777",email:"lannapoly@edu.th",website:"www.lannapoly.ac.th"};return` ""   
  

 (14 ):
${e}

:
-  . : 12,100 / ( 9,000 +  3,100)
-  . : 21,700 / ( 18,700 +  3,000)
- / 

:
- : ${r.phone}
- : ${r.email}
- : ${r.website}

:
- **  1-2 **
- ** **
-  
-   /   /  
-  
- ** 30 **`}async ask(e,n="th"){var r,i,o,s,a;try{this.conversationHistory.push({role:"user",parts:[{text:e}]});const u=this.conversationHistory.length===1?`${this.systemContext}

: ${e}`:e,l=await fetch(`${this.endpoint}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:u}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:200}})});if(!l.ok)throw new Error(`Gemini API error: ${l.status}`);const h=((a=(s=(o=(i=(r=(await l.json()).candidates)==null?void 0:r[0])==null?void 0:i.content)==null?void 0:o.parts)==null?void 0:s[0])==null?void 0:a.text)||"  ?";return this.conversationHistory.push({role:"model",parts:[{text:h}]}),h}catch(u){return console.error("Gemini API Error:",u),this.getFallbackResponse(e,n)}}getFallbackResponse(e,n="th"){const r=e.toLowerCase();if(r.includes("")||r.includes("")||r.includes("course")||r.includes("major"))return n==="th"?" 14   ":"We have 14 courses available. Check out the cards below!";if(r.includes("")||r.includes("tuition")||r.includes("fee"))return n==="th"?" . 12,100 /, . 21,700 / () ":"Tuition: Certificate 12,100 THB/year, Diploma 21,700 THB/year (Industrial)";if(r.includes("")||r.includes("apply")||r.includes("admission")){const i=(Gn==null?void 0:Gn.contact)||{phone:"053-277-777",website:"www.lannapoly.ac.th"};return n==="th"?` ${i.website}  ${i.phone} `:`Apply at ${i.website} or call ${i.phone}`}if(r.includes("")||r.includes("contact")||r.includes("")){const i=(Gn==null?void 0:Gn.contact)||{phone:"053-277-777",email:"lannapoly@edu.th"};return n==="th"?`:  ${i.phone},  ${i.email} `:`Contact: Phone ${i.phone}, Email ${i.email}`}return n==="th"?"! ?":n==="en"?"Hello! How can I help you with admissions or course information?":""}detectLanguage(e){return/[\u0E00-\u0E7F]/.test(e)?"th":/[\u4E00-\u9FFF]/.test(e)?"zh":"en"}resetConversation(){this.conversationHistory=[]}getGreeting(e="th"){const n={th:["! ?","! ?","! ?"],en:["Hello! How can I help you with admissions or course information?","Hey there! Which course are you interested in?","Hi! Ready to find your perfect major?"],zh:["","",""]},r=n[e]||n.th;return r[Math.floor(Math.random()*r.length)]}}const Bw=new dY,pY=(t,e)=>Bw.ask(t,e),mY=()=>Bw.resetConversation(),gY=t=>Bw.getGreeting(t);class vY{constructor(){this.isEnabled=Ra.enabled,this.currentLanguage=Ra.defaultLanguage,this.isSpeaking=!1,this.initialized=!1,this.userInteracted=!1}init(){return typeof responsiveVoice>"u"?(console.warn("ResponsiveVoice not loaded"),this.isEnabled=!1,!1):(responsiveVoice.init(),typeof responsiveVoice.enableEstimationTimeout<"u"&&(responsiveVoice.enableEstimationTimeout=!1),this.initialized=!0,console.log(" ResponsiveVoice initialized"),this.setupInteractionListener(),!0)}setupInteractionListener(){const e=()=>{this.userInteracted||(this.userInteracted=!0,console.log(" Audio unlocked by user interaction"),console.log(" Audio context ready"),document.removeEventListener("click",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e))};document.addEventListener("click",e),document.addEventListener("touchstart",e),document.addEventListener("keydown",e)}detectLanguage(e){return/[\u0E00-\u0E7F]/.test(e)?"th":/[\u4E00-\u9FFF]/.test(e)?"zh":"en"}getVoiceSettings(e){switch(e){case"th":return Ra.thai;case"en":return Ra.english;case"zh":return Ra.chinese;default:return Ra.thai}}speak(e,n=null){return!this.isEnabled||!this.initialized?(console.warn("Voice service not enabled or initialized"),Promise.resolve()):!e||typeof e!="string"||e.trim()===""?(console.warn(" Cannot speak: Text is empty or invalid"),Promise.resolve()):this.userInteracted?new Promise(r=>{const i=n||this.detectLanguage(e),o=this.getVoiceSettings(i);this.stop(),console.log(`Speaking in ${i}:`,e),console.log("Voice settings:",o),this.isSpeaking=!0;try{responsiveVoice.speak(e,o.voice,{pitch:o.pitch,rate:o.rate,volume:o.volume,onstart:()=>{console.log(" :",e)},onend:()=>{this.isSpeaking=!1,console.log(" "),r()},onerror:s=>{console.error(" :",s),this.isSpeaking=!1,r()}})}catch(s){console.error(" Error speaking:",s),this.isSpeaking=!1,r()}}):(console.warn(" Cannot play audio: User has not interacted with the page yet"),Promise.resolve())}stop(){this.isSpeaking&&typeof responsiveVoice<"u"&&(responsiveVoice.cancel(),this.isSpeaking=!1)}pause(){typeof responsiveVoice<"u"&&responsiveVoice.pause()}resume(){typeof responsiveVoice<"u"&&responsiveVoice.resume()}getVoices(){return typeof responsiveVoice<"u"?responsiveVoice.getVoices():[]}isSpeakingNow(){return this.isSpeaking}setLanguage(e){["th","en","zh"].includes(e)&&(this.currentLanguage=e)}getLanguage(){return this.currentLanguage}}const Tm=new vY;typeof window<"u"&&window.addEventListener("load",()=>{setTimeout(()=>{Tm.init()},1e3)});const fM=(t,e=null)=>Tm.speak(t,e),ES=()=>{Tm.stop()},mv={Au:{th:" (Au) -     3        ",en:"Automotive Technology (Au) - Thailand's automotive industry ranks among the world's top producers, with projected output of 3 million vehicles annually. Graduates can work as mechanics, vehicle inspectors, or own auto repair businesses, or continue to automotive or mechanical engineering degrees.",zh:" (Au) - 300"},Ev:{th:" (Ev) -        ",en:"Electric Vehicle Technology (Ev) - Vehicle technology is constantly evolving. Thailand's automotive industry ranks among the world's top. Graduates can work as EV mechanics, service center supervisors, or continue to automotive or mechanical engineering degrees.",zh:" (Ev) - "},Ep:{th:" (Ep) -          ",en:"Electrical Power (Ep) - Electrical engineering is fundamental to modern life. Graduates can work as electrical installers, air conditioning and refrigeration technicians, or continue to electrical engineering, education, or industrial degrees.",zh:" (Ep) - "},El:{th:" (El) -             ",en:"Electronics (El) - Study video systems, audio systems, communications, industrial control systems, and robotics. Graduates can work at airports, aviation companies, telecommunications, or continue to communications, electronics and telecommunications, or multimedia engineering degrees.",zh:" (El) - "},Co:{th:" (Co) -       Draft man    ",en:"Construction (Co) - Learn construction techniques and innovations. Graduates can work as construction supervisors, contractors, civil technicians, draftsmen, or in construction materials business, or continue to civil engineering or industrial education degrees.",zh:" (Co) - "},Ar:{th:" (Ar) -               ",en:"Architecture (Ar) - Study design, construction drawing, cost estimation, model making, and structural calculations. Graduates can work as industrial product designers, decorators, interior designers, furniture designers, graphic designers, architects, or continue to architecture degrees.",zh:" (Ar) - "},Ct:{th:" (Ct) -     C, Java, Python       IoT ",en:"Computer Programming (Ct) - Think, code, and innovate. Learn programming with C, Java, Python, web development, mobile apps, system analysis and design, database management, and IoT programming. Programming skills are essential in the technology era.",zh:" (Ct) - CJavaPythonWeb"},It:{th:" (It) -  .         IT    ",en:"Information Technology (It) - Diploma level only. Study computer maintenance, software and hardware. Graduates can work in IT organizations, software companies, network services, internet, e-commerce, IT consulting, animation and gaming, or continue to database, network, or security studies.",zh:" (It) - ITIT"},Ac:{th:" (Ac) -            ",en:"Accounting (Ac) - Businesses need financial data. Lanna Polytechnic College develops curricula to produce efficient accounting professionals. Graduates can work as accountants, accounting consultants, auditors, cost analysts, financial officers, or bank employees.",zh:" (Ac) - "},Mk:{th:" (Mk) -  E-Commerce             ",en:"Marketing (Mk) - In the era of technology and E-Commerce, high competition creates demand for marketing professionals. Graduates can work as market researchers, analysts, brand builders, marketers, strategists, sales managers, in retail, wholesale, or import-export businesses.",zh:" (Mk) - "},Dt:{th:" (Dt) -          ",en:"Digital Business (Dt) - Computer technology plays a role in daily life. Business operations relate to information systems. Graduates can work as computer officers, data analysts, system developers and designers, programmers, IT managers, or webmasters.",zh:" (Dt) - IT"},Tg:{th:" (Tg) -          ",en:"Tourism (Tg) - Blends science and art. Students gain knowledge in various fields. As ASEAN integrates, Thailand becomes the hub for transportation and tourism. Graduates can work as tour guides, tourism business managers, attraction site managers, or recreation business managers.",zh:" (Tg) - "},Hm:{th:" (Hm) -       ",en:"Hotel Management (Hm) - Blends science and art. Students learn communication skills to entertain guests. As ASEAN integrates, Thailand becomes a tourism business hub. Graduates can work in hotel management, tourism business management, or attraction site management.",zh:" (Hm) - "}};function yY({onClose:t,interests:e=[]}){const[n,r]=Y.useState([]),[i,o]=Y.useState(""),[s,a]=Y.useState(!1),[u,l]=Y.useState(!1),[c,h]=Y.useState("idle"),[f,d]=Y.useState(!1),[m,v]=Y.useState(!1),[y,g]=Y.useState(!1),_=Y.useRef(null),w=Y.useRef(null),x=Y.useRef(null),S=()=>{var k;(k=_.current)==null||k.scrollIntoView({behavior:"smooth"})};Y.useEffect(()=>{S()},[n]),Y.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const k=window.SpeechRecognition||window.webkitSpeechRecognition,j=new k;j.continuous=!1,j.interimResults=!1,j.lang="th-TH",j.onresult=W=>{const q=W.results[0][0].transcript;o(q),g(!1)},j.onerror=W=>{console.error("Speech recognition error:",W.error),g(!1)},j.onend=()=>{g(!1)},x.current=j}},[]),Y.useEffect(()=>{["idle","talk","bye"].forEach(j=>{const W=document.createElement("video");W.src=`/VDO/${j}.mp4`,W.preload="auto"})},[]),Y.useEffect(()=>(w.current&&w.current.play(),m||setTimeout(()=>{const k=gY(e);A("talk",k),r([{role:"assistant",content:k}]),v(!0)},500),()=>{ES(),mY()}),[]);const A=(k,j)=>{const W=w.current;W&&(W.style.transition="opacity 0.2s ease",W.style.opacity="0.5",setTimeout(()=>{h(k),l(!0),W.loop=!0,W.play().then(()=>{W.style.opacity="1"})},200)),fM(j,"th")},T=()=>{c==="idle"||u?w.current&&w.current.play():h("idle")},E=async()=>{if(!i.trim())return;const k=i.trim();o(""),r(j=>[...j,{role:"user",content:k}]),a(!0),h("idle");try{const j=await pY(k,e);r(W=>[...W,{role:"assistant",content:j}]),A("talk",j)}catch(j){console.error("Error asking Gemini:",j);const W="  ";r(q=>[...q,{role:"assistant",content:W}]),A("talk",W)}finally{a(!1)}},C=(k,j="talk")=>{o(k),setTimeout(()=>E(),100)},I=()=>{if(!x.current){alert("  Google Chrome");return}if(y)x.current.stop(),g(!1);else try{x.current.start(),g(!0),h("idle")}catch(k){console.error("Error starting recognition:",k),g(!1)}},P=()=>{h("bye"),A("bye","  !"),setTimeout(()=>{ES(),t()},3e3)},N=[{text:" ?",video:"talk"},{text:" ?",video:"talk"},{text:" ?",video:"talk"},{text:" ?",video:"talk"}];return D.jsx(su,{children:D.jsx(de.div,{className:"avatar-video-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:P,children:D.jsxs(de.div,{className:"avatar-video-container",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onClick:k=>k.stopPropagation(),children:[D.jsxs("div",{className:"video-avatar-section",children:[D.jsx("video",{ref:w,className:"avatar-video",src:`/VDO/${c}.mp4`,loop:c==="idle",autoPlay:!0,muted:!1,playsInline:!0,onEnded:T,onError:k=>{console.error("Video error:",k),c!=="idle"&&h("idle")}}),D.jsxs("div",{className:"avatar-status",children:[y&&D.jsx(de.div,{className:"status-badge listening",initial:{scale:0},animate:{scale:1},children:" ..."}),u&&D.jsx(de.div,{className:"status-badge speaking",initial:{scale:0},animate:{scale:1},children:" ..."}),s&&D.jsx(de.div,{className:"status-badge thinking",initial:{scale:0},animate:{scale:1},children:" ..."})]}),D.jsx("div",{className:"video-info",children:D.jsxs("p",{className:"video-state",children:[": ",c]})})]}),D.jsxs("div",{className:"chat-section",children:[D.jsxs("div",{className:"chat-header",children:[D.jsxs("div",{className:"header-info",children:[D.jsx("h3",{children:" "}),D.jsx("p",{className:"header-subtitle",children:""})]}),D.jsx("button",{className:"close-btn",onClick:P,children:""})]}),D.jsxs("div",{className:"messages-container",children:[n.map((k,j)=>D.jsxs(de.div,{className:`message ${k.role}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:j*.1},children:[D.jsx("div",{className:"message-avatar",children:k.role==="assistant"?"":""}),D.jsx("div",{className:"message-content",children:k.content})]},j)),s&&D.jsxs(de.div,{className:"message assistant thinking",initial:{opacity:0},animate:{opacity:1},children:[D.jsx("div",{className:"message-avatar",children:""}),D.jsx("div",{className:"message-content",children:D.jsxs("div",{className:"typing-indicator",children:[D.jsx("span",{}),D.jsx("span",{}),D.jsx("span",{})]})})]}),D.jsx("div",{ref:_})]}),n.length<=2&&D.jsxs("div",{className:"quick-questions",children:[D.jsx("p",{className:"quick-label",children:":"}),D.jsx("div",{className:"quick-buttons",children:N.map((k,j)=>D.jsx("button",{className:"quick-btn",onClick:()=>C(k.text,k.video),disabled:s,children:k.text},j))})]}),D.jsxs("div",{className:"chat-input",children:[D.jsx("button",{onClick:I,className:`voice-btn ${y?"listening":""}`,disabled:s,title:"",children:y?"":""}),D.jsx("input",{type:"text",value:i,onChange:k=>o(k.target.value),onKeyPress:k=>k.key==="Enter"&&E(),placeholder:y?"...":"...",disabled:s}),D.jsx("button",{onClick:E,disabled:!i.trim()||s,className:"send-btn",children:s?"":""})]})]})]})})})}const _Y=({suggestedInterests:t=[],onAvatarClick:e})=>{const[n,r]=Y.useState(null),[i,o]=Y.useState("all"),[s,a]=Y.useState(!1);Y.useEffect(()=>{cY({suggestedInterests:t,timestamp:new Date().toISOString()})},[t]);const u=c=>{r(c),hM(50,50,`career-${c.id}`);const h=sessionStorage.getItem("sessionId");xp("clicked",h,{careerClicked:c.id,careerName:c.name});const f=mv[c.code];f&&fM(f.th,"th")},l=i==="all"?Jd:Jd.filter(c=>t.includes(c.id));return D.jsxs("div",{className:"career-cards-container",children:[D.jsxs("div",{className:"cards-header",children:[D.jsx(de.h2,{className:"section-title",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:" "}),D.jsxs("div",{className:"filter-buttons",children:[D.jsx("button",{className:`filter-btn ${i==="all"?"active":""}`,onClick:()=>o("all"),children:""}),D.jsx("button",{className:`filter-btn ${i==="suggested"?"active":""}`,onClick:()=>o("suggested"),disabled:t.length===0,children:" "})]}),D.jsx("button",{className:"avatar-btn",onClick:e,children:" "})]}),D.jsx("div",{className:"cards-grid",children:l.map((c,h)=>{const f=t.includes(c.id);return D.jsxs(de.div,{className:`career-card ${f?"suggested":""}`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:h*.05,duration:.3},whileHover:{scale:1.05,y:-5},onClick:()=>u(c),style:{borderColor:f?c.color:"transparent",color:c.color},children:[D.jsx("div",{className:"card-category",children:c.category}),D.jsx("div",{className:"card-code",style:{color:c.color},children:c.code}),D.jsx("div",{className:"card-icon",children:c.icon}),D.jsx("div",{className:"card-name",children:c.name}),D.jsx("div",{className:"card-description",children:c.description}),f&&D.jsx("div",{className:"suggested-badge",style:{background:c.gradient},children:" "})]},c.id)})}),n&&D.jsx(de.div,{className:"detail-overlay",initial:{opacity:0},animate:{opacity:1},onClick:()=>r(null),children:D.jsxs(de.div,{className:"detail-modal",initial:{scale:.8,y:50},animate:{scale:1,y:0},onClick:c=>c.stopPropagation(),children:[D.jsx("button",{className:"close-btn",onClick:()=>r(null),children:""}),D.jsxs("div",{className:"modal-header",style:{borderColor:n.color},children:[D.jsx("div",{className:"modal-icon",style:{color:n.color},children:wY(n.id)}),D.jsx("h2",{style:{color:n.color},children:n.name})]}),D.jsxs("div",{className:"modal-content",children:[D.jsxs("section",{className:"modal-section",children:[D.jsx("h3",{children:" "}),D.jsx("p",{children:n.description})]}),D.jsxs("section",{className:"modal-section",children:[D.jsx("h3",{children:" "}),mv[n.code]&&D.jsx("p",{style:{lineHeight:"1.8",textAlign:"justify"},children:mv[n.code].th})]}),D.jsxs("section",{className:"modal-section",children:[D.jsx("h3",{children:" "}),D.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[D.jsxs("div",{style:{padding:"0.75rem",background:"rgba(126, 200, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(126, 200, 69, 0.3)"},children:[D.jsx("strong",{children:" . ()"}),D.jsx("br",{})," 3 "]}),D.jsxs("div",{style:{padding:"0.75rem",background:"rgba(0, 166, 81, 0.1)",borderRadius:"8px",border:"1px solid rgba(0, 166, 81, 0.3)"},children:[D.jsx("strong",{children:" . ()"}),D.jsx("br",{})," 2 ",n.code==="It"&&D.jsx("span",{style:{color:"#f59e0b",marginLeft:"0.5rem"},children:" ( .)"})]})]})]}),D.jsx("button",{className:"modal-btn",style:{background:`linear-gradient(135deg, ${n.color} 0%, ${n.color}80 100%)`},onClick:()=>a(!0),children:" "})]})]})}),D.jsx(su,{children:s&&D.jsx(de.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>a(!1),children:D.jsxs(de.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:c=>c.stopPropagation(),children:[D.jsxs("div",{className:"external-header",children:[D.jsx("h3",{children:" "}),D.jsx("button",{className:"back-btn",onClick:()=>a(!1),children:" "})]}),D.jsx("iframe",{src:"https://www.lannapoly.ac.th/admission/#/?from=website",className:"admission-iframe",title:"Online Admission",allowFullScreen:!0,loading:"lazy"})]})})})]})},wY=t=>({tech:"",business:"",design:"",health:"",engineering:"",hospitality:""})[t]||"",xY=({onClose:t})=>{const[e,n]=Y.useState("certificate"),[r,i]=Y.useState(!1),[o,s]=Y.useState(!1),a=f=>new Intl.NumberFormat("th-TH").format(f),u=()=>{i(!0)},l=()=>{i(!1)},c=()=>{s(!0)},h=()=>{s(!1)};return D.jsxs(de.div,{className:"tuition-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,children:[D.jsxs(de.div,{className:"tuition-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:f=>f.stopPropagation(),children:[D.jsxs("div",{className:"tuition-header",children:[D.jsx("h2",{children:"  & "}),D.jsx("button",{className:"close-btn",onClick:t,children:""})]}),D.jsxs("div",{className:"tuition-tabs",children:[D.jsx("button",{className:`tab-btn ${e==="certificate"?"active":""}`,onClick:()=>n("certificate"),children:" ."}),D.jsx("button",{className:`tab-btn ${e==="diploma"?"active":""}`,onClick:()=>n("diploma"),children:" ."}),D.jsx("button",{className:`tab-btn ${e==="scholarships"?"active":""}`,onClick:()=>n("scholarships"),children:" "})]}),D.jsx("div",{className:"tuition-content",children:D.jsxs(su,{mode:"wait",children:[e==="certificate"&&D.jsxs(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[D.jsx("h3",{children:"  . ( .3 )"}),D.jsx("div",{className:"fee-cards",children:Object.entries(Gn.certificate).map(([f,d])=>D.jsxs("div",{className:"fee-card",children:[D.jsx("h4",{children:d.name}),D.jsxs("div",{className:"fee-details",children:[D.jsxs("div",{className:"fee-row",children:[D.jsx("span",{children:":"}),D.jsxs("strong",{children:[a(d.tuition)," /"]})]}),D.jsxs("div",{className:"fee-row",children:[D.jsx("span",{children:" +  + :"}),D.jsxs("strong",{children:[a(d.entrance)," "]})]}),D.jsxs("div",{className:"fee-row total",children:[D.jsx("span",{children:":"}),D.jsxs("strong",{className:"total-price",children:[a(d.total)," "]})]})]})]},f))})]},"certificate"),e==="diploma"&&D.jsxs(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[D.jsx("h3",{children:"  . ( .3, .6 )"}),D.jsx("div",{className:"fee-cards",children:Object.entries(Gn.diploma).map(([f,d])=>D.jsxs("div",{className:"fee-card",children:[D.jsx("h4",{children:d.name}),D.jsxs("div",{className:"fee-details",children:[D.jsxs("div",{className:"fee-row",children:[D.jsx("span",{children:":"}),D.jsxs("strong",{children:[a(d.tuition)," /"]})]}),D.jsxs("div",{className:"fee-row",children:[D.jsx("span",{children:" +  + :"}),D.jsxs("strong",{children:[a(d.entrance)," "]})]}),D.jsxs("div",{className:"fee-row total",children:[D.jsx("span",{children:":"}),D.jsxs("strong",{className:"total-price",children:[a(d.total)," "]})]})]})]},f))})]},"diploma"),e==="scholarships"&&D.jsxs(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[D.jsx("h3",{children:" "}),D.jsx("div",{className:"scholarship-grid",children:Gn.scholarships.map(f=>D.jsxs("div",{className:"scholarship-card",style:{borderColor:f.color},children:[D.jsx("div",{className:"scholarship-icon",style:{color:f.color},children:f.icon}),D.jsx("h4",{children:f.name}),D.jsx("p",{children:f.description})]},f.id))}),D.jsxs("div",{className:"benefits-section",children:[D.jsx("h4",{children:" "}),D.jsx("ul",{className:"benefits-list",children:Gn.benefits.map((f,d)=>D.jsxs("li",{children:[" ",f]},d))})]})]},"scholarships")]})}),D.jsxs("div",{className:"tuition-footer",children:[D.jsxs("div",{className:"footer-section",children:[D.jsx("h4",{children:" "}),D.jsx("ul",{className:"doc-list",children:Gn.documents.map((f,d)=>D.jsx("li",{children:f},d))})]}),D.jsxs("div",{className:"footer-section",children:[D.jsx("h4",{children:" "}),D.jsx("div",{className:"method-list",children:Gn.applicationMethods.map(f=>D.jsxs("div",{className:"method-item clickable",onClick:()=>{f.method==="walk-in"?u():f.method==="online"&&c()},children:[D.jsx("span",{className:"method-icon",children:f.icon}),D.jsxs("div",{children:[D.jsx("strong",{children:f.name}),D.jsx("p",{children:f.description})]}),D.jsx("span",{className:"method-arrow",children:""})]},f.method))})]}),D.jsx("div",{className:"notes-section",children:Gn.notes.map((f,d)=>D.jsxs("div",{className:"note-item",children:[" ",f]},d))})]})]}),D.jsx(su,{children:o&&D.jsx(de.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h,children:D.jsxs(de.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:f=>f.stopPropagation(),children:[D.jsxs("div",{className:"external-header",children:[D.jsx("h3",{children:" "}),D.jsx("button",{className:"back-btn",onClick:h,children:" "})]}),D.jsx("iframe",{src:"https://www.lannapoly.ac.th/admission/#/?from=website",className:"admission-iframe",title:"Online Admission",allowFullScreen:!0,loading:"lazy"})]})})}),D.jsx(su,{children:r&&D.jsx(de.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,children:D.jsxs(de.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:f=>f.stopPropagation(),children:[D.jsxs("div",{className:"external-header",children:[D.jsx("h3",{children:" "}),D.jsx("button",{className:"back-btn",onClick:l,children:" "})]}),D.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d15107.211230282383!2d98.9912912!3d18.8069393!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da3bcb57f2cda3%3A0x5a42c69f9e85016a!2z4Lin4Li04LiX4Lii4Liy4Lil4Lix4Lii4LmA4LiX4LiE4LmC4LiZ4LmC4Lil4Lii4Li14LmC4Lib4Lil4Li04LmA4LiX4LiE4LiZ4Li04LiE4Lil4Liy4LiZ4LiZ4LiyIOC5gOC4iuC4teC4ouC4h-C5g-C4q-C4oeC5iA!5e0!3m2!1sth!2sth!4v1766587427769!5m2!1sth!2sth",className:"admission-iframe",title:"Google Maps - ",allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{border:0}})]})})})]})},bY=({onInteraction:t})=>{var u,l,c;const[e,n]=Y.useState(0),[r,i]=Y.useState("fade"),o=[{type:"fade",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},{type:"slide",initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:-100,opacity:0}},{type:"zoom",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.2,opacity:0}},{type:"rotate",initial:{rotateY:90,opacity:0},animate:{rotateY:0,opacity:1},exit:{rotateY:-90,opacity:0}},{type:"flip",initial:{rotateX:-90,opacity:0},animate:{rotateX:0,opacity:1},exit:{rotateX:90,opacity:0}}],s=[{id:1,type:"image",title:"",subtitle:" ",description:"",image:"/images/activities/1.jpg",gradient:"linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(118, 75, 162, 0.7) 100%)",icon:""},{id:2,type:"image",title:"14 ",subtitle:"",description:" |  |  | ",image:"/images/activities/2.jpg",gradient:"linear-gradient(135deg, rgba(240, 147, 251, 0.7) 0%, rgba(245, 87, 108, 0.7) 100%)",icon:""},{id:3,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/3.jpg",gradient:"linear-gradient(135deg, rgba(79, 172, 254, 0.7) 0%, rgba(0, 242, 254, 0.7) 100%)",icon:""},{id:4,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/4.jpg",gradient:"linear-gradient(135deg, rgba(250, 112, 154, 0.7) 0%, rgba(254, 225, 64, 0.7) 100%)",icon:""},{id:5,type:"image",title:"",subtitle:"95%  6 ",description:" 200 ",image:"/images/activities/5.jpg",gradient:"linear-gradient(135deg, rgba(48, 207, 208, 0.7) 0%, rgba(51, 8, 103, 0.7) 100%)",icon:""},{id:6,type:"image",title:"",subtitle:" 2568",description:" |  | ",image:"/images/activities/6.jpg",gradient:"linear-gradient(135deg, rgba(168, 237, 234, 0.7) 0%, rgba(254, 214, 227, 0.7) 100%)",icon:""},{id:7,type:"image",title:"",subtitle:"",description:"  ",image:"/images/activities/7.jpg",gradient:"linear-gradient(135deg, rgba(255, 159, 124, 0.7) 0%, rgba(255, 95, 109, 0.7) 100%)",icon:""},{id:8,type:"image",title:"",subtitle:"",description:"",image:"/images/activities/8.jpg",gradient:"linear-gradient(135deg, rgba(67, 198, 172, 0.7) 0%, rgba(25, 22, 84, 0.7) 100%)",icon:""},{id:9,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/9.jpg",gradient:"linear-gradient(135deg, rgba(255, 175, 189, 0.7) 0%, rgba(255, 195, 160, 0.7) 100%)",icon:""},{id:10,type:"image",title:"",subtitle:"",description:"",image:"/images/activities/10.jpg",gradient:"linear-gradient(135deg, rgba(132, 250, 176, 0.7) 0%, rgba(143, 211, 244, 0.7) 100%)",icon:""},{id:11,type:"cta",title:"!",subtitle:"",description:" ",gradient:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",icon:"",pulse:!0}];Y.useEffect(()=>{const h=setInterval(()=>{const f=o[Math.floor(Math.random()*o.length)];i(f.type),n(d=>(d+1)%s.length)},5e3);return()=>clearInterval(h)},[s.length]);const a=()=>{t&&t()};return D.jsxs("div",{className:"ad-slideshow",onClick:a,children:[D.jsx("div",{className:"inf-grid-hero-container",children:D.jsx("div",{className:"inf-grid-perspective",children:D.jsxs("div",{className:"grid-lines",children:[[...Array(20)].map((h,f)=>D.jsx("div",{className:"grid-line-horizontal",style:{top:`${f*5}%`}},`h-${f}`)),[...Array(20)].map((h,f)=>D.jsx("div",{className:"grid-line-vertical",style:{left:`${f*5}%`}},`v-${f}`))]})})}),D.jsx(su,{mode:"wait",children:D.jsxs(de.div,{className:"slide",style:{background:s[e].gradient,backgroundImage:s[e].image?`url(${s[e].image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:((u=o.find(h=>h.type===r))==null?void 0:u.initial)||{opacity:0},animate:((l=o.find(h=>h.type===r))==null?void 0:l.animate)||{opacity:1},exit:((c=o.find(h=>h.type===r))==null?void 0:c.exit)||{opacity:0},transition:{duration:.9,ease:[.43,.13,.23,.96]},children:[D.jsx("div",{className:"floating-images-3d",children:s.filter(h=>h.image).slice(0,8).map((h,f)=>D.jsx(de.div,{className:"floating-image-card",style:{backgroundImage:`url(${h.image})`,left:`${Math.random()*80+10}%`,top:`${Math.random()*60+20}%`},initial:{rotateX:Math.random()*30-15,rotateY:Math.random()*30-15,z:Math.random()*-500-100,opacity:0},animate:{rotateX:[null,Math.random()*20-10],rotateY:[null,Math.random()*360],z:[null,Math.random()*-300],opacity:[0,.7,.7,0]},transition:{duration:8+Math.random()*4,repeat:1/0,delay:f*.5,ease:"easeInOut"}},`float-${f}`))}),D.jsx("div",{className:"particles",children:[...Array(20)].map((h,f)=>D.jsx(de.div,{className:"particle",initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,scale:Math.random()*.5+.5,opacity:0},animate:{y:[null,Math.random()*-200-100],opacity:[0,.6,0],scale:[null,Math.random()*1.5+.5]},transition:{duration:Math.random()*3+2,repeat:1/0,delay:Math.random()*2}},f))}),D.jsx("div",{className:"grid-bg"}),s[e].image&&D.jsx("div",{className:"slide-overlay",style:{background:s[e].gradient}}),D.jsxs("div",{className:"slide-content",children:[D.jsx(de.div,{className:`slide-icon ${s[e].pulse?"pulse":""}`,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},children:s[e].icon}),D.jsx(de.h1,{className:"slide-title",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},children:s[e].title}),D.jsx(de.h2,{className:"slide-subtitle",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:s[e].subtitle}),D.jsx(de.p,{className:"slide-description",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},children:s[e].description}),s[e].type==="cta"&&D.jsxs(de.div,{className:"cta-hint",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},children:[D.jsx("div",{className:"hand-wave",children:""}),D.jsx("p",{children:""})]})]}),D.jsx("div",{className:"slide-dots",children:s.map((h,f)=>D.jsx("div",{className:`dot ${f===e?"active":""}`,onClick:d=>{d.stopPropagation(),n(f)}},f))})]},e)}),D.jsx("div",{className:"interaction-hint",children:D.jsx("p",{children:" "})})]})};function EY({onComplete:t,careerSuggestions:e=[]}){const[n,r]=Y.useState("welcome"),[i,o]=Y.useState(null),s=l=>{const c=new(window.AudioContext||window.webkitAudioContext),h=c.createOscillator(),f=c.createGain();h.connect(f),f.connect(c.destination),l==="click"?(h.frequency.value=800,f.gain.setValueAtTime(.1,c.currentTime),f.gain.exponentialRampToValueAtTime(.01,c.currentTime+.1),h.start(c.currentTime),h.stop(c.currentTime+.1)):l==="success"&&(h.frequency.value=1200,f.gain.setValueAtTime(.1,c.currentTime),f.gain.exponentialRampToValueAtTime(.01,c.currentTime+.2),h.start(c.currentTime),h.stop(c.currentTime+.2))},a=l=>{s("click"),l==="start"?r("explore"):l==="back"?r("welcome"):l==="finish"&&t&&t()},u=l=>{s("success"),o(l),r("career")};return D.jsxs("div",{className:"kids-mode",children:[n==="welcome"&&D.jsxs(de.div,{className:"kids-screen welcome-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[D.jsx(de.h1,{className:"kids-title",children:" ! "}),D.jsx(de.div,{className:"emoji-bounce",animate:{y:[0,-20,0]},transition:{duration:1.5,repeat:1/0},children:""}),D.jsx(de.p,{className:"kids-subtitle",children:"  !"}),D.jsxs(de.button,{className:"big-button start-button",onClick:()=>a("start"),whileHover:{scale:1.1},whileTap:{scale:.95},children:[D.jsx("span",{className:"button-text",children:"!"}),D.jsx("span",{className:"button-emoji",children:""})]})]}),n==="explore"&&D.jsxs(de.div,{className:"kids-screen explore-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[D.jsx(de.h2,{className:"kids-title",children:"! "}),D.jsx("div",{className:"kids-career-grid",children:e.length>0?e.map(l=>D.jsxs(de.div,{className:"kids-career-card",onClick:()=>u(l),whileHover:{scale:1.05},whileTap:{scale:.95},animate:{boxShadow:["0 5px 15px rgba(0, 0, 0, 0.1)","0 8px 25px rgba(0, 0, 0, 0.2)","0 5px 15px rgba(0, 0, 0, 0.1)"]},transition:{duration:2,repeat:1/0},children:[D.jsx("div",{className:"big-emoji",children:l.icon}),D.jsx("div",{className:"career-name",children:l.name})]},l.id)):D.jsx("p",{className:"placeholder",children:"..."})}),D.jsxs(de.button,{className:"big-button back-button",onClick:()=>a("back"),whileHover:{scale:1.1},whileTap:{scale:.95},children:[D.jsx("span",{className:"button-emoji",children:""}),D.jsx("span",{className:"button-text",children:""})]})]}),n==="career"&&i&&D.jsxs(de.div,{className:"kids-screen career-screen",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},children:[D.jsx(de.div,{className:"big-emoji-large",animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:i.icon}),D.jsx(de.h2,{className:"kids-title",children:i.name}),D.jsx(de.p,{className:"kids-description",children:i.description}),D.jsxs("div",{className:"kids-buttons-row",children:[D.jsx(de.button,{className:"big-button back-button",onClick:()=>a("back"),whileHover:{scale:1.1},whileTap:{scale:.95},children:D.jsx("span",{className:"button-emoji",children:""})}),D.jsx(de.button,{className:"big-button finish-button",onClick:()=>a("finish"),whileHover:{scale:1.1},whileTap:{scale:.95},children:D.jsx("span",{className:"button-emoji",children:""})})]})]}),n!=="welcome"&&D.jsx("div",{className:"confetti",children:[...Array(10)].map((l,c)=>D.jsx(de.div,{className:"confetti-piece",initial:{x:Math.random()*300-150,y:-20,opacity:1},animate:{y:400,opacity:0},transition:{duration:2+Math.random()*1,repeat:1/0},children:["","","","",""][Math.floor(Math.random()*5)]},c))})]})}function CY(){const[t,e]=Y.useState(!1),[n,r]=Y.useState("home"),[i,o]=Y.useState([]),[s,a]=Y.useState(!1),[u,l]=Y.useState(!1),[c,h]=Y.useState(!0),[f,d]=Y.useState(null),[m,v]=Y.useState(null),[y,g]=Y.useState(null),[_,w]=Y.useState(null),[x,S]=Y.useState("ADULTS_18_PLUS"),A=3e4;Y.useEffect(()=>{(async()=>{const k="session-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);g(k),w(Date.now()),sessionStorage.setItem("sessionId",k),await xp("visit",k,{timestamp:new Date().toISOString(),userAgent:navigator.userAgent})})()},[]);const T=()=>{f&&clearTimeout(f);const N=setTimeout(()=>{h(!0),r("home"),a(!1),l(!1)},A);d(N)},E=()=>{c&&(h(!1),r("home")),T()};Y.useEffect(()=>{setTimeout(()=>{Tm.init()},1e3);const N=["mousedown","mousemove","keypress","scroll","touchstart","click"],k=()=>{c||T()};return N.forEach(j=>{document.addEventListener(j,k)}),()=>{f&&clearTimeout(f),N.forEach(j=>{document.removeEventListener(j,k)})}},[c]),Y.useEffect(()=>{},[]);const C=N=>{if(T(),N.skipScan&&N.goToInfo){r("explore"),o([]);return}if(N.age){v(N.age);const k=Q$(N.age);S(k.id)}o(N),N.length>0&&(hY(y,"home","explore"),r("explore"))},I=()=>{a(!0),T()},P=()=>{a(!1),T()};return D.jsxs("div",{className:"app",children:[D.jsxs("div",{className:"app-background",children:[D.jsx("div",{className:"gradient-orb orb-1"}),D.jsx("div",{className:"gradient-orb orb-2"}),D.jsx("div",{className:"gradient-orb orb-3"}),D.jsx("div",{className:"grid-overlay"})]}),D.jsxs("header",{className:"app-header",style:{display:c?"none":"flex"},children:[D.jsxs(de.div,{className:"logo",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[D.jsx("div",{className:"logo-icon",children:""}),D.jsxs("div",{className:"logo-text",children:[D.jsx("h1",{children:"Lanna Polythentic College"}),D.jsx("p",{className:"logo-subtitle",children:"Uncover Your Future"})]})]}),D.jsx("div",{className:"header-actions",children:D.jsx("button",{className:"scholarships-btn",onClick:()=>l(!0),children:" Scholarships & Fees"})})]}),c&&D.jsx(bY,{onInteraction:E}),D.jsxs("main",{className:"app-main",style:{display:c?"none":"block"},children:[n==="home"&&D.jsx(de.div,{className:"home-page",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:D.jsxs("div",{className:"hero-content",children:[D.jsxs(de.h2,{className:"hero-title",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2},children:["",D.jsx("span",{className:"gradient-text",children:" "})]}),D.jsx(de.p,{className:"hero-subtitle",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.4},children:""}),D.jsx(de.div,{className:"scan-area",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.6},children:D.jsx(fY,{onDetected:C})}),D.jsx(de.button,{className:"btn-primary",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.8},onClick:()=>r("explore"),whileHover:{scale:1.05},whileTap:{scale:.95},children:""})]})}),n==="explore"&&D.jsx(de.div,{className:"explore-page",initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:m&&m>=3&&m<13?D.jsx(EY,{careerSuggestions:i,onComplete:N=>{xp("clicked",y,{careers:N,ageGroup:"KIDS_3_12"}),a(!0)}}):D.jsx(_Y,{suggestedInterests:i,onAvatarClick:I})})]}),s&&D.jsx(yY,{onClose:P,interests:i}),u&&D.jsx(xY,{onClose:()=>l(!1)}),!1,D.jsx("footer",{className:"app-footer",style:{display:c?"none":"block"},children:D.jsx("p",{children:" 2025 College Career Guide - Powered by AI & IoT"})})]})}gv.createRoot(document.getElementById("root")).render(D.jsx(T0.StrictMode,{children:D.jsx(CY,{})}))});export default SY();
