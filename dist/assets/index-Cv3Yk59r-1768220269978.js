var nV=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var kJ=nV((VJ,CP)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function mN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $0={exports:{}},Ef={};var YC;function rV(){if(YC)return Ef;YC=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,a){var s=null;if(a!==void 0&&(s=""+a),i.key!==void 0&&(s=""+i.key),"key"in i){a={};for(var u in i)u!=="key"&&(a[u]=i[u])}else a=i;return i=a.ref,{$$typeof:n,type:r,key:s,ref:i!==void 0?i:null,props:a}}return Ef.Fragment=e,Ef.jsx=t,Ef.jsxs=t,Ef}var $C;function iV(){return $C||($C=1,$0.exports=rV()),$0.exports}var T=iV(),Q0={exports:{}},rt={};var QC;function aV(){if(QC)return rt;QC=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),s=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function v(W){return W===null||typeof W!="object"?null:(W=g&&W[g]||W["@@iterator"],typeof W=="function"?W:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,w={};function C(W,$,ce){this.props=W,this.context=$,this.refs=w,this.updater=ce||b}C.prototype.isReactComponent={},C.prototype.setState=function(W,$){if(typeof W!="object"&&typeof W!="function"&&W!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,W,$,"setState")},C.prototype.forceUpdate=function(W){this.updater.enqueueForceUpdate(this,W,"forceUpdate")};function S(){}S.prototype=C.prototype;function I(W,$,ce){this.props=W,this.context=$,this.refs=w,this.updater=ce||b}var D=I.prototype=new S;D.constructor=I,E(D,C.prototype),D.isPureReactComponent=!0;var O=Array.isArray;function B(){}var N={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function k(W,$,ce){var ve=ce.ref;return{$$typeof:n,type:W,key:$,ref:ve!==void 0?ve:null,props:ce}}function P(W,$){return k(W.type,$,W.props)}function V(W){return typeof W=="object"&&W!==null&&W.$$typeof===n}function j(W){var $={"=":"=0",":":"=2"};return"$"+W.replace(/[=:]/g,function(ce){return $[ce]})}var L=/\/+/g;function Z(W,$){return typeof W=="object"&&W!==null&&W.key!=null?j(""+W.key):$.toString(36)}function ne(W){switch(W.status){case"fulfilled":return W.value;case"rejected":throw W.reason;default:switch(typeof W.status=="string"?W.then(B,B):(W.status="pending",W.then(function($){W.status==="pending"&&(W.status="fulfilled",W.value=$)},function($){W.status==="pending"&&(W.status="rejected",W.reason=$)})),W.status){case"fulfilled":return W.value;case"rejected":throw W.reason}}throw W}function q(W,$,ce,ve,Te){var Se=typeof W;(Se==="undefined"||Se==="boolean")&&(W=null);var _e=!1;if(W===null)_e=!0;else switch(Se){case"bigint":case"string":case"number":_e=!0;break;case"object":switch(W.$$typeof){case n:case e:_e=!0;break;case d:return _e=W._init,q(_e(W._payload),$,ce,ve,Te)}}if(_e)return Te=Te(W),_e=ve===""?"."+Z(W,0):ve,O(Te)?(ce="",_e!=null&&(ce=_e.replace(L,"$&/")+"/"),q(Te,$,ce,"",function(qe){return qe})):Te!=null&&(V(Te)&&(Te=P(Te,ce+(Te.key==null||W&&W.key===Te.key?"":(""+Te.key).replace(L,"$&/")+"/")+_e)),$.push(Te)),1;_e=0;var De=ve===""?".":ve+":";if(O(W))for(var Re=0;Re<W.length;Re++)ve=W[Re],Se=De+Z(ve,Re),_e+=q(ve,$,ce,Se,Te);else if(Re=v(W),typeof Re=="function")for(W=Re.call(W),Re=0;!(ve=W.next()).done;)ve=ve.value,Se=De+Z(ve,Re++),_e+=q(ve,$,ce,Se,Te);else if(Se==="object"){if(typeof W.then=="function")return q(ne(W),$,ce,ve,Te);throw $=String(W),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(W).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return _e}function X(W,$,ce){if(W==null)return W;var ve=[],Te=0;return q(W,ve,"","",function(Se){return $.call(ce,Se,Te++)}),ve}function ee(W){if(W._status===-1){var $=W._result;$=$(),$.then(function(ce){(W._status===0||W._status===-1)&&(W._status=1,W._result=ce)},function(ce){(W._status===0||W._status===-1)&&(W._status=2,W._result=ce)}),W._status===-1&&(W._status=0,W._result=$)}if(W._status===1)return W._result.default;throw W._result}var ue=typeof reportError=="function"?reportError:function(W){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof W=="object"&&W!==null&&typeof W.message=="string"?String(W.message):String(W),error:W});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",W);return}console.error(W)},fe={map:X,forEach:function(W,$,ce){X(W,function(){$.apply(this,arguments)},ce)},count:function(W){var $=0;return X(W,function(){$++}),$},toArray:function(W){return X(W,function($){return $})||[]},only:function(W){if(!V(W))throw Error("React.Children.only expected to receive a single React element child.");return W}};return rt.Activity=p,rt.Children=fe,rt.Component=C,rt.Fragment=t,rt.Profiler=i,rt.PureComponent=I,rt.StrictMode=r,rt.Suspense=c,rt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,rt.__COMPILER_RUNTIME={__proto__:null,c:function(W){return N.H.useMemoCache(W)}},rt.cache=function(W){return function(){return W.apply(null,arguments)}},rt.cacheSignal=function(){return null},rt.cloneElement=function(W,$,ce){if(W==null)throw Error("The argument must be a React element, but you passed "+W+".");var ve=E({},W.props),Te=W.key;if($!=null)for(Se in $.key!==void 0&&(Te=""+$.key),$)!R.call($,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&$.ref===void 0||(ve[Se]=$[Se]);var Se=arguments.length-2;if(Se===1)ve.children=ce;else if(1<Se){for(var _e=Array(Se),De=0;De<Se;De++)_e[De]=arguments[De+2];ve.children=_e}return k(W.type,Te,ve)},rt.createContext=function(W){return W={$$typeof:s,_currentValue:W,_currentValue2:W,_threadCount:0,Provider:null,Consumer:null},W.Provider=W,W.Consumer={$$typeof:a,_context:W},W},rt.createElement=function(W,$,ce){var ve,Te={},Se=null;if($!=null)for(ve in $.key!==void 0&&(Se=""+$.key),$)R.call($,ve)&&ve!=="key"&&ve!=="__self"&&ve!=="__source"&&(Te[ve]=$[ve]);var _e=arguments.length-2;if(_e===1)Te.children=ce;else if(1<_e){for(var De=Array(_e),Re=0;Re<_e;Re++)De[Re]=arguments[Re+2];Te.children=De}if(W&&W.defaultProps)for(ve in _e=W.defaultProps,_e)Te[ve]===void 0&&(Te[ve]=_e[ve]);return k(W,Se,Te)},rt.createRef=function(){return{current:null}},rt.forwardRef=function(W){return{$$typeof:u,render:W}},rt.isValidElement=V,rt.lazy=function(W){return{$$typeof:d,_payload:{_status:-1,_result:W},_init:ee}},rt.memo=function(W,$){return{$$typeof:h,type:W,compare:$===void 0?null:$}},rt.startTransition=function(W){var $=N.T,ce={};N.T=ce;try{var ve=W(),Te=N.S;Te!==null&&Te(ce,ve),typeof ve=="object"&&ve!==null&&typeof ve.then=="function"&&ve.then(B,ue)}catch(Se){ue(Se)}finally{$!==null&&ce.types!==null&&($.types=ce.types),N.T=$}},rt.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},rt.use=function(W){return N.H.use(W)},rt.useActionState=function(W,$,ce){return N.H.useActionState(W,$,ce)},rt.useCallback=function(W,$){return N.H.useCallback(W,$)},rt.useContext=function(W){return N.H.useContext(W)},rt.useDebugValue=function(){},rt.useDeferredValue=function(W,$){return N.H.useDeferredValue(W,$)},rt.useEffect=function(W,$){return N.H.useEffect(W,$)},rt.useEffectEvent=function(W){return N.H.useEffectEvent(W)},rt.useId=function(){return N.H.useId()},rt.useImperativeHandle=function(W,$,ce){return N.H.useImperativeHandle(W,$,ce)},rt.useInsertionEffect=function(W,$){return N.H.useInsertionEffect(W,$)},rt.useLayoutEffect=function(W,$){return N.H.useLayoutEffect(W,$)},rt.useMemo=function(W,$){return N.H.useMemo(W,$)},rt.useOptimistic=function(W,$){return N.H.useOptimistic(W,$)},rt.useReducer=function(W,$,ce){return N.H.useReducer(W,$,ce)},rt.useRef=function(W){return N.H.useRef(W)},rt.useState=function(W){return N.H.useState(W)},rt.useSyncExternalStore=function(W,$,ce){return N.H.useSyncExternalStore(W,$,ce)},rt.useTransition=function(){return N.H.useTransition()},rt.version="19.2.3",rt}var ZC;function L1(){return ZC||(ZC=1,Q0.exports=aV()),Q0.exports}var re=L1();const sV=mN(re);var Z0={exports:{}},Tf={},J0={exports:{}},e_={};var JC;function oV(){return JC||(JC=1,(function(n){function e(q,X){var ee=q.length;q.push(X);e:for(;0<ee;){var ue=ee-1>>>1,fe=q[ue];if(0<i(fe,X))q[ue]=X,q[ee]=fe,ee=ue;else break e}}function t(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var X=q[0],ee=q.pop();if(ee!==X){q[0]=ee;e:for(var ue=0,fe=q.length,W=fe>>>1;ue<W;){var $=2*(ue+1)-1,ce=q[$],ve=$+1,Te=q[ve];if(0>i(ce,ee))ve<fe&&0>i(Te,ce)?(q[ue]=Te,q[ve]=ee,ue=ve):(q[ue]=ce,q[$]=ee,ue=$);else if(ve<fe&&0>i(Te,ee))q[ue]=Te,q[ve]=ee,ue=ve;else break e}}return X}function i(q,X){var ee=q.sortIndex-X.sortIndex;return ee!==0?ee:q.id-X.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();n.unstable_now=function(){return s.now()-u}}var c=[],h=[],d=1,p=null,g=3,v=!1,b=!1,E=!1,w=!1,C=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function D(q){for(var X=t(h);X!==null;){if(X.callback===null)r(h);else if(X.startTime<=q)r(h),X.sortIndex=X.expirationTime,e(c,X);else break;X=t(h)}}function O(q){if(E=!1,D(q),!b)if(t(c)!==null)b=!0,B||(B=!0,j());else{var X=t(h);X!==null&&ne(O,X.startTime-q)}}var B=!1,N=-1,R=5,k=-1;function P(){return w?!0:!(n.unstable_now()-k<R)}function V(){if(w=!1,B){var q=n.unstable_now();k=q;var X=!0;try{e:{b=!1,E&&(E=!1,S(N),N=-1),v=!0;var ee=g;try{t:{for(D(q),p=t(c);p!==null&&!(p.expirationTime>q&&P());){var ue=p.callback;if(typeof ue=="function"){p.callback=null,g=p.priorityLevel;var fe=ue(p.expirationTime<=q);if(q=n.unstable_now(),typeof fe=="function"){p.callback=fe,D(q),X=!0;break t}p===t(c)&&r(c),D(q)}else r(c);p=t(c)}if(p!==null)X=!0;else{var W=t(h);W!==null&&ne(O,W.startTime-q),X=!1}}break e}finally{p=null,g=ee,v=!1}X=void 0}}finally{X?j():B=!1}}}var j;if(typeof I=="function")j=function(){I(V)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,Z=L.port2;L.port1.onmessage=V,j=function(){Z.postMessage(null)}}else j=function(){C(V,0)};function ne(q,X){N=C(function(){q(n.unstable_now())},X)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(q){q.callback=null},n.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<q?Math.floor(1e3/q):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_next=function(q){switch(g){case 1:case 2:case 3:var X=3;break;default:X=g}var ee=g;g=X;try{return q()}finally{g=ee}},n.unstable_requestPaint=function(){w=!0},n.unstable_runWithPriority=function(q,X){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ee=g;g=q;try{return X()}finally{g=ee}},n.unstable_scheduleCallback=function(q,X,ee){var ue=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?ue+ee:ue):ee=ue,q){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=ee+fe,q={id:d++,callback:X,priorityLevel:q,startTime:ee,expirationTime:fe,sortIndex:-1},ee>ue?(q.sortIndex=ee,e(h,q),t(c)===null&&q===t(h)&&(E?(S(N),N=-1):E=!0,ne(O,ee-ue))):(q.sortIndex=fe,e(c,q),b||v||(b=!0,B||(B=!0,j()))),q},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(q){var X=g;return function(){var ee=g;g=X;try{return q.apply(this,arguments)}finally{g=ee}}}})(e_)),e_}var eS;function uV(){return eS||(eS=1,J0.exports=oV()),J0.exports}var t_={exports:{}},br={};var tS;function lV(){if(tS)return br;tS=1;var n=L1();function e(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(c,h,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:c,containerInfo:h,implementation:d}}var s=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(c,h){if(c==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return br.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,br.createPortal=function(c,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return a(c,h,null,d)},br.flushSync=function(c){var h=s.T,d=r.p;try{if(s.T=null,r.p=2,c)return c()}finally{s.T=h,r.p=d,r.d.f()}},br.preconnect=function(c,h){typeof c=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(c,h))},br.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},br.preinit=function(c,h){if(typeof c=="string"&&h&&typeof h.as=="string"){var d=h.as,p=u(d,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?r.d.S(c,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:v}):d==="script"&&r.d.X(c,{crossOrigin:p,integrity:g,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},br.preinitModule=function(c,h){if(typeof c=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=u(h.as,h.crossOrigin);r.d.M(c,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(c)},br.preload=function(c,h){if(typeof c=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,p=u(d,h.crossOrigin);r.d.L(c,d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},br.preloadModule=function(c,h){if(typeof c=="string")if(h){var d=u(h.as,h.crossOrigin);r.d.m(c,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(c)},br.requestFormReset=function(c){r.d.r(c)},br.unstable_batchedUpdates=function(c,h){return c(h)},br.useFormState=function(c,h,d){return s.H.useFormState(c,h,d)},br.useFormStatus=function(){return s.H.useHostTransitionStatus()},br.version="19.2.3",br}var nS;function cV(){if(nS)return t_.exports;nS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),t_.exports=lV(),t_.exports}var rS;function hV(){if(rS)return Tf;rS=1;var n=uV(),e=L1(),t=cV();function r(o){var l="https://react.dev/errors/"+o;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function a(o){var l=o,f=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(f=l.return),o=l.return;while(o)}return l.tag===3?f:null}function s(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function u(o){if(o.tag===31){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function c(o){if(a(o)!==o)throw Error(r(188))}function h(o){var l=o.alternate;if(!l){if(l=a(o),l===null)throw Error(r(188));return l!==o?null:o}for(var f=o,m=l;;){var _=f.return;if(_===null)break;var x=_.alternate;if(x===null){if(m=_.return,m!==null){f=m;continue}break}if(_.child===x.child){for(x=_.child;x;){if(x===f)return c(_),o;if(x===m)return c(_),l;x=x.sibling}throw Error(r(188))}if(f.return!==m.return)f=_,m=x;else{for(var M=!1,U=_.child;U;){if(U===f){M=!0,f=_,m=x;break}if(U===m){M=!0,m=_,f=x;break}U=U.sibling}if(!M){for(U=x.child;U;){if(U===f){M=!0,f=x,m=_;break}if(U===m){M=!0,m=x,f=_;break}U=U.sibling}if(!M)throw Error(r(189))}}if(f.alternate!==m)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?o:l}function d(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o;for(o=o.child;o!==null;){if(l=d(o),l!==null)return l;o=o.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),I=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function j(o){return o===null||typeof o!="object"?null:(o=V&&o[V]||o["@@iterator"],typeof o=="function"?o:null)}var L=Symbol.for("react.client.reference");function Z(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===L?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case E:return"Fragment";case C:return"Profiler";case w:return"StrictMode";case O:return"Suspense";case B:return"SuspenseList";case k:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case b:return"Portal";case I:return o.displayName||"Context";case S:return(o._context.displayName||"Context")+".Consumer";case D:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case N:return l=o.displayName||null,l!==null?l:Z(o.type)||"Memo";case R:l=o._payload,o=o._init;try{return Z(o(l))}catch{}}return null}var ne=Array.isArray,q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},ue=[],fe=-1;function W(o){return{current:o}}function $(o){0>fe||(o.current=ue[fe],ue[fe]=null,fe--)}function ce(o,l){fe++,ue[fe]=o.current,o.current=l}var ve=W(null),Te=W(null),Se=W(null),_e=W(null);function De(o,l){switch(ce(Se,l),ce(Te,o),ce(ve,null),l.nodeType){case 9:case 11:o=(o=l.documentElement)&&(o=o.namespaceURI)?yC(o):0;break;default:if(o=l.tagName,l=l.namespaceURI)l=yC(l),o=_C(l,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}$(ve),ce(ve,o)}function Re(){$(ve),$(Te),$(Se)}function qe(o){o.memoizedState!==null&&ce(_e,o);var l=ve.current,f=_C(l,o.type);l!==f&&(ce(Te,o),ce(ve,f))}function et(o){Te.current===o&&($(ve),$(Te)),_e.current===o&&($(_e),_f._currentValue=ee)}var Ze,Xe;function st(o){if(Ze===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);Ze=l&&l[1]||"",Xe=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ze+o+Xe}var Qe=!1;function ot(o,l){if(!o||Qe)return"";Qe=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var xe=function(){throw Error()};if(Object.defineProperty(xe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xe,[])}catch(de){var oe=de}Reflect.construct(o,[],xe)}else{try{xe.call()}catch(de){oe=de}o.call(xe.prototype)}}else{try{throw Error()}catch(de){oe=de}(xe=o())&&typeof xe.catch=="function"&&xe.catch(function(){})}}catch(de){if(de&&oe&&typeof de.stack=="string")return[de.stack,oe.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=m.DetermineComponentFrameRoot(),M=x[0],U=x[1];if(M&&U){var K=M.split(`
`),se=U.split(`
`);for(_=m=0;m<K.length&&!K[m].includes("DetermineComponentFrameRoot");)m++;for(;_<se.length&&!se[_].includes("DetermineComponentFrameRoot");)_++;if(m===K.length||_===se.length)for(m=K.length-1,_=se.length-1;1<=m&&0<=_&&K[m]!==se[_];)_--;for(;1<=m&&0<=_;m--,_--)if(K[m]!==se[_]){if(m!==1||_!==1)do if(m--,_--,0>_||K[m]!==se[_]){var me=`
`+K[m].replace(" at new "," at ");return o.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",o.displayName)),me}while(1<=m&&0<=_);break}}}finally{Qe=!1,Error.prepareStackTrace=f}return(f=o?o.displayName||o.name:"")?st(f):""}function Xn(o,l){switch(o.tag){case 26:case 27:case 5:return st(o.type);case 16:return st("Lazy");case 13:return o.child!==l&&l!==null?st("Suspense Fallback"):st("Suspense");case 19:return st("SuspenseList");case 0:case 15:return ot(o.type,!1);case 11:return ot(o.type.render,!1);case 1:return ot(o.type,!0);case 31:return st("Activity");default:return""}}function xn(o){try{var l="",f=null;do l+=Xn(o,f),f=o,o=o.return;while(o);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Ye=Object.prototype.hasOwnProperty,Rt=n.unstable_scheduleCallback,wn=n.unstable_cancelCallback,jr=n.unstable_shouldYield,yr=n.unstable_requestPaint,tn=n.unstable_now,ar=n.unstable_getCurrentPriorityLevel,is=n.unstable_ImmediatePriority,bi=n.unstable_UserBlockingPriority,Ln=n.unstable_NormalPriority,au=n.unstable_LowPriority,gl=n.unstable_IdlePriority,vl=n.log,yl=n.unstable_setDisableYieldValue,Or=null,pn=null;function _r(o){if(typeof vl=="function"&&yl(o),pn&&typeof pn.setStrictMode=="function")try{pn.setStrictMode(Or,o)}catch{}}var mn=Math.clz32?Math.clz32:tp,ep=Math.log,_l=Math.LN2;function tp(o){return o>>>=0,o===0?32:31-(ep(o)/_l|0)|0}var da=256,su=262144,En=4194304;function pa(o){var l=o&42;if(l!==0)return l;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return o&261888;case 262144:case 524288:case 1048576:case 2097152:return o&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function ma(o,l,f){var m=o.pendingLanes;if(m===0)return 0;var _=0,x=o.suspendedLanes,M=o.pingedLanes;o=o.warmLanes;var U=m&134217727;return U!==0?(m=U&~x,m!==0?_=pa(m):(M&=U,M!==0?_=pa(M):f||(f=U&~o,f!==0&&(_=pa(f))))):(U=m&~x,U!==0?_=pa(U):M!==0?_=pa(M):f||(f=m&~o,f!==0&&(_=pa(f)))),_===0?0:l!==0&&l!==_&&(l&x)===0&&(x=_&-_,f=l&-l,x>=f||x===32&&(f&4194048)!==0)?l:_}function Gi(o,l){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&l)===0}function ey(o,l){switch(o){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function np(){var o=En;return En<<=1,(En&62914560)===0&&(En=4194304),o}function ga(o){for(var l=[],f=0;31>f;f++)l.push(o);return l}function ou(o,l){o.pendingLanes|=l,l!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function ty(o,l,f,m,_,x){var M=o.pendingLanes;o.pendingLanes=f,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=f,o.entangledLanes&=f,o.errorRecoveryDisabledLanes&=f,o.shellSuspendCounter=0;var U=o.entanglements,K=o.expirationTimes,se=o.hiddenUpdates;for(f=M&~f;0<f;){var me=31-mn(f),xe=1<<me;U[me]=0,K[me]=-1;var oe=se[me];if(oe!==null)for(se[me]=null,me=0;me<oe.length;me++){var de=oe[me];de!==null&&(de.lane&=-536870913)}f&=~xe}m!==0&&uu(o,m,0),x!==0&&_===0&&o.tag!==0&&(o.suspendedLanes|=x&~(M&~l))}function uu(o,l,f){o.pendingLanes|=l,o.suspendedLanes&=~l;var m=31-mn(l);o.entangledLanes|=l,o.entanglements[m]=o.entanglements[m]|1073741824|f&261930}function Eh(o,l){var f=o.entangledLanes|=l;for(o=o.entanglements;f;){var m=31-mn(f),_=1<<m;_&l|o[m]&l&&(o[m]|=l),f&=~_}}function Th(o,l){var f=l&-l;return f=(f&42)!==0?1:lu(f),(f&(o.suspendedLanes|l))!==0?0:f}function lu(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function as(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function rp(){var o=X.p;return o!==0?o:(o=window.event,o===void 0?32:zC(o.type))}function Wi(o,l){var f=X.p;try{return X.p=o,l()}finally{X.p=f}}var qi=Math.random().toString(36).slice(2),Tn="__reactFiber$"+qi,Yn="__reactProps$"+qi,va="__reactContainer$"+qi,bl="__reactEvents$"+qi,ny="__reactListeners$"+qi,ip="__reactHandles$"+qi,ap="__reactResources$"+qi,ya="__reactMarker$"+qi;function xl(o){delete o[Tn],delete o[Yn],delete o[bl],delete o[ny],delete o[ip]}function _a(o){var l=o[Tn];if(l)return l;for(var f=o.parentNode;f;){if(l=f[va]||f[Tn]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(o=SC(o);o!==null;){if(f=o[Tn])return f;o=SC(o)}return l}o=f,f=o.parentNode}return null}function xi(o){if(o=o[Tn]||o[va]){var l=o.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return o}return null}function ri(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o.stateNode;throw Error(r(33))}function ba(o){var l=o[ap];return l||(l=o[ap]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Cn(o){o[ya]=!0}var Ch=new Set,Sh={};function xa(o,l){wa(o,l),wa(o+"Capture",l)}function wa(o,l){for(Sh[o]=l,o=0;o<l.length;o++)Ch.add(l[o])}var Ah=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Rh={},Ih={};function sp(o){return Ye.call(Ih,o)?!0:Ye.call(Rh,o)?!1:Ah.test(o)?Ih[o]=!0:(Rh[o]=!0,!1)}function wl(o,l,f){if(sp(l))if(f===null)o.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":o.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){o.removeAttribute(l);return}}o.setAttribute(l,""+f)}}function ii(o,l,f){if(f===null)o.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(l);return}o.setAttribute(l,""+f)}}function Sn(o,l,f,m){if(m===null)o.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttributeNS(l,f,""+m)}}function $n(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function qs(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Nh(o,l,f){var m=Object.getOwnPropertyDescriptor(o.constructor.prototype,l);if(!o.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var _=m.get,x=m.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return _.call(this)},set:function(M){f=""+M,x.call(this,M)}}),Object.defineProperty(o,l,{enumerable:m.enumerable}),{getValue:function(){return f},setValue:function(M){f=""+M},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function Vt(o){if(!o._valueTracker){var l=qs(o)?"checked":"value";o._valueTracker=Nh(o,l,""+o[l])}}function cu(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var f=l.getValue(),m="";return o&&(m=qs(o)?o.checked?"true":"false":o.value),o=m,o!==f?(l.setValue(o),!0):!1}function Ea(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var hu=/[\n"\\]/g;function Ur(o){return o.replace(hu,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function El(o,l,f,m,_,x,M,U){o.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?o.type=M:o.removeAttribute("type"),l!=null?M==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+$n(l)):o.value!==""+$n(l)&&(o.value=""+$n(l)):M!=="submit"&&M!=="reset"||o.removeAttribute("value"),l!=null?Dh(o,M,$n(l)):f!=null?Dh(o,M,$n(f)):m!=null&&o.removeAttribute("value"),_==null&&x!=null&&(o.defaultChecked=!!x),_!=null&&(o.checked=_&&typeof _!="function"&&typeof _!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?o.name=""+$n(U):o.removeAttribute("name")}function op(o,l,f,m,_,x,M,U){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(o.type=x),l!=null||f!=null){if(!(x!=="submit"&&x!=="reset"||l!=null)){Vt(o);return}f=f!=null?""+$n(f):"",l=l!=null?""+$n(l):f,U||l===o.value||(o.value=l),o.defaultValue=l}m=m??_,m=typeof m!="function"&&typeof m!="symbol"&&!!m,o.checked=U?o.checked:!!m,o.defaultChecked=!!m,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(o.name=M),Vt(o)}function Dh(o,l,f){l==="number"&&Ea(o.ownerDocument)===o||o.defaultValue===""+f||(o.defaultValue=""+f)}function Ks(o,l,f,m){if(o=o.options,l){l={};for(var _=0;_<f.length;_++)l["$"+f[_]]=!0;for(f=0;f<o.length;f++)_=l.hasOwnProperty("$"+o[f].value),o[f].selected!==_&&(o[f].selected=_),_&&m&&(o[f].defaultSelected=!0)}else{for(f=""+$n(f),l=null,_=0;_<o.length;_++){if(o[_].value===f){o[_].selected=!0,m&&(o[_].defaultSelected=!0);return}l!==null||o[_].disabled||(l=o[_])}l!==null&&(l.selected=!0)}}function up(o,l,f){if(l!=null&&(l=""+$n(l),l!==o.value&&(o.value=l),f==null)){o.defaultValue!==l&&(o.defaultValue=l);return}o.defaultValue=f!=null?""+$n(f):""}function Xs(o,l,f,m){if(l==null){if(m!=null){if(f!=null)throw Error(r(92));if(ne(m)){if(1<m.length)throw Error(r(93));m=m[0]}f=m}f==null&&(f=""),l=f}f=$n(l),o.defaultValue=f,m=o.textContent,m===f&&m!==""&&m!==null&&(o.value=m),Vt(o)}function zr(o,l){if(l){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=l;return}}o.textContent=l}var lp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kh(o,l,f){var m=l.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?o.setProperty(l,""):l==="float"?o.cssFloat="":o[l]="":m?o.setProperty(l,f):typeof f!="number"||f===0||lp.has(l)?l==="float"?o.cssFloat=f:o[l]=(""+f).trim():o[l]=f+"px"}function Mh(o,l,f){if(l!=null&&typeof l!="object")throw Error(r(62));if(o=o.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?o.setProperty(m,""):m==="float"?o.cssFloat="":o[m]="");for(var _ in l)m=l[_],l.hasOwnProperty(_)&&f[_]!==m&&kh(o,_,m)}else for(var x in l)l.hasOwnProperty(x)&&kh(o,x,l[x])}function Tl(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ys=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Cl(o){return Ys.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}function Ki(){}var Oh=null;function wi(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var $s=null,Ta=null;function fu(o){var l=xi(o);if(l&&(o=l.stateNode)){var f=o[Yn]||null;e:switch(o=l.stateNode,l.type){case"input":if(El(o,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),l=f.name,f.type==="radio"&&l!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Ur(""+l)+'"][type="radio"]'),l=0;l<f.length;l++){var m=f[l];if(m!==o&&m.form===o.form){var _=m[Yn]||null;if(!_)throw Error(r(90));El(m,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(l=0;l<f.length;l++)m=f[l],m.form===o.form&&cu(m)}break e;case"textarea":up(o,f.value,f.defaultValue);break e;case"select":l=f.value,l!=null&&Ks(o,!!f.multiple,l,!1)}}}var Sl=!1;function Qs(o,l,f){if(Sl)return o(l,f);Sl=!0;try{var m=o(l);return m}finally{if(Sl=!1,($s!==null||Ta!==null)&&(rm(),$s&&(l=$s,o=Ta,Ta=$s=null,fu(l),o)))for(l=0;l<o.length;l++)fu(o[l])}}function Xi(o,l){var f=o.stateNode;if(f===null)return null;var m=f[Yn]||null;if(m===null)return null;f=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(o=o.type,m=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!m;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(r(231,l,typeof f));return f}var Ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),du=!1;if(Ei)try{var jt={};Object.defineProperty(jt,"passive",{get:function(){du=!0}}),window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,jt)}catch{du=!1}var Ca=null,Ph=null,pu=null;function Fh(){if(pu)return pu;var o,l=Ph,f=l.length,m,_="value"in Ca?Ca.value:Ca.textContent,x=_.length;for(o=0;o<f&&l[o]===_[o];o++);var M=f-o;for(m=1;m<=M&&l[f-m]===_[x-m];m++);return pu=_.slice(o,1<m?1-m:void 0)}function mu(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function ss(){return!0}function Yi(){return!1}function sr(o){function l(f,m,_,x,M){this._reactName=f,this._targetInst=_,this.type=m,this.nativeEvent=x,this.target=M,this.currentTarget=null;for(var U in o)o.hasOwnProperty(U)&&(f=o[U],this[U]=f?f(x):x[U]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?ss:Yi,this.isPropagationStopped=Yi,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),l}var os={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sa=sr(os),Zs=p({},os,{view:0,detail:0}),Vh=sr(Zs),Js,Al,Aa,Rl=p({},Zs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eo,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Aa&&(Aa&&o.type==="mousemove"?(Js=o.screenX-Aa.screenX,Al=o.screenY-Aa.screenY):Al=Js=0,Aa=o),Js)},movementY:function(o){return"movementY"in o?o.movementY:Al}}),Lh=sr(Rl),gu=p({},Rl,{dataTransfer:0}),hp=sr(gu),fp=p({},Zs,{relatedTarget:0}),vu=sr(fp),Bh=p({},os,{animationName:0,elapsedTime:0,pseudoElement:0}),dp=sr(Bh),Il=p({},os,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),pp=sr(Il),mp=p({},os,{data:0}),Ra=sr(mp),gp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _p(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=yp[o])?!!l[o]:!1}function eo(){return _p}var Pr=p({},Zs,{key:function(o){if(o.key){var l=gp[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=mu(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?vp[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eo,charCode:function(o){return o.type==="keypress"?mu(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?mu(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),bp=sr(Pr),xp=p({},Rl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),us=sr(xp),y=p({},Zs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eo}),A=sr(y),F=p({},os,{propertyName:0,elapsedTime:0,pseudoElement:0}),H=sr(F),ie=p({},Rl,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),he=sr(ie),Ce=p({},os,{newState:0,oldState:0}),ut=sr(Ce),gn=[9,13,27,32],Dt=Ei&&"CompositionEvent"in window,nn=null;Ei&&"documentMode"in document&&(nn=document.documentMode);var Ti=Ei&&"TextEvent"in window&&!nn,Ia=Ei&&(!Dt||nn&&8<nn&&11>=nn),$i=" ",Qi=!1;function yu(o,l){switch(o){case"keyup":return gn.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nl(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Dl=!1;function SP(o,l){switch(o){case"compositionend":return Nl(l);case"keypress":return l.which!==32?null:(Qi=!0,$i);case"textInput":return o=l.data,o===$i&&Qi?null:o;default:return null}}function AP(o,l){if(Dl)return o==="compositionend"||!Dt&&yu(o,l)?(o=Fh(),pu=Ph=Ca=null,Dl=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return Ia&&l.locale!=="ko"?null:l.data;default:return null}}var RP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function IE(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!RP[o.type]:l==="textarea"}function NE(o,l,f,m){$s?Ta?Ta.push(m):Ta=[m]:$s=m,l=cm(l,"onChange"),0<l.length&&(f=new Sa("onChange","change",null,f,m),o.push({event:f,listeners:l}))}var jh=null,Uh=null;function IP(o){fC(o,0)}function wp(o){var l=ri(o);if(cu(l))return o}function DE(o,l){if(o==="change")return l}var kE=!1;if(Ei){var ry;if(Ei){var iy="oninput"in document;if(!iy){var ME=document.createElement("div");ME.setAttribute("oninput","return;"),iy=typeof ME.oninput=="function"}ry=iy}else ry=!1;kE=ry&&(!document.documentMode||9<document.documentMode)}function OE(){jh&&(jh.detachEvent("onpropertychange",PE),Uh=jh=null)}function PE(o){if(o.propertyName==="value"&&wp(Uh)){var l=[];NE(l,Uh,o,wi(o)),Qs(IP,l)}}function NP(o,l,f){o==="focusin"?(OE(),jh=l,Uh=f,jh.attachEvent("onpropertychange",PE)):o==="focusout"&&OE()}function DP(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return wp(Uh)}function kP(o,l){if(o==="click")return wp(l)}function MP(o,l){if(o==="input"||o==="change")return wp(l)}function OP(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var ai=typeof Object.is=="function"?Object.is:OP;function zh(o,l){if(ai(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var f=Object.keys(o),m=Object.keys(l);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var _=f[m];if(!Ye.call(l,_)||!ai(o[_],l[_]))return!1}return!0}function FE(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function VE(o,l){var f=FE(o);o=0;for(var m;f;){if(f.nodeType===3){if(m=o+f.textContent.length,o<=l&&m>=l)return{node:f,offset:l-o};o=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=FE(f)}}function LE(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?LE(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function BE(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var l=Ea(o.document);l instanceof o.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)o=l.contentWindow;else break;l=Ea(o.document)}return l}function ay(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var PP=Ei&&"documentMode"in document&&11>=document.documentMode,kl=null,sy=null,Hh=null,oy=!1;function jE(o,l,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;oy||kl==null||kl!==Ea(m)||(m=kl,"selectionStart"in m&&ay(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Hh&&zh(Hh,m)||(Hh=m,m=cm(sy,"onSelect"),0<m.length&&(l=new Sa("onSelect","select",null,l,f),o.push({event:l,listeners:m}),l.target=kl)))}function _u(o,l){var f={};return f[o.toLowerCase()]=l.toLowerCase(),f["Webkit"+o]="webkit"+l,f["Moz"+o]="moz"+l,f}var Ml={animationend:_u("Animation","AnimationEnd"),animationiteration:_u("Animation","AnimationIteration"),animationstart:_u("Animation","AnimationStart"),transitionrun:_u("Transition","TransitionRun"),transitionstart:_u("Transition","TransitionStart"),transitioncancel:_u("Transition","TransitionCancel"),transitionend:_u("Transition","TransitionEnd")},uy={},UE={};Ei&&(UE=document.createElement("div").style,"AnimationEvent"in window||(delete Ml.animationend.animation,delete Ml.animationiteration.animation,delete Ml.animationstart.animation),"TransitionEvent"in window||delete Ml.transitionend.transition);function bu(o){if(uy[o])return uy[o];if(!Ml[o])return o;var l=Ml[o],f;for(f in l)if(l.hasOwnProperty(f)&&f in UE)return uy[o]=l[f];return o}var zE=bu("animationend"),HE=bu("animationiteration"),GE=bu("animationstart"),FP=bu("transitionrun"),VP=bu("transitionstart"),LP=bu("transitioncancel"),WE=bu("transitionend"),qE=new Map,ly="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ly.push("scrollEnd");function Zi(o,l){qE.set(o,l),xa(l,[o])}var Ep=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)},Ci=[],Ol=0,cy=0;function Tp(){for(var o=Ol,l=cy=Ol=0;l<o;){var f=Ci[l];Ci[l++]=null;var m=Ci[l];Ci[l++]=null;var _=Ci[l];Ci[l++]=null;var x=Ci[l];if(Ci[l++]=null,m!==null&&_!==null){var M=m.pending;M===null?_.next=_:(_.next=M.next,M.next=_),m.pending=_}x!==0&&KE(f,_,x)}}function Cp(o,l,f,m){Ci[Ol++]=o,Ci[Ol++]=l,Ci[Ol++]=f,Ci[Ol++]=m,cy|=m,o.lanes|=m,o=o.alternate,o!==null&&(o.lanes|=m)}function hy(o,l,f,m){return Cp(o,l,f,m),Sp(o)}function xu(o,l){return Cp(o,null,null,l),Sp(o)}function KE(o,l,f){o.lanes|=f;var m=o.alternate;m!==null&&(m.lanes|=f);for(var _=!1,x=o.return;x!==null;)x.childLanes|=f,m=x.alternate,m!==null&&(m.childLanes|=f),x.tag===22&&(o=x.stateNode,o===null||o._visibility&1||(_=!0)),o=x,x=x.return;return o.tag===3?(x=o.stateNode,_&&l!==null&&(_=31-mn(f),o=x.hiddenUpdates,m=o[_],m===null?o[_]=[l]:m.push(l),l.lane=f|536870912),x):null}function Sp(o){if(50<ff)throw ff=0,b0=null,Error(r(185));for(var l=o.return;l!==null;)o=l,l=o.return;return o.tag===3?o.stateNode:null}var Pl={};function BP(o,l,f,m){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function si(o,l,f,m){return new BP(o,l,f,m)}function fy(o){return o=o.prototype,!(!o||!o.isReactComponent)}function ls(o,l){var f=o.alternate;return f===null?(f=si(o.tag,l,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=l,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&65011712,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,l=o.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f.refCleanup=o.refCleanup,f}function XE(o,l){o.flags&=65011714;var f=o.alternate;return f===null?(o.childLanes=0,o.lanes=l,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=f.childLanes,o.lanes=f.lanes,o.child=f.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=f.memoizedProps,o.memoizedState=f.memoizedState,o.updateQueue=f.updateQueue,o.type=f.type,l=f.dependencies,o.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),o}function Ap(o,l,f,m,_,x){var M=0;if(m=o,typeof o=="function")fy(o)&&(M=1);else if(typeof o=="string")M=GF(o,f,ve.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case k:return o=si(31,f,l,_),o.elementType=k,o.lanes=x,o;case E:return wu(f.children,_,x,l);case w:M=8,_|=24;break;case C:return o=si(12,f,l,_|2),o.elementType=C,o.lanes=x,o;case O:return o=si(13,f,l,_),o.elementType=O,o.lanes=x,o;case B:return o=si(19,f,l,_),o.elementType=B,o.lanes=x,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case I:M=10;break e;case S:M=9;break e;case D:M=11;break e;case N:M=14;break e;case R:M=16,m=null;break e}M=29,f=Error(r(130,o===null?"null":typeof o,"")),m=null}return l=si(M,f,l,_),l.elementType=o,l.type=m,l.lanes=x,l}function wu(o,l,f,m){return o=si(7,o,m,l),o.lanes=f,o}function dy(o,l,f){return o=si(6,o,null,l),o.lanes=f,o}function YE(o){var l=si(18,null,null,0);return l.stateNode=o,l}function py(o,l,f){return l=si(4,o.children!==null?o.children:[],o.key,l),l.lanes=f,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}var $E=new WeakMap;function Si(o,l){if(typeof o=="object"&&o!==null){var f=$E.get(o);return f!==void 0?f:(l={value:o,source:l,stack:xn(l)},$E.set(o,l),l)}return{value:o,source:l,stack:xn(l)}}var Fl=[],Vl=0,Rp=null,Gh=0,Ai=[],Ri=0,to=null,Na=1,Da="";function cs(o,l){Fl[Vl++]=Gh,Fl[Vl++]=Rp,Rp=o,Gh=l}function QE(o,l,f){Ai[Ri++]=Na,Ai[Ri++]=Da,Ai[Ri++]=to,to=o;var m=Na;o=Da;var _=32-mn(m)-1;m&=~(1<<_),f+=1;var x=32-mn(l)+_;if(30<x){var M=_-_%5;x=(m&(1<<M)-1).toString(32),m>>=M,_-=M,Na=1<<32-mn(l)+_|f<<_|m,Da=x+o}else Na=1<<x|f<<_|m,Da=o}function my(o){o.return!==null&&(cs(o,1),QE(o,1,0))}function gy(o){for(;o===Rp;)Rp=Fl[--Vl],Fl[Vl]=null,Gh=Fl[--Vl],Fl[Vl]=null;for(;o===to;)to=Ai[--Ri],Ai[Ri]=null,Da=Ai[--Ri],Ai[Ri]=null,Na=Ai[--Ri],Ai[Ri]=null}function ZE(o,l){Ai[Ri++]=Na,Ai[Ri++]=Da,Ai[Ri++]=to,Na=l.id,Da=l.overflow,to=o}var or=null,Xt=null,bt=!1,no=null,Ii=!1,vy=Error(r(519));function ro(o){var l=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Wh(Si(l,o)),vy}function JE(o){var l=o.stateNode,f=o.type,m=o.memoizedProps;switch(l[Tn]=o,l[Yn]=m,f){case"dialog":pt("cancel",l),pt("close",l);break;case"iframe":case"object":case"embed":pt("load",l);break;case"video":case"audio":for(f=0;f<pf.length;f++)pt(pf[f],l);break;case"source":pt("error",l);break;case"img":case"image":case"link":pt("error",l),pt("load",l);break;case"details":pt("toggle",l);break;case"input":pt("invalid",l),op(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":pt("invalid",l);break;case"textarea":pt("invalid",l),Xs(l,m.value,m.defaultValue,m.children)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||l.textContent===""+f||m.suppressHydrationWarning===!0||gC(l.textContent,f)?(m.popover!=null&&(pt("beforetoggle",l),pt("toggle",l)),m.onScroll!=null&&pt("scroll",l),m.onScrollEnd!=null&&pt("scrollend",l),m.onClick!=null&&(l.onclick=Ki),l=!0):l=!1,l||ro(o,!0)}function e2(o){for(or=o.return;or;)switch(or.tag){case 5:case 31:case 13:Ii=!1;return;case 27:case 3:Ii=!0;return;default:or=or.return}}function Ll(o){if(o!==or)return!1;if(!bt)return e2(o),bt=!0,!1;var l=o.tag,f;if((f=l!==3&&l!==27)&&((f=l===5)&&(f=o.type,f=!(f!=="form"&&f!=="button")||P0(o.type,o.memoizedProps)),f=!f),f&&Xt&&ro(o),e2(o),l===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(r(317));Xt=CC(o)}else if(l===31){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(r(317));Xt=CC(o)}else l===27?(l=Xt,yo(o.type)?(o=j0,j0=null,Xt=o):Xt=l):Xt=or?Di(o.stateNode.nextSibling):null;return!0}function Eu(){Xt=or=null,bt=!1}function yy(){var o=no;return o!==null&&(qr===null?qr=o:qr.push.apply(qr,o),no=null),o}function Wh(o){no===null?no=[o]:no.push(o)}var _y=W(null),Tu=null,hs=null;function io(o,l,f){ce(_y,l._currentValue),l._currentValue=f}function fs(o){o._currentValue=_y.current,$(_y)}function by(o,l,f){for(;o!==null;){var m=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),o===f)break;o=o.return}}function xy(o,l,f,m){var _=o.child;for(_!==null&&(_.return=o);_!==null;){var x=_.dependencies;if(x!==null){var M=_.child;x=x.firstContext;e:for(;x!==null;){var U=x;x=_;for(var K=0;K<l.length;K++)if(U.context===l[K]){x.lanes|=f,U=x.alternate,U!==null&&(U.lanes|=f),by(x.return,f,o),m||(M=null);break e}x=U.next}}else if(_.tag===18){if(M=_.return,M===null)throw Error(r(341));M.lanes|=f,x=M.alternate,x!==null&&(x.lanes|=f),by(M,f,o),M=null}else M=_.child;if(M!==null)M.return=_;else for(M=_;M!==null;){if(M===o){M=null;break}if(_=M.sibling,_!==null){_.return=M.return,M=_;break}M=M.return}_=M}}function Bl(o,l,f,m){o=null;for(var _=l,x=!1;_!==null;){if(!x){if((_.flags&524288)!==0)x=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var M=_.alternate;if(M===null)throw Error(r(387));if(M=M.memoizedProps,M!==null){var U=_.type;ai(_.pendingProps.value,M.value)||(o!==null?o.push(U):o=[U])}}else if(_===_e.current){if(M=_.alternate,M===null)throw Error(r(387));M.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(o!==null?o.push(_f):o=[_f])}_=_.return}o!==null&&xy(l,o,f,m),l.flags|=262144}function Ip(o){for(o=o.firstContext;o!==null;){if(!ai(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Cu(o){Tu=o,hs=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function ur(o){return t2(Tu,o)}function Np(o,l){return Tu===null&&Cu(o),t2(o,l)}function t2(o,l){var f=l._currentValue;if(l={context:l,memoizedValue:f,next:null},hs===null){if(o===null)throw Error(r(308));hs=l,o.dependencies={lanes:0,firstContext:l},o.flags|=524288}else hs=hs.next=l;return f}var jP=typeof AbortController<"u"?AbortController:function(){var o=[],l=this.signal={aborted:!1,addEventListener:function(f,m){o.push(m)}};this.abort=function(){l.aborted=!0,o.forEach(function(f){return f()})}},UP=n.unstable_scheduleCallback,zP=n.unstable_NormalPriority,An={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wy(){return{controller:new jP,data:new Map,refCount:0}}function qh(o){o.refCount--,o.refCount===0&&UP(zP,function(){o.controller.abort()})}var Kh=null,Ey=0,jl=0,Ul=null;function HP(o,l){if(Kh===null){var f=Kh=[];Ey=0,jl=S0(),Ul={status:"pending",value:void 0,then:function(m){f.push(m)}}}return Ey++,l.then(n2,n2),l}function n2(){if(--Ey===0&&Kh!==null){Ul!==null&&(Ul.status="fulfilled");var o=Kh;Kh=null,jl=0,Ul=null;for(var l=0;l<o.length;l++)(0,o[l])()}}function GP(o,l){var f=[],m={status:"pending",value:null,reason:null,then:function(_){f.push(_)}};return o.then(function(){m.status="fulfilled",m.value=l;for(var _=0;_<f.length;_++)(0,f[_])(l)},function(_){for(m.status="rejected",m.reason=_,_=0;_<f.length;_++)(0,f[_])(void 0)}),m}var r2=q.S;q.S=function(o,l){jT=tn(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&HP(o,l),r2!==null&&r2(o,l)};var Su=W(null);function Ty(){var o=Su.current;return o!==null?o:Wt.pooledCache}function Dp(o,l){l===null?ce(Su,Su.current):ce(Su,l.pool)}function i2(){var o=Ty();return o===null?null:{parent:An._currentValue,pool:o}}var zl=Error(r(460)),Cy=Error(r(474)),kp=Error(r(542)),Mp={then:function(){}};function a2(o){return o=o.status,o==="fulfilled"||o==="rejected"}function s2(o,l,f){switch(f=o[f],f===void 0?o.push(l):f!==l&&(l.then(Ki,Ki),l=f),l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,u2(o),o;default:if(typeof l.status=="string")l.then(Ki,Ki);else{if(o=Wt,o!==null&&100<o.shellSuspendCounter)throw Error(r(482));o=l,o.status="pending",o.then(function(m){if(l.status==="pending"){var _=l;_.status="fulfilled",_.value=m}},function(m){if(l.status==="pending"){var _=l;_.status="rejected",_.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,u2(o),o}throw Ru=l,zl}}function Au(o){try{var l=o._init;return l(o._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(Ru=f,zl):f}}var Ru=null;function o2(){if(Ru===null)throw Error(r(459));var o=Ru;return Ru=null,o}function u2(o){if(o===zl||o===kp)throw Error(r(483))}var Hl=null,Xh=0;function Op(o){var l=Xh;return Xh+=1,Hl===null&&(Hl=[]),s2(Hl,o,l)}function Yh(o,l){l=l.props.ref,o.ref=l!==void 0?l:null}function Pp(o,l){throw l.$$typeof===g?Error(r(525)):(o=Object.prototype.toString.call(l),Error(r(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o)))}function l2(o){function l(te,Q){if(o){var ae=te.deletions;ae===null?(te.deletions=[Q],te.flags|=16):ae.push(Q)}}function f(te,Q){if(!o)return null;for(;Q!==null;)l(te,Q),Q=Q.sibling;return null}function m(te){for(var Q=new Map;te!==null;)te.key!==null?Q.set(te.key,te):Q.set(te.index,te),te=te.sibling;return Q}function _(te,Q){return te=ls(te,Q),te.index=0,te.sibling=null,te}function x(te,Q,ae){return te.index=ae,o?(ae=te.alternate,ae!==null?(ae=ae.index,ae<Q?(te.flags|=67108866,Q):ae):(te.flags|=67108866,Q)):(te.flags|=1048576,Q)}function M(te){return o&&te.alternate===null&&(te.flags|=67108866),te}function U(te,Q,ae,ye){return Q===null||Q.tag!==6?(Q=dy(ae,te.mode,ye),Q.return=te,Q):(Q=_(Q,ae),Q.return=te,Q)}function K(te,Q,ae,ye){var Ge=ae.type;return Ge===E?me(te,Q,ae.props.children,ye,ae.key):Q!==null&&(Q.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===R&&Au(Ge)===Q.type)?(Q=_(Q,ae.props),Yh(Q,ae),Q.return=te,Q):(Q=Ap(ae.type,ae.key,ae.props,null,te.mode,ye),Yh(Q,ae),Q.return=te,Q)}function se(te,Q,ae,ye){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ae.containerInfo||Q.stateNode.implementation!==ae.implementation?(Q=py(ae,te.mode,ye),Q.return=te,Q):(Q=_(Q,ae.children||[]),Q.return=te,Q)}function me(te,Q,ae,ye,Ge){return Q===null||Q.tag!==7?(Q=wu(ae,te.mode,ye,Ge),Q.return=te,Q):(Q=_(Q,ae),Q.return=te,Q)}function xe(te,Q,ae){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=dy(""+Q,te.mode,ae),Q.return=te,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case v:return ae=Ap(Q.type,Q.key,Q.props,null,te.mode,ae),Yh(ae,Q),ae.return=te,ae;case b:return Q=py(Q,te.mode,ae),Q.return=te,Q;case R:return Q=Au(Q),xe(te,Q,ae)}if(ne(Q)||j(Q))return Q=wu(Q,te.mode,ae,null),Q.return=te,Q;if(typeof Q.then=="function")return xe(te,Op(Q),ae);if(Q.$$typeof===I)return xe(te,Np(te,Q),ae);Pp(te,Q)}return null}function oe(te,Q,ae,ye){var Ge=Q!==null?Q.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return Ge!==null?null:U(te,Q,""+ae,ye);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case v:return ae.key===Ge?K(te,Q,ae,ye):null;case b:return ae.key===Ge?se(te,Q,ae,ye):null;case R:return ae=Au(ae),oe(te,Q,ae,ye)}if(ne(ae)||j(ae))return Ge!==null?null:me(te,Q,ae,ye,null);if(typeof ae.then=="function")return oe(te,Q,Op(ae),ye);if(ae.$$typeof===I)return oe(te,Q,Np(te,ae),ye);Pp(te,ae)}return null}function de(te,Q,ae,ye,Ge){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return te=te.get(ae)||null,U(Q,te,""+ye,Ge);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case v:return te=te.get(ye.key===null?ae:ye.key)||null,K(Q,te,ye,Ge);case b:return te=te.get(ye.key===null?ae:ye.key)||null,se(Q,te,ye,Ge);case R:return ye=Au(ye),de(te,Q,ae,ye,Ge)}if(ne(ye)||j(ye))return te=te.get(ae)||null,me(Q,te,ye,Ge,null);if(typeof ye.then=="function")return de(te,Q,ae,Op(ye),Ge);if(ye.$$typeof===I)return de(te,Q,ae,Np(Q,ye),Ge);Pp(Q,ye)}return null}function Fe(te,Q,ae,ye){for(var Ge=null,It=null,Be=Q,ct=Q=0,vt=null;Be!==null&&ct<ae.length;ct++){Be.index>ct?(vt=Be,Be=null):vt=Be.sibling;var Nt=oe(te,Be,ae[ct],ye);if(Nt===null){Be===null&&(Be=vt);break}o&&Be&&Nt.alternate===null&&l(te,Be),Q=x(Nt,Q,ct),It===null?Ge=Nt:It.sibling=Nt,It=Nt,Be=vt}if(ct===ae.length)return f(te,Be),bt&&cs(te,ct),Ge;if(Be===null){for(;ct<ae.length;ct++)Be=xe(te,ae[ct],ye),Be!==null&&(Q=x(Be,Q,ct),It===null?Ge=Be:It.sibling=Be,It=Be);return bt&&cs(te,ct),Ge}for(Be=m(Be);ct<ae.length;ct++)vt=de(Be,te,ct,ae[ct],ye),vt!==null&&(o&&vt.alternate!==null&&Be.delete(vt.key===null?ct:vt.key),Q=x(vt,Q,ct),It===null?Ge=vt:It.sibling=vt,It=vt);return o&&Be.forEach(function(Eo){return l(te,Eo)}),bt&&cs(te,ct),Ge}function Ke(te,Q,ae,ye){if(ae==null)throw Error(r(151));for(var Ge=null,It=null,Be=Q,ct=Q=0,vt=null,Nt=ae.next();Be!==null&&!Nt.done;ct++,Nt=ae.next()){Be.index>ct?(vt=Be,Be=null):vt=Be.sibling;var Eo=oe(te,Be,Nt.value,ye);if(Eo===null){Be===null&&(Be=vt);break}o&&Be&&Eo.alternate===null&&l(te,Be),Q=x(Eo,Q,ct),It===null?Ge=Eo:It.sibling=Eo,It=Eo,Be=vt}if(Nt.done)return f(te,Be),bt&&cs(te,ct),Ge;if(Be===null){for(;!Nt.done;ct++,Nt=ae.next())Nt=xe(te,Nt.value,ye),Nt!==null&&(Q=x(Nt,Q,ct),It===null?Ge=Nt:It.sibling=Nt,It=Nt);return bt&&cs(te,ct),Ge}for(Be=m(Be);!Nt.done;ct++,Nt=ae.next())Nt=de(Be,te,ct,Nt.value,ye),Nt!==null&&(o&&Nt.alternate!==null&&Be.delete(Nt.key===null?ct:Nt.key),Q=x(Nt,Q,ct),It===null?Ge=Nt:It.sibling=Nt,It=Nt);return o&&Be.forEach(function(tV){return l(te,tV)}),bt&&cs(te,ct),Ge}function Ht(te,Q,ae,ye){if(typeof ae=="object"&&ae!==null&&ae.type===E&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case v:e:{for(var Ge=ae.key;Q!==null;){if(Q.key===Ge){if(Ge=ae.type,Ge===E){if(Q.tag===7){f(te,Q.sibling),ye=_(Q,ae.props.children),ye.return=te,te=ye;break e}}else if(Q.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===R&&Au(Ge)===Q.type){f(te,Q.sibling),ye=_(Q,ae.props),Yh(ye,ae),ye.return=te,te=ye;break e}f(te,Q);break}else l(te,Q);Q=Q.sibling}ae.type===E?(ye=wu(ae.props.children,te.mode,ye,ae.key),ye.return=te,te=ye):(ye=Ap(ae.type,ae.key,ae.props,null,te.mode,ye),Yh(ye,ae),ye.return=te,te=ye)}return M(te);case b:e:{for(Ge=ae.key;Q!==null;){if(Q.key===Ge)if(Q.tag===4&&Q.stateNode.containerInfo===ae.containerInfo&&Q.stateNode.implementation===ae.implementation){f(te,Q.sibling),ye=_(Q,ae.children||[]),ye.return=te,te=ye;break e}else{f(te,Q);break}else l(te,Q);Q=Q.sibling}ye=py(ae,te.mode,ye),ye.return=te,te=ye}return M(te);case R:return ae=Au(ae),Ht(te,Q,ae,ye)}if(ne(ae))return Fe(te,Q,ae,ye);if(j(ae)){if(Ge=j(ae),typeof Ge!="function")throw Error(r(150));return ae=Ge.call(ae),Ke(te,Q,ae,ye)}if(typeof ae.then=="function")return Ht(te,Q,Op(ae),ye);if(ae.$$typeof===I)return Ht(te,Q,Np(te,ae),ye);Pp(te,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint"?(ae=""+ae,Q!==null&&Q.tag===6?(f(te,Q.sibling),ye=_(Q,ae),ye.return=te,te=ye):(f(te,Q),ye=dy(ae,te.mode,ye),ye.return=te,te=ye),M(te)):f(te,Q)}return function(te,Q,ae,ye){try{Xh=0;var Ge=Ht(te,Q,ae,ye);return Hl=null,Ge}catch(Be){if(Be===zl||Be===kp)throw Be;var It=si(29,Be,null,te.mode);return It.lanes=ye,It.return=te,It}}}var Iu=l2(!0),c2=l2(!1),ao=!1;function Sy(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ay(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function so(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function oo(o,l,f){var m=o.updateQueue;if(m===null)return null;if(m=m.shared,(kt&2)!==0){var _=m.pending;return _===null?l.next=l:(l.next=_.next,_.next=l),m.pending=l,l=Sp(o),KE(o,null,f),l}return Cp(o,m,l,f),Sp(o)}function $h(o,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194048)!==0)){var m=l.lanes;m&=o.pendingLanes,f|=m,l.lanes=f,Eh(o,f)}}function Ry(o,l){var f=o.updateQueue,m=o.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var _=null,x=null;if(f=f.firstBaseUpdate,f!==null){do{var M={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};x===null?_=x=M:x=x.next=M,f=f.next}while(f!==null);x===null?_=x=l:x=x.next=l}else _=x=l;f={baseState:m.baseState,firstBaseUpdate:_,lastBaseUpdate:x,shared:m.shared,callbacks:m.callbacks},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=l:o.next=l,f.lastBaseUpdate=l}var Iy=!1;function Qh(){if(Iy){var o=Ul;if(o!==null)throw o}}function Zh(o,l,f,m){Iy=!1;var _=o.updateQueue;ao=!1;var x=_.firstBaseUpdate,M=_.lastBaseUpdate,U=_.shared.pending;if(U!==null){_.shared.pending=null;var K=U,se=K.next;K.next=null,M===null?x=se:M.next=se,M=K;var me=o.alternate;me!==null&&(me=me.updateQueue,U=me.lastBaseUpdate,U!==M&&(U===null?me.firstBaseUpdate=se:U.next=se,me.lastBaseUpdate=K))}if(x!==null){var xe=_.baseState;M=0,me=se=K=null,U=x;do{var oe=U.lane&-536870913,de=oe!==U.lane;if(de?(gt&oe)===oe:(m&oe)===oe){oe!==0&&oe===jl&&(Iy=!0),me!==null&&(me=me.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var Fe=o,Ke=U;oe=l;var Ht=f;switch(Ke.tag){case 1:if(Fe=Ke.payload,typeof Fe=="function"){xe=Fe.call(Ht,xe,oe);break e}xe=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ke.payload,oe=typeof Fe=="function"?Fe.call(Ht,xe,oe):Fe,oe==null)break e;xe=p({},xe,oe);break e;case 2:ao=!0}}oe=U.callback,oe!==null&&(o.flags|=64,de&&(o.flags|=8192),de=_.callbacks,de===null?_.callbacks=[oe]:de.push(oe))}else de={lane:oe,tag:U.tag,payload:U.payload,callback:U.callback,next:null},me===null?(se=me=de,K=xe):me=me.next=de,M|=oe;if(U=U.next,U===null){if(U=_.shared.pending,U===null)break;de=U,U=de.next,de.next=null,_.lastBaseUpdate=de,_.shared.pending=null}}while(!0);me===null&&(K=xe),_.baseState=K,_.firstBaseUpdate=se,_.lastBaseUpdate=me,x===null&&(_.shared.lanes=0),fo|=M,o.lanes=M,o.memoizedState=xe}}function h2(o,l){if(typeof o!="function")throw Error(r(191,o));o.call(l)}function f2(o,l){var f=o.callbacks;if(f!==null)for(o.callbacks=null,o=0;o<f.length;o++)h2(f[o],l)}var Gl=W(null),Fp=W(0);function d2(o,l){o=xs,ce(Fp,o),ce(Gl,l),xs=o|l.baseLanes}function Ny(){ce(Fp,xs),ce(Gl,Gl.current)}function Dy(){xs=Fp.current,$(Gl),$(Fp)}var oi=W(null),Ni=null;function uo(o){var l=o.alternate;ce(vn,vn.current&1),ce(oi,o),Ni===null&&(l===null||Gl.current!==null||l.memoizedState!==null)&&(Ni=o)}function ky(o){ce(vn,vn.current),ce(oi,o),Ni===null&&(Ni=o)}function p2(o){o.tag===22?(ce(vn,vn.current),ce(oi,o),Ni===null&&(Ni=o)):lo()}function lo(){ce(vn,vn.current),ce(oi,oi.current)}function ui(o){$(oi),Ni===o&&(Ni=null),$(vn)}var vn=W(0);function Vp(o){for(var l=o;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||L0(f)||B0(f)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var ds=0,lt=null,Ut=null,Rn=null,Lp=!1,Wl=!1,Nu=!1,Bp=0,Jh=0,ql=null,WP=0;function cn(){throw Error(r(321))}function My(o,l){if(l===null)return!1;for(var f=0;f<l.length&&f<o.length;f++)if(!ai(o[f],l[f]))return!1;return!0}function Oy(o,l,f,m,_,x){return ds=x,lt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,q.H=o===null||o.memoizedState===null?Q2:Yy,Nu=!1,x=f(m,_),Nu=!1,Wl&&(x=g2(l,f,m,_)),m2(o),x}function m2(o){q.H=nf;var l=Ut!==null&&Ut.next!==null;if(ds=0,Rn=Ut=lt=null,Lp=!1,Jh=0,ql=null,l)throw Error(r(300));o===null||In||(o=o.dependencies,o!==null&&Ip(o)&&(In=!0))}function g2(o,l,f,m){lt=o;var _=0;do{if(Wl&&(ql=null),Jh=0,Wl=!1,25<=_)throw Error(r(301));if(_+=1,Rn=Ut=null,o.updateQueue!=null){var x=o.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}q.H=Z2,x=l(f,m)}while(Wl);return x}function qP(){var o=q.H,l=o.useState()[0];return l=typeof l.then=="function"?ef(l):l,o=o.useState()[0],(Ut!==null?Ut.memoizedState:null)!==o&&(lt.flags|=1024),l}function Py(){var o=Bp!==0;return Bp=0,o}function Fy(o,l,f){l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~f}function Vy(o){if(Lp){for(o=o.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}Lp=!1}ds=0,Rn=Ut=lt=null,Wl=!1,Jh=Bp=0,ql=null}function Fr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rn===null?lt.memoizedState=Rn=o:Rn=Rn.next=o,Rn}function yn(){if(Ut===null){var o=lt.alternate;o=o!==null?o.memoizedState:null}else o=Ut.next;var l=Rn===null?lt.memoizedState:Rn.next;if(l!==null)Rn=l,Ut=o;else{if(o===null)throw lt.alternate===null?Error(r(467)):Error(r(310));Ut=o,o={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},Rn===null?lt.memoizedState=Rn=o:Rn=Rn.next=o}return Rn}function jp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ef(o){var l=Jh;return Jh+=1,ql===null&&(ql=[]),o=s2(ql,o,l),l=lt,(Rn===null?l.memoizedState:Rn.next)===null&&(l=l.alternate,q.H=l===null||l.memoizedState===null?Q2:Yy),o}function Up(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return ef(o);if(o.$$typeof===I)return ur(o)}throw Error(r(438,String(o)))}function Ly(o){var l=null,f=lt.updateQueue;if(f!==null&&(l=f.memoCache),l==null){var m=lt.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(_){return _.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),f===null&&(f=jp(),lt.updateQueue=f),f.memoCache=l,f=l.data[l.index],f===void 0)for(f=l.data[l.index]=Array(o),m=0;m<o;m++)f[m]=P;return l.index++,f}function ps(o,l){return typeof l=="function"?l(o):l}function zp(o){var l=yn();return By(l,Ut,o)}function By(o,l,f){var m=o.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=f;var _=o.baseQueue,x=m.pending;if(x!==null){if(_!==null){var M=_.next;_.next=x.next,x.next=M}l.baseQueue=_=x,m.pending=null}if(x=o.baseState,_===null)o.memoizedState=x;else{l=_.next;var U=M=null,K=null,se=l,me=!1;do{var xe=se.lane&-536870913;if(xe!==se.lane?(gt&xe)===xe:(ds&xe)===xe){var oe=se.revertLane;if(oe===0)K!==null&&(K=K.next={lane:0,revertLane:0,gesture:null,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),xe===jl&&(me=!0);else if((ds&oe)===oe){se=se.next,oe===jl&&(me=!0);continue}else xe={lane:0,revertLane:se.revertLane,gesture:null,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},K===null?(U=K=xe,M=x):K=K.next=xe,lt.lanes|=oe,fo|=oe;xe=se.action,Nu&&f(x,xe),x=se.hasEagerState?se.eagerState:f(x,xe)}else oe={lane:xe,revertLane:se.revertLane,gesture:se.gesture,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},K===null?(U=K=oe,M=x):K=K.next=oe,lt.lanes|=xe,fo|=xe;se=se.next}while(se!==null&&se!==l);if(K===null?M=x:K.next=U,!ai(x,o.memoizedState)&&(In=!0,me&&(f=Ul,f!==null)))throw f;o.memoizedState=x,o.baseState=M,o.baseQueue=K,m.lastRenderedState=x}return _===null&&(m.lanes=0),[o.memoizedState,m.dispatch]}function jy(o){var l=yn(),f=l.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=o;var m=f.dispatch,_=f.pending,x=l.memoizedState;if(_!==null){f.pending=null;var M=_=_.next;do x=o(x,M.action),M=M.next;while(M!==_);ai(x,l.memoizedState)||(In=!0),l.memoizedState=x,l.baseQueue===null&&(l.baseState=x),f.lastRenderedState=x}return[x,m]}function v2(o,l,f){var m=lt,_=yn(),x=bt;if(x){if(f===void 0)throw Error(r(407));f=f()}else f=l();var M=!ai((Ut||_).memoizedState,f);if(M&&(_.memoizedState=f,In=!0),_=_.queue,Hy(b2.bind(null,m,_,o),[o]),_.getSnapshot!==l||M||Rn!==null&&Rn.memoizedState.tag&1){if(m.flags|=2048,Kl(9,{destroy:void 0},_2.bind(null,m,_,f,l),null),Wt===null)throw Error(r(349));x||(ds&127)!==0||y2(m,l,f)}return f}function y2(o,l,f){o.flags|=16384,o={getSnapshot:l,value:f},l=lt.updateQueue,l===null?(l=jp(),lt.updateQueue=l,l.stores=[o]):(f=l.stores,f===null?l.stores=[o]:f.push(o))}function _2(o,l,f,m){l.value=f,l.getSnapshot=m,x2(l)&&w2(o)}function b2(o,l,f){return f(function(){x2(l)&&w2(o)})}function x2(o){var l=o.getSnapshot;o=o.value;try{var f=l();return!ai(o,f)}catch{return!0}}function w2(o){var l=xu(o,2);l!==null&&Kr(l,o,2)}function Uy(o){var l=Fr();if(typeof o=="function"){var f=o;if(o=f(),Nu){_r(!0);try{f()}finally{_r(!1)}}}return l.memoizedState=l.baseState=o,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ps,lastRenderedState:o},l}function E2(o,l,f,m){return o.baseState=f,By(o,Ut,typeof m=="function"?m:ps)}function KP(o,l,f,m,_){if(Wp(o))throw Error(r(485));if(o=l.action,o!==null){var x={payload:_,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){x.listeners.push(M)}};q.T!==null?f(!0):x.isTransition=!1,m(x),f=l.pending,f===null?(x.next=l.pending=x,T2(l,x)):(x.next=f.next,l.pending=f.next=x)}}function T2(o,l){var f=l.action,m=l.payload,_=o.state;if(l.isTransition){var x=q.T,M={};q.T=M;try{var U=f(_,m),K=q.S;K!==null&&K(M,U),C2(o,l,U)}catch(se){zy(o,l,se)}finally{x!==null&&M.types!==null&&(x.types=M.types),q.T=x}}else try{x=f(_,m),C2(o,l,x)}catch(se){zy(o,l,se)}}function C2(o,l,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){S2(o,l,m)},function(m){return zy(o,l,m)}):S2(o,l,f)}function S2(o,l,f){l.status="fulfilled",l.value=f,A2(l),o.state=f,l=o.pending,l!==null&&(f=l.next,f===l?o.pending=null:(f=f.next,l.next=f,T2(o,f)))}function zy(o,l,f){var m=o.pending;if(o.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=f,A2(l),l=l.next;while(l!==m)}o.action=null}function A2(o){o=o.listeners;for(var l=0;l<o.length;l++)(0,o[l])()}function R2(o,l){return l}function I2(o,l){if(bt){var f=Wt.formState;if(f!==null){e:{var m=lt;if(bt){if(Xt){t:{for(var _=Xt,x=Ii;_.nodeType!==8;){if(!x){_=null;break t}if(_=Di(_.nextSibling),_===null){_=null;break t}}x=_.data,_=x==="F!"||x==="F"?_:null}if(_){Xt=Di(_.nextSibling),m=_.data==="F!";break e}}ro(m)}m=!1}m&&(l=f[0])}}return f=Fr(),f.memoizedState=f.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:R2,lastRenderedState:l},f.queue=m,f=X2.bind(null,lt,m),m.dispatch=f,m=Uy(!1),x=Xy.bind(null,lt,!1,m.queue),m=Fr(),_={state:l,dispatch:null,action:o,pending:null},m.queue=_,f=KP.bind(null,lt,_,x,f),_.dispatch=f,m.memoizedState=o,[l,f,!1]}function N2(o){var l=yn();return D2(l,Ut,o)}function D2(o,l,f){if(l=By(o,l,R2)[0],o=zp(ps)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=ef(l)}catch(M){throw M===zl?kp:M}else m=l;l=yn();var _=l.queue,x=_.dispatch;return f!==l.memoizedState&&(lt.flags|=2048,Kl(9,{destroy:void 0},XP.bind(null,_,f),null)),[m,x,o]}function XP(o,l){o.action=l}function k2(o){var l=yn(),f=Ut;if(f!==null)return D2(l,f,o);yn(),l=l.memoizedState,f=yn();var m=f.queue.dispatch;return f.memoizedState=o,[l,m,!1]}function Kl(o,l,f,m){return o={tag:o,create:f,deps:m,inst:l,next:null},l=lt.updateQueue,l===null&&(l=jp(),lt.updateQueue=l),f=l.lastEffect,f===null?l.lastEffect=o.next=o:(m=f.next,f.next=o,o.next=m,l.lastEffect=o),o}function M2(){return yn().memoizedState}function Hp(o,l,f,m){var _=Fr();lt.flags|=o,_.memoizedState=Kl(1|l,{destroy:void 0},f,m===void 0?null:m)}function Gp(o,l,f,m){var _=yn();m=m===void 0?null:m;var x=_.memoizedState.inst;Ut!==null&&m!==null&&My(m,Ut.memoizedState.deps)?_.memoizedState=Kl(l,x,f,m):(lt.flags|=o,_.memoizedState=Kl(1|l,x,f,m))}function O2(o,l){Hp(8390656,8,o,l)}function Hy(o,l){Gp(2048,8,o,l)}function YP(o){lt.flags|=4;var l=lt.updateQueue;if(l===null)l=jp(),lt.updateQueue=l,l.events=[o];else{var f=l.events;f===null?l.events=[o]:f.push(o)}}function P2(o){var l=yn().memoizedState;return YP({ref:l,nextImpl:o}),function(){if((kt&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}function F2(o,l){return Gp(4,2,o,l)}function V2(o,l){return Gp(4,4,o,l)}function L2(o,l){if(typeof l=="function"){o=o();var f=l(o);return function(){typeof f=="function"?f():l(null)}}if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function B2(o,l,f){f=f!=null?f.concat([o]):null,Gp(4,4,L2.bind(null,l,o),f)}function Gy(){}function j2(o,l){var f=yn();l=l===void 0?null:l;var m=f.memoizedState;return l!==null&&My(l,m[1])?m[0]:(f.memoizedState=[o,l],o)}function U2(o,l){var f=yn();l=l===void 0?null:l;var m=f.memoizedState;if(l!==null&&My(l,m[1]))return m[0];if(m=o(),Nu){_r(!0);try{o()}finally{_r(!1)}}return f.memoizedState=[m,l],m}function Wy(o,l,f){return f===void 0||(ds&1073741824)!==0&&(gt&261930)===0?o.memoizedState=l:(o.memoizedState=f,o=zT(),lt.lanes|=o,fo|=o,f)}function z2(o,l,f,m){return ai(f,l)?f:Gl.current!==null?(o=Wy(o,f,m),ai(o,l)||(In=!0),o):(ds&42)===0||(ds&1073741824)!==0&&(gt&261930)===0?(In=!0,o.memoizedState=f):(o=zT(),lt.lanes|=o,fo|=o,l)}function H2(o,l,f,m,_){var x=X.p;X.p=x!==0&&8>x?x:8;var M=q.T,U={};q.T=U,Xy(o,!1,l,f);try{var K=_(),se=q.S;if(se!==null&&se(U,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var me=GP(K,m);tf(o,l,me,hi(o))}else tf(o,l,m,hi(o))}catch(xe){tf(o,l,{then:function(){},status:"rejected",reason:xe},hi())}finally{X.p=x,M!==null&&U.types!==null&&(M.types=U.types),q.T=M}}function $P(){}function qy(o,l,f,m){if(o.tag!==5)throw Error(r(476));var _=G2(o).queue;H2(o,_,l,ee,f===null?$P:function(){return W2(o),f(m)})}function G2(o){var l=o.memoizedState;if(l!==null)return l;l={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ps,lastRenderedState:ee},next:null};var f={};return l.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ps,lastRenderedState:f},next:null},o.memoizedState=l,o=o.alternate,o!==null&&(o.memoizedState=l),l}function W2(o){var l=G2(o);l.next===null&&(l=o.alternate.memoizedState),tf(o,l.next.queue,{},hi())}function Ky(){return ur(_f)}function q2(){return yn().memoizedState}function K2(){return yn().memoizedState}function QP(o){for(var l=o.return;l!==null;){switch(l.tag){case 24:case 3:var f=hi();o=so(f);var m=oo(l,o,f);m!==null&&(Kr(m,l,f),$h(m,l,f)),l={cache:wy()},o.payload=l;return}l=l.return}}function ZP(o,l,f){var m=hi();f={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Wp(o)?Y2(l,f):(f=hy(o,l,f,m),f!==null&&(Kr(f,o,m),$2(f,l,m)))}function X2(o,l,f){var m=hi();tf(o,l,f,m)}function tf(o,l,f,m){var _={lane:m,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(Wp(o))Y2(l,_);else{var x=o.alternate;if(o.lanes===0&&(x===null||x.lanes===0)&&(x=l.lastRenderedReducer,x!==null))try{var M=l.lastRenderedState,U=x(M,f);if(_.hasEagerState=!0,_.eagerState=U,ai(U,M))return Cp(o,l,_,0),Wt===null&&Tp(),!1}catch{}if(f=hy(o,l,_,m),f!==null)return Kr(f,o,m),$2(f,l,m),!0}return!1}function Xy(o,l,f,m){if(m={lane:2,revertLane:S0(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Wp(o)){if(l)throw Error(r(479))}else l=hy(o,f,m,2),l!==null&&Kr(l,o,2)}function Wp(o){var l=o.alternate;return o===lt||l!==null&&l===lt}function Y2(o,l){Wl=Lp=!0;var f=o.pending;f===null?l.next=l:(l.next=f.next,f.next=l),o.pending=l}function $2(o,l,f){if((f&4194048)!==0){var m=l.lanes;m&=o.pendingLanes,f|=m,l.lanes=f,Eh(o,f)}}var nf={readContext:ur,use:Up,useCallback:cn,useContext:cn,useEffect:cn,useImperativeHandle:cn,useLayoutEffect:cn,useInsertionEffect:cn,useMemo:cn,useReducer:cn,useRef:cn,useState:cn,useDebugValue:cn,useDeferredValue:cn,useTransition:cn,useSyncExternalStore:cn,useId:cn,useHostTransitionStatus:cn,useFormState:cn,useActionState:cn,useOptimistic:cn,useMemoCache:cn,useCacheRefresh:cn};nf.useEffectEvent=cn;var Q2={readContext:ur,use:Up,useCallback:function(o,l){return Fr().memoizedState=[o,l===void 0?null:l],o},useContext:ur,useEffect:O2,useImperativeHandle:function(o,l,f){f=f!=null?f.concat([o]):null,Hp(4194308,4,L2.bind(null,l,o),f)},useLayoutEffect:function(o,l){return Hp(4194308,4,o,l)},useInsertionEffect:function(o,l){Hp(4,2,o,l)},useMemo:function(o,l){var f=Fr();l=l===void 0?null:l;var m=o();if(Nu){_r(!0);try{o()}finally{_r(!1)}}return f.memoizedState=[m,l],m},useReducer:function(o,l,f){var m=Fr();if(f!==void 0){var _=f(l);if(Nu){_r(!0);try{f(l)}finally{_r(!1)}}}else _=l;return m.memoizedState=m.baseState=_,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:_},m.queue=o,o=o.dispatch=ZP.bind(null,lt,o),[m.memoizedState,o]},useRef:function(o){var l=Fr();return o={current:o},l.memoizedState=o},useState:function(o){o=Uy(o);var l=o.queue,f=X2.bind(null,lt,l);return l.dispatch=f,[o.memoizedState,f]},useDebugValue:Gy,useDeferredValue:function(o,l){var f=Fr();return Wy(f,o,l)},useTransition:function(){var o=Uy(!1);return o=H2.bind(null,lt,o.queue,!0,!1),Fr().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,l,f){var m=lt,_=Fr();if(bt){if(f===void 0)throw Error(r(407));f=f()}else{if(f=l(),Wt===null)throw Error(r(349));(gt&127)!==0||y2(m,l,f)}_.memoizedState=f;var x={value:f,getSnapshot:l};return _.queue=x,O2(b2.bind(null,m,x,o),[o]),m.flags|=2048,Kl(9,{destroy:void 0},_2.bind(null,m,x,f,l),null),f},useId:function(){var o=Fr(),l=Wt.identifierPrefix;if(bt){var f=Da,m=Na;f=(m&~(1<<32-mn(m)-1)).toString(32)+f,l="_"+l+"R_"+f,f=Bp++,0<f&&(l+="H"+f.toString(32)),l+="_"}else f=WP++,l="_"+l+"r_"+f.toString(32)+"_";return o.memoizedState=l},useHostTransitionStatus:Ky,useFormState:I2,useActionState:I2,useOptimistic:function(o){var l=Fr();l.memoizedState=l.baseState=o;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=f,l=Xy.bind(null,lt,!0,f),f.dispatch=l,[o,l]},useMemoCache:Ly,useCacheRefresh:function(){return Fr().memoizedState=QP.bind(null,lt)},useEffectEvent:function(o){var l=Fr(),f={impl:o};return l.memoizedState=f,function(){if((kt&2)!==0)throw Error(r(440));return f.impl.apply(void 0,arguments)}}},Yy={readContext:ur,use:Up,useCallback:j2,useContext:ur,useEffect:Hy,useImperativeHandle:B2,useInsertionEffect:F2,useLayoutEffect:V2,useMemo:U2,useReducer:zp,useRef:M2,useState:function(){return zp(ps)},useDebugValue:Gy,useDeferredValue:function(o,l){var f=yn();return z2(f,Ut.memoizedState,o,l)},useTransition:function(){var o=zp(ps)[0],l=yn().memoizedState;return[typeof o=="boolean"?o:ef(o),l]},useSyncExternalStore:v2,useId:q2,useHostTransitionStatus:Ky,useFormState:N2,useActionState:N2,useOptimistic:function(o,l){var f=yn();return E2(f,Ut,o,l)},useMemoCache:Ly,useCacheRefresh:K2};Yy.useEffectEvent=P2;var Z2={readContext:ur,use:Up,useCallback:j2,useContext:ur,useEffect:Hy,useImperativeHandle:B2,useInsertionEffect:F2,useLayoutEffect:V2,useMemo:U2,useReducer:jy,useRef:M2,useState:function(){return jy(ps)},useDebugValue:Gy,useDeferredValue:function(o,l){var f=yn();return Ut===null?Wy(f,o,l):z2(f,Ut.memoizedState,o,l)},useTransition:function(){var o=jy(ps)[0],l=yn().memoizedState;return[typeof o=="boolean"?o:ef(o),l]},useSyncExternalStore:v2,useId:q2,useHostTransitionStatus:Ky,useFormState:k2,useActionState:k2,useOptimistic:function(o,l){var f=yn();return Ut!==null?E2(f,Ut,o,l):(f.baseState=o,[o,f.queue.dispatch])},useMemoCache:Ly,useCacheRefresh:K2};Z2.useEffectEvent=P2;function $y(o,l,f,m){l=o.memoizedState,f=f(m,l),f=f==null?l:p({},l,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var Qy={enqueueSetState:function(o,l,f){o=o._reactInternals;var m=hi(),_=so(m);_.payload=l,f!=null&&(_.callback=f),l=oo(o,_,m),l!==null&&(Kr(l,o,m),$h(l,o,m))},enqueueReplaceState:function(o,l,f){o=o._reactInternals;var m=hi(),_=so(m);_.tag=1,_.payload=l,f!=null&&(_.callback=f),l=oo(o,_,m),l!==null&&(Kr(l,o,m),$h(l,o,m))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var f=hi(),m=so(f);m.tag=2,l!=null&&(m.callback=l),l=oo(o,m,f),l!==null&&(Kr(l,o,f),$h(l,o,f))}};function J2(o,l,f,m,_,x,M){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(m,x,M):l.prototype&&l.prototype.isPureReactComponent?!zh(f,m)||!zh(_,x):!0}function eT(o,l,f,m){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,m),l.state!==o&&Qy.enqueueReplaceState(l,l.state,null)}function Du(o,l){var f=l;if("ref"in l){f={};for(var m in l)m!=="ref"&&(f[m]=l[m])}if(o=o.defaultProps){f===l&&(f=p({},f));for(var _ in o)f[_]===void 0&&(f[_]=o[_])}return f}function tT(o){Ep(o)}function nT(o){console.error(o)}function rT(o){Ep(o)}function qp(o,l){try{var f=o.onUncaughtError;f(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function iT(o,l,f){try{var m=o.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Zy(o,l,f){return f=so(f),f.tag=3,f.payload={element:null},f.callback=function(){qp(o,l)},f}function aT(o){return o=so(o),o.tag=3,o}function sT(o,l,f,m){var _=f.type.getDerivedStateFromError;if(typeof _=="function"){var x=m.value;o.payload=function(){return _(x)},o.callback=function(){iT(l,f,m)}}var M=f.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(o.callback=function(){iT(l,f,m),typeof _!="function"&&(po===null?po=new Set([this]):po.add(this));var U=m.stack;this.componentDidCatch(m.value,{componentStack:U!==null?U:""})})}function JP(o,l,f,m,_){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=f.alternate,l!==null&&Bl(l,f,_,!0),f=oi.current,f!==null){switch(f.tag){case 31:case 13:return Ni===null?im():f.alternate===null&&hn===0&&(hn=3),f.flags&=-257,f.flags|=65536,f.lanes=_,m===Mp?f.flags|=16384:(l=f.updateQueue,l===null?f.updateQueue=new Set([m]):l.add(m),E0(o,m,_)),!1;case 22:return f.flags|=65536,m===Mp?f.flags|=16384:(l=f.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=l):(f=l.retryQueue,f===null?l.retryQueue=new Set([m]):f.add(m)),E0(o,m,_)),!1}throw Error(r(435,f.tag))}return E0(o,m,_),im(),!1}if(bt)return l=oi.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=_,m!==vy&&(o=Error(r(422),{cause:m}),Wh(Si(o,f)))):(m!==vy&&(l=Error(r(423),{cause:m}),Wh(Si(l,f))),o=o.current.alternate,o.flags|=65536,_&=-_,o.lanes|=_,m=Si(m,f),_=Zy(o.stateNode,m,_),Ry(o,_),hn!==4&&(hn=2)),!1;var x=Error(r(520),{cause:m});if(x=Si(x,f),hf===null?hf=[x]:hf.push(x),hn!==4&&(hn=2),l===null)return!0;m=Si(m,f),f=l;do{switch(f.tag){case 3:return f.flags|=65536,o=_&-_,f.lanes|=o,o=Zy(f.stateNode,m,o),Ry(f,o),!1;case 1:if(l=f.type,x=f.stateNode,(f.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(po===null||!po.has(x))))return f.flags|=65536,_&=-_,f.lanes|=_,_=aT(_),sT(_,o,f,m),Ry(f,_),!1}f=f.return}while(f!==null);return!1}var Jy=Error(r(461)),In=!1;function lr(o,l,f,m){l.child=o===null?c2(l,null,f,m):Iu(l,o.child,f,m)}function oT(o,l,f,m,_){f=f.render;var x=l.ref;if("ref"in m){var M={};for(var U in m)U!=="ref"&&(M[U]=m[U])}else M=m;return Cu(l),m=Oy(o,l,f,M,x,_),U=Py(),o!==null&&!In?(Fy(o,l,_),ms(o,l,_)):(bt&&U&&my(l),l.flags|=1,lr(o,l,m,_),l.child)}function uT(o,l,f,m,_){if(o===null){var x=f.type;return typeof x=="function"&&!fy(x)&&x.defaultProps===void 0&&f.compare===null?(l.tag=15,l.type=x,lT(o,l,x,m,_)):(o=Ap(f.type,null,m,l,l.mode,_),o.ref=l.ref,o.return=l,l.child=o)}if(x=o.child,!o0(o,_)){var M=x.memoizedProps;if(f=f.compare,f=f!==null?f:zh,f(M,m)&&o.ref===l.ref)return ms(o,l,_)}return l.flags|=1,o=ls(x,m),o.ref=l.ref,o.return=l,l.child=o}function lT(o,l,f,m,_){if(o!==null){var x=o.memoizedProps;if(zh(x,m)&&o.ref===l.ref)if(In=!1,l.pendingProps=m=x,o0(o,_))(o.flags&131072)!==0&&(In=!0);else return l.lanes=o.lanes,ms(o,l,_)}return e0(o,l,f,m,_)}function cT(o,l,f,m){var _=m.children,x=o!==null?o.memoizedState:null;if(o===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(x=x!==null?x.baseLanes|f:f,o!==null){for(m=l.child=o.child,_=0;m!==null;)_=_|m.lanes|m.childLanes,m=m.sibling;m=_&~x}else m=0,l.child=null;return hT(o,l,x,f,m)}if((f&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},o!==null&&Dp(l,x!==null?x.cachePool:null),x!==null?d2(l,x):Ny(),p2(l);else return m=l.lanes=536870912,hT(o,l,x!==null?x.baseLanes|f:f,f,m)}else x!==null?(Dp(l,x.cachePool),d2(l,x),lo(),l.memoizedState=null):(o!==null&&Dp(l,null),Ny(),lo());return lr(o,l,_,f),l.child}function rf(o,l){return o!==null&&o.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function hT(o,l,f,m,_){var x=Ty();return x=x===null?null:{parent:An._currentValue,pool:x},l.memoizedState={baseLanes:f,cachePool:x},o!==null&&Dp(l,null),Ny(),p2(l),o!==null&&Bl(o,l,m,!0),l.childLanes=_,null}function Kp(o,l){return l=Yp({mode:l.mode,children:l.children},o.mode),l.ref=o.ref,o.child=l,l.return=o,l}function fT(o,l,f){return Iu(l,o.child,null,f),o=Kp(l,l.pendingProps),o.flags|=2,ui(l),l.memoizedState=null,o}function eF(o,l,f){var m=l.pendingProps,_=(l.flags&128)!==0;if(l.flags&=-129,o===null){if(bt){if(m.mode==="hidden")return o=Kp(l,m),l.lanes=536870912,rf(null,o);if(ky(l),(o=Xt)?(o=TC(o,Ii),o=o!==null&&o.data==="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:to!==null?{id:Na,overflow:Da}:null,retryLane:536870912,hydrationErrors:null},f=YE(o),f.return=l,l.child=f,or=l,Xt=null)):o=null,o===null)throw ro(l);return l.lanes=536870912,null}return Kp(l,m)}var x=o.memoizedState;if(x!==null){var M=x.dehydrated;if(ky(l),_)if(l.flags&256)l.flags&=-257,l=fT(o,l,f);else if(l.memoizedState!==null)l.child=o.child,l.flags|=128,l=null;else throw Error(r(558));else if(In||Bl(o,l,f,!1),_=(f&o.childLanes)!==0,In||_){if(m=Wt,m!==null&&(M=Th(m,f),M!==0&&M!==x.retryLane))throw x.retryLane=M,xu(o,M),Kr(m,o,M),Jy;im(),l=fT(o,l,f)}else o=x.treeContext,Xt=Di(M.nextSibling),or=l,bt=!0,no=null,Ii=!1,o!==null&&ZE(l,o),l=Kp(l,m),l.flags|=4096;return l}return o=ls(o.child,{mode:m.mode,children:m.children}),o.ref=l.ref,l.child=o,o.return=l,o}function Xp(o,l){var f=l.ref;if(f===null)o!==null&&o.ref!==null&&(l.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(o===null||o.ref!==f)&&(l.flags|=4194816)}}function e0(o,l,f,m,_){return Cu(l),f=Oy(o,l,f,m,void 0,_),m=Py(),o!==null&&!In?(Fy(o,l,_),ms(o,l,_)):(bt&&m&&my(l),l.flags|=1,lr(o,l,f,_),l.child)}function dT(o,l,f,m,_,x){return Cu(l),l.updateQueue=null,f=g2(l,m,f,_),m2(o),m=Py(),o!==null&&!In?(Fy(o,l,x),ms(o,l,x)):(bt&&m&&my(l),l.flags|=1,lr(o,l,f,x),l.child)}function pT(o,l,f,m,_){if(Cu(l),l.stateNode===null){var x=Pl,M=f.contextType;typeof M=="object"&&M!==null&&(x=ur(M)),x=new f(m,x),l.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Qy,l.stateNode=x,x._reactInternals=l,x=l.stateNode,x.props=m,x.state=l.memoizedState,x.refs={},Sy(l),M=f.contextType,x.context=typeof M=="object"&&M!==null?ur(M):Pl,x.state=l.memoizedState,M=f.getDerivedStateFromProps,typeof M=="function"&&($y(l,f,M,m),x.state=l.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(M=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),M!==x.state&&Qy.enqueueReplaceState(x,x.state,null),Zh(l,m,x,_),Qh(),x.state=l.memoizedState),typeof x.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(o===null){x=l.stateNode;var U=l.memoizedProps,K=Du(f,U);x.props=K;var se=x.context,me=f.contextType;M=Pl,typeof me=="object"&&me!==null&&(M=ur(me));var xe=f.getDerivedStateFromProps;me=typeof xe=="function"||typeof x.getSnapshotBeforeUpdate=="function",U=l.pendingProps!==U,me||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(U||se!==M)&&eT(l,x,m,M),ao=!1;var oe=l.memoizedState;x.state=oe,Zh(l,m,x,_),Qh(),se=l.memoizedState,U||oe!==se||ao?(typeof xe=="function"&&($y(l,f,xe,m),se=l.memoizedState),(K=ao||J2(l,f,K,m,oe,se,M))?(me||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(l.flags|=4194308)):(typeof x.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=se),x.props=m,x.state=se,x.context=M,m=K):(typeof x.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{x=l.stateNode,Ay(o,l),M=l.memoizedProps,me=Du(f,M),x.props=me,xe=l.pendingProps,oe=x.context,se=f.contextType,K=Pl,typeof se=="object"&&se!==null&&(K=ur(se)),U=f.getDerivedStateFromProps,(se=typeof U=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(M!==xe||oe!==K)&&eT(l,x,m,K),ao=!1,oe=l.memoizedState,x.state=oe,Zh(l,m,x,_),Qh();var de=l.memoizedState;M!==xe||oe!==de||ao||o!==null&&o.dependencies!==null&&Ip(o.dependencies)?(typeof U=="function"&&($y(l,f,U,m),de=l.memoizedState),(me=ao||J2(l,f,me,m,oe,de,K)||o!==null&&o.dependencies!==null&&Ip(o.dependencies))?(se||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(m,de,K),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(m,de,K)),typeof x.componentDidUpdate=="function"&&(l.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof x.componentDidUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=de),x.props=m,x.state=de,x.context=K,m=me):(typeof x.componentDidUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=1024),m=!1)}return x=m,Xp(o,l),m=(l.flags&128)!==0,x||m?(x=l.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:x.render(),l.flags|=1,o!==null&&m?(l.child=Iu(l,o.child,null,_),l.child=Iu(l,null,f,_)):lr(o,l,f,_),l.memoizedState=x.state,o=l.child):o=ms(o,l,_),o}function mT(o,l,f,m){return Eu(),l.flags|=256,lr(o,l,f,m),l.child}var t0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function n0(o){return{baseLanes:o,cachePool:i2()}}function r0(o,l,f){return o=o!==null?o.childLanes&~f:0,l&&(o|=ci),o}function gT(o,l,f){var m=l.pendingProps,_=!1,x=(l.flags&128)!==0,M;if((M=x)||(M=o!==null&&o.memoizedState===null?!1:(vn.current&2)!==0),M&&(_=!0,l.flags&=-129),M=(l.flags&32)!==0,l.flags&=-33,o===null){if(bt){if(_?uo(l):lo(),(o=Xt)?(o=TC(o,Ii),o=o!==null&&o.data!=="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:to!==null?{id:Na,overflow:Da}:null,retryLane:536870912,hydrationErrors:null},f=YE(o),f.return=l,l.child=f,or=l,Xt=null)):o=null,o===null)throw ro(l);return B0(o)?l.lanes=32:l.lanes=536870912,null}var U=m.children;return m=m.fallback,_?(lo(),_=l.mode,U=Yp({mode:"hidden",children:U},_),m=wu(m,_,f,null),U.return=l,m.return=l,U.sibling=m,l.child=U,m=l.child,m.memoizedState=n0(f),m.childLanes=r0(o,M,f),l.memoizedState=t0,rf(null,m)):(uo(l),i0(l,U))}var K=o.memoizedState;if(K!==null&&(U=K.dehydrated,U!==null)){if(x)l.flags&256?(uo(l),l.flags&=-257,l=a0(o,l,f)):l.memoizedState!==null?(lo(),l.child=o.child,l.flags|=128,l=null):(lo(),U=m.fallback,_=l.mode,m=Yp({mode:"visible",children:m.children},_),U=wu(U,_,f,null),U.flags|=2,m.return=l,U.return=l,m.sibling=U,l.child=m,Iu(l,o.child,null,f),m=l.child,m.memoizedState=n0(f),m.childLanes=r0(o,M,f),l.memoizedState=t0,l=rf(null,m));else if(uo(l),B0(U)){if(M=U.nextSibling&&U.nextSibling.dataset,M)var se=M.dgst;M=se,m=Error(r(419)),m.stack="",m.digest=M,Wh({value:m,source:null,stack:null}),l=a0(o,l,f)}else if(In||Bl(o,l,f,!1),M=(f&o.childLanes)!==0,In||M){if(M=Wt,M!==null&&(m=Th(M,f),m!==0&&m!==K.retryLane))throw K.retryLane=m,xu(o,m),Kr(M,o,m),Jy;L0(U)||im(),l=a0(o,l,f)}else L0(U)?(l.flags|=192,l.child=o.child,l=null):(o=K.treeContext,Xt=Di(U.nextSibling),or=l,bt=!0,no=null,Ii=!1,o!==null&&ZE(l,o),l=i0(l,m.children),l.flags|=4096);return l}return _?(lo(),U=m.fallback,_=l.mode,K=o.child,se=K.sibling,m=ls(K,{mode:"hidden",children:m.children}),m.subtreeFlags=K.subtreeFlags&65011712,se!==null?U=ls(se,U):(U=wu(U,_,f,null),U.flags|=2),U.return=l,m.return=l,m.sibling=U,l.child=m,rf(null,m),m=l.child,U=o.child.memoizedState,U===null?U=n0(f):(_=U.cachePool,_!==null?(K=An._currentValue,_=_.parent!==K?{parent:K,pool:K}:_):_=i2(),U={baseLanes:U.baseLanes|f,cachePool:_}),m.memoizedState=U,m.childLanes=r0(o,M,f),l.memoizedState=t0,rf(o.child,m)):(uo(l),f=o.child,o=f.sibling,f=ls(f,{mode:"visible",children:m.children}),f.return=l,f.sibling=null,o!==null&&(M=l.deletions,M===null?(l.deletions=[o],l.flags|=16):M.push(o)),l.child=f,l.memoizedState=null,f)}function i0(o,l){return l=Yp({mode:"visible",children:l},o.mode),l.return=o,o.child=l}function Yp(o,l){return o=si(22,o,null,l),o.lanes=0,o}function a0(o,l,f){return Iu(l,o.child,null,f),o=i0(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function vT(o,l,f){o.lanes|=l;var m=o.alternate;m!==null&&(m.lanes|=l),by(o.return,l,f)}function s0(o,l,f,m,_,x){var M=o.memoizedState;M===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:_,treeForkCount:x}:(M.isBackwards=l,M.rendering=null,M.renderingStartTime=0,M.last=m,M.tail=f,M.tailMode=_,M.treeForkCount=x)}function yT(o,l,f){var m=l.pendingProps,_=m.revealOrder,x=m.tail;m=m.children;var M=vn.current,U=(M&2)!==0;if(U?(M=M&1|2,l.flags|=128):M&=1,ce(vn,M),lr(o,l,m,f),m=bt?Gh:0,!U&&o!==null&&(o.flags&128)!==0)e:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&vT(o,f,l);else if(o.tag===19)vT(o,f,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break e;for(;o.sibling===null;){if(o.return===null||o.return===l)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}switch(_){case"forwards":for(f=l.child,_=null;f!==null;)o=f.alternate,o!==null&&Vp(o)===null&&(_=f),f=f.sibling;f=_,f===null?(_=l.child,l.child=null):(_=f.sibling,f.sibling=null),s0(l,!1,_,f,x,m);break;case"backwards":case"unstable_legacy-backwards":for(f=null,_=l.child,l.child=null;_!==null;){if(o=_.alternate,o!==null&&Vp(o)===null){l.child=_;break}o=_.sibling,_.sibling=f,f=_,_=o}s0(l,!0,f,null,x,m);break;case"together":s0(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function ms(o,l,f){if(o!==null&&(l.dependencies=o.dependencies),fo|=l.lanes,(f&l.childLanes)===0)if(o!==null){if(Bl(o,l,f,!1),(f&l.childLanes)===0)return null}else return null;if(o!==null&&l.child!==o.child)throw Error(r(153));if(l.child!==null){for(o=l.child,f=ls(o,o.pendingProps),l.child=f,f.return=l;o.sibling!==null;)o=o.sibling,f=f.sibling=ls(o,o.pendingProps),f.return=l;f.sibling=null}return l.child}function o0(o,l){return(o.lanes&l)!==0?!0:(o=o.dependencies,!!(o!==null&&Ip(o)))}function tF(o,l,f){switch(l.tag){case 3:De(l,l.stateNode.containerInfo),io(l,An,o.memoizedState.cache),Eu();break;case 27:case 5:qe(l);break;case 4:De(l,l.stateNode.containerInfo);break;case 10:io(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,ky(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(uo(l),l.flags|=128,null):(f&l.child.childLanes)!==0?gT(o,l,f):(uo(l),o=ms(o,l,f),o!==null?o.sibling:null);uo(l);break;case 19:var _=(o.flags&128)!==0;if(m=(f&l.childLanes)!==0,m||(Bl(o,l,f,!1),m=(f&l.childLanes)!==0),_){if(m)return yT(o,l,f);l.flags|=128}if(_=l.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ce(vn,vn.current),m)break;return null;case 22:return l.lanes=0,cT(o,l,f,l.pendingProps);case 24:io(l,An,o.memoizedState.cache)}return ms(o,l,f)}function _T(o,l,f){if(o!==null)if(o.memoizedProps!==l.pendingProps)In=!0;else{if(!o0(o,f)&&(l.flags&128)===0)return In=!1,tF(o,l,f);In=(o.flags&131072)!==0}else In=!1,bt&&(l.flags&1048576)!==0&&QE(l,Gh,l.index);switch(l.lanes=0,l.tag){case 16:e:{var m=l.pendingProps;if(o=Au(l.elementType),l.type=o,typeof o=="function")fy(o)?(m=Du(o,m),l.tag=1,l=pT(null,l,o,m,f)):(l.tag=0,l=e0(null,l,o,m,f));else{if(o!=null){var _=o.$$typeof;if(_===D){l.tag=11,l=oT(null,l,o,m,f);break e}else if(_===N){l.tag=14,l=uT(null,l,o,m,f);break e}}throw l=Z(o)||o,Error(r(306,l,""))}}return l;case 0:return e0(o,l,l.type,l.pendingProps,f);case 1:return m=l.type,_=Du(m,l.pendingProps),pT(o,l,m,_,f);case 3:e:{if(De(l,l.stateNode.containerInfo),o===null)throw Error(r(387));m=l.pendingProps;var x=l.memoizedState;_=x.element,Ay(o,l),Zh(l,m,null,f);var M=l.memoizedState;if(m=M.cache,io(l,An,m),m!==x.cache&&xy(l,[An],f,!0),Qh(),m=M.element,x.isDehydrated)if(x={element:m,isDehydrated:!1,cache:M.cache},l.updateQueue.baseState=x,l.memoizedState=x,l.flags&256){l=mT(o,l,m,f);break e}else if(m!==_){_=Si(Error(r(424)),l),Wh(_),l=mT(o,l,m,f);break e}else for(o=l.stateNode.containerInfo,o.nodeType===9?o=o.body:o=o.nodeName==="HTML"?o.ownerDocument.body:o,Xt=Di(o.firstChild),or=l,bt=!0,no=null,Ii=!0,f=c2(l,null,m,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Eu(),m===_){l=ms(o,l,f);break e}lr(o,l,m,f)}l=l.child}return l;case 26:return Xp(o,l),o===null?(f=NC(l.type,null,l.pendingProps,null))?l.memoizedState=f:bt||(f=l.type,o=l.pendingProps,m=hm(Se.current).createElement(f),m[Tn]=l,m[Yn]=o,cr(m,f,o),Cn(m),l.stateNode=m):l.memoizedState=NC(l.type,o.memoizedProps,l.pendingProps,o.memoizedState),null;case 27:return qe(l),o===null&&bt&&(m=l.stateNode=AC(l.type,l.pendingProps,Se.current),or=l,Ii=!0,_=Xt,yo(l.type)?(j0=_,Xt=Di(m.firstChild)):Xt=_),lr(o,l,l.pendingProps.children,f),Xp(o,l),o===null&&(l.flags|=4194304),l.child;case 5:return o===null&&bt&&((_=m=Xt)&&(m=DF(m,l.type,l.pendingProps,Ii),m!==null?(l.stateNode=m,or=l,Xt=Di(m.firstChild),Ii=!1,_=!0):_=!1),_||ro(l)),qe(l),_=l.type,x=l.pendingProps,M=o!==null?o.memoizedProps:null,m=x.children,P0(_,x)?m=null:M!==null&&P0(_,M)&&(l.flags|=32),l.memoizedState!==null&&(_=Oy(o,l,qP,null,null,f),_f._currentValue=_),Xp(o,l),lr(o,l,m,f),l.child;case 6:return o===null&&bt&&((o=f=Xt)&&(f=kF(f,l.pendingProps,Ii),f!==null?(l.stateNode=f,or=l,Xt=null,o=!0):o=!1),o||ro(l)),null;case 13:return gT(o,l,f);case 4:return De(l,l.stateNode.containerInfo),m=l.pendingProps,o===null?l.child=Iu(l,null,m,f):lr(o,l,m,f),l.child;case 11:return oT(o,l,l.type,l.pendingProps,f);case 7:return lr(o,l,l.pendingProps,f),l.child;case 8:return lr(o,l,l.pendingProps.children,f),l.child;case 12:return lr(o,l,l.pendingProps.children,f),l.child;case 10:return m=l.pendingProps,io(l,l.type,m.value),lr(o,l,m.children,f),l.child;case 9:return _=l.type._context,m=l.pendingProps.children,Cu(l),_=ur(_),m=m(_),l.flags|=1,lr(o,l,m,f),l.child;case 14:return uT(o,l,l.type,l.pendingProps,f);case 15:return lT(o,l,l.type,l.pendingProps,f);case 19:return yT(o,l,f);case 31:return eF(o,l,f);case 22:return cT(o,l,f,l.pendingProps);case 24:return Cu(l),m=ur(An),o===null?(_=Ty(),_===null&&(_=Wt,x=wy(),_.pooledCache=x,x.refCount++,x!==null&&(_.pooledCacheLanes|=f),_=x),l.memoizedState={parent:m,cache:_},Sy(l),io(l,An,_)):((o.lanes&f)!==0&&(Ay(o,l),Zh(l,null,null,f),Qh()),_=o.memoizedState,x=l.memoizedState,_.parent!==m?(_={parent:m,cache:m},l.memoizedState=_,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=_),io(l,An,m)):(m=x.cache,io(l,An,m),m!==_.cache&&xy(l,[An],f,!0))),lr(o,l,l.pendingProps.children,f),l.child;case 29:throw l.pendingProps}throw Error(r(156,l.tag))}function gs(o){o.flags|=4}function u0(o,l,f,m,_){if((l=(o.mode&32)!==0)&&(l=!1),l){if(o.flags|=16777216,(_&335544128)===_)if(o.stateNode.complete)o.flags|=8192;else if(qT())o.flags|=8192;else throw Ru=Mp,Cy}else o.flags&=-16777217}function bT(o,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!PC(l))if(qT())o.flags|=8192;else throw Ru=Mp,Cy}function $p(o,l){l!==null&&(o.flags|=4),o.flags&16384&&(l=o.tag!==22?np():536870912,o.lanes|=l,Ql|=l)}function af(o,l){if(!bt)switch(o.tailMode){case"hidden":l=o.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:m.sibling=null}}function Yt(o){var l=o.alternate!==null&&o.alternate.child===o.child,f=0,m=0;if(l)for(var _=o.child;_!==null;)f|=_.lanes|_.childLanes,m|=_.subtreeFlags&65011712,m|=_.flags&65011712,_.return=o,_=_.sibling;else for(_=o.child;_!==null;)f|=_.lanes|_.childLanes,m|=_.subtreeFlags,m|=_.flags,_.return=o,_=_.sibling;return o.subtreeFlags|=m,o.childLanes=f,l}function nF(o,l,f){var m=l.pendingProps;switch(gy(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(l),null;case 1:return Yt(l),null;case 3:return f=l.stateNode,m=null,o!==null&&(m=o.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),fs(An),Re(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(Ll(l)?gs(l):o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,yy())),Yt(l),null;case 26:var _=l.type,x=l.memoizedState;return o===null?(gs(l),x!==null?(Yt(l),bT(l,x)):(Yt(l),u0(l,_,null,m,f))):x?x!==o.memoizedState?(gs(l),Yt(l),bT(l,x)):(Yt(l),l.flags&=-16777217):(o=o.memoizedProps,o!==m&&gs(l),Yt(l),u0(l,_,o,m,f)),null;case 27:if(et(l),f=Se.current,_=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==m&&gs(l);else{if(!m){if(l.stateNode===null)throw Error(r(166));return Yt(l),null}o=ve.current,Ll(l)?JE(l):(o=AC(_,m,f),l.stateNode=o,gs(l))}return Yt(l),null;case 5:if(et(l),_=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==m&&gs(l);else{if(!m){if(l.stateNode===null)throw Error(r(166));return Yt(l),null}if(x=ve.current,Ll(l))JE(l);else{var M=hm(Se.current);switch(x){case 1:x=M.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:x=M.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":x=M.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":x=M.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":x=M.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof m.is=="string"?M.createElement("select",{is:m.is}):M.createElement("select"),m.multiple?x.multiple=!0:m.size&&(x.size=m.size);break;default:x=typeof m.is=="string"?M.createElement(_,{is:m.is}):M.createElement(_)}}x[Tn]=l,x[Yn]=m;e:for(M=l.child;M!==null;){if(M.tag===5||M.tag===6)x.appendChild(M.stateNode);else if(M.tag!==4&&M.tag!==27&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===l)break e;for(;M.sibling===null;){if(M.return===null||M.return===l)break e;M=M.return}M.sibling.return=M.return,M=M.sibling}l.stateNode=x;e:switch(cr(x,_,m),_){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&gs(l)}}return Yt(l),u0(l,l.type,o===null?null:o.memoizedProps,l.pendingProps,f),null;case 6:if(o&&l.stateNode!=null)o.memoizedProps!==m&&gs(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(r(166));if(o=Se.current,Ll(l)){if(o=l.stateNode,f=l.memoizedProps,m=null,_=or,_!==null)switch(_.tag){case 27:case 5:m=_.memoizedProps}o[Tn]=l,o=!!(o.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||gC(o.nodeValue,f)),o||ro(l,!0)}else o=hm(o).createTextNode(m),o[Tn]=l,l.stateNode=o}return Yt(l),null;case 31:if(f=l.memoizedState,o===null||o.memoizedState!==null){if(m=Ll(l),f!==null){if(o===null){if(!m)throw Error(r(318));if(o=l.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(r(557));o[Tn]=l}else Eu(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Yt(l),o=!1}else f=yy(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=f),o=!0;if(!o)return l.flags&256?(ui(l),l):(ui(l),null);if((l.flags&128)!==0)throw Error(r(558))}return Yt(l),null;case 13:if(m=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(_=Ll(l),m!==null&&m.dehydrated!==null){if(o===null){if(!_)throw Error(r(318));if(_=l.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));_[Tn]=l}else Eu(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Yt(l),_=!1}else _=yy(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=_),_=!0;if(!_)return l.flags&256?(ui(l),l):(ui(l),null)}return ui(l),(l.flags&128)!==0?(l.lanes=f,l):(f=m!==null,o=o!==null&&o.memoizedState!==null,f&&(m=l.child,_=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(_=m.alternate.memoizedState.cachePool.pool),x=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(x=m.memoizedState.cachePool.pool),x!==_&&(m.flags|=2048)),f!==o&&f&&(l.child.flags|=8192),$p(l,l.updateQueue),Yt(l),null);case 4:return Re(),o===null&&N0(l.stateNode.containerInfo),Yt(l),null;case 10:return fs(l.type),Yt(l),null;case 19:if($(vn),m=l.memoizedState,m===null)return Yt(l),null;if(_=(l.flags&128)!==0,x=m.rendering,x===null)if(_)af(m,!1);else{if(hn!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(x=Vp(o),x!==null){for(l.flags|=128,af(m,!1),o=x.updateQueue,l.updateQueue=o,$p(l,o),l.subtreeFlags=0,o=f,f=l.child;f!==null;)XE(f,o),f=f.sibling;return ce(vn,vn.current&1|2),bt&&cs(l,m.treeForkCount),l.child}o=o.sibling}m.tail!==null&&tn()>tm&&(l.flags|=128,_=!0,af(m,!1),l.lanes=4194304)}else{if(!_)if(o=Vp(x),o!==null){if(l.flags|=128,_=!0,o=o.updateQueue,l.updateQueue=o,$p(l,o),af(m,!0),m.tail===null&&m.tailMode==="hidden"&&!x.alternate&&!bt)return Yt(l),null}else 2*tn()-m.renderingStartTime>tm&&f!==536870912&&(l.flags|=128,_=!0,af(m,!1),l.lanes=4194304);m.isBackwards?(x.sibling=l.child,l.child=x):(o=m.last,o!==null?o.sibling=x:l.child=x,m.last=x)}return m.tail!==null?(o=m.tail,m.rendering=o,m.tail=o.sibling,m.renderingStartTime=tn(),o.sibling=null,f=vn.current,ce(vn,_?f&1|2:f&1),bt&&cs(l,m.treeForkCount),o):(Yt(l),null);case 22:case 23:return ui(l),Dy(),m=l.memoizedState!==null,o!==null?o.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(f&536870912)!==0&&(l.flags&128)===0&&(Yt(l),l.subtreeFlags&6&&(l.flags|=8192)):Yt(l),f=l.updateQueue,f!==null&&$p(l,f.retryQueue),f=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==f&&(l.flags|=2048),o!==null&&$(Su),null;case 24:return f=null,o!==null&&(f=o.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),fs(An),Yt(l),null;case 25:return null;case 30:return null}throw Error(r(156,l.tag))}function rF(o,l){switch(gy(l),l.tag){case 1:return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return fs(An),Re(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 26:case 27:case 5:return et(l),null;case 31:if(l.memoizedState!==null){if(ui(l),l.alternate===null)throw Error(r(340));Eu()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 13:if(ui(l),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(r(340));Eu()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return $(vn),null;case 4:return Re(),null;case 10:return fs(l.type),null;case 22:case 23:return ui(l),Dy(),o!==null&&$(Su),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 24:return fs(An),null;case 25:return null;default:return null}}function xT(o,l){switch(gy(l),l.tag){case 3:fs(An),Re();break;case 26:case 27:case 5:et(l);break;case 4:Re();break;case 31:l.memoizedState!==null&&ui(l);break;case 13:ui(l);break;case 19:$(vn);break;case 10:fs(l.type);break;case 22:case 23:ui(l),Dy(),o!==null&&$(Su);break;case 24:fs(An)}}function sf(o,l){try{var f=l.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var _=m.next;f=_;do{if((f.tag&o)===o){m=void 0;var x=f.create,M=f.inst;m=x(),M.destroy=m}f=f.next}while(f!==_)}}catch(U){Bt(l,l.return,U)}}function co(o,l,f){try{var m=l.updateQueue,_=m!==null?m.lastEffect:null;if(_!==null){var x=_.next;m=x;do{if((m.tag&o)===o){var M=m.inst,U=M.destroy;if(U!==void 0){M.destroy=void 0,_=l;var K=f,se=U;try{se()}catch(me){Bt(_,K,me)}}}m=m.next}while(m!==x)}}catch(me){Bt(l,l.return,me)}}function wT(o){var l=o.updateQueue;if(l!==null){var f=o.stateNode;try{f2(l,f)}catch(m){Bt(o,o.return,m)}}}function ET(o,l,f){f.props=Du(o.type,o.memoizedProps),f.state=o.memoizedState;try{f.componentWillUnmount()}catch(m){Bt(o,l,m)}}function of(o,l){try{var f=o.ref;if(f!==null){switch(o.tag){case 26:case 27:case 5:var m=o.stateNode;break;case 30:m=o.stateNode;break;default:m=o.stateNode}typeof f=="function"?o.refCleanup=f(m):f.current=m}}catch(_){Bt(o,l,_)}}function ka(o,l){var f=o.ref,m=o.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(_){Bt(o,l,_)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(_){Bt(o,l,_)}else f.current=null}function TT(o){var l=o.type,f=o.memoizedProps,m=o.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(_){Bt(o,o.return,_)}}function l0(o,l,f){try{var m=o.stateNode;CF(m,o.type,f,l),m[Yn]=l}catch(_){Bt(o,o.return,_)}}function CT(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&yo(o.type)||o.tag===4}function c0(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||CT(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&yo(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function h0(o,l,f){var m=o.tag;if(m===5||m===6)o=o.stateNode,l?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(o,l):(l=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,l.appendChild(o),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=Ki));else if(m!==4&&(m===27&&yo(o.type)&&(f=o.stateNode,l=null),o=o.child,o!==null))for(h0(o,l,f),o=o.sibling;o!==null;)h0(o,l,f),o=o.sibling}function Qp(o,l,f){var m=o.tag;if(m===5||m===6)o=o.stateNode,l?f.insertBefore(o,l):f.appendChild(o);else if(m!==4&&(m===27&&yo(o.type)&&(f=o.stateNode),o=o.child,o!==null))for(Qp(o,l,f),o=o.sibling;o!==null;)Qp(o,l,f),o=o.sibling}function ST(o){var l=o.stateNode,f=o.memoizedProps;try{for(var m=o.type,_=l.attributes;_.length;)l.removeAttributeNode(_[0]);cr(l,m,f),l[Tn]=o,l[Yn]=f}catch(x){Bt(o,o.return,x)}}var vs=!1,Nn=!1,f0=!1,AT=typeof WeakSet=="function"?WeakSet:Set,Qn=null;function iF(o,l){if(o=o.containerInfo,M0=ym,o=BE(o),ay(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var _=m.anchorOffset,x=m.focusNode;m=m.focusOffset;try{f.nodeType,x.nodeType}catch{f=null;break e}var M=0,U=-1,K=-1,se=0,me=0,xe=o,oe=null;t:for(;;){for(var de;xe!==f||_!==0&&xe.nodeType!==3||(U=M+_),xe!==x||m!==0&&xe.nodeType!==3||(K=M+m),xe.nodeType===3&&(M+=xe.nodeValue.length),(de=xe.firstChild)!==null;)oe=xe,xe=de;for(;;){if(xe===o)break t;if(oe===f&&++se===_&&(U=M),oe===x&&++me===m&&(K=M),(de=xe.nextSibling)!==null)break;xe=oe,oe=xe.parentNode}xe=de}f=U===-1||K===-1?null:{start:U,end:K}}else f=null}f=f||{start:0,end:0}}else f=null;for(O0={focusedElem:o,selectionRange:f},ym=!1,Qn=l;Qn!==null;)if(l=Qn,o=l.child,(l.subtreeFlags&1028)!==0&&o!==null)o.return=l,Qn=o;else for(;Qn!==null;){switch(l=Qn,x=l.alternate,o=l.flags,l.tag){case 0:if((o&4)!==0&&(o=l.updateQueue,o=o!==null?o.events:null,o!==null))for(f=0;f<o.length;f++)_=o[f],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((o&1024)!==0&&x!==null){o=void 0,f=l,_=x.memoizedProps,x=x.memoizedState,m=f.stateNode;try{var Fe=Du(f.type,_);o=m.getSnapshotBeforeUpdate(Fe,x),m.__reactInternalSnapshotBeforeUpdate=o}catch(Ke){Bt(f,f.return,Ke)}}break;case 3:if((o&1024)!==0){if(o=l.stateNode.containerInfo,f=o.nodeType,f===9)V0(o);else if(f===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":V0(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(r(163))}if(o=l.sibling,o!==null){o.return=l.return,Qn=o;break}Qn=l.return}}function RT(o,l,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:_s(o,f),m&4&&sf(5,f);break;case 1:if(_s(o,f),m&4)if(o=f.stateNode,l===null)try{o.componentDidMount()}catch(M){Bt(f,f.return,M)}else{var _=Du(f.type,l.memoizedProps);l=l.memoizedState;try{o.componentDidUpdate(_,l,o.__reactInternalSnapshotBeforeUpdate)}catch(M){Bt(f,f.return,M)}}m&64&&wT(f),m&512&&of(f,f.return);break;case 3:if(_s(o,f),m&64&&(o=f.updateQueue,o!==null)){if(l=null,f.child!==null)switch(f.child.tag){case 27:case 5:l=f.child.stateNode;break;case 1:l=f.child.stateNode}try{f2(o,l)}catch(M){Bt(f,f.return,M)}}break;case 27:l===null&&m&4&&ST(f);case 26:case 5:_s(o,f),l===null&&m&4&&TT(f),m&512&&of(f,f.return);break;case 12:_s(o,f);break;case 31:_s(o,f),m&4&&DT(o,f);break;case 13:_s(o,f),m&4&&kT(o,f),m&64&&(o=f.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(f=dF.bind(null,f),MF(o,f))));break;case 22:if(m=f.memoizedState!==null||vs,!m){l=l!==null&&l.memoizedState!==null||Nn,_=vs;var x=Nn;vs=m,(Nn=l)&&!x?bs(o,f,(f.subtreeFlags&8772)!==0):_s(o,f),vs=_,Nn=x}break;case 30:break;default:_s(o,f)}}function IT(o){var l=o.alternate;l!==null&&(o.alternate=null,IT(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&xl(l)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var rn=null,Hr=!1;function ys(o,l,f){for(f=f.child;f!==null;)NT(o,l,f),f=f.sibling}function NT(o,l,f){if(pn&&typeof pn.onCommitFiberUnmount=="function")try{pn.onCommitFiberUnmount(Or,f)}catch{}switch(f.tag){case 26:Nn||ka(f,l),ys(o,l,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Nn||ka(f,l);var m=rn,_=Hr;yo(f.type)&&(rn=f.stateNode,Hr=!1),ys(o,l,f),gf(f.stateNode),rn=m,Hr=_;break;case 5:Nn||ka(f,l);case 6:if(m=rn,_=Hr,rn=null,ys(o,l,f),rn=m,Hr=_,rn!==null)if(Hr)try{(rn.nodeType===9?rn.body:rn.nodeName==="HTML"?rn.ownerDocument.body:rn).removeChild(f.stateNode)}catch(x){Bt(f,l,x)}else try{rn.removeChild(f.stateNode)}catch(x){Bt(f,l,x)}break;case 18:rn!==null&&(Hr?(o=rn,wC(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,f.stateNode),ac(o)):wC(rn,f.stateNode));break;case 4:m=rn,_=Hr,rn=f.stateNode.containerInfo,Hr=!0,ys(o,l,f),rn=m,Hr=_;break;case 0:case 11:case 14:case 15:co(2,f,l),Nn||co(4,f,l),ys(o,l,f);break;case 1:Nn||(ka(f,l),m=f.stateNode,typeof m.componentWillUnmount=="function"&&ET(f,l,m)),ys(o,l,f);break;case 21:ys(o,l,f);break;case 22:Nn=(m=Nn)||f.memoizedState!==null,ys(o,l,f),Nn=m;break;default:ys(o,l,f)}}function DT(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null))){o=o.dehydrated;try{ac(o)}catch(f){Bt(l,l.return,f)}}}function kT(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{ac(o)}catch(f){Bt(l,l.return,f)}}function aF(o){switch(o.tag){case 31:case 13:case 19:var l=o.stateNode;return l===null&&(l=o.stateNode=new AT),l;case 22:return o=o.stateNode,l=o._retryCache,l===null&&(l=o._retryCache=new AT),l;default:throw Error(r(435,o.tag))}}function Zp(o,l){var f=aF(o);l.forEach(function(m){if(!f.has(m)){f.add(m);var _=pF.bind(null,o,m);m.then(_,_)}})}function Gr(o,l){var f=l.deletions;if(f!==null)for(var m=0;m<f.length;m++){var _=f[m],x=o,M=l,U=M;e:for(;U!==null;){switch(U.tag){case 27:if(yo(U.type)){rn=U.stateNode,Hr=!1;break e}break;case 5:rn=U.stateNode,Hr=!1;break e;case 3:case 4:rn=U.stateNode.containerInfo,Hr=!0;break e}U=U.return}if(rn===null)throw Error(r(160));NT(x,M,_),rn=null,Hr=!1,x=_.alternate,x!==null&&(x.return=null),_.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)MT(l,o),l=l.sibling}var Ji=null;function MT(o,l){var f=o.alternate,m=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Gr(l,o),Wr(o),m&4&&(co(3,o,o.return),sf(3,o),co(5,o,o.return));break;case 1:Gr(l,o),Wr(o),m&512&&(Nn||f===null||ka(f,f.return)),m&64&&vs&&(o=o.updateQueue,o!==null&&(m=o.callbacks,m!==null&&(f=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var _=Ji;if(Gr(l,o),Wr(o),m&512&&(Nn||f===null||ka(f,f.return)),m&4){var x=f!==null?f.memoizedState:null;if(m=o.memoizedState,f===null)if(m===null)if(o.stateNode===null){e:{m=o.type,f=o.memoizedProps,_=_.ownerDocument||_;t:switch(m){case"title":x=_.getElementsByTagName("title")[0],(!x||x[ya]||x[Tn]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=_.createElement(m),_.head.insertBefore(x,_.querySelector("head > title"))),cr(x,m,f),x[Tn]=o,Cn(x),m=x;break e;case"link":var M=MC("link","href",_).get(m+(f.href||""));if(M){for(var U=0;U<M.length;U++)if(x=M[U],x.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&x.getAttribute("rel")===(f.rel==null?null:f.rel)&&x.getAttribute("title")===(f.title==null?null:f.title)&&x.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){M.splice(U,1);break t}}x=_.createElement(m),cr(x,m,f),_.head.appendChild(x);break;case"meta":if(M=MC("meta","content",_).get(m+(f.content||""))){for(U=0;U<M.length;U++)if(x=M[U],x.getAttribute("content")===(f.content==null?null:""+f.content)&&x.getAttribute("name")===(f.name==null?null:f.name)&&x.getAttribute("property")===(f.property==null?null:f.property)&&x.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&x.getAttribute("charset")===(f.charSet==null?null:f.charSet)){M.splice(U,1);break t}}x=_.createElement(m),cr(x,m,f),_.head.appendChild(x);break;default:throw Error(r(468,m))}x[Tn]=o,Cn(x),m=x}o.stateNode=m}else OC(_,o.type,o.stateNode);else o.stateNode=kC(_,m,o.memoizedProps);else x!==m?(x===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):x.count--,m===null?OC(_,o.type,o.stateNode):kC(_,m,o.memoizedProps)):m===null&&o.stateNode!==null&&l0(o,o.memoizedProps,f.memoizedProps)}break;case 27:Gr(l,o),Wr(o),m&512&&(Nn||f===null||ka(f,f.return)),f!==null&&m&4&&l0(o,o.memoizedProps,f.memoizedProps);break;case 5:if(Gr(l,o),Wr(o),m&512&&(Nn||f===null||ka(f,f.return)),o.flags&32){_=o.stateNode;try{zr(_,"")}catch(Fe){Bt(o,o.return,Fe)}}m&4&&o.stateNode!=null&&(_=o.memoizedProps,l0(o,_,f!==null?f.memoizedProps:_)),m&1024&&(f0=!0);break;case 6:if(Gr(l,o),Wr(o),m&4){if(o.stateNode===null)throw Error(r(162));m=o.memoizedProps,f=o.stateNode;try{f.nodeValue=m}catch(Fe){Bt(o,o.return,Fe)}}break;case 3:if(pm=null,_=Ji,Ji=fm(l.containerInfo),Gr(l,o),Ji=_,Wr(o),m&4&&f!==null&&f.memoizedState.isDehydrated)try{ac(l.containerInfo)}catch(Fe){Bt(o,o.return,Fe)}f0&&(f0=!1,OT(o));break;case 4:m=Ji,Ji=fm(o.stateNode.containerInfo),Gr(l,o),Wr(o),Ji=m;break;case 12:Gr(l,o),Wr(o);break;case 31:Gr(l,o),Wr(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,Zp(o,m)));break;case 13:Gr(l,o),Wr(o),o.child.flags&8192&&o.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(em=tn()),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,Zp(o,m)));break;case 22:_=o.memoizedState!==null;var K=f!==null&&f.memoizedState!==null,se=vs,me=Nn;if(vs=se||_,Nn=me||K,Gr(l,o),Nn=me,vs=se,Wr(o),m&8192)e:for(l=o.stateNode,l._visibility=_?l._visibility&-2:l._visibility|1,_&&(f===null||K||vs||Nn||ku(o)),f=null,l=o;;){if(l.tag===5||l.tag===26){if(f===null){K=f=l;try{if(x=K.stateNode,_)M=x.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{U=K.stateNode;var xe=K.memoizedProps.style,oe=xe!=null&&xe.hasOwnProperty("display")?xe.display:null;U.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(Fe){Bt(K,K.return,Fe)}}}else if(l.tag===6){if(f===null){K=l;try{K.stateNode.nodeValue=_?"":K.memoizedProps}catch(Fe){Bt(K,K.return,Fe)}}}else if(l.tag===18){if(f===null){K=l;try{var de=K.stateNode;_?EC(de,!0):EC(K.stateNode,!1)}catch(Fe){Bt(K,K.return,Fe)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===o)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break e;for(;l.sibling===null;){if(l.return===null||l.return===o)break e;f===l&&(f=null),l=l.return}f===l&&(f=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=o.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,Zp(o,f))));break;case 19:Gr(l,o),Wr(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,Zp(o,m)));break;case 30:break;case 21:break;default:Gr(l,o),Wr(o)}}function Wr(o){var l=o.flags;if(l&2){try{for(var f,m=o.return;m!==null;){if(CT(m)){f=m;break}m=m.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var _=f.stateNode,x=c0(o);Qp(o,x,_);break;case 5:var M=f.stateNode;f.flags&32&&(zr(M,""),f.flags&=-33);var U=c0(o);Qp(o,U,M);break;case 3:case 4:var K=f.stateNode.containerInfo,se=c0(o);h0(o,se,K);break;default:throw Error(r(161))}}catch(me){Bt(o,o.return,me)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function OT(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var l=o;OT(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),o=o.sibling}}function _s(o,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)RT(o,l.alternate,l),l=l.sibling}function ku(o){for(o=o.child;o!==null;){var l=o;switch(l.tag){case 0:case 11:case 14:case 15:co(4,l,l.return),ku(l);break;case 1:ka(l,l.return);var f=l.stateNode;typeof f.componentWillUnmount=="function"&&ET(l,l.return,f),ku(l);break;case 27:gf(l.stateNode);case 26:case 5:ka(l,l.return),ku(l);break;case 22:l.memoizedState===null&&ku(l);break;case 30:ku(l);break;default:ku(l)}o=o.sibling}}function bs(o,l,f){for(f=f&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,_=o,x=l,M=x.flags;switch(x.tag){case 0:case 11:case 15:bs(_,x,f),sf(4,x);break;case 1:if(bs(_,x,f),m=x,_=m.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(se){Bt(m,m.return,se)}if(m=x,_=m.updateQueue,_!==null){var U=m.stateNode;try{var K=_.shared.hiddenCallbacks;if(K!==null)for(_.shared.hiddenCallbacks=null,_=0;_<K.length;_++)h2(K[_],U)}catch(se){Bt(m,m.return,se)}}f&&M&64&&wT(x),of(x,x.return);break;case 27:ST(x);case 26:case 5:bs(_,x,f),f&&m===null&&M&4&&TT(x),of(x,x.return);break;case 12:bs(_,x,f);break;case 31:bs(_,x,f),f&&M&4&&DT(_,x);break;case 13:bs(_,x,f),f&&M&4&&kT(_,x);break;case 22:x.memoizedState===null&&bs(_,x,f),of(x,x.return);break;case 30:break;default:bs(_,x,f)}l=l.sibling}}function d0(o,l){var f=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),o=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(o=l.memoizedState.cachePool.pool),o!==f&&(o!=null&&o.refCount++,f!=null&&qh(f))}function p0(o,l){o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&qh(o))}function ea(o,l,f,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)PT(o,l,f,m),l=l.sibling}function PT(o,l,f,m){var _=l.flags;switch(l.tag){case 0:case 11:case 15:ea(o,l,f,m),_&2048&&sf(9,l);break;case 1:ea(o,l,f,m);break;case 3:ea(o,l,f,m),_&2048&&(o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&qh(o)));break;case 12:if(_&2048){ea(o,l,f,m),o=l.stateNode;try{var x=l.memoizedProps,M=x.id,U=x.onPostCommit;typeof U=="function"&&U(M,l.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(K){Bt(l,l.return,K)}}else ea(o,l,f,m);break;case 31:ea(o,l,f,m);break;case 13:ea(o,l,f,m);break;case 23:break;case 22:x=l.stateNode,M=l.alternate,l.memoizedState!==null?x._visibility&2?ea(o,l,f,m):uf(o,l):x._visibility&2?ea(o,l,f,m):(x._visibility|=2,Xl(o,l,f,m,(l.subtreeFlags&10256)!==0||!1)),_&2048&&d0(M,l);break;case 24:ea(o,l,f,m),_&2048&&p0(l.alternate,l);break;default:ea(o,l,f,m)}}function Xl(o,l,f,m,_){for(_=_&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var x=o,M=l,U=f,K=m,se=M.flags;switch(M.tag){case 0:case 11:case 15:Xl(x,M,U,K,_),sf(8,M);break;case 23:break;case 22:var me=M.stateNode;M.memoizedState!==null?me._visibility&2?Xl(x,M,U,K,_):uf(x,M):(me._visibility|=2,Xl(x,M,U,K,_)),_&&se&2048&&d0(M.alternate,M);break;case 24:Xl(x,M,U,K,_),_&&se&2048&&p0(M.alternate,M);break;default:Xl(x,M,U,K,_)}l=l.sibling}}function uf(o,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var f=o,m=l,_=m.flags;switch(m.tag){case 22:uf(f,m),_&2048&&d0(m.alternate,m);break;case 24:uf(f,m),_&2048&&p0(m.alternate,m);break;default:uf(f,m)}l=l.sibling}}var lf=8192;function Yl(o,l,f){if(o.subtreeFlags&lf)for(o=o.child;o!==null;)FT(o,l,f),o=o.sibling}function FT(o,l,f){switch(o.tag){case 26:Yl(o,l,f),o.flags&lf&&o.memoizedState!==null&&WF(f,Ji,o.memoizedState,o.memoizedProps);break;case 5:Yl(o,l,f);break;case 3:case 4:var m=Ji;Ji=fm(o.stateNode.containerInfo),Yl(o,l,f),Ji=m;break;case 22:o.memoizedState===null&&(m=o.alternate,m!==null&&m.memoizedState!==null?(m=lf,lf=16777216,Yl(o,l,f),lf=m):Yl(o,l,f));break;default:Yl(o,l,f)}}function VT(o){var l=o.alternate;if(l!==null&&(o=l.child,o!==null)){l.child=null;do l=o.sibling,o.sibling=null,o=l;while(o!==null)}}function cf(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Qn=m,BT(m,o)}VT(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)LT(o),o=o.sibling}function LT(o){switch(o.tag){case 0:case 11:case 15:cf(o),o.flags&2048&&co(9,o,o.return);break;case 3:cf(o);break;case 12:cf(o);break;case 22:var l=o.stateNode;o.memoizedState!==null&&l._visibility&2&&(o.return===null||o.return.tag!==13)?(l._visibility&=-3,Jp(o)):cf(o);break;default:cf(o)}}function Jp(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var m=l[f];Qn=m,BT(m,o)}VT(o)}for(o=o.child;o!==null;){switch(l=o,l.tag){case 0:case 11:case 15:co(8,l,l.return),Jp(l);break;case 22:f=l.stateNode,f._visibility&2&&(f._visibility&=-3,Jp(l));break;default:Jp(l)}o=o.sibling}}function BT(o,l){for(;Qn!==null;){var f=Qn;switch(f.tag){case 0:case 11:case 15:co(8,f,l);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:qh(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,Qn=m;else e:for(f=o;Qn!==null;){m=Qn;var _=m.sibling,x=m.return;if(IT(m),m===f){Qn=null;break e}if(_!==null){_.return=x,Qn=_;break e}Qn=x}}}var sF={getCacheForType:function(o){var l=ur(An),f=l.data.get(o);return f===void 0&&(f=o(),l.data.set(o,f)),f},cacheSignal:function(){return ur(An).controller.signal}},oF=typeof WeakMap=="function"?WeakMap:Map,kt=0,Wt=null,dt=null,gt=0,Lt=0,li=null,ho=!1,$l=!1,m0=!1,xs=0,hn=0,fo=0,Mu=0,g0=0,ci=0,Ql=0,hf=null,qr=null,v0=!1,em=0,jT=0,tm=1/0,nm=null,po=null,Bn=0,mo=null,Zl=null,ws=0,y0=0,_0=null,UT=null,ff=0,b0=null;function hi(){return(kt&2)!==0&&gt!==0?gt&-gt:q.T!==null?S0():rp()}function zT(){if(ci===0)if((gt&536870912)===0||bt){var o=su;su<<=1,(su&3932160)===0&&(su=262144),ci=o}else ci=536870912;return o=oi.current,o!==null&&(o.flags|=32),ci}function Kr(o,l,f){(o===Wt&&(Lt===2||Lt===9)||o.cancelPendingCommit!==null)&&(Jl(o,0),go(o,gt,ci,!1)),ou(o,f),((kt&2)===0||o!==Wt)&&(o===Wt&&((kt&2)===0&&(Mu|=f),hn===4&&go(o,gt,ci,!1)),Ma(o))}function HT(o,l,f){if((kt&6)!==0)throw Error(r(327));var m=!f&&(l&127)===0&&(l&o.expiredLanes)===0||Gi(o,l),_=m?cF(o,l):w0(o,l,!0),x=m;do{if(_===0){$l&&!m&&go(o,l,0,!1);break}else{if(f=o.current.alternate,x&&!uF(f)){_=w0(o,l,!1),x=!1;continue}if(_===2){if(x=l,o.errorRecoveryDisabledLanes&x)var M=0;else M=o.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){l=M;e:{var U=o;_=hf;var K=U.current.memoizedState.isDehydrated;if(K&&(Jl(U,M).flags|=256),M=w0(U,M,!1),M!==2){if(m0&&!K){U.errorRecoveryDisabledLanes|=x,Mu|=x,_=4;break e}x=qr,qr=_,x!==null&&(qr===null?qr=x:qr.push.apply(qr,x))}_=M}if(x=!1,_!==2)continue}}if(_===1){Jl(o,0),go(o,l,0,!0);break}e:{switch(m=o,x=_,x){case 0:case 1:throw Error(r(345));case 4:if((l&4194048)!==l)break;case 6:go(m,l,ci,!ho);break e;case 2:qr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((l&62914560)===l&&(_=em+300-tn(),10<_)){if(go(m,l,ci,!ho),ma(m,0,!0)!==0)break e;ws=l,m.timeoutHandle=bC(GT.bind(null,m,f,qr,nm,v0,l,ci,Mu,Ql,ho,x,"Throttled",-0,0),_);break e}GT(m,f,qr,nm,v0,l,ci,Mu,Ql,ho,x,null,-0,0)}}break}while(!0);Ma(o)}function GT(o,l,f,m,_,x,M,U,K,se,me,xe,oe,de){if(o.timeoutHandle=-1,xe=l.subtreeFlags,xe&8192||(xe&16785408)===16785408){xe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ki},FT(l,x,xe);var Fe=(x&62914560)===x?em-tn():(x&4194048)===x?jT-tn():0;if(Fe=qF(xe,Fe),Fe!==null){ws=x,o.cancelPendingCommit=Fe(ZT.bind(null,o,l,x,f,m,_,M,U,K,me,xe,null,oe,de)),go(o,x,M,!se);return}}ZT(o,l,x,f,m,_,M,U,K)}function uF(o){for(var l=o;;){var f=l.tag;if((f===0||f===11||f===15)&&l.flags&16384&&(f=l.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var _=f[m],x=_.getSnapshot;_=_.value;try{if(!ai(x(),_))return!1}catch{return!1}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function go(o,l,f,m){l&=~g0,l&=~Mu,o.suspendedLanes|=l,o.pingedLanes&=~l,m&&(o.warmLanes|=l),m=o.expirationTimes;for(var _=l;0<_;){var x=31-mn(_),M=1<<x;m[x]=-1,_&=~M}f!==0&&uu(o,f,l)}function rm(){return(kt&6)===0?(df(0),!1):!0}function x0(){if(dt!==null){if(Lt===0)var o=dt.return;else o=dt,hs=Tu=null,Vy(o),Hl=null,Xh=0,o=dt;for(;o!==null;)xT(o.alternate,o),o=o.return;dt=null}}function Jl(o,l){var f=o.timeoutHandle;f!==-1&&(o.timeoutHandle=-1,RF(f)),f=o.cancelPendingCommit,f!==null&&(o.cancelPendingCommit=null,f()),ws=0,x0(),Wt=o,dt=f=ls(o.current,null),gt=l,Lt=0,li=null,ho=!1,$l=Gi(o,l),m0=!1,Ql=ci=g0=Mu=fo=hn=0,qr=hf=null,v0=!1,(l&8)!==0&&(l|=l&32);var m=o.entangledLanes;if(m!==0)for(o=o.entanglements,m&=l;0<m;){var _=31-mn(m),x=1<<_;l|=o[_],m&=~x}return xs=l,Tp(),f}function WT(o,l){lt=null,q.H=nf,l===zl||l===kp?(l=o2(),Lt=3):l===Cy?(l=o2(),Lt=4):Lt=l===Jy?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,li=l,dt===null&&(hn=1,qp(o,Si(l,o.current)))}function qT(){var o=oi.current;return o===null?!0:(gt&4194048)===gt?Ni===null:(gt&62914560)===gt||(gt&536870912)!==0?o===Ni:!1}function KT(){var o=q.H;return q.H=nf,o===null?nf:o}function XT(){var o=q.A;return q.A=sF,o}function im(){hn=4,ho||(gt&4194048)!==gt&&oi.current!==null||($l=!0),(fo&134217727)===0&&(Mu&134217727)===0||Wt===null||go(Wt,gt,ci,!1)}function w0(o,l,f){var m=kt;kt|=2;var _=KT(),x=XT();(Wt!==o||gt!==l)&&(nm=null,Jl(o,l)),l=!1;var M=hn;e:do try{if(Lt!==0&&dt!==null){var U=dt,K=li;switch(Lt){case 8:x0(),M=6;break e;case 3:case 2:case 9:case 6:oi.current===null&&(l=!0);var se=Lt;if(Lt=0,li=null,ec(o,U,K,se),f&&$l){M=0;break e}break;default:se=Lt,Lt=0,li=null,ec(o,U,K,se)}}lF(),M=hn;break}catch(me){WT(o,me)}while(!0);return l&&o.shellSuspendCounter++,hs=Tu=null,kt=m,q.H=_,q.A=x,dt===null&&(Wt=null,gt=0,Tp()),M}function lF(){for(;dt!==null;)YT(dt)}function cF(o,l){var f=kt;kt|=2;var m=KT(),_=XT();Wt!==o||gt!==l?(nm=null,tm=tn()+500,Jl(o,l)):$l=Gi(o,l);e:do try{if(Lt!==0&&dt!==null){l=dt;var x=li;t:switch(Lt){case 1:Lt=0,li=null,ec(o,l,x,1);break;case 2:case 9:if(a2(x)){Lt=0,li=null,$T(l);break}l=function(){Lt!==2&&Lt!==9||Wt!==o||(Lt=7),Ma(o)},x.then(l,l);break e;case 3:Lt=7;break e;case 4:Lt=5;break e;case 7:a2(x)?(Lt=0,li=null,$T(l)):(Lt=0,li=null,ec(o,l,x,7));break;case 5:var M=null;switch(dt.tag){case 26:M=dt.memoizedState;case 5:case 27:var U=dt;if(M?PC(M):U.stateNode.complete){Lt=0,li=null;var K=U.sibling;if(K!==null)dt=K;else{var se=U.return;se!==null?(dt=se,am(se)):dt=null}break t}}Lt=0,li=null,ec(o,l,x,5);break;case 6:Lt=0,li=null,ec(o,l,x,6);break;case 8:x0(),hn=6;break e;default:throw Error(r(462))}}hF();break}catch(me){WT(o,me)}while(!0);return hs=Tu=null,q.H=m,q.A=_,kt=f,dt!==null?0:(Wt=null,gt=0,Tp(),hn)}function hF(){for(;dt!==null&&!jr();)YT(dt)}function YT(o){var l=_T(o.alternate,o,xs);o.memoizedProps=o.pendingProps,l===null?am(o):dt=l}function $T(o){var l=o,f=l.alternate;switch(l.tag){case 15:case 0:l=dT(f,l,l.pendingProps,l.type,void 0,gt);break;case 11:l=dT(f,l,l.pendingProps,l.type.render,l.ref,gt);break;case 5:Vy(l);default:xT(f,l),l=dt=XE(l,xs),l=_T(f,l,xs)}o.memoizedProps=o.pendingProps,l===null?am(o):dt=l}function ec(o,l,f,m){hs=Tu=null,Vy(l),Hl=null,Xh=0;var _=l.return;try{if(JP(o,_,l,f,gt)){hn=1,qp(o,Si(f,o.current)),dt=null;return}}catch(x){if(_!==null)throw dt=_,x;hn=1,qp(o,Si(f,o.current)),dt=null;return}l.flags&32768?(bt||m===1?o=!0:$l||(gt&536870912)!==0?o=!1:(ho=o=!0,(m===2||m===9||m===3||m===6)&&(m=oi.current,m!==null&&m.tag===13&&(m.flags|=16384))),QT(l,o)):am(l)}function am(o){var l=o;do{if((l.flags&32768)!==0){QT(l,ho);return}o=l.return;var f=nF(l.alternate,l,xs);if(f!==null){dt=f;return}if(l=l.sibling,l!==null){dt=l;return}dt=l=o}while(l!==null);hn===0&&(hn=5)}function QT(o,l){do{var f=rF(o.alternate,o);if(f!==null){f.flags&=32767,dt=f;return}if(f=o.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!l&&(o=o.sibling,o!==null)){dt=o;return}dt=o=f}while(o!==null);hn=6,dt=null}function ZT(o,l,f,m,_,x,M,U,K){o.cancelPendingCommit=null;do sm();while(Bn!==0);if((kt&6)!==0)throw Error(r(327));if(l!==null){if(l===o.current)throw Error(r(177));if(x=l.lanes|l.childLanes,x|=cy,ty(o,f,x,M,U,K),o===Wt&&(dt=Wt=null,gt=0),Zl=l,mo=o,ws=f,y0=x,_0=_,UT=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,mF(Ln,function(){return rC(),null})):(o.callbackNode=null,o.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=q.T,q.T=null,_=X.p,X.p=2,M=kt,kt|=4;try{iF(o,l,f)}finally{kt=M,X.p=_,q.T=m}}Bn=1,JT(),eC(),tC()}}function JT(){if(Bn===1){Bn=0;var o=mo,l=Zl,f=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||f){f=q.T,q.T=null;var m=X.p;X.p=2;var _=kt;kt|=4;try{MT(l,o);var x=O0,M=BE(o.containerInfo),U=x.focusedElem,K=x.selectionRange;if(M!==U&&U&&U.ownerDocument&&LE(U.ownerDocument.documentElement,U)){if(K!==null&&ay(U)){var se=K.start,me=K.end;if(me===void 0&&(me=se),"selectionStart"in U)U.selectionStart=se,U.selectionEnd=Math.min(me,U.value.length);else{var xe=U.ownerDocument||document,oe=xe&&xe.defaultView||window;if(oe.getSelection){var de=oe.getSelection(),Fe=U.textContent.length,Ke=Math.min(K.start,Fe),Ht=K.end===void 0?Ke:Math.min(K.end,Fe);!de.extend&&Ke>Ht&&(M=Ht,Ht=Ke,Ke=M);var te=VE(U,Ke),Q=VE(U,Ht);if(te&&Q&&(de.rangeCount!==1||de.anchorNode!==te.node||de.anchorOffset!==te.offset||de.focusNode!==Q.node||de.focusOffset!==Q.offset)){var ae=xe.createRange();ae.setStart(te.node,te.offset),de.removeAllRanges(),Ke>Ht?(de.addRange(ae),de.extend(Q.node,Q.offset)):(ae.setEnd(Q.node,Q.offset),de.addRange(ae))}}}}for(xe=[],de=U;de=de.parentNode;)de.nodeType===1&&xe.push({element:de,left:de.scrollLeft,top:de.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<xe.length;U++){var ye=xe[U];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}ym=!!M0,O0=M0=null}finally{kt=_,X.p=m,q.T=f}}o.current=l,Bn=2}}function eC(){if(Bn===2){Bn=0;var o=mo,l=Zl,f=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||f){f=q.T,q.T=null;var m=X.p;X.p=2;var _=kt;kt|=4;try{RT(o,l.alternate,l)}finally{kt=_,X.p=m,q.T=f}}Bn=3}}function tC(){if(Bn===4||Bn===3){Bn=0,yr();var o=mo,l=Zl,f=ws,m=UT;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Bn=5:(Bn=0,Zl=mo=null,nC(o,o.pendingLanes));var _=o.pendingLanes;if(_===0&&(po=null),as(f),l=l.stateNode,pn&&typeof pn.onCommitFiberRoot=="function")try{pn.onCommitFiberRoot(Or,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=q.T,_=X.p,X.p=2,q.T=null;try{for(var x=o.onRecoverableError,M=0;M<m.length;M++){var U=m[M];x(U.value,{componentStack:U.stack})}}finally{q.T=l,X.p=_}}(ws&3)!==0&&sm(),Ma(o),_=o.pendingLanes,(f&261930)!==0&&(_&42)!==0?o===b0?ff++:(ff=0,b0=o):ff=0,df(0)}}function nC(o,l){(o.pooledCacheLanes&=l)===0&&(l=o.pooledCache,l!=null&&(o.pooledCache=null,qh(l)))}function sm(){return JT(),eC(),tC(),rC()}function rC(){if(Bn!==5)return!1;var o=mo,l=y0;y0=0;var f=as(ws),m=q.T,_=X.p;try{X.p=32>f?32:f,q.T=null,f=_0,_0=null;var x=mo,M=ws;if(Bn=0,Zl=mo=null,ws=0,(kt&6)!==0)throw Error(r(331));var U=kt;if(kt|=4,LT(x.current),PT(x,x.current,M,f),kt=U,df(0,!1),pn&&typeof pn.onPostCommitFiberRoot=="function")try{pn.onPostCommitFiberRoot(Or,x)}catch{}return!0}finally{X.p=_,q.T=m,nC(o,l)}}function iC(o,l,f){l=Si(f,l),l=Zy(o.stateNode,l,2),o=oo(o,l,2),o!==null&&(ou(o,2),Ma(o))}function Bt(o,l,f){if(o.tag===3)iC(o,o,f);else for(;l!==null;){if(l.tag===3){iC(l,o,f);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(po===null||!po.has(m))){o=Si(f,o),f=aT(2),m=oo(l,f,2),m!==null&&(sT(f,m,l,o),ou(m,2),Ma(m));break}}l=l.return}}function E0(o,l,f){var m=o.pingCache;if(m===null){m=o.pingCache=new oF;var _=new Set;m.set(l,_)}else _=m.get(l),_===void 0&&(_=new Set,m.set(l,_));_.has(f)||(m0=!0,_.add(f),o=fF.bind(null,o,l,f),l.then(o,o))}function fF(o,l,f){var m=o.pingCache;m!==null&&m.delete(l),o.pingedLanes|=o.suspendedLanes&f,o.warmLanes&=~f,Wt===o&&(gt&f)===f&&(hn===4||hn===3&&(gt&62914560)===gt&&300>tn()-em?(kt&2)===0&&Jl(o,0):g0|=f,Ql===gt&&(Ql=0)),Ma(o)}function aC(o,l){l===0&&(l=np()),o=xu(o,l),o!==null&&(ou(o,l),Ma(o))}function dF(o){var l=o.memoizedState,f=0;l!==null&&(f=l.retryLane),aC(o,f)}function pF(o,l){var f=0;switch(o.tag){case 31:case 13:var m=o.stateNode,_=o.memoizedState;_!==null&&(f=_.retryLane);break;case 19:m=o.stateNode;break;case 22:m=o.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(l),aC(o,f)}function mF(o,l){return Rt(o,l)}var om=null,tc=null,T0=!1,um=!1,C0=!1,vo=0;function Ma(o){o!==tc&&o.next===null&&(tc===null?om=tc=o:tc=tc.next=o),um=!0,T0||(T0=!0,vF())}function df(o,l){if(!C0&&um){C0=!0;do for(var f=!1,m=om;m!==null;){if(o!==0){var _=m.pendingLanes;if(_===0)var x=0;else{var M=m.suspendedLanes,U=m.pingedLanes;x=(1<<31-mn(42|o)+1)-1,x&=_&~(M&~U),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(f=!0,lC(m,x))}else x=gt,x=ma(m,m===Wt?x:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(x&3)===0||Gi(m,x)||(f=!0,lC(m,x));m=m.next}while(f);C0=!1}}function gF(){sC()}function sC(){um=T0=!1;var o=0;vo!==0&&AF()&&(o=vo);for(var l=tn(),f=null,m=om;m!==null;){var _=m.next,x=oC(m,l);x===0?(m.next=null,f===null?om=_:f.next=_,_===null&&(tc=f)):(f=m,(o!==0||(x&3)!==0)&&(um=!0)),m=_}Bn!==0&&Bn!==5||df(o),vo!==0&&(vo=0)}function oC(o,l){for(var f=o.suspendedLanes,m=o.pingedLanes,_=o.expirationTimes,x=o.pendingLanes&-62914561;0<x;){var M=31-mn(x),U=1<<M,K=_[M];K===-1?((U&f)===0||(U&m)!==0)&&(_[M]=ey(U,l)):K<=l&&(o.expiredLanes|=U),x&=~U}if(l=Wt,f=gt,f=ma(o,o===l?f:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m=o.callbackNode,f===0||o===l&&(Lt===2||Lt===9)||o.cancelPendingCommit!==null)return m!==null&&m!==null&&wn(m),o.callbackNode=null,o.callbackPriority=0;if((f&3)===0||Gi(o,f)){if(l=f&-f,l===o.callbackPriority)return l;switch(m!==null&&wn(m),as(f)){case 2:case 8:f=bi;break;case 32:f=Ln;break;case 268435456:f=gl;break;default:f=Ln}return m=uC.bind(null,o),f=Rt(f,m),o.callbackPriority=l,o.callbackNode=f,l}return m!==null&&m!==null&&wn(m),o.callbackPriority=2,o.callbackNode=null,2}function uC(o,l){if(Bn!==0&&Bn!==5)return o.callbackNode=null,o.callbackPriority=0,null;var f=o.callbackNode;if(sm()&&o.callbackNode!==f)return null;var m=gt;return m=ma(o,o===Wt?m:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m===0?null:(HT(o,m,l),oC(o,tn()),o.callbackNode!=null&&o.callbackNode===f?uC.bind(null,o):null)}function lC(o,l){if(sm())return null;HT(o,l,!0)}function vF(){IF(function(){(kt&6)!==0?Rt(is,gF):sC()})}function S0(){if(vo===0){var o=jl;o===0&&(o=da,da<<=1,(da&261888)===0&&(da=256)),vo=o}return vo}function cC(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Cl(""+o)}function hC(o,l){var f=l.ownerDocument.createElement("input");return f.name=l.name,f.value=l.value,o.id&&f.setAttribute("form",o.id),l.parentNode.insertBefore(f,l),o=new FormData(o),f.parentNode.removeChild(f),o}function yF(o,l,f,m,_){if(l==="submit"&&f&&f.stateNode===_){var x=cC((_[Yn]||null).action),M=m.submitter;M&&(l=(l=M[Yn]||null)?cC(l.formAction):M.getAttribute("formAction"),l!==null&&(x=l,M=null));var U=new Sa("action","action",null,m,_);o.push({event:U,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(vo!==0){var K=M?hC(_,M):new FormData(_);qy(f,{pending:!0,data:K,method:_.method,action:x},null,K)}}else typeof x=="function"&&(U.preventDefault(),K=M?hC(_,M):new FormData(_),qy(f,{pending:!0,data:K,method:_.method,action:x},x,K))},currentTarget:_}]})}}for(var A0=0;A0<ly.length;A0++){var R0=ly[A0],_F=R0.toLowerCase(),bF=R0[0].toUpperCase()+R0.slice(1);Zi(_F,"on"+bF)}Zi(zE,"onAnimationEnd"),Zi(HE,"onAnimationIteration"),Zi(GE,"onAnimationStart"),Zi("dblclick","onDoubleClick"),Zi("focusin","onFocus"),Zi("focusout","onBlur"),Zi(FP,"onTransitionRun"),Zi(VP,"onTransitionStart"),Zi(LP,"onTransitionCancel"),Zi(WE,"onTransitionEnd"),wa("onMouseEnter",["mouseout","mouseover"]),wa("onMouseLeave",["mouseout","mouseover"]),wa("onPointerEnter",["pointerout","pointerover"]),wa("onPointerLeave",["pointerout","pointerover"]),xa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xa("onBeforeInput",["compositionend","keypress","textInput","paste"]),xa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xF=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(pf));function fC(o,l){l=(l&4)!==0;for(var f=0;f<o.length;f++){var m=o[f],_=m.event;m=m.listeners;e:{var x=void 0;if(l)for(var M=m.length-1;0<=M;M--){var U=m[M],K=U.instance,se=U.currentTarget;if(U=U.listener,K!==x&&_.isPropagationStopped())break e;x=U,_.currentTarget=se;try{x(_)}catch(me){Ep(me)}_.currentTarget=null,x=K}else for(M=0;M<m.length;M++){if(U=m[M],K=U.instance,se=U.currentTarget,U=U.listener,K!==x&&_.isPropagationStopped())break e;x=U,_.currentTarget=se;try{x(_)}catch(me){Ep(me)}_.currentTarget=null,x=K}}}}function pt(o,l){var f=l[bl];f===void 0&&(f=l[bl]=new Set);var m=o+"__bubble";f.has(m)||(dC(l,o,2,!1),f.add(m))}function I0(o,l,f){var m=0;l&&(m|=4),dC(f,o,m,l)}var lm="_reactListening"+Math.random().toString(36).slice(2);function N0(o){if(!o[lm]){o[lm]=!0,Ch.forEach(function(f){f!=="selectionchange"&&(xF.has(f)||I0(f,!1,o),I0(f,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[lm]||(l[lm]=!0,I0("selectionchange",!1,l))}}function dC(o,l,f,m){switch(zC(l)){case 2:var _=YF;break;case 8:_=$F;break;default:_=W0}f=_.bind(null,l,f,o),_=void 0,!du||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(_=!0),m?_!==void 0?o.addEventListener(l,f,{capture:!0,passive:_}):o.addEventListener(l,f,!0):_!==void 0?o.addEventListener(l,f,{passive:_}):o.addEventListener(l,f,!1)}function D0(o,l,f,m,_){var x=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var M=m.tag;if(M===3||M===4){var U=m.stateNode.containerInfo;if(U===_)break;if(M===4)for(M=m.return;M!==null;){var K=M.tag;if((K===3||K===4)&&M.stateNode.containerInfo===_)return;M=M.return}for(;U!==null;){if(M=_a(U),M===null)return;if(K=M.tag,K===5||K===6||K===26||K===27){m=x=M;continue e}U=U.parentNode}}m=m.return}Qs(function(){var se=x,me=wi(f),xe=[];e:{var oe=qE.get(o);if(oe!==void 0){var de=Sa,Fe=o;switch(o){case"keypress":if(mu(f)===0)break e;case"keydown":case"keyup":de=bp;break;case"focusin":Fe="focus",de=vu;break;case"focusout":Fe="blur",de=vu;break;case"beforeblur":case"afterblur":de=vu;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=Lh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=hp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=A;break;case zE:case HE:case GE:de=dp;break;case WE:de=H;break;case"scroll":case"scrollend":de=Vh;break;case"wheel":de=he;break;case"copy":case"cut":case"paste":de=pp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=us;break;case"toggle":case"beforetoggle":de=ut}var Ke=(l&4)!==0,Ht=!Ke&&(o==="scroll"||o==="scrollend"),te=Ke?oe!==null?oe+"Capture":null:oe;Ke=[];for(var Q=se,ae;Q!==null;){var ye=Q;if(ae=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||ae===null||te===null||(ye=Xi(Q,te),ye!=null&&Ke.push(mf(Q,ye,ae))),Ht)break;Q=Q.return}0<Ke.length&&(oe=new de(oe,Fe,null,f,me),xe.push({event:oe,listeners:Ke}))}}if((l&7)===0){e:{if(oe=o==="mouseover"||o==="pointerover",de=o==="mouseout"||o==="pointerout",oe&&f!==Oh&&(Fe=f.relatedTarget||f.fromElement)&&(_a(Fe)||Fe[va]))break e;if((de||oe)&&(oe=me.window===me?me:(oe=me.ownerDocument)?oe.defaultView||oe.parentWindow:window,de?(Fe=f.relatedTarget||f.toElement,de=se,Fe=Fe?_a(Fe):null,Fe!==null&&(Ht=a(Fe),Ke=Fe.tag,Fe!==Ht||Ke!==5&&Ke!==27&&Ke!==6)&&(Fe=null)):(de=null,Fe=se),de!==Fe)){if(Ke=Lh,ye="onMouseLeave",te="onMouseEnter",Q="mouse",(o==="pointerout"||o==="pointerover")&&(Ke=us,ye="onPointerLeave",te="onPointerEnter",Q="pointer"),Ht=de==null?oe:ri(de),ae=Fe==null?oe:ri(Fe),oe=new Ke(ye,Q+"leave",de,f,me),oe.target=Ht,oe.relatedTarget=ae,ye=null,_a(me)===se&&(Ke=new Ke(te,Q+"enter",Fe,f,me),Ke.target=ae,Ke.relatedTarget=Ht,ye=Ke),Ht=ye,de&&Fe)t:{for(Ke=wF,te=de,Q=Fe,ae=0,ye=te;ye;ye=Ke(ye))ae++;ye=0;for(var Ge=Q;Ge;Ge=Ke(Ge))ye++;for(;0<ae-ye;)te=Ke(te),ae--;for(;0<ye-ae;)Q=Ke(Q),ye--;for(;ae--;){if(te===Q||Q!==null&&te===Q.alternate){Ke=te;break t}te=Ke(te),Q=Ke(Q)}Ke=null}else Ke=null;de!==null&&pC(xe,oe,de,Ke,!1),Fe!==null&&Ht!==null&&pC(xe,Ht,Fe,Ke,!0)}}e:{if(oe=se?ri(se):window,de=oe.nodeName&&oe.nodeName.toLowerCase(),de==="select"||de==="input"&&oe.type==="file")var It=DE;else if(IE(oe))if(kE)It=MP;else{It=DP;var Be=NP}else de=oe.nodeName,!de||de.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?se&&Tl(se.elementType)&&(It=DE):It=kP;if(It&&(It=It(o,se))){NE(xe,It,f,me);break e}Be&&Be(o,oe,se),o==="focusout"&&se&&oe.type==="number"&&se.memoizedProps.value!=null&&Dh(oe,"number",oe.value)}switch(Be=se?ri(se):window,o){case"focusin":(IE(Be)||Be.contentEditable==="true")&&(kl=Be,sy=se,Hh=null);break;case"focusout":Hh=sy=kl=null;break;case"mousedown":oy=!0;break;case"contextmenu":case"mouseup":case"dragend":oy=!1,jE(xe,f,me);break;case"selectionchange":if(PP)break;case"keydown":case"keyup":jE(xe,f,me)}var ct;if(Dt)e:{switch(o){case"compositionstart":var vt="onCompositionStart";break e;case"compositionend":vt="onCompositionEnd";break e;case"compositionupdate":vt="onCompositionUpdate";break e}vt=void 0}else Dl?yu(o,f)&&(vt="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(vt="onCompositionStart");vt&&(Ia&&f.locale!=="ko"&&(Dl||vt!=="onCompositionStart"?vt==="onCompositionEnd"&&Dl&&(ct=Fh()):(Ca=me,Ph="value"in Ca?Ca.value:Ca.textContent,Dl=!0)),Be=cm(se,vt),0<Be.length&&(vt=new Ra(vt,o,null,f,me),xe.push({event:vt,listeners:Be}),ct?vt.data=ct:(ct=Nl(f),ct!==null&&(vt.data=ct)))),(ct=Ti?SP(o,f):AP(o,f))&&(vt=cm(se,"onBeforeInput"),0<vt.length&&(Be=new Ra("onBeforeInput","beforeinput",null,f,me),xe.push({event:Be,listeners:vt}),Be.data=ct)),yF(xe,o,se,f,me)}fC(xe,l)})}function mf(o,l,f){return{instance:o,listener:l,currentTarget:f}}function cm(o,l){for(var f=l+"Capture",m=[];o!==null;){var _=o,x=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||x===null||(_=Xi(o,f),_!=null&&m.unshift(mf(o,_,x)),_=Xi(o,l),_!=null&&m.push(mf(o,_,x))),o.tag===3)return m;o=o.return}return[]}function wF(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function pC(o,l,f,m,_){for(var x=l._reactName,M=[];f!==null&&f!==m;){var U=f,K=U.alternate,se=U.stateNode;if(U=U.tag,K!==null&&K===m)break;U!==5&&U!==26&&U!==27||se===null||(K=se,_?(se=Xi(f,x),se!=null&&M.unshift(mf(f,se,K))):_||(se=Xi(f,x),se!=null&&M.push(mf(f,se,K)))),f=f.return}M.length!==0&&o.push({event:l,listeners:M})}var EF=/\r\n?/g,TF=/\u0000|\uFFFD/g;function mC(o){return(typeof o=="string"?o:""+o).replace(EF,`
`).replace(TF,"")}function gC(o,l){return l=mC(l),mC(o)===l}function zt(o,l,f,m,_,x){switch(f){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||zr(o,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&zr(o,""+m);break;case"className":ii(o,"class",m);break;case"tabIndex":ii(o,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":ii(o,f,m);break;case"style":Mh(o,m,x);break;case"data":if(l!=="object"){ii(o,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||f!=="href")){o.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(f);break}m=Cl(""+m),o.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){o.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(f==="formAction"?(l!=="input"&&zt(o,l,"name",_.name,_,null),zt(o,l,"formEncType",_.formEncType,_,null),zt(o,l,"formMethod",_.formMethod,_,null),zt(o,l,"formTarget",_.formTarget,_,null)):(zt(o,l,"encType",_.encType,_,null),zt(o,l,"method",_.method,_,null),zt(o,l,"target",_.target,_,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(f);break}m=Cl(""+m),o.setAttribute(f,m);break;case"onClick":m!=null&&(o.onclick=Ki);break;case"onScroll":m!=null&&pt("scroll",o);break;case"onScrollEnd":m!=null&&pt("scrollend",o);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(f=m.__html,f!=null){if(_.children!=null)throw Error(r(60));o.innerHTML=f}}break;case"multiple":o.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":o.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){o.removeAttribute("xlink:href");break}f=Cl(""+m),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(f,""+m):o.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(f,""):o.removeAttribute(f);break;case"capture":case"download":m===!0?o.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(f,m):o.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?o.setAttribute(f,m):o.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?o.removeAttribute(f):o.setAttribute(f,m);break;case"popover":pt("beforetoggle",o),pt("toggle",o),wl(o,"popover",m);break;case"xlinkActuate":Sn(o,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Sn(o,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Sn(o,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Sn(o,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Sn(o,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Sn(o,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Sn(o,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Sn(o,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Sn(o,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":wl(o,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=cp.get(f)||f,wl(o,f,m))}}function k0(o,l,f,m,_,x){switch(f){case"style":Mh(o,m,x);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(f=m.__html,f!=null){if(_.children!=null)throw Error(r(60));o.innerHTML=f}}break;case"children":typeof m=="string"?zr(o,m):(typeof m=="number"||typeof m=="bigint")&&zr(o,""+m);break;case"onScroll":m!=null&&pt("scroll",o);break;case"onScrollEnd":m!=null&&pt("scrollend",o);break;case"onClick":m!=null&&(o.onclick=Ki);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Sh.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(_=f.endsWith("Capture"),l=f.slice(2,_?f.length-7:void 0),x=o[Yn]||null,x=x!=null?x[f]:null,typeof x=="function"&&o.removeEventListener(l,x,_),typeof m=="function")){typeof x!="function"&&x!==null&&(f in o?o[f]=null:o.hasAttribute(f)&&o.removeAttribute(f)),o.addEventListener(l,m,_);break e}f in o?o[f]=m:m===!0?o.setAttribute(f,""):wl(o,f,m)}}}function cr(o,l,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pt("error",o),pt("load",o);var m=!1,_=!1,x;for(x in f)if(f.hasOwnProperty(x)){var M=f[x];if(M!=null)switch(x){case"src":m=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,l));default:zt(o,l,x,M,f,null)}}_&&zt(o,l,"srcSet",f.srcSet,f,null),m&&zt(o,l,"src",f.src,f,null);return;case"input":pt("invalid",o);var U=x=M=_=null,K=null,se=null;for(m in f)if(f.hasOwnProperty(m)){var me=f[m];if(me!=null)switch(m){case"name":_=me;break;case"type":M=me;break;case"checked":K=me;break;case"defaultChecked":se=me;break;case"value":x=me;break;case"defaultValue":U=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,l));break;default:zt(o,l,m,me,f,null)}}op(o,x,U,K,se,M,_,!1);return;case"select":pt("invalid",o),m=M=x=null;for(_ in f)if(f.hasOwnProperty(_)&&(U=f[_],U!=null))switch(_){case"value":x=U;break;case"defaultValue":M=U;break;case"multiple":m=U;default:zt(o,l,_,U,f,null)}l=x,f=M,o.multiple=!!m,l!=null?Ks(o,!!m,l,!1):f!=null&&Ks(o,!!m,f,!0);return;case"textarea":pt("invalid",o),x=_=m=null;for(M in f)if(f.hasOwnProperty(M)&&(U=f[M],U!=null))switch(M){case"value":m=U;break;case"defaultValue":_=U;break;case"children":x=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(r(91));break;default:zt(o,l,M,U,f,null)}Xs(o,m,_,x);return;case"option":for(K in f)f.hasOwnProperty(K)&&(m=f[K],m!=null)&&(K==="selected"?o.selected=m&&typeof m!="function"&&typeof m!="symbol":zt(o,l,K,m,f,null));return;case"dialog":pt("beforetoggle",o),pt("toggle",o),pt("cancel",o),pt("close",o);break;case"iframe":case"object":pt("load",o);break;case"video":case"audio":for(m=0;m<pf.length;m++)pt(pf[m],o);break;case"image":pt("error",o),pt("load",o);break;case"details":pt("toggle",o);break;case"embed":case"source":case"link":pt("error",o),pt("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in f)if(f.hasOwnProperty(se)&&(m=f[se],m!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,l));default:zt(o,l,se,m,f,null)}return;default:if(Tl(l)){for(me in f)f.hasOwnProperty(me)&&(m=f[me],m!==void 0&&k0(o,l,me,m,f,void 0));return}}for(U in f)f.hasOwnProperty(U)&&(m=f[U],m!=null&&zt(o,l,U,m,f,null))}function CF(o,l,f,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,x=null,M=null,U=null,K=null,se=null,me=null;for(de in f){var xe=f[de];if(f.hasOwnProperty(de)&&xe!=null)switch(de){case"checked":break;case"value":break;case"defaultValue":K=xe;default:m.hasOwnProperty(de)||zt(o,l,de,null,m,xe)}}for(var oe in m){var de=m[oe];if(xe=f[oe],m.hasOwnProperty(oe)&&(de!=null||xe!=null))switch(oe){case"type":x=de;break;case"name":_=de;break;case"checked":se=de;break;case"defaultChecked":me=de;break;case"value":M=de;break;case"defaultValue":U=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,l));break;default:de!==xe&&zt(o,l,oe,de,m,xe)}}El(o,M,U,K,se,me,x,_);return;case"select":de=M=U=oe=null;for(x in f)if(K=f[x],f.hasOwnProperty(x)&&K!=null)switch(x){case"value":break;case"multiple":de=K;default:m.hasOwnProperty(x)||zt(o,l,x,null,m,K)}for(_ in m)if(x=m[_],K=f[_],m.hasOwnProperty(_)&&(x!=null||K!=null))switch(_){case"value":oe=x;break;case"defaultValue":U=x;break;case"multiple":M=x;default:x!==K&&zt(o,l,_,x,m,K)}l=U,f=M,m=de,oe!=null?Ks(o,!!f,oe,!1):!!m!=!!f&&(l!=null?Ks(o,!!f,l,!0):Ks(o,!!f,f?[]:"",!1));return;case"textarea":de=oe=null;for(U in f)if(_=f[U],f.hasOwnProperty(U)&&_!=null&&!m.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:zt(o,l,U,null,m,_)}for(M in m)if(_=m[M],x=f[M],m.hasOwnProperty(M)&&(_!=null||x!=null))switch(M){case"value":oe=_;break;case"defaultValue":de=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(r(91));break;default:_!==x&&zt(o,l,M,_,m,x)}up(o,oe,de);return;case"option":for(var Fe in f)oe=f[Fe],f.hasOwnProperty(Fe)&&oe!=null&&!m.hasOwnProperty(Fe)&&(Fe==="selected"?o.selected=!1:zt(o,l,Fe,null,m,oe));for(K in m)oe=m[K],de=f[K],m.hasOwnProperty(K)&&oe!==de&&(oe!=null||de!=null)&&(K==="selected"?o.selected=oe&&typeof oe!="function"&&typeof oe!="symbol":zt(o,l,K,oe,m,de));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in f)oe=f[Ke],f.hasOwnProperty(Ke)&&oe!=null&&!m.hasOwnProperty(Ke)&&zt(o,l,Ke,null,m,oe);for(se in m)if(oe=m[se],de=f[se],m.hasOwnProperty(se)&&oe!==de&&(oe!=null||de!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(r(137,l));break;default:zt(o,l,se,oe,m,de)}return;default:if(Tl(l)){for(var Ht in f)oe=f[Ht],f.hasOwnProperty(Ht)&&oe!==void 0&&!m.hasOwnProperty(Ht)&&k0(o,l,Ht,void 0,m,oe);for(me in m)oe=m[me],de=f[me],!m.hasOwnProperty(me)||oe===de||oe===void 0&&de===void 0||k0(o,l,me,oe,m,de);return}}for(var te in f)oe=f[te],f.hasOwnProperty(te)&&oe!=null&&!m.hasOwnProperty(te)&&zt(o,l,te,null,m,oe);for(xe in m)oe=m[xe],de=f[xe],!m.hasOwnProperty(xe)||oe===de||oe==null&&de==null||zt(o,l,xe,oe,m,de)}function vC(o){switch(o){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function SF(){if(typeof performance.getEntriesByType=="function"){for(var o=0,l=0,f=performance.getEntriesByType("resource"),m=0;m<f.length;m++){var _=f[m],x=_.transferSize,M=_.initiatorType,U=_.duration;if(x&&U&&vC(M)){for(M=0,U=_.responseEnd,m+=1;m<f.length;m++){var K=f[m],se=K.startTime;if(se>U)break;var me=K.transferSize,xe=K.initiatorType;me&&vC(xe)&&(K=K.responseEnd,M+=me*(K<U?1:(U-se)/(K-se)))}if(--m,l+=8*(x+M)/(_.duration/1e3),o++,10<o)break}}if(0<o)return l/o/1e6}return navigator.connection&&(o=navigator.connection.downlink,typeof o=="number")?o:5}var M0=null,O0=null;function hm(o){return o.nodeType===9?o:o.ownerDocument}function yC(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _C(o,l){if(o===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&l==="foreignObject"?0:o}function P0(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var F0=null;function AF(){var o=window.event;return o&&o.type==="popstate"?o===F0?!1:(F0=o,!0):(F0=null,!1)}var bC=typeof setTimeout=="function"?setTimeout:void 0,RF=typeof clearTimeout=="function"?clearTimeout:void 0,xC=typeof Promise=="function"?Promise:void 0,IF=typeof queueMicrotask=="function"?queueMicrotask:typeof xC<"u"?function(o){return xC.resolve(null).then(o).catch(NF)}:bC;function NF(o){setTimeout(function(){throw o})}function yo(o){return o==="head"}function wC(o,l){var f=l,m=0;do{var _=f.nextSibling;if(o.removeChild(f),_&&_.nodeType===8)if(f=_.data,f==="/$"||f==="/&"){if(m===0){o.removeChild(_),ac(l);return}m--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")m++;else if(f==="html")gf(o.ownerDocument.documentElement);else if(f==="head"){f=o.ownerDocument.head,gf(f);for(var x=f.firstChild;x;){var M=x.nextSibling,U=x.nodeName;x[ya]||U==="SCRIPT"||U==="STYLE"||U==="LINK"&&x.rel.toLowerCase()==="stylesheet"||f.removeChild(x),x=M}}else f==="body"&&gf(o.ownerDocument.body);f=_}while(f);ac(l)}function EC(o,l){var f=o;o=0;do{var m=f.nextSibling;if(f.nodeType===1?l?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(l?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),m&&m.nodeType===8)if(f=m.data,f==="/$"){if(o===0)break;o--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||o++;f=m}while(f)}function V0(o){var l=o.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var f=l;switch(l=l.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":V0(f),xl(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}o.removeChild(f)}}function DF(o,l,f,m){for(;o.nodeType===1;){var _=f;if(o.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(m){if(!o[ya])switch(l){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(x=o.getAttribute("rel"),x==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(x!==_.rel||o.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||o.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||o.getAttribute("title")!==(_.title==null?null:_.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(x=o.getAttribute("src"),(x!==(_.src==null?null:_.src)||o.getAttribute("type")!==(_.type==null?null:_.type)||o.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&x&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(l==="input"&&o.type==="hidden"){var x=_.name==null?null:""+_.name;if(_.type==="hidden"&&o.getAttribute("name")===x)return o}else return o;if(o=Di(o.nextSibling),o===null)break}return null}function kF(o,l,f){if(l==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!f||(o=Di(o.nextSibling),o===null))return null;return o}function TC(o,l){for(;o.nodeType!==8;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!l||(o=Di(o.nextSibling),o===null))return null;return o}function L0(o){return o.data==="$?"||o.data==="$~"}function B0(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState!=="loading"}function MF(o,l){var f=o.ownerDocument;if(o.data==="$~")o._reactRetry=l;else if(o.data!=="$?"||f.readyState!=="loading")l();else{var m=function(){l(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),o._reactRetry=m}}function Di(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return o}var j0=null;function CC(o){o=o.nextSibling;for(var l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="/$"||f==="/&"){if(l===0)return Di(o.nextSibling);l--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||l++}o=o.nextSibling}return null}function SC(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(l===0)return o;l--}else f!=="/$"&&f!=="/&"||l++}o=o.previousSibling}return null}function AC(o,l,f){switch(l=hm(f),o){case"html":if(o=l.documentElement,!o)throw Error(r(452));return o;case"head":if(o=l.head,!o)throw Error(r(453));return o;case"body":if(o=l.body,!o)throw Error(r(454));return o;default:throw Error(r(451))}}function gf(o){for(var l=o.attributes;l.length;)o.removeAttributeNode(l[0]);xl(o)}var ki=new Map,RC=new Set;function fm(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var Es=X.d;X.d={f:OF,r:PF,D:FF,C:VF,L:LF,m:BF,X:UF,S:jF,M:zF};function OF(){var o=Es.f(),l=rm();return o||l}function PF(o){var l=xi(o);l!==null&&l.tag===5&&l.type==="form"?W2(l):Es.r(o)}var nc=typeof document>"u"?null:document;function IC(o,l,f){var m=nc;if(m&&typeof l=="string"&&l){var _=Ur(l);_='link[rel="'+o+'"][href="'+_+'"]',typeof f=="string"&&(_+='[crossorigin="'+f+'"]'),RC.has(_)||(RC.add(_),o={rel:o,crossOrigin:f,href:l},m.querySelector(_)===null&&(l=m.createElement("link"),cr(l,"link",o),Cn(l),m.head.appendChild(l)))}}function FF(o){Es.D(o),IC("dns-prefetch",o,null)}function VF(o,l){Es.C(o,l),IC("preconnect",o,l)}function LF(o,l,f){Es.L(o,l,f);var m=nc;if(m&&o&&l){var _='link[rel="preload"][as="'+Ur(l)+'"]';l==="image"&&f&&f.imageSrcSet?(_+='[imagesrcset="'+Ur(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(_+='[imagesizes="'+Ur(f.imageSizes)+'"]')):_+='[href="'+Ur(o)+'"]';var x=_;switch(l){case"style":x=rc(o);break;case"script":x=ic(o)}ki.has(x)||(o=p({rel:"preload",href:l==="image"&&f&&f.imageSrcSet?void 0:o,as:l},f),ki.set(x,o),m.querySelector(_)!==null||l==="style"&&m.querySelector(vf(x))||l==="script"&&m.querySelector(yf(x))||(l=m.createElement("link"),cr(l,"link",o),Cn(l),m.head.appendChild(l)))}}function BF(o,l){Es.m(o,l);var f=nc;if(f&&o){var m=l&&typeof l.as=="string"?l.as:"script",_='link[rel="modulepreload"][as="'+Ur(m)+'"][href="'+Ur(o)+'"]',x=_;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=ic(o)}if(!ki.has(x)&&(o=p({rel:"modulepreload",href:o},l),ki.set(x,o),f.querySelector(_)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(yf(x)))return}m=f.createElement("link"),cr(m,"link",o),Cn(m),f.head.appendChild(m)}}}function jF(o,l,f){Es.S(o,l,f);var m=nc;if(m&&o){var _=ba(m).hoistableStyles,x=rc(o);l=l||"default";var M=_.get(x);if(!M){var U={loading:0,preload:null};if(M=m.querySelector(vf(x)))U.loading=5;else{o=p({rel:"stylesheet",href:o,"data-precedence":l},f),(f=ki.get(x))&&U0(o,f);var K=M=m.createElement("link");Cn(K),cr(K,"link",o),K._p=new Promise(function(se,me){K.onload=se,K.onerror=me}),K.addEventListener("load",function(){U.loading|=1}),K.addEventListener("error",function(){U.loading|=2}),U.loading|=4,dm(M,l,m)}M={type:"stylesheet",instance:M,count:1,state:U},_.set(x,M)}}}function UF(o,l){Es.X(o,l);var f=nc;if(f&&o){var m=ba(f).hoistableScripts,_=ic(o),x=m.get(_);x||(x=f.querySelector(yf(_)),x||(o=p({src:o,async:!0},l),(l=ki.get(_))&&z0(o,l),x=f.createElement("script"),Cn(x),cr(x,"link",o),f.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},m.set(_,x))}}function zF(o,l){Es.M(o,l);var f=nc;if(f&&o){var m=ba(f).hoistableScripts,_=ic(o),x=m.get(_);x||(x=f.querySelector(yf(_)),x||(o=p({src:o,async:!0,type:"module"},l),(l=ki.get(_))&&z0(o,l),x=f.createElement("script"),Cn(x),cr(x,"link",o),f.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},m.set(_,x))}}function NC(o,l,f,m){var _=(_=Se.current)?fm(_):null;if(!_)throw Error(r(446));switch(o){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(l=rc(f.href),f=ba(_).hoistableStyles,m=f.get(l),m||(m={type:"style",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){o=rc(f.href);var x=ba(_).hoistableStyles,M=x.get(o);if(M||(_=_.ownerDocument||_,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(o,M),(x=_.querySelector(vf(o)))&&!x._p&&(M.instance=x,M.state.loading=5),ki.has(o)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},ki.set(o,f),x||HF(_,o,f,M.state))),l&&m===null)throw Error(r(528,""));return M}if(l&&m!==null)throw Error(r(529,""));return null;case"script":return l=f.async,f=f.src,typeof f=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=ic(f),f=ba(_).hoistableScripts,m=f.get(l),m||(m={type:"script",instance:null,count:0,state:null},f.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,o))}}function rc(o){return'href="'+Ur(o)+'"'}function vf(o){return'link[rel="stylesheet"]['+o+"]"}function DC(o){return p({},o,{"data-precedence":o.precedence,precedence:null})}function HF(o,l,f,m){o.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=o.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),cr(l,"link",f),Cn(l),o.head.appendChild(l))}function ic(o){return'[src="'+Ur(o)+'"]'}function yf(o){return"script[async]"+o}function kC(o,l,f){if(l.count++,l.instance===null)switch(l.type){case"style":var m=o.querySelector('style[data-href~="'+Ur(f.href)+'"]');if(m)return l.instance=m,Cn(m),m;var _=p({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(o.ownerDocument||o).createElement("style"),Cn(m),cr(m,"style",_),dm(m,f.precedence,o),l.instance=m;case"stylesheet":_=rc(f.href);var x=o.querySelector(vf(_));if(x)return l.state.loading|=4,l.instance=x,Cn(x),x;m=DC(f),(_=ki.get(_))&&U0(m,_),x=(o.ownerDocument||o).createElement("link"),Cn(x);var M=x;return M._p=new Promise(function(U,K){M.onload=U,M.onerror=K}),cr(x,"link",m),l.state.loading|=4,dm(x,f.precedence,o),l.instance=x;case"script":return x=ic(f.src),(_=o.querySelector(yf(x)))?(l.instance=_,Cn(_),_):(m=f,(_=ki.get(x))&&(m=p({},f),z0(m,_)),o=o.ownerDocument||o,_=o.createElement("script"),Cn(_),cr(_,"link",m),o.head.appendChild(_),l.instance=_);case"void":return null;default:throw Error(r(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,dm(m,f.precedence,o));return l.instance}function dm(o,l,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=m.length?m[m.length-1]:null,x=_,M=0;M<m.length;M++){var U=m[M];if(U.dataset.precedence===l)x=U;else if(x!==_)break}x?x.parentNode.insertBefore(o,x.nextSibling):(l=f.nodeType===9?f.head:f,l.insertBefore(o,l.firstChild))}function U0(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.title==null&&(o.title=l.title)}function z0(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.integrity==null&&(o.integrity=l.integrity)}var pm=null;function MC(o,l,f){if(pm===null){var m=new Map,_=pm=new Map;_.set(f,m)}else _=pm,m=_.get(f),m||(m=new Map,_.set(f,m));if(m.has(o))return m;for(m.set(o,null),f=f.getElementsByTagName(o),_=0;_<f.length;_++){var x=f[_];if(!(x[ya]||x[Tn]||o==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var M=x.getAttribute(l)||"";M=o+M;var U=m.get(M);U?U.push(x):m.set(M,[x])}}return m}function OC(o,l,f){o=o.ownerDocument||o,o.head.insertBefore(f,l==="title"?o.querySelector("head > title"):null)}function GF(o,l,f){if(f===1||l.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;return l.rel==="stylesheet"?(o=l.disabled,typeof l.precedence=="string"&&o==null):!0;case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function PC(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}function WF(o,l,f,m){if(f.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var _=rc(m.href),x=l.querySelector(vf(_));if(x){l=x._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(o.count++,o=mm.bind(o),l.then(o,o)),f.state.loading|=4,f.instance=x,Cn(x);return}x=l.ownerDocument||l,m=DC(m),(_=ki.get(_))&&U0(m,_),x=x.createElement("link"),Cn(x);var M=x;M._p=new Promise(function(U,K){M.onload=U,M.onerror=K}),cr(x,"link",m),f.instance=x}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(o.count++,f=mm.bind(o),l.addEventListener("load",f),l.addEventListener("error",f))}}var H0=0;function qF(o,l){return o.stylesheets&&o.count===0&&vm(o,o.stylesheets),0<o.count||0<o.imgCount?function(f){var m=setTimeout(function(){if(o.stylesheets&&vm(o,o.stylesheets),o.unsuspend){var x=o.unsuspend;o.unsuspend=null,x()}},6e4+l);0<o.imgBytes&&H0===0&&(H0=62500*SF());var _=setTimeout(function(){if(o.waitingForImages=!1,o.count===0&&(o.stylesheets&&vm(o,o.stylesheets),o.unsuspend)){var x=o.unsuspend;o.unsuspend=null,x()}},(o.imgBytes>H0?50:800)+l);return o.unsuspend=f,function(){o.unsuspend=null,clearTimeout(m),clearTimeout(_)}}:null}function mm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)vm(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var gm=null;function vm(o,l){o.stylesheets=null,o.unsuspend!==null&&(o.count++,gm=new Map,l.forEach(KF,o),gm=null,mm.call(o))}function KF(o,l){if(!(l.state.loading&4)){var f=gm.get(o);if(f)var m=f.get(null);else{f=new Map,gm.set(o,f);for(var _=o.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<_.length;x++){var M=_[x];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(f.set(M.dataset.precedence,M),m=M)}m&&f.set(null,m)}_=l.instance,M=_.getAttribute("data-precedence"),x=f.get(M)||m,x===m&&f.set(null,_),f.set(M,_),this.count++,m=mm.bind(this),_.addEventListener("load",m),_.addEventListener("error",m),x?x.parentNode.insertBefore(_,x.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(_,o.firstChild)),l.state.loading|=4}}var _f={$$typeof:I,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function XF(o,l,f,m,_,x,M,U,K){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ga(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ga(0),this.hiddenUpdates=ga(null),this.identifierPrefix=m,this.onUncaughtError=_,this.onCaughtError=x,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function FC(o,l,f,m,_,x,M,U,K,se,me,xe){return o=new XF(o,l,f,M,K,se,me,xe,U),l=1,x===!0&&(l|=24),x=si(3,null,null,l),o.current=x,x.stateNode=o,l=wy(),l.refCount++,o.pooledCache=l,l.refCount++,x.memoizedState={element:m,isDehydrated:f,cache:l},Sy(x),o}function VC(o){return o?(o=Pl,o):Pl}function LC(o,l,f,m,_,x){_=VC(_),m.context===null?m.context=_:m.pendingContext=_,m=so(l),m.payload={element:f},x=x===void 0?null:x,x!==null&&(m.callback=x),f=oo(o,m,l),f!==null&&(Kr(f,o,l),$h(f,o,l))}function BC(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<l?f:l}}function G0(o,l){BC(o,l),(o=o.alternate)&&BC(o,l)}function jC(o){if(o.tag===13||o.tag===31){var l=xu(o,67108864);l!==null&&Kr(l,o,67108864),G0(o,67108864)}}function UC(o){if(o.tag===13||o.tag===31){var l=hi();l=lu(l);var f=xu(o,l);f!==null&&Kr(f,o,l),G0(o,l)}}var ym=!0;function YF(o,l,f,m){var _=q.T;q.T=null;var x=X.p;try{X.p=2,W0(o,l,f,m)}finally{X.p=x,q.T=_}}function $F(o,l,f,m){var _=q.T;q.T=null;var x=X.p;try{X.p=8,W0(o,l,f,m)}finally{X.p=x,q.T=_}}function W0(o,l,f,m){if(ym){var _=q0(m);if(_===null)D0(o,l,m,_m,f),HC(o,m);else if(ZF(_,o,l,f,m))m.stopPropagation();else if(HC(o,m),l&4&&-1<QF.indexOf(o)){for(;_!==null;){var x=xi(_);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var M=pa(x.pendingLanes);if(M!==0){var U=x;for(U.pendingLanes|=2,U.entangledLanes|=2;M;){var K=1<<31-mn(M);U.entanglements[1]|=K,M&=~K}Ma(x),(kt&6)===0&&(tm=tn()+500,df(0))}}break;case 31:case 13:U=xu(x,2),U!==null&&Kr(U,x,2),rm(),G0(x,2)}if(x=q0(m),x===null&&D0(o,l,m,_m,f),x===_)break;_=x}_!==null&&m.stopPropagation()}else D0(o,l,m,null,f)}}function q0(o){return o=wi(o),K0(o)}var _m=null;function K0(o){if(_m=null,o=_a(o),o!==null){var l=a(o);if(l===null)o=null;else{var f=l.tag;if(f===13){if(o=s(l),o!==null)return o;o=null}else if(f===31){if(o=u(l),o!==null)return o;o=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null)}}return _m=o,null}function zC(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ar()){case is:return 2;case bi:return 8;case Ln:case au:return 32;case gl:return 268435456;default:return 32}default:return 32}}var X0=!1,_o=null,bo=null,xo=null,bf=new Map,xf=new Map,wo=[],QF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function HC(o,l){switch(o){case"focusin":case"focusout":_o=null;break;case"dragenter":case"dragleave":bo=null;break;case"mouseover":case"mouseout":xo=null;break;case"pointerover":case"pointerout":bf.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":xf.delete(l.pointerId)}}function wf(o,l,f,m,_,x){return o===null||o.nativeEvent!==x?(o={blockedOn:l,domEventName:f,eventSystemFlags:m,nativeEvent:x,targetContainers:[_]},l!==null&&(l=xi(l),l!==null&&jC(l)),o):(o.eventSystemFlags|=m,l=o.targetContainers,_!==null&&l.indexOf(_)===-1&&l.push(_),o)}function ZF(o,l,f,m,_){switch(l){case"focusin":return _o=wf(_o,o,l,f,m,_),!0;case"dragenter":return bo=wf(bo,o,l,f,m,_),!0;case"mouseover":return xo=wf(xo,o,l,f,m,_),!0;case"pointerover":var x=_.pointerId;return bf.set(x,wf(bf.get(x)||null,o,l,f,m,_)),!0;case"gotpointercapture":return x=_.pointerId,xf.set(x,wf(xf.get(x)||null,o,l,f,m,_)),!0}return!1}function GC(o){var l=_a(o.target);if(l!==null){var f=a(l);if(f!==null){if(l=f.tag,l===13){if(l=s(f),l!==null){o.blockedOn=l,Wi(o.priority,function(){UC(f)});return}}else if(l===31){if(l=u(f),l!==null){o.blockedOn=l,Wi(o.priority,function(){UC(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function bm(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var f=q0(o.nativeEvent);if(f===null){f=o.nativeEvent;var m=new f.constructor(f.type,f);Oh=m,f.target.dispatchEvent(m),Oh=null}else return l=xi(f),l!==null&&jC(l),o.blockedOn=f,!1;l.shift()}return!0}function WC(o,l,f){bm(o)&&f.delete(l)}function JF(){X0=!1,_o!==null&&bm(_o)&&(_o=null),bo!==null&&bm(bo)&&(bo=null),xo!==null&&bm(xo)&&(xo=null),bf.forEach(WC),xf.forEach(WC)}function xm(o,l){o.blockedOn===l&&(o.blockedOn=null,X0||(X0=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,JF)))}var wm=null;function qC(o){wm!==o&&(wm=o,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){wm===o&&(wm=null);for(var l=0;l<o.length;l+=3){var f=o[l],m=o[l+1],_=o[l+2];if(typeof m!="function"){if(K0(m||f)===null)continue;break}var x=xi(f);x!==null&&(o.splice(l,3),l-=3,qy(x,{pending:!0,data:_,method:f.method,action:m},m,_))}}))}function ac(o){function l(K){return xm(K,o)}_o!==null&&xm(_o,o),bo!==null&&xm(bo,o),xo!==null&&xm(xo,o),bf.forEach(l),xf.forEach(l);for(var f=0;f<wo.length;f++){var m=wo[f];m.blockedOn===o&&(m.blockedOn=null)}for(;0<wo.length&&(f=wo[0],f.blockedOn===null);)GC(f),f.blockedOn===null&&wo.shift();if(f=(o.ownerDocument||o).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var _=f[m],x=f[m+1],M=_[Yn]||null;if(typeof x=="function")M||qC(f);else if(M){var U=null;if(x&&x.hasAttribute("formAction")){if(_=x,M=x[Yn]||null)U=M.formAction;else if(K0(_)!==null)continue}else U=M.action;typeof U=="function"?f[m+1]=U:(f.splice(m,3),m-=3),qC(f)}}}function KC(){function o(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(M){return _=M})},focusReset:"manual",scroll:"manual"})}function l(){_!==null&&(_(),_=null),m||setTimeout(f,20)}function f(){if(!m&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,_=null;return navigation.addEventListener("navigate",o),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(f,100),function(){m=!0,navigation.removeEventListener("navigate",o),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),_!==null&&(_(),_=null)}}}function Y0(o){this._internalRoot=o}Em.prototype.render=Y0.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(r(409));var f=l.current,m=hi();LC(f,m,o,l,null,null)},Em.prototype.unmount=Y0.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;LC(o.current,2,null,o,null,null),rm(),l[va]=null}};function Em(o){this._internalRoot=o}Em.prototype.unstable_scheduleHydration=function(o){if(o){var l=rp();o={blockedOn:null,target:o,priority:l};for(var f=0;f<wo.length&&l!==0&&l<wo[f].priority;f++);wo.splice(f,0,o),f===0&&GC(o)}};var XC=e.version;if(XC!=="19.2.3")throw Error(r(527,XC,"19.2.3"));X.findDOMNode=function(o){var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(r(188)):(o=Object.keys(o).join(","),Error(r(268,o)));return o=h(l),o=o!==null?d(o):null,o=o===null?null:o.stateNode,o};var eV={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tm.isDisabled&&Tm.supportsFiber)try{Or=Tm.inject(eV),pn=Tm}catch{}}return Tf.createRoot=function(o,l){if(!i(o))throw Error(r(299));var f=!1,m="",_=tT,x=nT,M=rT;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(_=l.onUncaughtError),l.onCaughtError!==void 0&&(x=l.onCaughtError),l.onRecoverableError!==void 0&&(M=l.onRecoverableError)),l=FC(o,1,!1,null,null,f,m,null,_,x,M,KC),o[va]=l.current,N0(o),new Y0(l)},Tf.hydrateRoot=function(o,l,f){if(!i(o))throw Error(r(299));var m=!1,_="",x=tT,M=nT,U=rT,K=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(_=f.identifierPrefix),f.onUncaughtError!==void 0&&(x=f.onUncaughtError),f.onCaughtError!==void 0&&(M=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError),f.formState!==void 0&&(K=f.formState)),l=FC(o,1,!0,l,f??null,m,_,K,x,M,U,KC),l.context=VC(null),f=l.current,m=hi(),m=lu(m),_=so(m),_.callback=null,oo(f,_,m),f=m,l.current.lanes=f,ou(l,f),Ma(l),o[va]=l.current,N0(o),new Em(l)},Tf.version="19.2.3",Tf}var iS;function fV(){if(iS)return Z0.exports;iS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Z0.exports=hV(),Z0.exports}var dV=fV();const pV=mN(dV),B1=re.createContext({});function j1(n){const e=re.useRef(null);return e.current===null&&(e.current=n()),e.current}const U1=typeof window<"u",gN=U1?re.useLayoutEffect:re.useEffect,uv=re.createContext(null);function z1(n,e){n.indexOf(e)===-1&&n.push(e)}function H1(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const ks=(n,e,t)=>t>e?e:t<n?n:t;let G1=()=>{};const Ms={},vN=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function yN(n){return typeof n=="object"&&n!==null}const _N=n=>/^0[^.\s]+$/u.test(n);function W1(n){let e;return()=>(e===void 0&&(e=n()),e)}const ji=n=>n,mV=(n,e)=>t=>e(n(t)),Rd=(...n)=>n.reduce(mV),td=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class q1{constructor(){this.subscriptions=[]}add(e){return z1(this.subscriptions,e),()=>H1(this.subscriptions,e)}notify(e,t,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,r);else for(let a=0;a<i;a++){const s=this.subscriptions[a];s&&s(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ha=n=>n*1e3,Vi=n=>n/1e3;function bN(n,e){return e?n*(1e3/e):0}const xN=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,gV=1e-7,vV=12;function yV(n,e,t,r,i){let a,s,u=0;do s=e+(t-e)/2,a=xN(s,r,i)-n,a>0?t=s:e=s;while(Math.abs(a)>gV&&++u<vV);return s}function Id(n,e,t,r){if(n===e&&t===r)return ji;const i=a=>yV(a,0,1,n,t);return a=>a===0||a===1?a:xN(i(a),e,r)}const wN=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,EN=n=>e=>1-n(1-e),TN=Id(.33,1.53,.69,.99),K1=EN(TN),CN=wN(K1),SN=n=>(n*=2)<1?.5*K1(n):.5*(2-Math.pow(2,-10*(n-1))),X1=n=>1-Math.sin(Math.acos(n)),AN=EN(X1),RN=wN(X1),_V=Id(.42,0,1,1),bV=Id(0,0,.58,1),IN=Id(.42,0,.58,1),xV=n=>Array.isArray(n)&&typeof n[0]!="number",NN=n=>Array.isArray(n)&&typeof n[0]=="number",wV={linear:ji,easeIn:_V,easeInOut:IN,easeOut:bV,circIn:X1,circInOut:RN,circOut:AN,backIn:K1,backInOut:CN,backOut:TN,anticipate:SN},EV=n=>typeof n=="string",aS=n=>{if(NN(n)){G1(n.length===4);const[e,t,r,i]=n;return Id(e,t,r,i)}else if(EV(n))return wV[n];return n},Cm=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function TV(n,e){let t=new Set,r=new Set,i=!1,a=!1;const s=new WeakSet;let u={delta:0,timestamp:0,isProcessing:!1};function c(d){s.has(d)&&(h.schedule(d),n()),d(u)}const h={schedule:(d,p=!1,g=!1)=>{const b=g&&i?t:r;return p&&s.add(d),b.has(d)||b.add(d),d},cancel:d=>{r.delete(d),s.delete(d)},process:d=>{if(u=d,i){a=!0;return}i=!0,[t,r]=[r,t],t.forEach(c),t.clear(),i=!1,a&&(a=!1,h.process(d))}};return h}const CV=40;function DN(n,e){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>t=!0,s=Cm.reduce((I,D)=>(I[D]=TV(a),I),{}),{setup:u,read:c,resolveKeyframes:h,preUpdate:d,update:p,preRender:g,render:v,postRender:b}=s,E=()=>{const I=Ms.useManualTiming?i.timestamp:performance.now();t=!1,Ms.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(I-i.timestamp,CV),1)),i.timestamp=I,i.isProcessing=!0,u.process(i),c.process(i),h.process(i),d.process(i),p.process(i),g.process(i),v.process(i),b.process(i),i.isProcessing=!1,t&&e&&(r=!1,n(E))},w=()=>{t=!0,r=!0,i.isProcessing||n(E)};return{schedule:Cm.reduce((I,D)=>{const O=s[D];return I[D]=(B,N=!1,R=!1)=>(t||w(),O.schedule(B,N,R)),I},{}),cancel:I=>{for(let D=0;D<Cm.length;D++)s[Cm[D]].cancel(I)},state:i,steps:s}}const{schedule:an,cancel:Uo,state:hr,steps:n_}=DN(typeof requestAnimationFrame<"u"?requestAnimationFrame:ji,!0);let Qm;function SV(){Qm=void 0}const Zr={now:()=>(Qm===void 0&&Zr.set(hr.isProcessing||Ms.useManualTiming?hr.timestamp:performance.now()),Qm),set:n=>{Qm=n,queueMicrotask(SV)}},kN=n=>e=>typeof e=="string"&&e.startsWith(n),MN=kN("--"),AV=kN("var(--"),Y1=n=>AV(n)?RV.test(n.split("/*")[0].trim()):!1,RV=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,sh={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},nd={...sh,transform:n=>ks(0,1,n)},Sm={...sh,default:1},Bf=n=>Math.round(n*1e5)/1e5,$1=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function IV(n){return n==null}const NV=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Q1=(n,e)=>t=>!!(typeof t=="string"&&NV.test(t)&&t.startsWith(n)||e&&!IV(t)&&Object.prototype.hasOwnProperty.call(t,e)),ON=(n,e,t)=>r=>{if(typeof r!="string")return r;const[i,a,s,u]=r.match($1);return{[n]:parseFloat(i),[e]:parseFloat(a),[t]:parseFloat(s),alpha:u!==void 0?parseFloat(u):1}},DV=n=>ks(0,255,n),r_={...sh,transform:n=>Math.round(DV(n))},zu={test:Q1("rgb","red"),parse:ON("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+r_.transform(n)+", "+r_.transform(e)+", "+r_.transform(t)+", "+Bf(nd.transform(r))+")"};function kV(n){let e="",t="",r="",i="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),i=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),i=n.substring(4,5),e+=e,t+=t,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const ub={test:Q1("#"),parse:kV,transform:zu.transform},Nd=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),So=Nd("deg"),Ga=Nd("%"),Oe=Nd("px"),MV=Nd("vh"),OV=Nd("vw"),sS={...Ga,parse:n=>Ga.parse(n)/100,transform:n=>Ga.transform(n*100)},bc={test:Q1("hsl","hue"),parse:ON("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+Ga.transform(Bf(e))+", "+Ga.transform(Bf(t))+", "+Bf(nd.transform(r))+")"},kn={test:n=>zu.test(n)||ub.test(n)||bc.test(n),parse:n=>zu.test(n)?zu.parse(n):bc.test(n)?bc.parse(n):ub.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?zu.transform(n):bc.transform(n),getAnimatableNone:n=>{const e=kn.parse(n);return e.alpha=0,kn.transform(e)}},PV=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function FV(n){return isNaN(n)&&typeof n=="string"&&(n.match($1)?.length||0)+(n.match(PV)?.length||0)>0}const PN="number",FN="color",VV="var",LV="var(",oS="${}",BV=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function rd(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},i=[];let a=0;const u=e.replace(BV,c=>(kn.test(c)?(r.color.push(a),i.push(FN),t.push(kn.parse(c))):c.startsWith(LV)?(r.var.push(a),i.push(VV),t.push(c)):(r.number.push(a),i.push(PN),t.push(parseFloat(c))),++a,oS)).split(oS);return{values:t,split:u,indexes:r,types:i}}function VN(n){return rd(n).values}function LN(n){const{split:e,types:t}=rd(n),r=e.length;return i=>{let a="";for(let s=0;s<r;s++)if(a+=e[s],i[s]!==void 0){const u=t[s];u===PN?a+=Bf(i[s]):u===FN?a+=kn.transform(i[s]):a+=i[s]}return a}}const jV=n=>typeof n=="number"?0:kn.test(n)?kn.getAnimatableNone(n):n;function UV(n){const e=VN(n);return LN(n)(e.map(jV))}const zo={test:FV,parse:VN,createTransformer:LN,getAnimatableNone:UV};function i_(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function zV({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let i=0,a=0,s=0;if(!e)i=a=s=t;else{const u=t<.5?t*(1+e):t+e-t*e,c=2*t-u;i=i_(c,u,n+1/3),a=i_(c,u,n),s=i_(c,u,n-1/3)}return{red:Math.round(i*255),green:Math.round(a*255),blue:Math.round(s*255),alpha:r}}function lg(n,e){return t=>t>0?e:n}const on=(n,e,t)=>n+(e-n)*t,a_=(n,e,t)=>{const r=n*n,i=t*(e*e-r)+r;return i<0?0:Math.sqrt(i)},HV=[ub,zu,bc],GV=n=>HV.find(e=>e.test(n));function uS(n){const e=GV(n);if(!e)return!1;let t=e.parse(n);return e===bc&&(t=zV(t)),t}const lS=(n,e)=>{const t=uS(n),r=uS(e);if(!t||!r)return lg(n,e);const i={...t};return a=>(i.red=a_(t.red,r.red,a),i.green=a_(t.green,r.green,a),i.blue=a_(t.blue,r.blue,a),i.alpha=on(t.alpha,r.alpha,a),zu.transform(i))},lb=new Set(["none","hidden"]);function WV(n,e){return lb.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function qV(n,e){return t=>on(n,e,t)}function Z1(n){return typeof n=="number"?qV:typeof n=="string"?Y1(n)?lg:kn.test(n)?lS:YV:Array.isArray(n)?BN:typeof n=="object"?kn.test(n)?lS:KV:lg}function BN(n,e){const t=[...n],r=t.length,i=n.map((a,s)=>Z1(a)(a,e[s]));return a=>{for(let s=0;s<r;s++)t[s]=i[s](a);return t}}function KV(n,e){const t={...n,...e},r={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(r[i]=Z1(n[i])(n[i],e[i]));return i=>{for(const a in r)t[a]=r[a](i);return t}}function XV(n,e){const t=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const a=e.types[i],s=n.indexes[a][r[a]],u=n.values[s]??0;t[i]=u,r[a]++}return t}const YV=(n,e)=>{const t=zo.createTransformer(e),r=rd(n),i=rd(e);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?lb.has(n)&&!i.values.length||lb.has(e)&&!r.values.length?WV(n,e):Rd(BN(XV(r,i),i.values),t):lg(n,e)};function jN(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?on(n,e,t):Z1(n)(n,e)}const $V=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>an.update(e,t),stop:()=>Uo(e),now:()=>hr.isProcessing?hr.timestamp:Zr.now()}},UN=(n,e,t=10)=>{let r="";const i=Math.max(Math.round(e/t),2);for(let a=0;a<i;a++)r+=Math.round(n(a/(i-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},cg=2e4;function J1(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<cg;)e+=t,r=n.next(e);return e>=cg?1/0:e}function QV(n,e=100,t){const r=t({...n,keyframes:[0,e]}),i=Math.min(J1(r),cg);return{type:"keyframes",ease:a=>r.next(i*a).value/e,duration:Vi(i)}}const ZV=5;function zN(n,e,t){const r=Math.max(e-ZV,0);return bN(t-n(r),e-r)}const dn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},s_=.001;function JV({duration:n=dn.duration,bounce:e=dn.bounce,velocity:t=dn.velocity,mass:r=dn.mass}){let i,a,s=1-e;s=ks(dn.minDamping,dn.maxDamping,s),n=ks(dn.minDuration,dn.maxDuration,Vi(n)),s<1?(i=h=>{const d=h*s,p=d*n,g=d-t,v=cb(h,s),b=Math.exp(-p);return s_-g/v*b},a=h=>{const p=h*s*n,g=p*t+t,v=Math.pow(s,2)*Math.pow(h,2)*n,b=Math.exp(-p),E=cb(Math.pow(h,2),s);return(-i(h)+s_>0?-1:1)*((g-v)*b)/E}):(i=h=>{const d=Math.exp(-h*n),p=(h-t)*n+1;return-s_+d*p},a=h=>{const d=Math.exp(-h*n),p=(t-h)*(n*n);return d*p});const u=5/n,c=tL(i,a,u);if(n=Ha(n),isNaN(c))return{stiffness:dn.stiffness,damping:dn.damping,duration:n};{const h=Math.pow(c,2)*r;return{stiffness:h,damping:s*2*Math.sqrt(r*h),duration:n}}}const eL=12;function tL(n,e,t){let r=t;for(let i=1;i<eL;i++)r=r-n(r)/e(r);return r}function cb(n,e){return n*Math.sqrt(1-e*e)}const nL=["duration","bounce"],rL=["stiffness","damping","mass"];function cS(n,e){return e.some(t=>n[t]!==void 0)}function iL(n){let e={velocity:dn.velocity,stiffness:dn.stiffness,damping:dn.damping,mass:dn.mass,isResolvedFromDuration:!1,...n};if(!cS(n,rL)&&cS(n,nL))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),i=r*r,a=2*ks(.05,1,1-(n.bounce||0))*Math.sqrt(i);e={...e,mass:dn.mass,stiffness:i,damping:a}}else{const t=JV(n);e={...e,...t,mass:dn.mass},e.isResolvedFromDuration=!0}return e}function hg(n=dn.visualDuration,e=dn.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:i}=t;const a=t.keyframes[0],s=t.keyframes[t.keyframes.length-1],u={done:!1,value:a},{stiffness:c,damping:h,mass:d,duration:p,velocity:g,isResolvedFromDuration:v}=iL({...t,velocity:-Vi(t.velocity||0)}),b=g||0,E=h/(2*Math.sqrt(c*d)),w=s-a,C=Vi(Math.sqrt(c/d)),S=Math.abs(w)<5;r||(r=S?dn.restSpeed.granular:dn.restSpeed.default),i||(i=S?dn.restDelta.granular:dn.restDelta.default);let I;if(E<1){const O=cb(C,E);I=B=>{const N=Math.exp(-E*C*B);return s-N*((b+E*C*w)/O*Math.sin(O*B)+w*Math.cos(O*B))}}else if(E===1)I=O=>s-Math.exp(-C*O)*(w+(b+C*w)*O);else{const O=C*Math.sqrt(E*E-1);I=B=>{const N=Math.exp(-E*C*B),R=Math.min(O*B,300);return s-N*((b+E*C*w)*Math.sinh(R)+O*w*Math.cosh(R))/O}}const D={calculatedDuration:v&&p||null,next:O=>{const B=I(O);if(v)u.done=O>=p;else{let N=O===0?b:0;E<1&&(N=O===0?Ha(b):zN(I,O,B));const R=Math.abs(N)<=r,k=Math.abs(s-B)<=i;u.done=R&&k}return u.value=u.done?s:B,u},toString:()=>{const O=Math.min(J1(D),cg),B=UN(N=>D.next(O*N).value,O,30);return O+"ms "+B},toTransition:()=>{}};return D}hg.applyToOptions=n=>{const e=QV(n,100,hg);return n.ease=e.ease,n.duration=Ha(e.duration),n.type="keyframes",n};function hb({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:s,min:u,max:c,restDelta:h=.5,restSpeed:d}){const p=n[0],g={done:!1,value:p},v=R=>u!==void 0&&R<u||c!==void 0&&R>c,b=R=>u===void 0?c:c===void 0||Math.abs(u-R)<Math.abs(c-R)?u:c;let E=t*e;const w=p+E,C=s===void 0?w:s(w);C!==w&&(E=C-p);const S=R=>-E*Math.exp(-R/r),I=R=>C+S(R),D=R=>{const k=S(R),P=I(R);g.done=Math.abs(k)<=h,g.value=g.done?C:P};let O,B;const N=R=>{v(g.value)&&(O=R,B=hg({keyframes:[g.value,b(g.value)],velocity:zN(I,R,g.value),damping:i,stiffness:a,restDelta:h,restSpeed:d}))};return N(0),{calculatedDuration:null,next:R=>{let k=!1;return!B&&O===void 0&&(k=!0,D(R),N(R)),O!==void 0&&R>=O?B.next(R-O):(!k&&D(R),g)}}}function aL(n,e,t){const r=[],i=t||Ms.mix||jN,a=n.length-1;for(let s=0;s<a;s++){let u=i(n[s],n[s+1]);if(e){const c=Array.isArray(e)?e[s]||ji:e;u=Rd(c,u)}r.push(u)}return r}function sL(n,e,{clamp:t=!0,ease:r,mixer:i}={}){const a=n.length;if(G1(a===e.length),a===1)return()=>e[0];if(a===2&&e[0]===e[1])return()=>e[1];const s=n[0]===n[1];n[0]>n[a-1]&&(n=[...n].reverse(),e=[...e].reverse());const u=aL(e,r,i),c=u.length,h=d=>{if(s&&d<n[0])return e[0];let p=0;if(c>1)for(;p<n.length-2&&!(d<n[p+1]);p++);const g=td(n[p],n[p+1],d);return u[p](g)};return t?d=>h(ks(n[0],n[a-1],d)):h}function oL(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const i=td(0,e,r);n.push(on(t,1,i))}}function uL(n){const e=[0];return oL(e,n.length-1),e}function lL(n,e){return n.map(t=>t*e)}function cL(n,e){return n.map(()=>e||IN).splice(0,n.length-1)}function jf({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const i=xV(r)?r.map(aS):aS(r),a={done:!1,value:e[0]},s=lL(t&&t.length===e.length?t:uL(e),n),u=sL(s,e,{ease:Array.isArray(i)?i:cL(e,i)});return{calculatedDuration:n,next:c=>(a.value=u(c),a.done=c>=n,a)}}const hL=n=>n!==null;function ex(n,{repeat:e,repeatType:t="loop"},r,i=1){const a=n.filter(hL),u=i<0||e&&t!=="loop"&&e%2===1?0:a.length-1;return!u||r===void 0?a[u]:r}const fL={decay:hb,inertia:hb,tween:jf,keyframes:jf,spring:hg};function HN(n){typeof n.type=="string"&&(n.type=fL[n.type])}class tx{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const dL=n=>n/100;class nx extends tx{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==Zr.now()&&this.tick(Zr.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;HN(e);const{type:t=jf,repeat:r=0,repeatDelay:i=0,repeatType:a,velocity:s=0}=e;let{keyframes:u}=e;const c=t||jf;c!==jf&&typeof u[0]!="number"&&(this.mixKeyframes=Rd(dL,jN(u[0],u[1])),u=[0,100]);const h=c({...e,keyframes:u});a==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...u].reverse(),velocity:-s})),h.calculatedDuration===null&&(h.calculatedDuration=J1(h));const{calculatedDuration:d}=h;this.calculatedDuration=d,this.resolvedDuration=d+i,this.totalDuration=this.resolvedDuration*(r+1)-i,this.generator=h}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:i,mixKeyframes:a,mirroredGenerator:s,resolvedDuration:u,calculatedDuration:c}=this;if(this.startTime===null)return r.next(0);const{delay:h=0,keyframes:d,repeat:p,repeatType:g,repeatDelay:v,type:b,onUpdate:E,finalKeyframe:w}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const C=this.currentTime-h*(this.playbackSpeed>=0?1:-1),S=this.playbackSpeed>=0?C<0:C>i;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let I=this.currentTime,D=r;if(p){const R=Math.min(this.currentTime,i)/u;let k=Math.floor(R),P=R%1;!P&&R>=1&&(P=1),P===1&&k--,k=Math.min(k,p+1),k%2&&(g==="reverse"?(P=1-P,v&&(P-=v/u)):g==="mirror"&&(D=s)),I=ks(0,1,P)*u}const O=S?{done:!1,value:d[0]}:D.next(I);a&&(O.value=a(O.value));let{done:B}=O;!S&&c!==null&&(B=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const N=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&B);return N&&b!==hb&&(O.value=ex(d,this.options,w,this.speed)),E&&E(O.value),N&&this.finish(),O}then(e,t){return this.finished.then(e,t)}get duration(){return Vi(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Vi(e)}get time(){return Vi(this.currentTime)}set time(e){e=Ha(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Zr.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Vi(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=$V,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Zr.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function pL(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const Hu=n=>n*180/Math.PI,fb=n=>{const e=Hu(Math.atan2(n[1],n[0]));return db(e)},mL={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:fb,rotateZ:fb,skewX:n=>Hu(Math.atan(n[1])),skewY:n=>Hu(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},db=n=>(n=n%360,n<0&&(n+=360),n),hS=fb,fS=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),dS=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),gL={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:fS,scaleY:dS,scale:n=>(fS(n)+dS(n))/2,rotateX:n=>db(Hu(Math.atan2(n[6],n[5]))),rotateY:n=>db(Hu(Math.atan2(-n[2],n[0]))),rotateZ:hS,rotate:hS,skewX:n=>Hu(Math.atan(n[4])),skewY:n=>Hu(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function pb(n){return n.includes("scale")?1:0}function mb(n,e){if(!n||n==="none")return pb(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(t)r=gL,i=t;else{const u=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=mL,i=u}if(!i)return pb(e);const a=r[e],s=i[1].split(",").map(yL);return typeof a=="function"?a(s):s[a]}const vL=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return mb(t,e)};function yL(n){return parseFloat(n.trim())}const oh=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],uh=new Set(oh),pS=n=>n===sh||n===Oe,_L=new Set(["x","y","z"]),bL=oh.filter(n=>!_L.has(n));function xL(n){const e=[];return bL.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Xu={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>mb(e,"x"),y:(n,{transform:e})=>mb(e,"y")};Xu.translateX=Xu.x;Xu.translateY=Xu.y;const Yu=new Set;let gb=!1,vb=!1,yb=!1;function GN(){if(vb){const n=Array.from(Yu).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const i=xL(r);i.length&&(t.set(r,i),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const i=t.get(r);i&&i.forEach(([a,s])=>{r.getValue(a)?.set(s)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}vb=!1,gb=!1,Yu.forEach(n=>n.complete(yb)),Yu.clear()}function WN(){Yu.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(vb=!0)})}function wL(){yb=!0,WN(),GN(),yb=!1}class rx{constructor(e,t,r,i,a,s=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=i,this.element=a,this.isAsync=s}scheduleResolve(){this.state="scheduled",this.isAsync?(Yu.add(this),gb||(gb=!0,an.read(WN),an.resolveKeyframes(GN))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:i}=this;if(e[0]===null){const a=i?.get(),s=e[e.length-1];if(a!==void 0)e[0]=a;else if(r&&t){const u=r.readValue(t,s);u!=null&&(e[0]=u)}e[0]===void 0&&(e[0]=s),i&&a===void 0&&i.set(e[0])}pL(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Yu.delete(this)}cancel(){this.state==="scheduled"&&(Yu.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const EL=n=>n.startsWith("--");function TL(n,e,t){EL(e)?n.style.setProperty(e,t):n.style[e]=t}const CL=W1(()=>window.ScrollTimeline!==void 0),SL={};function AL(n,e){const t=W1(n);return()=>SL[e]??t()}const qN=AL(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Pf=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,mS={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Pf([0,.65,.55,1]),circOut:Pf([.55,0,1,.45]),backIn:Pf([.31,.01,.66,-.59]),backOut:Pf([.33,1.53,.69,.99])};function KN(n,e){if(n)return typeof n=="function"?qN()?UN(n,e):"ease-out":NN(n)?Pf(n):Array.isArray(n)?n.map(t=>KN(t,e)||mS.easeOut):mS[n]}function RL(n,e,t,{delay:r=0,duration:i=300,repeat:a=0,repeatType:s="loop",ease:u="easeOut",times:c}={},h=void 0){const d={[e]:t};c&&(d.offset=c);const p=KN(u,i);Array.isArray(p)&&(d.easing=p);const g={delay:r,duration:i,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:a+1,direction:s==="reverse"?"alternate":"normal"};return h&&(g.pseudoElement=h),n.animate(d,g)}function XN(n){return typeof n=="function"&&"applyToOptions"in n}function IL({type:n,...e}){return XN(n)&&qN()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class NL extends tx{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:i,pseudoElement:a,allowFlatten:s=!1,finalKeyframe:u,onComplete:c}=e;this.isPseudoElement=!!a,this.allowFlatten=s,this.options=e,G1(typeof e.type!="string");const h=IL(e);this.animation=RL(t,r,i,h,a),h.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const d=ex(i,this.options,u,this.speed);this.updateMotionValue?this.updateMotionValue(d):TL(t,r,d),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Vi(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Vi(e)}get time(){return Vi(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Ha(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&CL()?(this.animation.timeline=e,ji):t(this)}}const YN={anticipate:SN,backInOut:CN,circInOut:RN};function DL(n){return n in YN}function kL(n){typeof n.ease=="string"&&DL(n.ease)&&(n.ease=YN[n.ease])}const gS=10;class ML extends NL{constructor(e){kL(e),HN(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:i,element:a,...s}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const u=new nx({...s,autoplay:!1}),c=Ha(this.finishedTime??this.time);t.setWithVelocity(u.sample(c-gS).value,u.sample(c).value,gS),u.stop()}}const vS=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(zo.test(n)||n==="0")&&!n.startsWith("url("));function OL(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function PL(n,e,t,r){const i=n[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const a=n[n.length-1],s=vS(i,e),u=vS(a,e);return!s||!u?!1:OL(n)||(t==="spring"||XN(t))&&r}function _b(n){n.duration=0,n.type="keyframes"}const FL=new Set(["opacity","clipPath","filter","transform"]),VL=W1(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function LL(n){const{motionValue:e,name:t,repeatDelay:r,repeatType:i,damping:a,type:s}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:h}=e.owner.getProps();return VL()&&t&&FL.has(t)&&(t!=="transform"||!h)&&!c&&!r&&i!=="mirror"&&a!==0&&s!=="inertia"}const BL=40;class jL extends tx{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:s="loop",keyframes:u,name:c,motionValue:h,element:d,...p}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Zr.now();const g={autoplay:e,delay:t,type:r,repeat:i,repeatDelay:a,repeatType:s,name:c,motionValue:h,element:d,...p},v=d?.KeyframeResolver||rx;this.keyframeResolver=new v(u,(b,E,w)=>this.onKeyframesResolved(b,E,g,!w),c,h,d),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,i){this.keyframeResolver=void 0;const{name:a,type:s,velocity:u,delay:c,isHandoff:h,onUpdate:d}=r;this.resolvedAt=Zr.now(),PL(e,a,s,u)||((Ms.instantAnimations||!c)&&d?.(ex(e,r,t)),e[0]=e[e.length-1],_b(r),r.repeat=0);const g={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>BL?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},v=!h&&LL(g)?new ML({...g,element:g.motionValue.owner.current}):new nx(g);v.finished.then(()=>this.notifyFinished()).catch(ji),this.pendingTimeline&&(this.stopTimeline=v.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=v}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),wL()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const UL=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function zL(n){const e=UL.exec(n);if(!e)return[,];const[,t,r,i]=e;return[`--${t??r}`,i]}function $N(n,e,t=1){const[r,i]=zL(n);if(!r)return;const a=window.getComputedStyle(e).getPropertyValue(r);if(a){const s=a.trim();return vN(s)?parseFloat(s):s}return Y1(i)?$N(i,e,t+1):i}function ix(n,e){return n?.[e]??n?.default??n}const QN=new Set(["width","height","top","left","right","bottom",...oh]),HL={test:n=>n==="auto",parse:n=>n},ZN=n=>e=>e.test(n),JN=[sh,Oe,Ga,So,OV,MV,HL],yS=n=>JN.find(ZN(n));function GL(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||_N(n):!0}const WL=new Set(["brightness","contrast","saturate","opacity"]);function qL(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match($1)||[];if(!r)return n;const i=t.replace(r,"");let a=WL.has(e)?1:0;return r!==t&&(a*=100),e+"("+a+i+")"}const KL=/\b([a-z-]*)\(.*?\)/gu,bb={...zo,getAnimatableNone:n=>{const e=n.match(KL);return e?e.map(qL).join(" "):n}},_S={...sh,transform:Math.round},XL={rotate:So,rotateX:So,rotateY:So,rotateZ:So,scale:Sm,scaleX:Sm,scaleY:Sm,scaleZ:Sm,skew:So,skewX:So,skewY:So,distance:Oe,translateX:Oe,translateY:Oe,translateZ:Oe,x:Oe,y:Oe,z:Oe,perspective:Oe,transformPerspective:Oe,opacity:nd,originX:sS,originY:sS,originZ:Oe},ax={borderWidth:Oe,borderTopWidth:Oe,borderRightWidth:Oe,borderBottomWidth:Oe,borderLeftWidth:Oe,borderRadius:Oe,radius:Oe,borderTopLeftRadius:Oe,borderTopRightRadius:Oe,borderBottomRightRadius:Oe,borderBottomLeftRadius:Oe,width:Oe,maxWidth:Oe,height:Oe,maxHeight:Oe,top:Oe,right:Oe,bottom:Oe,left:Oe,inset:Oe,insetBlock:Oe,insetBlockStart:Oe,insetBlockEnd:Oe,insetInline:Oe,insetInlineStart:Oe,insetInlineEnd:Oe,padding:Oe,paddingTop:Oe,paddingRight:Oe,paddingBottom:Oe,paddingLeft:Oe,paddingBlock:Oe,paddingBlockStart:Oe,paddingBlockEnd:Oe,paddingInline:Oe,paddingInlineStart:Oe,paddingInlineEnd:Oe,margin:Oe,marginTop:Oe,marginRight:Oe,marginBottom:Oe,marginLeft:Oe,marginBlock:Oe,marginBlockStart:Oe,marginBlockEnd:Oe,marginInline:Oe,marginInlineStart:Oe,marginInlineEnd:Oe,backgroundPositionX:Oe,backgroundPositionY:Oe,...XL,zIndex:_S,fillOpacity:nd,strokeOpacity:nd,numOctaves:_S},YL={...ax,color:kn,backgroundColor:kn,outlineColor:kn,fill:kn,stroke:kn,borderColor:kn,borderTopColor:kn,borderRightColor:kn,borderBottomColor:kn,borderLeftColor:kn,filter:bb,WebkitFilter:bb},eD=n=>YL[n];function tD(n,e){let t=eD(n);return t!==bb&&(t=zo),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const $L=new Set(["auto","none","0"]);function QL(n,e,t){let r=0,i;for(;r<n.length&&!i;){const a=n[r];typeof a=="string"&&!$L.has(a)&&rd(a).values.length&&(i=n[r]),r++}if(i&&t)for(const a of e)n[a]=tD(t,i)}class ZL extends rx{constructor(e,t,r,i,a){super(e,t,r,i,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let h=e[c];if(typeof h=="string"&&(h=h.trim(),Y1(h))){const d=$N(h,t.current);d!==void 0&&(e[c]=d),c===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!QN.has(r)||e.length!==2)return;const[i,a]=e,s=yS(i),u=yS(a);if(s!==u)if(pS(s)&&pS(u))for(let c=0;c<e.length;c++){const h=e[c];typeof h=="string"&&(e[c]=parseFloat(h))}else Xu[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let i=0;i<e.length;i++)(e[i]===null||GL(e[i]))&&r.push(i);r.length&&QL(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Xu[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(r,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const a=r.length-1,s=r[a];r[a]=Xu[t](e.measureViewportBox(),window.getComputedStyle(e.current)),s!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=s),this.removedTransforms?.length&&this.removedTransforms.forEach(([u,c])=>{e.getValue(u).set(c)}),this.resolveNoneKeyframes()}}function JL(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const i=t?.[n]??r.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const nD=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function rD(n){return yN(n)&&"offsetHeight"in n}const bS=30,eB=n=>!isNaN(parseFloat(n));class tB{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const i=Zr.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Zr.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=eB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new q1);const r=this.events[e].add(t);return e==="change"?()=>{r(),an.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Zr.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>bS)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,bS);return bN(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Gc(n,e){return new tB(n,e)}const{schedule:sx}=DN(queueMicrotask,!1),na={x:!1,y:!1};function iD(){return na.x||na.y}function nB(n){return n==="x"||n==="y"?na[n]?null:(na[n]=!0,()=>{na[n]=!1}):na.x||na.y?null:(na.x=na.y=!0,()=>{na.x=na.y=!1})}function aD(n,e){const t=JL(n),r=new AbortController,i={passive:!0,...e,signal:r.signal};return[t,i,()=>r.abort()]}function xS(n){return!(n.pointerType==="touch"||iD())}function rB(n,e,t={}){const[r,i,a]=aD(n,t),s=u=>{if(!xS(u))return;const{target:c}=u,h=e(c,u);if(typeof h!="function"||!c)return;const d=p=>{xS(p)&&(h(p),c.removeEventListener("pointerleave",d))};c.addEventListener("pointerleave",d,i)};return r.forEach(u=>{u.addEventListener("pointerenter",s,i)}),a}const sD=(n,e)=>e?n===e?!0:sD(n,e.parentElement):!1,ox=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,iB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function aB(n){return iB.has(n.tagName)||n.tabIndex!==-1}const Zm=new WeakSet;function wS(n){return e=>{e.key==="Enter"&&n(e)}}function o_(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const sB=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=wS(()=>{if(Zm.has(t))return;o_(t,"down");const i=wS(()=>{o_(t,"up")}),a=()=>o_(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",a,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function ES(n){return ox(n)&&!iD()}function oB(n,e,t={}){const[r,i,a]=aD(n,t),s=u=>{const c=u.currentTarget;if(!ES(u))return;Zm.add(c);const h=e(c,u),d=(v,b)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",g),Zm.has(c)&&Zm.delete(c),ES(v)&&typeof h=="function"&&h(v,{success:b})},p=v=>{d(v,c===window||c===document||t.useGlobalTarget||sD(c,v.target))},g=v=>{d(v,!1)};window.addEventListener("pointerup",p,i),window.addEventListener("pointercancel",g,i)};return r.forEach(u=>{(t.useGlobalTarget?window:u).addEventListener("pointerdown",s,i),rD(u)&&(u.addEventListener("focus",h=>sB(h,i)),!aB(u)&&!u.hasAttribute("tabindex")&&(u.tabIndex=0))}),a}function oD(n){return yN(n)&&"ownerSVGElement"in n}function uB(n){return oD(n)&&n.tagName==="svg"}const Nr=n=>!!(n&&n.getVelocity),lB=[...JN,kn,zo],cB=n=>lB.find(ZN(n)),ux=re.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function TS(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function hB(...n){return e=>{let t=!1;const r=n.map(i=>{const a=TS(i,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let i=0;i<r.length;i++){const a=r[i];typeof a=="function"?a():TS(n[i],null)}}}}function fB(...n){return re.useCallback(hB(...n),n)}class dB extends re.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,i=rD(r)&&r.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=i-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function pB({children:n,isPresent:e,anchorX:t,root:r}){const i=re.useId(),a=re.useRef(null),s=re.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=re.useContext(ux),c=n.props?.ref??n?.ref,h=fB(a,c);return re.useInsertionEffect(()=>{const{width:d,height:p,top:g,left:v,right:b}=s.current;if(e||!a.current||!d||!p)return;const E=t==="left"?`left: ${v}`:`right: ${b}`;a.current.dataset.motionPopId=i;const w=document.createElement("style");u&&(w.nonce=u);const C=r??document.head;return C.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${p}px !important;
            ${E}px !important;
            top: ${g}px !important;
          }
        `),()=>{C.contains(w)&&C.removeChild(w)}},[e]),T.jsx(dB,{isPresent:e,childRef:a,sizeRef:s,children:re.cloneElement(n,{ref:h})})}const mB=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:a,mode:s,anchorX:u,root:c})=>{const h=j1(gB),d=re.useId();let p=!0,g=re.useMemo(()=>(p=!1,{id:d,initial:e,isPresent:t,custom:i,onExitComplete:v=>{h.set(v,!0);for(const b of h.values())if(!b)return;r&&r()},register:v=>(h.set(v,!1),()=>h.delete(v))}),[t,h,r]);return a&&p&&(g={...g}),re.useMemo(()=>{h.forEach((v,b)=>h.set(b,!1))},[t]),re.useEffect(()=>{!t&&!h.size&&r&&r()},[t]),s==="popLayout"&&(n=T.jsx(pB,{isPresent:t,anchorX:u,root:c,children:n})),T.jsx(uv.Provider,{value:g,children:n})};function gB(){return new Map}function uD(n=!0){const e=re.useContext(uv);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=e,a=re.useId();re.useEffect(()=>{if(n)return i(a)},[n]);const s=re.useCallback(()=>n&&r&&r(a),[a,r,n]);return!t&&r?[!1,s]:[!0]}const Am=n=>n.key||"";function CS(n){const e=[];return re.Children.forEach(n,t=>{re.isValidElement(t)&&e.push(t)}),e}const Rc=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:a="sync",propagate:s=!1,anchorX:u="left",root:c})=>{const[h,d]=uD(s),p=re.useMemo(()=>CS(n),[n]),g=s&&!h?[]:p.map(Am),v=re.useRef(!0),b=re.useRef(p),E=j1(()=>new Map),w=re.useRef(new Set),[C,S]=re.useState(p),[I,D]=re.useState(p);gN(()=>{v.current=!1,b.current=p;for(let N=0;N<I.length;N++){const R=Am(I[N]);g.includes(R)?(E.delete(R),w.current.delete(R)):E.get(R)!==!0&&E.set(R,!1)}},[I,g.length,g.join("-")]);const O=[];if(p!==C){let N=[...p];for(let R=0;R<I.length;R++){const k=I[R],P=Am(k);g.includes(P)||(N.splice(R,0,k),O.push(k))}return a==="wait"&&O.length&&(N=O),D(CS(N)),S(p),null}const{forceRender:B}=re.useContext(B1);return T.jsx(T.Fragment,{children:I.map(N=>{const R=Am(N),k=s&&!h?!1:p===I||g.includes(R),P=()=>{if(w.current.has(R))return;if(w.current.add(R),E.has(R))E.set(R,!0);else return;let V=!0;E.forEach(j=>{j||(V=!1)}),V&&(B?.(),D(b.current),s&&d?.(),r&&r())};return T.jsx(mB,{isPresent:k,initial:!v.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:a,root:c,onExitComplete:k?void 0:P,anchorX:u,children:N},R)})})},lD=re.createContext({strict:!1}),SS={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Wc={};for(const n in SS)Wc[n]={isEnabled:e=>SS[n].some(t=>!!e[t])};function vB(n){for(const e in n)Wc[e]={...Wc[e],...n[e]}}const yB=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function fg(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||yB.has(n)}let cD=n=>!fg(n);function _B(n){typeof n=="function"&&(cD=e=>e.startsWith("on")?!fg(e):n(e))}try{_B(require("@emotion/is-prop-valid").default)}catch{}function bB(n,e,t){const r={};for(const i in n)i==="values"&&typeof n.values=="object"||(cD(i)||t===!0&&fg(i)||!e&&!fg(i)||n.draggable&&i.startsWith("onDrag"))&&(r[i]=n[i]);return r}const lv=re.createContext({});function cv(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function id(n){return typeof n=="string"||Array.isArray(n)}const lx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],cx=["initial",...lx];function hv(n){return cv(n.animate)||cx.some(e=>id(n[e]))}function hD(n){return!!(hv(n)||n.variants)}function xB(n,e){if(hv(n)){const{initial:t,animate:r}=n;return{initial:t===!1||id(t)?t:void 0,animate:id(r)?r:void 0}}return n.inherit!==!1?e:{}}function wB(n){const{initial:e,animate:t}=xB(n,re.useContext(lv));return re.useMemo(()=>({initial:e,animate:t}),[AS(e),AS(t)])}function AS(n){return Array.isArray(n)?n.join(" "):n}function RS(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Cf={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Oe.test(n))n=parseFloat(n);else return n;const t=RS(n,e.target.x),r=RS(n,e.target.y);return`${t}% ${r}%`}},EB={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,i=zo.parse(n);if(i.length>5)return r;const a=zo.createTransformer(n),s=typeof i[0]!="number"?1:0,u=t.x.scale*e.x,c=t.y.scale*e.y;i[0+s]/=u,i[1+s]/=c;const h=on(u,c,.5);return typeof i[2+s]=="number"&&(i[2+s]/=h),typeof i[3+s]=="number"&&(i[3+s]/=h),a(i)}},xb={borderRadius:{...Cf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cf,borderTopRightRadius:Cf,borderBottomLeftRadius:Cf,borderBottomRightRadius:Cf,boxShadow:EB};function fD(n,{layout:e,layoutId:t}){return uh.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!xb[n]||n==="opacity")}const TB={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},CB=oh.length;function SB(n,e,t){let r="",i=!0;for(let a=0;a<CB;a++){const s=oh[a],u=n[s];if(u===void 0)continue;let c=!0;if(typeof u=="number"?c=u===(s.startsWith("scale")?1:0):c=parseFloat(u)===0,!c||t){const h=nD(u,ax[s]);if(!c){i=!1;const d=TB[s]||s;r+=`${d}(${h}) `}t&&(e[s]=h)}}return r=r.trim(),t?r=t(e,i?"":r):i&&(r="none"),r}function hx(n,e,t){const{style:r,vars:i,transformOrigin:a}=n;let s=!1,u=!1;for(const c in e){const h=e[c];if(uh.has(c)){s=!0;continue}else if(MN(c)){i[c]=h;continue}else{const d=nD(h,ax[c]);c.startsWith("origin")?(u=!0,a[c]=d):r[c]=d}}if(e.transform||(s||t?r.transform=SB(e,n.transform,t):r.transform&&(r.transform="none")),u){const{originX:c="50%",originY:h="50%",originZ:d=0}=a;r.transformOrigin=`${c} ${h} ${d}`}}const fx=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function dD(n,e,t){for(const r in e)!Nr(e[r])&&!fD(r,t)&&(n[r]=e[r])}function AB({transformTemplate:n},e){return re.useMemo(()=>{const t=fx();return hx(t,e,n),Object.assign({},t.vars,t.style)},[e])}function RB(n,e){const t=n.style||{},r={};return dD(r,t,n),Object.assign(r,AB(n,e)),r}function IB(n,e){const t={},r=RB(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const NB={offset:"stroke-dashoffset",array:"stroke-dasharray"},DB={offset:"strokeDashoffset",array:"strokeDasharray"};function kB(n,e,t=1,r=0,i=!0){n.pathLength=1;const a=i?NB:DB;n[a.offset]=Oe.transform(-r);const s=Oe.transform(e),u=Oe.transform(t);n[a.array]=`${s} ${u}`}const MB=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function pD(n,{attrX:e,attrY:t,attrScale:r,pathLength:i,pathSpacing:a=1,pathOffset:s=0,...u},c,h,d){if(hx(n,u,h),c){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:p,style:g}=n;p.transform&&(g.transform=p.transform,delete p.transform),(g.transform||p.transformOrigin)&&(g.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),g.transform&&(g.transformBox=d?.transformBox??"fill-box",delete p.transformBox);for(const v of MB)p[v]!==void 0&&(g[v]=p[v],delete p[v]);e!==void 0&&(p.x=e),t!==void 0&&(p.y=t),r!==void 0&&(p.scale=r),i!==void 0&&kB(p,i,a,s,!1)}const mD=()=>({...fx(),attrs:{}}),gD=n=>typeof n=="string"&&n.toLowerCase()==="svg";function OB(n,e,t,r){const i=re.useMemo(()=>{const a=mD();return pD(a,e,gD(r),n.transformTemplate,n.style),{...a.attrs,style:{...a.style}}},[e]);if(n.style){const a={};dD(a,n.style,n),i.style={...a,...i.style}}return i}const PB=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function dx(n){return typeof n!="string"||n.includes("-")?!1:!!(PB.indexOf(n)>-1||/[A-Z]/u.test(n))}function FB(n,e,t,{latestValues:r},i,a=!1,s){const c=(s??dx(n)?OB:IB)(e,r,i,n),h=bB(e,typeof n=="string",a),d=n!==re.Fragment?{...h,...c,ref:t}:{},{children:p}=e,g=re.useMemo(()=>Nr(p)?p.get():p,[p]);return re.createElement(n,{...d,children:g})}function IS(n){const e=[{},{}];return n?.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function px(n,e,t,r){if(typeof e=="function"){const[i,a]=IS(r);e=e(t!==void 0?t:n.custom,i,a)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[i,a]=IS(r);e=e(t!==void 0?t:n.custom,i,a)}return e}function Jm(n){return Nr(n)?n.get():n}function VB({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,i){return{latestValues:LB(t,r,i,n),renderState:e()}}function LB(n,e,t,r){const i={},a=r(n,{});for(const g in a)i[g]=Jm(a[g]);let{initial:s,animate:u}=n;const c=hv(n),h=hD(n);e&&h&&!c&&n.inherit!==!1&&(s===void 0&&(s=e.initial),u===void 0&&(u=e.animate));let d=t?t.initial===!1:!1;d=d||s===!1;const p=d?u:s;if(p&&typeof p!="boolean"&&!cv(p)){const g=Array.isArray(p)?p:[p];for(let v=0;v<g.length;v++){const b=px(n,g[v]);if(b){const{transitionEnd:E,transition:w,...C}=b;for(const S in C){let I=C[S];if(Array.isArray(I)){const D=d?I.length-1:0;I=I[D]}I!==null&&(i[S]=I)}for(const S in E)i[S]=E[S]}}}return i}const vD=n=>(e,t)=>{const r=re.useContext(lv),i=re.useContext(uv),a=()=>VB(n,e,r,i);return t?a():j1(a)};function mx(n,e,t){const{style:r}=n,i={};for(const a in r)(Nr(r[a])||e.style&&Nr(e.style[a])||fD(a,n)||t?.getValue(a)?.liveStyle!==void 0)&&(i[a]=r[a]);return i}const BB=vD({scrapeMotionValuesFromProps:mx,createRenderState:fx});function yD(n,e,t){const r=mx(n,e,t);for(const i in n)if(Nr(n[i])||Nr(e[i])){const a=oh.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[a]=n[i]}return r}const jB=vD({scrapeMotionValuesFromProps:yD,createRenderState:mD}),UB=Symbol.for("motionComponentSymbol");function xc(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function NS(n,e){if(typeof n=="function")return n(e);xc(n)&&(n.current=e)}function zB(n,e,t){const r=re.useRef(null);return re.useCallback(i=>{if(i&&n.onMount&&n.onMount(i),e&&(i?e.mount(i):e.unmount()),t)if(i){const a=NS(t,i);typeof a=="function"&&(r.current=a)}else r.current?(r.current(),r.current=null):NS(t,i)},[e,n,t])}const gx=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),HB="framerAppearId",_D="data-"+gx(HB),bD=re.createContext({});function GB(n,e,t,r,i,a){const{visualElement:s}=re.useContext(lv),u=re.useContext(lD),c=re.useContext(uv),h=re.useContext(ux).reducedMotion,d=re.useRef(null);r=r||u.renderer,!d.current&&r&&(d.current=r(n,{visualState:e,parent:s,props:t,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:h,isSVG:a}));const p=d.current,g=re.useContext(bD);p&&!p.projection&&i&&(p.type==="html"||p.type==="svg")&&WB(d.current,t,i,g);const v=re.useRef(!1);re.useInsertionEffect(()=>{p&&v.current&&p.update(t,c)});const b=t[_D],E=re.useRef(!!b&&!window.MotionHandoffIsComplete?.(b)&&window.MotionHasOptimisedAnimation?.(b));return gN(()=>{p&&(v.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),p.scheduleRenderMicrotask(),E.current&&p.animationState&&p.animationState.animateChanges())}),re.useEffect(()=>{p&&(!E.current&&p.animationState&&p.animationState.animateChanges(),E.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(b)}),E.current=!1),p.enteringChildren=void 0)}),p}function WB(n,e,t,r){const{layoutId:i,layout:a,drag:s,dragConstraints:u,layoutScroll:c,layoutRoot:h,layoutCrossfade:d}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:xD(n.parent)),n.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:!!s||u&&xc(u),visualElement:n,animationType:typeof a=="string"?a:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:c,layoutRoot:h})}function xD(n){if(n)return n.options.allowProjection!==!1?n.projection:xD(n.parent)}function u_(n,{forwardMotionProps:e=!1,type:t}={},r,i){r&&vB(r);const a=t?t==="svg":dx(n),s=a?jB:BB;function u(h,d){let p;const g={...re.useContext(ux),...h,layoutId:qB(h)},{isStatic:v}=g,b=wB(h),E=s(h,v);if(!v&&U1){KB();const w=XB(g);p=w.MeasureLayout,b.visualElement=GB(n,E,g,i,w.ProjectionNode,a)}return T.jsxs(lv.Provider,{value:b,children:[p&&b.visualElement?T.jsx(p,{visualElement:b.visualElement,...g}):null,FB(n,h,zB(E,b.visualElement,d),E,v,e,a)]})}u.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const c=re.forwardRef(u);return c[UB]=n,c}function qB({layoutId:n}){const e=re.useContext(B1).id;return e&&n!==void 0?e+"-"+n:n}function KB(n,e){re.useContext(lD).strict}function XB(n){const{drag:e,layout:t}=Wc;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function YB(n,e){if(typeof Proxy>"u")return u_;const t=new Map,r=(a,s)=>u_(a,s,n,e),i=(a,s)=>r(a,s);return new Proxy(i,{get:(a,s)=>s==="create"?r:(t.has(s)||t.set(s,u_(s,void 0,n,e)),t.get(s))})}function wD({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function $B({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function QB(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function l_(n){return n===void 0||n===1}function wb({scale:n,scaleX:e,scaleY:t}){return!l_(n)||!l_(e)||!l_(t)}function Fu(n){return wb(n)||ED(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function ED(n){return DS(n.x)||DS(n.y)}function DS(n){return n&&n!=="0%"}function dg(n,e,t){const r=n-t,i=e*r;return t+i}function kS(n,e,t,r,i){return i!==void 0&&(n=dg(n,i,r)),dg(n,t,r)+e}function Eb(n,e=0,t=1,r,i){n.min=kS(n.min,e,t,r,i),n.max=kS(n.max,e,t,r,i)}function TD(n,{x:e,y:t}){Eb(n.x,e.translate,e.scale,e.originPoint),Eb(n.y,t.translate,t.scale,t.originPoint)}const MS=.999999999999,OS=1.0000000000001;function ZB(n,e,t,r=!1){const i=t.length;if(!i)return;e.x=e.y=1;let a,s;for(let u=0;u<i;u++){a=t[u],s=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&Ec(n,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),s&&(e.x*=s.x.scale,e.y*=s.y.scale,TD(n,s)),r&&Fu(a.latestValues)&&Ec(n,a.latestValues))}e.x<OS&&e.x>MS&&(e.x=1),e.y<OS&&e.y>MS&&(e.y=1)}function wc(n,e){n.min=n.min+e,n.max=n.max+e}function PS(n,e,t,r,i=.5){const a=on(n.min,n.max,i);Eb(n,e,t,a,r)}function Ec(n,e){PS(n.x,e.x,e.scaleX,e.scale,e.originX),PS(n.y,e.y,e.scaleY,e.scale,e.originY)}function CD(n,e){return wD(QB(n.getBoundingClientRect(),e))}function JB(n,e,t){const r=CD(n,t),{scroll:i}=e;return i&&(wc(r.x,i.offset.x),wc(r.y,i.offset.y)),r}const FS=()=>({translate:0,scale:1,origin:0,originPoint:0}),Tc=()=>({x:FS(),y:FS()}),VS=()=>({min:0,max:0}),Un=()=>({x:VS(),y:VS()}),Tb={current:null},SD={current:!1};function ej(){if(SD.current=!0,!!U1)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>Tb.current=n.matches;n.addEventListener("change",e),e()}else Tb.current=!1}const tj=new WeakMap;function nj(n,e,t){for(const r in e){const i=e[r],a=t[r];if(Nr(i))n.addValue(r,i);else if(Nr(a))n.addValue(r,Gc(i,{owner:n}));else if(a!==i)if(n.hasValue(r)){const s=n.getValue(r);s.liveStyle===!0?s.jump(i):s.hasAnimated||s.set(i)}else{const s=n.getStaticValue(r);n.addValue(r,Gc(s!==void 0?s:i,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const LS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class rj{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:a,visualState:s},u={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=rx,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=Zr.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,an.render(this.render,!1,!0))};const{latestValues:c,renderState:h}=s;this.latestValues=c,this.baseTarget={...c},this.initialValues=t.initial?{...c}:{},this.renderState=h,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=u,this.blockInitialAnimation=!!a,this.isControllingVariants=hv(t),this.isVariantNode=hD(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...p}=this.scrapeMotionValuesFromProps(t,{},this);for(const g in p){const v=p[g];c[g]!==void 0&&Nr(v)&&v.set(c[g])}}mount(e){this.current=e,tj.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(SD.current||ej(),this.shouldReduceMotion=Tb.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Uo(this.notifyUpdate),Uo(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=uh.has(e);r&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",s=>{this.latestValues[e]=s,this.props.onUpdate&&an.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Wc){const t=Wc[e];if(!t)continue;const{isEnabled:r,Feature:i}=t;if(!this.features[e]&&i&&r(this.props)&&(this.features[e]=new i(this)),this.features[e]){const a=this.features[e];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Un()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<LS.length;r++){const i=LS[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const a="on"+i,s=e[a];s&&(this.propEventSubscriptions[i]=this.on(i,s))}this.prevMotionValues=nj(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=Gc(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(vN(r)||_N(r))?r=parseFloat(r):!cB(r)&&zo.test(t)&&(r=tD(e,t)),this.setBaseTarget(e,Nr(r)?r.get():r)),Nr(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const a=px(this.props,t,this.presenceContext?.custom);a&&(r=a[e])}if(t&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Nr(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new q1),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){sx.render(this.render)}}class AD extends rj{constructor(){super(...arguments),this.KeyframeResolver=ZL}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Nr(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function RD(n,{style:e,vars:t},r,i){const a=n.style;let s;for(s in e)a[s]=e[s];i?.applyProjectionStyles(a,r);for(s in t)a.setProperty(s,t[s])}function ij(n){return window.getComputedStyle(n)}class aj extends AD{constructor(){super(...arguments),this.type="html",this.renderInstance=RD}readValueFromInstance(e,t){if(uh.has(t))return this.projection?.isProjecting?pb(t):vL(e,t);{const r=ij(e),i=(MN(t)?r.getPropertyValue(t):r[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return CD(e,t)}build(e,t,r){hx(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return mx(e,t,r)}}const ID=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function sj(n,e,t,r){RD(n,e,void 0,r);for(const i in e.attrs)n.setAttribute(ID.has(i)?i:gx(i),e.attrs[i])}class oj extends AD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Un}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(uh.has(t)){const r=eD(t);return r&&r.default||0}return t=ID.has(t)?t:gx(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return yD(e,t,r)}build(e,t,r){pD(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,i){sj(e,t,r,i)}mount(e){this.isSVGTag=gD(e.tagName),super.mount(e)}}const uj=(n,e)=>e.isSVG??dx(n)?new oj(e):new aj(e,{allowProjection:n!==re.Fragment});function Ic(n,e,t){const r=n.getProps();return px(r,e,t!==void 0?t:r.custom,n)}const Cb=n=>Array.isArray(n);function lj(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,Gc(t))}function cj(n){return Cb(n)?n[n.length-1]||0:n}function hj(n,e){const t=Ic(n,e);let{transitionEnd:r={},transition:i={},...a}=t||{};a={...a,...r};for(const s in a){const u=cj(a[s]);lj(n,s,u)}}function fj(n){return!!(Nr(n)&&n.add)}function Sb(n,e){const t=n.getValue("willChange");if(fj(t))return t.add(e);if(!t&&Ms.WillChange){const r=new Ms.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function ND(n){return n.props[_D]}const dj=n=>n!==null;function pj(n,{repeat:e,repeatType:t="loop"},r){const i=n.filter(dj),a=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[a]}const mj={type:"spring",stiffness:500,damping:25,restSpeed:10},gj=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),vj={type:"keyframes",duration:.8},yj={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},_j=(n,{keyframes:e})=>e.length>2?vj:uh.has(n)?n.startsWith("scale")?gj(e[1]):mj:yj;function bj({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:a,repeatType:s,repeatDelay:u,from:c,elapsed:h,...d}){return!!Object.keys(d).length}const vx=(n,e,t,r={},i,a)=>s=>{const u=ix(r,n)||{},c=u.delay||r.delay||0;let{elapsed:h=0}=r;h=h-Ha(c);const d={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...u,delay:-h,onUpdate:g=>{e.set(g),u.onUpdate&&u.onUpdate(g)},onComplete:()=>{s(),u.onComplete&&u.onComplete()},name:n,motionValue:e,element:a?void 0:i};bj(u)||Object.assign(d,_j(n,d)),d.duration&&(d.duration=Ha(d.duration)),d.repeatDelay&&(d.repeatDelay=Ha(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let p=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(_b(d),d.delay===0&&(p=!0)),(Ms.instantAnimations||Ms.skipAnimations)&&(p=!0,_b(d),d.delay=0),d.allowFlatten=!u.type&&!u.ease,p&&!a&&e.get()!==void 0){const g=pj(d.keyframes,u);if(g!==void 0){an.update(()=>{d.onUpdate(g),d.onComplete()});return}}return u.isSync?new nx(d):new jL(d)};function xj({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function DD(n,e,{delay:t=0,transitionOverride:r,type:i}={}){let{transition:a=n.getDefaultTransition(),transitionEnd:s,...u}=e;r&&(a=r);const c=[],h=i&&n.animationState&&n.animationState.getState()[i];for(const d in u){const p=n.getValue(d,n.latestValues[d]??null),g=u[d];if(g===void 0||h&&xj(h,d))continue;const v={delay:t,...ix(a||{},d)},b=p.get();if(b!==void 0&&!p.isAnimating&&!Array.isArray(g)&&g===b&&!v.velocity)continue;let E=!1;if(window.MotionHandoffAnimation){const C=ND(n);if(C){const S=window.MotionHandoffAnimation(C,d,an);S!==null&&(v.startTime=S,E=!0)}}Sb(n,d),p.start(vx(d,p,g,n.shouldReduceMotion&&QN.has(d)?{type:!1}:v,n,E));const w=p.animation;w&&c.push(w)}return s&&Promise.all(c).then(()=>{an.update(()=>{s&&hj(n,s)})}),c}function kD(n,e,t,r=0,i=1){const a=Array.from(n).sort((h,d)=>h.sortNodePosition(d)).indexOf(e),s=n.size,u=(s-1)*r;return typeof t=="function"?t(a,s):i===1?a*r:u-a*r}function Ab(n,e,t={}){const r=Ic(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(i=t.transitionOverride);const a=r?()=>Promise.all(DD(n,r,t)):()=>Promise.resolve(),s=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:h=0,staggerChildren:d,staggerDirection:p}=i;return wj(n,e,c,h,d,p,t)}:()=>Promise.resolve(),{when:u}=i;if(u){const[c,h]=u==="beforeChildren"?[a,s]:[s,a];return c().then(()=>h())}else return Promise.all([a(),s(t.delay)])}function wj(n,e,t=0,r=0,i=0,a=1,s){const u=[];for(const c of n.variantChildren)c.notify("AnimationStart",e),u.push(Ab(c,e,{...s,delay:t+(typeof r=="function"?0:r)+kD(n.variantChildren,c,r,i,a)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(u)}function Ej(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(a=>Ab(n,a,t));r=Promise.all(i)}else if(typeof e=="string")r=Ab(n,e,t);else{const i=typeof e=="function"?Ic(n,e,t.custom):e;r=Promise.all(DD(n,i,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function MD(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const Tj=cx.length;function OD(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?OD(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<Tj;t++){const r=cx[t],i=n.props[r];(id(i)||i===!1)&&(e[r]=i)}return e}const Cj=[...lx].reverse(),Sj=lx.length;function Aj(n){return e=>Promise.all(e.map(({animation:t,options:r})=>Ej(n,t,r)))}function Rj(n){let e=Aj(n),t=BS(),r=!0;const i=c=>(h,d)=>{const p=Ic(n,d,c==="exit"?n.presenceContext?.custom:void 0);if(p){const{transition:g,transitionEnd:v,...b}=p;h={...h,...b,...v}}return h};function a(c){e=c(n)}function s(c){const{props:h}=n,d=OD(n.parent)||{},p=[],g=new Set;let v={},b=1/0;for(let w=0;w<Sj;w++){const C=Cj[w],S=t[C],I=h[C]!==void 0?h[C]:d[C],D=id(I),O=C===c?S.isActive:null;O===!1&&(b=w);let B=I===d[C]&&I!==h[C]&&D;if(B&&r&&n.manuallyAnimateOnMount&&(B=!1),S.protectedKeys={...v},!S.isActive&&O===null||!I&&!S.prevProp||cv(I)||typeof I=="boolean")continue;const N=Ij(S.prevProp,I);let R=N||C===c&&S.isActive&&!B&&D||w>b&&D,k=!1;const P=Array.isArray(I)?I:[I];let V=P.reduce(i(C),{});O===!1&&(V={});const{prevResolvedValues:j={}}=S,L={...j,...V},Z=X=>{R=!0,g.has(X)&&(k=!0,g.delete(X)),S.needsAnimating[X]=!0;const ee=n.getValue(X);ee&&(ee.liveStyle=!1)};for(const X in L){const ee=V[X],ue=j[X];if(v.hasOwnProperty(X))continue;let fe=!1;Cb(ee)&&Cb(ue)?fe=!MD(ee,ue):fe=ee!==ue,fe?ee!=null?Z(X):g.add(X):ee!==void 0&&g.has(X)?Z(X):S.protectedKeys[X]=!0}S.prevProp=I,S.prevResolvedValues=V,S.isActive&&(v={...v,...V}),r&&n.blockInitialAnimation&&(R=!1);const ne=B&&N;R&&(!ne||k)&&p.push(...P.map(X=>{const ee={type:C};if(typeof X=="string"&&r&&!ne&&n.manuallyAnimateOnMount&&n.parent){const{parent:ue}=n,fe=Ic(ue,X);if(ue.enteringChildren&&fe){const{delayChildren:W}=fe.transition||{};ee.delay=kD(ue.enteringChildren,n,W)}}return{animation:X,options:ee}}))}if(g.size){const w={};if(typeof h.initial!="boolean"){const C=Ic(n,Array.isArray(h.initial)?h.initial[0]:h.initial);C&&C.transition&&(w.transition=C.transition)}g.forEach(C=>{const S=n.getBaseTarget(C),I=n.getValue(C);I&&(I.liveStyle=!0),w[C]=S??null}),p.push({animation:w})}let E=!!p.length;return r&&(h.initial===!1||h.initial===h.animate)&&!n.manuallyAnimateOnMount&&(E=!1),r=!1,E?e(p):Promise.resolve()}function u(c,h){if(t[c].isActive===h)return Promise.resolve();n.variantChildren?.forEach(p=>p.animationState?.setActive(c,h)),t[c].isActive=h;const d=s(c);for(const p in t)t[p].protectedKeys={};return d}return{animateChanges:s,setActive:u,setAnimateFunction:a,getState:()=>t,reset:()=>{t=BS()}}}function Ij(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!MD(e,n):!1}function Ou(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function BS(){return{animate:Ou(!0),whileInView:Ou(),whileHover:Ou(),whileTap:Ou(),whileDrag:Ou(),whileFocus:Ou(),exit:Ou()}}class Zo{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Nj extends Zo{constructor(e){super(e),e.animationState||(e.animationState=Rj(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();cv(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Dj=0;class kj extends Zo{constructor(){super(...arguments),this.id=Dj++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Mj={animation:{Feature:Nj},exit:{Feature:kj}};function ad(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function Dd(n){return{point:{x:n.pageX,y:n.pageY}}}const Oj=n=>e=>ox(e)&&n(e,Dd(e));function Uf(n,e,t,r){return ad(n,e,Oj(t),r)}const PD=1e-4,Pj=1-PD,Fj=1+PD,FD=.01,Vj=0-FD,Lj=0+FD;function Vr(n){return n.max-n.min}function Bj(n,e,t){return Math.abs(n-e)<=t}function jS(n,e,t,r=.5){n.origin=r,n.originPoint=on(e.min,e.max,n.origin),n.scale=Vr(t)/Vr(e),n.translate=on(t.min,t.max,n.origin)-n.originPoint,(n.scale>=Pj&&n.scale<=Fj||isNaN(n.scale))&&(n.scale=1),(n.translate>=Vj&&n.translate<=Lj||isNaN(n.translate))&&(n.translate=0)}function zf(n,e,t,r){jS(n.x,e.x,t.x,r?r.originX:void 0),jS(n.y,e.y,t.y,r?r.originY:void 0)}function US(n,e,t){n.min=t.min+e.min,n.max=n.min+Vr(e)}function jj(n,e,t){US(n.x,e.x,t.x),US(n.y,e.y,t.y)}function zS(n,e,t){n.min=e.min-t.min,n.max=n.min+Vr(e)}function pg(n,e,t){zS(n.x,e.x,t.x),zS(n.y,e.y,t.y)}function Mi(n){return[n("x"),n("y")]}const VD=({current:n})=>n?n.ownerDocument.defaultView:null,HS=(n,e)=>Math.abs(n-e);function Uj(n,e){const t=HS(n.x,e.x),r=HS(n.y,e.y);return Math.sqrt(t**2+r**2)}class LD{constructor(e,t,{transformPagePoint:r,contextWindow:i=window,dragSnapToOrigin:a=!1,distanceThreshold:s=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=h_(this.lastMoveEventInfo,this.history),v=this.startEvent!==null,b=Uj(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!v&&!b)return;const{point:E}=g,{timestamp:w}=hr;this.history.push({...E,timestamp:w});const{onStart:C,onMove:S}=this.handlers;v||(C&&C(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),S&&S(this.lastMoveEvent,g)},this.handlePointerMove=(g,v)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=c_(v,this.transformPagePoint),an.update(this.updatePoint,!0)},this.handlePointerUp=(g,v)=>{this.end();const{onEnd:b,onSessionEnd:E,resumeAnimation:w}=this.handlers;if(this.dragSnapToOrigin&&w&&w(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const C=h_(g.type==="pointercancel"?this.lastMoveEventInfo:c_(v,this.transformPagePoint),this.history);this.startEvent&&b&&b(g,C),E&&E(g,C)},!ox(e))return;this.dragSnapToOrigin=a,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=s,this.contextWindow=i||window;const u=Dd(e),c=c_(u,this.transformPagePoint),{point:h}=c,{timestamp:d}=hr;this.history=[{...h,timestamp:d}];const{onSessionStart:p}=t;p&&p(e,h_(c,this.history)),this.removeListeners=Rd(Uf(this.contextWindow,"pointermove",this.handlePointerMove),Uf(this.contextWindow,"pointerup",this.handlePointerUp),Uf(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Uo(this.updatePoint)}}function c_(n,e){return e?{point:e(n.point)}:n}function GS(n,e){return{x:n.x-e.x,y:n.y-e.y}}function h_({point:n},e){return{point:n,delta:GS(n,BD(e)),offset:GS(n,zj(e)),velocity:Hj(e,.1)}}function zj(n){return n[0]}function BD(n){return n[n.length-1]}function Hj(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const i=BD(n);for(;t>=0&&(r=n[t],!(i.timestamp-r.timestamp>Ha(e)));)t--;if(!r)return{x:0,y:0};const a=Vi(i.timestamp-r.timestamp);if(a===0)return{x:0,y:0};const s={x:(i.x-r.x)/a,y:(i.y-r.y)/a};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function Gj(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?on(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?on(t,n,r.max):Math.min(n,t)),n}function WS(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function Wj(n,{top:e,left:t,bottom:r,right:i}){return{x:WS(n.x,t,i),y:WS(n.y,e,r)}}function qS(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function qj(n,e){return{x:qS(n.x,e.x),y:qS(n.y,e.y)}}function Kj(n,e){let t=.5;const r=Vr(n),i=Vr(e);return i>r?t=td(e.min,e.max-r,n.min):r>i&&(t=td(n.min,n.max-i,e.min)),ks(0,1,t)}function Xj(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Rb=.35;function Yj(n=Rb){return n===!1?n=0:n===!0&&(n=Rb),{x:KS(n,"left","right"),y:KS(n,"top","bottom")}}function KS(n,e,t){return{min:XS(n,e),max:XS(n,t)}}function XS(n,e){return typeof n=="number"?n:n[e]||0}const $j=new WeakMap;class Qj{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Un(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const a=p=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Dd(p).point)},s=(p,g)=>{const{drag:v,dragPropagation:b,onDragStart:E}=this.getProps();if(v&&!b&&(this.openDragLock&&this.openDragLock(),this.openDragLock=nB(v),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Mi(C=>{let S=this.getAxisMotionValue(C).get()||0;if(Ga.test(S)){const{projection:I}=this.visualElement;if(I&&I.layout){const D=I.layout.layoutBox[C];D&&(S=Vr(D)*(parseFloat(S)/100))}}this.originPoint[C]=S}),E&&an.postRender(()=>E(p,g)),Sb(this.visualElement,"transform");const{animationState:w}=this.visualElement;w&&w.setActive("whileDrag",!0)},u=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g;const{dragPropagation:v,dragDirectionLock:b,onDirectionLock:E,onDrag:w}=this.getProps();if(!v&&!this.openDragLock)return;const{offset:C}=g;if(b&&this.currentDirection===null){this.currentDirection=Zj(C),this.currentDirection!==null&&E&&E(this.currentDirection);return}this.updateAxis("x",g.point,C),this.updateAxis("y",g.point,C),this.visualElement.render(),w&&w(p,g)},c=(p,g)=>{this.latestPointerEvent=p,this.latestPanInfo=g,this.stop(p,g),this.latestPointerEvent=null,this.latestPanInfo=null},h=()=>Mi(p=>this.getAnimationState(p)==="paused"&&this.getAxisMotionValue(p).animation?.play()),{dragSnapToOrigin:d}=this.getProps();this.panSession=new LD(e,{onSessionStart:a,onStart:s,onMove:u,onSessionEnd:c,resumeAnimation:h},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:VD(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,i=t||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!i||!r)return;const{velocity:s}=i;this.startAnimation(s);const{onDragEnd:u}=this.getProps();u&&an.postRender(()=>u(r,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:i}=this.getProps();if(!r||!Rm(e,i,this.currentDirection))return;const a=this.getAxisMotionValue(e);let s=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(s=Gj(s,this.constraints[e],this.elastic[e])),a.set(s)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&xc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=Wj(r.layoutBox,e):this.constraints=!1,this.elastic=Yj(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Mi(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Xj(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!xc(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const a=JB(r,i.root,this.visualElement.getTransformPagePoint());let s=qj(i.layout.layoutBox,a);if(t){const u=t($B(s));this.hasMutatedConstraints=!!u,u&&(s=wD(u))}return s}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:i,dragTransition:a,dragSnapToOrigin:s,onDragTransitionEnd:u}=this.getProps(),c=this.constraints||{},h=Mi(d=>{if(!Rm(d,t,this.currentDirection))return;let p=c&&c[d]||{};s&&(p={min:0,max:0});const g=i?200:1e6,v=i?40:1e7,b={type:"inertia",velocity:r?e[d]:0,bounceStiffness:g,bounceDamping:v,timeConstant:750,restDelta:1,restSpeed:10,...a,...p};return this.startAxisValueAnimation(d,b)});return Promise.all(h).then(u)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return Sb(this.visualElement,e),r.start(vx(e,r,0,t,this.visualElement,!1))}stopAnimation(){Mi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Mi(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),i=r[t];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Mi(t=>{const{drag:r}=this.getProps();if(!Rm(t,r,this.currentDirection))return;const{projection:i}=this.visualElement,a=this.getAxisMotionValue(t);if(i&&i.layout){const{min:s,max:u}=i.layout.layoutBox[t],c=a.get()||0;a.set(e[t]-on(s,u,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!xc(t)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Mi(s=>{const u=this.getAxisMotionValue(s);if(u&&this.constraints!==!1){const c=u.get();i[s]=Kj({min:c,max:c},this.constraints[s])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Mi(s=>{if(!Rm(s,e,null))return;const u=this.getAxisMotionValue(s),{min:c,max:h}=this.constraints[s];u.set(on(c,h,i[s]))})}addListeners(){if(!this.visualElement.current)return;$j.set(this.visualElement,this);const e=this.visualElement.current,t=Uf(e,"pointerdown",c=>{const{drag:h,dragListener:d=!0}=this.getProps();h&&d&&this.start(c)}),r=()=>{const{dragConstraints:c}=this.getProps();xc(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,a=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),an.read(r);const s=ad(window,"resize",()=>this.scalePositionWithinConstraints()),u=i.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:h})=>{this.isDragging&&h&&(Mi(d=>{const p=this.getAxisMotionValue(d);p&&(this.originPoint[d]+=c[d].translate,p.set(p.get()+c[d].translate))}),this.visualElement.render())}));return()=>{s(),t(),a(),u&&u()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:a=!1,dragElastic:s=Rb,dragMomentum:u=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:i,dragConstraints:a,dragElastic:s,dragMomentum:u}}}function Rm(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Zj(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class Jj extends Zo{constructor(e){super(e),this.removeGroupControls=ji,this.removeListeners=ji,this.controls=new Qj(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ji}update(){const{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const YS=n=>(e,t)=>{n&&an.postRender(()=>n(e,t))};class e6 extends Zo{constructor(){super(...arguments),this.removePointerDownListener=ji}onPointerDown(e){this.session=new LD(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:VD(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:YS(e),onStart:YS(t),onMove:r,onEnd:(a,s)=>{delete this.session,i&&an.postRender(()=>i(a,s))}}}mount(){this.removePointerDownListener=Uf(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const eg={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let f_=!1;class t6 extends re.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:i}=this.props,{projection:a}=e;a&&(t.group&&t.group.add(a),r&&r.register&&i&&r.register(a),f_&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),eg.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:i,isPresent:a}=this.props,{projection:s}=r;return s&&(s.isPresent=a,f_=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==a?s.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?s.promote():s.relegate()||an.postRender(()=>{const u=s.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),sx.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:i}=e;f_=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function jD(n){const[e,t]=uD(),r=re.useContext(B1);return T.jsx(t6,{...n,layoutGroup:r,switchLayoutGroup:re.useContext(bD),isPresent:e,safeToRemove:t})}function n6(n,e,t){const r=Nr(n)?n:Gc(n);return r.start(vx("",r,e,t)),r.animation}const r6=(n,e)=>n.depth-e.depth;class i6{constructor(){this.children=[],this.isDirty=!1}add(e){z1(this.children,e),this.isDirty=!0}remove(e){H1(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(r6),this.isDirty=!1,this.children.forEach(e)}}function a6(n,e){const t=Zr.now(),r=({timestamp:i})=>{const a=i-t;a>=e&&(Uo(r),n(a-e))};return an.setup(r,!0),()=>Uo(r)}const UD=["TopLeft","TopRight","BottomLeft","BottomRight"],s6=UD.length,$S=n=>typeof n=="string"?parseFloat(n):n,QS=n=>typeof n=="number"||Oe.test(n);function o6(n,e,t,r,i,a){i?(n.opacity=on(0,t.opacity??1,u6(r)),n.opacityExit=on(e.opacity??1,0,l6(r))):a&&(n.opacity=on(e.opacity??1,t.opacity??1,r));for(let s=0;s<s6;s++){const u=`border${UD[s]}Radius`;let c=ZS(e,u),h=ZS(t,u);if(c===void 0&&h===void 0)continue;c||(c=0),h||(h=0),c===0||h===0||QS(c)===QS(h)?(n[u]=Math.max(on($S(c),$S(h),r),0),(Ga.test(h)||Ga.test(c))&&(n[u]+="%")):n[u]=h}(e.rotate||t.rotate)&&(n.rotate=on(e.rotate||0,t.rotate||0,r))}function ZS(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const u6=zD(0,.5,AN),l6=zD(.5,.95,ji);function zD(n,e,t){return r=>r<n?0:r>e?1:t(td(n,e,r))}function JS(n,e){n.min=e.min,n.max=e.max}function ta(n,e){JS(n.x,e.x),JS(n.y,e.y)}function eA(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function tA(n,e,t,r,i){return n-=e,n=dg(n,1/t,r),i!==void 0&&(n=dg(n,1/i,r)),n}function c6(n,e=0,t=1,r=.5,i,a=n,s=n){if(Ga.test(e)&&(e=parseFloat(e),e=on(s.min,s.max,e/100)-s.min),typeof e!="number")return;let u=on(a.min,a.max,r);n===a&&(u-=e),n.min=tA(n.min,e,t,u,i),n.max=tA(n.max,e,t,u,i)}function nA(n,e,[t,r,i],a,s){c6(n,e[t],e[r],e[i],e.scale,a,s)}const h6=["x","scaleX","originX"],f6=["y","scaleY","originY"];function rA(n,e,t,r){nA(n.x,e,h6,t?t.x:void 0,r?r.x:void 0),nA(n.y,e,f6,t?t.y:void 0,r?r.y:void 0)}function iA(n){return n.translate===0&&n.scale===1}function HD(n){return iA(n.x)&&iA(n.y)}function aA(n,e){return n.min===e.min&&n.max===e.max}function d6(n,e){return aA(n.x,e.x)&&aA(n.y,e.y)}function sA(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function GD(n,e){return sA(n.x,e.x)&&sA(n.y,e.y)}function oA(n){return Vr(n.x)/Vr(n.y)}function uA(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class p6{constructor(){this.members=[]}add(e){z1(this.members,e),e.scheduleRender()}remove(e){if(H1(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let r;for(let i=t;i>=0;i--){const a=this.members[i];if(a.isPresent!==!1){r=a;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function m6(n,e,t){let r="";const i=n.x.translate/e.x,a=n.y.translate/e.y,s=t?.z||0;if((i||a||s)&&(r=`translate3d(${i}px, ${a}px, ${s}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:h,rotate:d,rotateX:p,rotateY:g,skewX:v,skewY:b}=t;h&&(r=`perspective(${h}px) ${r}`),d&&(r+=`rotate(${d}deg) `),p&&(r+=`rotateX(${p}deg) `),g&&(r+=`rotateY(${g}deg) `),v&&(r+=`skewX(${v}deg) `),b&&(r+=`skewY(${b}deg) `)}const u=n.x.scale*e.x,c=n.y.scale*e.y;return(u!==1||c!==1)&&(r+=`scale(${u}, ${c})`),r||"none"}const d_=["","X","Y","Z"],g6=1e3;let v6=0;function p_(n,e,t,r){const{latestValues:i}=e;i[n]&&(t[n]=i[n],e.setStaticValue(n,0),r&&(r[n]=0))}function WD(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=ND(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:a}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",an,!(i||a))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&WD(r)}function qD({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(s={},u=e?.()){this.id=v6++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(b6),this.nodes.forEach(T6),this.nodes.forEach(C6),this.nodes.forEach(x6)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=s,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new i6)}addEventListener(s,u){return this.eventHandlers.has(s)||this.eventHandlers.set(s,new q1),this.eventHandlers.get(s).add(u)}notifyListeners(s,...u){const c=this.eventHandlers.get(s);c&&c.notify(...u)}hasListeners(s){return this.eventHandlers.has(s)}mount(s){if(this.instance)return;this.isSVG=oD(s)&&!uB(s),this.instance=s;const{layoutId:u,layout:c,visualElement:h}=this.options;if(h&&!h.current&&h.mount(s),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||u)&&(this.isLayoutDirty=!0),n){let d,p=0;const g=()=>this.root.updateBlockedByResize=!1;an.read(()=>{p=window.innerWidth}),n(s,()=>{const v=window.innerWidth;v!==p&&(p=v,this.root.updateBlockedByResize=!0,d&&d(),d=a6(g,250),eg.hasAnimatedSinceResize&&(eg.hasAnimatedSinceResize=!1,this.nodes.forEach(hA)))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&h&&(u||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:p,hasRelativeLayoutChanged:g,layout:v})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||h.getDefaultTransition()||N6,{onLayoutAnimationStart:E,onLayoutAnimationComplete:w}=h.getProps(),C=!this.targetLayout||!GD(this.targetLayout,v),S=!p&&g;if(this.options.layoutRoot||this.resumeFrom||S||p&&(C||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const I={...ix(b,"layout"),onPlay:E,onComplete:w};(h.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I),this.setAnimationOrigin(d,S)}else p||hA(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=v})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const s=this.getStack();s&&s.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Uo(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(S6),this.animationId++)}getTransformTemplate(){const{visualElement:s}=this.options;return s&&s.getProps().transformTemplate}willUpdate(s=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&WD(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const p=this.path[d];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:u,layout:c}=this.options;if(u===void 0&&!c)return;const h=this.getTransformTemplate();this.prevTransformTemplateValue=h?h(this.latestValues,""):void 0,this.updateSnapshot(),s&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(lA);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(cA);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(E6),this.nodes.forEach(y6),this.nodes.forEach(_6)):this.nodes.forEach(cA),this.clearAllSnapshots();const u=Zr.now();hr.delta=ks(0,1e3/60,u-hr.timestamp),hr.timestamp=u,hr.isProcessing=!0,n_.update.process(hr),n_.preRender.process(hr),n_.render.process(hr),hr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,sx.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(w6),this.sharedNodes.forEach(A6)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,an.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){an.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Vr(this.snapshot.measuredBox.x)&&!Vr(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const s=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Un(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:u}=this.options;u&&u.notify("LayoutMeasure",this.layout.layoutBox,s?s.layoutBox:void 0)}updateScroll(s="measure"){let u=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===s&&(u=!1),u&&this.instance){const c=r(this.instance);this.scroll={animationId:this.root.animationId,phase:s,isRoot:c,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const s=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,u=this.projectionDelta&&!HD(this.projectionDelta),c=this.getTransformTemplate(),h=c?c(this.latestValues,""):void 0,d=h!==this.prevTransformTemplateValue;s&&this.instance&&(u||Fu(this.latestValues)||d)&&(i(this.instance,h),this.shouldResetTransform=!1,this.scheduleRender())}measure(s=!0){const u=this.measurePageBox();let c=this.removeElementScroll(u);return s&&(c=this.removeTransform(c)),D6(c),{animationId:this.root.animationId,measuredBox:u,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:s}=this.options;if(!s)return Un();const u=s.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(k6))){const{scroll:h}=this.root;h&&(wc(u.x,h.offset.x),wc(u.y,h.offset.y))}return u}removeElementScroll(s){const u=Un();if(ta(u,s),this.scroll?.wasRoot)return u;for(let c=0;c<this.path.length;c++){const h=this.path[c],{scroll:d,options:p}=h;h!==this.root&&d&&p.layoutScroll&&(d.wasRoot&&ta(u,s),wc(u.x,d.offset.x),wc(u.y,d.offset.y))}return u}applyTransform(s,u=!1){const c=Un();ta(c,s);for(let h=0;h<this.path.length;h++){const d=this.path[h];!u&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Ec(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),Fu(d.latestValues)&&Ec(c,d.latestValues)}return Fu(this.latestValues)&&Ec(c,this.latestValues),c}removeTransform(s){const u=Un();ta(u,s);for(let c=0;c<this.path.length;c++){const h=this.path[c];if(!h.instance||!Fu(h.latestValues))continue;wb(h.latestValues)&&h.updateSnapshot();const d=Un(),p=h.measurePageBox();ta(d,p),rA(u,h.latestValues,h.snapshot?h.snapshot.layoutBox:void 0,d)}return Fu(this.latestValues)&&rA(u,this.latestValues),u}setTargetDelta(s){this.targetDelta=s,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(s){this.options={...this.options,...s,crossfade:s.crossfade!==void 0?s.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==hr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(s=!1){const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==u;if(!(s||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:p}=this.options;if(!this.layout||!(d||p))return;this.resolvedRelativeTargetAt=hr.timestamp;const g=this.getClosestProjectingParent();g&&this.linkedParentVersion!==g.layoutVersion&&!g.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(g&&g.layout?this.createRelativeTarget(g,this.layout.layoutBox,g.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Un(),this.targetWithTransforms=Un()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),jj(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ta(this.target,this.layout.layoutBox),TD(this.target,this.targetDelta)):ta(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?this.createRelativeTarget(g,this.target,g.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||wb(this.parent.latestValues)||ED(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(s,u,c){this.relativeParent=s,this.linkedParentVersion=s.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Un(),this.relativeTargetOrigin=Un(),pg(this.relativeTargetOrigin,u,c),ta(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const s=this.getLead(),u=!!this.resumingFrom||this!==s;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===hr.timestamp&&(c=!1),c)return;const{layout:h,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||d))return;ta(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;ZB(this.layoutCorrected,this.treeScale,this.path,u),s.layout&&!s.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(s.target=s.layout.layoutBox,s.targetWithTransforms=Un());const{target:v}=s;if(!v){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(eA(this.prevProjectionDelta.x,this.projectionDelta.x),eA(this.prevProjectionDelta.y,this.projectionDelta.y)),zf(this.projectionDelta,this.layoutCorrected,v,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!uA(this.projectionDelta.x,this.prevProjectionDelta.x)||!uA(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",v))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(s=!0){if(this.options.visualElement?.scheduleRender(),s){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Tc(),this.projectionDelta=Tc(),this.projectionDeltaWithTransform=Tc()}setAnimationOrigin(s,u=!1){const c=this.snapshot,h=c?c.latestValues:{},d={...this.latestValues},p=Tc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!u;const g=Un(),v=c?c.source:void 0,b=this.layout?this.layout.source:void 0,E=v!==b,w=this.getStack(),C=!w||w.members.length<=1,S=!!(E&&!C&&this.options.crossfade===!0&&!this.path.some(I6));this.animationProgress=0;let I;this.mixTargetDelta=D=>{const O=D/1e3;fA(p.x,s.x,O),fA(p.y,s.y,O),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(pg(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),R6(this.relativeTarget,this.relativeTargetOrigin,g,O),I&&d6(this.relativeTarget,I)&&(this.isProjectionDirty=!1),I||(I=Un()),ta(I,this.relativeTarget)),E&&(this.animationValues=d,o6(d,h,this.latestValues,O,S,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=O},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(s){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Uo(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=an.update(()=>{eg.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Gc(0)),this.currentAnimation=n6(this.motionValue,[0,1e3],{...s,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),s.onUpdate&&s.onUpdate(u)},onStop:()=>{},onComplete:()=>{s.onComplete&&s.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const s=this.getStack();s&&s.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(g6),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const s=this.getLead();let{targetWithTransforms:u,target:c,layout:h,latestValues:d}=s;if(!(!u||!c||!h)){if(this!==s&&this.layout&&h&&KD(this.options.animationType,this.layout.layoutBox,h.layoutBox)){c=this.target||Un();const p=Vr(this.layout.layoutBox.x);c.x.min=s.target.x.min,c.x.max=c.x.min+p;const g=Vr(this.layout.layoutBox.y);c.y.min=s.target.y.min,c.y.max=c.y.min+g}ta(u,c),Ec(u,d),zf(this.projectionDeltaWithTransform,this.layoutCorrected,u,d)}}registerSharedNode(s,u){this.sharedNodes.has(s)||this.sharedNodes.set(s,new p6),this.sharedNodes.get(s).add(u);const h=u.options.initialPromotionConfig;u.promote({transition:h?h.transition:void 0,preserveFollowOpacity:h&&h.shouldPreserveFollowOpacity?h.shouldPreserveFollowOpacity(u):void 0})}isLead(){const s=this.getStack();return s?s.lead===this:!0}getLead(){const{layoutId:s}=this.options;return s?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:s}=this.options;return s?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:s}=this.options;if(s)return this.root.sharedNodes.get(s)}promote({needsReset:s,transition:u,preserveFollowOpacity:c}={}){const h=this.getStack();h&&h.promote(this,c),s&&(this.projectionDelta=void 0,this.needsReset=!0),u&&this.setOptions({transition:u})}relegate(){const s=this.getStack();return s?s.relegate(this):!1}resetSkewAndRotation(){const{visualElement:s}=this.options;if(!s)return;let u=!1;const{latestValues:c}=s;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(u=!0),!u)return;const h={};c.z&&p_("z",s,h,this.animationValues);for(let d=0;d<d_.length;d++)p_(`rotate${d_[d]}`,s,h,this.animationValues),p_(`skew${d_[d]}`,s,h,this.animationValues);s.render();for(const d in h)s.setStaticValue(d,h[d]),this.animationValues&&(this.animationValues[d]=h[d]);s.scheduleRender()}applyProjectionStyles(s,u){if(!this.instance||this.isSVG)return;if(!this.isVisible){s.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,s.visibility="",s.opacity="",s.pointerEvents=Jm(u?.pointerEvents)||"",s.transform=c?c(this.latestValues,""):"none";return}const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){this.options.layoutId&&(s.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,s.pointerEvents=Jm(u?.pointerEvents)||""),this.hasProjected&&!Fu(this.latestValues)&&(s.transform=c?c({},""):"none",this.hasProjected=!1);return}s.visibility="";const d=h.animationValues||h.latestValues;this.applyTransformsToTarget();let p=m6(this.projectionDeltaWithTransform,this.treeScale,d);c&&(p=c(d,p)),s.transform=p;const{x:g,y:v}=this.projectionDelta;s.transformOrigin=`${g.origin*100}% ${v.origin*100}% 0`,h.animationValues?s.opacity=h===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:s.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const b in xb){if(d[b]===void 0)continue;const{correct:E,applyTo:w,isCSSVariable:C}=xb[b],S=p==="none"?d[b]:E(d[b],h);if(w){const I=w.length;for(let D=0;D<I;D++)s[w[D]]=S}else C?this.options.visualElement.renderState.vars[b]=S:s[b]=S}this.options.layoutId&&(s.pointerEvents=h===this?Jm(u?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(s=>s.currentAnimation?.stop()),this.root.nodes.forEach(lA),this.root.sharedNodes.clear()}}}function y6(n){n.updateLayout()}function _6(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=n.layout,{animationType:i}=n.options,a=e.source!==n.layout.source;i==="size"?Mi(d=>{const p=a?e.measuredBox[d]:e.layoutBox[d],g=Vr(p);p.min=t[d].min,p.max=p.min+g}):KD(i,e.layoutBox,t)&&Mi(d=>{const p=a?e.measuredBox[d]:e.layoutBox[d],g=Vr(t[d]);p.max=p.min+g,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[d].max=n.relativeTarget[d].min+g)});const s=Tc();zf(s,t,e.layoutBox);const u=Tc();a?zf(u,n.applyTransform(r,!0),e.measuredBox):zf(u,t,e.layoutBox);const c=!HD(s);let h=!1;if(!n.resumeFrom){const d=n.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:p,layout:g}=d;if(p&&g){const v=Un();pg(v,e.layoutBox,p.layoutBox);const b=Un();pg(b,t,g.layoutBox),GD(v,b)||(h=!0),d.options.layoutRoot&&(n.relativeTarget=b,n.relativeTargetOrigin=v,n.relativeParent=d)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:u,layoutDelta:s,hasLayoutChanged:c,hasRelativeLayoutChanged:h})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function b6(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function x6(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function w6(n){n.clearSnapshot()}function lA(n){n.clearMeasurements()}function cA(n){n.isLayoutDirty=!1}function E6(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function hA(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function T6(n){n.resolveTargetDelta()}function C6(n){n.calcProjection()}function S6(n){n.resetSkewAndRotation()}function A6(n){n.removeLeadSnapshot()}function fA(n,e,t){n.translate=on(e.translate,0,t),n.scale=on(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function dA(n,e,t,r){n.min=on(e.min,t.min,r),n.max=on(e.max,t.max,r)}function R6(n,e,t,r){dA(n.x,e.x,t.x,r),dA(n.y,e.y,t.y,r)}function I6(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const N6={duration:.45,ease:[.4,0,.1,1]},pA=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),mA=pA("applewebkit/")&&!pA("chrome/")?Math.round:ji;function gA(n){n.min=mA(n.min),n.max=mA(n.max)}function D6(n){gA(n.x),gA(n.y)}function KD(n,e,t){return n==="position"||n==="preserve-aspect"&&!Bj(oA(e),oA(t),.2)}function k6(n){return n!==n.root&&n.scroll?.wasRoot}const M6=qD({attachResizeListener:(n,e)=>ad(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),m_={current:void 0},XD=qD({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!m_.current){const n=new M6({});n.mount(window),n.setOptions({layoutScroll:!0}),m_.current=n}return m_.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),O6={pan:{Feature:e6},drag:{Feature:Jj,ProjectionNode:XD,MeasureLayout:jD}};function vA(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,a=r[i];a&&an.postRender(()=>a(e,Dd(e)))}class P6 extends Zo{mount(){const{current:e}=this.node;e&&(this.unmount=rB(e,(t,r)=>(vA(this.node,r,"Start"),i=>vA(this.node,i,"End"))))}unmount(){}}class F6 extends Zo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Rd(ad(this.node.current,"focus",()=>this.onFocus()),ad(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function yA(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),a=r[i];a&&an.postRender(()=>a(e,Dd(e)))}class V6 extends Zo{mount(){const{current:e}=this.node;e&&(this.unmount=oB(e,(t,r)=>(yA(this.node,r,"Start"),(i,{success:a})=>yA(this.node,i,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ib=new WeakMap,g_=new WeakMap,L6=n=>{const e=Ib.get(n.target);e&&e(n)},B6=n=>{n.forEach(L6)};function j6({root:n,...e}){const t=n||document;g_.has(t)||g_.set(t,{});const r=g_.get(t),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(B6,{root:n,...e})),r[i]}function U6(n,e,t){const r=j6(e);return Ib.set(n,t),r.observe(n),()=>{Ib.delete(n),r.unobserve(n)}}const z6={some:0,all:1};class H6 extends Zo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:i="some",once:a}=e,s={root:t?t.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:z6[i]},u=c=>{const{isIntersecting:h}=c;if(this.isInView===h||(this.isInView=h,a&&!h&&this.hasEnteredView))return;h&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",h);const{onViewportEnter:d,onViewportLeave:p}=this.node.getProps(),g=h?d:p;g&&g(c)};return U6(this.node.current,s,u)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(G6(e,t))&&this.startObserver()}unmount(){}}function G6({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const W6={inView:{Feature:H6},tap:{Feature:V6},focus:{Feature:F6},hover:{Feature:P6}},q6={layout:{ProjectionNode:XD,MeasureLayout:jD}},K6={...Mj,...W6,...O6,...q6},Pe=YB(K6,uj);var YD=function(n,e){return(YD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function ha(n,e){function t(){this.constructor=n}YD(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ve(n,e,t,r){return new(t||(t=Promise))((function(i,a){function s(h){try{c(r.next(h))}catch(d){a(d)}}function u(h){try{c(r.throw(h))}catch(d){a(d)}}function c(h){h.done?i(h.value):new t((function(d){d(h.value)})).then(s,u)}c((r=r.apply(n,[])).next())}))}function Le(n,e){var t,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(h){return(function(d){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(i=2&d[0]?r.return:d[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,d[1])).done)return i;switch(r=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return s.label++,{value:d[1],done:!1};case 5:s.label++,r=d[1],d=[0];continue;case 7:d=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){s=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){s.label=d[1];break}if(d[0]===6&&s.label<i[1]){s.label=i[1],i=d;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(d);break}i[2]&&s.ops.pop(),s.trys.pop();continue}d=e.call(n,s)}catch(p){d=[6,p],r=0}finally{t=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}})([c,h])}}}var X6=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(a){for(var s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];return Y6(r,s[0],s[1]),s.join("=")})),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach((function(a){var s=a.split(":"),u=s[0],c=s[1];e.urlFlags[u]=(function(h,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+h+".")})(u,c)}))}},n})();function Y6(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function ge(){return $D}var $D=null,mg=new Map,Nb=new Map;function QD(n,e){var t=JD(n,e);return mg.get(t)}function $6(n){return Nb.get(n)}function _A(n){for(var e=mg.entries(),t=[];;){var r=e.next(),i=r.done,a=r.value;if(i)break;var s=a[0],u=a[1];s.split("_")[0]===n&&t.push(u)}return t}function ZD(n){var e=n.kernelName,t=n.backendName,r=JD(e,t);if(mg.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");mg.set(r,n)}function Q6(n){var e=n.kernelName;Nb.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),Nb.set(e,n)}function JD(n,e){return e+"_"+n}function Db(n,e,t){return Math.max(n,Math.min(e,t))}function ek(n){return n%2==0?n:n+1}function Z6(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function G(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ft(n,e,t){t===void 0&&(t=""),G(rr(n,e),(function(){return t+" Shapes "+n+" and "+e+" must match"}))}function lh(n){G(n!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function qc(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||Wa(n)&&!t)for(var r=0;r<n.length;++r)qc(n[r],e,t);else e.push(n);return e}function je(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function rr(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function bn(n){return n%1==0}function J6(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function kb(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Nc(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function bA(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise((function(r,i){var a=0,s=function(){if(n())r();else{a++;var u=e(a);t!=null&&a>=t?i():setTimeout(s,u)}};s()}))}function e5(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var a=n.slice();return a[r]=e/t,a}function Kn(n,e){var t=e.length;return G((n=n==null?e.map((function(r,i){return i})):[].concat(n)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n})),G(n.every((function(r){return bn(r)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(r){return r<0?t+r:r}))}function Uu(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||i?null:Kn(e,n).sort(),s=0,u=0;u<n.length;++u){if(a!=null){if(a[s]===u&&n[u]!==1)throw new Error("Can't squeeze axis "+u+" since its dim '"+n[u]+"' is not 1");(a[s]==null||a[s]>u)&&n[u]===1&&(t.push(n[u]),r.push(u)),a[s]<=u&&s++}n[u]!==1&&(t.push(n[u]),r.push(u))}return{newShape:t,keptDims:r}}function sd(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function gg(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function t5(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function n5(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function r5(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Wa(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function tk(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function i5(n){if(n==null)return 0;var e=0;return n.forEach((function(t){return e+=t.length})),e}function yx(n){return typeof n=="string"||n instanceof String}function a5(n){return typeof n=="boolean"}function s5(n){return typeof n=="number"}function kd(n){return Array.isArray(n)?kd(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":s5(n)?"float32":yx(n)?"string":a5(n)?"bool":"float32"}function Mb(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Ob(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function qa(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function nk(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=qc(n)),t&&t5(n,e),(function(a,s){return a instanceof Float32Array&&s==="float32"||a instanceof Int32Array&&s==="int32"||a instanceof Uint8Array&&s==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function xA(n,e){if(n.length===0)return e[0];var t=n.reduce((function(r,i){return r*i}));if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(i,a,s){var u=new Array;if(a.length===1)for(var c=a[0],h=0;h<c;h++)u[h]=s[i+h];else{c=a[0];var d=a.slice(1),p=d.reduce((function(g,v){return g*v}));for(h=0;h<c;h++)u[h]=r(i+h*p,d,s)}return u})(0,n,e)}function rk(n,e){for(var t=Md(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Md(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function La(){return ge().platform.now()}function ik(n){n.forEach((function(e){G(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function o5(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ge().platform.encode(n,e)}function vg(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ge().platform.decode(n,e)}function wA(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function u5(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var l5=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new c5)}return n.prototype.profileKernel=function(e,t,r){var i,a=this,s=this.backendTimer.time((function(){i=r()}));return i.forEach((function(u){u.data().then((function(c){(function(h,d,p){if(d!=="float32")return!1;for(var g=0;g<h.length;g++){var v=h[g];if(isNaN(v)||!isFinite(v))return console.warn("Found "+v+" in the result of '"+p+"'"),!0}})(c,u.dtype,e),s.then((function(h){var d="";h.getExtraProfileInfo!=null&&(d=h.getExtraProfileInfo()),a.logger.logKernelProfile(e,u,c,h.kernelMs,t,d)}))}))})),i},n})(),c5=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,a,s){var u=typeof i=="number"?Nc(i+"ms",9):i.error,c=Nc(e,25),h=t.rank,d=t.size,p=Nc(t.shape.toString(),14),g="";for(var v in a){var b=a[v].shape||t.shape,E=b.length;g+=v+": "+E+"D "+(E>0?b:"")+" "}console.log("%c"+c+"	%c"+u+"	%c"+h+"D "+p+"	%c"+d+"	%c"+g+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n})(),EA=20,Sf=3,v_=7;function h5(n,e,t,r){var i=qa(e),a=(function(h,d,p,g){var v=je(d),b=g[g.length-1],E=new Array(b).fill(0),w=d.length,C=p==="complex64"?Rf(h):h;if(w>1)for(var S=0;S<v/b;S++)for(var I=S*b,D=0;D<b;D++)E[D]=Math.max(E[D],Af(C[I+D],0,p).length);return E})(n,e,t,i),s=e.length,u=(function h(d,p,g,v,b,E){E===void 0&&(E=!0);var w=g==="complex64"?2:1,C=p[0],S=p.length;if(S===0)return g==="complex64"?[Af(Rf(d)[0],0,g)]:g==="bool"?[ak(d[0])]:[d[0].toString()];if(S===1){if(C>EA){var I=Sf*w,D=Array.from(d.slice(0,I)),O=Array.from(d.slice((C-Sf)*w,C*w));return g==="complex64"&&(D=Rf(D),O=Rf(O)),["["+D.map((function(ne,q){return Af(ne,b[q],g)})).join(", ")+", ..., "+O.map((function(ne,q){return Af(ne,b[C-Sf+q],g)})).join(", ")+"]"]}return["["+(g==="complex64"?Rf(d):Array.from(d)).map((function(ne,q){return Af(ne,b[q],g)})).join(", ")+"]"]}var B=p.slice(1),N=v.slice(1),R=v[0]*w,k=[];if(C>EA){for(var P=0;P<Sf;P++){var V=(j=P*R)+R;k.push.apply(k,h(d.slice(j,V),B,g,N,b,!1))}for(k.push("..."),P=C-Sf;P<C;P++)V=(j=P*R)+R,k.push.apply(k,h(d.slice(j,V),B,g,N,b,P===C-1))}else for(P=0;P<C;P++){var j;V=(j=P*R)+R,k.push.apply(k,h(d.slice(j,V),B,g,N,b,P===C-1))}var L=S===2?",":"";for(k[0]="["+k[0]+L,P=1;P<k.length-1;P++)k[P]=" "+k[P]+L;var Z=`,
`;for(P=2;P<S;P++)Z+=`
`;return k[k.length-1]=" "+k[k.length-1]+"]"+(E?"":Z),k})(n,e,t,i,a),c=["Tensor"];return r&&(c.push("  dtype: "+t),c.push("  rank: "+s),c.push("  shape: ["+e+"]"),c.push("  values:")),c.push(u.map((function(h){return"    "+h})).join(`
`)),c.join(`
`)}function Af(n,e,t){return Nc(Array.isArray(n)?parseFloat(n[0].toFixed(v_))+" + "+parseFloat(n[1].toFixed(v_))+"j":yx(n)?"'"+n+"'":t==="bool"?ak(n):parseFloat(n.toFixed(v_)).toString(),e)}function ak(n){return n===0?"false":"true"}function Rf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var od=(function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=je(e),r!=null){var a=r.length;G(a===this.size,(function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+i.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||gg(t,this.size),this.strides=qa(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),G(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var a=this.locToIndex(r);this.values[a]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,a=e;i<a.length;i++){var s=a[i];if(s<0||s>=this.shape[r]){var u="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(u)}r++}for(var c=e[e.length-1],h=0;h<e.length-1;++h)c+=this.strides[h]*e[h];return this.values[c]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Ba().makeTensor(this.values,this.shape,this.dtype)},n})(),Ba=null,pe=null,sk=null,sn=(function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=je(e),this.strides=qa(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),G(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,a){return this.throwIfDisposed(),this.reshape([e,t,r,i,a])},n.prototype.asType=function(e){return this.throwIfDisposed(),pe.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Ve(this,void 0,void 0,(function(){var e;return Le(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,pe.buffer(this.shape,this.dtype,e)]}}))}))},n.prototype.bufferSync=function(){return pe.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ve(this,void 0,void 0,(function(){var e;return Le(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,xA(this.shape,e)]}}))}))},n.prototype.arraySync=function(){return xA(this.shape,this.dataSync())},n.prototype.data=function(){return Ve(this,void 0,void 0,(function(){var e,t;return Le(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Ba().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map((function(i){return vg(i)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var e=Ba().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return vg(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Ve(this,void 0,void 0,(function(){var e;return Le(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Ba().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(Ba().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),pe.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),pe.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),pe.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),pe.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),pe.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),pe.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),pe.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),h5(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),pe.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),pe.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),pe.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),pe.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),pe.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),pe.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),pe.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),pe.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),pe.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),pe.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),pe.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),pe.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,a){return r===void 0&&(r=.001),sk("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,i,r)},n.prototype.batchNorm=function(e,t,r,i,a){return a===void 0&&(a=.001),this.throwIfDisposed(),pe.batchNorm(this,e,t,r,i,a)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),pe.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),pe.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),pe.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),pe.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),pe.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),pe.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),pe.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),pe.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),pe.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),pe.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),pe.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),pe.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),pe.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),pe.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),pe.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),pe.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),pe.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),pe.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),pe.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),pe.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),pe.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),pe.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),pe.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),pe.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),pe.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),pe.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),pe.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),pe.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),pe.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),pe.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),pe.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),pe.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),pe.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),pe.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),pe.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),pe.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),pe.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),pe.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),pe.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),pe.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),pe.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),pe.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),pe.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),pe.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),pe.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),pe.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),pe.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),pe.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),pe.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),pe.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),pe.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),pe.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),pe.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),pe.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),pe.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),pe.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),pe.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),pe.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),pe.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),pe.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),pe.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),pe.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),pe.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),pe.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),pe.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),pe.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),pe.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),pe.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),pe.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),pe.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),pe.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),pe.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),pe.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),pe.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),pe.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),pe.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),pe.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),pe.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),pe.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),pe.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),pe.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),pe.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),pe.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),pe.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),pe.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),pe.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),pe.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),pe.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),pe.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,a,s){return i===void 0&&(i="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),pe.conv1d(this,e,t,r,i,a,s)},n.prototype.conv2d=function(e,t,r,i,a,s){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),pe.conv2d(this,e,t,r,i,a,s)},n.prototype.conv2dTranspose=function(e,t,r,i,a){return this.throwIfDisposed(),pe.conv2dTranspose(this,e,t,r,i,a)},n.prototype.depthwiseConv2D=function(e,t,r,i,a,s){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),pe.depthwiseConv2d(this,e,t,r,i,a,s)},n.prototype.separableConv2d=function(e,t,r,i,a,s){return a===void 0&&(a=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),pe.separableConv2d(this,e,t,r,i,a,s)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),pe.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),pe.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),pe.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,a){return this.throwIfDisposed(),pe.pool(this,e,t,r,i,a)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Ba().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),pe.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),pe.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),pe.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),pe.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,a,s,u,c){return i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),c===void 0&&(c=0),this.throwIfDisposed(),pe.stridedSlice(this,e,t,r,i,a,s,u,c)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),pe.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),pe.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),pe.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),pe.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),pe.spectral.irfft(this)},n})();Object.defineProperty(sn,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var TA,Pb,Fb,Vb,Lb,Kc=(function(n){function e(t,r,i,a){var s=n.call(this,t.shape,t.dtype,t.dataId,a)||this;return s.trainable=r,s.name=i,s}return ha(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!rr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ba().disposeTensor(this),this.dataId=t.dataId,Ba().incRef(this,null)},e.prototype.dispose=function(){Ba().disposeVariable(this),this.isDisposedInternal=!0},e})(sn);Object.defineProperty(Kc,Symbol.hasInstance,{value:function(n){return n instanceof sn&&n.assign!=null&&n.assign instanceof Function}}),(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(TA||(TA={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Pb||(Pb={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Fb||(Fb={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Vb||(Vb={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Lb||(Lb={}));var f5={float32:Vb,int32:Pb,bool:Fb,complex64:Lb};function dr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return f5[n][e]}function y_(n){return dr(n,"int32")}function ln(n,e){if(n.dtype===e.dtype)return[n,e];var t=dr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function d5(n,e){G(n.dtype===e.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"}))}function ok(n){var e=[];return(function t(r,i,a){if(r!=null){if(r instanceof sn)return void i.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,u=r;for(var c in u){var h=u[c];a.has(h)||(a.add(h),t(h,i,a))}}}})(n,e,new Set),e}var __,CA=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),p5=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new CA}return n.prototype.ready=function(){return Ve(this,void 0,void 0,(function(){var e,t,r;return Le(this,(function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Ve(this,void 0,void 0,(function(){var t,r,i;return Le(this,(function(a){switch(a.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=a.sent(),[3,3];case 2:i=r,a.label=3;case 3:if(!i)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new l5(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var e=this;_A(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(e){var t=this;_A(e).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])}))},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var a=++this.pendingBackendInitId,s=i.then((function(u){return!(a<t.pendingBackendInitId)&&(t.registry[e]=u,t.pendingBackendInit=null,!0)})).catch((function(u){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),!1)}));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(u){return console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),a=i.success,s=i.asyncInit;if(s||a)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,a=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,a,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return i.startScope(a)}),(function(){return i.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(a){throw t(),a}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(i){return{x:function(){return i.toFloat()}}}),[]),t},n.prototype.runKernel=function(e,t,r,i,a){return this.runKernelFunc(null,t,null,e,r,i,a)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),a=0;r.forEach((function(c){a+=c.dtype==="complex64"?3:1}));var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=i-t-a-s;if(u>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+u+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,a,s,u){var c,h=this;s===void 0&&(s=[]),u===void 0&&(u=[]);var d=[],p=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var g,v=function(S){p&&(d=S.map((function(I){return h.keep(h.clone(I))})))},b=this.state.numBytes,E=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var w,C=QD(i,this.backendName);return g=C!=null?function(){var S=h.backend.numDataIds();w=C.kernelFunc({inputs:t,attrs:a,backend:h.backend});var I=Array.isArray(w)?w:[w];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(i,S,I);var D=I.map((function(B){var N=B.dataId,R=B.shape,k=B.dtype;return h.makeTensorFromDataId(N,R,k)})),O=D.filter((function(B,N){return u[N]}));return v((s||[]).slice().concat(O)),D}:function(){var S=h.backend.numDataIds();w=h.tidy((function(){return e(h.backend,v)}));var I=Array.isArray(w)?w:[w];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(i,S,I),I},this.scopedRun((function(){return h.state.kernelDepth++}),(function(){return h.state.kernelDepth--}),(function(){c=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(i,t,(function(){return g()})):g()})),p&&this.addTapeNode(i,t,c,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-b,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-E,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(S){return t[S].shape})),outputShapes:c.map((function(S){return S.shape}))}),Array.isArray(w)?c:c[0]},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var a=e;r==="string"&&yx(e[0])&&(a=e.map((function(d){return o5(d)})));var s=i.write(a,t,r),u=new sn(t,r,s,this.nextTensorId());if(this.incRef(u,i),r==="string"){var c=this.state.tensorInfo.get(s),h=i5(a);this.state.numBytes+=h-c.bytes,c.bytes=h}return u},n.prototype.makeTensorFromDataId=function(e,t,r,i){var a=new sn(t,r=r||"float32",e,this.nextTensorId());return this.incRef(a,i),a},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var a=new Kc(e,t,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*tk(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Kc||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Ve(this,void 0,void 0,(function(){var t,r;return Le(this,(function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(a){return a.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,a){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:a},c=$6(e);c!=null&&(i=c.gradFunc),i!=null&&(u.gradient=function(h){return h=h.map((function(d,p){if(d==null){var g=r[p],v=Md(g.size,g.dtype);return s.makeTensor(v,g.shape,g.dtype)}return d})),i(h.length>1?h:h[0],a)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=ok(e),i=new Set(r.map((function(c){return c.id}))),a=0;a<this.state.activeScope.track.length;a++){var s=this.state.activeScope.track[a];s.kept||i.has(s.id)||s.dispose()}var u=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(c){c.kept||c.scopeId!==u.id||t.track(c)}))},n.prototype.gradients=function(e,t,r,i){var a=this;if(i===void 0&&(i=!1),G(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));G(s instanceof sn,(function(){return"The result y returned by f() must be a tensor."}));var u=(function(c,h,d){for(var p={},g={},v=0;v<h.length;v++)p[h[v].id]=!0;for(v=0;v<c.length;v++){var b=(B=c[v]).inputs;for(var E in b){for(var w=b[E],C=!1,S=0;S<h.length;S++)if(p[w.id]){B.outputs.forEach((function(P){return p[P.id]=!0})),C=!0,g[B.id]=!0;break}if(C)break}}var I={};I[d.id]=!0;var D={};for(v=c.length-1;v>=0;v--)for(b=(B=c[v]).inputs,S=0;S<B.outputs.length;S++)if(I[B.outputs[S].id]){for(var E in b)I[b[E].id]=!0,D[B.id]=!0;break}var O=[];for(v=0;v<c.length;v++){var B;if(g[(B=c[v]).id]&&D[B.id]){var N={};for(var E in B.inputs){var R=B.inputs[E];p[R.id]&&(N[E]=R)}var k=Object.assign({},B);k.inputs=N,k.outputs=B.outputs,O.push(k)}}return O})(this.state.activeTape,t,s);if(!i&&u.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var c,h,d={};d[s.id]=r??(c=s.shape,h=rk(je(c),"float32"),J.makeTensor(h,c,"float32")),(function(g,v,b){for(var E=function(C){var S=v[C],I=[];if(S.outputs.forEach((function(N){var R=g[N.id];R!=null?I.push(R):I.push(null)})),S.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+S.kernelName+".");var D=S.gradient(I),O=function(N){if(!(N in D))throw new Error("Cannot backprop through input "+N+". Available gradients found: "+Object.keys(D)+".");var R=b((function(){return D[N]()}));if(R.dtype!=="float32")throw new Error("Error in gradient for op "+S.kernelName+". The gradient of input "+N+" must have 'float32' dtype, but has '"+R.dtype+"'");var k=S.inputs[N];if(!rr(R.shape,k.shape))throw new Error("Error in gradient for op "+S.kernelName+". The gradient of input '"+N+"' has shape '"+R.shape+"', which does not match the shape of the input '"+k.shape+"'");if(g[k.id]==null)g[k.id]=R;else{var P=g[k.id];g[k.id]=P.add(R),P.dispose()}};for(var B in S.inputs)O(B)},w=v.length-1;w>=0;w--)E(w)})(d,u,(function(g){return a.tidy(g)}));var p=t.map((function(g){return d[g.id]}));return a.state.gradientDepth===0&&(a.state.activeTape.forEach((function(g){for(var v=0,b=g.saved;v<b.length;v++)b[v].dispose()})),a.state.activeTape=null),{value:s,grads:p}}))},n.prototype.customGrad=function(e){var t=this;return G(Mb(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];G(i.every((function(u){return u instanceof sn})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var s={};return i.forEach((function(u,c){s[c]=u})),t.runKernelFunc((function(u,c){return G((r=e.apply(void 0,i.concat([c]))).value instanceof sn,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),G(Mb(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),s,(function(u,c){var h=r.gradFunc(u,c),d=Array.isArray(h)?h:[h];G(d.length===i.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),G(d.every((function(g){return g instanceof sn})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var p={};return d.forEach((function(g,v){p[v]=function(){return g}})),p}))}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Ve(this,void 0,void 0,(function(){var t,r;return Le(this,(function(i){switch(i.label){case 0:return t=La(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=La()-t,[2,r]}}))}))},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new CA,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),J=(function(){var n=(function(){if(__==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}__=t}return __})();if(n._tfengine==null){var e=new X6(n);n._tfengine=new p5(e)}return(function(t){$D=t})(n._tfengine.ENV),Ba=function(){return n._tfengine},n._tfengine})();function uk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ts=ge();Ts.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ts.registerFlag("IS_BROWSER",(function(){return uk()})),Ts.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Ts.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ts.registerFlag("PROD",(function(){return!1})),Ts.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ts.getBool("DEBUG")})),Ts.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ts.registerFlag("IS_TEST",(function(){return!1}));var ud,pi,di,Vu={},b_={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function m5(n,e){Vu[n]=e}function es(n){n in Vu||(Vu[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(i){i.preventDefault(),delete Vu[t]}),!1),t===1?r.getContext("webgl",b_)||r.getContext("experimental-webgl",b_):r.getContext("webgl2",b_)})(n));var e=Vu[n];return e.isContextLost()?(delete Vu[n],es(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Vu[n])}function fv(n,e){return[e,n]}function Hf(n){var e=je(n);return kb(Math.ceil(e/4))}function Od(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function _x(n,e){var t,r,i,a,s,u,c,h,d,p=n;return ge().getNumber("WEBGL_VERSION")===2?(t=p.R32F,r=p.R16F,i=p.RGBA16F,a=p.RGBA32F,s=p.RED,u=4,c=1,h=p.HALF_FLOAT,d=p.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,a=p.RGBA,s=n.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}function Ue(n,e,t){var r=t();return e&&(function(i){var a=i.getError();if(a!==i.NO_ERROR)throw new Error("WebGL Error: "+_5(i,a))})(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(ud||(ud={})),(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(pi||(pi={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(di||(di={}));var g5=596e-10,v5=65504;function y5(n){return!!(ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||g5<Math.abs(n)&&Math.abs(n)<v5)}function _5(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Im(n,e,t){return Bs(n,e,(function(){return n.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function b5(n,e,t){var r=Bs(n,e,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Ue(n,e,(function(){return n.shaderSource(r,t)})),Ue(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function x5(n,e,t){var r=Bs(n,e,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Ue(n,e,(function(){return n.shaderSource(r,t)})),Ue(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(i,a){var s=w5.exec(a);if(s==null)return console.log("Couldn't parse line number in error: "+a),void console.log(i);for(var u=+s[1],c=i.split(`
`),h=c.length.toString().length+2,d=c.map((function(w,C){return Nc((C+1).toString(),h)+w})),p=0,g=0;g<d.length;g++)p=Math.max(d[g].length,p);var v=d.slice(0,u-1),b=d.slice(u-1,u),E=d.slice(u);console.log(v.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Nc(b[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(E.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var x_,w_,w5=/ERROR: [0-9]+:([0-9]+):/g;function E5(n,e){return Bs(n,e,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function T5(n,e,t){if(Ue(n,e,(function(){return n.linkProgram(t)})),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function E_(n,e,t){if(Ue(n,e,(function(){return n.validateProgram(t)})),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function C5(n,e,t){var r=Bs(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Ue(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),Ue(n,e,(function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function S5(n,e,t){var r=Bs(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Ue(n,e,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)})),Ue(n,e,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function A5(n,e){return Bs(n,e,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function R5(n,e){var t=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function I5(n,e){return Bs(n,e,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function SA(n,e,t,r,i,a,s,u){var c=n.getAttribLocation(t,r);return c!==-1&&(Ue(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,i)})),Ue(n,e,(function(){return n.vertexAttribPointer(c,a,n.FLOAT,!1,s,u)})),Ue(n,e,(function(){return n.enableVertexAttribArray(c)})),!0)}function N5(n,e,t,r){P5(n,r),Ue(n,e,(function(){return n.activeTexture(n.TEXTURE0+r)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)}))}function D5(n,e,t,r){return Bs(n,e,(function(){return n.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function k5(n,e,t){return n.getUniformLocation(e,t)}function M5(n,e,t,r,i,a){Ue(n,e,(function(){return N5(n,e,r,a)})),Ue(n,e,(function(){return n.uniform1i(i,a)}))}function T_(n,e,t,r){Ue(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),Ue(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}))}function AA(n,e,t){Ue(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)})),Ue(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function Nm(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+O5(n,e))}function O5(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Bs(n,e,t,r){var i=Ue(n,e,(function(){return t()}));if(i==null)throw new Error(r);return i}function P5(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function yg(n,e){return e===void 0&&(e=2),je(n.slice(0,n.length-e))}function _g(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function C_(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[yg(n)].concat(_g(n))),e}function F5(n,e){var t;e===void 0&&(e=!1);var r=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map((function(h,d){return d>=n.length-2?ek(n[d]):n[d]}))).length===1&&(n=[2,n[0]])),n.length!==2){var i=Uu(n);n=i.newShape}var a=je(n);if(n.length<=1&&a<=r)return[1,a];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var s=yg(n),u=2,c=2;return n.length&&(u=(t=_g(n))[0],c=t[1]),kb(a=s*(u/2)*(c/2)).map((function(h){return 2*h}))}return kb(a)}function Dm(n){return n%2==0}function km(n,e){if(rr(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Dm(t)&&Dm(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Dm(n[0])&&Dm(e[0])}function V5(n){if(x_==null){var e=es(n);x_=e.getParameter(e.MAX_TEXTURE_SIZE)}return x_}function L5(n){if(w_==null){var e=es(n);w_=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,w_)}function B5(n){if(n===0)return 0;var e=es(n);return Li(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Li(e,"EXT_disjoint_timer_query")?1:0}function Li(n,e){return n.getExtension(e)!=null}function RA(n){try{if(es(n)!=null)return!0}catch{return!1}return!1}function j5(n){if(n===0)return!1;var e=es(n);if(n===1){if(!Li(e,"OES_texture_float"))return!1}else if(!Li(e,"EXT_color_buffer_float"))return!1;return Bb(e)}function U5(n){if(n===0)return!1;var e=es(n);if(n!==1){if(Li(e,"EXT_color_buffer_float"))return Bb(e);if(Li(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(r,i){var a=_x(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var u=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,u),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(u),c})(e,t)}return!1}return!!Li(e,"OES_texture_float")&&!!Li(e,"WEBGL_color_buffer_float")&&Bb(e)}function Bb(n){var e=_x(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function z5(n){return n===2&&es(n).fenceSync!=null}var Je=ge();function lk(n){ge().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Me(n,e){return J.tidy(n,e)}function ei(n){ok(n).forEach((function(e){return e.dispose()}))}function H5(n){return J.keep(n)}function bg(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];ge().getBool("IS_TEST")||console.warn.apply(console,n)}function Jo(n,e){var t=n;if(Wa(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Wa(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&ge().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function i(a,s,u){if(u=u||[],!Array.isArray(a)&&!Wa(a))return void G(s.length===0,(function(){return"Element arr["+u.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"}));G(s.length>0,(function(){return"Element arr["+u.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"})),G(a.length===s[0],(function(){return"Element arr["+u.join("][")+"] should have "+s[0]+" elements, but has "+a.length+" elements"}));for(var c=s.slice(1),h=0;h<a.length;++h)i(a[h],c,u.concat(h))})(n,r,[]),r}function IA(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function z(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof sn)return IA(r,n.dtype,e,t),n;var i=kd(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),IA(r,i,e,t),n==null||!Wa(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var a=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+a+"'")}var s=Jo(n,i);Wa(n)||Array.isArray(n)||(n=[n]);var u=i!=="string"?nk(n,i,ge().getBool("DEBUG")):qc(n,[],!0);return J.makeTensor(u,s,i)}function xg(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(i,a){return z(i,e+"["+a+"]",t)}),r)}function ck(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function G5(n,e,t){for(var r=n.length+e.length,i=[],a=0,s=0,u=0;u<r;u++)t.indexOf(u)===-1?i.push(n[a++]):i.push(e[s++]);return i}function wr(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map((function(a){return n[a]}))]}function ti(n,e){return G5(n,e.map((function(t){return 1})),e)}function fi(n,e,t){G(ck(e,t),(function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function ts(n,e){if(ck(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach((function(i){return t.push(i)})),t}function bx(n){return n.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function ns(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function W5(n,e){var t=n[0].length;n.forEach((function(i,a){G(i.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+t+")"}))})),G(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=n[0];n.forEach((function(i,a){for(var s=0;s<t;s++)G(s===e||i[s]===r[s],(function(){return"Error in concat"+t+"D: Shape of tensors["+a+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."}))}))}function Xc(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function Y(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];J.startScope(t);try{var u=r.apply(void 0,a);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),J.endScope(u),u}catch(c){throw J.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Je.registerFlag("HAS_WEBGL",(function(){return Je.getNumber("WEBGL_VERSION")>0})),Je.registerFlag("WEBGL_VERSION",(function(){return RA(2)?2:RA(1)?1:0})),Je.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return Je.get("WEBGL_VERSION")===2})),Je.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Je.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Je.registerFlag("WEBGL_PACK",(function(){return Je.getBool("HAS_WEBGL")})),Je.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_PACK_CLIP",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Je.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_PACK_REDUCE",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_CONV_IM2COL",(function(){return Je.getBool("WEBGL_PACK")})),Je.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return V5(Je.getNumber("WEBGL_VERSION"))})),Je.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return L5(Je.getNumber("WEBGL_VERSION"))})),Je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=Je.getNumber("WEBGL_VERSION");return n===0?0:B5(n)})),Je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Je.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),Je.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return j5(Je.getNumber("WEBGL_VERSION"))})),Je.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Je.getBool("WEBGL_FORCE_F16_TEXTURES")&&Je.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Je.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return U5(Je.getNumber("WEBGL_VERSION"))})),Je.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return z5(Je.getNumber("WEBGL_VERSION"))})),Je.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Je.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),sk=lk;var fr=Y({complex_:function(n,e){var t=z(n,"real","complex"),r=z(e,"imag","complex");return Ft(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),J.runKernelFunc((function(i){return i.complex(t,r)}),{$real:t,$imag:r})}}),Pi=Y({real_:function(n){var e=z(n,"input","real");return J.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),ja=Y({imag_:function(n){var e=z(n,"input","imag");return J.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function pr(n,e,t){return eu(n,e,Jo(n,t),t)}function eu(n,e,t,r){if(r==null&&(r=kd(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Wa(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ik(e);var i=je(e),a=je(t);G(i===a,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a}));for(var s=0;s<t.length;++s){var u=t[s],c=s!==t.length-1||u!==je(e.slice(s));G(t[s]===e[s]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return Wa(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?nk(n,r,ge().getBool("DEBUG")):qc(n,[],!0),J.makeTensor(n,e,r)}function Ae(n,e){if((Wa(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Wa(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eu(n,[],[],e)}function Mn(n,e){lh(n);var t=Jo(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eu(n,null,t,e)}function No(n,e,t){if(lh(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Jo(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eu(n,e,r,t)}function xx(n,e,t){if(lh(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Jo(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return eu(n,e,r,t)}function Yr(n,e,t){if(lh(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Jo(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return eu(n,e,r,t)}function q5(n,e,t){if(lh(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Jo(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return eu(n,e,r,t)}function K5(n,e,t){if(lh(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Jo(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return eu(n,e=e||r,r,t)}function X5(n,e,t,r){return e===void 0&&(e=!0),J.makeVariable(n,e,t,r)}function ch(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=ch(n,"float32"),r=$t(n,"float32");return fr(t,r)}var i=rk(je(n),e);return J.makeTensor(i,n,e)}function $t(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=$t(n,"float32"),r=$t(n,"float32");return fr(t,r)}var i=Md(je(n),e);return J.makeTensor(i,n,e)}function Ka(n,e,t){return J.runKernelFunc((function(r){return r.fill(n,e,t)}),{})}function Y5(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return J.runKernelFunc((function(r){return r.linspace(n,e,t)}),{})}function wg(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return $t([0],r);var i=Md(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var a=1;a<i.length;a++)i[a]=i[a-1]+t;return Mn(i,r)}var hk=Y({onesLike_:function(n){var e=z(n,"x","onesLike");if(e.dtype==="complex64"){var t=hk(Pi(e)),r=At(ja(e));return fr(t,r)}return J.runKernelFunc((function(i){return i.onesLike(e)}),{$x:e},(function(i,a){return{$x:function(){return At(i)}}}))}}),At=Y({zerosLike_:function(n){var e=z(n,"x","zerosLike");return J.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,r){return{$x:function(){return At(t)}}}))}}),zn=Y({concat_:function(n,e){e===void 0&&(e=0),G(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=xg(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(u){if(u.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+u.dtype+". ")})),e=Kn(e,t[0].shape)[0];var r=Xc(t.map((function(u){return u.shape})),e);if(je(r)===0)return pr([],r);if((t=t.filter((function(u){return u.size>0}))).length===1)return t[0];var i=t.map((function(u){return u.shape}));W5(i,e);var a=t,s={axis:e};return J.runKernelFunc((function(u){return u.concat(t,e)}),a,(function(u){var c=i.map((function(h){return h[e]}));return wx(u,c,e).map((function(h){return function(){return h}}))}),"Concat",s)}}),$5=Y({concat1d_:function(n){return zn(n,0)}}),Q5=Y({concat2d_:function(n,e){return zn(n,e)}}),Z5=Y({concat3d_:function(n,e){return zn(n,e)}}),J5=Y({concat4d_:function(n,e){return zn(n,e)}}),wx=Y({split_:function(n,e,t){t===void 0&&(t=0);var r,i=z(n,"x","split");return t=Kn(t,i.shape)[0],typeof e=="number"?(G(i.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(i.shape[t]/e)):(G(i.shape[t]===e.reduce((function(a,s){return a+s})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),J.runKernelFunc((function(a){return a.split(i,r,t)}),{$x:i},(function(a){return{$x:function(){return zn(a,t)}}}))}});function ol(n,e){return n(e={exports:{}},e.exports),e.exports}var eU=ol((function(n){(function(e,t,r){function i(u){var c,h=this,d=(c=4022871197,function(p){p=p.toString();for(var g=0;g<p.length;g++){var v=.02519603282416938*(c+=p.charCodeAt(g));v-=c=v>>>0,c=(v*=c)>>>0,c+=4294967296*(v-=c)}return 23283064365386963e-26*(c>>>0)});h.next=function(){var p=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=p-(h.c=0|p)},h.c=1,h.s0=d(" "),h.s1=d(" "),h.s2=d(" "),h.s0-=d(u),h.s0<0&&(h.s0+=1),h.s1-=d(u),h.s1<0&&(h.s1+=1),h.s2-=d(u),h.s2<0&&(h.s2+=1),d=null}function a(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function s(u,c){var h=new i(u),d=c&&c.state,p=h.next;return p.int32=function(){return 4294967296*h.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=s:this.alea=s})(0,n)})),tU=ol((function(n){(function(e,t,r){function i(u){var c=this,h="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var p=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^p^p>>>8},u===(0|u)?c.x=u:h+=u;for(var d=0;d<h.length+64;d++)c.x^=0|h.charCodeAt(d),c.next()}function a(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c}function s(u,c){var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=s:this.xor128=s})(0,n)})),nU=ol((function(n){(function(e,t,r){function i(u){var c=this,h="";c.next=function(){var p=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^p^p<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,u===(0|u)?c.x=u:h+=u;for(var d=0;d<h.length+64;d++)c.x^=0|h.charCodeAt(d),d==h.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.v=u.v,c.d=u.d,c}function s(u,c){var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=s:this.xorwow=s})(0,n)})),rU=ol((function(n){(function(e,t,r){function i(u){var c=this;c.next=function(){var h,d,p=c.x,g=c.i;return h=p[g],d=(h^=h>>>7)^h<<24,d^=(h=p[g+1&7])^h>>>10,d^=(h=p[g+3&7])^h>>>3,d^=(h=p[g+4&7])^h<<7,h=p[g+7&7],d^=(h^=h<<13)^h<<9,p[g]=d,c.i=g+1&7,d},(function(h,d){var p,g=[];if(d===(0|d))g[0]=d;else for(d=""+d,p=0;p<d.length;++p)g[7&p]=g[7&p]<<15^d.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],h.x=g,h.i=0,p=256;p>0;--p)h.next()})(c,u)}function a(u,c){return c.x=u.x.slice(),c.i=u.i,c}function s(u,c){u==null&&(u=+new Date);var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(d.x&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=s:this.xorshift7=s})(0,n)})),iU=ol((function(n){(function(e,t,r){function i(u){var c=this;c.next=function(){var h,d,p=c.w,g=c.X,v=c.i;return c.w=p=p+1640531527|0,d=g[v+34&127],h=g[v=v+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,d=g[v]=d^h,c.i=v,d+(p^p>>>16)|0},(function(h,d){var p,g,v,b,E,w=[],C=128;for(d===(0|d)?(g=d,d=null):(d+="\0",g=0,C=Math.max(C,d.length)),v=0,b=-32;b<C;++b)d&&(g^=d.charCodeAt((b+32)%d.length)),b===0&&(E=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,b>=0&&(E=E+1640531527|0,v=(p=w[127&b]^=g+E)==0?v+1:0);for(v>=128&&(w[127&(d&&d.length||0)]=-1),v=127,b=512;b>0;--b)g=w[v+34&127],p=w[v=v+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,w[v]=g^p;h.w=E,h.X=w,h.i=v})(c,u)}function a(u,c){return c.i=u.i,c.w=u.w,c.X=u.X.slice(),c}function s(u,c){u==null&&(u=+new Date);var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(d.X&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=s:this.xor4096=s})(0,n)})),aU=ol((function(n){(function(e,t,r){function i(u){var c=this,h="";c.next=function(){var p=c.b,g=c.c,v=c.d,b=c.a;return p=p<<25^p>>>7^g,g=g-v|0,v=v<<24^v>>>8^b,b=b-p|0,c.b=p=p<<20^p>>>12^g,c.c=g=g-v|0,c.d=v<<16^g>>>16^b,c.a=b-p|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,u===Math.floor(u)?(c.a=u/4294967296|0,c.b=0|u):h+=u;for(var d=0;d<h.length+20;d++)c.b^=0|h.charCodeAt(d),c.next()}function a(u,c){return c.a=u.a,c.b=u.b,c.c=u.c,c.d=u.d,c}function s(u,c){var h=new i(u),d=c&&c.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var g=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(g===0);return g},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&a(d,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=s:this.tychei=s})(0,n)})),Lu=ol((function(n){(function(e,t){var r,i=this,a=256,s=6,u="random",c=t.pow(a,s),h=t.pow(2,52),d=2*h,p=a-1;function g(C,S,I){var D=[],O=E((function R(k,P){var V,j=[],L=typeof k;if(P&&L=="object")for(V in k)try{j.push(R(k[V],P-1))}catch{}return j.length?j:L=="string"?k:k+"\0"})((S=S==1?{entropy:!0}:S||{}).entropy?[C,w(e)]:C??(function(){try{var R;return r&&(R=r.randomBytes)?R=R(a):(R=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(R)),w(R)}catch{var k=i.navigator,P=k&&k.plugins;return[+new Date,i,P,i.screen,w(e)]}})(),3),D),B=new v(D),N=function(){for(var R=B.g(s),k=c,P=0;R<h;)R=(R+P)*a,k*=a,P=B.g(1);for(;R>=d;)R/=2,k/=2,P>>>=1;return(R+P)/k};return N.int32=function(){return 0|B.g(4)},N.quick=function(){return B.g(4)/4294967296},N.double=N,E(w(B.S),e),(S.pass||I||function(R,k,P,V){return V&&(V.S&&b(V,B),R.state=function(){return b(B,{})}),P?(t[u]=R,k):R})(N,O,"global"in S?S.global:this==t,S.state)}function v(C){var S,I=C.length,D=this,O=0,B=D.i=D.j=0,N=D.S=[];for(I||(C=[I++]);O<a;)N[O]=O++;for(O=0;O<a;O++)N[O]=N[B=p&B+C[O%I]+(S=N[O])],N[B]=S;(D.g=function(R){for(var k,P=0,V=D.i,j=D.j,L=D.S;R--;)k=L[V=p&V+1],P=P*a+L[p&(L[V]=L[j=p&j+k])+(L[j]=k)];return D.i=V,D.j=j,P})(a)}function b(C,S){return S.i=C.i,S.j=C.j,S.S=C.S.slice(),S}function E(C,S){for(var I,D=C+"",O=0;O<D.length;)S[p&O]=p&(I^=19*S[p&O])+D.charCodeAt(O++);return w(S)}function w(C){return String.fromCharCode.apply(0,C)}if(t["seed"+u]=g,E(t.random(),e),n.exports){n.exports=g;try{r=require("crypto")}catch{}}})([],Math)}));Lu.alea=eU,Lu.xor128=tU,Lu.xorwow=nU,Lu.xorshift7=rU,Lu.xor4096=iU,Lu.tychei=aU;var dv=Lu.alea,Ex=(function(){function n(e,t,r,i,a){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=a||Math.random();this.random=dv(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var a=void 0,s=void 0,u=void 0;do u=(a=2*this.random()-1)*a+(s=2*this.random()-1)*s;while(u>=1||u===0);var c=Math.sqrt(-2*Math.log(u)/u);t=this.mean+this.stdDev*a*c,r=this.mean+this.stdDev*s*c,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),sU=(function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var a=i||Math.random();this.randu=dv(a.toString()),this.randn=new Ex(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,a,s;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-s+Math.log(s)),(a=this.randu())<t||Math.log(a)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n})(),oU=(function(){function n(e,t,r,i){var a=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=dv(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})();function it(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",ik(n),new od(n,e,t)}function uU(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var fk=Y({batchToSpaceND_:function(n,e,t){var r=z(n,"x","batchToSpaceND"),i=e.reduce((function(a,s){return a*s}));return G(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),G(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),G(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i})),J.runKernelFunc((function(a){return a.batchToSpaceND(r,e,t)}),{$x:r},(function(a){return{$x:function(){return a.spaceToBatchND(e,t)}}}))}}),lU=Y({broadcastTo_:function(n,e){var t=z(n,"broadcastTo","x"),r=t.shape;if(e.some((function(c){return!(c>0)||c%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var a=Array.from(e),s=e.length-1;s>=0;s--)if(t.shape[s]===e[s])a[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=a.map((function(c,h){return c>1?h:-1})).filter((function(c){return c>=0}));return u.length===0?t.clone():J.runKernelFunc((function(c){return c.tile(t,a)}),{input:t},(function(c){return{input:function(){return c.sum(u,!0)}}}))}}),cU=Y({cast_:function(n,e){var t=z(n,"x","cast");if(!n5(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return J.runKernelFunc((function(i){return i.cast(t,e)}),{x:t},(function(i){return{x:function(){return i.clone()}}}),"Cast",r)}}),hU=Y({clone_:function(n){var e=z(n,"x","clone",null);return J.runKernelFunc((function(){return J.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),fU=Y({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=z(n,"x","cumsum"),a=ts([e|=0],i.rank),s=i;a!=null&&(s=i.transpose(a));var u=ns(1,i.rank)[0],c=J.runKernelFunc((function(h){return h.cumsum(s,u,t,r)}),{permutedX:s},(function(h){return{permutedX:function(){return h.cumsum(e,t,!r)}}}));return a!=null&&(c=c.transpose(a)),c}}),dU=Y({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=z(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],a=t==="NHWC"?r.shape[2]:r.shape[3],s=t==="NHWC"?r.shape[3]:r.shape[1];return G(i*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape})),G(a*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+e+` for depthToSpace with input shape
          `+r.shape})),G(s%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape})),J.runKernelFunc((function(u){return u.depthToSpace(r,e,t)}),{$x:r})}}),Oi=Y({expandDims_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","expandDims",null);G(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return e<0&&(G(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),r.splice(e,0,1),aa(t,r)}}),dk=Y({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=it([n,e],r),a=n<=e?n:e,s=0;s<a;++s)i.set(1,s,s);var u=i.toTensor().as2D(n,e);if(t==null)return u;if(t.length===1)return Dc(Oi(u,0),[t[0],1,1]);if(t.length===2)return Dc(Oi(Oi(u,0),0),[t[0],t[1],1,1]);if(t.length===3)return Dc(Oi(Oi(Oi(u,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),pU=Y({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=z(n,"logits","multinomial"),a=i.size,s=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var u=s===1?i.as2D(1,-1):i,c=J.runKernelFunc((function(h){return h.multinomial(u,r,e,t)}),{logits2D:u});return s===1?c.as1D():c}}),jb=Y({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=z(n,"indices","oneHot","int32"),a=i.shape.concat([e]);return i=i.flatten(),J.runKernelFunc((function(s){return s.oneHot(i,e,t,r)}),{$indices:i},(function(s){return{$indices:function(){return $t(i.shape,"float32")}}})).reshape(a)}}),ul=Y({pad_:function(n,e,t){t===void 0&&(t=0);var r=z(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return J.runKernelFunc((function(a){return a.pad(r,e,t)}),{x:r},(function(a){var s=e.map((function(u){return u[0]}));return{x:function(){return a.slice(s,r.shape)}}}),"PadV2",i)}}),mU=Y({pad1d_:function(n,e,t){return t===void 0&&(t=0),G(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),ul(n,[e],t)}}),gU=Y({pad2d_:function(n,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ul(n,e,t)}}),vU=Y({pad3d_:function(n,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ul(n,e,t)}}),yU=Y({pad4d_:function(n,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ul(n,e,t)}}),_U=Y({rand_:function(n,e,t){var r=je(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=e();return J.makeTensor(i,n,t)}}),bU=Y({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new Ex(e,t,r,!1,i),s=it(n,r),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()}}),xU=Y({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var a=new sU(e,t,r,i),s=it(n,r),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()}}),pk=Y({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var a=it(n,r),s=new oU(e,t,null,i),u=0;u<a.values.length;u++)a.values[u]=s.nextValue();return a.toTensor()}}),aa=Y({reshape_:function(n,e){var t=z(n,"x","reshape",null);e=e5(e,t.size),G(t.size===je(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return J.runKernelFunc((function(i){return i.reshape(t,e)}),{x:t},(function(i){return{x:function(){return i.reshape(t.shape)}}}),"Reshape",r)}}),mk=Y({spaceToBatchND_:function(n,e,t){var r=z(n,"x","spaceToBatchND");return G(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),G(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),G(r.shape.reduce((function(i,a,s){return s>0&&s<=e.length?i&&(a+t[s-1][0]+t[s-1][1])%e[s-1]==0:i}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),J.runKernelFunc((function(i){return i.spaceToBatchND(r,e,t)}),{$x:r},(function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}}))}}),gk=Y({squeeze_:function(n,e){var t=z(n,"x","squeeze");return aa(t,Uu(t.shape,e).newShape)}}),yi=Y({stack_:function(n,e){e===void 0&&(e=0);var t=xg(n,"tensors","stack");if(G(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,a=t[0].dtype;G(e<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(u){Ft(i,u.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(u){G(a===u.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=t.map((function(u){return u.expandDims(e)}));return zn(s,e)}}),Dc=Y({tile_:function(n,e){var t=z(n,"x","tile",null);G(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var r=[t],i={reps:e};return J.runKernelFunc((function(a,s){var u=a.tile(t,e);return s([t]),u}),{x:t},(function(a,s){var u=s[0];return{x:function(){var c=At(u);if(u.rank===1)for(var h=0;h<e[0];++h)c=c.add(a.slice([h*u.shape[0]],[u.shape[0]]));else if(u.rank===2)for(h=0;h<e[0];++h)for(var d=0;d<e[1];++d)c=c.add(a.slice([h*u.shape[0],d*u.shape[1]],[u.shape[0],u.shape[1]]));else if(u.rank===3)for(h=0;h<e[0];++h)for(d=0;d<e[1];++d)for(var p=0;p<e[2];++p)c=c.add(a.slice([h*u.shape[0],d*u.shape[1],p*u.shape[2]],[u.shape[0],u.shape[1],u.shape[2]]));else{if(u.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+u.rank+" tensors yet.");for(h=0;h<e[0];++h)for(d=0;d<e[1];++d)for(p=0;p<e[2];++p)for(var g=0;g<e[3];++g)c=c.add(a.slice([h*u.shape[0],d*u.shape[1],p*u.shape[2],g*u.shape[3]],[u.shape[0],u.shape[1],u.shape[2],u.shape[3]]))}return c}}}),"Tile",i,r)}}),wU=Y({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new Ex(e,t,r,!0,i),s=it(n,r),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()}}),Hn=Y({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=z(n,"x","unstack");G(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var r={axis:e};return J.runKernelFunc((function(i){return i.unstack(t,e)}),{x:t},(function(i){return{x:function(){return yi(i,e)}}}),"Unpack",r)}}),EU=function(n,e){return Ve(this,void 0,void 0,(function(){var t,r,i,a,s,u,c,h,d,p;return Le(this,(function(g){switch(g.label){case 0:return t=z(n,"x","setdiff1d"),r=z(e,"y","setdiff1d"),G(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),G(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),G(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return i=g.sent(),[4,r.data()];case 2:for(a=g.sent(),s=new Set(a),u=0,d=0;d<i.length;d++)s.has(i[d])||u++;for(c=new od([u],t.dtype),h=new od([u],"int32"),d=0,p=0;d<i.length;d++)s.has(i[d])||(c.values[p]=i[d],h.values[p]=d,p++);return[2,[c.toTensor(),h.toTensor()]]}}))}))};function Eg(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var a=e.length,s=0;s<a;++s)i=i.concat([n[s+1]/e[s],e[s]]);i=i.concat(n.slice(a+1))}return i}function Tg(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var a=[],s=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?s.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,s)}return r}function Cg(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var a=1;a<n.length;++a)a<=e.length?r?i.push(e[a-1]*n[a]):i.push(n[a]/e[a-1]):i.push(n[a]);return i}function vk(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function yk(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function _k(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,a=0;a<t.length-1;++a)i*=t[a];var s=n.shape,u=t.slice();u.pop();var c=1;for(a=r;a<n.rank;++a)c*=s[a],u.push(s[a]);var h=qa(n.shape).map((function(d){return d/c})).concat([1]).slice(0,r);return[u,i,c,h]}var bk=30;function S_(n){return n<=bk?n:Ob(n,Math.floor(Math.sqrt(n)))}function TU(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(a+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(a+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(a+" update.rank != "+(i+n.length-r));for(var s=0;s<i;++s)if(t.shape[s]!==e.shape[s])throw new Error(a+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<t.rank-i;++s)if(t.shape[s+i]!==n[s+r])throw new Error(a+" updates.shape["+(s+i)+"] ("+t.shape[s+i]+") != shape["+(s+i)+"] ("+n[s+i]+")")}function CU(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}TU(t,e,n)}function Sg(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,a=t.length,s=1,u=i;u<a;++u)s*=t[u];var c=i<1?1:i;return{sliceRank:i,numUpdates:je(e.shape)/c,sliceSize:s,strides:qa(t.slice(0,i)).concat([1]),outputSize:je(t)}}function SU(n,e,t){G(n.rank===e.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."})),G(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."}));for(var r=function(a){G(e[a]+t[a]<=n.shape[a],(function(){return"Error in slice"+n.rank+"D: begin["+a+"] + size["+a+"] ("+(e[a]+t[a])+") would overflow input.shape["+a+"] ("+n.shape[a]+")"}))},i=0;i<n.rank;++i)r(i)}function NA(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function Tx(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function AU(n,e,t,r,i){var a=e[i],s=t[i]||1;(n&1<<i||a==null)&&(a=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[i];return a<0&&(a+=u),a=Db(0,a,u-1)}function RU(n,e,t,r,i){var a=e[i],s=t[i]||1;(n&1<<i||a==null)&&(a=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[i];return a<0&&(a+=u),a=s>0?Db(0,a,u):Db(-1,a,u-1)}function xk(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function wk(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function IU(n,e){G(Mb(n),(function(){return"The f passed in variableGrads(f) must be a function"})),G(e==null||Array.isArray(e)&&e.every((function(d){return d instanceof Kc})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var r in e=[],J.registeredVariables)e.push(J.registeredVariables[r]);var i=t?e.filter((function(d){return!d.trainable})):null,a=e.length;G((e=e.filter((function(d){return d.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var s=J.gradients(n,e,null,!0),u=s.value,c=s.grads;G(c.some((function(d){return d!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),G(u.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"}));var h={};return e.forEach((function(d,p){c[p]!=null&&(h[d.name]=c[p])})),i?.forEach((function(d){return h[d.name]=null})),{value:u,grads:h}}function pv(n){return J.customGrad(n)}var js=Y({softmax_:function(n,e){e===void 0&&(e=-1);var t=z(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return J.runKernelFunc((function(r,i){var a=r.softmax(t,e);return i([a]),a}),{logits:t},(function(r,i){var a=i[0],s=r.mul(a);return{logits:function(){return s.sub(s.sum([e],!0).mul(a))}}}),"Softmax",{dim:e},[],[!0])}}),NU=Y({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=z(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return pv((function(r,i){var a=r.max(e,!0),s=r.sub(a),u=s.toFloat().sub(s.exp().sum(e,!0).log());return i([u]),{value:u,gradFunc:function(c,h){var d=h[0].exp();return c.sub(c.sum(e,!0).mul(d))}}}))(t)}}),Ek=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n})(),Tk=(function(){function n(){}return n.prototype.time=function(e){return le("time")},n.prototype.read=function(e){return le("read")},n.prototype.readSync=function(e){return le("readSync")},n.prototype.numDataIds=function(){return le("numDataIds")},n.prototype.disposeData=function(e){return le("disposeData")},n.prototype.write=function(e,t,r){return le("write")},n.prototype.move=function(e,t,r,i){return le("move")},n.prototype.memory=function(){return le("memory")},n.prototype.floatPrecision=function(){return le("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return le("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,le("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return le("slice")},n.prototype.stridedSlice=function(e,t,r,i){return le("stridedSlice")},n.prototype.unstack=function(e,t){return le("unstack")},n.prototype.reverse=function(e,t){return le("reverse")},n.prototype.concat=function(e,t){return le("concat")},n.prototype.neg=function(e){return le("neg")},n.prototype.add=function(e,t){return le("add")},n.prototype.addN=function(e){return le("addN")},n.prototype.subtract=function(e,t){return le("subtract")},n.prototype.multiply=function(e,t){return le("multiply")},n.prototype.realDivide=function(e,t){return le("realDivide")},n.prototype.floorDiv=function(e,t){return le("floorDiv")},n.prototype.sum=function(e,t){return le("sum")},n.prototype.prod=function(e,t){return le("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return le("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return le("argMin")},n.prototype.argMax=function(e,t){return le("argMax")},n.prototype.equal=function(e,t){return le("equal")},n.prototype.notEqual=function(e,t){return le("notEqual")},n.prototype.less=function(e,t){return le("less")},n.prototype.lessEqual=function(e,t){return le("lessEqual")},n.prototype.greater=function(e,t){return le("greater")},n.prototype.greaterEqual=function(e,t){return le("greaterEqual")},n.prototype.logicalNot=function(e){return le("logicalNot")},n.prototype.logicalAnd=function(e,t){return le("logicalAnd")},n.prototype.logicalOr=function(e,t){return le("logicalOr")},n.prototype.where=function(e){return le("where")},n.prototype.select=function(e,t,r){return le("select")},n.prototype.topk=function(e,t,r){return le("topk")},n.prototype.min=function(e,t){return le("min")},n.prototype.minimum=function(e,t){return le("minimum")},n.prototype.mod=function(e,t){return le("mod")},n.prototype.max=function(e,t){return le("max")},n.prototype.maximum=function(e,t){return le("maximum")},n.prototype.all=function(e,t){return le("all")},n.prototype.any=function(e,t){return le("any")},n.prototype.squaredDifference=function(e,t){return le("squaredDifference")},n.prototype.ceil=function(e){return le("ceil")},n.prototype.floor=function(e){return le("floor")},n.prototype.round=function(e){return le("round")},n.prototype.sign=function(e){return le("sign")},n.prototype.isNaN=function(e){return le("isNaN")},n.prototype.isInf=function(e){return le("isInf")},n.prototype.isFinite=function(e){return le("isFinite")},n.prototype.pow=function(e,t){return le("pow")},n.prototype.exp=function(e){return le("exp")},n.prototype.expm1=function(e){return le("expm1")},n.prototype.softmax=function(e,t){return le("softmax")},n.prototype.log=function(e){return le("log")},n.prototype.log1p=function(e){return le("log1p")},n.prototype.sqrt=function(e){return le("sqrt")},n.prototype.rsqrt=function(e){return le("rsqrt")},n.prototype.square=function(e){return le("square")},n.prototype.reciprocal=function(e){return le("reciprocal")},n.prototype.relu=function(e){return le("relu")},n.prototype.relu6=function(e){return le("relu6")},n.prototype.prelu=function(e,t){return le("prelu")},n.prototype.elu=function(e){return le("elu")},n.prototype.eluDer=function(e,t){return le("eluDer")},n.prototype.selu=function(e){return le("selu")},n.prototype.int=function(e){return le("int")},n.prototype.clip=function(e,t,r){return le("clip")},n.prototype.abs=function(e){return le("abs")},n.prototype.complexAbs=function(e){return le("complexAbs")},n.prototype.sigmoid=function(e){return le("sigmoid")},n.prototype.softplus=function(e){return le("softplus")},n.prototype.sin=function(e){return le("sin")},n.prototype.cos=function(e){return le("cos")},n.prototype.tan=function(e){return le("tan")},n.prototype.asin=function(e){return le("asin")},n.prototype.acos=function(e){return le("acos")},n.prototype.atan=function(e){return le("atan")},n.prototype.atan2=function(e,t){return le("atan2")},n.prototype.sinh=function(e){return le("sinh")},n.prototype.cosh=function(e){return le("cosh")},n.prototype.tanh=function(e){return le("tanh")},n.prototype.asinh=function(e){return le("asinh")},n.prototype.acosh=function(e){return le("acosh")},n.prototype.atanh=function(e){return le("atanh")},n.prototype.erf=function(e){return le("erf")},n.prototype.step=function(e,t){return le("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return le("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return le("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return le("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return le("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return le("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return le("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return le("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return le("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return le("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return le("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return le("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return le("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return le("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return le("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return le("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return le("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return le("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return le("reshape")},n.prototype.cast=function(e,t){return le("cast")},n.prototype.tile=function(e,t){return le("tile")},n.prototype.pad=function(e,t,r){return le("pad")},n.prototype.transpose=function(e,t){return le("transpose")},n.prototype.gather=function(e,t,r){return le("gather")},n.prototype.gatherND=function(e,t){return le("gatherND")},n.prototype.scatterND=function(e,t,r){return le("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return le("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return le("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return le("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return le("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return le("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return le("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,a,s){return le("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,a){return le("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,a,s,u){return le("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return le("multinomial")},n.prototype.oneHot=function(e,t,r,i){return le("oneHot")},n.prototype.cumsum=function(e,t,r,i){return le("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,a){return le("nonMaxSuppression")},n.prototype.fft=function(e){return le("fft")},n.prototype.ifft=function(e){return le("ifft")},n.prototype.complex=function(e,t){return le("complex")},n.prototype.real=function(e){return le("real")},n.prototype.imag=function(e){return le("imag")},n.prototype.cropAndResize=function(e,t,r,i,a,s){return le("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return le("depthToSpace")},n.prototype.split=function(e,t,r){return le("split")},n.prototype.sparseToDense=function(e,t,r,i){return le("sparseToDense")},n.prototype.diag=function(e){return le("diag")},n.prototype.fill=function(e,t,r){return le("fill")},n.prototype.onesLike=function(e){return le("onesLike")},n.prototype.zerosLike=function(e){return le("zerosLike")},n.prototype.linspace=function(e,t,r){return le("linspace")},n.prototype.dispose=function(){return le("dispose")},n})();function le(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ao(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var a=t-1-i,s=n[a]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(a)}return r}function Wn(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],a=e.length-r-1,s=e[a];(i==null||i===1&&s>1)&&t.unshift(a)}return t}function mt(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var a=n[n.length-i-1];a==null&&(a=1);var s=e[e.length-i-1];if(s==null&&(s=1),a===1)t.unshift(s);else if(s===1)t.unshift(a);else{if(a!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(a)}}return t}function ld(n,e,t,r,i,a,s){s===void 0&&(s="channelsLast");var u,c=Ig(e),h=c[0],d=c[1];if(s==="channelsLast")u=[h,d,n[3],n[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=[h,d,n[1],n[1]]}return ll(n,u,t,r,i,a,!1,s)}function Ag(n,e,t,r,i,a,s){s===void 0&&(s="NDHWC");var u,c,h=Ub(e),d=h[0],p=h[1],g=h[2];if(s==="NDHWC")c="channelsLast",u=[d,p,g,n[4],n[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);c="channelsFirst",u=[d,p,g,n[1],n[1]]}return Rg(n,u,t,r,i,!1,c,a)}function ll(n,e,t,r,i,a,s,u){s===void 0&&(s=!1),u===void 0&&(u="channelsLast");var c=[-1,-1,-1,-1],h=c[0],d=c[1],p=c[2],g=c[3];if(u==="channelsLast")h=n[0],d=n[1],p=n[2],g=n[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);h=n[0],g=n[1],d=n[2],p=n[3]}var v,b=e[0],E=e[1],w=e[3],C=Ig(t),S=C[0],I=C[1],D=Ig(r),O=D[0],B=D[1],N=kc(b,O),R=kc(E,B),k=(function(Z,ne,q,X,ee,ue,fe,W){var $,ce,ve;if(typeof Z=="number"){$={top:Z,bottom:Z,left:Z,right:Z,type:Z===0?"VALID":"NUMBER"};var Te=(function(et,Ze,Xe,st,Qe){st==null&&(st=Ck(et,Ze,Xe));var ot=et[0],Xn=et[1],xn=Gf((ot-Ze+2*st)/Xe+1,Qe);G(bn(xn),(function(){return"The output # of rows ("+xn+") must be an integer. Change the stride and/or zero pad parameters"}));var Ye=Gf((Xn-Ze+2*st)/Xe+1,Qe);return G(bn(Ye),(function(){return"The output # of columns ("+Ye+") must be an integer. Change the stride and/or zero pad parameters"})),[xn,Ye]})([ne,q],ue,X,Z,W);ce=Te[0],ve=Te[1]}else if(Z==="same"){ce=Math.ceil(ne/X),ve=Math.ceil(q/ee);var Se=Math.max(0,(ce-1)*X+ue-ne),_e=Math.max(0,(ve-1)*ee+fe-q),De=Math.floor(Se/2),Re=Se-De,qe=Math.floor(_e/2);$={top:De,bottom:Re,left:qe,right:_e-qe,type:"SAME"}}else{if(Z!=="valid")throw Error("Unknown padding parameter: "+Z);$={top:0,bottom:0,left:0,right:0,type:"VALID"},ce=Math.ceil((ne-ue+1)/X),ve=Math.ceil((q-fe+1)/ee)}return{padInfo:$,outHeight:ce,outWidth:ve}})(i,d,p,S,I,N,R,a),P=k.padInfo,V=k.outHeight,j=k.outWidth,L=s?w*g:w;return u==="channelsFirst"?v=[h,L,V,j]:u==="channelsLast"&&(v=[h,V,j,L]),{batchSize:h,dataFormat:u,inHeight:d,inWidth:p,inChannels:g,outHeight:V,outWidth:j,outChannels:L,padInfo:P,strideHeight:S,strideWidth:I,filterHeight:b,filterWidth:E,effectiveFilterHeight:N,effectiveFilterWidth:R,dilationHeight:O,dilationWidth:B,inShape:n,outShape:v,filterShape:e}}function Rg(n,e,t,r,i,a,s,u){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var c=[-1,-1,-1,-1,-1],h=c[0],d=c[1],p=c[2],g=c[3],v=c[4];if(s==="channelsLast")h=n[0],d=n[1],p=n[2],g=n[3],v=n[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);h=n[0],v=n[1],d=n[2],p=n[3],g=n[4]}var b,E=e[0],w=e[1],C=e[2],S=e[4],I=Ub(t),D=I[0],O=I[1],B=I[2],N=Ub(r),R=N[0],k=N[1],P=N[2],V=kc(E,R),j=kc(w,k),L=kc(C,P),Z=(function(fe,W,$,ce,ve,Te,Se,_e,De,Re,qe){var et,Ze,Xe,st;if(typeof fe=="number"){et={top:fe,bottom:fe,left:fe,right:fe,front:fe,back:fe,type:fe===0?"VALID":"NUMBER"};var Qe=(function(tn,ar,is,bi,Ln,au){Ln==null&&(Ln=Ck(tn,ar,bi));var gl=tn[0],vl=tn[1],yl=tn[2],Or=Gf((gl-ar+2*Ln)/bi+1,au);G(bn(Or),(function(){return"The output # of depths ("+Or+") must be an integer. Change the stride and/or zero pad parameters"}));var pn=Gf((vl-ar+2*Ln)/bi+1,au);G(bn(pn),(function(){return"The output # of rows ("+pn+") must be an integer. Change the stride and/or zero pad parameters"}));var _r=Gf((yl-ar+2*Ln)/bi+1,au);return G(bn(_r),(function(){return"The output # of columns ("+_r+") must be an integer. Change the stride and/or zero pad parameters"})),[Or,pn,_r,is]})([W,$,ce,1],_e,1,ve,fe,qe);Ze=Qe[0],Xe=Qe[1],st=Qe[2]}else if(fe==="same"){Ze=Math.ceil(W/ve),Xe=Math.ceil($/Te),st=Math.ceil(ce/Se);var ot=(Ze-1)*ve+_e-W,Xn=(Xe-1)*Te+De-$,xn=(st-1)*Se+Re-ce,Ye=Math.floor(ot/2),Rt=ot-Ye,wn=Math.floor(Xn/2),jr=Xn-wn,yr=Math.floor(xn/2);et={top:wn,bottom:jr,left:yr,right:xn-yr,front:Ye,back:Rt,type:"SAME"}}else{if(fe!=="valid")throw Error("Unknown padding parameter: "+fe);et={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ze=Math.ceil((W-_e+1)/ve),Xe=Math.ceil(($-De+1)/Te),st=Math.ceil((ce-Re+1)/Se)}return{padInfo:et,outDepth:Ze,outHeight:Xe,outWidth:st}})(i,d,p,g,D,O,B,V,j,L,u),ne=Z.padInfo,q=Z.outDepth,X=Z.outHeight,ee=Z.outWidth,ue=a?S*v:S;return s==="channelsFirst"?b=[h,ue,q,X,ee]:s==="channelsLast"&&(b=[h,q,X,ee,ue]),{batchSize:h,dataFormat:s,inDepth:d,inHeight:p,inWidth:g,inChannels:v,outDepth:q,outHeight:X,outWidth:ee,outChannels:ue,padInfo:ne,strideDepth:D,strideHeight:O,strideWidth:B,filterDepth:E,filterHeight:w,filterWidth:C,effectiveFilterDepth:V,effectiveFilterHeight:j,effectiveFilterWidth:L,dilationDepth:R,dilationHeight:k,dilationWidth:P,inShape:n,outShape:b,filterShape:e}}function Ck(n,e,t,r){r===void 0&&(r=1);var i=kc(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function Ig(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Ub(n){return typeof n=="number"?[n,n,n]:n}function kc(n,e){return e<=1?n:n+(n-1)*(e-1)}function Gf(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function Yc(n){var e=Ig(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function ni(n,e){return Yc(n)||Yc(e)}function Cx(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function Sk(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=$t(n.shape),i=n.toFloat(),a=t.complex(i,r);return r.dispose(),i.dispose(),a}if(!r5(n.dtype,e))return J.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var s=t.real(n);return a=s.cast(e),s.dispose(),a}if(e==="int32")return t.int(n);if(e==="bool"){var u=Ae(0,n.dtype);return a=t.notEqual(n,u),u.dispose(),a}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function zb(n,e){return J.makeTensorFromDataId(n.dataId,e,n.dtype)}function Ak(n,e,t){var r=(e-n)/(t-1),i=Md(t,"float32");i[0]=n;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return Mn(i,"float32")}function Hb(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function DA(n,e){return{real:n[2*e],imag:n[2*e+1]}}function DU(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function kU(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function MU(n,e,t){var r=(function(a,s,u){return(function(c,h,d){for(var p=0,g=c.length,v=0,b=!1;p<g;){var E=d(h,c[v=p+(g-p>>>1)]);E>0?p=v+1:(g=v,b=!E)}return b?p:-p-1})(a,s,u||OU)})(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function OU(n,e){return n>e?1:n<e?-1:0}function Sx(n,e,t,r,i){return Rk(n,e,t,r,i,0).selectedIndices}function Ax(n,e,t,r,i,a){var s=Rk(n,e,t,r,i,a);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function Rk(n,e,t,r,i,a,s,u){u===void 0&&(u=!1);for(var c=Array.from(e).map((function(D,O){return{score:D,boxIndex:O,suppressBeginIndex:0}})).filter((function(D){return D.score>i})).sort(kA),h=a>0?-.5/a:0,d=[],p=[];d.length<t&&c.length>0;){var g=c.pop(),v=g.score,b=g.boxIndex,E=g.suppressBeginIndex;if(v<i)break;for(var w=!1,C=d.length-1;C>=E;--C){var S=PU(n,b,d[C]);if(S>=r){w=!0;break}if(g.score=g.score*FU(r,h,S),g.score<=i)break}g.suppressBeginIndex=d.length,w||(g.score===v?(d.push(b),p.push(g.score)):g.score>i&&MU(c,g,kA))}var I=d.length;return u&&(d.fill(0,I),p.fill(0,I)),{selectedIndices:Mn(d,"int32"),selectedScores:Mn(p,"float32"),numValidOutputs:Ae(I,"int32")}}function PU(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),a=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),u=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),h=Math.min(i[0],i[2]),d=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),g=Math.max(i[1],i[3]),v=(u-a)*(c-s),b=(p-h)*(g-d);if(v<=0||b<=0)return 0;var E=Math.max(a,h),w=Math.max(s,d),C=Math.min(u,p),S=Math.min(c,g),I=Math.max(C-E,0)*Math.max(S-w,0);return I/(v+b-I)}function FU(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function kA(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function Ik(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map((function(a){i[t]=a;var s=n.slice(r,i);return r[t]+=a,s}))}function Nk(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=it(t,n.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),s=new Array(n.rank),u=0;u<s.length;u++)s[u]=a[u]%n.shape[u];var c=n.locToIndex(s);i.values[r]=n.values[c]}return i.toTensor()}function Dk(n,e,t,r,i){for(var a=e[e.length-1],s=[n.length/a,a],u=s[0],c=s[1],h=sd(t,u*r),d=sd("int32",u*r),p=0;p<u;p++){for(var g=p*c,v=n.subarray(g,g+c),b=[],E=0;E<v.length;E++)b.push({value:v[E],index:E});b.sort((function(D,O){return O.value-D.value}));var w=p*r,C=h.subarray(w,w+r),S=d.subarray(w,w+r);for(E=0;E<r;E++)C[E]=b[E].value,S[E]=b[E].index}var I=e.slice();return I[I.length-1]=r,[pr(h,I,t),pr(d,I,"int32")]}function Rx(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=it(n,"int32"),a=it([t.length,n.length],"int32");for(r=0;r<t.length;r++){var s=i.indexToLoc(t[r]),u=r*n.length;a.values.set(s,u)}return a.toTensor()}var VU=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((function(i,a){return"T"+a}));var t=[];this.variableNames.forEach((function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},LU=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((function(i,a){return"T"+a}));var t=[];this.variableNames.forEach((function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},BU=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,a=n.inSize,s=Math.ceil(a/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var u=e==="max"?">":"<",c=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function kk(n,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return n+"."+t}))}function $r(n,e){return e===1?[n]:kk(n,e)}function Rr(){var n,e,t,r,i,a,s,u,c,h;return ge().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",a="outputColor",s="out vec4 outputColor;",u=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",a="gl_FragColor",s="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:a,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:c,defineRound:h}}function Gu(n,e,t){t===void 0&&(t="index");var r=qa(e);return r.map((function(i,a){return"int "+n[a]+" = "+t+" / "+i+"; "+(a===r.length-1?"int "+n[a+1]+" = "+t+" - "+n[a]+" * "+i:"index -= "+n[a]+" * "+i)+";"})).join("")}function Ix(n){var e=qa(n).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var Mk=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function jU(n,e,t,r){var i=[];n.forEach((function(v){var b=je(v.shapeInfo.logicalShape);v.shapeInfo.isUniform?i.push("uniform float "+v.name+(b>1?"["+b+"]":"")+";"):(i.push("uniform sampler2D "+v.name+";"),i.push("uniform int offset"+v.name+";"))}));var a,s,u=i.join(`
`),c=n.map((function(v){return(function(b,E,w){w===void 0&&(w=!1);var C="";C+=w?Ok(b):fc(b);var S=b.shapeInfo.logicalShape,I=E.logicalShape;return S.length<=I.length&&(C+=w?(function(D,O){var B,N=D.name,R=N.charAt(0).toUpperCase()+N.slice(1),k="get"+R+"AtOutCoords",P=D.shapeInfo.logicalShape.length,V=O.logicalShape.length,j=Ao(D.shapeInfo.logicalShape,O.logicalShape),L=Kt(V),Z=V-P,ne=["x","y","z","w","u","v"];B=P===0?"":V<2&&j.length>=1?"coords = 0;":j.map((function($){return"coords."+ne[$+Z]+" = 0;"})).join(`
`);var q="";q=V<2&&P>0?"coords":D.shapeInfo.logicalShape.map((function($,ce){return"coords."+ne[ce+Z]})).join(", ");var X="return outputValue;",ee=je(D.shapeInfo.logicalShape)===1,ue=je(O.logicalShape)===1;if(P!==1||ee||ue){if(ee&&!ue)X=V===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(j.length){var fe=P-2,W=P-1;j.indexOf(fe)>-1&&j.indexOf(W)>-1?X="return vec4(outputValue.x);":j.indexOf(fe)>-1?X="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":j.indexOf(W)>-1&&(X="return vec4(outputValue.xx, outputValue.zz);")}}else X=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+k+`() {
      `+L+` coords = getOutputCoords();
      `+B+`
      vec4 outputValue = get`+R+"("+q+`);
      `+X+`
    }
  `})(b,E):(function(D,O){var B=D.name,N=B.charAt(0).toUpperCase()+B.slice(1),R="get"+N+"AtOutCoords",k=O.texShape,P=D.shapeInfo.texShape,V=D.shapeInfo.logicalShape.length,j=O.logicalShape.length;if(!D.shapeInfo.isUniform&&V===j&&D.shapeInfo.flatOffset==null&&rr(P,k))return`
      float `+R+`() {
        return sampleTexture(`+B+`, resultUV);
      }
    `;var L,Z=Kt(j),ne=Ao(D.shapeInfo.logicalShape,O.logicalShape),q=j-V,X=["x","y","z","w","u","v"];L=V===0?"":j<2&&ne.length>=1?"coords = 0;":ne.map((function(ue){return"coords."+X[ue+q]+" = 0;"})).join(`
`);var ee="";return ee=j<2&&V>0?"coords":D.shapeInfo.logicalShape.map((function(ue,fe){return"coords."+X[fe+q]})).join(", "),`
    float `+R+`() {
      `+Z+` coords = getOutputCoords();
      `+L+`
      return get`+N+"("+ee+`);
    }
  `})(b,E)),C})(v,e,r)})).join(`
`),h=e.texShape,d=Rr(),p=(function(v){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+v.texture2D+`(textureSampler, uv).r;
    }
  `})(d),g=(function(v){return v.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+v.varyingFs+` vec2 resultUV;
    `+v.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+v.defineSpecialNaN+`
    `+v.defineSpecialInf+`
    `+v.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+UU+`
    `+zU+`
    `+HU+`
  `})(d);return e.isPacked?(a=(function(v,b){switch(v.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(D,O){var B=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];return B[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+B[1]+`.0);
      }
    `:B[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+B[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+B[0]+", "+B[1]+`));
      return 2 * (resTexRC.x * `+B[1]+` + resTexRC.y);
    }
  `})(0,b);case 2:return(function(D,O){var B=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];if(rr(D,O))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+B[0]+", "+B[1]+`));
      }
    `;var N=Math.ceil(D[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+B[0]+", "+B[1]+`));

      int index = resTexRC.x * `+B[1]+` + resTexRC.y;
      int r = 2 * (index / `+N+`);
      int c = imod(index, `+N+`) * 2;

      return ivec2(r, c);
    }
  `})(v,b);case 3:return E=v,w=b,C=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],S=Math.ceil(E[2]/2),I=S*Math.ceil(E[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(D,O){for(var B=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)],N=Math.ceil(D[D.length-1]/2),R=N*Math.ceil(D[D.length-2]/2),k=R,P="",V="b, r, c",j=2;j<D.length-1;j++)k*=D[D.length-j-1],P=`
      int b`+j+" = index / "+k+`;
      index -= b`+j+" * "+k+`;
    `+P,V="b"+j+", "+V;return`
    ivec`+D.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+B[0]+", "+B[1]+`));
      int index = resTexRC.x * `+B[1]+` + resTexRC.y;

      `+P+`

      int b = index / `+R+`;
      index -= b * `+R+`;

      int r = 2 * (index / `+N+`);
      int c = imod(index, `+N+`) * 2;

      return ivec`+D.length+"("+V+`);
    }
  `})(v,b)}var E,w,C,S,I})(e.logicalShape,h),s=(function(v){return`
    void setOutput(vec4 val) {
      `+v.output+` = val;
    }
  `})(d)):(a=(function(v,b){switch(v.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(C,S){return S[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+S[1]+`.0);
      }
    `:S[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+S[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      return resTexRC.x * `+S[1]+` + resTexRC.y;
    }
  `})(0,b);case 2:return(function(C,S){return rr(C,S)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+S[0]+", "+S[1]+`));
      }
    `:C[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+S[0]+", "+S[1]+`));
        int index = resTexRC.x * `+S[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:C[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+S[0]+", "+S[1]+`));
        int index = resTexRC.x * `+S[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      int r = index / `+C[1]+`;
      int c = index - r * `+C[1]+`;
      return ivec2(r, c);
    }
  `})(v,b);case 3:return E=b,w=Gu(["r","c","d"],v),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      `+w+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(C,S){var I=Gu(["r","c","d","d2"],C);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      `+I+`
      return ivec4(r, c, d, d2);
    }
  `})(v,b);case 5:return(function(C,S){var I=Gu(["r","c","d","d2","d3"],C);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+S[0]+`,
                             `+S[1]+`));

      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+I+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(v,b);case 6:return(function(C,S){var I=Gu(["r","c","d","d2","d3","d4"],C);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+I+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(v,b);default:throw new Error(v.length+"-D output sampling is not yet supported")}var E,w})(e.logicalShape,h),s=(function(v){return`
    void setOutput(float val) {
      `+v.output+` = vec4(val, 0, 0, 0);
    }
  `})(d)),r&&(g+=GU),[g,p,s,u,a,c,t].join(`
`)}function fc(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var a=t.shapeInfo.texShape,s=a[0],u=a[1];if(s===1&&u===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=t.shapeInfo.texShape,h=c[0],d=c[1],p=Pu(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+h+", "+d+", "+p+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+sc(t)+`
      }
    `;var a=t.shapeInfo.texShape,s=a[0],u=a[1];if(u===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=Pu(r);return u===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+u+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+u+", index + "+c+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&rr(r,s)){var u=s[0],c=s[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+u+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var h=Uu(r),d=h.newShape,p=h.keptDims,g=d;if(g.length<r.length){var v=dc(t,g);return`
      `+fc(v)+`
      float `+a+`(int row, int col) {
        return `+a+"("+pc(["row","col"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+sc(t)+`
      }
    `;var b=s[0],E=s[1],w=Pu(i);return E===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+w+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+b+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:b===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+w+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+E+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+w+`;
    vec2 uv = uvFromFlat(`+b+", "+E+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],u=r[2],c=Uu(r),h=c.newShape,d=c.keptDims,p=h;if(p.length<r.length){var g=dc(t,p);return`
        `+fc(g)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+pc(["row","col","depth"],d)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+u+`, 1)));
        `+sc(t)+`
      }
    `;var v=t.shapeInfo.texShape,b=v[0],E=v[1],w=t.shapeInfo.flatOffset;if(E===s&&w==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+u+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+E+".0, "+b+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(E===u&&w==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+E+".0, "+b+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var C=Pu(i);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+u+" + depth + "+C+`;
        vec2 uv = uvFromFlat(`+b+", "+E+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],u=r[2]*s,c=r[1]*u,h=Uu(r),d=h.newShape,p=h.keptDims;if(d.length<r.length){var g=dc(t,d);return`
      `+fc(g)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+pc(["row","col","depth","depth2"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+u+", "+s+`, 1)));
        `+sc(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,b=t.shapeInfo.texShape,E=b[0],w=b[1];if(w===c&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+u+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(w===s&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var C=Pu(i);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+E+", "+w+", index + "+C+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],u=r[3]*s,c=r[2]*u,h=r[1]*c,d=Uu(r),p=d.newShape,g=d.keptDims;if(p.length<r.length){var v=dc(t,p);return`
      `+fc(v)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+pc(["row","col","depth","depth2","depth3"],g)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+c+", "+u+", "+s+`)) +
          depth3;
        `+sc(t)+`
      }
    `;var b=t.shapeInfo.flatOffset,E=t.shapeInfo.texShape,w=E[0],C=E[1];if(C===h&&b==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+u+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(C===s&&b==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var S=Pu(i);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+c+" + depth * "+u+` +
          depth2 * `+s+" + depth3 + "+S+`;
      vec2 uv = uvFromFlat(`+w+", "+C+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=Uu(r),u=s.newShape,c=s.keptDims;if(u.length<r.length){var h=dc(t,u);return`
      `+fc(h)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+pc(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var d=r[5],p=r[4]*d,g=r[3]*p,v=r[2]*g,b=r[1]*v;if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+b+", "+v+", "+g+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+d+`, 1)));
        `+sc(t)+`
      }
    `;var E=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,C=w[0],S=w[1];if(S===b&&E==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+v+", "+g+", "+p+", "+d+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+S+".0, "+C+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(S===d&&E==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+S+".0, "+C+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var I=Pu(i);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+b+" + col * "+v+" + depth * "+g+` +
          depth2 * `+p+" + depth3 * "+d+" + depth4 + "+I+`;
      vec2 uv = uvFromFlat(`+C+", "+S+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Ok(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Rr(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Rr();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+h.texture2D+"("+a+`, uv);
    }
  `})(n);case 2:return(function(i){var a=i.shapeInfo.logicalShape,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,h=c[0],d=c[1],p=Rr();if(c!=null&&rr(a,c))return`
      vec4 `+u+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+d+".0, "+h+`.0);

        return `+p.texture2D+"("+s+`, uv);
      }
    `;var g=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],v=Math.ceil(a[1]/2);return`
    vec4 `+u+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+v+", "+g[0]+", "+g[1]+`, row, col);
      return `+p.texture2D+"("+s+`, uv);
    }
  `})(n);case 3:return(function(i){var a=i.shapeInfo.logicalShape,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,h=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(a[0]===1){var d=a.slice(1),p=dc(i,d);return`
        `+Ok(p)+`
        vec4 `+u+`(int b, int row, int col) {
          return `+u+"("+pc(["b","row","col"],[1,2])+`);
        }
      `}var g=h[0],v=h[1],b=Math.ceil(a[2]/2),E=b*Math.ceil(a[1]/2),w=Rr();return`
    vec4 `+u+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+g+", "+v+", "+E+", "+b+`, b, row, col);
      return `+w.texture2D+"("+s+`, uv);
    }
  `})(n);default:return(function(i){for(var a=i.shapeInfo.logicalShape,s=a.length,u=i.name,c="get"+u.charAt(0).toUpperCase()+u.slice(1),h=i.shapeInfo.texShape,d=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],p=d[0],g=d[1],v=Math.ceil(a[s-1]/2),b=v*Math.ceil(a[s-2]/2),E="int b, int row, int col",w="b * "+b+" + (row / 2) * "+v+" + (col / 2)",C=2;C<s-1;C++)E="int b"+C+", "+E,b*=a[s-C-1],w="b"+C+" * "+b+" + "+w;var S=Rr();return`
    vec4 `+c+"("+E+`) {
      int index = `+w+`;
      int texR = index / `+g+`;
      int texC = index - texR * `+g+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+", "+p+`);
      return `+S.texture2D+"("+u+`, uv);
    }
  `})(n)}}var UU=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,zU=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,HU=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,GU=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Pu(n){return"offset"+n}function sc(n){var e=n.name,t=je(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Kt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function dc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function pc(n,e){return e.map((function(t){return n[t]})).join(", ")}var WU=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,G(n.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var i=n[n.length-1],a=Math.ceil(i/e);this.outputShape=n.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,h=c.length,d=Kt(h),p=$r("coords",h);if(a===1){var g=Kt(u=h+1);s=`
        `+g+" sourceLocR = "+g+"("+p.join()+`, 0);
        ++`+p[h-1]+`;
        `+g+" sourceLocG = "+g+"("+p.join()+`, 0);
        ++`+p[h-2]+`;
        `+g+" sourceLocA = "+g+"("+p.join()+`, 0);
        --`+p[h-1]+`;
        `+g+" sourceLocB = "+g+"("+p.join()+`, 0);
        --`+p[h-2]+";"}else u=h,s=`
        `+d+` sourceLocR = coords;
        ++`+p[h-1]+`;
        `+d+` sourceLocG = coords;
        ++`+p[h-2]+`;
        `+d+` sourceLocA = coords;
        --`+p[h-1]+`;
        `+d+` sourceLocB = coords;
        --`+p[h-2]+";";var v=["x","y","z","w","u","v"].slice(0,u),b="."+v[u-1],E=v.map((function(R){return"int "+R})),w=$r("sourceLocR",u-1).concat("inIdx.r"),C=$r("sourceLocG",u-1).concat("inIdx.g"),S=$r("sourceLocB",u-1).concat("inIdx.b"),I=$r("sourceLocA",u-1).concat("inIdx.a"),D=t==="max"?"greaterThan":"lessThan",O=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+S.join()+`),
                             getBestIndicesAChannel(`+I.join()+")));",B=`vec4(
            getAChannel(`+w.join()+`),
            hasNextCol ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow ? getAChannel(`+S.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+I.join()+") : 0.)",N=r?"":`
      float getBestIndicesAChannel(`+E.join()+`) {
        return getChannel(getBestIndicesA(`+v.join()+`),
                                          vec2(`+v.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+E.join()+`) {
        return getChannel(getA(`+v.join()+`),
                               vec2(`+v.slice(-2).join()+`));
      }
      `+N+`
      void main() {
        `+d+` coords = getOutputCoords();
        bool hasNextCol = `+p[h-1]+" < "+(c[h-1]-1)+`;
        bool hasNextRow = `+p[h-2]+" < "+(c[h-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+b+", sourceLocG"+b+`,
          sourceLocB`+b+", sourceLocA"+b+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+B+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+O+`
          vec4 candidate = `+B+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+D+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},qU=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,h=u-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+d+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},KU=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,g=n.effectiveFilterWidth,v=d-1-n.padInfo.front,b=p-1-n.padInfo.top,E=g-1-n.padInfo.left,w=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+v+", "+b+", "+E+`);
      const float avgMultiplier = float(`+w+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+g+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},XU=function(n,e,t,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],mt(n,e),mt(n,t);var s="0.0";r!=null&&(mt(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(mt(n,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},YU=function(n,e,t,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],mt(n,e),mt(n,t);var s="vec4(0.0)";r!=null&&(mt(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(mt(n,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},$U="return areal * breal - aimag * bimag;",QU="return areal * bimag + aimag * breal;",MA=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=mt(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},A_="return a + b;",R_="return a - b;",OA="return a * b;",Pk="return (a < 0.) ? b * a : a;",fn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=mt(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Fk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Cs=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=mt(e,t);var i=this.outputShape.length,a="";if(r)if(i===0||je(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+Kt(i)+` coords = getOutputCoords();
        `,i===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=$r("coords",i);a+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},ZU=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,a){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),JU=(function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,a){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),ez=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},tz=function(n){this.outputShape=[],this.outputShape=Xc(n,1),this.variableNames=n.map((function(u,c){return"T"+c}));var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var a=e.length,s=e[e.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},nz=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Xc(n,e);var t=this.outputShape,r=t.length,i=Kt(r),a=$r("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map((function(w,C){return"T"+C}));var u=new Array(n.length-1);u[0]=n[0][e];for(var c=1;c<u.length;c++)u[c]=u[c-1]+n[c][e];var h=s[e],d=s.slice(-2),p=s.join(),g="if ("+h+" < "+u[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+d.join()+`));
        }`;for(c=1;c<u.length;c++){var v=u[c-1];g+=`
        if (`+h+" < "+u[c]+"  && "+h+" >= "+u[c-1]+`) {
          return getChannel(
            getT`+c+"("+Mm(s,h,v)+`),
            vec2(`+Mm(d,h,v)+`));
        }`}var b=u.length,E=u[u.length-1];g+=`
        return getChannel(
          getT`+b+"("+Mm(s,h,E)+`),
          vec2(`+Mm(d,h,E)+"));",this.userCode=`
      float getValue(`+s.map((function(w){return"int "+w}))+`) {
        `+g+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[r-1]+" = "+a[r-1]+` + 1;
        if (`+a[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[r-2]+" = "+a[r-2]+` + 1;
        if (`+a[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[r-1]+" = "+a[r-1]+` - 1;
        if (`+a[r-2]+" < "+t[r-2]+` &&
            `+a[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function Mm(n,e,t){var r=n.indexOf(e);return n.map((function(i,a){return a===r?i+" - "+t:i})).join()}var rz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,a=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},iz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,a=n.dataFormat==="channelsLast",s=e-1-n.padInfo.top,u=t-1-n.padInfo.left,c=a?1:2,h=a?2:3,d=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+d+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},az=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,a=n.padInfo.top,s=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+a+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},sz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=e-1-n.padInfo.front,c=t-1-n.padInfo.top,h=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+c+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},oz=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},uz=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,a=e-1-n.padInfo.top,s=t-1-n.padInfo.left,u=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},PA=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,a=n.padInfo.left,s=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,g=4*Math.floor(n.inChannels/4),v=n.inChannels%4,b=n.dataFormat==="channelsLast",E=b?1:2,w=b?2:3,C=b?3:1,S="",I="";t&&(S=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,I="result = activation(result);");var D=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+S+`

      const ivec2 strides = ivec2(`+s+", "+u+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+C+`];

        ivec2 xRCCorner =
            ivec2(coords[`+E+"], coords["+w+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+g+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+b+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(v===1)+`) {

              if (`+b+`) {
                dotProd +=
                    getX(batch, xR, xC, `+g+`) *
                    getW(wR, wC, `+g+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+g+`, xR, xC) *
                    getW(wR, wC, `+g+`, d2);
              }

            } else if (`+(v===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+g+`, d2),
                getW(wR, wC, `+g+` + 1, d2)
              );

              if (`+b+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+g+`),
                  getX(batch, xR, xC, `+g+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+g+`, xR, xC),
                  getX(batch, `+g+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(v===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+g+`, d2),
                getW(wR, wC, `+g+` + 1, d2),
                getW(wR, wC, `+g+` + 2, d2)
              );

              if (`+b+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+g+`),
                  getX(batch, xR, xC, `+g+` + 1),
                  getX(batch, xR, xC, `+g+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+g+`, xR, xC),
                  getX(batch, `+g+` + 1, xR, xC),
                  getX(batch, `+g+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+D+`
        `+I+`
        setOutput(result);
      }
    `},lz=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,g=n.filterWidth,v=4*Math.floor(n.inChannels/4),b=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+a+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+d+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+g+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+v+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(b===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+v+`) *
                  getW(wF, wR, wC, `+v+`, d2);
              } else if (`+(b===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+v+`),
                  getX(batch, xF, xR, xC, `+v+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+v+`, d2),
                  getW(wF, wR, wC, `+v+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(b===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+v+`),
                  getX(batch, xF, xR, xC, `+v+` + 1),
                  getX(batch, xF, xR, xC, `+v+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+v+`, d2),
                  getW(wF, wR, wC, `+v+` + 1, d2),
                  getW(wF, wR, wC, `+v+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},FA=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,a=n.inWidth,s=n.padInfo.top,u=n.padInfo.left,c=n.strideHeight,h=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,g=n.filterHeight,v=n.filterWidth,b=n.outChannels/n.inChannels,E="",w="";t&&(E=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,w="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+E+`

      const ivec2 strides = ivec2(`+c+", "+h+`);
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+b+`;
        int q = d2 - d1 * `+b+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+g+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+C+`
        `+w+`
        setOutput(result);
      }
    `},VA=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,a=n.inWidth,s=n.padInfo.top,u=n.padInfo.left,c=n.strideHeight,h=n.strideWidth,d=n.dilationHeight,p=n.dilationWidth,g=n.filterHeight,v=n.filterWidth,b=v,E="int xR; int xC; int xCOffset;",w=0;w<g;w++)for(var C=0;C<v;C++)E+=`
          vec4 xTexelR`+w+"C"+2*C+` = vec4(0.);
          vec4 wR`+w+"C"+C+` = vec4(0.);
          vec4 xR`+w+"C"+C+" = vec4(0.);";for(w=0;w<g;w++)for(var S=0;S<b;S++){if(E+=`
          xR = xRCorner + `+w*d+`;
          xC = xCCorner + `+(C=2*S)*p+`;
        `,h===1){if(C<v&&(E+=u%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+w+"C"+C+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+w+"C"+C+" = vec4(previous.zw, xTexelR"+w+"C"+C+`.xy);
                } else {
                  xR`+w+"C"+C+" = vec4(0, 0, xTexelR"+w+"C"+C+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                xR`+w+"C"+C+" = xTexelR"+w+"C"+C+`;
              `,C+1<v)){var I=u%2==0?ek(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(E+=`
                  xCOffset = xC + `+u%2+" + "+I+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(E+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+w+"C"+C+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+w+"C"+C+` = vec4(0.);
                    }
                  `),E+=`
                  xR`+w+"C"+(C+1)+` = vec4(
                    xTexelR`+w+"C"+C+".zw, xTexelR"+w+"C"+(C+2)+`.xy);
                `):E+=`
                  xCOffset = xC + `+I+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+w+"C"+(C+1)+" = xTexelR"+w+"C"+(C+2)+`;
                `}}else C<v&&(E+=`
              if(xR >= 0 && xR < `+i+`) {
            `,u%2==1?(E+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+w+"C"+(C+2)+` = vec4(0.);
                }

                xR`+w+"C"+C+` = vec4(
                  xTexelR`+w+"C"+C+".zw, xTexelR"+w+"C"+(C+2)+`.zw);
              `,C+1<v&&(E+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+w+"C"+(C+1)+" = vec4(xTexelR"+w+"C"+(C+2)+`.xy, final.xy);
                `)):(E+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+w+"C"+C+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+w+"C"+C+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+w+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+(C+2)+` = vec4(0.);
                }

                xR`+w+"C"+C+` = vec4(
                  xTexelR`+w+"C"+C+".xy, xTexelR"+w+"C"+(C+2)+`.xy);
              `,C+1<v&&(E+=`
                  xR`+w+"C"+(C+1)+` = vec4(
                    xTexelR`+w+"C"+C+".zw, xTexelR"+w+"C"+(C+2)+`.zw);
                `)),E+="}");C<v&&(E+=`
            vec4 wTexelR`+w+"C"+C+" = getW("+w+", "+C+`, d1, q);
            wR`+w+"C"+C+" = vec4(wTexelR"+w+"C"+C+".xz, wTexelR"+w+"C"+C+`.xz);
          `,C+1<v&&(E+=`
              vec4 wTexelR`+w+"C"+(C+1)+" = getW("+w+", "+(C+1)+`, d1, q);
              wR`+w+"C"+(C+1)+` =
                vec4(wTexelR`+w+"C"+(C+1)+".xz, wTexelR"+w+"C"+(C+1)+".xz);"))}for(w=0;w<g;w++)for(C=0;C<v;C++)E+="dotProd += xR"+w+"C"+C+" * wR"+w+"C"+C+";";var D="",O="";t&&(D=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,O="result = activation(result);");var B=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+D+`

      const ivec2 strides = ivec2(`+c+", "+h+`);
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+E+`

        vec4 result = dotProd;
        `+B+`
        `+O+`
        setOutput(result);
      }
    `},cz=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=n[0],s=n[1],u=n[2],c=n[3],h=e[0],d=t[0],p=t[1];this.outputShape=[h,d,p,c];var g=r==="bilinear"?1:0,v=[s-1+".0",u-1+".0"],b=v[0],E=v[1],w=d>1?[""+(s-1)/(d-1),"(y2-y1) * height_ratio","y1*"+b+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+b],C=w[0],S=w[1],I=w[2],D=p>1?[""+(u-1)/(p-1),"(x2-x1) * width_ratio","x1*"+E+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+E],O=D[0],B=D[1],N=D[2];this.userCode=`
      const float height_ratio = float(`+C+`);
      const float width_ratio = float(`+O+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+S+`;
        float width_scale = `+B+`;

        float in_y = `+I+`;
        if( in_y < 0.0 || in_y > `+b+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+N+`;
        if( in_x < 0.0 || in_x > `+E+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+g+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},hz=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],a=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Kt(r)+` coords = getOutputCoords();
        int end = `+LA(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+LA(r,"coords")+` = idx;
          val += getX(`+(function(s,u){if(s===1)return""+u;if(s===2)return u+".x, "+u+".y";if(s===3)return u+".x, "+u+".y, "+u+".z";if(s===4)return u+".x, "+u+".y, "+u+".z, "+u+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function LA(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var fz=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ud.DENSE;var e=Hf(n),t=Rr();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Gu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},dz=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ud.DENSE;var e=Hf(n),t=Rr();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Gu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},pz=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),mz=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},gz=function(n){this.variableNames=["A"],this.outTexUsage=pi.DOWNLOAD;var e=Rr();this.outputShape=n,this.userCode=`
      `+Mk+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},vz=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=pi.DOWNLOAD;var e=Rr();this.outputShape=n,this.userCode=`
      `+Mk+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},yz=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Rr(),i=e[0],a=e[1];this.outputShape=n;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+Ix(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},_z=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Rr(),i=e[0],a=e[1];this.outputShape=n;var s="",u="result";t&&(u="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var h=0;h<=1;h++){var d=2*c+h;s+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+n[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+c+" < "+n[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+d+`] = values[0];
              } else if(offset == 1) {
                result[`+d+`] = values[1];
              } else if(offset == 2) {
                result[`+d+`] = values[2];
              } else {
                result[`+d+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Ix(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+r.output+" = "+u+`;
      }
    `},bz="return real * expR - imag * expI;",xz="return real * expI + imag * expR;",BA=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},wz=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),Ez=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Kt(this.rank),a=(function(s,u){var c=s.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],p=0;p<s.length;p++)p===u?d.push("int(getIndices("+h[p]+"))"):d.push(""+h[p]);return d.join()})(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},Tz=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Kt(e.length),i=Kt(t.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function Cz(n,e){var t=Rr();return b5(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Sz(n,e){return C5(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Az(n,e){return S5(n,e,new Uint16Array([0,1,2,2,1,3]))}function Pd(n,e,t,r,i,a,s){R5(t,r);var u=A5(n,e),c=n.TEXTURE_2D;return Ue(n,e,(function(){return n.bindTexture(c,u)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_MIN_FILTER,n.NEAREST)})),Ue(n,e,(function(){return n.texParameteri(c,n.TEXTURE_MAG_FILTER,n.NEAREST)})),Ue(n,e,(function(){return n.texImage2D(c,0,i,t,r,0,a,s,null)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),u}function Rz(n,e,t,r,i){var a=fv(t,r);return Pd(n,e,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function Iz(n,e,t,r,i){var a=fv(t,r);return Pd(n,e,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Nz(n,e,t,r,i){var a=fv(t,r);return Pd(n,e,a[0],a[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function Dz(n,e,t,r,i){var a=Od(t,r);return Pd(n,e,a[0],a[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function kz(n,e,t,r,i){var a=Od(t,r);return Pd(n,e,a[0],a[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function Mz(n,e,t,r){return Ue(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),SA(n,e,t,"clipSpacePos",r,3,20,0)&&SA(n,e,t,"uv",r,2,20,12)}function Oz(n,e,t,r,i,a,s){var u,c,h;Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),a instanceof Uint8Array?(u=new Uint8Array(r*i*4),c=n.UNSIGNED_BYTE,h=n.RGBA):(u=new Float32Array(r*i*4),c=n.FLOAT,h=s.internalFormatPackedFloat),u.set(a),Ue(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,h,r,i,0,n.RGBA,c,u)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function Pz(n,e,t,r){Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),r.data instanceof Uint8Array?Ue(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)})):Ue(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)})),Ue(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function Fz(n,e,t,r,i){var a=n.createBuffer();Ue(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)}));var s=16*t*r;return Ue(n,e,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)})),Ue(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)})),Ue(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),a}function Vz(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function Lz(n,e,t,r,i){var a=fv(t,r),s=a[0],u=a[1],c=new Uint8Array(t*r*4);return Ue(n,e,(function(){return n.readPixels(0,0,s,u,i.downloadTextureFormat,n.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}function Bz(n,e,t,r,i,a,s,u){var c=n,h=new Float32Array((function(d,p){var g=Od(d,p);return g[0]*g[1]*4})(a,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,h),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),h}function jz(n,e,t,r){var i=new Float32Array(t*r*4);return Ue(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)})),i}var Uz=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=ge().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,m5(t,e)):this.gl=es(t);var r="WEBGL_color_buffer_float";if(ge().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Im(this.gl,this.debug,"OES_texture_float"),Li(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Im(this.gl,this.debug,"OES_texture_half_float");else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Li(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Im(this.gl,this.debug,"EXT_color_buffer_half_float");else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Li(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Li(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Sz(this.gl,this.debug),this.indexBuffer=Az(this.gl,this.debug),this.framebuffer=I5(this.gl,this.debug),this.textureConfig=_x(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return ge().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ue(t,this.debug,(function(){return t.finish()})),Ue(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Ue(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Ue(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Ue(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Ue(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Rz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Iz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Nz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Pz(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),Oz(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),kz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Dz(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(AA(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ue(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return Lz(i.gl,i.debug,t,r,i.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,a,s){return Bz(this.gl,e,0,0,0,a,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Vz(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=Fz(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(ge().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,s=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var u=a.clientWaitSync(s,0,0);return u===a.ALREADY_SIGNALED||u===a.CONDITION_SATISFIED},t=s}else ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return jz(i.gl,i.debug,t,r)}))},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=x5(t,this.debug,e),i=Cz(t,this.debug),a=E5(t,this.debug);return Ue(t,this.debug,(function(){return t.attachShader(a,i)})),Ue(t,this.debug,(function(){return t.attachShader(a,r)})),T5(t,this.debug,a),this.debug&&E_(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=Mz(t,this.debug,this.program,this.vertexBuffer)),a},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Ue(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&E_(this.gl,this.debug,this.program),Ue(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?D5(this.gl,this.debug,e,t):k5(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Ue(this.gl,this.debug,(function(){return r.gl.getAttribLocation(e,t)}))},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),M5(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=Od(t,r),a=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,a,s)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&E_(this.gl,this.debug,this.program),Nm(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ue(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ue(this.gl,this.debug,(function(){return e.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Im(this.gl,this.debug,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),a=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,a),a},n.prototype.endQuery=function(){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Ve(this,void 0,void 0,(function(){var t=this;return Le(this,(function(r){switch(r.label){case 0:return[4,bA((function(){return t.disposed||t.isQueryAvailable(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var e=(function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||bA((function(){return r.pollItems(),r.itemsToPoll.length===0}))},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),T_(this.gl,this.debug,e,this.framebuffer),this.debug&&Nm(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(T_(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Nm(this.gl)):AA(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;T_(i,this.debug,e,this.framebuffer),this.debug&&Nm(i),this.outputTexture=e,Ue(i,this.debug,(function(){return i.viewport(0,0,t,r)})),Ue(i,this.debug,(function(){return i.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var a=this;this.throwIfDisposed(),Ue(this.gl,this.debug,(function(){return a.gl.scissor(e,t,r,i)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function jA(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach((function(t,r){var i=t.logicalShape,a=e[r],s=a.shape;if(!rr(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!a.isUniform){var u=t.texShape,c=a.isUniform?null:a.texData.texShape;if(!rr(u,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+c+" must match")}}))}var zz=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,a=t.strideWidth,s=t.strideHeight,u=t.padInfo,c=t.outWidth,h=t.dilationWidth,d=t.dilationHeight,p=t.dataFormat,g=u.left,v=u.top,b=i*r,E=Rr(),w=p==="channelsLast",C=w?0:1,S=w?1:2,I="",D=0;D<=1;D++)for(var O=0;O<=1;O++)I+=`
          blockIndex = rc.y + `+O+`;
          pos = rc.x + `+D+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+s+" - "+v+`;
            d0 = offsetY + `+d+" * (pos / "+b+`);

            if(d0 < `+e[C]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+a+". - "+g+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+b+".) / "+i+`.));

              if(d1 < `+e[S]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+w+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*D+O)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*D+O)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+I+`

        `+E.output+` = result;
      }
    `},Hz=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var a,s=e,u=n[3]-1;this.outputShape=n;var c="float("+t+") + float("+r+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},Gz=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Wz=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,s=e,u=n[3]-1;this.outputShape=n;var c="float("+t+") + float("+r+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+u+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},qz=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,a=n.effectiveFilterWidth,s=i-1-n.padInfo.top,u=a-1-n.padInfo.left,c=i*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},Kz=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterDepth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,d=u-1-n.padInfo.front,p=c-1-n.padInfo.top,g=h-1-n.padInfo.left,v=u*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+v+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},I_=function(n,e,t,r,i,a,s){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),a===void 0&&(a=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=t?n[1]:n[2],c=Math.ceil(u/2),h=t?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",p=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",b="";a&&(v=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,b="result = activation(result);");var E=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+d+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+g[0]+`);
          result += (`+p[1]+" * "+g[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+E+`

        `+b+`

        setOutput(result);
      }
    `},Xz=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),Yz=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},$z=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=$r("rc",e),r=Kt(e),i=(function(u,c,h){if(u===1)return"rc > "+c[0];for(var d="",p=u-2;p<u;p++)d+=h[p]+" >= "+c[p],p<u-1&&(d+="||");return d})(e,n,t),a=(function(u,c,h,d){if(u===1)return"";var p=d.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+h+`;
  `})(e,n[n.length-1],n[n.length-2],t),s=(function(u,c){var h=u.length,d=(function(p,g){for(var v=[],b=0;b<=1;b++)for(var E=0;E<=1;E++){for(var w=(b===0?"r":"rp1")+", "+(E===0?"c":"cp1"),C=2;C<p;C++)w=g[g.length-1-C]+","+w;v.push(w)}return v})(h,c);return h===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+d[0]+`),
          cEdge ? 0. : getA(`+d[1]+`),
          rEdge ? 0. : getA(`+d[2]+`),
          rEdge || cEdge ? 0. : getA(`+d[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},Qz=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map((function(c,h){return c[0]+n[h]+c[1]}));var r=n.length,i=Kt(r),a=e.map((function(c){return c[0]})).join(","),s=e.map((function(c,h){return c[0]+n[h]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+a+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},Zz=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(w,C){return w[0]+n[C]+w[1]}));for(var r=n.length,i=Kt(r),a=e.map((function(w){return w[0]})).join(","),s=e.map((function(w,C){return w[0]+n[C]})).join(","),u=$r("rc",r),c=$r("source",r),h=u[r-1]+" < "+this.outputShape[r-1],d=r===1?"source":"vec2("+c.slice(-2).join()+")",p=[i+" rc = outputLoc;",u[r-1]+` += 1;
       if(`+h+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+u[r-2]+` += 1;
       if(`+u[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+u[r-1]+` += 1;
         if(`+h+") {"],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",v="",b=0,E=r===1?2:4;b<E;b++)v+=`
        `+p[b]+`
        if (`+g+`) {
          result[`+b+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+b+"] = getChannel(getX("+c.join()+"), "+d+`);
        }
      `;v+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+a+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+v+`
        setOutput(result);
      }
    `},N_=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,d=n.padInfo.top,p=n.padInfo.left;this.outputShape=n.outShape;var g=e==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+a+`);
        const ivec2 pads = ivec2(`+d+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(b="avgValue / count");var E=4*Math.floor(r/4),w=r%4,C=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+d+", "+p+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+E+`; wC += 4) {
            int xC = xCCorner + wC * `+u+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              getValue(batch, xR, xC + 3 * `+u+`, d)
            );

            `+C+`
          }

          int xC = xCCorner + `+E+`;
          if (`+(w===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(w===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(w===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              initializationValue
            );

            `+C+`
          }
        }
        setOutput(`+b+`);
      }
    `}},D_=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,g=n.effectiveFilterWidth,v=n.padInfo.front,b=n.padInfo.top,E=n.padInfo.left;this.outputShape=n.outShape;var w=e==="avg",C="0.0";if(w||(C="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+a+", "+s+`);
        const ivec3 pads = ivec3(`+v+", "+b+", "+E+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+u+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+g+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+p+" * "+g+` +
                      wR * `+g+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var S=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(S="avgValue / count");var I=4*Math.floor(r/4),D=r%4,O=`
      if (`+w+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+a+", "+s+`);
      const ivec3 pads = ivec3(`+v+", "+b+", "+E+`);
      const float initializationValue = `+C+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+C+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+I+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+O+`
            }

            int xC = xCCorner + `+I+`;
            if (`+(D===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+O+`
            } else if (`+(D===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+O+`
            } else if (`+(D===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+O+`
            }
          }
          setOutput(`+S+`);
        }
      }
    `}},Jz=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,a=Math.ceil(i/t);this.outputShape=[r,a];var s="0.0",u="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",u="min"):e==="max"&&(s="-1.0 / 1e-20",u="max");var c=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");var h=4*Math.floor(t/4),d=t%4,p=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,g="vec4";e==="all"?(s="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):e==="any"&&(s="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");var v="";i%t>0&&(v=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+v+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(d===1)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===2)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(d===3)+`) {
          `+g+" values = "+g+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+c+`);
      }
    `},e9=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Gu(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Ix(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},t9=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],a=r[2],s=n.shape,u=s[1],c=s[2],h=[t&&u>1?i-1:i,t&&c>1?a-1:a],d=[t&&u>1?u-1:u,t&&c>1?c-1:c],p=h[0]/d[0],g=h[1]/d[1],v=1/p,b=1/g,E=2*Math.ceil(v)+2,w=2*Math.ceil(b)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+g+`);

        const float invHeightScale = float(`+v+`);
        const float invWidthScale = float(`+b+`);

        const int winHeight = int(`+E+`);
        const int winWidth = int(`+w+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},n9=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],a=n[1],s=n[2],u=n[3];this.outputShape=[i,e,t,u];var c=[r&&e>1?a-1:a,r&&t>1?s-1:s],h=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},r9=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],a=n[1],s=n[2],u=n[3];this.outputShape=[i,e,t,u];var c=[r&&e>1?a-1:a,r&&t>1?s-1:s],h=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`,
          `+c[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},i9=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],a=r[2],s=n.shape,u=s[1],c=s[2],h=[t&&u>1?i-1:i,t&&c>1?a-1:a],d=[t&&u>1?u-1:u,t&&c>1?c-1:c],p=h[0]/d[0],g=h[1]/d[1],v=1/p,b=1/g,E=2*Math.ceil(v)+2,w=2*Math.ceil(b)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+g+`);

        const float invHeightScale = float(`+v+`);
        const float invWidthScale = float(`+b+`);

        const int winHeight = int(`+E+`);
        const int winWidth = int(`+w+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+d[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+d[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},a9=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],a=n[1],s=n[2],u=n[3];this.outputShape=[i,e,t,u];var c=[r&&e>1?a-1:a,r&&t>1?s-1:s],h=[r&&e>1?e-1:e,r&&t>1?t-1:t],d=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+d+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},s9=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map((function(a,s){return(function(u){return e.indexOf(u)!==-1&&n[u]!==1?n[u]+" - coords["+u+"] - 1":"coords["+u+"]"})(s)})).join(","),i=Kt(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},o9=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=$r("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],a=r[t-2]+" + 1 < "+this.outputShape[t-2],s=Kt(t);function u(c){var h=n.map((function(d,p){return(function(g,v){return e.indexOf(g)!==-1&&n[g]!==1?n[g]+" - "+v[g]+" - 1":""+v[g]})(p,c)}));return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(c){return u(c)})(r.slice())+`;
          if(`+i+`){
            result.g = `+(function(c){return c[t-1]="("+c[t-1]+" + 1)",u(c)})(r.slice())+`;
          }
          if(`+a+`) {
            result.b = `+(function(c){return c[t-2]="("+c[t-2]+" + 1)",u(c)})(r.slice())+`;
            if(`+i+`) {
              result.a = `+(function(c){return c[t-1]="("+c[t-1]+" + 1)",c[t-2]="("+c[t-2]+" + 1)",u(c)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},UA=function(n,e,t,r,i,a,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var u=Kt(i.length),c=Kt(a.length),h="";t===1?h="i":t===2&&(h="i, j");var d="getIndices("+h+")",p="";r===1?p="i":r===2&&(p="i, coords[1]");var g="getUpdates("+p+")",v=e>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+i+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+d+`);
              flattenedIndex += index * `+v+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+g+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},u9=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,a=n.numSegments,s=a*Math.ceil(i/t);this.outputShape=[r,s];var u=4*Math.floor(t/4),c=t%4,h=`
        sumValue += dot(values, segFilter);
    `,d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var p="";i%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `},l9=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<e.length;c++)u.push(""+a[c]),c<n&&s.push(""+a[c]);r=s.join(),i=u.join()}var h=Kt(t);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},c9=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Kt(this.rank),i="uniform int start["+this.rank+"];",a=(function(s){if(s===1)return"sourceLoc";if(s<=6)return k_.slice(0,s).map((function(u){return"sourceLoc."+u})).join(",");throw Error("Slicing for rank "+s+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map((function(s,u){return"sourceLoc."+k_[u]+" = start["+u+"] + coords."+k_[u]+";"})).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+a+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),k_=["x","y","z","w","u","v"],h9=(function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Kt(this.rank),r=$r("coords",this.rank),i=$r("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+a+")",u=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(d,p){return"start["+p+"]"})).join()+");":e.map((function(d,p){return i[p]+" = "+r[p]+" + start["+p+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+u+`
        `+c+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),f9=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=Kt(t.length),a=Kt(t.length),s="";if(r===1)s="coords * strides + begin";else{var u=0;s=t.map((function(c,h){return u++,t.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(u-1)+"] * strides["+h+"] + begin["+h+"]"})).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},d9=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,a=zA(t,r),s=HA(e,a,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[s].shift();return this.usedTextures[s].push(u),u}return this.numUsedTextures++,this.log(),a===di.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===di.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===di.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===di.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===di.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var a=HA(t,zA(r,i),i);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[a],u=s.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(u,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){e.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(i){e.gpgpu.deleteMatrixTexture(i)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function zA(n,e){if(n===pi.UPLOAD)return di.PACKED_2X2_FLOAT32;if(n===pi.RENDER||n==null)return(function(t){return ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?di.PACKED_2X2_FLOAT32:di.UNPACKED_FLOAT32:t?di.PACKED_2X2_FLOAT16:di.UNPACKED_FLOAT16})(e);if(n===pi.DOWNLOAD||n===pi.PIXELS)return di.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function HA(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var p9=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Kt(this.rank),a=(function(s){var u=s.length;if(u>5)throw Error("Tile for rank "+u+" is not yet supported");if(u===1)return"imod(resRC, "+s[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],d=0;d<s.length;d++)h.push("imod("+c[d]+", "+s[d]+")");return h.join()})(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},m9=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Kt(this.rank),a=(function(s){var u=s.length;if(u>6)throw Error("Transpose for rank "+u+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(u),d=0;d<s.length;d++)h[s[d]]=c[d];return h.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},g9=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Kt(this.rank),a=kk("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=a[r];var u="vec2("+s.slice(-2).join()+")",c="++"+a[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+s.join()+"), "+u+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+c+`) {
        result[1] = `+h+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+c+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `},Nx=1.7580993408473768,Dx=1.0507009873554805,ht=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},fa="if (isnan(x)) return x;",v9="return x;",GA="return abs(x);",Vk=fa+`
  return (x < 0.0) ? 0.0 : x;
`,Lk=fa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Bk="return (x >= 0.0) ? x : (exp(x) - 1.0);",y9=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Nx+`;
  float scale = `+Dx+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,WA="return -x;",qA="return ceil(x);",KA="return floor(x);",XA="return exp(x);",YA="return exp(x) - 1.0;",_9=fa+`
  return sin(x);
`,b9=fa+`
  return cos(x);
`,x9=fa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,w9=fa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,E9=fa+`
  return atan(x);
`,T9=fa+"return log(x + sqrt(x * x + 1.0));",C9=fa+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,S9=fa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Om="return x;",A9="return x;",jk=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Uk=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zk=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,If=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},R9=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=$r("rc",e),r=Kt(e),i=(function(u,c){if(u===1)return"rc";for(var h="",d=0;d<u;d++)h+=c[d],d<u-1&&(h+=",");return h})(e,t),a=t.slice(-2),s=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},Pm={};function Fm(n,e){if(e===void 0&&(e=!1),n==="linear")return e?A9:v9;if(n==="relu")return e?jk:Vk;if(n==="elu")return e?zk:Bk;if(n==="relu6")return e?Uk:Lk;if(n==="prelu")return e?Fk:Pk;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var I9=600,N9=(function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!ge().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var a=es(ge().getNumber("WEBGL_VERSION"));i.binaryCache=((r=ge().getNumber("WEBGL_VERSION"))in Pm||(Pm[r]={}),Pm[r]),i.gpgpu=new Uz(a),i.canvas=a.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new d9(i.gpgpu),i.numMBBeforeWarning=ge().global.screen==null?1024:ge().global.screen.height*ge().global.screen.width*window.devicePixelRatio*I9/1024/1024,i.texData=new Ek(i,J),i}return ha(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:r,dtype:i,values:t,usage:pi.UPLOAD}),a},e.prototype.move=function(t,r,i,a){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(r),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:a,values:r,usage:pi.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,a=r.dtype,s=r.complexTensors,u=r.slice,c=r.shape,h=r.isPacked;if(u!=null){var d=void 0;d=h?new If(c,Om):new ht(c,Om);var p=this.runWebGLProgram(d,[{dataId:t,shape:c,dtype:a}],a),g=this.readSync(p.dataId);return this.disposeData(p.dataId),g}if(i!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return i;var v,b,E=this.activeTimers!=null;return E&&(v=La()),a==="complex64"?b=Hb(s.real.dataSync(),s.imag.dataSync()):b=this.getValuesFromTexture(t),E&&(this.downloadWaitMs+=La()-v),this.convertAndCacheOnCPU(t,b)},e.prototype.read=function(t){return Ve(this,void 0,void 0,(function(){var r,i,a,s,u,c,h,d,p,g,v,b,E,w,C,S,I,D,O,B,N,R;return Le(this,(function(k){switch(k.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(P){return r.push(P)}))];if(i=this.texData.get(t),a=i.values,s=i.shape,u=i.slice,c=i.dtype,h=i.complexTensors,d=i.isPacked,u!=null)return p=void 0,p=d?new If(s,Om):new ht(s,Om),g=this.runWebGLProgram(p,[{dataId:t,shape:s,dtype:c}],c),v=this.read(g.dataId),this.disposeData(g.dataId),[2,v];if(a!=null)return[2,this.convertAndCacheOnCPU(t)];if(!ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ge().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return b=null,c!=="complex64"&&ge().get("WEBGL_BUFFER_SUPPORTED")&&(E=this.decode(t),w=this.texData.get(E.dataId),b=(R=this.gpgpu).createBufferFromTexture.apply(R,[w.texture].concat(Hf(s)))),this.pendingRead.set(t,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:k.sent(),k.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return S=k.sent(),I=S[0],D=S[1],C=Hb(I,D),[3,5];case 4:b==null?C=this.getValuesFromTexture(t):(O=je(s),C=this.gpgpu.downloadFloat32MatrixFromBuffer(b,O)),k.label=5;case 5:return E!=null&&this.disposeData(E.dataId),B=this.convertAndCacheOnCPU(t,C),N=this.pendingRead.get(t),this.pendingRead.delete(t),N.forEach((function(P){return P(B)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,B]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!y5(i))throw ge().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),a=i.shape,s=i.dtype,u=i.isPacked,c=je(a);if(ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(t),d=this.texData.get(h.dataId),p=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[d.texture].concat(Hf(a))).subarray(0,c);return this.disposeData(h.dataId),p}var g=ge().getBool("WEBGL_PACK")&&u===!0,v=g?C_(a):a,b=g?new vz(v):new gz(v),E=this.runWebGLProgram(b,[{shape:v,dtype:s,dataId:t}],"float32"),w=this.texData.get(E.dataId),C=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(w.texture,w.texShape[0],w.texShape[1]).subarray(0,c);return this.disposeData(E.dataId),C},e.prototype.time=function(t){return Ve(this,void 0,void 0,(function(){var r,i,a,s,u,c,h;return Le(this,(function(d){switch(d.label){case 0:return r=this.activeTimers,i=[],a=!1,this.programTimersStack==null?(this.programTimersStack=i,a=!0):this.activeTimers.push(i),this.activeTimers=i,t(),s=qc(this.activeTimers.map((function(p){return p.query}))).filter((function(p){return p!=null})),u=qc(this.activeTimers.map((function(p){return p.name}))).filter((function(p){return p!=null})),this.activeTimers=r,a&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return h=d.sent(),c.kernelMs=Z6(h),c.getExtraProfileInfo=function(){return h.map((function(p,g){return{name:u[g],ms:p}})).map((function(p){return p.name+": "+p.ms})).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:La(),endMs:null}},e.prototype.endTimer=function(t){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=La(),t)},e.prototype.getQueryTime=function(t){return Ve(this,void 0,void 0,(function(){var r;return Le(this,(function(i){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,a=r.dtype,s=r.texShape,u=r.usage,c=r.isPacked,h=r.slice,d=h&&h.origDataId||t,p=this.dataRefCount.get(d);p>1?this.dataRefCount.set(d,p-1):(this.dataRefCount.delete(d),i!=null&&(this.numBytesInGPU-=this.computeBytes(s,a),this.textureManager.releaseTexture(i,s,u,c)));var g=this.texData.get(t);g.texture=null,g.texShape=null,g.isPacked=!1,g.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return ge().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=J.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(a){return i.texData.get(a.dataId).texture==null&&a.size<r}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:J.keep(t.clone()),imag:J.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(je(i)===0)return pr([],i,t.dtype);var a=this.texData.get(t.dataId).isPacked,s=xk(t.shape,r,i);if(a||!s){var u=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new h9(i):new c9(i),c=u.getCustomSetupFunc(r);return this.compileAndRun(u,[t],null,c)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var a=this.texData.get(t.dataId),s=this.makeOutput(i,t.dtype),u=this.texData.get(s.dataId);Object.assign(u,a),u.shape=i,u.dtype=t.dtype;var c=wk(r,t.strides);a.slice&&(c+=a.slice.flatOffset),u.slice={flatOffset:c,origDataId:a.slice&&a.slice.origDataId||t.dataId};var h=this.dataRefCount.get(u.slice.origDataId)||1;return this.dataRefCount.set(u.slice.origDataId,h+1),s},e.prototype.stridedSlice=function(t,r,i,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,a);var s=Tx(r,i,a);if(s.some((function(c){return c===0})))return pr([],s);var u=new f9(r,a,s);return this.compileAndRun(u,[t])},e.prototype.reverse=function(t,r){var i=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new o9(t.shape,r):new s9(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map((function(v){return Pi(v)})),a=t.map((function(v){return ja(v)}));return fr(this.concat(i,r),this.concat(a,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),u=this.concat(t.slice(0,s),r),c=this.concat(t.slice(s),r);return this.concat([u,c],r)}if(ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var h=new nz(t.map((function(v){return v.shape})),r);return this.compileAndRun(h,t)}var d=Xc(t.map((function(v){return v.shape})),r),p=t.map((function(v){return v.as2D(-1,je(v.shape.slice(r)))})),g=new tz(p.map((function(v){return v.shape})));return this.compileAndRun(g,p).reshape(d)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,WA,t.dtype);var r=new ht(t.shape,WA);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,a){var s=i?t.shape[2]:t.shape[1],u=a?r.shape[1]:r.shape[2],c=i?t.shape[1]:t.shape[2],h=t.shape[0];if((s===1||u===1)&&c>1e3){i&&(t=t.transpose([0,2,1])),a&&(r=r.transpose([0,2,1]));var d=u===1?t:t.as3D(h,c,1),p=u===1?2:1,g=u===1?r.as3D(h,1,c):r;return this.multiply(d,g).sum(p,!0)}var v=dr(t.dtype,r.dtype),b=new I_(t.shape,[h,s,u],i,a);return this.compileAndRun(b,[t,r],v)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,a=t.transposeA,s=t.transposeB,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=a?r.shape[2]:r.shape[1],p=s?i.shape[1]:i.shape[2],g=r.shape[0],v=dr(r.dtype,i.dtype),b=u!=null,E=h!=null,w=c?Fm(c,!0):null,C=new I_(r.shape,[g,d,p],a,s,b,w,E),S=[r,i];return u&&S.push(u),h&&S.push(h),this.compileAndRun(C,S,v)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),a=this.texData.get(r.dataId),s=new MA($U,t.shape,r.shape),u=new MA(QU,t.shape,r.shape),c=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,a.complexTensors.real),this.makeComplexComponentTensorInfo(r,a.complexTensors.imag)],h=this.compileAndRun(s,c),d=this.compileAndRun(u,c),p=this.complex(h,d);return h.dispose(),d.dispose(),p}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,OA,t.dtype);var g=new fn(OA,t.shape,r.shape);return this.compileAndRun(g,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,a,s,u){var c=[t,r,i],h=null;u!=null&&(h=u.shape,c.push(u));var d=null;if(s!=null&&(d=s.shape,c.push(s)),ge().getBool("WEBGL_PACK_NORMALIZATION")){var p=new YU(t.shape,r.shape,i.shape,h,d,a);return this.compileAndRun(p,c)}var g=new XU(t.shape,r.shape,i.shape,h,d,a);return this.compileAndRun(g,c)},e.prototype.localResponseNormalization4D=function(t,r,i,a,s){var u=ge().getBool("WEBGL_PACK_NORMALIZATION")?new Wz(t.shape,r,i,a,s):new Hz(t.shape,r,i,a,s);return this.compileAndRun(u,[t])},e.prototype.LRNGrad=function(t,r,i,a,s,u,c){var h=new Gz(r.shape,a,s,u,c);return this.compileAndRun(h,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map((function(s){return vg(s)}));return Nk(it(t.shape,t.dtype,i),r)}var a=new p9(t.shape,r);return this.compileAndRun(a,[t])},e.prototype.pad=function(t,r,i){var a=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zz(t.shape,r,i):new Qz(t.shape,r,i);return this.compileAndRun(a,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new g9(t.shape,r):new m9(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var a=new Ez(t.shape,r.size,i);return this.compileAndRun(a,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){G(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var a=r.reduce((function(p,g){return p*g})),s=Eg(t.shape,r,a),u=Tg(s.length,r.length),c=Cg(t.shape,r,a),h=vk(i,r.length),d=yk(c,i,r.length);return t.reshape(s).transpose(u).reshape(c).slice(h,d)},e.prototype.spaceToBatchND=function(t,r,i){G(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var a=r.reduce((function(g,v){return g*v})),s=[[0,0]];s.push.apply(s,i);for(var u=1+r.length;u<t.shape.length;++u)s.push([0,0]);var c=t.pad(s),h=Eg(c.shape,r,a,!1),d=Tg(h.length,r.length,!1),p=Cg(c.shape,r,a,!1);return c.reshape(h).transpose(d).reshape(p)},e.prototype.reduce=function(t,r,i){var a=t.shape[0],s=t.shape[1],u=S_(s),c=new Jz({windowSize:u,inSize:s,batchSize:a},r),h=this.compileAndRun(c,[t],i);return h.shape[1]===1?h:this.reduce(h,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var a=t.shape[0],s=t.shape[1];i!=null&&(a=i.shape[0],s=i.shape[1]);var u=S_(s),c=new BU({windowSize:u,inSize:s,batchSize:a},r,i==null),h=[t];i!=null&&h.push(i);var d=this.compileAndRun(c,h,"int32");return d.shape[1]===1?d:this.argReduce(t,r,d)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var a=i!=null?i.shape:t.shape,s=S_(a[a.length-1]),u=new WU(a,s,r,i==null),c=i==null?[t]:[t,i],h=this.compileAndRun(u,c,"int32");return h.rank===t.rank?this.argReducePacked(t,r,h):h},e.prototype.sum=function(t,r){fi("sum",r,t.rank);var i=wr(t.shape,r),a=i[0],s=je(i[1]),u=t.as2D(-1,s),c=y_(t.dtype);return this.reduce(u,"sum",c).reshape(a)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=wr(t.shape,r),a=i[0],s=je(i[1]),u=t.as2D(-1,s),c=y_(t.dtype);return this.reduce(u,"prod",c).reshape(a)},e.prototype.unsortedSegmentSum=function(t,r,i){var a=0,s=ts([a],t.rank),u=t;s!=null&&(u=t.transpose(s),a=ns(1,t.rank)[0]);var c=(function(v,b,E){for(var w=[],C=v.length,S=0;S<C;S++)S!==b?w.push(v[S]):w.push(E);return w})(u.shape,a,i),h=je([u.shape[a]]),d=u.as2D(-1,h),p=y_(t.dtype),g=this.segOpCompute(d,"unsortedSegmentSum",r,p,i).reshape(c);return s!=null&&(g=g.transpose(bx(s))),g},e.prototype.segOpCompute=function(t,r,i,a,s){var u=t.shape[0],c=t.shape[1],h=(function(g,v){var b,E=!1;for(g<=bk?(b=g,E=!0):b=Ob(g,Math.floor(Math.sqrt(g)));!E;)b>v||b===g?E=!0:b=Ob(g,b+1);return b})(c,s),d=new u9({windowSize:h,inSize:c,batchSize:u,numSegments:s}),p=this.compileAndRun(d,[t,i],a);return p.shape[1]===s?p:(i=wg(0,s).tile([c/h]),this.segOpCompute(p,r,i,a,s))},e.prototype.argMinMaxReduce=function(t,r,i){var a=[r];if(fi("arg"+i.charAt(0).toUpperCase()+i.slice(1),a,t.rank),!ge().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=wr(t.shape,a),u=s[0],c=je(s[1]),h=t.as2D(-1,c);return this.argReduce(h,i).reshape(u)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,a){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var s=new hz(t.shape,i,a);return this.compileAndRun(s,[t])},e.prototype.equal=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new fn("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new fn("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new fn("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new fn("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new fn("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new fn("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new ht(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new fn("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new fn("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var a=new l9(t.rank,r.shape,r.rank);return this.compileAndRun(a,[t,r,i],dr(r.dtype,i.dtype))},e.prototype.where=function(t){bg("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Rx(t.shape,r)},e.prototype.topk=function(t,r,i){return Dk(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){fi("min",r,t.rank);var i=wr(t.shape,r),a=i[0],s=je(i[1]),u=t.as2D(-1,s);return this.reduce(u,"min",u.dtype).reshape(a)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);fi("max",r,t.rank);var i=wr(t.shape,r),a=i[0],s=je(i[1]),u=t.as2D(-1,s);return this.reduce(u,"max",u.dtype).reshape(a)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){fi("all",r,t.rank);var i=wr(t.shape,r),a=i[0],s=je(i[1]),u=t.as2D(-1,s);return this.reduce(u,"all",u.dtype).reshape(a)},e.prototype.any=function(t,r){fi("any",r,t.rank);var i=wr(t.shape,r),a=i[0],s=je(i[1]),u=t.as2D(-1,s);return this.reduce(u,"any",u.dtype).reshape(a)},e.prototype.realDivide=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new fn(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new fn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,A_);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=dr(t.dtype,r.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,A_,i);var a=new fn(A_,t.shape,r.shape);return this.compileAndRun(a,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var a=new If(t.shape,r);return this.compileAndRun(a,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,a,s){s===void 0&&(s=!1);var u=new Cs(i,t.shape,r.shape,s);return this.compileAndRun(u,[t,r],a)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var a=this,s=this.texData.get(t.dataId),u=this.texData.get(r.dataId),c=[[s.complexTensors.real,u.complexTensors.real],[s.complexTensors.imag,u.complexTensors.imag]].map((function(g){var v=g[0],b=g[1],E=a.makeComplexComponentTensorInfo(t,v),w=a.makeComplexComponentTensorInfo(r,b),C=new fn(i,t.shape,r.shape);return a.compileAndRun(C,[E,w],dr(v.dtype,b.dtype))})),h=c[0],d=c[1],p=this.complex(h,d);return h.dispose(),d.dispose(),p},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>ge().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),a=this.addN(t.slice(r));return this.addN([i,a])}var s=t.map((function(h){return h.dtype})).reduce((function(h,d){return dr(h,d)})),u=t.map((function(h){return h.shape})),c=ge().getBool("WEBGL_PACK")?new LU(t[0].shape,u):new VU(t[0].shape,u);return this.compileAndRun(c,t,s)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,R_);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=dr(t.dtype,r.dtype);if(ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,R_,t.dtype);var a=new fn(R_,t.shape,r.shape);return this.compileAndRun(a,[t,r],i)},e.prototype.pow=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),a=dr(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],a)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qA,t.dtype);var r=new ht(t.shape,qA);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,KA,t.dtype);var r=new ht(t.shape,KA);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new ht(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new ht(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new ht(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new ht(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new ht(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XA,t.dtype);var r=new ht(t.shape,XA);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,YA,t.dtype);var r=new ht(t.shape,YA);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Kn([r],t.shape),a=this.max(t,i),s=ti(a.shape,i),u=this.subtract(t,a.reshape(s)),c=this.exp(u),h=this.sum(c,i).reshape(s);return this.realDivide(c,h)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new ht(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new ht(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new ht(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new ht(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new ht(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=ge().getBool("WEBGL_PACK")?new If(t.shape,jk):new ht(t.shape,Vk),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=ge().getBool("WEBGL_PACK")?new If(t.shape,Uk):new ht(t.shape,Lk),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(Fk,t.shape,r.shape):new fn(Pk,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,zk,t.dtype);var r=new ht(t.shape,Bk);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new fn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new ht(t.shape,y9);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new ht(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var a,s=(a=ge().getBool("WEBGL_PACK_CLIP")?new JU(t.shape):new ZU(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(a,[t],null,s)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,GA,t.dtype);var r=new ht(t.shape,GA);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new ez(t.shape),a=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,a)},e.prototype.sigmoid=function(t){var r=new ht(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new ht(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new ht(t.shape,_9);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new ht(t.shape,b9);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new ht(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new ht(t.shape,x9);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new ht(t.shape,w9);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new ht(t.shape,E9);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new fn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new ht(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new ht(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new ht(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new ht(t.shape,T9);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new ht(t.shape,C9);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new ht(t.shape,S9);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new ht(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new ht(t.shape,(function(a){return a===void 0&&(a=0),fa+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `})(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,a,s,u){var c=t.shape,h=this.texData.get(t.dataId),d=i.inChannels,p=c[0]*c[1]*c[2],g=i.outChannels,v=i.dataFormat==="channelsLast",b=(p===1||g===1)&&d>1e3,E=c[2]%2!=0&&!!h.isPacked;if(b||!ge().getBool("WEBGL_LAZILY_UNPACK")||!ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!E){var w=v?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],C=this.reshape(t,[1,w,i.inChannels]),S=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:C,b:S,transposeA:!1,transposeB:!1,bias:a,activation:s,preluActivationWeights:u}),i.outShape)}var I=v?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),D={dataId:t.dataId,shape:[1,I,i.inChannels],dtype:t.dtype},O=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,G(km(h.shape,D.shape),(function(){return"packed reshape "+h.shape+" to "+D.shape+" isn't free"}));var B=this.reshape(r,[1,i.inChannels,i.outChannels]),N=this.fusedBatchMatMul({a:D,b:B,transposeA:!1,transposeB:!1,bias:a,activation:s,preluActivationWeights:u}),R=this.texData.get(N.dataId);return G(R.isPacked,(function(){return"batchMatMul result is expected to be packed"})),h.shape=O,R.shape=i.outShape,J.makeTensorFromDataId(N.dataId,i.outShape,N.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,a,s,u){var c=i.filterWidth,h=i.filterHeight,d=i.inChannels,p=i.outWidth,g=i.outHeight,v=i.dataFormat==="channelsLast",b=c*h*d,E=g*p,w=[b,E],C=t.squeeze([0]),S=r.reshape([1,b,-1]),I=new zz(w,C.shape,i),D=this.compileAndRun(I,[C]).reshape([1,w[0],w[1]]),O=a!=null,B=u!=null,N=s?Fm(s,!0):null,R=new I_(D.shape,[1,E,i.outChannels],!0,!1,O,N,B),k=[D,S];a&&k.push(a),B&&k.push(u);var P=this.compileAndRun(R,k);return v?P.reshape([1,g,p,i.outChannels]):P.reshape([1,i.outChannels,g,p])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,a,s,u,c);if(ge().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,a,s,u,c);var h=s!=null,d=c!=null,p=u?Fm(u,!1):null,g=new PA(a,h,p,d),v=[r,i];return s&&v.push(s),c&&v.push(c),this.compileAndRun(g,v)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(ge().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var a=new PA(i);return this.compileAndRun(a,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var a=new iz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var a=new rz(i);return this.compileAndRun(a,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,a=t.filter,s=t.convInfo,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,p=c?Fm(c,d):null,g=[i,a],v=u!=null,b=h!=null;return v&&g.push(u),b&&g.push(h),d?(r=new VA(s,v,p,b),this.compileAndRun(r,g)):(r=new FA(s,v,p,b),this.compileAndRun(r,g))},e.prototype.depthwiseConv2D=function(t,r,i){var a;return ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(a=new VA(i),this.compileAndRun(a,[t,r])):(a=new FA(i),this.compileAndRun(a,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var a=new uz(i);return this.compileAndRun(a,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var a=new oz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv3d=function(t,r,i){var a=new lz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var a=new sz(i);return this.compileAndRun(a,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var a=new az(i);return this.compileAndRun(a,[t,r])},e.prototype.maxPool=function(t,r){var i=new N_(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new N_(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,a){var s=new N_(a,"max",!0),u=this.compileAndRun(s,[r]),c=new qz(a),h=this.compileAndRun(c,[t,u],r.dtype);return u.dispose(),h},e.prototype.avgPoolBackprop=function(t,r,i){var a=new qU(i);return this.compileAndRun(a,[t],r.dtype)},e.prototype.cast=function(t,r){return Sk(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],a=new Array(t.rank-1),s=0,u=0;u<t.rank;u++)u!==r&&(a[s++]=t.shape[u]);var c=new Array(t.rank).fill(0),h=t.shape.slice();h[r]=1;var d=new Array(i);for(u=0;u<d.length;u++)c[r]=u,d[u]=this.slice(t,c,h).reshape(a);return d},e.prototype.avgPool3d=function(t,r){var i=new D_(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var a=new KU(i);return this.compileAndRun(a,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new D_(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,a){var s=new D_(a,"max",!0),u=this.compileAndRun(s,[r]),c=new Kz(a),h=this.compileAndRun(c,[t,u],r.dtype);return u.dispose(),h},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!km(t.shape,r)&&(i.texture===null||!km(i.shape,r))){var a=this.packedReshape(t,r);return J.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return zb(t,r)},e.prototype.resizeBilinear=function(t,r,i,a){var s=ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new r9(t.shape,r,i,a):new n9(t.shape,r,i,a);return this.compileAndRun(s,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var a=new t9(t,r,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,a){var s=new a9(t.shape,r,i,a);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var a=new i9(t,r,i);return this.compileAndRun(a,[t])},e.prototype.multinomial=function(t,r,i,a){var s=r?t:js(t),u=s.shape[0],c=s.shape[1],h=new Xz(u,c,i),d=h.getCustomSetupFunc(a);return this.compileAndRun(h,[s],"int32",d)},e.prototype.oneHot=function(t,r,i,a){var s=new Yz(t.size,r,i,a);return this.compileAndRun(s,[t])},e.prototype.diag=function(t){var r=new mz(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,a,s){return bg("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Sx(t.dataSync(),r.dataSync(),i,a,s)},e.prototype.cropAndResize=function(t,r,i,a,s,u){var c=new cz(t.shape,r.shape,a,s,u);return this.compileAndRun(c,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){G(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var a=t.shape[0],s=i==="NHWC"?t.shape[1]:t.shape[2],u=i==="NHWC"?t.shape[2]:t.shape[3],c=i==="NHWC"?t.shape[3]:t.shape[1],h=s*r,d=u*r,p=c/(r*r),g=new pz(i==="NHWC"?[a,h,d,p]:[a,p,h,d],r,i);return this.compileAndRun(g,[t])},e.prototype.split=function(t,r,i){return Ik(t,r,i)},e.prototype.scatterND=function(t,r,i){var a=Sg(0,t,i),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,h=a.strides,d=a.outputSize,p=[d/c,c],g=t.reshape([u,s]),v=r.reshape([u,c]);if(d===0)return zb(pr([]),i);var b=Ae(0),E=new UA(u,s,g.rank,v.rank,h,p);return this.compileAndRun(E,[v,g,b]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,a){var s=Sg(0,t,i),u=s.sliceRank,c=s.numUpdates,h=s.strides,d=s.outputSize,p=new UA(c,u,t.rank,r.rank,h,[d,1]);return this.compileAndRun(p,[r,t,a]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),a=new BA(bz,t.shape,r),s=new BA(xz,t.shape,r),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(a,u),h=this.compileAndRun(s,u),d=this.complex(c,h).as2D(t.shape[0],t.shape[1]);return c.dispose(),h.dispose(),d},e.prototype.gatherND=function(t,r){var i=r.shape,a=i[i.length-1],s=_k(t,r),u=s[0],c=s[1],h=s[2],d=s[3],p=r.reshape([c,a]),g=t.reshape([t.size/h,h]),v=new Tz(a,d,[c,h]);return this.compileAndRun(v,[g,p]).reshape(u)},e.prototype.fill=function(t,r,i){if((i=i||kd(r))==="string"){var a=gg(i,je(t));return a.fill(r),J.makeTensor(a,t,i,this)}var s=new wz(t,r),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,u)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return Ak(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return J.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new R9(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new $z(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[yg(t.shape)].concat(_g(t.shape)),a={dtype:t.dtype,shape:i,dataId:t.dataId},s=[yg(r)].concat(_g(r)),u=new e9(s,i),c=this.runWebGLProgram(u,[a],t.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),a=i.isPacked,s=i.shape,u=i.dtype,c=C_(s);return r=a?new dz(c):new fz(c),{dtype:u,shape:s,dataId:this.runWebGLProgram(r,[{shape:c,dtype:u,dataId:t}],u,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,a,s){var u=this;s===void 0&&(s=!1);var c=this.makeTensorInfo(t.outputShape,i),h=this.texData.get(c.dataId);if(t.packedOutput&&(h.isPacked=!0),t.outPackingScheme===ud.DENSE){var d=Hf(t.outputShape);h.texShape=d.map((function(I){return 2*I}))}if(t.outTexUsage!=null&&(h.usage=t.outTexUsage),je(c.shape)===0)return h.values=sd(c.dtype,0),c;var p=[],g=r.map((function(I){if(I.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var D=u.texData.get(I.dataId);if(D.texture==null){if(!t.packedInputs&&je(I.shape)<=ge().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:I.shape,texData:null,isUniform:!0,uniformValues:D.values};t.packedInputs&&(D.isPacked=!0,D.shape=I.shape)}else if(!!D.isPacked!=!!t.packedInputs)I=D.isPacked?u.unpackTensor(I):u.packTensor(I),p.push(I),D=u.texData.get(I.dataId);else if(D.isPacked&&!km(D.shape,I.shape)){var O=I,B=I.shape;I.shape=D.shape,I=u.packedReshape(I,B),p.push(I),D=u.texData.get(I.dataId),O.shape=B}return u.uploadToGPU(I.dataId),{shape:I.shape,texData:D,isUniform:!1}}));this.uploadToGPU(c.dataId);var v,b={shape:c.shape,texData:h,isUniform:!1},E=(function(I,D,O){var B="";D.concat(O).forEach((function(k){var P=k.texData!=null&&k.texData.slice!=null&&k.texData.slice.flatOffset>0,V=k.isUniform?"uniform":k.texData.texShape;B+=k.shape+"_"+V+"_"+P}));var N=I.userCode,R=I.constructor.name;return R+="_"+B+"_"+N})(t,g,b),w=this.getAndSaveBinary(E,(function(){return(function(I,D,O,B){var N=D.userCode,R=O.map((function(ee,ue){var fe={logicalShape:ee.shape,texShape:ee.isUniform?null:ee.texData.texShape,isUniform:ee.isUniform,isPacked:!ee.isUniform&&ee.texData.isPacked,flatOffset:null};return ee.texData!=null&&ee.texData.slice!=null&&ee.texData.slice.flatOffset>0&&(fe.flatOffset=ee.texData.slice.flatOffset),{name:D.variableNames[ue],shapeInfo:fe}})),k=R.map((function(ee){return ee.shapeInfo})),P={logicalShape:B.shape,texShape:B.texData.texShape,isUniform:!1,isPacked:B.texData.isPacked,flatOffset:null},V=jU(R,P,N,D.packedInputs),j=I.createProgram(V),L=null,Z=I.getUniformLocation(j,"NAN",!1);ge().getNumber("WEBGL_VERSION")===1&&(L=I.getUniformLocation(j,"INFINITY",!1));for(var ne={},q=0;q<D.variableNames.length;q++){var X=D.variableNames[q];ne[X]=I.getUniformLocation(j,X,!1),ne["offset"+X]=I.getUniformLocation(j,"offset"+X,!1)}return{program:D,source:V,webGLProgram:j,uniformLocations:ne,inShapeInfos:k,outShapeInfo:P,infLoc:L,nanLoc:Z}})(u.gpgpu,t,g,b)})),C=this.activeTimers!=null;if(C&&(v=this.startTimer()),(function(I,D,O,B,N){jA(D.inShapeInfos,O),jA([D.outShapeInfo],[B]);var R=B.texData.texture,k=B.texData.texShape;B.texData.isPacked?I.setOutputPackedMatrixTexture(R,k[0],k[1]):I.setOutputMatrixTexture(R,k[0],k[1]),I.setProgram(D.webGLProgram),ge().getNumber("WEBGL_VERSION")===1&&D.infLoc!==null&&I.gl.uniform1f(D.infLoc,1/0),D.nanLoc!==null&&I.gl.uniform1f(D.nanLoc,NaN),O.forEach((function(P,V){var j=D.program.variableNames[V],L=D.uniformLocations[j],Z=D.uniformLocations["offset"+j];if(L!=null)if(P.isUniform)if(je(P.shape)<2)I.gl.uniform1f(L,P.uniformValues[0]);else{var ne=P.uniformValues;ne instanceof Float32Array||(ne=new Float32Array(ne)),I.gl.uniform1fv(L,ne)}else P.texData.slice!=null&&Z!=null&&I.gl.uniform1i(Z,P.texData.slice.flatOffset),I.setInputMatrixTexture(P.texData.texture,L,V)})),N?.(I,D.webGLProgram),I.executeProgram()})(this.gpgpu,w,g,b,a),p.forEach((function(I){return u.disposeData(I.dataId)})),C&&(v=this.endTimer(v),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(v)})),!ge().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&s===!1){var S=this.unpackTensor(c);return this.disposeData(c.dataId),S}return c},e.prototype.compileAndRun=function(t,r,i,a,s){s===void 0&&(s=!1),i=i||r[0].dtype;var u=this.runWebGLProgram(t,r,i,a,s);return J.makeTensorFromDataId(u.dataId,u.shape,u.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(ge().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Me((function(){if(!ge().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=ge().getBool("DEBUG");ge().set("DEBUG",!1);var i=t.abs(Ae(1e-8)).dataSync()[0];if(ge().set("DEBUG",r),i>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),a=i.shape,s=i.dtype,u=i.values,c=i.texture,h=i.usage,d=i.isPacked;if(c==null){var p,g=this.activeTimers!=null;g&&(p=La());var v=i.texShape;if(v==null&&(v=F5(a,d),i.texShape=v),u!=null){var b=C_(a),E=void 0,w=v[1],C=v[0],S=u instanceof Uint8Array;d?(w=(r=Od(v[0],v[1]))[0],C=r[1],E=new _z(b,[C,w],S)):E=new yz(b,[C,w],S);var I=this.makeTensorInfo([C,w],s);this.texData.get(I.dataId).usage=S?pi.PIXELS:pi.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(I.dataId),w,C,u);var D=this.runWebGLProgram(E,[I],s,null,!0),O=this.texData.get(D.dataId);i.texture=O.texture,i.texShape=O.texShape,i.isPacked=O.isPacked,i.usage=O.usage,this.disposeData(I.dataId),this.texData.delete(D.dataId),i.values=null,g&&(this.uploadWaitMs+=La()-p)}else{var B=this.acquireTexture(v,h,s,d);i.texture=B}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),a=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=(function(s,u){if(u==="float32"||u==="complex64")return s;if(u==="int32"||u==="bool"){for(var c=u==="int32"?new Int32Array(s.length):new Uint8Array(s.length),h=0;h<c.length;++h)c[h]=Math.round(s[h]);return c}throw new Error("Unknown dtype "+u)})(r,a)),i.values},e.prototype.acquireTexture=function(t,r,i,a){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,a)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*tk(r)},e})(Tk);uk()&&J.registerBackend("webgl",(function(){return new N9}),2);var D9=Y({square_:function(n){var e=z(n,"x","square"),t=[e];return J.runKernelFunc((function(r,i){return i([e]),r.square(e)}),{x:e},null,"Square",{},t,[])}}),cd="SquaredDifference",Hk=Y({squaredDifference_:function(n,e){var t,r=z(n,"a","squaredDifference"),i=z(e,"b","squaredDifference");t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape);var a={a:r,b:i},s=[r,i];return J.runKernelFunc((function(u,c){var h=u.squaredDifference(r,i);return c([r,i]),h}),a,(function(u,c){var h=c[0],d=c[1],p=Ae(2);return{a:function(){return u.mul(h.sub(d).mul(p))},b:function(){return u.mul(d.sub(h).mul(p))}}}),cd,{},s,[])}}),k9=Y({abs_:function(n){var e=z(n,"x","abs");return e.dtype==="complex64"?J.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):J.runKernelFunc((function(t,r){var i=t.abs(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}}),"Abs")}}),M9=Y({acos_:function(n){var e=z(n,"x","acos");return J.runKernelFunc((function(t,r){var i=t.acos(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ae(1).sub(i.toFloat().square()).sqrt()).neg()}}}))}}),O9=Y({acosh_:function(n){var e=z(n,"x","acosh");return J.runKernelFunc((function(t,r){var i=t.acosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}}))}}),P9=Y({asin_:function(n){var e=z(n,"x","asin");return J.runKernelFunc((function(t,r){var i=t.asin(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ae(1).sub(i.toFloat().square()).sqrt())}}}))}}),F9=Y({asinh_:function(n){var e=z(n,"x","asinh");return J.runKernelFunc((function(t,r){var i=t.asinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ae(1).add(i.toFloat().square()).sqrt())}}}))}}),V9=Y({atan_:function(n){var e=z(n,"x","atan");return J.runKernelFunc((function(t,r){var i=t.atan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}}))}}),L9=Y({atanh_:function(n){var e=z(n,"x","atanh");return J.runKernelFunc((function(t,r){var i=t.atanh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(Ae(1).sub(i.toFloat().square()))}}}))}}),B9=Y({ceil_:function(n){var e=z(n,"x","ceil");return J.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),kx=Y({clipByValue_:function(n,e,t){var r=z(n,"x","clipByValue");G(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var i=[r],a={min:e,max:t};return J.runKernelFunc((function(s,u){var c=s.clip(r,e,t);return u([r]),c}),{x:r},(function(s,u){var c=u[0];return{x:function(){return s.where(c.greaterEqual(e).logicalAnd(c.lessEqual(t)),At(s))}}}),"ClipByValue",a,i)}}),j9=Y({cos_:function(n){var e=z(n,"x","cos"),t=[e];return J.runKernelFunc((function(r,i){var a=r.cos(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return a.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),U9=Y({cosh_:function(n){var e=z(n,"x","cosh");return J.runKernelFunc((function(t,r){var i=t.cosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}}))}}),z9=Y({erf_:function(n){var e=z(n,"x","erf");return G(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),J.runKernelFunc((function(t,r){var i=t.erf(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Gb=Y({exp_:function(n){var e=z(n,"x","exp");return J.runKernelFunc((function(t,r){var i=t.exp(e);return r([i]),i}),{x:e},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),H9=Y({expm1_:function(n){var e=z(n,"x","expm1");return J.runKernelFunc((function(t,r){var i=t.expm1(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}}))}}),G9=Y({floor_:function(n){var e=z(n,"x","floor");return J.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),W9=Y({log_:function(n){var e=z(n,"x","log"),t=[e];return J.runKernelFunc((function(r,i){var a=r.log(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return r.div(a.toFloat())}}}),"Log",{},t)}}),q9=Y({log1p_:function(n){var e=z(n,"x","log1p");return J.runKernelFunc((function(t,r){var i=t.log1p(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}}))}}),K9=Y({logSigmoid_:function(n){var e=z(n,"x","logSigmoid");return J.runKernelFunc((function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}}))}}),Ng=Y({neg_:function(n){var e=z(n,"x","neg"),t=[e];return J.runKernelFunc((function(r){return r.neg(e)}),{x:e},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),X9=Y({reciprocal_:function(n){var e=z(n,"x","reciprocal");return J.runKernelFunc((function(t,r){var i=t.reciprocal(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}}))}}),Y9=Y({round_:function(n){var e=z(n,"x","round");return J.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),Gk=Y({rsqrt_:function(n){var e=z(n,"x","rsqrt"),t=[e];return J.runKernelFunc((function(r,i){var a=r.rsqrt(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return r.div(a.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),Wk=Y({sigmoid_:function(n){var e=z(n,"x","sigmoid");return J.runKernelFunc((function(t,r){var i=t.sigmoid(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Ae(1).sub(i)))}}}),"Sigmoid")}}),$9=Y({sign_:function(n){var e=z(n,"x","sign");return J.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),Q9=Y({isNaN_:function(n){var e=z(n,"x","isNaN");return J.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),Z9=Y({isInf_:function(n){var e=z(n,"x","isInf");return J.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),J9=Y({isFinite_:function(n){var e=z(n,"x","isFinite");return J.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return At(t)}}}))}}),e8=Y({sin_:function(n){var e=z(n,"x","sin"),t=[e];return J.runKernelFunc((function(r,i){var a=r.sin(e);return i([e]),a}),{x:e},(function(r,i){var a=i[0];return{x:function(){return a.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),t8=Y({sinh_:function(n){var e=z(n,"x","sinh");return J.runKernelFunc((function(t,r){var i=t.sinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}}))}}),n8=Y({softplus_:function(n){var e=z(n,"x","softplus");return J.runKernelFunc((function(t,r){var i=t.softplus(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}}))}}),r8=Y({sqrt_:function(n){var e=z(n,"x","sqrt");return J.runKernelFunc((function(t,r){var i=t.sqrt(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}}))}}),i8=Y({step_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","step");return J.runKernelFunc((function(r){return r.step(t,e)}),{$x:t},(function(r){return{$x:function(){return At(r)}}}))}}),a8=Y({tan_:function(n){var e=z(n,"x","tan");return J.runKernelFunc((function(t,r){var i=t.tan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}}))}}),s8=Y({tanh_:function(n){var e=z(n,"x","tanh");return J.runKernelFunc((function(t,r){var i=t.tanh(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return Ae(1).sub(i.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function qk(n,e,t,r,i,a){var s,u,c=z(n,"x","batchNorm"),h=z(e,"mean","batchNorm"),d=z(t,"variance","batchNorm");return i!=null&&(s=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),G(c.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),G(h.rank===2||h.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."})),G(d.rank===2||d.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."})),s!=null&&G(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."})),u!=null&&G(u.rank===2||u.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."})),Fd(c,h,d,u,s,a)}function Kk(n,e,t,r,i,a){var s,u,c=z(n,"x","batchNorm"),h=z(e,"mean","batchNorm"),d=z(t,"variance","batchNorm");return i!=null&&(s=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),G(c.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),G(h.rank===3||h.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."})),G(d.rank===3||d.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."})),s!=null&&G(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."})),u!=null&&G(u.rank===3||u.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."})),Fd(c,h,d,u,s,a)}function Xk(n,e,t,r,i,a){var s,u,c=z(n,"x","batchNorm"),h=z(e,"mean","batchNorm"),d=z(t,"variance","batchNorm");return i!=null&&(s=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),G(c.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."})),G(h.rank===4||h.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."})),G(d.rank===4||d.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."})),s!=null&&G(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."})),u!=null&&G(u.rank===4||u.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."})),Fd(c,h,d,u,s,a)}function Fd(n,e,t,r,i,a){a==null&&(a=.001);var s,u,c,h=z(n,"x","batchNorm"),d=z(e,"mean","batchNorm"),p=z(t,"variance","batchNorm");i!=null&&(s=z(i,"scale","batchNorm")),r!=null&&(u=z(r,"offset","batchNorm")),G(d.rank===p.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),G(u==null||d.rank===u.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),G(s==null||d.rank===s.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),c=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h;var g=[h,d,p,s];return J.runKernelFunc((function(v,b){var E=v.batchNormalization(c,Vm(d),Vm(p),a,Vm(s),Vm(u));return b([h,d,p,s]),E}),{x:h,mean:d,variance:p,scale:s,offset:u},(function(v,b){var E=b,w=E[0],C=E[1],S=E[2],I=E[3],D=I??Ae(1),O=Wn(C.shape,c.shape),B=[];if(C.rank===1){for(var N=0;N<c.shape.length-1;++N)B.push(c.shape[N]);B.push(1)}var R=w.sub(C),k=v.mul(D),P=Gk(S.add(Ae(a))),V=P.mul(P).mul(P).mul(Ae(-.5));return{x:function(){return C.rank===1?v.mul(Dc(P.as4D(1,1,1,C.shape[0]),B)).mul(D).reshape(w.shape):v.mul(P).mul(D).reshape(w.shape)},mean:function(){var j=P.mul(Ae(-1)).mul(k);return C.rank===1&&(j=j.sum(O)),j.reshape(C.shape)},variance:function(){var j=V.mul(R).mul(k);return C.rank===1&&(j=j.sum(O)),j.reshape(C.shape)},scale:function(){var j=R.mul(P),L=v.mul(j);return C.rank===1&&(L=L.sum(O)),L.reshape(C.shape)},offset:function(){var j=v;return C.rank===1&&(j=j.sum(O)),j.reshape(C.shape)}}}),"BatchNormalization",{varianceEpsilon:a},g).reshape(h.shape)}function Vm(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function mv(){lk("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var o8=Y({batchNormalization2d_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),mv(),qk(n,e,t,a,i,r)}}),u8=Y({batchNormalization3d_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),mv(),Kk(n,e,t,a,i,r)}}),l8=Y({batchNormalization4d_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),mv(),Xk(n,e,t,a,i,r)}}),c8=Y({batchNormalization_:function(n,e,t,r,i,a){return r===void 0&&(r=.001),mv(),Fd(n,e,t,a,i,r)}}),Yk=Y({batchNorm_:Fd}),h8=Y({batchNorm2d_:qk}),f8=Y({batchNorm3d_:Kk}),d8=Y({batchNorm4d_:Xk}),gv=Y({logicalAnd_:function(n,e){var t=z(n,"a","logicalAnd","bool"),r=z(e,"b","logicalAnd","bool");return mt(t.shape,r.shape),J.runKernelFunc((function(i){return i.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),p8=Y({logicalNot_:function(n){var e=z(n,"x","logicalNot","bool");return J.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),$k=Y({logicalOr_:function(n,e){var t=z(n,"a","logicalOr","bool"),r=z(e,"b","logicalOr","bool");return mt(t.shape,r.shape),J.runKernelFunc((function(i){return i.logicalOr(t,r)}),{$a:t,$b:r})}}),m8=Y({logicalXor_:function(n,e){var t=z(n,"a","logicalXor","bool"),r=z(e,"b","logicalXor","bool");return mt(t.shape,r.shape),$k(n,e).logicalAnd(gv(n,e).logicalNot())}}),el=Y({where_:function(n,e,t){var r=z(e,"a","where"),i=z(t,"b","where"),a=z(n,"condition","where","bool");return Ft(r.shape,i.shape,"Error in where: "),a.rank===1?G(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):Ft(a.shape,i.shape,"Error in where: "),J.runKernelFunc((function(s,u){var c=s.select(a,r,i);return u([a]),c}),{$condition:a,$a:r,$b:i},(function(s,u){var c=u[0];return{$condition:function(){return At(c).toFloat()},$a:function(){return s.mul(c.cast(s.dtype))},$b:function(){return s.mul(c.logicalNot().cast(s.dtype))}}}))}}),Qk=function(n){return Ve(this,void 0,void 0,(function(){var e,t,r;return Le(this,(function(i){switch(i.label){case 0:return[4,(e=z(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Rx(e.shape,t),n!==e&&e.dispose(),[2,r]}}))}))},ft=Y({add_:function(n,e){var t,r=z(n,"a","add"),i=z(e,"b","add");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s){return s.add(r,i)}),{a:r,b:i},(function(s){return{a:function(){var u=s,c=Wn(r.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(r.shape)},b:function(){var u=s,c=Wn(i.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(i.shape)}}}),"Add")}}),g8=Y({addN_:function(n){G(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),G(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var e=n.map((function(i,a){return z(i,"tensors"+a,"addN")})),t=e[0];e.forEach((function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(i){if(!rr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return J.runKernelFunc((function(i){return i.addN(e)}),r,(function(i){var a={};return e.forEach((function(s,u){a[u]=function(){return i.clone()}})),a}),"AddN")}}),v8=Y({addStrict_:function(n,e){var t=z(n,"a","addStrict"),r=z(e,"b","addStrict");return Ft(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),y8=Y({atan2_:function(n,e){var t,r=z(n,"a","atan2"),i=z(e,"b","atan2");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s,u){var c=s.atan2(r,i);return u([r,i]),c}),{$a:r,$b:i},(function(s,u){var c=u[0],h=u[1];return{$a:function(){var d=ft(c.square(),h.square()),p=s.mul(h.div(d)),g=Wn(c.shape,a);return g.length>0&&(p=p.sum(g)),p.reshape(c.shape)},$b:function(){var d=ft(c.square(),h.square()),p=Ng(s.mul(c.div(d))),g=Wn(h.shape,a);return g.length>0&&(p=p.sum(g)),p.reshape(h.shape)}}}))}}),ra=Y({div_:function(n,e){var t,r=z(n,"a","div"),i=z(e,"b","div");if(t=ln(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return Zk(r,i);var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s,u){var c=s.realDivide(r,i);return u([r,i]),c}),{a:r,b:i},(function(s,u){var c=u[0],h=u[1];return{a:function(){var d=s.div(h.toFloat()),p=Wn(c.shape,a);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),p=Wn(h.shape,a);p.length>0&&(d=d.sum(p).reshape(h.shape));var g=h.square();return d.div(g.toFloat()).neg()}}}),"Div")}}),_8=Y({divNoNan_:function(n,e){var t,r=z(n,"a","div"),i=z(e,"b","div");r=(t=ln(r,i))[0],i=t[1];var a=ra(r,i),s=At(a),u=i.equal(s);return el(u,s,a)}}),b8=Y({divStrict_:function(n,e){var t=z(n,"a","div"),r=z(e,"b","div");return Ft(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),Zk=Y({floorDiv_:function(n,e){var t,r=z(n,"a","floorDiv"),i=z(e,"b","floorDiv");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s,u){var c=s.floorDiv(r,i);return u([r,i]),c}),{a:r,b:i},(function(s,u){var c=u[0],h=u[1];return{a:function(){var d=s.div(h.toFloat()),p=Wn(c.shape,a);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),p=Wn(h.shape,a);p.length>0&&(d=d.sum(p).reshape(h.shape));var g=h.square();return d.div(g.toFloat()).neg()}}}),"FloorDiv")}}),Mx=Y({maximum_:function(n,e){var t,r=z(n,"a","maximum"),i=z(e,"b","maximum");return t=ln(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),mt(r.shape,i.shape),J.runKernelFunc((function(a,s){var u=a.maximum(r,i);return s([r,i]),u}),{a:r,b:i},(function(a,s){var u=s[0],c=s[1];return{a:function(){return a.mul(u.greaterEqual(c).toFloat())},b:function(){return a.mul(u.less(c).toFloat())}}}),"Maximum")}}),x8=Y({maximumStrict_:function(n,e){var t=z(n,"a","maximumStrict"),r=z(e,"b","maximumStrict");return Ft(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),Jk=Y({minimum_:function(n,e){var t,r=z(n,"a","minimum"),i=z(e,"b","minimum");return t=ln(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),mt(r.shape,i.shape),J.runKernelFunc((function(a,s){var u=a.minimum(r,i);return s([r,i]),u}),{a:r,b:i},(function(a,s){var u=s[0],c=s[1];return{a:function(){return a.mul(u.lessEqual(c).toFloat())},b:function(){return a.mul(u.greater(c).toFloat())}}}),"Minimum")}}),w8=Y({minimumStrict_:function(n,e){var t=z(n,"a","minimumStrict"),r=z(e,"b","minimumStrict");return Ft(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),E8=Y({mod_:function(n,e){var t,r=z(n,"a","mod"),i=z(e,"b","mod");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s,u){var c=s.mod(r,i);return u([r,i]),c}),{$a:r,$b:i},(function(s,u){var c=u[0],h=u[1];return{$a:function(){var d=Wn(c.shape,a);return d.length>0?s.sum(d).reshape(c.shape):s},$b:function(){var d=s.mul(c.div(h).floor().neg()),p=Wn(h.shape,a);return p.length>0?d.sum(p).reshape(h.shape):d}}}))}}),T8=Y({modStrict_:function(n,e){var t=z(n,"a","modStrict"),r=z(e,"b","modStrict");return Ft(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Dr=Y({mul_:function(n,e){var t,r=z(n,"a","mul"),i=z(e,"b","mul");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s,u){var c=s.multiply(r,i);return u([r,i]),c}),{a:r,b:i},(function(s,u){var c=u[0],h=u[1];return{a:function(){var d=s.mul(h.toFloat()),p=Wn(c.shape,a);return p.length>0?d.sum(p).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),p=Wn(h.shape,a);return p.length>0?d.sum(p).reshape(h.shape):d}}}),"Mul")}}),C8=Y({mulStrict_:function(n,e){var t=z(n,"a","mul"),r=z(e,"b","mul");return Ft(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Dg=Y({pow_:function(n,e){var t,r=z(n,"base","pow"),i=z(e,"exp","pow");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape),s=[r,i];return J.runKernelFunc((function(u,c){var h=u.pow(r,i);return c([r,i,h]),h}),{a:r,b:i},(function(u,c){var h=c[0],d=c[1],p=c[2];return{a:function(){var g=d.toFloat(),v=u.mul(g.mul(h.pow(g.sub(Ae(1))))),b=Wn(h.shape,a);return b.length>0&&(v=v.sum(b)),v.reshape(h.shape)},b:function(){var g=h.greater(0),v=h.log().where(g,At(h)),b=u.mul(p.mul(v)),E=Wn(d.shape,a);return E.length>0&&(b=b.sum(E)),b.reshape(d.shape)}}}),"Pow",{},s,[!0])}}),S8=Y({powStrict_:function(n,e){return Ft(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),A8=Y({squaredDifferenceStrict_:function(n,e){var t=z(n,"a","squaredDifferenceStrict"),r=z(e,"b","squaredDifferenceStrict");return Ft(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),qn=Y({sub_:function(n,e){var t,r=z(n,"a","sub"),i=z(e,"b","sub");t=ln(r,i),r=t[0],i=t[1];var a=mt(r.shape,i.shape);return J.runKernelFunc((function(s){return s.subtract(r,i)}),{a:r,b:i},(function(s){return{a:function(){var u=s,c=Wn(r.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(r.shape)},b:function(){var u=s,c=Wn(i.shape,a);return c.length>0&&(u=u.sum(c)),u.neg().reshape(i.shape)}}}),"Sub")}}),R8=Y({subStrict_:function(n,e){var t=z(n,"a","subStrict"),r=z(e,"b","subStrict");return Ft(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),eM=Y({equal_:function(n,e){var t,r=z(n,"a","equal"),i=z(e,"b","equal");return t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),J.runKernelFunc((function(a){return a.equal(r,i)}),{$a:r,$b:i})}}),I8=Y({equalStrict_:function(n,e){var t=z(n,"a","equalStrict"),r=z(e,"b","equalStrict");return Ft(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),N8=Y({greater_:function(n,e){var t,r=z(n,"a","greater"),i=z(e,"b","greater");return t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),J.runKernelFunc((function(a){return a.greater(r,i)}),{a:r,b:i},null,"Greater")}}),tM=Y({greaterEqual_:function(n,e){var t,r=z(n,"a","greaterEqual"),i=z(e,"b","greaterEqual");return t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),J.runKernelFunc((function(a,s){var u=a.greaterEqual(r,i);return s([r,i]),u}),{a:r,b:i},(function(a,s){var u=s[0],c=s[1];return{a:function(){return At(u)},b:function(){return At(c)}}}),"GreaterEqual")}}),D8=Y({greaterEqualStrict_:function(n,e){var t=z(n,"a","greaterEqualStrict"),r=z(e,"b","greaterEqualStrict");return Ft(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),k8=Y({greaterStrict_:function(n,e){var t=z(n,"a","greaterStrict"),r=z(e,"b","greaterStrict");return Ft(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),M8=Y({less_:function(n,e){var t,r=z(n,"a","less"),i=z(e,"b","less");return t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),J.runKernelFunc((function(a){return a.less(r,i)}),{a:r,b:i},null,"Less")}}),O8=Y({lessEqual_:function(n,e){var t,r=z(n,"a","lessEqual"),i=z(e,"b","lessEqual");return t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),J.runKernelFunc((function(a,s){var u=a.lessEqual(r,i);return s([r,i]),u}),{a:r,b:i},null,"LessEqual")}}),P8=Y({lessEqualStrict_:function(n,e){var t=z(n,"a","lessEqualStrict"),r=z(e,"b","lessEqualStrict");return Ft(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),F8=Y({lessStrict_:function(n,e){var t=z(n,"a","lessStrict"),r=z(e,"b","lessStrict");return Ft(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),V8=Y({notEqual_:function(n,e){var t,r=z(n,"a","notEqual"),i=z(e,"b","notEqual");return t=ln(r,i),r=t[0],i=t[1],mt(r.shape,i.shape),J.runKernelFunc((function(a){return a.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),L8=Y({notEqualStrict_:function(n,e){var t=z(n,"a","notEqualStrict"),r=z(e,"b","notEqualStrict");return Ft(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function $A(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function QA(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Ox=Y({gather_:function(n,e,t){t===void 0&&(t=0);var r=z(n,"x","gather"),i=z(e,"indices","gather","int32");t=Kn(t,r.shape)[0];var a=(function(s,u,c){for(var h=s.shape[c],d=[],p=1,g=1,v=0;v<c;v++)d.push(s.shape[v]),p*=s.shape[v];for(v=0;v<u.rank;v++)d.push(u.shape[v]);for(v=c+1;v<s.rank;v++)d.push(s.shape[v]),g*=s.shape[v];return{batchSize:p,sliceSize:g,dimSize:h,outputShape:d}})(r,i,t);return J.runKernelFunc((function(s,u){var c=s.gather(r,i.flatten(),t);return u([i]),c}),{x:r,indices:i},(function(s,u){var c=u[0];return{x:function(){var h=r.shape,d=c.size,p=h.slice(0,t),g=p.length,v=h.slice(t,h.length).slice(1),b=v.length,E=$A(0,g),w=$A(g+1,g+1+b),C=QA([p,[d],v]),S=s.reshape(C),I=c.reshape([d]),D=QA([[g],E,w]),O=S.transpose(D),B=nM(O,I,r.shape[t]),N=bx(D);return B=B.transpose(N)},indices:function(){return c}}}),"Gather",{axis:t}).reshape(a.outputShape)}}),nM=Y({unsortedSegmentSum_:function(n,e,t){var r=z(n,"x","unsortedSegmentSum"),i=z(e,"segmentIds","unsortedSegmentSum","int32");return G(bn(t),(function(){return"numSegments must be of dtype int"})),J.runKernelFunc((function(a,s){var u=a.unsortedSegmentSum(r,i,t);return s([i]),u}),{$x:r},(function(a,s){var u=s[0];return{$x:function(){return(function(c,h){for(var d=Mx(h,At(h)),p=Ox(c,d),g=tM(h,Ae(0,"int32")),v=p.rank-g.rank,b=0;b<v;++b)g=Oi(g,b+1);g=gv(g,ch(p.shape,"bool"));var E=At(p);return el(g,p,E)})(a,u)}}}))}}),B8=function(n,e,t){return Ve(this,void 0,void 0,(function(){var r,i,a,s,u,c,h,d,p,g,v,b,E;return Le(this,(function(w){switch(w.label){case 0:for(r=z(n,"tensor","boolMask"),i=z(e,"mask","boolMask","bool"),a=t??0,s=i.rank,u=r.shape,G(s>0,(function(){return"mask cannot be scalar"})),Ft(u.slice(a,a+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,h=a;h<a+s;h++)c*=u[h];return d=u.slice(0,a).concat([c],u.slice(a+s)),p=r.reshape(d),g=i.reshape([-1]),[4,Qk(g)];case 1:return v=w.sent(),b=v.squeeze([1]),E=Ox(p,b,a),n!==r&&r.dispose(),e!==i&&i.dispose(),b.dispose(),p.dispose(),g.dispose(),v.dispose(),[2,E]}}))}))};function rM(n,e,t,r,i,a,s){a===void 0&&(a="NHWC"),G(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var u=n,c=e,h=!1;e.rank===3&&(h=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),u=[1,n[0],n[1],n[2]]),G(u.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."})),G(c.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank})),G(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var d=a==="NHWC"?u[3]:u[1],p=a==="NHWC"?c.shape[3]:c.shape[1];G(d===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+t.shape[2]+"."})),G(p===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+t.shape[3]+"."})),s!=null&&G(bn(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var g=Cx(a),v=ll(u,t.shape,r,1,i,s,!1,g),b=J.runKernelFunc((function(E,w){var C=E.conv2dDerInput(c,t,v);return w([t,c]),C}),{dy4D:c,filter:t},(function(E,w){var C=w[0],S=w[1];return{dy4D:function(){return Hi(E,C,r,i,a,1,s)},filter:function(){return Px(E,S,C.shape,r,i,a,s)}}}));return h?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}function M_(n){var e=(function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a})(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function iM(n,e,t,r,i){G(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var a=n,s=e,u=!1;e.rank===4&&(u=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,n[0],n[1],n[2],n[3]]);var c=a[4],h=s.shape[4];G(a.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),G(s.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank})),G(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),G(c===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[3]+"."})),G(h===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[4]+"."}));var d=Rg(a,t.shape,r,1,i),p=J.runKernelFunc((function(g){return g.conv3dDerInput(s,t,d)}),{dy5D:s});return u?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var j8=Y({conv1d_:function(n,e,t,r,i,a,s){i===void 0&&(i="NWC"),a===void 0&&(a=1);var u=z(n,"x","conv1d"),c=z(e,"filter","conv1d"),h=u,d=!1;u.rank===2&&(d=!0,h=u.as3D(1,u.shape[0],u.shape[1])),G(h.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."})),G(c.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."})),s!=null&&G(bn(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."})),G(h.shape[2]===c.shape[1],(function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+c.shape[1]+"."})),G(ni(t,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+a+"'"})),G(i==="NWC",(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var p=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),g=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),v=Hi(g,p,[1,t],r,"NHWC",[1,a],s);return d?v.as2D(v.shape[2],v.shape[3]):v.as3D(v.shape[0],v.shape[2],v.shape[3])}}),Hi=Y({conv2d_:function(n,e,t,r,i,a,s){i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]);var u=z(n,"x","conv2d"),c=z(e,"filter","conv2d"),h=u,d=!1;u.rank===3&&(d=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),G(h.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."})),G(c.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."})),s!=null&&G(bn(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var p=i==="NHWC"?h.shape[3]:h.shape[1];G(p===c.shape[2],(function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+c.shape[2]+"."})),G(ni(t,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}));var g=Cx(i),v=ll(h.shape,c.shape,t,a,r,s,!1,g),b=[c,h],E=J.runKernelFunc((function(w,C){var S=w.conv2d(h,c,v);return C([c,h]),S}),{x:h,filter:c},(function(w,C){var S=C,I=S[0],D=S[1];return G(Yc(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return aM(D.shape,w,I,t,r,i)},filter:function(){return Px(D,w,I.shape,t,r,i)}}}),"Conv2D",v,b);return d?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),U8=Y({conv3d_:function(n,e,t,r,i,a){i===void 0&&(i="NDHWC"),a===void 0&&(a=[1,1,1]);var s=z(n,"x","conv3d"),u=z(e,"filter","conv3d"),c=s,h=!1;s.rank===4&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),G(c.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."})),G(u.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."})),G(c.shape[4]===u.shape[3],(function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+u.shape[3]+"."})),G((function(g,v){return M_(g)||M_(v)})(t,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),G(i==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var d=Rg(c.shape,u.shape,t,a,r),p=J.runKernelFunc((function(g,v){var b=g.conv3d(c,u,d);return v([c,u]),b}),{x:c,$filter:u},(function(g,v){G(M_(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var b=v[0],E=v[1];return{x:function(){return iM(b.shape,g,E,t,r)},$filter:function(){return(function(w,C,S,I,D){var O=w;w.rank===4&&(O=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]));var B=C;B.rank===4&&(B=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),G(O.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+O.shape+"."})),G(B.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+B.shape+"."})),G(S.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+S+"."})),G(O.shape[4]===S[3],(function(){return"Error in conv3dDerFilter: depth of input "+O.shape[4]+") must match input depth in filter ("+S[3]+"."})),G(B.shape[4]===S[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+B.shape[4]+") must match output depth for filter ("+S[4]+")."}));var N=Rg(O.shape,S,I,1,D);return J.runKernelFunc((function(R){return R.conv3dDerFilter(O,B,N)}),{x5D:O,dy5D:B})})(b,g,E.shape,t,r)}}}));return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Px=Y({conv2dDerFilter_:function(n,e,t,r,i,a,s){a===void 0&&(a="NHWC");var u=n;n.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var c=e;c.rank===3&&(c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),G(u.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."})),G(c.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."})),G(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var h=a==="NHWC"?u.shape[3]:u.shape[1],d=a==="NHWC"?c.shape[3]:c.shape[1];G(h===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+t[2]+"."})),G(d===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+t[3]+")."})),s!=null&&G(bn(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var p=Cx(a),g=ll(u.shape,t,r,1,i,s,!1,p);return J.runKernelFunc((function(v){return v.conv2dDerFilter(u,c,g)}),{x4D:u,dy4D:c})}}),aM=Y({conv2dDerInput_:rM}),vv=Y({depthwiseConv2d_:function(n,e,t,r,i,a,s){a===void 0&&(a=[1,1]);var u=z(n,"x","depthwiseConv2d"),c=z(e,"filter","depthwiseConv2d"),h=u,d=!1;u.rank===3&&(d=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),G(h.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."})),G(c.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."})),G(h.shape[3]===c.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."})),a==null&&(a=[1,1]),G(ni(t,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),s!=null&&G(bn(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var p=ll(h.shape,c.shape,t,a,r,s,!0),g=[h,c],v=J.runKernelFunc((function(b,E){var w=b.depthwiseConv2D(h,c,p);return E([h,c]),w}),{x:h,filter:c},(function(b,E){G(Yc(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var w=E[0],C=E[1];return{x:function(){return sM(w.shape,b,C,p)},filter:function(){return oM(w,b,C.shape,p)}}}),"DepthwiseConv2dNative",p,g);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),sM=Y({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,a=!1;e.rank===3&&(a=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=J.runKernelFunc((function(u){return u.depthwiseConv2DDerInput(i,t,r)}),{dy4D:i});return a?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),oM=Y({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e;return a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),J.runKernelFunc((function(s){return s.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),Fx=Y({separableConv2d_:function(n,e,t,r,i,a,s){a===void 0&&(a=[1,1]),s===void 0&&(s="NHWC");var u=z(n,"x","separableConv2d"),c=z(e,"depthwiseFilter","separableConv2d"),h=z(t,"pointwiseFilter","separableConv2d"),d=u,p=!1;if(u.rank===3&&(p=!0,d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(d.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."})),G(c.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."})),G(h.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."})),G(h.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."})),G(h.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."}));var g=c.shape[2],v=c.shape[3];G(h.shape[2]===g*v,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+g*v+", but got "+h.shape[2]+"."}));var b=vv(d,c,r,i,s,a),E=Hi(b,h,1,"valid",s);return p?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),z8=Y({conv2dTranspose_:function(n,e,t,r,i,a){return rM(t,z(n,"x","conv2dTranspose"),z(e,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),H8=Y({conv3dTranspose_:function(n,e,t,r,i){return iM(t,z(n,"x","conv3dTranspose"),z(e,"filter","conv3dTranspose"),r,i)}}),yv=Y({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var a=z(n,"a","matMul"),s=z(e,"b","matMul");i=ln(a,s),a=i[0],s=i[1];var u=t?a.shape[a.rank-2]:a.shape[a.rank-1],c=r?s.shape[s.rank-1]:s.shape[s.rank-2],h=t?a.shape[a.rank-1]:a.shape[a.rank-2],d=r?s.shape[s.rank-2]:s.shape[s.rank-1],p=a.shape.slice(0,-2),g=s.shape.slice(0,-2),v=je(p),b=je(g);G(a.rank>=2&&s.rank>=2&&a.rank===s.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+s.rank+"."})),G(rr(p,g),(function(){return"Error in matMul: outer dimensions ("+p+") and ("+g+") of Tensors with shapes "+a.shape+" and "+s.shape+" must match."})),G(u===c,(function(){return"Error in matMul: inner shapes ("+u+") and ("+c+") of Tensors with shapes "+a.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var E=a.shape.slice(0,-2).concat([h,d]),w=t?a.as3D(v,u,h):a.as3D(v,h,u),C=r?s.as3D(b,d,c):s.as3D(b,c,d),S={transposeA:t,transposeB:r};return J.runKernelFunc((function(I,D){var O=I.batchMatMul(w,C,t,r);return D([w,C]),O}),{a:w,b:C},(function(I,D){var O=D,B=O[0],N=O[1];return t||r?!t&&r?{a:function(){return I.matMul(N,!1,!1)},b:function(){return I.matMul(B,!0,!1)}}:t&&!r?{a:function(){return N.matMul(I,!1,!0)},b:function(){return B.matMul(I,!1,!1)}}:{a:function(){return N.matMul(I,!0,!0)},b:function(){return I.matMul(B,!0,!0)}}:{a:function(){return I.matMul(N,!1,!0)},b:function(){return B.matMul(I,!0,!1)}}}),"BatchMatMul",S).reshape(E)}}),G8=Y({dot_:function(n,e){var t=z(n,"t1","dot"),r=z(e,"t2","dot");G(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var i=t.rank===1?t.size:t.shape[1],a=r.rank===1?r.size:r.shape[0];return G(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),W8=Y({outerProduct_:function(n,e){var t=z(n,"v1","outerProduct"),r=z(e,"v2","outerProduct");return G(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Vd=Y({reverse_:function(n,e){var t=z(n,"x","reverse");if(t.rank===0)return t.clone();var r=Kn(e,t.shape);return J.runKernelFunc((function(i){return i.reverse(t,r)}),{$x:t},(function(i){return{$x:function(){return i.reverse(r)}}})).reshapeAs(t)}}),q8=Y({reverse1d_:function(n){var e=z(n,"x","reverse");return G(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),Vd(e,0)}}),K8=Y({reverse2d_:function(n,e){var t=z(n,"x","reverse");return G(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),Vd(t,e)}}),X8=Y({reverse3d_:function(n,e){var t=z(n,"x","reverse");return G(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),Vd(t,e)}}),Y8=Y({reverse4d_:function(n,e){var t=z(n,"x","reverse");return G(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),Vd(t,e)}});function uM(n,e,t,r,i,a){var s=z(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),G(u.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."})),G(ni(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),a!=null&&G(bn(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=ld(u.shape,e,t,r,i,a);if(h.filterWidth===1&&h.filterHeight===1&&rr(h.inShape,h.outShape))return s.clone();var d=[u],p=J.runKernelFunc((function(g,v){var b=g.maxPool(u,h);return v([u,b]),b}),{x:u},(function(g,v){var b=v[0],E=v[1];return{x:function(){return(function(w,C,S,I,D,O,B,N){var R=z(w,"dy","maxPoolBackprop"),k=z(C,"input","maxPoolBackprop"),P=z(S,"output","maxPoolBackprop");G(k.rank===R.rank,(function(){return"Rank of input ("+k.rank+") does not match rank of dy ("+R.rank+")"})),G(ni(D,O),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+D+" and dilations '"+O+"'"})),G(R.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+R.rank+"."})),G(k.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+k.rank+"."}));var V=ld(k.shape,I,D,O,B,N);return J.runKernelFunc((function(j){return j.maxPoolBackprop(R,k,P,V)}),{$dy:R,$input:k})})(g,b,E,e,t,r,i)}}}),"MaxPool",h,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function lM(n,e,t,r,i,a){var s=z(n,"x","avgPool","float32");G(ni(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),G(u.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."})),a!=null&&G(bn(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=ld(u.shape,e,t,r,i,a);if(h.filterWidth===1&&h.filterHeight===1&&rr(h.inShape,h.outShape))return s.clone();var d=J.runKernelFunc((function(p){return p.avgPool(u,h)}),{x:u},(function(p){return{x:function(){return(function(g,v,b,E,w,C){var S=z(g,"dy","avgPoolBackprop"),I=z(v,"input","avgPoolBackprop");G(I.rank===S.rank,(function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+S.rank+")"})),G(ni(E,w),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+w+"'"}));var D=I,O=S,B=!1;I.rank===3&&(B=!0,D=I.as4D(1,I.shape[0],I.shape[1],I.shape[2]),O=S.as4D(1,S.shape[0],S.shape[1],S.shape[2])),G(O.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+O.rank+"."})),G(D.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+D.rank+"."}));var N=ld(D.shape,b,E,w,C),R=J.runKernelFunc((function(k){return k.avgPoolBackprop(O,D,N)}),{dy4D:O,input4D:D});return B?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R})(p,u,e,t,r,i)}}}),"AvgPool",h);return d=d.cast(s.dtype),c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var Zn=Y({maxPool_:function(n,e,t,r,i){return uM(n,e,t,1,r,i)}}),Ld=Y({avgPool_:function(n,e,t,r,i){return lM(n,e,t,1,r,i)}}),$8=Y({pool_:function(n,e,t,r,i,a){i==null&&(i=[1,1]),a==null&&(a=1),r===0&&(r="valid");var s=z(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),G(ni(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var h,d=ld(u.shape,e,a,i,r),p=[d.dilationHeight,d.dilationWidth];h=r==="same"?(function(D,O){var B=D.map((function(k,P){return k+(k-1)*(O[P]-1)})).map((function(k){return k-1})),N=B.map((function(k){return Math.floor(k/2)})),R=B.map((function(k,P){return k-N[P]}));return B.map((function(k,P){return[N[P],R[P]]}))})([d.filterHeight,d.filterWidth],p):[[0,0],[0,0]];var g=p[0]===1&&p[1]===1,v=(function(D,O,B){var N=B.map((function(Z){return Z[0]})),R=B.map((function(Z){return Z[1]})),k=D.concat(N,R),P=O.map((function(Z,ne){return(Z-k[ne]%Z)%Z})),V=R.map((function(Z,ne){return Z+P[ne]})),j=O.map((function(Z,ne){return[N[ne],V[ne]]})),L=O.map((function(Z,ne){return[0,P[ne]]}));return[j,L]})([d.inHeight,d.inWidth],p,h),b=v[0],E=v[1],w=g?r:"valid",C=g?u:mk(u,p,b),S=(t==="avg"?function(){return lM(C,e,a,1,w)}:function(){return uM(C,e,a,1,w)})(),I=g?S:fk(S,p,E);return c?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),Q8=Y({maxPool3d_:function(n,e,t,r,i,a,s){a===void 0&&(a="NDHWC");var u=z(n,"x","maxPool3d"),c=u,h=!1;u.rank===4&&(h=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),s==null&&(s=[1,1,1]),G(c.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."})),G(a==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),G(ni(t,s),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),i!=null&&G(bn(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=Ag(c.shape,e,t,s,r,i,a),p=J.runKernelFunc((function(g,v){var b=g.maxPool3d(c,d);return v([c,b]),b}),{x:c},(function(g,v){var b=v[0],E=v[1];return{x:function(){return(function(w,C,S,I,D,O,B,N){var R=z(w,"dy","maxPool3dBackprop"),k=z(C,"input","maxPool3dBackprop"),P=z(S,"output","maxPool3dBackprop"),V=R,j=k,L=P,Z=!1;k.rank===4&&(Z=!0,V=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),j=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),L=P.as5D(1,P.shape[0],P.shape[1],P.shape[2],P.shape[3])),G(V.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+V.rank+"."})),G(j.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+j.rank+"."})),G(L.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+L.rank+"."})),O==null&&(O=[1,1,1]),G(ni(D,O),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+D+" and dilations '"+O+"'"})),N!=null&&G(bn(B),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+N+" but got pad "+B+"."}));var ne=Ag(j.shape,I,D,O,B,N),q=J.runKernelFunc((function(X){return X.maxPool3dBackprop(V,j,L,ne)}),{dy5D:V,input5D:j});return Z?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q})(g,b,E,e,t,s,r,i)}}}));return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Z8=Y({avgPool3d_:function(n,e,t,r,i,a,s){a===void 0&&(a="NDHWC");var u=z(n,"x","avgPool3d","float32"),c=u,h=!1;u.rank===4&&(h=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),s==null&&(s=[1,1,1]),G(c.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."})),G(a==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),G(ni(t,s),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),i!=null&&G(bn(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=Ag(c.shape,e,t,s,r,i,a),p=J.runKernelFunc((function(g){return g.avgPool3d(c,d)}),{x:c},(function(g){return{x:function(){return(function(v,b,E,w,C,S,I){var D=z(v,"dy","avgPool3dBackprop"),O=z(b,"input","avgPool3dBackprop"),B=D,N=O,R=!1;O.rank===4&&(R=!0,B=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),N=O.as5D(1,O.shape[0],O.shape[1],O.shape[2],O.shape[3])),G(B.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+B.rank+"."})),G(N.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+N.rank+"."})),C==null&&(C=[1,1,1]),G(ni(w,C),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+C+"'"})),I!=null&&G(bn(S),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+I+" but got pad "+S+"."}));var k=Ag(N.shape,E,w,C,S,I),P=J.runKernelFunc((function(V){return V.avgPool3dBackprop(B,N,k)}),{dy5D:B,input5D:N});return R?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P})(g,c,e,t,s,r,i)}}}));return p=p.cast(c.dtype),h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Za=Y({slice_:function(n,e,t){var r,i,a=z(n,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach((function(c){G(c!==-1,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=t==null?new Array(a.rank).fill(-1):typeof t=="number"?[t].concat(new Array(a.rank-1).fill(-1)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(-1)):t).map((function(c,h){return c>=0?c:(G(c===-1,(function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+h+"."})),a.shape[h]-r[h])})),SU(a,r,i);var s=a.shape,u={begin:r,size:i};return J.runKernelFunc((function(c){return c.slice(a,r,i)}),{x:a},(function(c){for(var h=[],d=0;d<c.rank;d++)h.push([r[d],s[d]-r[d]-i[d]]);return{x:function(){return c.pad(h)}}}),"Slice",u)}}),J8=Y({slice1d_:function(n,e,t){var r=z(n,"x","slice1d");return G(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Za(r,[e],[t])}}),eH=Y({slice2d_:function(n,e,t){var r=z(n,"x","slice2d");return G(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Za(r,e,t)}}),cM=Y({slice3d_:function(n,e,t){var r=z(n,"x","slice3d");return G(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Za(r,e,t)}}),tH=Y({slice4d_:function(n,e,t){var r=z(n,"x","slice4d");return G(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Za(r,e,t)}});function hM(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(ti(e.shape,r))),n.rank<t.rank&&(n=n.reshape(ti(n.shape,r))),{x:function(){var a=n.mul(t.equal(e).cast(n.dtype));return i==null?a:a.transpose(i)}}}var nH=Y({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","all","bool"),i=Kn(e,r.shape),a=i,s=ts(a,r.rank);s!=null&&(r=r.transpose(s),a=ns(a.length,r.rank));var u=J.runKernelFunc((function(h){return h.all(r,a)}),{$x:r});if(t){var c=ti(u.shape,i);return u.reshape(c)}return u}}),rH=Y({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","any","bool"),i=Kn(e,r.shape),a=i,s=ts(a,r.rank);s!=null&&(r=r.transpose(s),a=ns(a.length,r.rank));var u=J.runKernelFunc((function(h){return h.any(r,a)}),{$x:r});if(t){var c=ti(u.shape,i);return u.reshape(c)}return u}}),iH=Y({argMax_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","argMax");e==null&&(e=0);var r=Kn(e,t.shape),i=ts(r,t.rank);i!=null&&(t=t.transpose(i),r=ns(r.length,t.rank));var a={axis:r[0]},s=[t];return J.runKernelFunc((function(u,c){var h=u.argMax(t,r[0]);return c([t]),h}),{x:t},(function(u,c){var h=c[0];return{x:function(){return At(h)}}}),"ArgMax",a,s)}}),aH=Y({argMin_:function(n,e){e===void 0&&(e=0);var t=z(n,"x","argMin");e==null&&(e=0);var r=Kn(e,t.shape),i=ts(r,t.rank);return i!=null&&(t=t.transpose(i),r=ns(r.length,t.rank)),J.runKernelFunc((function(a,s){var u=a.argMin(t,r[0]);return s([t]),u}),{$x:t},(function(a,s){var u=s[0];return{$x:function(){return At(u)}}}))}}),sH=Y({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","logSumExp"),i=Kn(e,r.shape),a=r.max(i,!0),s=r.sub(a).exp().sum(i).log(),u=a.reshape(s.shape).add(s);if(t){var c=ti(u.shape,i);return u.reshape(c)}return u}}),_v=Y({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","max"),i=r,a=Kn(e,r.shape),s=a,u=ts(s,r.rank);u!=null&&(r=r.transpose(u),s=ns(s.length,r.rank));var c=[r],h=J.runKernelFunc((function(p,g){var v=p.max(r,s);return g([i,v]),v}),{x:r},(function(p,g){return hM(p,g[1],g[0],a,u)}),"Max",{axes:s},c,[!0]);if(t){var d=ti(h.shape,a);h=h.reshape(d)}return h}}),oH=Y({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","mean"),i=Kn(e,r.shape),a=je(wr(r.shape,i)[1]);return pv((function(s){var u=Ae(a);return{value:(u.dtype===s.dtype?s:s.cast(u.dtype)).div(u).sum(e,t),gradFunc:function(c){var h=s.shape.slice();return i.forEach((function(d){h[d]=1})),c.reshape(h).mul(ch(s.shape,"float32")).div(a)}}}))(r)}}),uH=Y({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","min"),i=r,a=Kn(e,r.shape),s=a,u=ts(s,r.rank);u!=null&&(r=r.transpose(u),s=ns(s.length,r.rank));var c=[r],h=J.runKernelFunc((function(p,g){var v=p.min(r,s);return g([i,v]),v}),{x:r},(function(p,g){return hM(p,g[1],g[0],a,u)}),"Min",{axes:s},c,[!0]);if(t){var d=ti(h.shape,a);h=h.reshape(d)}return h}}),lH=Y({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Kn(e,(n=z(n,"x","moments")).shape),i=n.mean(r,t),a=i.shape;t||(a=ti(i.shape,r));var s=n.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:s.mean(r,t)}}}),fM=Y({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Kn(e,r.shape);return pv((function(a){var s=ts(i,a.rank),u=i,c=a;s!=null&&(c=a.transpose(s),u=ns(u.length,a.rank));var h=function(v){var b=a.shape.slice();return i.forEach((function(E){b[E]=1})),v.reshape(b).mul(ch(a.shape,"float32"))},d={axes:u},p=J.runKernelFunc((function(v){return v.sum(c,u)}),{x:c},(function(v){return{x:function(){return h(v)}}}),"Sum",d);if(t){var g=ti(p.shape,i);p=p.reshape(g)}return{value:p,gradFunc:h}}))(r)}}),cH=Y({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=z(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Kn(e,r.shape),a=ts(i,r.rank),s=i,u=r;a!=null&&(u=r.transpose(a),s=ns(s.length,r.rank));var c=J.runKernelFunc((function(d){return d.prod(u,s)}),{permutedX:u});if(t){var h=ti(c.shape,i);c=c.reshape(h)}return c}}),dM=Y({elu_:function(n){var e=z(n,"x","elu");return J.runKernelFunc((function(t,r){var i=t.elu(e);return r([i]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return J.runKernelFunc((function(a){return a.eluDer(t,i)}),{dy:t,y:i})}}}))}}),hH=Y({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=z(n,"x","leakyRelu");return Mx(Ae(e).mul(t),t)}}),pM=Y({prelu_:function(n,e){var t=z(n,"x","prelu"),r=z(e,"alpha","prelu");return J.runKernelFunc((function(i,a){var s=i.prelu(t,r);return a([t,r]),s}),{x:t,alpha:r},(function(i,a){var s=a[0],u=a[1],c=s.greater(0);return{x:function(){return el(c,i,i.mul(u))},alpha:function(){var h=el(c,At(i),i.mul(s)),d=Wn(u.shape,i.shape);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)}}}),"Prelu")}}),un=Y({relu_:function(n){var e=z(n,"x","relu");return e.dtype==="bool"?e.toInt():J.runKernelFunc((function(t,r){var i=t.relu(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}}),"Relu")}}),mM=Y({relu6_:function(n){var e=z(n,"x","relu6");return e.dtype==="bool"?e.toInt():J.runKernelFunc((function(t,r){var i=t.relu6(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0],a=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(a.toFloat())}}}),"Relu6")}}),fH=Y({selu_:function(n){var e=z(n,"x","selu");return J.runKernelFunc((function(t,r){var i=t.selu(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){var a=i.greater(Ae(0)),s=Ae(Nx),u=Ae(Dx),c=t.mul(u),h=t.mul(s).mul(i.toFloat().exp());return el(a,c,h)}}}))}}),Ho=Y({transpose_:function(n,e){var t=z(n,"x","transpose");if(e==null&&(e=t.shape.map((function(i,a){return a})).reverse()),G(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(i){G(i>=0&&i<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var r={perm:e};return J.runKernelFunc((function(i){return i.transpose(t,e)}),{x:t},(function(i){var a=bx(e);return{x:function(){return i.transpose(a)}}}),"Transpose",r)}}),dH=Y({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var a=z(n,"x","localResponseNormalization");G(a.rank===4||a.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."})),G(bn(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var c=J.runKernelFunc((function(h,d){var p=h.localResponseNormalization4D(s,e,t,r,i);return d([s,p]),p}),{x4D:s},(function(h,d){var p=d[0],g=d[1];return{x4D:function(){return J.runKernelFunc((function(v){return v.LRNGrad(h,p,g,e,t,r,i)}),{})}}}));return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),gM=Y({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=(function u(c,h,d){if(d===void 0&&(d=null),c.rank===0)return c.abs();if(c.rank!==1&&d===null)return u(c.reshape([-1]),h,d);if(c.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(h===1)return c.abs().sum(d);if(h===1/0)return c.abs().max(d);if(h===-1/0)return c.abs().min(d);if(h==="euclidean"||h===2)return c.abs().pow(Ae(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(d)&&d.length===2){if(h===1)return c.abs().sum(d[0]).max(d[1]-1);if(h===1/0)return c.abs().sum(d[1]).max(d[0]);if(h===-1/0)return c.abs().sum(d[1]).min(d[0]);if(h==="fro"||h==="euclidean")return c.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+d)})(n=z(n,"x","norm"),e,t),a=i.shape;if(r){var s=Kn(t,n.shape);a=ti(i.shape,s)}return i.reshape(a)}}),pH=Y({basicLSTMCell_:function(n,e,t,r,i,a){var s=z(n,"forgetBias","basicLSTMCell"),u=z(e,"lstmKernel","basicLSTMCell"),c=z(t,"lstmBias","basicLSTMCell"),h=z(r,"data","basicLSTMCell"),d=z(i,"c","basicLSTMCell"),p=z(a,"h","basicLSTMCell"),g=h.concat(p,1).matMul(u).add(c),v=g.shape[0],b=g.shape[1]/4,E=[v,b],w=g.slice([0,0],E),C=g.slice([0,b],E),S=g.slice([0,2*b],E),I=g.slice([0,3*b],E),D=w.sigmoid().mulStrict(C.tanh()).addStrict(d.mulStrict(s.add(S).sigmoid())),O=D.tanh().mulStrict(I.sigmoid());return[D,O]}}),mH=Y({multiRNNCell_:function(n,e,t,r){for(var i=z(e,"data","multiRNNCell"),a=xg(t,"c","multiRNNCell"),s=xg(r,"h","multiRNNCell"),u=i,c=[],h=0;h<n.length;h++){var d=n[h](u,a[h],s[h]);c.push(d[0]),c.push(d[1]),u=d[1]}var p=[],g=[];for(h=0;h<c.length;h+=2)p.push(c[h]),g.push(c[h+1]);return[p,g]}}),gH=Y({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var a=z(n,"v","movingAverage"),s=z(e,"x","movingAverage"),u=z(t,"decay","movingAverage");d5(a,s),G(rr(a.shape,s.shape),(function(){return"Shape mismatch in v and x"}));var c=Ae(1),h=c.sub(u),d=s.sub(a).mul(h);if(i){G(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var p=z(r,"step","movingAverage");d=d.div(c.sub(Dg(u,p)))}return a.add(d)}}),vH=Y({stridedSlice_:function(n,e,t,r,i,a,s,u,c){if(i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),c===void 0&&(c=0),r==null&&(r=new Array(e.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var h=z(n,"x","stridedSlice"),d=NA(u),p=h.shape.slice();d.forEach((function(w){e[w]=0,t[w]=1,p.splice(w,0,1)})),h=h.reshape(p);for(var g=0;g<h.rank;g++)e[g]=AU(i,e,r,h.shape,g),t[g]=RU(a,t,r,h.shape,g),r[g]=r[g]||1;var v=NA(c);v.forEach((function(w){t[w]=e[w]+1,r[w]=1}));var b=Tx(e,t,r),E=b.filter((function(w,C){return v.indexOf(C)===-1}));return r.every((function(w){return w===1}))?Za(h,e,b).reshape(E):J.runKernelFunc((function(w){return w.stridedSlice(h,e,t,r)}),{$x:h}).reshape(E)}}),yH=Y({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=z(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var a=J.runKernelFunc((function(s){return s.topk(r,e,t)}),{$x:r});return{values:a[0],indices:a[1]}}}),_H=Y({scatterND_:function(n,e,t){var r=z(n,"indices","scatterND","int32"),i=z(e,"updates","scatterND");return CU(i,r,t),J.runKernelFunc((function(a){return a.scatterND(r,i,t)}),{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Vx=Y({fft_:function(n){G(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return J.runKernelFunc((function(i){return i.fft(r)}),{input:n}).reshape(n.shape)}}),kg=Y({ifft_:function(n){G(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return J.runKernelFunc((function(i){return i.ifft(r)}),{input:n}).reshape(n.shape)}}),Lx=Y({rfft_:function(n,e){G(n.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var a=n.shape.map((function(C){return 0})),s=n.shape.map((function(C){return C}));s[n.shape.length-1]=e,t=n.slice(a,s),r=e}else if(e!=null&&e>r){var u=n.shape.map((function(C){return C}));u[n.shape.length-1]=e-r,t=n.concat($t(u),n.shape.length-1),r=e}else t=n;var c=t.zerosLike(),h=fr(t,c).as2D(i,r),d=Vx(h),p=Math.floor(r/2)+1,g=Pi(d),v=ja(d),b=g.split([p,r-p],g.shape.length-1),E=v.split([p,r-p],v.shape.length-1),w=t.shape.slice();return w[t.shape.length-1]=p,fr(b[0],E[0]).reshape(w)}}),vM=Y({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=kg(r);return Pi(i)}var a=[t,2*(e-1)],s=Pi(n).as2D(t,e),u=ja(n).as2D(t,e),c=s.slice([0,1],[t,e-2]).reverse(1),h=u.slice([0,1],[t,e-2]).reverse(1).mul(Ae(-1)),d=s.concat(c,1),p=u.concat(h,1);return r=fr(d,p).as2D(a[0],a[1]),i=kg(r),Pi(i)}}),bH=Object.freeze({fft:Vx,ifft:kg,rfft:Lx,irfft:vM}),xH=Y({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=z(n,"sparseIndices","sparseToDense","int32"),a=z(e,"sparseValues","sparseToDense"),s=z(r,"defaultValue","sparseToDense",a.dtype);return(function(u,c,h,d){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var p=u.rank>0?u.shape[0]:1,g=u.rank>1?u.shape[1]:1;if(h.length!==g)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+g+".");var v=c.size;if(c.rank!==0&&(c.rank!==1||v!==p))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+p+"]");if(c.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,a,t,s),J.runKernelFunc((function(u){return u.sparseToDense(i,a,t,s)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:s})}}),wH=Y({gatherND_:function(n,e){var t=z(e,"indices","gatherND","int32"),r=z(n,"x","gatherND");return J.runKernelFunc((function(i){return i.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),EH=Y({diag_:function(n){var e=z(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return J.runKernelFunc((function(r){return r.diag(e)}),{$x:e}).reshape(t)}}),TH=Y({dropout_:function(n,e,t,r){var i=z(n,"x","dropout");if(G(i.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),G(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return n instanceof sn?i.clone():i;var a=(function(c,h){if(h==null)return c.shape.slice();if(rr(c.shape,h))return h;if(c.shape.length===h.length){for(var d=[],p=0;p<c.shape.length;p++)h[p]==null&&c.shape[p]!=null?d.push(c.shape[p]):d.push(h[p]);return d}return h})(i,t),s=1-e,u=pk(a,0,1,"float32",r).add(s).floor().div(s);return i.mul(u)}});function yM(n,e,t){for(var r=1-n%2,i=new Float32Array(n),a=0;a<n;++a){var s=2*Math.PI*a/(n+r-1);i[a]=e-t*Math.cos(s)}return Mn(i,"float32")}var Bx=Y({hannWindow_:function(n){return yM(n,.5,.5)}}),_M=Y({hammingWindow_:function(n){return yM(n,.54,.46)}}),jx=Y({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var a=0,s=[];a+e<=n.size;)s.push(Za(n,a,e)),a+=t;if(r)for(;a<n.size;){var u=a+e-n.size,c=zn([Za(n,a,e-u),Ka([u],i)]);s.push(c),a+=t}return s.length===0?No([],[0,e]):zn(s).as2D(s.length,e)}}),bM=Y({stft_:function(n,e,t,r,i){var a;i===void 0&&(i=Bx),r==null&&(a=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var s=jx(n,e,t),u=Dr(s,i(e)),c=[],h=0;h<s.shape[0];h++)c.push(Lx(u.slice([h,0],[1,e]),r));return zn(c)}}),CH=Object.freeze({hannWindow:Bx,hammingWindow:_M,frame:jx,stft:bM}),Ir,SH=function(n,e,t){return t===void 0&&(t=1),Ve(this,void 0,void 0,(function(){var r,i,a,s,u,c,h,d,p,g,v,b,E,w;return Le(this,(function(C){switch(C.label){case 0:return r=z(n,"predictions","inTopK"),i=z(e,"targets","inTopK"),G(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),G(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),Ft(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],G(t>0&&t<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+t})),[4,r.data()];case 1:return s=C.sent(),[4,i.data()];case 2:for(u=C.sent(),c=[s.length/a,a],d=c[1],p=sd("bool",h=c[0]),g=0;g<h;g++){for(v=g*d,b=s.subarray(v,v+d),E=[],w=0;w<b.length;w++)E.push({value:b[w],index:w});for(E.sort((function(S,I){return I.value-S.value})),p[g]=0,w=0;w<t;w++)if(E[w].index===u[g]){p[g]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,pr(p,i.shape,"bool")]}}))}))};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ir||(Ir={}));var AH=Y({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Ir.SUM_BY_NONZERO_WEIGHTS);var i=z(n,"labels","absoluteDifference"),a=z(e,"predictions","absoluteDifference"),s=null;t!=null&&(s=z(t,"weights","absoluteDifference")),Ft(i.shape,a.shape,"Error in absoluteDifference: ");var u=i.sub(a).abs();return Us(u,s,r)}}),Us=Y({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Ir.SUM_BY_NONZERO_WEIGHTS);var r=z(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=z(e,"weights","computeWeightedLoss"));var a=i==null?r:r.mul(i);if(t===Ir.NONE)return a;if(t===Ir.SUM)return a.sum();if(t===Ir.MEAN){if(i==null)return a.mean();var s=r.size/i.size,u=a.sum().div(i.sum());return s>1?u.div(Ae(s)):u}if(t===Ir.SUM_BY_NONZERO_WEIGHTS){if(i==null)return a.sum().div(Ae(r.size));var c=i.mul(ch(r.shape)).notEqual(Ae(0)).sum().toFloat();return a.sum().div(c)}throw Error("Unknown reduction: "+t)}}),RH=Y({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Ir.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"labels","cosineDistance"),s=z(e,"predictions","cosineDistance"),u=null;r!=null&&(u=z(r,"weights","cosineDistance")),Ft(a.shape,s.shape,"Error in cosineDistance: ");var c=Ae(1).sub(a.mul(s).sum(t,!0));return Us(c,u,i)}}),IH=Y({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Ir.SUM_BY_NONZERO_WEIGHTS);var i=z(n,"labels","hingeLoss"),a=z(e,"predictions","hingeLoss"),s=null;t!=null&&(s=z(t,"weights","hingeLoss")),Ft(i.shape,a.shape,"Error in hingeLoss: ");var u=Ae(1);i=Ae(2).mul(i).sub(u);var c=u.sub(i.mul(a)).relu();return Us(c,s,r)}}),NH=Y({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Ir.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"labels","huberLoss"),s=z(e,"predictions","huberLoss"),u=null;t!=null&&(u=z(t,"weights","huberLoss")),Ft(a.shape,s.shape,"Error in huberLoss: ");var c=Ae(r),h=s.sub(a).abs(),d=Jk(h,c),p=h.sub(d),g=Ae(.5).mul(d.square()).add(c.mul(p));return Us(g,u,i)}}),DH=Y({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Ir.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"labels","logLoss"),s=z(e,"predictions","logLoss"),u=null;t!=null&&(u=z(t,"weights","logLoss")),Ft(a.shape,s.shape,"Error in logLoss: ");var c=Ae(1),h=Ae(r),d=a.mul(s.add(h).log()).neg().sub(c.sub(a).mul(c.sub(s).add(h).log()));return Us(d,u,i)}}),kH=Y({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Ir.SUM_BY_NONZERO_WEIGHTS);var i=z(n,"labels","meanSquaredError"),a=z(e,"predictions","meanSquaredError"),s=null;t!=null&&(s=z(t,"weights","meanSquaredError")),Ft(i.shape,a.shape,"Error in meanSquaredError: ");var u=i.squaredDifference(a);return Us(u,s,r)}}),MH=Y({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Ir.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"multiClassLabels","sigmoidCrossEntropy"),s=z(e,"logits","sigmoidCrossEntropy"),u=null;if(t!=null&&(u=z(t,"weights","sigmoidCrossEntropy")),Ft(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=Ae(r),h=Ae(1),d=Ae(.5);a=a.mul(h.sub(c)).add(d.mul(c))}var p=(function(g,v){var b=z(g,"labels","sigmoidCrossEntropyWithLogits"),E=z(v,"logits","sigmoidCrossEntropyWithLogits");Ft(b.shape,E.shape,"Error in sigmoidCrossEntropyWithLogits: ");var w=E.relu(),C=E.mul(b),S=E.abs().neg().exp().log1p();return w.sub(C).add(S)})(a,s);return Us(p,u,i)}}),OH=Y({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Ir.SUM_BY_NONZERO_WEIGHTS);var a=z(n,"onehotLabels","softmaxCrossEntropy"),s=z(e,"logits","softmaxCrossEntropy"),u=null;if(t!=null&&(u=z(t,"weights","softmaxCrossEntropy")),Ft(a.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Ae(r),h=Ae(1),d=Ae(a.shape[1]);a=a.mul(h.sub(c)).add(c.div(d))}var p=(function(g,v,b){if(b===void 0&&(b=-1),b===-1&&(b=v.rank-1),b!==v.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+v.rank+" and dim was "+b);return pv((function(E,w,C){var S=w.logSumExp([b],!0),I=w.toFloat().sub(S);return C([E,I]),{value:I.mul(E).neg().sum([b]),gradFunc:function(D,O){var B=O[0],N=O[1],R=ti(D.shape,[b]);return[D.reshape(R).mul(B.toFloat().sub(N.exp())),D.reshape(R).mul(N.exp().sub(B.toFloat()))]}}}))(g,v)})(a,s);return Us(p,u,i)}}),PH=Object.freeze({get Reduction(){return Ir},absoluteDifference:AH,computeWeightedLoss:Us,cosineDistance:RH,hingeLoss:IH,huberLoss:NH,logLoss:DH,meanSquaredError:kH,sigmoidCrossEntropy:MH,softmaxCrossEntropy:OH});function ZA(n,e){return e===void 0&&(e=!1),J.tidy((function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=dk(t),a=n.clone(),s=No([[1]],[1,1]),u=s.clone(),c=t>=r?r:t,h=function(p){var g,v=a,b=u,E=i;g=J.tidy((function(){var w=a.slice([p,p],[t-p,1]),C=w.norm(),S=a.slice([p,p],[1,1]),I=No([[-1]]).where(S.greater(0),No([[1]])),D=S.sub(I.mul(C)),O=w.div(D);u=O.shape[0]===1?s.clone():s.concat(O.slice([1,0],[O.shape[0]-1,O.shape[1]]),0);var B=I.matMul(D).div(C).neg(),N=a.slice([p,0],[t-p,r]),R=B.mul(u);if(p===0)a=N.sub(R.matMul(u.transpose().matMul(N)));else{var k=N.sub(R.matMul(u.transpose().matMul(N)));a=a.slice([0,0],[p,r]).concat(k,0)}var P=i.slice([0,p],[t,i.shape[1]-p]);if(p===0)i=P.sub(P.matMul(u).matMul(R.transpose()));else{var V=P.sub(P.matMul(u).matMul(R.transpose()));i=i.slice([0,0],[t,p]).concat(V,1)}return[u,a,i]})),u=g[0],a=g[1],i=g[2],ei([v,b,E])},d=0;d<c;++d)h(d);return!e&&t>r&&(i=i.slice([0,0],[t,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var FH=Y({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=z(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),s=a[0],u=a[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(t<=u))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+u+").");e<0&&(e=s),t<0&&(t=u);var c=wg(0,s,1,"int32").reshape([-1,1]),h=wg(0,u,1,"int32"),d=qn(c,h),p=gv(d.lessEqual(Ae(+e,"int32")),d.greaterEqual(Ae(-t,"int32"))),g=$t([s,u],r.dtype);return yi(Hn(r.reshape([-1,s,u])).map((function(v){return el(p,v,g)}))).reshape(i)}}),VH=Y({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,G(n!=null&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=n[0].shape[0],r=function(c){G(n[c].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[c].shape[0]+" vs. "+t+")"}))},i=1;i<n.length;++i)r(i)}else e=!0,n=wx(n,n.shape[0],0).map((function(c){return gk(c,[0])}));G(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var a=[],s=n,u=function(c){a.push(J.tidy((function(){var h=s[c];if(c>0)for(var d=0;d<c;++d){var p=fM(a[d].mulStrict(h)).mul(a[d]);h=h.sub(p)}return h.div(gM(h,"euclidean"))})))};for(i=0;i<n.length;++i)u(i);return e?yi(a,0):a}}),LH=Y({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return ZA(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce((function(s,u){return s*u})),r=Hn(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],a=[];return r.forEach((function(s){var u=ZA(s,e),c=u[0],h=u[1];i.push(c),a.push(h)})),[yi(i,0).reshape(n.shape),yi(a,0).reshape(n.shape)]}}),BH=Object.freeze({bandPart:FH,gramSchmidt:VH,qr:LH});function bv(n,e,t,r,i,a){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),a==null&&(a=0);var s=n.shape[0];return t=Math.min(t,s),G(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),G(n.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),G(n.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),G(e.rank===1,(function(){return"scores must be a 1D tensor"})),G(e.shape[0]===s,(function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]})),G(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var jH=Y({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=z(n,"images","resizeBilinear");G(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),G(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var i=r,a=!1;r.rank===3&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],u=e[1],c=J.runKernelFunc((function(h,d){return d([i]),h.resizeBilinear(i,s,u,t)}),{x:i},(function(h,d){return{x:function(){return J.runKernelFunc((function(p){return p.resizeBilinearBackprop(h,d[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:u});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),UH=Y({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=z(n,"images","resizeNearestNeighbor");G(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),G(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),G(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;r.rank===3&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],u=e[1],c=J.runKernelFunc((function(h,d){return d([i]),h.resizeNearestNeighbor(i,s,u,t)}),{batchImages:i},(function(h,d){return{batchImages:function(){return J.runKernelFunc((function(p){return p.resizeNearestNeighborBackprop(h,d[0],t)}),{})}}}));return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),zH=Y({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var a=z(n,"boxes","nonMaxSuppression"),s=z(e,"scores","nonMaxSuppression"),u=bv(a,s,t,r,i);t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold;var c={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return J.runKernelFunc((function(h){return h.nonMaxSuppression(a,s,t,r,i)}),{boxes:a,scores:s},null,"NonMaxSuppressionV3",c)}}),HH=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Ve(this,void 0,void 0,(function(){var a,s,u,c,h,d,p;return Le(this,(function(g){switch(g.label){case 0:return a=z(n,"boxes","nonMaxSuppressionAsync"),s=z(e,"scores","nonMaxSuppressionAsync"),u=bv(a,s,t,r,i),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([a.data(),s.data()])];case 1:return c=g.sent(),h=c[0],d=c[1],p=Sx(h,d,t,r,i),a!==n&&a.dispose(),s!==e&&s.dispose(),[2,p]}}))}))},GH=Y({nonMaxSuppressionWithScore_:function(n,e,t,r,i,a){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var s=z(n,"boxes","nonMaxSuppression"),u=z(e,"scores","nonMaxSuppression"),c=bv(s,u,t,r,i,a),h={maxOutputSize:t=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:a=c.softNmsSigma},d=J.runKernel("NonMaxSuppressionV5",{boxes:s,scores:u},h);return{selectedIndices:d[0],selectedScores:d[1]}}}),WH=function(n,e,t,r,i,a){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),Ve(this,void 0,void 0,(function(){var s,u,c,h,d,p,g;return Le(this,(function(v){switch(v.label){case 0:return s=z(n,"boxes","nonMaxSuppressionAsync"),u=z(e,"scores","nonMaxSuppressionAsync"),c=bv(s,u,t,r,i,a),t=c.maxOutputSize,r=c.iouThreshold,i=c.scoreThreshold,a=c.softNmsSigma,[4,Promise.all([s.data(),u.data()])];case 1:return h=v.sent(),d=h[0],p=h[1],g=Ax(d,p,t,r,i,a),s!==n&&s.dispose(),u!==e&&u.dispose(),[2,g]}}))}))},qH=Y({cropAndResize_:function(n,e,t,r,i,a){var s=z(n,"image","cropAndResize"),u=z(e,"boxes","cropAndResize","float32"),c=z(t,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var h=u.shape[0];return G(s.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."})),G(u.rank===2&&u.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+u.shape+"."})),G(c.rank===1&&c.shape[0]===h,(function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+u.shape+"."})),G(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),G(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),G(i==="bilinear"||i==="nearest",(function(){return"method must be bilinear or nearest, but was "+i})),J.runKernelFunc((function(d,p){return d.cropAndResize(s,u,c,r,i,a)}),{images:s,boxes:u,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),Ux=Object.freeze({resizeBilinear:jH,resizeNearestNeighbor:UH,nonMaxSuppression:zH,nonMaxSuppressionAsync:HH,nonMaxSuppressionWithScore:GH,nonMaxSuppressionWithScoreAsync:WH,cropAndResize:qH}),zx=function(n,e){return!(n>0)||e==="linear"},Hx=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Gx=function(n,e){var t=e,r=Wn(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},Wx=function(n,e,t){if(e==="linear")return n;if(e==="relu")return un(n);if(e==="elu")return dM(n);if(e==="relu6")return mM(n);if(e==="prelu")return pM(n,t);throw new Error("Unknown fused activation "+e+".")},KH=Y({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,a=i!==void 0&&i,s=n.transposeB,u=s!==void 0&&s,c=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights;if(zx(J.state.gradientDepth,d)===!1){var g=yv(t,r,a,u);return c!=null&&(g=ft(g,c)),Wx(g,d,p)}var v=z(t,"a","fused matMul"),b=z(r,"b","fused matMul");e=ln(v,b),v=e[0],b=e[1];var E=a?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?b.shape[b.rank-1]:b.shape[b.rank-2],C=a?v.shape[v.rank-1]:v.shape[v.rank-2],S=u?b.shape[b.rank-2]:b.shape[b.rank-1],I=v.shape.slice(0,-2),D=b.shape.slice(0,-2),O=je(I),B=je(D);G(v.rank>=2&&b.rank>=2&&v.rank===b.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+v.rank+" and "+b.rank+"."})),G(rr(I,D),(function(){return"Error in fused matMul: outer dimensions ("+I+") and ("+D+") of Tensors with shapes "+v.shape+" and "+b.shape+" must match."})),G(E===w,(function(){return"Error in fused matMul: inner shapes ("+E+") and ("+w+") of Tensors with shapes "+v.shape+" and "+b.shape+" and transposeA="+a+" and transposeB="+u+" must match."}));var N,R,k=v.shape.slice(0,-2).concat([C,S]),P=a?v.as3D(O,E,C):v.as3D(O,C,E),V=u?b.as3D(B,S,w):b.as3D(B,w,S);c!=null&&mt(k,(N=ln(N=z(c,"bias","fused matMul"),v)[0]).shape),p!=null&&(R=z(p,"prelu weights","fused matMul"));var j={a:P,b:V};c!=null&&(j.bias=N),p!=null&&(j.preluActivationWeights=R);var L=[P,V];return J.runKernelFunc((function(Z,ne){var q=Z.fusedBatchMatMul({a:P,b:V,transposeA:a,transposeB:u,bias:N,activation:d,preluActivationWeights:R});return ne([P,V,q]),q}),j,(function(Z,ne){var q=ne[0],X=ne[1],ee=ne[2],ue=Hx(Z,ee,d),fe={};return c!=null&&(fe={bias:function(){return Gx(N,ue)}}),Object.assign(a||u?!a&&u?{a:function(){return ue.matMul(X,!1,!1)},b:function(){return ue.matMul(q,!0,!1)}}:a&&!u?{a:function(){return X.matMul(ue,!1,!0)},b:function(){return q.matMul(ue,!1,!1)}}:{a:function(){return X.matMul(ue,!0,!0)},b:function(){return ue.matMul(q,!0,!0)}}:{a:function(){return ue.matMul(X,!1,!0)},b:function(){return q.matMul(ue,!0,!1)}},fe)}),"_FusedMatMul",{transposeA:a,transposeB:u,activation:d},L,[!0]).reshape(k)}}),XH=Y({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,a=n.dataFormat,s=a===void 0?"NHWC":a,u=n.dilations,c=u===void 0?[1,1]:u,h=n.dimRoundingMode,d=n.bias,p=n.activation,g=p===void 0?"linear":p,v=n.preluActivationWeights;if(g=g||"linear",zx(J.state.gradientDepth,g)===!1){var b=Hi(e,t,r,i,s,c,h);return d!=null&&(b=ft(b,d)),Wx(b,g,v)}var E=z(e,"x","conv2d"),w=z(t,"filter","conv2d"),C=E,S=!1;E.rank===3&&(S=!0,C=E.as4D(1,E.shape[0],E.shape[1],E.shape[2])),G(C.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+C.rank+"."})),G(w.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+w.rank+"."})),h!=null&&G(bn(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+i+"."})),G(C.shape[3]===w.shape[2],(function(){return"Error in conv2d: depth of input ("+C.shape[3]+") must match input depth for filter "+w.shape[2]+"."})),G(ni(r,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),G(s==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."}));var I,D,O=ll(C.shape,w.shape,r,c,i,h);d!=null&&(I=ln(I=z(d,"bias","fused conv2d"),E)[0],mt(O.outShape,I.shape)),v!=null&&(D=z(v,"prelu weights","fused conv2d"));var B={x:C,filter:w};d!=null&&(B.bias=I),v!=null&&(B.preluActivationWeights=D);var N=[w,C],R=J.runKernelFunc((function(k,P){var V=k.fusedConv2d({input:C,filter:w,convInfo:O,bias:I,activation:g,preluActivationWeights:D});return P([w,C,V]),V}),B,(function(k,P){var V=P,j=V[0],L=V[1],Z=V[2],ne=Hx(k,Z,g);G(Yc(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"}));var q={};return d!=null&&(q={bias:function(){return Gx(I,ne)}}),Object.assign({x:function(){return aM(L.shape,ne,j,r,i)},filter:function(){return Px(L,ne,j.shape,r,i)}},q)}),"FusedConv2D",{convInfo:O,activation:g},N,[!0]);return S?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),YH=Y({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,a=n.dataFormat,s=a===void 0?"NHWC":a,u=n.dilations,c=u===void 0?[1,1]:u,h=n.dimRoundingMode,d=n.bias,p=n.activation,g=p===void 0?"linear":p,v=n.preluActivationWeights;if(zx(J.state.gradientDepth,g)===!1){var b=vv(e,t,r,i,s,c,h);return d!=null&&(b=ft(b,d)),Wx(b,g,v)}var E=z(e,"x","depthwiseConv2d"),w=z(t,"filter","depthwiseConv2d"),C=E,S=!1;E.rank===3&&(S=!0,C=E.as4D(1,E.shape[0],E.shape[1],E.shape[2])),G(C.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+C.rank+"."})),G(w.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+w.rank+"."})),G(C.shape[3]===w.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+C.shape[3]+") must match the inChannels dimension in filter "+w.shape[2]+"."})),c==null&&(c=[1,1]),G(ni(r,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),h!=null&&G(bn(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+i+"."}));var I,D,O=ll(C.shape,w.shape,r,c,i,h,!0);d!=null&&(I=ln(I=z(d,"bias","fused conv2d"),E)[0],mt(O.outShape,I.shape)),v!=null&&(D=z(v,"prelu weights","fused depthwiseConv2d"));var B={x:C,filter:w};d!=null&&(B.bias=I),v!=null&&(B.preluActivationWeights=D);var N=[w,C],R=J.runKernelFunc((function(k,P){var V=k.fusedDepthwiseConv2D({input:C,filter:w,convInfo:O,bias:I,activation:g,preluActivationWeights:D});return P([w,C,V]),V}),B,(function(k,P){G(Yc(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"}));var V=P[0],j=P[1],L=P[2],Z=Hx(k,L,g),ne={};return d!=null&&(ne={bias:function(){return Gx(I,Z)}}),Object.assign({x:function(){return sM(j.shape,Z,V,O)},filter:function(){return oM(j,Z,V.shape,O)}},ne)}),"FusedDepthwiseConv2D",{convInfo:O,activation:g},N,[!0]);return S?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),$H=Object.freeze({matMul:KH,conv2d:XH,depthwiseConv2d:YH}),QH=Object.freeze({image:Ux,linalg:BH,losses:PH,spectral:bH,fused:$H,signal:CH,square:D9,squaredDifference:Hk,conv1d:j8,conv2d:Hi,conv3d:U8,depthwiseConv2d:vv,separableConv2d:Fx,conv2dTranspose:z8,conv3dTranspose:H8,op:Y,batchNormalization2d:o8,batchNormalization3d:u8,batchNormalization4d:l8,batchNormalization:c8,batchNorm:Yk,batchNorm2d:h8,batchNorm3d:f8,batchNorm4d:d8,booleanMaskAsync:B8,complex:fr,real:Pi,imag:ja,concat:zn,concat1d:$5,concat2d:Q5,concat3d:Z5,concat4d:J5,split:wx,matMul:yv,dot:G8,outerProduct:W8,reverse:Vd,reverse1d:q8,reverse2d:K8,reverse3d:X8,reverse4d:Y8,maxPool:Zn,avgPool:Ld,pool:$8,maxPool3d:Q8,avgPool3d:Z8,slice:Za,slice1d:J8,slice2d:eH,slice3d:cM,slice4d:tH,abs:k9,acos:M9,acosh:O9,asin:P9,asinh:F9,atan:V9,atanh:L9,ceil:B9,clipByValue:kx,cos:j9,cosh:U9,erf:z9,exp:Gb,expm1:H9,floor:G9,log:W9,log1p:q9,logSigmoid:K9,neg:Ng,reciprocal:X9,round:Y9,rsqrt:Gk,sigmoid:Wk,sign:$9,isNaN:Q9,isInf:Z9,isFinite:J9,sin:e8,sinh:t8,softplus:n8,sqrt:r8,step:i8,tan:a8,tanh:s8,all:nH,any:rH,argMax:iH,argMin:aH,logSumExp:sH,max:_v,mean:oH,min:uH,moments:lH,sum:fM,prod:cH,equal:eM,equalStrict:I8,greater:N8,greaterEqual:tM,greaterEqualStrict:D8,greaterStrict:k8,less:M8,lessEqual:O8,lessEqualStrict:P8,lessStrict:F8,notEqual:V8,notEqualStrict:L8,add:ft,addN:g8,addStrict:v8,atan2:y8,div:ra,divNoNan:_8,divStrict:b8,floorDiv:Zk,maximum:Mx,maximumStrict:x8,minimum:Jk,minimumStrict:w8,mod:E8,modStrict:T8,mul:Dr,mulStrict:C8,pow:Dg,powStrict:S8,squaredDifferenceStrict:A8,sub:qn,subStrict:R8,elu:dM,leakyRelu:hH,prelu:pM,relu:un,relu6:mM,selu:fH,logicalAnd:gv,logicalNot:p8,logicalOr:$k,logicalXor:m8,where:el,whereAsync:Qk,buffer:it,print:uU,batchToSpaceND:fk,broadcastTo:lU,cast:cU,clone:hU,cumsum:fU,depthToSpace:dU,expandDims:Oi,eye:dk,multinomial:pU,oneHot:jb,pad:ul,pad1d:mU,pad2d:gU,pad3d:vU,pad4d:yU,rand:_U,randomNormal:bU,randomGamma:xU,randomUniform:pk,reshape:aa,spaceToBatchND:mk,squeeze:gk,stack:yi,tile:Dc,truncatedNormal:wU,unstack:Hn,setdiff1dAsync:EU,fill:Ka,linspace:Y5,ones:ch,range:wg,scalar:Ae,tensor:pr,tensor1d:Mn,tensor2d:No,tensor3d:xx,tensor4d:Yr,tensor5d:q5,tensor6d:K5,variable:X5,zeros:$t,onesLike:hk,zerosLike:At,transpose:Ho,softmax:js,logSoftmax:NU,localResponseNormalization:dH,norm:gM,gather:Ox,unsortedSegmentSum:nM,basicLSTMCell:pH,multiRNNCell:mH,movingAverage:gH,stridedSlice:vH,topk:yH,scatterND:_H,fft:Vx,ifft:kg,rfft:Lx,irfft:vM,sparseToDense:xH,gatherND:wH,diag:EH,dropout:TH,hannWindow:Bx,hammingWindow:_M,frame:jx,stft:bM,inTopKAsync:SH});function Ee(n,e){Array.isArray(n)||(n=[n]),n.forEach((function(t){t!=null&&G(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function O_(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var ZH=(function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Ek(t,J),t}return ha(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,ge().get("IS_NODE")&&bg(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:t,dtype:i}),a},e.prototype.move=function(t,r,i,a){this.data.set(t,{values:r,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Ve(this,void 0,void 0,(function(){return Le(this,(function(r){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,a=r.complexTensors;return i==="complex64"?Hb(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map((function(a){return vg(a)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return it(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var a=this.write(t,r,i);return J.makeTensorFromDataId(a,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Ve(this,void 0,void 0,(function(){var r;return Le(this,(function(i){return r=La(),t(),[2,{kernelMs:La()-r}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:J.keep(t.clone()),imag:J.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Ee(t,"slice"),xk(t.shape,r,i)){var a=wk(r,t.strides),s=je(i);return pr(this.readSync(t.dataId).subarray(a,a+s),i,t.dtype)}for(var u=it(i,t.dtype),c=this.bufferSync(t),h=0;h<u.size;++h){var d=u.indexToLoc(h).map((function(p,g){return p+r[g]}));u.values[h]=c.get.apply(c,d)}return u.toTensor()},e.prototype.stridedSlice=function(t,r,i,a){Ee(t,"stridedSlice");var s=Tx(r,i,a);if(s.some((function(v){return v===0})))return pr([],s);for(var u=it(s,t.dtype),c=this.bufferSync(t),h=0;h<u.size;h++){for(var d=u.indexToLoc(h),p=new Array(d.length),g=0;g<p.length;g++)p[g]=d[g]*a[g]+r[g];u.set.apply(u,[c.get.apply(c,p)].concat(d))}return u.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=it([t.size,t.size],t.dtype),a=i.values,s=0;s<r.length;s++)a[s*t.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],a=new Array(t.rank-1),s=0,u=0;u<t.rank;u++)u!==r&&(a[s++]=t.shape[u]);var c=new Array(t.rank).fill(0),h=t.shape.slice();h[r]=1;var d=new Array(i);for(u=0;u<d.length;u++)c[r]=u,d[u]=this.slice(t,c,h).reshape(a);return d},e.prototype.reverse=function(t,r){Ee(t,"reverse");for(var i=it(t.shape,t.dtype),a=this.bufferSync(t),s=function(c){var h=i.indexToLoc(c),d=h.slice();r.forEach((function(p){return d[p]=t.shape[p]-1-d[p]})),i.set.apply(i,[a.get.apply(a,d)].concat(h))},u=0;u<i.size;u++)s(u);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var a=t.map((function(v){return Pi(v)})),s=t.map((function(v){return ja(v)}));return fr(this.concat(a,r),this.concat(s,r))}var u=t.map((function(v){var b=je(v.shape.slice(r));return v.as2D(-1,b)})),c=Xc(u.map((function(v){return v.shape})),1),h=it(c,t[0].dtype).values;if(u[0].shape[0]===1){var d=0;u.forEach((function(v){h.set(i.readSync(v.dataId),d),d+=v.size}))}else{var p=0;u.forEach((function(v){for(var b=i.readSync(v.dataId),E=0,w=0;w<v.shape[0];++w)for(var C=w*c[1]+p,S=0;S<v.shape[1];++S)h[C+S]=b[E++];p+=v.shape[1]}))}var g=Xc(t.map((function(v){return v.shape})),r);return pr(h,g,t[0].dtype)},e.prototype.neg=function(t){return Ee(t,"neg"),this.multiply(Ae(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,a,s,u){return{real:i+s,imag:a+u}})):this.broadcastedBinaryOp(t,r,dr(t.dtype,r.dtype),(function(i,a){return i+a}))},e.prototype.addN=function(t){var r=this;Ee(t,"addN");for(var i=t.map((function(d){return r.readSync(d.dataId)})),a=it(t[0].shape,t[0].dtype),s=a.values,u=0;u<t.length;u++)for(var c=i[u],h=0;h<s.length;h++)s[h]+=c[h];return a.toTensor()},e.prototype.softmax=function(t,r){var i=Kn([r],t.shape),a=this.max(t,i),s=ti(a.shape,i),u=this.subtract(t,a.reshape(s)),c=this.exp(u),h=this.sum(c,i).reshape(s);return this.realDivide(c,h)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,a,s,u){return{real:i-s,imag:a-u}})):this.broadcastedBinaryOp(t,r,dr(t.dtype,r.dtype),(function(i,a){return i-a}))},e.prototype.pow=function(t,r){return Ee([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.pow(i,a)}))},e.prototype.batchMatMul=function(t,r,i,a){Ee([t,r],"matMul");for(var s=i?t.shape[1]:t.shape[2],u=i?t.shape[2]:t.shape[1],c=a?r.shape[1]:r.shape[2],h=t.shape[0],d=this.readSync(t.dataId),p=this.readSync(r.dataId),g=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],v=g[0],b=g[1],E=g[2],w=a?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],C=w[0],S=w[1],I=w[2],D=u*c,O=it([h,u,c],t.dtype),B=O.values,N=this.blockSize,R=0;R<h;R++)for(var k=0;k<u;k+=N)for(var P=0;P<c;P+=N)for(var V=0;V<s;V+=N)for(var j=Math.min(k+N,u),L=Math.min(P+N,c),Z=Math.min(V+N,s),ne=k;ne<j;ne++)for(var q=P;q<L;q++){for(var X=0,ee=V;ee<Z;ee++)X+=d[R*v+ne*b+ee*E]*p[ee*C+q*S+R*I];B[R*D+(ne*c+q)]+=X}return O.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,a=t.transposeA,s=t.transposeB,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=this.batchMatMul(r,i,a,s);return u&&(d=this.add(d,u)),c&&(d=O_(this,d,c,h)),d},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,a,s,u){return{real:i*s-a*u,imag:i*u+a*s}})):this.broadcastedBinaryOp(t,r,dr(t.dtype,r.dtype),(function(i,a){return i*a}))},e.prototype.realDivide=function(t,r){return Ee([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(i,a){return i/a}))},e.prototype.floorDiv=function(t,r){return Ee([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(i,a){return Math.floor(i/a)}))},e.prototype.sum=function(t,r){Ee(t,"sum"),fi("sum",r,t.rank);for(var i=wr(t.shape,r),a=i[0],s=i[1],u=$t(a,dr(t.dtype,"int32")),c=je(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=0,b=0;b<c;++b)v+=d[g+b];h[p]=v}return u},e.prototype.prod=function(t,r){Ee(t,"sum");for(var i=wr(t.shape,r),a=i[0],s=i[1],u=$t(a,dr(t.dtype,"int32")),c=je(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=1,b=0;b<c;++b)v*=d[g+b];h[p]=v}return u},e.prototype.unsortedSegmentSum=function(t,r,i){Ee(t,"unsortedSegmentSum");for(var a=[],s=t.rank-r.rank,u=0;u<s;++u)r=r.expandDims(u+1);for(u=0;u<i;++u){var c=Ae(u,"int32"),h=eM(c,r).asType("float32").mul(t).sum(0);a.push(h)}return yi(a)},e.prototype.argMin=function(t,r){Ee(t,"argMin");var i=[r];fi("argMin",i,t.rank);for(var a=wr(t.shape,i),s=a[0],u=a[1],c=$t(s,"int32"),h=je(u),d=this.readSync(c.dataId),p=this.readSync(t.dataId),g=0;g<d.length;++g){for(var v=g*h,b=p[v],E=0,w=0;w<h;++w){var C=p[v+w];C<b&&(b=C,E=w)}d[g]=E}return c},e.prototype.argMax=function(t,r){Ee(t,"argMax");var i=[r];fi("argMax",i,t.rank);for(var a=wr(t.shape,i),s=a[0],u=a[1],c=$t(s,"int32"),h=je(u),d=this.readSync(c.dataId),p=this.readSync(t.dataId),g=0;g<d.length;++g){for(var v=g*h,b=p[v],E=0,w=0;w<h;++w){var C=p[v+w];C>b&&(b=C,E=w)}d[g]=E}return c},e.prototype.cumsum=function(t,r,i,a){if(Ee(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var s=dr(t.dtype,"int32"),u=$t(t.shape,s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=t.shape[t.rank-1],p=a?function(w,C){return w+d-C-1}:function(w,C){return w+C},g=0;g<h.length;g+=d)for(var v=0;v<d;v++){var b=p(g,v);if(v===0)c[b]=i?0:h[b];else{var E=p(g,v-1);c[b]=i?h[E]+c[E]:h[b]+c[E]}}return u},e.prototype.equal=function(t,r){return Ee([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i===a?1:0}))},e.prototype.notEqual=function(t,r){return Ee([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i!==a?1:0}))},e.prototype.less=function(t,r){return Ee([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i<a?1:0}))},e.prototype.lessEqual=function(t,r){return Ee([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i<=a?1:0}))},e.prototype.greater=function(t,r){return Ee([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i>a?1:0}))},e.prototype.greaterEqual=function(t,r){return Ee([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i>=a?1:0}))},e.prototype.logicalNot=function(t){Ee(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)i[a]=r[a]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Ee([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i&&a}))},e.prototype.logicalOr=function(t,r){return Ee([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(i,a){return i||a}))},e.prototype.select=function(t,r,i){Ee([t,r,i],"select");for(var a=this.readSync(t.dataId),s=this.readSync(r.dataId),u=this.readSync(i.dataId),c=$t(r.shape,dr(r.dtype,i.dtype)),h=this.readSync(c.dataId),d=0,p=t.rank===0||t.rank>1||r.rank===1?1:je(r.shape.slice(1)),g=0;g<a.length;g++)for(var v=0;v<p;v++)a[g]===1?h[d++]=s[g]:h[d++]=u[g];return c},e.prototype.where=function(t){Ee([t],"where");var r=this.readSync(t.dataId);return Rx(t.shape,r)},e.prototype.topk=function(t,r,i){return Ee(t,"topk"),Dk(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ee(t,"min"),fi("min",r,t.rank);for(var i=wr(t.shape,r),a=i[0],s=i[1],u=$t(a,t.dtype),c=je(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var E=d[g+b];E<v&&(v=E)}h[p]=v}return u},e.prototype.minimum=function(t,r){return Ee([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.min(i,a)}))},e.prototype.mod=function(t,r){return Ee([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){var s=i%a;return i<0&&a<0||i>=0&&a>=0?s:(s+a)%a}))},e.prototype.max=function(t,r){Ee(t,"max"),fi("max",r,t.rank);for(var i=wr(t.shape,r),a=i[0],s=i[1],u=$t(a,t.dtype),c=je(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var E=d[g+b];E>v&&(v=E)}h[p]=v}return u},e.prototype.maximum=function(t,r){return Ee([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.max(i,a)}))},e.prototype.all=function(t,r){Ee(t,"all"),fi("all",r,t.rank);for(var i=wr(t.shape,r),a=i[0],s=i[1],u=$t(a,t.dtype),c=je(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var E=d[g+b];v=v&&E}h[p]=v}return u},e.prototype.any=function(t,r){Ee(t,"any"),fi("any",r,t.rank);for(var i=wr(t.shape,r),a=i[0],s=i[1],u=$t(a,t.dtype),c=je(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),p=0;p<h.length;++p){for(var g=p*c,v=d[g],b=0;b<c;++b){var E=d[g+b];v=v||E}h[p]=v}return u},e.prototype.squaredDifference=function(t,r){return Ee([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){var s=i-a;return s*s}))},e.prototype.ceil=function(t){Ee(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.ceil(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Ee(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.floor(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)r[a]<0?i[a]=-1:r[a]>0?i[a]=1:i[a]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isNaN(r[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)Math.abs(r[a])===1/0&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Ee(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isFinite(r[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Ee(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var s=Math.floor(r[a]);r[a]-s<.5?i[a]=Math.floor(r[a]):r[a]-s>.5?i[a]=Math.ceil(r[a]):i[a]=s%2==0?s:s+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Ee(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.exp(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Ee(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=Math.expm1(r[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Ee(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var s=r[a];i[a]=Math.log(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Ee(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var s=r[a];i[a]=Math.log1p(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Ee(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var s=r[a];i[a]=Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Ee(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a){var s=r[a];i[a]=1/Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Ee(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),a=0;a<r.length;++a)i[a]=1/r[a];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Ee(t,"relu");for(var r=$t(t.shape,t.dtype),i=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<a.length;++s)i[s]=Math.max(0,a[s]);return r},e.prototype.relu6=function(t){Ee(t,"relu");for(var r=$t(t.shape,t.dtype),i=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<a.length;++s)i[s]=Math.min(Math.max(0,a[s]),6);return r},e.prototype.prelu=function(t,r){return Ee([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return i<0?a*i:i}))},e.prototype.elu=function(t){Ee(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a];r[a]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Ee([t,r],"eluDer");for(var i=new Float32Array(r.size),a=this.readSync(r.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){var c=a[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Ee(t,"selu");for(var r=Nx,i=Dx,a=new Float32Array(t.size),s=this.readSync(t.dataId),u=0;u<s.length;++u){var c=s[u];a[u]=c>=0?i*c:r*(Math.exp(c)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,r,i){Ee(t,"clip");for(var a=new Float32Array(t.size),s=this.readSync(t.dataId),u=0;u<s.length;++u){var c=s[u];a[u]=c>i?i:c<r?r:c}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.abs(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<t.size;++a){var s=i[2*a],u=i[2*a+1];r[a]=Math.hypot(s,u)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Ee(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=i[a];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Ee(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=1/(1+Math.exp(-i[a]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Ee(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s]>-r,c=a[s]<r,h=Math.exp(a[s]),d=void 0;d=c?h:u?a[s]:Math.log(1+h),i[s]=d}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Ee(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.sin(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Ee(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.cos(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Ee(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.tan(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Ee(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.asin(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Ee(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.acos(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Ee(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.atan(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Ee([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,a){return Math.atan2(i,a)}))},e.prototype.sinh=function(t){Ee(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.sinh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Ee(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.cosh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Ee(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=J6(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Ee(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.asinh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Ee(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.acosh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Ee(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)r[a]=Math.atanh(i[a]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Ee(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=Math.sign(i[a]),u=Math.abs(i[a]),c=1/(1+.3275911*u);r[a]=s*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-u*u))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Ee(t,"step");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];isNaN(u)?i[s]=NaN:i[s]=u>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,h=this.conv2d(r,i,a);return s&&(h=this.add(h,s)),u&&(h=O_(this,h,u,c)),h},e.prototype.conv2d=function(t,r,i){Ee([t,r],"conv2d");for(var a=i.filterHeight,s=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.left,d=i.padInfo.top,p=i.dataFormat==="channelsLast",g=it(i.outShape,t.dtype),v=t.strides[0],b=p?t.strides[1]:t.strides[2],E=p?t.strides[2]:1,w=p?1:t.strides[1],C=g.strides[0],S=p?g.strides[1]:g.strides[2],I=p?g.strides[2]:1,D=p?1:g.strides[1],O=this.readSync(t.dataId),B=this.readSync(r.dataId),N=g.values,R=0;R<i.batchSize;++R)for(var k=R*v,P=R*C,V=0;V<i.outHeight;++V)for(var j=P+V*S,L=V*i.strideHeight-d,Z=0;Z<a;Z++){var ne=L+Z*u;if(!(ne<0||ne>=i.inHeight))for(var q=Z*r.strides[0],X=k+ne*b,ee=0;ee<i.outWidth;++ee)for(var ue=j+ee*I,fe=ee*i.strideWidth-h,W=0;W<s;W++){var $=fe+W*c;if(!($<0||$>=i.inWidth))for(var ce=X+$*E,ve=q+W*r.strides[1],Te=0;Te<i.inChannels;++Te){for(var Se=O[ce+Te*w],_e=0;_e<i.outChannels;++_e)N[ue+_e*D]+=Se*B[ve+_e];ve+=i.outChannels}}}return g.toTensor()},e.prototype.conv3d=function(t,r,i){for(var a=i.filterDepth,s=i.filterHeight,u=i.filterWidth,c=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,p=i.padInfo.front,g=i.padInfo.left,v=i.padInfo.top,b=it(i.outShape,t.dtype),E=this.readSync(t.dataId),w=this.readSync(r.dataId),C=b.values,S=0;S<i.batchSize;++S)for(var I=S*t.strides[0],D=S*b.strides[0],O=0;O<i.outDepth;++O)for(var B=D+O*b.strides[1],N=O*i.strideDepth-p,R=0;R<a;R++){var k=N+R*c;if(!(k<0||k>=i.inDepth))for(var P=R*r.strides[0],V=I+k*t.strides[1],j=0;j<i.outHeight;++j)for(var L=B+j*b.strides[2],Z=j*i.strideHeight-v,ne=0;ne<s;ne++){var q=Z+ne*h;if(!(q<0||q>=i.inHeight))for(var X=P+ne*r.strides[1],ee=V+q*t.strides[2],ue=0;ue<i.outWidth;++ue)for(var fe=L+ue*i.outChannels,W=ue*i.strideWidth-g,$=0;$<u;$++){var ce=W+$*d;if(!(ce<0||ce>=i.inWidth))for(var ve=X+$*r.strides[2],Te=ee+ce*i.inChannels,Se=ve,_e=0;_e<i.inChannels;++_e){for(var De=E[Te+_e],Re=0;Re<i.outChannels;++Re)C[fe+Re]+=De*w[Se+Re];Se+=i.outChannels}}}}return b.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Ee([t,r],"conv2dDerInput");for(var a=it(i.inShape,"float32"),s=a.values,u=this.readSync(t.dataId),c=this.readSync(r.dataId),h=r.strides,d=h[0],p=h[1],g=h[2],v=i.batchSize,b=i.filterHeight,E=i.filterWidth,w=i.inChannels,C=i.inHeight,S=i.inWidth,I=i.outChannels,D=i.outHeight,O=i.outWidth,B=i.strideHeight,N=i.strideWidth,R=i.dataFormat,k=b-1-i.padInfo.top,P=E-1-i.padInfo.left,V=R==="channelsLast",j=a.strides[0],L=V?a.strides[1]:a.strides[2],Z=V?a.strides[2]:1,ne=V?1:a.strides[1],q=t.strides[0],X=V?t.strides[1]:t.strides[2],ee=V?t.strides[2]:1,ue=V?1:t.strides[1],fe=0;fe<v;++fe)for(var W=0;W<w;++W)for(var $=0;$<C;++$)for(var ce=$-k,ve=Math.max(0,Math.ceil(ce/B)),Te=Math.min(D,(b+ce)/B),Se=0;Se<S;++Se){for(var _e=Se-P,De=Math.max(0,Math.ceil(_e/N)),Re=Math.min(O,(E+_e)/N),qe=0,et=ve;et<Te;++et)for(var Ze=et*B-ce,Xe=De;Xe<Re;++Xe)for(var st=q*fe+X*et+ee*Xe,Qe=d*(b-1-Ze)+p*(E-1-(Xe*N-_e))+g*W,ot=0;ot<I;++ot)qe+=u[st+ue*ot]*c[Qe+ot];s[j*fe+L*$+Z*Se+ne*W]=qe}return a.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var a=it(i.inShape,"float32"),s=a.values,u=a.strides,c=u[0],h=u[1],d=u[2],p=u[3],g=this.readSync(t.dataId),v=t.strides,b=v[0],E=v[1],w=v[2],C=v[3],S=this.readSync(r.dataId),I=r.strides,D=I[0],O=I[1],B=I[2],N=I[3],R=i.batchSize,k=i.filterDepth,P=i.filterHeight,V=i.filterWidth,j=i.inChannels,L=i.inDepth,Z=i.inHeight,ne=i.inWidth,q=i.outChannels,X=i.outDepth,ee=i.outHeight,ue=i.outWidth,fe=i.strideDepth,W=i.strideHeight,$=i.strideWidth,ce=k-1-i.padInfo.front,ve=P-1-i.padInfo.top,Te=V-1-i.padInfo.left,Se=0;Se<R;++Se)for(var _e=0;_e<j;++_e)for(var De=0;De<L;++De)for(var Re=De-ce,qe=Math.max(0,Math.ceil(Re/fe)),et=Math.min(X,(k+Re)/fe),Ze=0;Ze<Z;++Ze)for(var Xe=Ze-ve,st=Math.max(0,Math.ceil(Xe/W)),Qe=Math.min(ee,(P+Xe)/W),ot=0;ot<ne;++ot){for(var Xn=ot-Te,xn=Math.max(0,Math.ceil(Xn/$)),Ye=Math.min(ue,(V+Xn)/$),Rt=0,wn=qe;wn<et;++wn)for(var jr=wn*fe-Re,yr=st;yr<Qe;++yr)for(var tn=yr*W-Xe,ar=xn;ar<Ye;++ar)for(var is=b*Se+E*wn+w*yr+C*ar,bi=D*(k-1-jr)+O*(P-1-tn)+B*(V-1-(ar*$-Xn))+N*_e,Ln=0;Ln<q;++Ln)Rt+=g[is+Ln]*S[bi+Ln];s[c*Se+h*De+d*Ze+p*ot+_e]=Rt}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Ee([t,r],"conv2dDerFilter");for(var a=i.strideHeight,s=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=i.dataFormat==="channelsLast",d=it(i.filterShape,"float32"),p=i.padInfo.left,g=i.padInfo.top,v=this.bufferSync(t),b=this.bufferSync(r),E=0;E<u;++E)for(var w=Math.max(0,Math.ceil((g-E)/a)),C=Math.min(i.outHeight,(i.inHeight+g-E)/a),S=0;S<c;++S)for(var I=Math.max(0,Math.ceil((p-S)/s)),D=Math.min(i.outWidth,(i.inWidth+p-S)/s),O=0;O<i.inChannels;++O)for(var B=0;B<i.outChannels;++B){for(var N=0,R=0;R<i.batchSize;++R)for(var k=w;k<C;++k)for(var P=E+k*a-g,V=I;V<D;++V){var j=S+V*s-p;N+=h?v.get(R,P,j,O)*b.get(R,k,V,B):v.get(R,O,P,j)*b.get(R,B,k,V)}d.set(N,E,S,O,B)}return d.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var a=i.strideDepth,s=i.strideHeight,u=i.strideWidth,c=i.filterDepth,h=i.filterHeight,d=i.filterWidth,p=it(i.filterShape,"float32"),g=p.values,v=p.strides,b=v[0],E=v[1],w=v[2],C=v[3],S=this.readSync(r.dataId),I=r.strides,D=I[0],O=I[1],B=I[2],N=I[3],R=this.readSync(t.dataId),k=t.strides,P=k[0],V=k[1],j=k[2],L=k[3],Z=i.padInfo.front,ne=i.padInfo.left,q=i.padInfo.top,X=0;X<c;++X)for(var ee=Math.max(0,Math.ceil((Z-X)/a)),ue=Math.min(i.outDepth,(i.inDepth+Z-X)/a),fe=X*b,W=0;W<h;++W)for(var $=Math.max(0,Math.ceil((q-W)/s)),ce=Math.min(i.outHeight,(i.inHeight+q-W)/s),ve=W*E+fe,Te=0;Te<d;++Te)for(var Se=Math.max(0,Math.ceil((ne-Te)/u)),_e=Math.min(i.outWidth,(i.inWidth+ne-Te)/u),De=Te*w+ve,Re=0;Re<i.inChannels;++Re)for(var qe=Re*C+De,et=0;et<i.outChannels;++et){for(var Ze=0,Xe=0;Xe<i.batchSize;++Xe)for(var st=Xe*P,Qe=Xe*D,ot=ee;ot<ue;++ot)for(var Xn=(X+ot*a-Z)*V+st,xn=ot*O+Qe,Ye=$;Ye<ce;++Ye)for(var Rt=(W+Ye*s-q)*j+Xn,wn=Ye*B+xn,jr=Se;jr<_e;++jr){var yr=jr*N+wn;Ze+=R[(Te+jr*u-ne)*L+Rt+Re]*S[yr+et]}g[qe+et]=Ze}return p.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,h=this.depthwiseConv2D(r,i,a);return s&&(h=this.add(h,s)),u&&(h=O_(this,h,u,c)),h},e.prototype.depthwiseConv2D=function(t,r,i){Ee([t,r],"depthwiseConv2D");for(var a=i.filterHeight,s=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.left,d=i.padInfo.top,p=i.outChannels/i.inChannels,g=it(i.outShape,t.dtype),v=this.readSync(t.dataId),b=this.readSync(r.dataId),E=g.values,w=0;w<i.batchSize;++w)for(var C=w*t.strides[0],S=w*g.strides[0],I=0;I<i.outHeight;++I)for(var D=S+I*g.strides[1],O=I*i.strideHeight-h,B=0;B<a;++B){var N=O+B*u;if(!(N<0||N>=i.inHeight))for(var R=B*r.strides[0],k=C+N*t.strides[1],P=0;P<i.outWidth;++P)for(var V=D+P*g.strides[2],j=P*i.strideWidth-d,L=0;L<s;++L){var Z=j+L*c;if(!(Z<0||Z>=i.inWidth))for(var ne=R+L*r.strides[1],q=k+Z*i.inChannels,X=V,ee=ne,ue=0;ue<i.inChannels;++ue){for(var fe=v[q+ue],W=0;W<p;++W)E[X+W]+=fe*b[ee+W];X+=p,ee+=p}}}return g.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Ee([t,r],"depthwiseConv2DDerInput");for(var a=it(i.inShape,"float32"),s=a.values,u=a.strides,c=u[0],h=u[1],d=u[2],p=this.readSync(t.dataId),g=t.strides,v=g[0],b=g[1],E=g[2],w=this.readSync(r.dataId),C=r.strides,S=C[0],I=C[1],D=C[2],O=i.batchSize,B=i.filterHeight,N=i.filterWidth,R=i.inChannels,k=i.inHeight,P=i.inWidth,V=i.outChannels,j=i.outHeight,L=i.outWidth,Z=i.strideHeight,ne=i.strideWidth,q=B-1-i.padInfo.top,X=N-1-i.padInfo.left,ee=V/R,ue=0;ue<O;++ue)for(var fe=0;fe<R;++fe)for(var W=0;W<k;++W)for(var $=W-q,ce=Math.max(0,Math.ceil($/Z)),ve=Math.min(j,(B+$)/Z),Te=0;Te<P;++Te){for(var Se=Te-X,_e=Math.max(0,Math.ceil(Se/ne)),De=Math.min(L,(N+Se)/ne),Re=0,qe=ce;qe<ve;++qe)for(var et=qe*Z-$,Ze=_e;Ze<De;++Ze)for(var Xe=v*ue+b*qe+E*Ze,st=S*(B-1-et)+I*(N-1-(Ze*ne-Se))+D*fe,Qe=0;Qe<ee;++Qe)Re+=p[Xe+(fe*ee+Qe)]*w[st+Qe];s[c*ue+h*W+d*Te+fe]=Re}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Ee([t,r],"depthwiseConv2DDerFilter");for(var a=i.strideHeight,s=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=it(i.filterShape,"float32"),d=i.padInfo.left,p=i.padInfo.top,g=i.outChannels/i.inChannels,v=this.bufferSync(t),b=this.bufferSync(r),E=0;E<u;++E)for(var w=Math.max(0,Math.ceil((p-E)/a)),C=Math.min(i.outHeight,(i.inHeight+p-E)/a),S=0;S<c;++S)for(var I=Math.max(0,Math.ceil((d-S)/s)),D=Math.min(i.outWidth,(i.inWidth+d-S)/s),O=0;O<i.outChannels;++O){for(var B=Math.trunc(O/g),N=O%g,R=0,k=0;k<i.batchSize;++k)for(var P=w;P<C;++P)for(var V=E+P*a-p,j=I;j<D;++j){var L=S+j*s-d;R+=v.get(k,V,L,B)*b.get(k,P,j,O)}h.set(R,E,S,B,N)}return h.toTensor()},e.prototype.tile=function(t,r){return Ee(t,"tile"),Nk(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Ee(t,"pad");var a=r.map((function(g,v){return g[0]+t.shape[v]+g[1]})),s=r.map((function(g){return g[0]})),u=this.bufferSync(t),c=it(a,t.dtype);i!==0&&c.values.fill(i);for(var h=0;h<t.size;h++){var d=u.indexToLoc(h),p=d.map((function(g,v){return g+s[v]}));c.set.apply(c,[u.get.apply(u,d)].concat(p))}return c.toTensor()},e.prototype.transpose=function(t,r){Ee(t,"transpose");for(var i=new Array(t.rank),a=0;a<i.length;a++)i[a]=t.shape[r[a]];var s=this.readSync(t.dataId),u=it(i,t.dtype),c=this.bufferSync(t);for(a=0;a<t.size;++a){for(var h=c.indexToLoc(a),d=new Array(h.length),p=0;p<d.length;p++)d[p]=h[r[p]];var g=u.locToIndex(d);u.values[g]=s[a]}return u.toTensor()},e.prototype.gather=function(t,r,i){Ee([t,r],"gather");var a=t.shape.slice(),s=this.readSync(r.dataId);a[i]=s.length;for(var u=it(a,t.dtype),c=this.bufferSync(t),h=0;h<u.size;++h){var d=u.indexToLoc(h),p=d.slice();p[i]=s[d[i]];var g=c.locToIndex(p);u.values[h]=c.values[g]}return u.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Ee([t],"batchToSpaceND");var a=r.reduce((function(p,g){return p*g})),s=Eg(t.shape,r,a),u=Tg(s.length,r.length),c=Cg(t.shape,r,a),h=vk(i,r.length),d=yk(c,i,r.length);return t.reshape(s).transpose(u).reshape(c).slice(h,d)},e.prototype.spaceToBatchND=function(t,r,i){Ee([t],"spaceToBatchND");var a=r.reduce((function(g,v){return g*v})),s=[[0,0]];s.push.apply(s,i);for(var u=1+r.length;u<t.shape.length;++u)s.push([0,0]);var c=t.pad(s),h=Eg(c.shape,r,a,!1),d=Tg(h.length,r.length,!1),p=Cg(c.shape,r,a,!1);return c.reshape(h).transpose(d).reshape(p)},e.prototype.pool=function(t,r,i){Ee(t,"pool");for(var a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(t.dataId),E=it(r.outShape,t.dtype),w=E.values,C=r.outShape[1]*r.outShape[2]*r.outShape[3],S=r.outShape[2]*r.outShape[3],I=r.outShape[3],D=0;D<r.batchSize;++D)for(var O=D*C,B=D*t.strides[0],N=0;N<r.inChannels;++N)for(var R=0;R<r.outHeight;++R)for(var k=R*a-p,P=Math.max(0,k),V=Math.min(r.inHeight,h+k),j=O+R*S,L=0;L<r.outWidth;++L){for(var Z=L*s-g,ne=Math.max(0,Z),q=Math.min(r.inWidth,d+Z),X=v,ee=0,ue=0,fe=P;fe<V;fe+=u){for(var W=B+fe*t.strides[1],$=ne;$<q;$+=c){var ce=b[W+$*t.strides[2]+N];i==="max"&&ce>X?X=ce:i==="avg"&&(ee+=ce,ue++)}if(isNaN(X))break}w[j+L*I+N]=i==="avg"?ee/ue:X}return E.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=it(r.outShape,"int32"),a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,v=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var E=0;E<r.inChannels;++E)for(var w=0;w<r.outHeight;++w){for(var C=w*a-p,S=C;S<0;)S+=u;for(var I=Math.min(r.inHeight,h+C),D=0;D<r.outWidth;++D){for(var O=D*s-g,B=O;B<0;)B+=c;for(var N=Math.min(r.inWidth,d+O),R=Number.NEGATIVE_INFINITY,k=-1,P=S;P<I;P+=u)for(var V=P-C,j=B;j<N;j+=c){var L=j-O,Z=v.get(b,P,j,E);Z>R&&(R=Z,k=V*d+L)}i.set(k,b,w,D,E)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,a){Ee([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,a),u=a.strideHeight,c=a.strideWidth,h=a.dilationHeight,d=a.dilationWidth,p=a.effectiveFilterHeight,g=a.effectiveFilterWidth,v=g-1-a.padInfo.left,b=p-1-a.padInfo.top,E=it(r.shape,"float32"),w=this.bufferSync(s),C=this.bufferSync(t),S=0;S<a.batchSize;++S)for(var I=0;I<a.inChannels;++I)for(var D=0;D<a.inHeight;++D)for(var O=0;O<a.inWidth;++O){for(var B=D-b,N=O-v,R=0,k=0;k<p;k+=h){var P=(B+k)/u;if(!(P<0||P>=a.outHeight||Math.floor(P)!==P))for(var V=0;V<g;V+=d){var j=(N+V)/c;if(!(j<0||j>=a.outWidth||Math.floor(j)!==j)){var L=p*g-1-w.get(S,P,j,I)===k*g+V?1:0;L!==0&&(R+=C.get(S,P,j,I)*L)}}}E.set(R,S,D,O,I)}return E.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Ee([t,r],"avgPoolBackprop");for(var a=i.strideHeight,s=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=i.dilationHeight,d=i.dilationWidth,p=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=g-1-i.padInfo.left,b=p-1-i.padInfo.top,E=it(r.shape,"float32"),w=1/(u*c),C=this.bufferSync(t),S=0;S<i.batchSize;++S)for(var I=0;I<i.inChannels;++I)for(var D=0;D<i.inHeight;++D)for(var O=0;O<i.inWidth;++O){for(var B=D-b,N=O-v,R=0,k=0;k<p;k+=h){var P=(B+k)/a;if(!(P<0||P>=i.outHeight||Math.floor(P)!==P))for(var V=0;V<g;V+=d){var j=(N+V)/s;j<0||j>=i.outWidth||Math.floor(j)!==j||(R+=C.get(S,P,j,I))}}E.set(R*w,S,D,O,I)}return E.toTensor()},e.prototype.pool3d=function(t,r,i){Ee(t,"pool3d");for(var a=r.strideDepth,s=r.strideHeight,u=r.strideWidth,c=r.dilationDepth,h=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,v=r.effectiveFilterWidth,b=r.padInfo.front,E=r.padInfo.top,w=r.padInfo.left,C=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=this.readSync(t.dataId),I=it(r.outShape,t.dtype),D=I.values,O=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],B=r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[3]*r.outShape[4],R=r.outShape[4],k=0;k<r.batchSize;++k)for(var P=k*O,V=k*t.strides[0],j=0;j<r.inChannels;++j)for(var L=0;L<r.outDepth;++L){for(var Z=L*a-b,ne=Z;ne<0;)ne+=c;for(var q=Math.min(r.inDepth,p+Z),X=P+L*B,ee=0;ee<r.outHeight;++ee){for(var ue=ee*s-E,fe=ue;fe<0;)fe+=h;for(var W=Math.min(r.inHeight,g+ue),$=X+ee*N,ce=0;ce<r.outWidth;++ce){for(var ve=ce*u-w,Te=ve;Te<0;)Te+=d;for(var Se=Math.min(r.inWidth,v+ve),_e=$+ce*R,De=C,Re=0,qe=0,et=ne;et<q;et+=c){for(var Ze=V+et*t.strides[1],Xe=fe;Xe<W;Xe+=h){for(var st=Ze+Xe*t.strides[2],Qe=Te;Qe<Se;Qe+=d){var ot=S[st+Qe*t.strides[3]+j];if(i==="max"&&ot>De?De=ot:i==="avg"&&(Re+=ot,qe++),isNaN(De))break}if(isNaN(De))break}if(isNaN(De))break}D[_e+j]=i==="avg"?Re/qe:De}}}return I.toTensor()},e.prototype.avgPool3d=function(t,r){return Ee(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Ee([t,r],"avgPool3dBackprop");for(var a=i.strideDepth,s=i.strideHeight,u=i.strideWidth,c=i.filterDepth,h=i.filterHeight,d=i.filterWidth,p=i.dilationDepth,g=i.dilationHeight,v=i.dilationWidth,b=i.effectiveFilterDepth,E=i.effectiveFilterHeight,w=i.effectiveFilterWidth,C=b-1-i.padInfo.front,S=w-1-i.padInfo.left,I=E-1-i.padInfo.top,D=it(r.shape,"float32"),O=1/(c*h*d),B=this.bufferSync(t),N=0;N<i.batchSize;++N)for(var R=0;R<i.inChannels;++R)for(var k=0;k<i.inDepth;++k)for(var P=0;P<i.inHeight;++P)for(var V=0;V<i.inWidth;++V){for(var j=k-C,L=P-I,Z=V-S,ne=0,q=0;q<b;q+=p){var X=(j+q)/a;if(!(X<0||X>=i.outDepth||Math.floor(X)!==X))for(var ee=0;ee<E;ee+=g){var ue=(L+ee)/s;if(!(ue<0||ue>=i.outHeight||Math.floor(ue)!==ue))for(var fe=0;fe<w;fe+=v){var W=(Z+fe)/u;W<0||W>=i.outWidth||Math.floor(W)!==W||(ne+=B.get(N,X,ue,W,R))}}}D.set(ne*O,N,k,P,V,R)}return D.toTensor()},e.prototype.maxPool3d=function(t,r){return Ee(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=it(r.outShape,"int32"),a=r.strideDepth,s=r.strideHeight,u=r.strideWidth,c=r.dilationDepth,h=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,v=r.effectiveFilterWidth,b=r.padInfo.front,E=r.padInfo.top,w=r.padInfo.left,C=this.bufferSync(t),S=0;S<r.batchSize;++S)for(var I=0;I<r.inChannels;++I)for(var D=0;D<r.outDepth;++D){for(var O=D*a-b,B=O;B<0;)B+=c;for(var N=Math.min(r.inDepth,p+O),R=0;R<r.outHeight;++R){for(var k=R*s-E,P=k;P<0;)P+=h;for(var V=Math.min(r.inHeight,g+k),j=0;j<r.outWidth;++j){for(var L=j*u-w,Z=L;Z<0;)Z+=d;for(var ne=Math.min(r.inWidth,v+L),q=Number.NEGATIVE_INFINITY,X=-1,ee=B;ee<N;ee+=c)for(var ue=ee-O,fe=P;fe<V;fe+=h)for(var W=fe-k,$=Z;$<ne;$+=d){var ce=$-L,ve=C.get(S,ee,fe,$,I);ve>=q&&(q=ve,X=ue*g*v+W*g+ce)}i.set(X,S,D,R,j,I)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,a){Ee([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,a),u=a.strideDepth,c=a.strideHeight,h=a.strideWidth,d=a.dilationDepth,p=a.dilationHeight,g=a.dilationWidth,v=a.effectiveFilterDepth,b=a.effectiveFilterHeight,E=a.effectiveFilterWidth,w=v-1-a.padInfo.front,C=E-1-a.padInfo.left,S=b-1-a.padInfo.top,I=it(r.shape,"float32"),D=this.bufferSync(s),O=this.bufferSync(t),B=0;B<a.batchSize;++B)for(var N=0;N<a.inChannels;++N)for(var R=0;R<a.inDepth;++R)for(var k=0;k<a.inHeight;++k)for(var P=0;P<a.inWidth;++P){for(var V=R-w,j=k-S,L=P-C,Z=0,ne=0;ne<v;ne+=d){var q=(V+ne)/u;if(!(q<0||q>=a.outDepth||Math.floor(q)!==q))for(var X=0;X<b;X+=p){var ee=(j+X)/c;if(!(ee<0||ee>=a.outHeight||Math.floor(ee)!==ee))for(var ue=0;ue<E;ue+=g){var fe=(L+ue)/h;if(!(fe<0||fe>=a.outWidth||Math.floor(fe)!==fe)){var W=v*b*E-1-D.get(B,q,ee,fe,N)===ne*b*E+X*E+ue?1:0;W!==0&&(Z+=O.get(B,q,ee,fe,N)*W)}}}}I.set(Z,B,R,k,P,N)}return I.toTensor()},e.prototype.cast=function(t,r){return Sk(t,r,this)},e.prototype.reshape=function(t,r){return zb(t,r)},e.prototype.avgPool=function(t,r){return Ee(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,a){Ee(t,"resizeBilinear");for(var s=t.shape,u=s[0],c=s[1],h=s[2],d=s[3],p=this.readSync(t.dataId),g=new Float32Array(je([u,r,i,d])),v=[a&&r>1?c-1:c,a&&i>1?h-1:h],b=[a&&r>1?r-1:r,a&&i>1?i-1:i],E=0,w=v[0]/b[0],C=v[1]/b[1],S=0;S<u;S++)for(var I=0;I<r;I++)for(var D=w*I,O=Math.floor(D),B=D-O,N=Math.min(c-1,Math.ceil(D)),R=S*t.strides[0]+O*t.strides[1],k=S*t.strides[0]+N*t.strides[1],P=0;P<i;P++)for(var V=C*P,j=Math.floor(V),L=V-j,Z=Math.min(h-1,Math.ceil(V)),ne=R+j*t.strides[2],q=k+j*t.strides[2],X=R+Z*t.strides[2],ee=k+Z*t.strides[2],ue=0;ue<d;ue++){var fe=p[ne+ue],W=p[q+ue],$=fe+(p[X+ue]-fe)*L,ce=$+(W+(p[ee+ue]-W)*L-$)*B;g[E++]=ce}return pr(g,[u,r,i,d])},e.prototype.resizeBilinearBackprop=function(t,r,i){Ee([t,r],"resizeBilinearBackprop");for(var a=r.shape,s=a[0],u=a[1],c=a[2],h=a[3],d=t.shape,p=d[1],g=d[2],v=new Float32Array(s*u*c*h),b=[i&&p>1?u-1:u,i&&g>1?c-1:c],E=[i&&p>1?p-1:p,i&&g>1?g-1:g],w=b[0]/E[0],C=b[1]/E[1],S=this.readSync(t.dataId),I=0,D=0;D<s;D++)for(var O=D*r.strides[0],B=0;B<p;B++)for(var N=B*w,R=Math.floor(N),k=Math.min(Math.ceil(N),u-1),P=O+R*r.strides[1],V=O+k*r.strides[1],j=N-R,L=1-j,Z=0;Z<g;Z++)for(var ne=Z*C,q=Math.floor(ne),X=Math.min(Math.ceil(ne),c-1),ee=ne-q,ue=1-ee,fe=P+q*r.strides[2],W=P+X*r.strides[2],$=V+q*r.strides[2],ce=V+X*r.strides[2],ve=L*ue,Te=L*ee,Se=j*ue,_e=j*ee,De=0;De<h;De++){var Re=S[I++];v[fe+De]+=Re*ve,v[W+De]+=Re*Te,v[$+De]+=Re*Se,v[ce+De]+=Re*_e}return Yr(v,[s,c,u,h],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,a){Ee(t,"resizeNearestNeighbor");for(var s=t.shape,u=s[0],c=s[1],h=s[2],d=s[3],p=this.readSync(t.dataId),g=new Float32Array(u*r*i*d),v=[a&&r>1?c-1:c,a&&i>1?h-1:h],b=[a&&r>1?r-1:r,a&&i>1?i-1:i],E=v[0]/b[0],w=v[1]/b[1],C=0,S=0;S<u;S++)for(var I=S*t.strides[0],D=0;D<r;D++)for(var O=E*D,B=I+Math.min(c-1,a?Math.round(O):Math.floor(O))*t.strides[1],N=0;N<i;N++)for(var R=w*N,k=B+Math.min(h-1,a?Math.round(R):Math.floor(R))*t.strides[2],P=0;P<d;P++){var V=p[k+P];g[C++]=V}return pr(g,[u,r,i,d],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Ee([t,r],"resizeNearestNeighborBackprop");for(var a=r.shape,s=a[0],u=a[1],c=a[2],h=a[3],d=t.shape,p=d[1],g=d[2],v=new Float32Array(s*u*c*h),b=this.readSync(t.dataId),E=[i&&p>1?u-1:u,i&&g>1?c-1:c],w=[i&&p>1?p-1:p,i&&g>1?g-1:g],C=E[0]/w[0],S=E[1]/w[1],I=1/C,D=1/S,O=2*Math.ceil(I)+2,B=2*Math.ceil(D)+2,N=0;N<s;N++)for(var R=N*r.strides[0],k=0;k<u;k++)for(var P=R+k*r.strides[1],V=Math.floor(k*I),j=Math.floor(V-O/2),L=0;L<c;L++)for(var Z=P+L*r.strides[2],ne=Math.floor(L*D),q=Math.floor(ne-B/2),X=0;X<h;X++){for(var ee=0,ue=0;ue<O;ue++){var fe=ue+j;if(!(fe<0||fe>=p)){var W=R+fe*t.strides[1],$=fe*C;if(k===Math.min(u-1,i?Math.round($):Math.floor($)))for(var ce=0;ce<B;ce++){var ve=ce+q;if(!(ve<0||ve>=g)){var Te=W+ve*t.strides[2],Se=ve*S;L===Math.min(c-1,i?Math.round(Se):Math.floor(Se))&&(ee+=b[Te+X])}}}}v[Z+X]=ee}return Yr(v,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,a,s,u){Ee([t,r,i,s,u],"batchNorm");for(var c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=this.readSync(i.dataId),p=s?this.readSync(s.dataId):new Float32Array([1]),g=u?this.readSync(u.dataId):new Float32Array([0]),v=new Float32Array(c.length),b=g.length,E=p.length,w=d.length,C=h.length,S=0,I=0,D=0,O=0,B=0;B<c.length;++B)v[B]=g[S++]+(c[B]-h[I++])*p[D++]/Math.sqrt(d[O++]+a),S>=b&&(S=0),I>=C&&(I=0),D>=E&&(D=0),O>=w&&(O=0);return Yr(v,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,a,s){Ee(t,"localResponseNormalization4D");var u=t.shape[3],c=u-1,h=this.readSync(t.dataId),d=t.size,p=new Float32Array(d);function g(w){for(var C=w%u,S=w-C+Math.max(0,C-r),I=w-C+Math.min(C+r,c),D=0;S<=I;S++){var O=h[S];D+=O*O}return D}for(var v=0;v<d;v++){var b=g(v),E=h[v]*Math.pow(i+a*b,-s);p[v]=E}return Yr(p,t.shape)},e.prototype.LRNGrad=function(t,r,i,a,s,u,c){Ee(t,"LRNGrad");for(var h=t.shape[3],d=this.readSync(t.dataId),p=this.readSync(r.dataId),g=this.readSync(i.dataId),v=new Float32Array(t.size),b=t.size,E=0;E<b;E++){for(var w=E%h,C=E-w+Math.max(0,w-a),S=E-w+Math.min(h,w+a+1),I=0,D=C;D<S;D++)I+=Math.pow(p[D],2);for(I=u*I+s,D=C;D<S;D++){var O=-2*u*c*p[D]*g[E]/I;E===D&&(O+=Math.pow(I,-c)),O*=d[E],v[D]+=O}}return Yr(v,t.shape)},e.prototype.multinomial=function(t,r,i,a){Ee(t,"multinomial");for(var s=r?t:js(t),u=s.shape[0],c=s.shape[1],h=$t([u,i],"int32"),d=this.readSync(h.dataId),p=this.readSync(s.dataId),g=0;g<u;++g){var v=g*c,b=new Float32Array(c-1);b[0]=p[v];for(var E=1;E<b.length;++E)b[E]=b[E-1]+p[v+E];for(var w=dv(a.toString()),C=g*i,S=0;S<i;++S){var I=w();d[C+S]=b.length;for(var D=0;D<b.length;D++)if(I<b[D]){d[C+S]=D;break}}}return h},e.prototype.oneHot=function(t,r,i,a){Ee(t,"oneHot");var s=new Float32Array(t.size*r);s.fill(a);for(var u=this.readSync(t.dataId),c=0;c<t.size;++c)u[c]>=0&&u[c]<r&&(s[c*r+u[c]]=i);return No(s,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,a,s){return Ee(t,"nonMaxSuppression"),Sx(this.readSync(t.dataId),this.readSync(r.dataId),i,a,s)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],a=t.shape[1],s=it(t.shape,"float32"),u=it(t.shape,"float32"),c=Pi(t).as2D(i,a),h=ja(t).as2D(i,a),d=0;d<i;d++)for(var p=c.slice([d,0],[1,a]),g=h.slice([d,0],[1,a]),v=fr(p,g),b=this.readSync(this.fftImpl(v,r).dataId),E=0;E<a;E++){var w=DA(b,E);s.values[d*a+E]=w.real,u.values[d*a+E]=w.imag}return fr(s.toTensor(),u.toTensor()).as2D(i,a)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),a=i.size;if(this.isExponentOf2(a)){var s=this.fftRadix2(i,a,r).as2D(t.shape[0],t.shape[1]);return r&&(s=fr(Pi(s).div(Ae(a)),ja(s).div(Ae(a)))),s}var u=this.readSync(t.dataId),c=(function(h){for(var d=new Float32Array(h.length/2),p=new Float32Array(h.length/2),g=0;g<h.length;g+=2)d[g/2]=h[g],p[g/2]=h[g+1];return{real:d,imag:p}})(this.fourierTransformByMatmul(u,a,r));return fr(c.real,c.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var a=this.readSync(t.dataId),s=r/2,u=(function(C){for(var S=Math.ceil(C.length/4),I=new Float32Array(S),D=new Float32Array(S),O=0;O<C.length;O+=4)I[Math.floor(O/4)]=C[O],D[Math.floor(O/4)]=C[O+1];return{real:I,imag:D}})(a),c=fr(u.real,u.imag).as1D(),h=(function(C){for(var S=Math.floor(C.length/4),I=new Float32Array(S),D=new Float32Array(S),O=2;O<C.length;O+=4)I[Math.floor(O/4)]=C[O],D[Math.floor(O/4)]=C[O+1];return{real:I,imag:D}})(a),d=fr(h.real,h.imag).as1D();c=this.fftRadix2(c,s,i),d=this.fftRadix2(d,s,i);var p=(function(C,S){for(var I=new Float32Array(C/2),D=new Float32Array(C/2),O=0;O<Math.ceil(C/2);O++){var B=(S?2:-2)*Math.PI*(O/C);I[O]=Math.cos(B),D[O]=Math.sin(B)}return{real:I,imag:D}})(r,i),g=fr(p.real,p.imag).mul(d),v=c.add(g),b=c.sub(g),E=Pi(v).concat(Pi(b)),w=ja(v).concat(ja(b));return fr(E,w).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var a=new Float32Array(2*r),s=0;s<r;s++){for(var u=0,c=0,h=0;h<r;h++){var d=kU(s*h,r,i),p=DA(t,h);u+=p.real*d.real-p.imag*d.imag,c+=p.real*d.imag+p.imag*d.real}i&&(u/=r,c/=r),DU(a,u,c,s)}return a},e.prototype.depthToSpace=function(t,r,i){G(i==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i})),G(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var a=t.shape[0],s=t.shape[1],u=t.shape[2],c=t.shape[3],h=s*r,d=u*r,p=c/(r*r),g=this.readSync(t.dataId),v=new Float32Array(a*h*d*p),b=0,E=0;E<a;++E)for(var w=0;w<h;++w)for(var C=Math.floor(w/r),S=w%r,I=0;I<d;++I)for(var D=Math.floor(I/r),O=(S*r+I%r)*p,B=0;B<p;++B){var N=B+O+c*(D+u*(C+s*E));v[b++]=g[N]}return Yr(v,[a,h,d,p])},e.prototype.broadcastedBinaryOp=function(t,r,i,a){var s=mt(t.shape,r.shape),u=it(s,i),c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=Ao(t.shape,s),p=Ao(r.shape,s),g=u.values;if(d.length+p.length===0)for(var v=0;v<g.length;++v)g[v]=a(c[v%c.length],h[v%h.length]);else{var b=this.bufferSync(t),E=this.bufferSync(r),w=function(C){var S=u.indexToLoc(C),I=S.slice(-t.rank);d.forEach((function(N){return I[N]=0}));var D=b.locToIndex(I),O=S.slice(-r.rank);p.forEach((function(N){return O[N]=0}));var B=E.locToIndex(O);g[C]=a(c[D],h[B])};for(v=0;v<g.length;++v)w(v)}return u.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var a=mt(t.shape,r.shape),s=it(a,"float32"),u=it(a,"float32"),c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=Ao(t.shape,a),p=Ao(r.shape,a),g=s.values,v=u.values;if(d.length+p.length===0)for(var b=0;b<g.length;b++){var E=b%c.length,w=b%h.length,C=i(c[2*E],c[2*E+1],h[2*w],h[2*w+1]);g[b]=C.real,v[b]=C.imag}else{var S=this.bufferSync(this.data.get(t.dataId).complexTensors.real),I=this.bufferSync(this.data.get(r.dataId).complexTensors.real),D=function(O){var B=s.indexToLoc(O),N=B.slice(-t.rank);d.forEach((function(j){return N[j]=0}));var R=S.locToIndex(N),k=B.slice(-r.rank);p.forEach((function(j){return k[j]=0}));var P=I.locToIndex(k),V=i(c[2*R],c[2*R+1],h[2*P],h[2*P+1]);g[O]=V.real,v[O]=V.imag};for(b=0;b<g.length;b++)D(b)}return this.complex(s.toTensor(),u.toTensor())},e.prototype.split=function(t,r,i){return Ik(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,a,s,u){for(var c=t.shape,h=c[0],d=c[1],p=c[2],g=c[3],v=r.shape[0],b=a[0],E=a[1],w=it([v,b,E,g],"float32"),C=this.readSync(r.dataId),S=this.readSync(i.dataId),I=this.readSync(t.dataId),D=t.strides,O=w.strides,B=0;B<v;B++){var N=4*B,R=C[N],k=C[N+1],P=C[N+2],V=C[N+3],j=S[B];if(!(j>=h))for(var L=b>1?(P-R)*(d-1)/(b-1):0,Z=E>1?(V-k)*(p-1)/(E-1):0,ne=0;ne<b;ne++){var q=b>1?R*(d-1)+ne*L:.5*(R+P)*(d-1);if(q<0||q>d-1)for(var X=0;X<E;X++)for(var ee=0;ee<g;ee++){var ue=ee+X*O[2]+ne*O[1]+B*O[0];w.values[ue]=u}else if(s==="bilinear"){var fe=Math.floor(q),W=Math.ceil(q),$=q-fe;for(X=0;X<E;X++)if((et=E>1?k*(p-1)+X*Z:.5*(k+V)*(p-1))<0||et>p-1)for(ee=0;ee<g;ee++)ue=ee+X*O[2]+ne*O[1]+B*O[0],w.values[ue]=u;else{var ce=Math.floor(et),ve=Math.ceil(et),Te=et-ce;for(ee=0;ee<g;ee++){var Se=I[ue=ee+ce*D[2]+fe*D[1]+j*D[0]],_e=I[ue=ee+ve*D[2]+fe*D[1]+j*D[0]],De=I[ue=ee+ce*D[2]+W*D[1]+j*D[0]],Re=Se+(_e-Se)*Te,qe=De+(I[ue=ee+ve*D[2]+W*D[1]+j*D[0]]-De)*Te;ue=ee+X*O[2]+ne*O[1]+B*O[0],w.values[ue]=Re+(qe-Re)*$}}}else for(X=0;X<E;++X){var et;if((et=E>1?k*(p-1)+X*Z:.5*(k+V)*(p-1))<0||et>p-1)for(ee=0;ee<g;ee++)ue=ee+X*O[2]+ne*O[1]+B*O[0],w.values[ue]=u;else{var Ze=Math.round(et),Xe=Math.round(q);for(ee=0;ee<g;ee++){var st=ee+Ze*D[2]+Xe*D[1]+j*D[0],Qe=ee+X*O[2]+ne*O[1]+B*O[0];w.values[Qe]=I[st]}}}}}return w.toTensor()},e.prototype.sparseToDense=function(t,r,i,a){var s=Sg(0,t,i),u=s.sliceRank,c=s.numUpdates,h=s.sliceSize,d=s.strides,p=s.outputSize;return this.scatter(t,r,i,p,h,c,u,d,a,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,a=i[i.length-1],s=_k(t,r),u=s[0],c=s[1],h=s[2],d=s[3];if(c===0)return pr([],u,t.dtype);for(var p=new od([c,h],t.dtype),g=this.readSync(r.dataId),v=this.readSync(t.dataId),b=0;b<c;b++){for(var E=[],w=0,C=0;C<a;C++){var S=g[b*a+C];w+=S*d[C],E.push(S)}if(w<0||w>=t.size/h)throw new Error("Invalid indices: "+E+" does not index into "+t.shape);for(var I=0;I<h;I++)p.values[b*h+I]=v[w*h+I]}return p.toTensor().reshape(u)},e.prototype.scatterND=function(t,r,i){var a=Sg(0,t,i),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,h=a.strides,d=a.outputSize,p=Ae(0);return this.scatter(t,r,i,d,c,u,s,h,p,!0)},e.prototype.fill=function(t,r,i){var a=gg(i=i||kd(r),je(t));return a.fill(r),J.makeTensor(a,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=gg(t.dtype,je(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return Ak(t,r,i)},e.prototype.scatter=function(t,r,i,a,s,u,c,h,d,p){var g=[a/s,s],v=this.readSync(t.dataId),b=this.readSync(r.dataId);if(a===0)return pr([],i,r.dtype);var E=new od(g,r.dtype);E.values.fill(this.readSync(d.dataId)[0]);for(var w=0;w<u;w++){for(var C=[],S=0,I=0;I<c;I++){var D=v[w*c+I];C.push(D),S+=D*h[I]}if(S<0||S>=a/s)throw new Error("Invalid indices: "+C+" does not index into "+i);for(var O=0;O<s;O++)p?E.values[S*s+O]+=b[w*s+O]:E.values[S*s+O]=r.rank===0?b[0]:b[w*s+O]}return E.toTensor().reshape(i)},e})(Tk);J.registerBackend("cpu",(function(){return new ZH}),1);for(var P_=0,JA=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,a=i.boxes,s=i.scores,u=r,c=u.maxOutputSize,h=u.iouThreshold,d=u.scoreThreshold,p=u.softNmsSigma,g=t;Ee(a,"NonMaxSuppressionWithScore");var v=Ax(g.data.get(a.dataId).values,g.data.get(s.dataId).values,c,h,d,p);return[v.selectedIndices,v.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;Ee(r,"square");for(var a=i.data.get(r.dataId).values,s=new Float32Array(a.length),u=0;u<a.length;++u){var c=a[u];s[u]=c*c}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:cd,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,a=r.b,s=t;Ee([i,a],cd);var u=s.data.get(i.dataId).values,c=s.data.get(a.dataId).values,h=(function(g,v,b,E,w,C){var S=mt(g,v),I=S.length,D=qa(S),O=sd(w,je(S)),B=g.length,N=v.length,R=qa(g),k=qa(v),P=Ao(g,S),V=Ao(v,S);if(P.length+V.length===0)for(var j=0;j<O.length;++j)O[j]=C(b[j%b.length],E[j%E.length]);else{var L=function(Z){var ne=u5(Z,I,D),q=ne.slice(-B);P.forEach((function(fe){return q[fe]=0}));var X=wA(q,B,R),ee=ne.slice(-N);V.forEach((function(fe){return ee[fe]=0}));var ue=wA(ee,N,k);O[Z]=C(b[X],E[ue])};for(j=0;j<O.length;++j)L(j)}return[O,S]})(i.shape,a.shape,u,c,i.dtype,(function(g,v){var b=g-v;return b*b})),d=h[0],p=h[1];return{dataId:s.write(d,p,i.dtype),shape:p,dtype:i.dtype}}}];P_<JA.length;P_++)ZD(JA[P_]);var oc,JH=function(n){this.variableNames=["A"];var e=Rr(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},eG=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Rr(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var F_=0,eR=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,a=r.numChannels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,c=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=c[0],d=c[1],p=[d,h],g=[d,h,a];(u||s)&&(oc==null&&(oc=document.createElement("canvas").getContext("2d")),oc.canvas.width=h,oc.canvas.height=d,oc.drawImage(i,0,0,h,d),i=oc.canvas);var v=t.makeTensorInfo(p,"int32");t.texData.get(v.dataId).usage=pi.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(v.dataId),i);var b=ge().getBool("WEBGL_PACK")?new eG(g):new JH(g),E=t.runWebGLProgram(b,[v],"int32");return t.disposeData(v.dataId),E}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;bg("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,a=i.boxes,s=i.scores,u=r,c=u.maxOutputSize,h=u.iouThreshold,d=u.scoreThreshold,p=u.softNmsSigma,g=t,v=Ax(g.readSync(a.dataId),g.readSync(s.dataId),c,h,d,p);return[v.selectedIndices,v.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,a=new ht(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:cd,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,a=r.b,s=t,u=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Cs("return (a - b) * (a - b);",i.shape,a.shape):new fn("return (a - b) * (a - b);",i.shape,a.shape);return s.compileAndRun(u,[i,a])}}];F_<eR.length;F_++)ZD(eR[F_]);for(var V_=0,tR=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:cd,gradFunc:function(n,e){var t=e[0],r=e[1],i=Ae(2);return{a:function(){return Dr(n,Dr(i,qn(t,r)))},b:function(){return Dr(n,Dr(i,qn(r,t)))}}}}];V_<tR.length;V_++)Q6(tR[V_]);var tG=(function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n})();ge().get("IS_BROWSER")&&ge().setPlatform("browser",new tG);var L_,nG=function(){return require("node-fetch")},rG=(function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return ge().global.fetch!=null?ge().global.fetch(e,t):(L_==null&&(L_=nG()),L_(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n})();ge().get("IS_NODE")&&ge().setPlatform("node",new rG);var Wb={float32:4,int32:4,uint16:2,uint8:1,bool:1},Mg=4;function xM(n,e){for(var t={},r=0,i=function(u){var c=u.name,h=u.dtype,d=u.shape,p=je(d),g=void 0;if("quantization"in u){var v=u.quantization;if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Weight "+u.name+" has unknown quantization dtype "+v.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var b=Wb[v.dtype],E=n.slice(r,r+p*b),w=v.dtype==="uint8"?new Uint8Array(E):new Uint16Array(E);if(h==="float32")g=Float32Array.from(w,(function(B){return B*v.scale+v.min}));else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+h);g=Int32Array.from(w,(function(B){return Math.round(B*v.scale+v.min)}))}r+=p*b}else if(h==="string"){var C=je(u.shape);g=[];for(var S=0;S<C;S++){var I=new Uint32Array(n.slice(r,r+Mg))[0];r+=Mg;var D=new Uint8Array(n.slice(r,r+I));g.push(D),r+=I}}else{var O=Wb[h];if(E=n.slice(r,r+p*O),h==="float32")g=new Float32Array(E);else if(h==="int32")g=new Int32Array(E);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+h);g=new Uint8Array(E)}r+=p*O}t[c]=pr(g,d,h)},a=0,s=e;a<s.length;a++)i(s[a]);return t}function iG(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach((function(a){if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)}));var r=new Uint8Array(e),i=0;return t.forEach((function(a){r.set(new Uint8Array(a.buffer),i),i+=a.byteLength})),r.buffer}var qb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function nR(n){return qb?Buffer.byteLength(n):new Blob([n]).size}function qx(n){var e=0;n.forEach((function(i){e+=i.byteLength}));var t=new Uint8Array(e),r=0;return n.forEach((function(i){t.set(new Uint8Array(i),r),r+=i.byteLength})),t.buffer}function rR(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Bd(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:nR(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:nR(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var mi=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(a){var s=a(e,r);s!==null&&i.push(s)})),i},n})(),Mc="://",Do=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){G(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(Mc)&&(e=e.slice(0,e.indexOf(Mc))),G(e.length>0,(function(){return"scheme must not be an empty string."}));var r=n.getInstance();G(r.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})();function tg(n){if(n.indexOf(Mc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Do.getSchemes().join(","));return{scheme:n.split(Mc)[0],path:n.split(Mc)[1]}}function iR(n,e,t){return t===void 0&&(t=!1),Ve(this,void 0,void 0,(function(){var r,i,a,s,u,c,h,d,p;return Le(this,(function(g){switch(g.label){case 0:return G(n!==e,(function(){return"Old path and new path are the same: '"+n+"'"})),G((r=mi.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),G(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."})),i=r[0],G((a=mi.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),G(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),s=a[0],u=tg(n).scheme,c=tg(n).path,h=u===tg(n).scheme,[4,i.load()];case 1:return d=g.sent(),t&&h?[4,Do.getManager(u).removeModel(c)]:[3,3];case 2:g.sent(),g.label=3;case 3:return[4,s.save(d)];case 4:return p=g.sent(),!t||h?[3,6]:[4,Do.getManager(u).removeModel(c)];case 5:g.sent(),g.label=6;case 6:return[2,p.modelArtifactsInfo]}}))}))}var Wu="models_store",Ro="model_info_store";function wM(){if(!ge().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Kb(n){var e=n.result;e.createObjectStore(Wu,{keyPath:"modelPath"}),e.createObjectStore(Ro,{keyPath:"modelPath"})}var Oc=(function(){function n(e){if(this.indexedDB=wM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},n.prototype.load=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(e,t){var r=this;return new Promise((function(i,a){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Kb(s)},s.onsuccess=function(){var u=s.result;if(t==null){var c=u.transaction(Wu,"readonly"),h=c.objectStore(Wu).get(r.modelPath);h.onsuccess=function(){if(h.result==null)return u.close(),a(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(h.result.modelArtifacts)},h.onerror=function(E){return u.close(),a(h.error)},c.oncomplete=function(){return u.close()}}else{var d,p=Bd(t),g=u.transaction(Ro,"readwrite"),v=g.objectStore(Ro),b=v.put({modelPath:r.modelPath,modelArtifactsInfo:p});b.onsuccess=function(){var E=(d=u.transaction(Wu,"readwrite")).objectStore(Wu).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:p});E.onsuccess=function(){return i({modelArtifactsInfo:p})},E.onerror=function(w){var C=(v=g.objectStore(Ro)).delete(r.modelPath);C.onsuccess=function(){return u.close(),a(E.error)},C.onerror=function(S){return u.close(),a(E.error)}}},b.onerror=function(E){return u.close(),a(b.error)},g.oncomplete=function(){d==null?u.close():d.oncomplete=function(){return u.close()}}}},s.onerror=function(u){return a(s.error)}}))},n.URL_SCHEME="indexeddb://",n})(),aR=function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Oc.URL_SCHEME)?(e=n.slice(Oc.URL_SCHEME.length),new Oc(e)):null;var e};mi.registerSaveRouter(aR),mi.registerLoadRouter(aR);var aG=(function(){function n(){this.indexedDB=wM()}return n.prototype.listModels=function(){return Ve(this,void 0,void 0,(function(){var e=this;return Le(this,(function(t){return[2,new Promise((function(r,i){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Kb(a)},a.onsuccess=function(){var s=a.result,u=s.transaction(Ro,"readonly"),c=u.objectStore(Ro).getAll();c.onsuccess=function(){for(var h={},d=0,p=c.result;d<p.length;d++){var g=p[d];h[g.modelPath]=g.modelArtifactsInfo}r(h)},c.onerror=function(h){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}},a.onerror=function(s){return i(a.error)}}))]}))}))},n.prototype.removeModel=function(e){return Ve(this,void 0,void 0,(function(){var t=this;return Le(this,(function(r){var i;return e=(i=e).startsWith(Oc.URL_SCHEME)?i.slice(Oc.URL_SCHEME.length):i,[2,new Promise((function(a,s){var u=t.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return Kb(u)},u.onsuccess=function(){var c,h=u.result,d=h.transaction(Ro,"readwrite"),p=d.objectStore(Ro),g=p.get(e);g.onsuccess=function(){if(g.result==null)return h.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var v=p.delete(e),b=function(){var E=(c=h.transaction(Wu,"readwrite")).objectStore(Wu).delete(e);E.onsuccess=function(){return a(g.result.modelArtifactsInfo)},E.onerror=function(w){return s(g.error)}};v.onsuccess=b,v.onerror=function(E){return b(),h.close(),s(g.error)}},g.onerror=function(v){return h.close(),s(g.error)},d.oncomplete=function(){c==null?h.close():c.oncomplete=function(){return h.close()}}},u.onerror=function(c){return s(u.error)}}))]}))}))},n})();if(ge().getBool("IS_BROWSER"))try{Do.registerManager(Oc.URL_SCHEME,new aG)}catch{}var As="/",mc="tensorflowjs_models",EM="info",sG="model_topology",oG="weight_specs",uG="weight_data",lG="model_metadata";function TM(n){return{info:[mc,n,EM].join(As),topology:[mc,n,sG].join(As),weightSpecs:[mc,n,oG].join(As),weightData:[mc,n,uG].join(As),modelMetadata:[mc,n,lG].join(As)}}function cG(n){var e=n.split(As);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(As)}var Pc=(function(){function n(e){if(!ge().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=TM(this.modelPath)}return n.prototype.save=function(e){return Ve(this,void 0,void 0,(function(){var t,r,i;return Le(this,(function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Bd(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(s){if(qb)return Buffer.from(s).toString("base64");for(var u=new Uint8Array(s),c="",h=0,d=u.length;h<d;h++)c+=String.fromCharCode(u[h]);return btoa(c)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return Ve(this,void 0,void 0,(function(){var e,t,r,i,a,s,u;return Le(this,(function(c){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(a),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(h){if(qb){var d=Buffer.from(h,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var p=atob(h),g=new Uint8Array(p.length),v=0;v<p.length;++v)g.set([p.charCodeAt(v)],v);return g.buffer})(u),[2,t]}))}))},n.URL_SCHEME="localstorage://",n})(),sR=function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Pc.URL_SCHEME)?(e=n.slice(Pc.URL_SCHEME.length),new Pc(e)):null;var e};mi.registerSaveRouter(sR),mi.registerLoadRouter(sR);var hG=(function(){function n(){G(ge().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),G(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return Ve(this,void 0,void 0,(function(){var e,t,r,i,a,s;return Le(this,(function(u){for(e={},t=mc+As,r=As+EM,i=0;i<this.LS.length;++i)(a=this.LS.key(i)).startsWith(t)&&a.endsWith(r)&&(s=cG(a),e[s]=JSON.parse(this.LS.getItem(a)));return[2,e]}))}))},n.prototype.removeModel=function(e){return Ve(this,void 0,void 0,(function(){var t,r;return Le(this,(function(i){var a;if(e=(a=e).startsWith(Pc.URL_SCHEME)?a.slice(Pc.URL_SCHEME.length):a,t=TM(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n})();if(ge().getBool("IS_BROWSER"))try{Do.registerManager(Pc.URL_SCHEME,new hG)}catch{}var fG="model",dG=".json",pG=".weights.bin";function oR(n){return new Promise((function(e){return setTimeout(e)})).then(n)}var B_=(function(){function n(e){if(!ge().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=fG),this.modelTopologyFileName=e+dG,this.weightDataFileName=e+pG}return n.prototype.save=function(e){return Ve(this,void 0,void 0,(function(){var t,r,i,a,s,u;return Le(this,(function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=a,[4,oR((function(){return s.dispatchEvent(new MouseEvent("click"))}))];case 2:return c.sent(),e.weightData==null?[3,4]:((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=t,[4,oR((function(){return u.dispatchEvent(new MouseEvent("click"))}))]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Bd(e)}]}}))}))},n.URL_SCHEME="downloads://",n})(),mG=(function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Ve(this,void 0,void 0,(function(){var e,t,r=this;return Le(this,(function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(a,s){var u=new FileReader;u.onload=function(c){var h=JSON.parse(c.target.result),d=h.modelTopology;if(d!=null){t.length===0&&a({modelTopology:d});var p=h.weightsManifest;if(p!=null){var g;try{g=r.checkManifestAndWeightFiles(p,t)}catch(w){return void s(w)}var v=[],b=[],E=[];p.forEach((function(w){w.paths.forEach((function(C){b.push(C),E.push(null)})),v.push.apply(v,w.weights)})),p.forEach((function(w){w.paths.forEach((function(C){var S=new FileReader;S.onload=function(I){var D=I.target.result,O=b.indexOf(C);E[O]=D,E.indexOf(null)===-1&&a({modelTopology:d,weightSpecs:v,weightData:qx(E),format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})},S.onerror=function(I){return s("Failed to weights data from file of path '"+C+"'.")},S.readAsArrayBuffer(g[C])}))}))}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},u.onerror=function(c){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},u.readAsText(e)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map((function(c){return rR(c.name)})),a={},s=0,u=e;s<u.length;s++)u[s].paths.forEach((function(c){var h=rR(c);if(r.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(r.push(h),i.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");a[c]=t[i.indexOf(h)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return a},n})();function uR(n,e,t,r){(function(a){G(a!=null&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"}))})(n),(function(a,s){G(a>=0&&a<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a})),G(s>=0&&s<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s})),G(s>=a,(function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+s}))})(t=t??0,r=r??1);var i=0;return Promise.all(n.map((function(a){return a.then((function(s){var u=t+ ++i/n.length*(r-t);return e(u),s})),a})))}function CM(n,e){return Ve(this,void 0,void 0,(function(){var t,r,i,a,s,u,c,h,d;return Le(this,(function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?ge().platform.fetch:e.fetchFunc,r=n.map((function(g){return t(g,e.requestInit,{isBinary:!0})})),i=0,a=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=p.sent(),[3,4];case 2:return[4,uR(r,e.onProgress,i,a)];case 3:s=p.sent(),p.label=4;case 4:return u=s.map((function(g){return g.arrayBuffer()})),c=.5,h=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return d=p.sent(),[3,8];case 6:return[4,uR(u,e.onProgress,c,h)];case 7:d=p.sent(),p.label=8;case 8:return[2,d]}}))}))}function lR(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),Ve(e,void 0,void 0,(function(){var a,s,u,c,h,d,p,g,v,b;return Le(this,(function(E){switch(E.label){case 0:if(a=t.map((function(){return!1})),s={},u=i!=null?i.map((function(){return!1})):[],c=[],t.forEach((function(w,C){var S=0;w.weights.forEach((function(I){var D="quantization"in I?I.quantization.dtype:I.dtype,O=Wb[D]*je(I.shape),B=function(){a[C]=!0,s[C]==null&&(s[C]=[]),s[C].push({manifestEntry:I,groupOffset:S,sizeBytes:O})};i!=null?i.forEach((function(N,R){N===I.name&&(B(),u[R]=!0)})):B(),c.push(I.name),S+=O}))})),!u.every((function(w){return w})))throw h=i.filter((function(w,C){return!u[C]})),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return d=a.reduce((function(w,C,S){return C&&w.push(S),w}),[]),p=[],d.forEach((function(w){t[w].paths.forEach((function(C){var S=r+(r.endsWith("/")?"":"/")+C;p.push(S)}))})),[4,n(p)];case 1:return g=E.sent(),v={},b=0,d.forEach((function(w){for(var C=t[w].paths.length,S=0,I=0;I<C;I++)S+=g[b+I].byteLength;for(var D=new ArrayBuffer(S),O=new Uint8Array(D),B=0,N=0;N<C;N++){var R=new Uint8Array(g[b+N]);O.set(R,B),B+=R.byteLength}s[w].forEach((function(k){var P=xM(D.slice(k.groupOffset,k.groupOffset+k.sizeBytes),[k.manifestEntry]);for(var V in P)v[V]=P[V]})),b+=C})),[2,v]}}))}))}}mi.registerSaveRouter((function(n){return ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(B_.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new B_(e)})(n.slice(B_.URL_SCHEME.length)):null}));var SM=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(G(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=ge().platform.fetch,G(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&G(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Ve(this,void 0,void 0,(function(){var t,r,i,a;return Le(this,(function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=s.sent()).ok)return[2,{modelArtifactsInfo:Bd(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}}))}))},n.prototype.load=function(){return Ve(this,void 0,void 0,(function(){var e,t,r,i,a,s,u,c,h,d,p,g;return Le(this,(function(v){switch(v.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=v.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");v.label=2;case 2:return v.trys.push([2,4,,5]),[4,e.json()];case 3:return t=v.sent(),[3,5];case 4:throw v.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,a=t.weightsManifest,s=t.generatedBy,u=t.convertedBy,c=t.format,h=t.userDefinedMetadata,i==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:g=v.sent(),d=g[0],p=g[1],v.label=7;case 7:return[2,{modelTopology:i,weightSpecs:d,weightData:p,userDefinedMetadata:h,generatedBy:s,convertedBy:u,format:c}]}}))}))},n.prototype.loadWeights=function(e){return Ve(this,void 0,void 0,(function(){var t,r,i,a,s,u,c,h,d,p,g;return Le(this,(function(v){switch(v.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(b){var E=b.lastIndexOf("/"),w=b.lastIndexOf("?"),C=b.substring(0,E),S=w>E?b.substring(w):"";return[C+"/",S]})(t),i=r[0],a=r[1],s=this.weightPathPrefix||i,u=[],c=0,h=e;c<h.length;c++)d=h[c],u.push.apply(u,d.weights);return p=[],e.forEach((function(b){b.paths.forEach((function(E){p.push(s+E+a)}))})),[4,CM(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return g=v.sent(),[2,[u,qx(g)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function Xb(n){return n.match(SM.URL_SCHEME_REGEX)!=null}var cR=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every((function(t){return Xb(t)})):Xb(n))?Yb(n,{onProgress:e}):null};function Yb(n,e){return new SM(n,e)}mi.registerSaveRouter(cR),mi.registerLoadRouter(cR);var j_=(function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(e){return[2,this.modelArtifacts]}))}))},n})(),gG=(function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){return[2,this.saveHandler(e)]}))}))},n})(),AM=Object.freeze({browserFiles:function(n){return new mG(n)},browserHTTPRequest:function(n,e){return Yb(n,e)},concatenateArrayBuffers:qx,decodeWeights:xM,encodeWeights:function(n,e){return Ve(this,void 0,void 0,(function(){var t,r,i,a,s,u=this;return Le(this,(function(c){switch(c.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map((function(h){return h.name})):Object.keys(n),a=function(h){var d=i[h],p=Array.isArray(n)?n[h].tensor:n[d];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+p.dtype);var g={name:d,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var v=new Promise((function(b){return Ve(u,void 0,void 0,(function(){var E,w,C,S,I,D,O;return Le(this,(function(B){switch(B.label){case 0:return[4,p.bytes()];case 1:for(E=B.sent(),w=E.reduce((function(N,R){return N+R.length}),0)+Mg*E.length,C=new Uint8Array(w),S=0,I=0;I<E.length;I++)D=E[I],O=new Uint8Array(new Uint32Array([D.length]).buffer),C.set(O,S),S+=Mg,C.set(D,S),S+=D.length;return b(C),[2]}}))}))}));r.push(v)}else r.push(p.data());e!=null&&(g.group=e),t.push(g)},s=0;s<i.length;++s)a(s);return[4,Promise.all(r)];case 1:return[2,{data:iG(c.sent()),specs:t}]}}))}))},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new j_(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new j_({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new j_({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return mi.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Bd,getSaveHandlers:function(n){return mi.getSaveHandlers(n)},http:Yb,isHTTPScheme:Xb,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Ve(this,void 0,void 0,(function(){return Le(this,(function(i){return[2,lR((function(a){return CM(a,{requestInit:r})}))(n,e,t)]}))}))},registerLoadRouter:function(n){return mi.registerLoadRouter(n)},registerSaveRouter:function(n){return mi.registerSaveRouter(n)},weightsLoaderFactory:lR,withSaveHandler:function(n){return new gG(n)},copyModel:function(n,e){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){return[2,iR(n,e,!1)]}))}))},listModels:function(){return Ve(this,void 0,void 0,(function(){var n,e,t,r,i,a,s;return Le(this,(function(u){switch(u.label){case 0:n=Do.getSchemes(),e={},t=0,r=n,u.label=1;case 1:return t<r.length?(i=r[t],[4,Do.getManager(i).listModels()]):[3,4];case 2:for(s in a=u.sent())e[i+Mc+s]=a[s];u.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(n,e){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){return[2,iR(n,e,!0)]}))}))},removeModel:function(n){return Ve(this,void 0,void 0,(function(){var e;return Le(this,(function(t){return e=tg(n),[2,Do.getManager(e.scheme).removeModel(e.path)]}))}))}}),uc;Y({confusionMatrix_:function(n,e,t){var r=z(n,"labels","confusionMatrix"),i=z(e,"predictions","confusionMatrix");G(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),G(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),G(i.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),G(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),G(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var a=jb(r.asType("int32"),t),s=jb(i.asType("int32"),t);return a.transpose().matMul(s).asType("int32")}});var vG=Y({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,a=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)a=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(QD("FromPixels",J.backendName)!=null)return J.runKernel("FromPixels",{pixels:n},{numChannels:e});var u,c,h=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],d=h[0],p=h[1];if(s?u=n.getContext("2d").getImageData(0,0,d,p).data:r||t?u=n.data:(a||i)&&(uc==null&&(uc=document.createElement("canvas").getContext("2d")),uc.canvas.width=d,uc.canvas.height=p,uc.drawImage(n,0,0,d,p),u=uc.getImageData(0,0,d,p).data),e===4)c=new Int32Array(u);else{var g=d*p;c=new Int32Array(g*e);for(var v=0;v<g;v++)for(var b=0;b<e;++b)c[v*e+b]=u[4*v+b]}return xx(c,[p,d,e],"int32")}}),Kx=Object.freeze({toPixels:function(n,e){return Ve(this,void 0,void 0,(function(){var t,r,i,a,s,u,c,h,d,p,g,v,b,E,w,C,S,I,D,O,B,N,R;return Le(this,(function(k){switch(k.label){case 0:if(t=z(n,"img","toPixels"),n instanceof sn||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],a=r[1],(s=t.rank===2?1:t.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return u=k.sent(),c=t.min(),h=t.max(),[4,Promise.all([c.data(),h.data()])];case 2:if(d=k.sent(),p=d[0],g=d[1],v=p[0],b=g[0],c.dispose(),h.dispose(),t.dtype==="float32"){if(v<0||b>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+v+" - "+b+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(v<0||b>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+v+" - "+b+"].")}for(E=t.dtype==="float32"?255:1,w=new Uint8ClampedArray(a*i*4),C=0;C<i*a;++C)S=void 0,I=void 0,D=void 0,O=void 0,s===1?(S=u[C]*E,I=u[C]*E,D=u[C]*E,O=255):s===3?(S=u[3*C]*E,I=u[3*C+1]*E,D=u[3*C+2]*E,O=255):s===4&&(S=u[4*C]*E,I=u[4*C+1]*E,D=u[4*C+2]*E,O=u[4*C+3]*E),w[(B=4*C)+0]=Math.round(S),w[B+1]=Math.round(I),w[B+2]=Math.round(D),w[B+3]=Math.round(O);return e!=null&&(e.width=a,e.height=i,N=e.getContext("2d"),R=new ImageData(w,a,i),N.putImageData(R,0,0)),t!==n&&t.dispose(),[2,w]}}))}))},fromPixels:vG}),yG=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),_G=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function cl(n){G(n.className!=null,(function(){return"Class being registered does not have the static className property defined."})),G(typeof n.className=="string",(function(){return"className is required to be a string, but got type "+typeof n.className})),G(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),_G.register(n)}var hl=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return ha(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var a=this.computeGradients(t,i),s=a.value,u=a.grads;if(i!=null){var c=i.map((function(h){return{name:h.name,tensor:u[h.name]}}));this.applyGradients(c)}else this.applyGradients(u);return ei(u),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return IU(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&ei(this.iterations_)},e.prototype.saveIterations=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ae(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){return Le(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return Ve(this,void 0,void 0,(function(){var r;return Le(this,(function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}}))}))},e})(yG);Object.defineProperty(hl,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var bG=(function(n){function e(t,r,i){i===void 0&&(i=null);var a=n.call(this)||this;return a.learningRate=t,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],i==null&&(a.epsilon=J.backend.epsilon()),a}return ha(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var s=J.registeredVariables[i];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:i+"/accum_grad",variable:Me((function(){return At(s).variable(!1)}))}),r.accumulatedUpdates[a]==null&&(r.accumulatedUpdates[a]={originalName:i+"/accum_var",variable:Me((function(){return At(s).variable(!1)}))});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=r.accumulatedGrads[a].variable,h=r.accumulatedUpdates[a].variable;Me((function(){var d=c.mul(r.rho).add(u.square().mul(1-r.rho)),p=h.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(u),g=h.mul(r.rho).add(p.square().mul(1-r.rho));c.assign(d),h.assign(g);var v=p.mul(-r.learningRate).add(s);s.assign(v)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ei(this.accumulatedGrads.map((function(t){return t.variable}))),ei(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){var t;return Le(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){var r;return Le(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e})(hl);cl(bG);var xG=(function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return ha(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var s=J.registeredVariables[i];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:i+"/accumulator",variable:Me((function(){return Ka(s.shape,r.initialAccumulatorValue).variable(!1)}))});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=r.accumulatedGrads[a].variable;Me((function(){var h=c.add(u.square());c.assign(h);var d=u.div(h.add(J.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(d)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ei(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){return Le(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(hl);cl(xG);var wG=(function(n){function e(t,r,i,a){a===void 0&&(a=null);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=a,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],Me((function(){s.accBeta1=Ae(r).variable(),s.accBeta2=Ae(i).variable()})),a==null&&(s.epsilon=J.backend.epsilon()),s}return ha(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t);Me((function(){var a=qn(1,r.accBeta1),s=qn(1,r.accBeta2);i.forEach((function(u,c){var h=J.registeredVariables[u];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:u+"/m",variable:Me((function(){return At(h).variable(!1)}))}),r.accumulatedSecondMoment[c]==null&&(r.accumulatedSecondMoment[c]={originalName:u+"/v",variable:Me((function(){return At(h).variable(!1)}))});var d=Array.isArray(t)?t[c].tensor:t[u];if(d!=null){var p=r.accumulatedFirstMoment[c].variable,g=r.accumulatedSecondMoment[c].variable,v=p.mul(r.beta1).add(d.mul(1-r.beta1)),b=g.mul(r.beta2).add(d.square().mul(1-r.beta2)),E=v.div(a),w=b.div(s);p.assign(v),g.assign(b);var C=E.div(w.sqrt().add(r.epsilon)).mul(-r.learningRate).add(h);h.assign(C)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ei(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&ei(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){var t;return Le(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){var r,i=this;return Le(this,(function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),Me((function(){i.accBeta1.assign(Dg(i.beta1,i.iterations_+1)),i.accBeta2.assign(Dg(i.beta2,i.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(hl);cl(wG);var EG=(function(n){function e(t,r,i,a,s){a===void 0&&(a=null),s===void 0&&(s=0);var u=n.call(this)||this;return u.learningRate=t,u.beta1=r,u.beta2=i,u.epsilon=a,u.decay=s,u.accumulatedFirstMoment=[],u.accumulatedWeightedInfNorm=[],Me((function(){u.iteration=Ae(0).variable(),u.accBeta1=Ae(r).variable()})),a==null&&(u.epsilon=J.backend.epsilon()),u}return ha(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t);Me((function(){var a=qn(1,r.accBeta1),s=ra(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach((function(u,c){var h=J.registeredVariables[u];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:u+"/m",variable:At(h).variable(!1)}),r.accumulatedWeightedInfNorm[c]==null&&(r.accumulatedWeightedInfNorm[c]={originalName:u+"/v",variable:At(h).variable(!1)});var d=Array.isArray(t)?t[c].tensor:t[u];if(d!=null){var p=r.accumulatedFirstMoment[c].variable,g=r.accumulatedWeightedInfNorm[c].variable,v=p.mul(r.beta1).add(d.mul(1-r.beta1)),b=g.mul(r.beta2),E=d.abs(),w=b.maximum(E);p.assign(v),g.assign(w);var C=s.div(a).mul(v.div(w.add(r.epsilon))).add(h);h.assign(C)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ei(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&ei(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){return Le(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(hl);cl(EG);var RM=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ha(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var s=Array.isArray(t)?t[a].tensor:t[i];if(s!=null){var u=J.registeredVariables[i];Me((function(){var c=r.c.mul(s).add(u);u.assign(c)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=H5(Ae(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){return Le(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(hl);cl(RM);var TG=(function(n){function e(t,r,i){i===void 0&&(i=!1);var a=n.call(this,t)||this;return a.learningRate=t,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=Ae(a.momentum),a}return ha(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var s=J.registeredVariables[i];r.accumulations[a]==null&&(r.accumulations[a]={originalName:i+"/momentum",variable:Me((function(){return At(s).variable(!1)}))});var u=r.accumulations[a].variable,c=Array.isArray(t)?t[a].tensor:t[i];c!=null&&Me((function(){var h,d=r.m.mul(u).add(c);h=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(s):r.c.mul(d).add(s),u.assign(d),s.assign(h)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ei(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){return Le(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){return Le(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e})(RM);cl(TG);var CG=(function(n){function e(t,r,i,a,s){r===void 0&&(r=.9),i===void 0&&(i=0),a===void 0&&(a=null),s===void 0&&(s=!1);var u=n.call(this)||this;if(u.learningRate=t,u.decay=r,u.momentum=i,u.epsilon=a,u.accumulatedMeanSquares=[],u.accumulatedMoments=[],u.accumulatedMeanGrads=[],u.centered=s,a==null&&(u.epsilon=J.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return u}return ha(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,a){var s=J.registeredVariables[i];r.accumulatedMeanSquares[a]==null&&(r.accumulatedMeanSquares[a]={originalName:i+"/rms",variable:Me((function(){return At(s).variable(!1)}))}),r.accumulatedMoments[a]==null&&(r.accumulatedMoments[a]={originalName:i+"/momentum",variable:Me((function(){return At(s).variable(!1)}))}),r.accumulatedMeanGrads[a]==null&&r.centered&&(r.accumulatedMeanGrads[a]={originalName:i+"/mg",variable:Me((function(){return At(s).variable(!1)}))});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=r.accumulatedMeanSquares[a].variable,h=r.accumulatedMoments[a].variable;Me((function(){var d=c.mul(r.decay).add(u.square().mul(1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[a].variable,g=p.mul(r.decay).add(u.mul(1-r.decay)),v=h.mul(r.momentum).add(u.mul(r.learningRate).div(d.sub(g.square().add(r.epsilon)).sqrt()));c.assign(d),p.assign(g),h.assign(v);var b=s.sub(v);s.assign(b)}else{var E=c.mul(r.decay).add(u.square().mul(1-r.decay));v=h.mul(r.momentum).add(u.mul(r.learningRate).div(E.add(r.epsilon).sqrt())),c.assign(E),h.assign(v),b=s.sub(v),s.assign(b)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ei(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&ei(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&ei(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Ve(this,void 0,void 0,(function(){var t;return Le(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Ve(this,void 0,void 0,(function(){var r;return Le(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(hl);cl(CG);sn.prototype.squaredDifference=function(n){return Hk(this,n)},pe=QH;var $b=function(n,e){return $b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},$b(n,e)};function nt(n,e){$b(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Tr=function(){return Tr=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Tr.apply(this,arguments)};function ze(n,e,t,r){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function u(d){try{h(r.next(d))}catch(p){s(p)}}function c(d){try{h(r.throw(d))}catch(p){s(p)}}function h(d){d.done?a(d.value):i(d.value).then(u,c)}h((r=r.apply(n,[])).next())})}function He(n,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(h){return function(d){return c([h,d])}}function c(h){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(n,t)}catch(d){h=[6,d],i=0}finally{r=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Wf(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var a=arguments[e],s=0,u=a.length;s<u;s++,i++)r[i]=a[s];return r}var Fc=(function(){function n(e,t){if(!$u(e)||!$u(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n})();function xv(n,e){return n instanceof sn&&n.shape.length===e}function SG(n){return xv(n,2)}function wv(n){return xv(n,3)}function ko(n){return xv(n,4)}function AG(n){return n%1!==0}function hR(n){return n%2===0}function RG(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function fR(n){return n&&n.width&&n.height}function IG(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Fc(Math.round(t*i),Math.round(r*i))}function Xx(n){return n.reduce(function(e,t){return e.add(t)},new Mt(0,0)).div(new Mt(n.length,n.length))}function hd(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function $u(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function dR(n){return $u(n)&&0<=n&&n<=1}var Mt=(function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n})(),Go=(function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every($u),a=[r.x,r.y,r.width,r.height].every($u);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],u=s[0],c=s[1],h=s[2],d=s[3];n.assertIsValidBox({x:u,y:c,width:h,height:d},"Box.constructor",t),this._x=u,this._y=c,this._width=h,this._height=d}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every($u)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Mt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Mt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Mt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Mt(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),t=e[0],r=e[1],i=e[2],a=e[3];return new n({x:t,y:r,width:i,height:a})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),t=e[0],r=e[1],i=e[2],a=e[3];return new n({x:t,y:r,width:i,height:a})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,a=e.height,s=Math.abs(i-a);return i<a&&(t-=s/2,i+=s),a<i&&(r-=s/2,a+=s),new n({x:t,y:r,width:i,height:a})},n.prototype.rescale=function(e){var t=fR(e)?e.width:e,r=fR(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],a=r[1],s=r[2],u=r[3];return new n({x:i,y:a,width:s,height:u})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,a=r.y,s=r.right,u=r.bottom,c=Math.max(i,0),h=Math.max(a,0),d=s-c,p=u-h,g=Math.min(d,e-c),v=Math.min(p,t-h);return new n({x:c,y:h,width:g,height:v}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,a=r.height,s=this.x+e,u=this.y+t;return new n({x:s,y:u,width:i,height:a})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,a=1,s=1,u=r,c=i,h=this.left,d=this.top,p=this.right,g=this.bottom;return p>t&&(u=-p+t+r,p=t),g>e&&(c=-g+e+i,g=e),h<1&&(c=2-h,h=1),d<1&&(c=2-d,d=1),{dy:s,edy:c,dx:a,edx:u,y:d,ey:g,x:h,ex:p,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n})(),Ev=(function(n){nt(e,n);function e(t,r,i,a,s){return s===void 0&&(s=!1),n.call(this,{left:t,top:r,right:i,bottom:a},s)||this}return e})(Go),IM=(function(){function n(e,t,r,i,a){this._imageDims=new Fc(a.width,a.height),this._score=e,this._classScore=t,this._className=r,this._box=new Go(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Go(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n})(),rs=(function(n){nt(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),a=i.score,s=i.relativeBox,u=i.imageDims;return new e(a,s,u)},e})(IM);function NG(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),a=r*i;return t?a/(n.area+e.area-a):a/Math.min(n.area,e.area)}function DG(n){var e=n.map(function(u){return u.x}),t=n.map(function(u){return u.y}),r=e.reduce(function(u,c){return c<u?c:u},1/0),i=t.reduce(function(u,c){return c<u?c:u},1/0),a=e.reduce(function(u,c){return u<c?c:u},0),s=t.reduce(function(u,c){return u<c?c:u},0);return new Ev(r,i,a,s)}function fd(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(u,c){return{score:u,boxIndex:c}}).sort(function(u,c){return u.score-c.score}).map(function(u){return u.boxIndex}),a=[],s=function(){var u=i.pop();a.push(u);for(var c=i,h=[],d=0;d<c.length;d++){var p=c[d],g=n[u],v=n[p];h.push(NG(g,v,r))}i=i.filter(function(b,E){return h[E]<=t})};i.length>0;)s();return a}function jd(n,e){return Me(function(){var t=e[0],r=e[1],i=e[2],a=Ka(Wf(n.shape.slice(0,3),[1]),t),s=Ka(Wf(n.shape.slice(0,3),[1]),r),u=Ka(Wf(n.shape.slice(0,3),[1]),i),c=zn([a,s,u],3);return qn(n,c)})}function kG(n,e){return e===void 0&&(e=!1),Me(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var a=Math.abs(r-i),s=Math.round(a*(e?.5:1)),u=r>i?2:1,c=function(v){var b=n.shape.slice();return b[u]=v,Ka(b,0)},h=c(s),d=a-h.shape[u],p=e&&d?c(d):null,g=[p,n,h].filter(function(v){return!!v}).map(function(v){return v.toFloat()});return zn(g,u)})}function U_(n){return 1/(1+Math.exp(-n))}var Yx=(function(n){nt(e,n);function e(t,r,i,a,s){return s===void 0&&(s=!1),n.call(this,{x:t,y:r,width:i,height:a},s)||this}return e})(Go),MG=.5,OG=.43,PG=.45,Og=(function(){function n(e,t,r){r===void 0&&(r=new Mt(0,0));var i=t.width,a=t.height;this._imgDims=new Fc(i,a),this._shift=r,this._positions=e.map(function(s){return s.mul(new Mt(i,a)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Mt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Mt(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Mt(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof rs?e.box.floor():new Go(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=i.useDlibAlignment,s=i.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],a=function(p){return i.sub(p).magnitude()},s=(a(t)+a(r))/2,u=Math.floor(s/PG),c=Xx(e),h=Math.floor(Math.max(0,c.x-MG*u)),d=Math.floor(Math.max(0,c.y-OG*u));return new Yx(h,d,Math.min(u,this.imageWidth+h),Math.min(u,this.imageHeight+d))},n.prototype.alignMinBbox=function(e){var t=DG(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n})(),FG=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Xx([t[3],t[4]])]},e})(Og),VG=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Xx)},e})(Og),pR=(function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+RG(this.distance)+")":"")},n})(),mR=(function(n){nt(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(Go.assertIsValidBox(t,r),!$u(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(Go),Lm=(function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n})();(function(n){nt(e,n);function e(t,r,i,a){var s=n.call(this,t,r)||this;return s._score=i,s._classScore=a,s}return e.assertIsValidPredictedBox=function(t,r){if(mR.assertIsValidLabeledBox(t,r),!dR(t.score)||!dR(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(mR);function LG(n){return n.detection instanceof rs}function $x(n,e){var t={detection:e};return Object.assign({},n,t)}function NM(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function DM(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,a){n.readFile(r,function(s,u){return s?a(s):i(u)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function kM(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=DM();return Tr({Canvas:n||(function(){function s(){}return s})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function s(){}return s})(),Image:e||(function(){function s(){}return s})(),ImageData:global.ImageData||(function(){function s(){}return s})(),Video:global.HTMLVideoElement||(function(){function s(){}return s})(),createCanvasElement:t,createImageElement:r,fetch:i},a)}function MM(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function OM(){return typeof global=="object"&&typeof require=="function"&&typeof CP<"u"&&typeof process<"u"&&!!process.version}var jn;function BG(){if(!jn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return jn}function Qb(n){jn=n}function Qx(){MM()&&Qb(NM()),OM()&&Qb(kM())}function jG(n){if(jn||Qx(),!jn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?jn.Canvas:e,r=n.Image,i=r===void 0?jn.Image:r;jn.Canvas=t,jn.Image=i,jn.createCanvasElement=n.createCanvasElement||(function(){return new t}),jn.createImageElement=n.createImageElement||(function(){return new i}),jn.ImageData=n.ImageData||jn.ImageData,jn.Video=n.Video||jn.Video,jn.fetch=n.fetch||jn.fetch,jn.readFile=n.readFile||jn.readFile}var Mr={getEnv:BG,setEnv:Qb,initialize:Qx,createBrowserEnv:NM,createFileSystem:DM,createNodejsEnv:kM,monkeyPatch:jG,isBrowser:MM,isNodejs:OM};Qx();function PM(n){return!Mr.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function tl(n){var e=Mr.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=PM(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=i.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var gR;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(gR||(gR={}));function FM(n){var e=Mr.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function UG(n){return new Promise(function(e,t){if(n instanceof Mr.getEnv().Canvas||FM(n))return e();function r(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",i),e(a))}function i(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",i),t(a))}n.addEventListener("load",r),n.addEventListener("error",i)})}function VM(n){var e=Mr.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Fc(n.naturalWidth,n.naturalHeight):n instanceof r?new Fc(n.videoWidth,n.videoHeight):new Fc(n.width,n.height)}function Tv(n){var e=n.width,t=n.height,r=Mr.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function Zx(n,e){var t=Mr.getEnv().ImageData;if(!(n instanceof t)&&!FM(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=VM(n),i=r.width,a=r.height,s=Tv({width:i,height:a});return n instanceof t?tl(s).putImageData(n,0,0):tl(s).drawImage(n,0,0,i,a),s}function zG(n,e){return ze(this,void 0,void 0,function(){var t,r,i,a,s,u;return He(this,function(c){switch(c.label){case 0:return t=Mr.getEnv().createCanvasElement(),r=n.shape.slice(ko(n)?1:0),i=r[0],a=r[1],s=r[2],u=Me(function(){return n.as3D(i,a,s).toInt()}),[4,Kx.toPixels(u,t)];case 1:return c.sent(),u.dispose(),[2,t]}})})}function vR(n){var e=Mr.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function HG(n,e,t){t===void 0&&(t=!1);var r=Mr.getEnv(),i=r.Image,a=r.Canvas;if(!(n instanceof i||n instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=VM(n),u=e/Math.max(s.height,s.width),c=u*s.width,h=u*s.height,d=Tv({width:e,height:e}),p=n instanceof a?n:Zx(n),g=Math.abs(c-h)/2,v=t&&c<h?g:0,b=t&&h<c?g:0;return tl(d).drawImage(p,v,b,c,h),d}var Pg=(function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,a){if(wv(i)){r._imageTensors[a]=i,r._inputDimensions[a]=i.shape;return}if(ko(i)){var s=i.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");r._imageTensors[a]=i,r._inputDimensions[a]=i.shape.slice(1);return}var u=i instanceof Mr.getEnv().Canvas?i:Zx(i);r._canvases[a]=u,r._inputDimensions[a]=[u.height,u.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return hd(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return IG({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,Me(function(){var i=hd(r.batchSize,0,1).map(function(s){var u=r.getInput(s);if(u instanceof sn){var c=ko(u)?u:u.expandDims();return c=kG(c,t),(c.shape[1]!==e||c.shape[2]!==e)&&(c=Ux.resizeBilinear(c,[e,e])),c.as3D(e,e,3)}if(u instanceof Mr.getEnv().Canvas)return Kx.fromPixels(HG(u,e,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+u)}),a=yi(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3);return a})},n})();function ir(n){return ze(this,void 0,void 0,function(){var e,t,r;return He(this,function(i){switch(i.label){case 0:if(n instanceof Pg)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(a){return Array.isArray(n)?" at input index "+a+":":""},r=e.map(PM),r.forEach(function(a,s){if(!vR(a)&&!wv(a)&&!ko(a))throw typeof e[s]=="string"?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ko(a)){var u=a.shape[0];if(u!==1)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+u+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(a){return vR(a)&&UG(a)}))];case 1:return i.sent(),[2,new Pg(r,Array.isArray(n))]}})})}function Jx(n,e){return ze(this,void 0,void 0,function(){var t,r,i,a,s,u,c;return He(this,function(h){switch(h.label){case 0:return t=Mr.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,ir(n)];case 1:if(i=h.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=i.getInput(0),a instanceof t?(s=a,[3,4]):[3,2];case 2:return[4,zG(a)];case 3:s=h.sent(),h.label=4;case 4:r=s,h.label=5;case 5:return u=tl(r),c=e.map(function(d){return d instanceof rs?d.forSize(r.width,r.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(r.width,r.height)}),[2,c.map(function(d){var p=d.x,g=d.y,v=d.width,b=d.height,E=Tv({width:v,height:b});return tl(E).putImageData(u.getImageData(p,g,v,b),0,0),E})]}})})}function ew(n,e){return ze(this,void 0,void 0,function(){return He(this,function(t){if(!wv(n)&&!ko(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ko(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Me(function(){var r=n.shape.slice(ko(n)?1:0),i=r[0],a=r[1],s=r[2],u=e.map(function(h){return h instanceof rs?h.forSize(a,i).box:h}).map(function(h){return h.clipAtImageBorders(a,i)}),c=u.map(function(h){var d=h.x,p=h.y,g=h.width,v=h.height;return cM(n.as3D(i,a,s),[p,d,0],[v,g,s])});return c})]})})}function GG(n,e){return ze(this,void 0,void 0,function(){var t,r;return He(this,function(i){switch(i.label){case 0:return t=Mr.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function WG(n){return ze(this,void 0,void 0,function(){return He(this,function(e){switch(e.label){case 0:return[4,GG(n)];case 1:return[2,e.sent().json()]}})})}function LM(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(u){return u}),a=n.endsWith(".json")?i[i.length-1]:t,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=n.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+a:s+"/"+a}}function qG(n,e){return ze(this,void 0,void 0,function(){var t,r,i,a;return He(this,function(s){switch(s.label){case 0:return t=LM(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,WG(r)];case 1:return a=s.sent(),[2,AM.loadWeights(a,i)]}})})}var zs=(function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,a=r.objProp;i[a].dispose(),i[a]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Kc})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Kc)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,a=pr(i.dataSync());i.dispose(),e.reassignParamFromPath(r,a)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return ze(this,void 0,void 0,function(){return He(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return ze(this,void 0,void 0,function(){var t;return He(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,qG(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return ze(this,void 0,void 0,function(){var t,r,i,a,s,u,c,h,d,p;return He(this,function(g){switch(g.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Mr.getEnv().readFile,r=LM(e,this.getDefaultModelName()),i=r.manifestUri,a=r.modelBaseUri,s=function(v){return Promise.all(v.map(function(b){return t(b).then(function(E){return E.buffer})}))},u=AM.weightsLoaderFactory(s),d=(h=JSON).parse,[4,t(i)];case 1:return c=d.apply(h,[g.sent().toString()]),[4,u(c,a)];case 2:return p=g.sent(),this.loadFromWeightMap(p),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(a,s){if(!a.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:a.nextObj,objProp:s,nextObj:a.nextObj[s]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof sn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n})();function gi(n,e,t){return Me(function(){var r=Fx(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=ft(r,e.bias),r})}function z_(n,e,t){return t===void 0&&(t=!1),Me(function(){var r=un(t?ft(Hi(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):gi(n,e.conv0,[2,2])),i=gi(r,e.conv1,[1,1]),a=un(ft(r,i)),s=gi(a,e.conv2,[1,1]);return un(ft(r,ft(i,s)))})}function Bm(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Me(function(){var i=un(t?ft(Hi(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):gi(n,e.conv0,r?[2,2]:[1,1])),a=gi(i,e.conv1,[1,1]),s=un(ft(i,a)),u=gi(s,e.conv2,[1,1]),c=un(ft(i,ft(a,u))),h=gi(c,e.conv3,[1,1]);return un(ft(i,ft(a,ft(u,h))))})}function oa(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),Me(function(){var i=ft(Hi(n,e.filters,[1,1],t),e.bias);return r?un(i):i})}function Hs(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function Cv(n,e){return function(t,r,i,a){var s=Yr(n(t*r*i*i),[i,i,t,r]),u=Mn(n(r));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:s,bias:u}}}function tw(n,e){return function(t,r,i){var a=No(n(t*r),[t,r]),s=Mn(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:s}}}var BM=(function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n})();function nw(n,e){return function(t,r,i){var a=Yr(n(9*t),[3,3,t,1]),s=Yr(n(t*r),[1,1,t,r]),u=Mn(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new BM(a,s,u)}}function rw(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new BM(t,r,i)}}function tu(n,e){return function(t,r,i){var a=n[t];if(!xv(a,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+a);return e.push({originalPath:t,paramPath:i||t}),a}}function Gs(n){var e=n;function t(i){var a=e.slice(0,i);return e=e.slice(i),a}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function jM(n,e){var t=Cv(n,e),r=nw(n,e);function i(s,u,c,h){h===void 0&&(h=!1);var d=h?t(s,u,3,c+"/conv0"):r(s,u,c+"/conv0"),p=r(u,u,c+"/conv1"),g=r(u,u,c+"/conv2");return{conv0:d,conv1:p,conv2:g}}function a(s,u,c,h){h===void 0&&(h=!1);var d=i(s,u,c,h),p=d.conv0,g=d.conv1,v=d.conv2,b=r(u,u,c+"/conv3");return{conv0:p,conv1:g,conv2:v,conv3:b}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function KG(n){var e=[],t=Gs(n),r=t.extractWeights,i=t.getRemainingWeights,a=jM(r,e).extractDenseBlock4Params,s=a(3,32,"dense0",!0),u=a(32,64,"dense1"),c=a(64,128,"dense2"),h=a(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:u,dense2:c,dense3:h}}}function UM(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function zM(n,e){var t=tu(n,e),r=UM(t),i=rw(t);function a(u,c){c===void 0&&(c=!1);var h=c?r(u+"/conv0"):i(u+"/conv0"),d=i(u+"/conv1"),p=i(u+"/conv2");return{conv0:h,conv1:d,conv2:p}}function s(u,c){c===void 0&&(c=!1);var h=c?r(u+"/conv0"):i(u+"/conv0"),d=i(u+"/conv1"),p=i(u+"/conv2"),g=i(u+"/conv3");return{conv0:h,conv1:d,conv2:p,conv3:g}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function XG(n){var e=[],t=zM(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Hs(n,e),{params:r,paramMappings:e}}var HM=(function(n){nt(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Me(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=jd(i,a).div(Ae(255)),u=Bm(s,r.dense0,!0);return u=Bm(u,r.dense1),u=Bm(u,r.dense2),u=Bm(u,r.dense3),u=Ld(u,[7,7],[2,2],"valid"),u})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return XG(t)},e.prototype.extractParams=function(t){return KG(t)},e})(zs);function Ua(n,e){return Me(function(){return ft(yv(n,e.weights),e.bias)})}function YG(n,e,t){var r=[],i=Gs(n),a=i.extractWeights,s=i.getRemainingWeights,u=tw(a,r),c=u(e,t,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:c}}}function $G(n){var e=[],t=tu(n,e);function r(a){var s=t(a+"/weights",2),u=t(a+"/bias",1);return{weights:s,bias:u}}var i={fc:r("fc")};return Hs(n,e),{params:i,paramMappings:e}}function GM(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var WM=(function(n){nt(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Me(function(){var a=t instanceof Pg?r.faceFeatureExtractor.forwardInput(t):t;return Ua(a.as2D(a.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,a=r.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return YG(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=GM(t),i=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),$G(a)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),a=i*r+i,s=t.slice(0,t.length-a),u=t.slice(t.length-a);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(u)},e})(zs),yR=["neutral","happy","sad","angry","fearful","disgusted","surprised"],QG=(function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);yR.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return yR.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n})(),ZG=(function(n){nt(e,n);function e(t){return t===void 0&&(t=new HM),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return Me(function(){return js(r.runNet(t))})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return ze(this,void 0,void 0,function(){var r,i,a,s,u=this;return He(this,function(c){switch(c.label){case 0:return[4,ir(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),[4,Promise.all(Hn(i).map(function(h){return ze(u,void 0,void 0,function(){var d;return He(this,function(p){switch(p.label){case 0:return[4,h.data()];case 1:return d=p.sent(),h.dispose(),[2,d]}})})}))];case 3:return a=c.sent(),i.dispose(),s=a.map(function(h){return new QG(h)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})(WM);function qM(n,e){var t={expressions:e};return Object.assign({},n,t)}function JG(n){return LG(n)&&n.landmarks instanceof Og&&n.unshiftedLandmarks instanceof Og&&n.alignedRect instanceof rs}function iw(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),a=n.detection.imageDims,s=new rs(n.detection.score,i.rescale(a.reverse()),a),u={landmarks:r,unshiftedLandmarks:e,alignedRect:s};return Object.assign({},n,u)}function eW(n,e){var t=Cv(n,e),r=nw(n,e);function i(s,u,c){var h=r(s,u,c+"/separable_conv0"),d=r(u,u,c+"/separable_conv1"),p=t(s,u,1,c+"/expansion_conv");return{separable_conv0:h,separable_conv1:d,expansion_conv:p}}function a(s,u){var c=r(s,s,u+"/separable_conv0"),h=r(s,s,u+"/separable_conv1"),d=r(s,s,u+"/separable_conv2");return{separable_conv0:c,separable_conv1:h,separable_conv2:d}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:a}}function tW(n,e){var t=[],r=Gs(n),i=r.extractWeights,a=r.getRemainingWeights,s=eW(i,t),u=s.extractConvParams,c=s.extractSeparableConvParams,h=s.extractReductionBlockParams,d=s.extractMainBlockParams,p=u(3,32,3,"entry_flow/conv_in"),g=h(32,64,"entry_flow/reduction_block_0"),v=h(64,128,"entry_flow/reduction_block_1"),b={conv_in:p,reduction_block_0:g,reduction_block_1:v},E={};hd(e,0,1).forEach(function(I){E["main_block_"+I]=d(128,"middle_flow/main_block_"+I)});var w=h(128,256,"exit_flow/reduction_block"),C=c(256,512,"exit_flow/separable_conv"),S={reduction_block:w,separable_conv:C};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{entry_flow:b,middle_flow:E,exit_flow:S}}}function nW(n,e){var t=tu(n,e),r=UM(t),i=rw(t);function a(u){var c=i(u+"/separable_conv0"),h=i(u+"/separable_conv1"),d=r(u+"/expansion_conv");return{separable_conv0:c,separable_conv1:h,expansion_conv:d}}function s(u){var c=i(u+"/separable_conv0"),h=i(u+"/separable_conv1"),d=i(u+"/separable_conv2");return{separable_conv0:c,separable_conv1:h,separable_conv2:d}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:a,extractMainBlockParams:s}}function rW(n,e){var t=[],r=nW(n,t),i=r.extractConvParams,a=r.extractSeparableConvParams,s=r.extractReductionBlockParams,u=r.extractMainBlockParams,c=i("entry_flow/conv_in"),h=s("entry_flow/reduction_block_0"),d=s("entry_flow/reduction_block_1"),p={conv_in:c,reduction_block_0:h,reduction_block_1:d},g={};hd(e,0,1).forEach(function(w){g["main_block_"+w]=u("middle_flow/main_block_"+w)});var v=s("exit_flow/reduction_block"),b=a("exit_flow/separable_conv"),E={reduction_block:v,separable_conv:b};return Hs(n,t),{params:{entry_flow:p,middle_flow:g,exit_flow:E},paramMappings:t}}function KM(n,e,t){return ft(Hi(n,e.filters,t,"same"),e.bias)}function H_(n,e,t){t===void 0&&(t=!0);var r=t?un(n):n;return r=gi(r,e.separable_conv0,[1,1]),r=gi(un(r),e.separable_conv1,[1,1]),r=Zn(r,[3,3],[2,2],"same"),r=ft(r,KM(n,e.expansion_conv,[2,2])),r}function iW(n,e){var t=gi(un(n),e.separable_conv0,[1,1]);return t=gi(un(t),e.separable_conv1,[1,1]),t=gi(un(t),e.separable_conv2,[1,1]),t=ft(t,n),t}var aW=(function(n){nt(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Me(function(){var a=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],u=jd(a,s).div(Ae(256)),c=un(KM(u,i.entry_flow.conv_in,[2,2]));return c=H_(c,i.entry_flow.reduction_block_0,!1),c=H_(c,i.entry_flow.reduction_block_1),hd(r._numMainBlocks,0,1).forEach(function(h){c=iW(c,i.middle_flow["main_block_"+h])}),c=H_(c,i.exit_flow.reduction_block),c=un(gi(c,i.exit_flow.separable_conv,[1,1])),c})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return rW(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return tW(t,this._numMainBlocks)},e})(zs);function sW(n){var e=[],t=Gs(n),r=t.extractWeights,i=t.getRemainingWeights,a=tw(r,e),s=a(512,1,"fc/age"),u=a(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:u}}}}function oW(n){var e=[],t=tu(n,e);function r(a){var s=t(a+"/weights",2),u=t(a+"/bias",1);return{weights:s,bias:u}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Hs(n,e),{params:i,paramMappings:e}}var Fg;(function(n){n.FEMALE="female",n.MALE="male"})(Fg||(Fg={}));var uW=(function(n){nt(e,n);function e(t){t===void 0&&(t=new aW(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Me(function(){var a=t instanceof Pg?r.faceFeatureExtractor.forwardInput(t):t,s=Ld(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),u=Ua(s,i.fc.age).as1D(),c=Ua(s,i.fc.gender);return{age:u,gender:c}})},e.prototype.forwardInput=function(t){var r=this;return Me(function(){var i=r.runNet(t),a=i.age,s=i.gender;return{age:a,gender:js(s)}})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return ze(this,void 0,void 0,function(){var r,i,a,s,u,c,h=this;return He(this,function(d){switch(d.label){case 0:return[4,ir(t)];case 1:return r=d.sent(),[4,this.forwardInput(r)];case 2:return i=d.sent(),a=Hn(i.age),s=Hn(i.gender),u=a.map(function(p,g){return{ageTensor:p,genderTensor:s[g]}}),[4,Promise.all(u.map(function(p){var g=p.ageTensor,v=p.genderTensor;return ze(h,void 0,void 0,function(){var b,E,w,C,S;return He(this,function(I){switch(I.label){case 0:return[4,g.data()];case 1:return b=I.sent()[0],[4,v.data()];case 2:return E=I.sent()[0],w=E>.5,C=w?Fg.MALE:Fg.FEMALE,S=w?E:1-E,g.dispose(),v.dispose(),[2,{age:b,gender:C,genderProbability:S}]}})})}))];case 3:return c=d.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,a=r.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return sW(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=GM(t),i=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),oW(a)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),a=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},e})(zs),XM=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var a=i.map(function(u){var c=u.width,h=u.height,d=r/Math.max(h,c);return{width:c*d,height:h*d}}),s=a.length;return Me(function(){var u=function(g,v){return yi([Ka([68],g),Ka([68],v)],1).as2D(1,136).as1D()},c=function(g,v){var b=a[g],E=b.width,w=b.height;return v(E,w)?Math.abs(E-w)/2:0},h=function(g){return c(g,function(v,b){return v<b})},d=function(g){return c(g,function(v,b){return b<v})},p=t.mul(Ka([s,136],r)).sub(yi(Array.from(Array(s),function(g,v){return u(h(v),d(v))}))).div(yi(Array.from(Array(s),function(g,v){return u(a[v].width,a[v].height)})));return p})},e.prototype.forwardInput=function(t){var r=this;return Me(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(a){var s=a[0],u=a[1];return{height:s,width:u}}))})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return ze(this,void 0,void 0,function(){var r,i,a,s=this;return He(this,function(u){switch(u.label){case 0:return[4,ir(t)];case 1:return r=u.sent(),i=Me(function(){return Hn(s.forwardInput(r))}),[4,Promise.all(i.map(function(c,h){return ze(s,void 0,void 0,function(){var d,p,g,v,b;return He(this,function(E){switch(E.label){case 0:return g=(p=Array).from,[4,c.data()];case 1:return d=g.apply(p,[E.sent()]),v=d.filter(function(w,C){return hR(C)}),b=d.filter(function(w,C){return!hR(C)}),[2,new VG(Array(68).fill(0).map(function(w,C){return new Mt(v[C],b[C])}),{height:r.getInputHeight(h),width:r.getInputWidth(h)})]}})})}))];case 2:return a=u.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})(WM),YM=(function(n){nt(e,n);function e(t){return t===void 0&&(t=new HM),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(XM);function lW(n){var e=[],t=zM(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Hs(n,e),{params:r,paramMappings:e}}function cW(n){var e=[],t=Gs(n),r=t.extractWeights,i=t.getRemainingWeights,a=jM(r,e).extractDenseBlock3Params,s=a(3,32,"dense0",!0),u=a(32,64,"dense1"),c=a(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:u,dense2:c}}}var hW=(function(n){nt(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Me(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=jd(i,a).div(Ae(255)),u=z_(s,r.dense0,!0);return u=z_(u,r.dense1),u=z_(u,r.dense2),u=Ld(u,[14,14],[2,2],"valid"),u})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return lW(t)},e.prototype.extractParams=function(t){return cW(t)},e})(zs),fW=(function(n){nt(e,n);function e(t){return t===void 0&&(t=new hW),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(XM);(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(YM);function dW(n,e){return ft(Dr(n,e.weights),e.biases)}function aw(n,e,t,r,i){i===void 0&&(i="same");var a=e.conv,s=a.filters,u=a.bias,c=Hi(n,s,t,i);return c=ft(c,u),c=dW(c,e.scale),r?un(c):c}function pW(n,e){return aw(n,e,[1,1],!0)}function $M(n,e){return aw(n,e,[1,1],!1)}function QM(n,e){return aw(n,e,[2,2],!0,"valid")}function mW(n,e){function t(u,c,h){var d=n(u),p=d.length/(c*h*h);if(AG(p))throw new Error("depth has to be an integer: "+p+", weights.length: "+d.length+", numFilters: "+c+", filterSize: "+h);return Me(function(){return Ho(Yr(d,[c,p,h,h]),[2,3,1,0])})}function r(u,c,h,d){var p=t(u,c,h),g=Mn(n(c));return e.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:p,bias:g}}function i(u,c){var h=Mn(n(u)),d=Mn(n(u));return e.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:h,biases:d}}function a(u,c,h,d){var p=r(u,c,h,d+"/conv"),g=i(c,d+"/scale");return{conv:p,scale:g}}function s(u,c,h,d,p){p===void 0&&(p=!1);var g=a((p?.5:1)*u,c,h,d+"/conv1"),v=a(u,c,h,d+"/conv2");return{conv1:g,conv2:v}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function gW(n){var e=Gs(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],a=mW(t,i),s=a.extractConvLayerParams,u=a.extractResidualLayerParams,c=s(4704,32,7,"conv32_down"),h=u(9216,32,3,"conv32_1"),d=u(9216,32,3,"conv32_2"),p=u(9216,32,3,"conv32_3"),g=u(36864,64,3,"conv64_down",!0),v=u(36864,64,3,"conv64_1"),b=u(36864,64,3,"conv64_2"),E=u(36864,64,3,"conv64_3"),w=u(147456,128,3,"conv128_down",!0),C=u(147456,128,3,"conv128_1"),S=u(147456,128,3,"conv128_2"),I=u(589824,256,3,"conv256_down",!0),D=u(589824,256,3,"conv256_1"),O=u(589824,256,3,"conv256_2"),B=u(589824,256,3,"conv256_down_out"),N=Me(function(){return Ho(No(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var R={conv32_down:c,conv32_1:h,conv32_2:d,conv32_3:p,conv64_down:g,conv64_1:v,conv64_2:b,conv64_3:E,conv128_down:w,conv128_1:C,conv128_2:S,conv256_down:I,conv256_1:D,conv256_2:O,conv256_down_out:B,fc:N};return{params:R,paramMappings:i}}function vW(n,e){var t=tu(n,e);function r(s){var u=t(s+"/scale/weights",1),c=t(s+"/scale/biases",1);return{weights:u,biases:c}}function i(s){var u=t(s+"/conv/filters",4),c=t(s+"/conv/bias",1),h=r(s);return{conv:{filters:u,bias:c},scale:h}}function a(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function yW(n){var e=[],t=vW(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,a=r("conv32_down"),s=i("conv32_1"),u=i("conv32_2"),c=i("conv32_3"),h=i("conv64_down"),d=i("conv64_1"),p=i("conv64_2"),g=i("conv64_3"),v=i("conv128_down"),b=i("conv128_1"),E=i("conv128_2"),w=i("conv256_down"),C=i("conv256_1"),S=i("conv256_2"),I=i("conv256_down_out"),D=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!SG(D))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+D);var O={conv32_down:a,conv32_1:s,conv32_2:u,conv32_3:c,conv64_down:h,conv64_1:d,conv64_2:p,conv64_3:g,conv128_down:v,conv128_1:b,conv128_2:E,conv256_down:w,conv256_1:C,conv256_2:S,conv256_down_out:I,fc:D};return Hs(n,e),{params:O,paramMappings:e}}function Oa(n,e){var t=pW(n,e.conv1);return t=$M(t,e.conv2),t=ft(t,n),t=un(t),t}function jm(n,e){var t=QM(n,e.conv1);t=$M(t,e.conv2);var r=Ld(n,2,2,"valid"),i=$t(r.shape),a=r.shape[3]!==t.shape[3],s=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(s){var u=Wf(t.shape);u[1]=1;var c=$t(u);t=zn([t,c],1);var h=Wf(t.shape);h[2]=1;var d=$t(h);t=zn([t,d],2)}return r=a?zn([r,i],3):r,t=ft(r,t),t=un(t),t}var _W=(function(n){nt(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Me(function(){var i=t.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],s=jd(i,a).div(Ae(256)),u=QM(s,r.conv32_down);u=Zn(u,3,2,"valid"),u=Oa(u,r.conv32_1),u=Oa(u,r.conv32_2),u=Oa(u,r.conv32_3),u=jm(u,r.conv64_down),u=Oa(u,r.conv64_1),u=Oa(u,r.conv64_2),u=Oa(u,r.conv64_3),u=jm(u,r.conv128_down),u=Oa(u,r.conv128_1),u=Oa(u,r.conv128_2),u=jm(u,r.conv256_down),u=Oa(u,r.conv256_1),u=Oa(u,r.conv256_2),u=jm(u,r.conv256_down_out);var c=u.mean([1,2]),h=yv(c,r.fc);return h})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return ze(this,void 0,void 0,function(){var r,i,a,s=this;return He(this,function(u){switch(u.label){case 0:return[4,ir(t)];case 1:return r=u.sent(),i=Me(function(){return Hn(s.forwardInput(r))}),[4,Promise.all(i.map(function(c){return c.data()}))];case 2:return a=u.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return yW(t)},e.prototype.extractParams=function(t){return gW(t)},e})(zs);function ZM(n,e){var t={descriptor:e};return Object.assign({},n,t)}function JM(n,e){var t={age:e};return Object.assign({},n,t)}function e3(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var t3=(function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,a=t.maxNumScales,s=t.scoreThresholds,u=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=a||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=u,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n})();function bW(n,e){function t(c,h){var d=Yr(n(9*c),[3,3,c,1]),p=Mn(n(c)),g=Mn(n(c)),v=Mn(n(c)),b=Mn(n(c));return e.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:d,batch_norm_scale:p,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:b}}function r(c,h,d,p,g){var v=Yr(n(c*h*d*d),[d,d,c,h]),b=Mn(n(h));return e.push({paramPath:p+"/filters"},{paramPath:p+"/"+(g?"batch_norm_offset":"bias")}),{filters:v,bias:b}}function i(c,h,d,p){var g=r(c,h,d,p,!0),v=g.filters,b=g.bias;return{filters:v,batch_norm_offset:b}}function a(c,h,d){var p=t(c,d+"/depthwise_conv"),g=i(c,h,1,d+"/pointwise_conv");return{depthwise_conv:p,pointwise_conv:g}}function s(){var c=i(3,32,3,"mobilenetv1/conv_0"),h=a(32,64,"mobilenetv1/conv_1"),d=a(64,128,"mobilenetv1/conv_2"),p=a(128,128,"mobilenetv1/conv_3"),g=a(128,256,"mobilenetv1/conv_4"),v=a(256,256,"mobilenetv1/conv_5"),b=a(256,512,"mobilenetv1/conv_6"),E=a(512,512,"mobilenetv1/conv_7"),w=a(512,512,"mobilenetv1/conv_8"),C=a(512,512,"mobilenetv1/conv_9"),S=a(512,512,"mobilenetv1/conv_10"),I=a(512,512,"mobilenetv1/conv_11"),D=a(512,1024,"mobilenetv1/conv_12"),O=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:h,conv_2:d,conv_3:p,conv_4:g,conv_5:v,conv_6:b,conv_7:E,conv_8:w,conv_9:C,conv_10:S,conv_11:I,conv_12:D,conv_13:O}}function u(){var c=i(1024,256,1,"prediction_layer/conv_0"),h=i(256,512,3,"prediction_layer/conv_1"),d=i(512,128,1,"prediction_layer/conv_2"),p=i(128,256,3,"prediction_layer/conv_3"),g=i(256,128,1,"prediction_layer/conv_4"),v=i(128,256,3,"prediction_layer/conv_5"),b=i(256,64,1,"prediction_layer/conv_6"),E=i(64,128,3,"prediction_layer/conv_7"),w=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),C=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),S=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),I=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),D=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),O=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),B=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),N=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),R=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),k=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),P=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),V=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),j={box_encoding_predictor:w,class_predictor:C},L={box_encoding_predictor:S,class_predictor:I},Z={box_encoding_predictor:D,class_predictor:O},ne={box_encoding_predictor:B,class_predictor:N},q={box_encoding_predictor:R,class_predictor:k},X={box_encoding_predictor:P,class_predictor:V};return{conv_0:c,conv_1:h,conv_2:d,conv_3:p,conv_4:g,conv_5:v,conv_6:b,conv_7:E,box_predictor_0:j,box_predictor_1:L,box_predictor_2:Z,box_predictor_3:ne,box_predictor_4:q,box_predictor_5:X}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:u}}function xW(n){var e=[],t=Gs(n),r=t.extractWeights,i=t.getRemainingWeights,a=bW(r,e),s=a.extractMobilenetV1Params,u=a.extractPredictionLayerParams,c=s(),h=u(),d=xx(r(5118*4),[1,5118,4]),p={extra_dim:d};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:h,output_layer:p},paramMappings:e}}function wW(n,e){var t=tu(n,e);function r(h,d,p){var g=t(h+"/Conv2d_"+d+"_pointwise/weights",4,p+"/filters"),v=t(h+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,p+"/batch_norm_offset");return{filters:g,batch_norm_offset:v}}function i(h){var d="mobilenetv1/conv_"+h,p="MobilenetV1/Conv2d_"+h+"_depthwise",g=d+"/depthwise_conv",v=d+"/pointwise_conv",b=t(p+"/depthwise_weights",4,g+"/filters"),E=t(p+"/BatchNorm/gamma",1,g+"/batch_norm_scale"),w=t(p+"/BatchNorm/beta",1,g+"/batch_norm_offset"),C=t(p+"/BatchNorm/moving_mean",1,g+"/batch_norm_mean"),S=t(p+"/BatchNorm/moving_variance",1,g+"/batch_norm_variance");return{depthwise_conv:{filters:b,batch_norm_scale:E,batch_norm_offset:w,batch_norm_mean:C,batch_norm_variance:S},pointwise_conv:r("MobilenetV1",h,v)}}function a(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(h,d){var p=t(h+"/weights",4,d+"/filters"),g=t(h+"/biases",1,d+"/bias");return{filters:p,bias:g}}function u(h){var d=s("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),p=s("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:d,class_predictor:p}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:u(0),box_predictor_1:u(1),box_predictor_2:u(2),box_predictor_3:u(3),box_predictor_4:u(4),box_predictor_5:u(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:c}}function EW(n){var e=[],t=wW(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,a=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!wv(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:a}};return Hs(n,e),{params:s,paramMappings:e}}function Pa(n,e,t){return Me(function(){var r=Hi(n,e.filters,t,"same");return r=ft(r,e.batch_norm_offset),kx(r,0,6)})}var TW=.0010000000474974513;function CW(n,e,t){return Me(function(){var r=vv(n,e.filters,t,"same");return r=Yk(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,TW),kx(r,0,6)})}function SW(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function AW(n,e){return Me(function(){var t=null,r=Pa(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(a,s){var u=s+1,c=SW(u);r=CW(r,a.depthwise_conv,c),r=Pa(r,a.pointwise_conv,[1,1]),u===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function RW(n,e,t,r,i){var a=n.shape[0],s=Math.min(t,a),u=e.map(function(d,p){return{score:d,boxIndex:p}}).filter(function(d){return d.score>i}).sort(function(d,p){return p.score-d.score}),c=function(d){return d<=r?1:0},h=[];return u.forEach(function(d){if(!(h.length>=s)){for(var p=d.score,g=h.length-1;g>=0;--g){var v=IW(n,d.boxIndex,h[g]);if(v!==0&&(d.score*=c(v),d.score<=i))break}p===d.score&&h.push(d.boxIndex)}}),h}function IW(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),a=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),u=Math.max(r[e][1],r[e][3]),c=Math.min(r[t][0],r[t][2]),h=Math.min(r[t][1],r[t][3]),d=Math.max(r[t][0],r[t][2]),p=Math.max(r[t][1],r[t][3]),g=(s-i)*(u-a),v=(d-c)*(p-h);if(g<=0||v<=0)return 0;var b=Math.max(i,c),E=Math.max(a,h),w=Math.min(s,d),C=Math.min(u,p),S=Math.max(w-b,0)*Math.max(C-E,0);return S/(g+v-S)}function NW(n){var e=Hn(Ho(n,[1,0])),t=[qn(e[2],e[0]),qn(e[3],e[1])],r=[ft(e[0],ra(t[0],Ae(2))),ft(e[1],ra(t[1],Ae(2)))];return{sizes:t,centers:r}}function DW(n,e){var t=NW(n),r=t.sizes,i=t.centers,a=Hn(Ho(e,[1,0])),s=ra(Dr(Gb(ra(a[2],Ae(5))),r[0]),Ae(2)),u=ft(Dr(ra(a[0],Ae(10)),r[0]),i[0]),c=ra(Dr(Gb(ra(a[3],Ae(5))),r[1]),Ae(2)),h=ft(Dr(ra(a[1],Ae(10)),r[1]),i[1]);return Ho(yi([qn(u,s),qn(h,c),ft(u,s),ft(h,c)]),[1,0])}function kW(n,e,t){return Me(function(){var r=n.shape[0],i=DW(aa(Dc(t.extra_dim,[r,1,1]),[-1,4]),aa(n,[-1,4]));i=aa(i,[r,i.shape[0]/r,4]);var a=Wk(Za(e,[0,0,1],[-1,-1,-1])),s=Za(a,[0,0,0],[-1,-1,1]);s=aa(s,[r,s.shape[1]]);var u=Hn(i),c=Hn(s);return{boxes:u,scores:c}})}function lc(n,e){return Me(function(){var t=n.shape[0],r=aa(oa(n,e.box_encoding_predictor),[t,-1,1,4]),i=aa(oa(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function MW(n,e,t){return Me(function(){var r=Pa(n,t.conv_0,[1,1]),i=Pa(r,t.conv_1,[2,2]),a=Pa(i,t.conv_2,[1,1]),s=Pa(a,t.conv_3,[2,2]),u=Pa(s,t.conv_4,[1,1]),c=Pa(u,t.conv_5,[2,2]),h=Pa(c,t.conv_6,[1,1]),d=Pa(h,t.conv_7,[2,2]),p=lc(e,t.box_predictor_0),g=lc(n,t.box_predictor_1),v=lc(i,t.box_predictor_2),b=lc(s,t.box_predictor_3),E=lc(c,t.box_predictor_4),w=lc(d,t.box_predictor_5),C=zn([p.boxPredictionEncoding,g.boxPredictionEncoding,v.boxPredictionEncoding,b.boxPredictionEncoding,E.boxPredictionEncoding,w.boxPredictionEncoding],1),S=zn([p.classPrediction,g.classPrediction,v.classPrediction,b.classPrediction,E.classPrediction,w.classPrediction],1);return{boxPredictions:C,classPredictions:S}})}var Sv=(function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n})(),n3=(function(n){nt(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Me(function(){var i=t.toBatchTensor(512,!1).toFloat(),a=qn(Dr(i,Ae(.007843137718737125)),Ae(1)),s=AW(a,r.mobilenetv1),u=MW(s.out,s.conv11,r.prediction_layer),c=u.boxPredictions,h=u.classPredictions;return kW(c,h,r.output_layer)})},e.prototype.forward=function(t){return ze(this,void 0,void 0,function(){var r;return He(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,ir(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i,a,s,u,c,h,d,p,g,v,b,E,w,C,S,I,D,O,B,N,R;return He(this,function(k){switch(k.label){case 0:return i=new Sv(r),a=i.maxResults,s=i.minConfidence,[4,ir(t)];case 1:for(u=k.sent(),c=this.forwardInput(u),h=c.boxes,d=c.scores,p=h[0],g=d[0],v=1;v<h.length;v++)h[v].dispose(),d[v].dispose();return w=(E=Array).from,[4,g.data()];case 2:return b=w.apply(E,[k.sent()]),C=.5,S=RW(p,b,a,C,s),I=u.getReshapedInputDimensions(0),D=u.inputSize,O=D/I.width,B=D/I.height,N=p.arraySync(),R=S.map(function(P){var V=[Math.max(0,N[P][0]),Math.min(1,N[P][2])].map(function(X){return X*B}),j=V[0],L=V[1],Z=[Math.max(0,N[P][1]),Math.min(1,N[P][3])].map(function(X){return X*O}),ne=Z[0],q=Z[1];return new rs(b[P],new Yx(ne,j,q-ne,L-j),{height:u.getInputHeight(0),width:u.getInputWidth(0)})}),p.dispose(),g.dispose(),[2,R]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return EW(t)},e.prototype.extractParams=function(t){return xW(t)},e})(zs);(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(n3);var OW=.4,PW=[new Mt(.738768,.874946),new Mt(2.42204,2.65704),new Mt(4.30971,7.04493),new Mt(10.246,4.59428),new Mt(12.6868,11.8741)],FW=[new Mt(1.603231,2.094468),new Mt(6.041143,7.080126),new Mt(2.882459,3.518061),new Mt(4.266906,5.178857),new Mt(9.041765,10.66308)],VW=[117.001,114.697,97.404],LW="tiny_yolov2_model",BW="tiny_yolov2_separable_conv_model",Um=function(n){return typeof n=="number"};function jW(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Um(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return Um(e.x)&&Um(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(Um)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function sw(n){return Me(function(){var e=Dr(n,Ae(.10000000149011612));return ft(un(qn(n,e)),e)})}function To(n,e){return Me(function(){var t=ul(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Hi(t,e.conv.filters,[1,1],"valid"),t=qn(t,e.bn.sub),t=Dr(t,e.bn.truediv),t=ft(t,e.conv.bias),sw(t)})}function Co(n,e){return Me(function(){var t=ul(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Fx(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=ft(t,e.bias),sw(t)})}function UW(n,e){var t=Cv(n,e);function r(s,u){var c=Mn(n(s)),h=Mn(n(s));return e.push({paramPath:u+"/sub"},{paramPath:u+"/truediv"}),{sub:c,truediv:h}}function i(s,u,c){var h=t(s,u,3,c+"/conv"),d=r(u,c+"/bn");return{conv:h,bn:d}}var a=nw(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function zW(n,e,t,r){var i=Gs(n),a=i.extractWeights,s=i.getRemainingWeights,u=[],c=UW(a,u),h=c.extractConvParams,d=c.extractConvWithBatchNormParams,p=c.extractSeparableConvParams,g;if(e.withSeparableConvs){var v=r[0],b=r[1],E=r[2],w=r[3],C=r[4],S=r[5],I=r[6],D=r[7],O=r[8],B=e.isFirstLayerConv2d?h(v,b,3,"conv0"):p(v,b,"conv0"),N=p(b,E,"conv1"),R=p(E,w,"conv2"),k=p(w,C,"conv3"),P=p(C,S,"conv4"),V=p(S,I,"conv5"),j=D?p(I,D,"conv6"):void 0,L=O?p(D,O,"conv7"):void 0,Z=h(O||D||I,5*t,1,"conv8");g={conv0:B,conv1:N,conv2:R,conv3:k,conv4:P,conv5:V,conv6:j,conv7:L,conv8:Z}}else{var v=r[0],b=r[1],E=r[2],w=r[3],C=r[4],S=r[5],I=r[6],D=r[7],O=r[8],B=d(v,b,"conv0"),N=d(b,E,"conv1"),R=d(E,w,"conv2"),k=d(w,C,"conv3"),P=d(C,S,"conv4"),V=d(S,I,"conv5"),j=d(I,D,"conv6"),L=d(D,O,"conv7"),Z=h(O,5*t,1,"conv8");g={conv0:B,conv1:N,conv2:R,conv3:k,conv4:P,conv5:V,conv6:j,conv7:L,conv8:Z}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:g,paramMappings:u}}function HW(n,e){var t=tu(n,e);function r(u){var c=t(u+"/sub",1),h=t(u+"/truediv",1);return{sub:c,truediv:h}}function i(u){var c=t(u+"/filters",4),h=t(u+"/bias",1);return{filters:c,bias:h}}function a(u){var c=i(u+"/conv"),h=r(u+"/bn");return{conv:c,bn:h}}var s=rw(t);return{extractConvParams:i,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function GW(n,e){var t=[],r=HW(n,t),i=r.extractConvParams,a=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams,u;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;u={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else u={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return Hs(n,t),{params:u,paramMappings:t}}var _R;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(_R||(_R={}));var ow=(function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n})(),r3=(function(n){nt(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return jW(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=To(t,r.conv0);return i=Zn(i,[2,2],[2,2],"same"),i=To(i,r.conv1),i=Zn(i,[2,2],[2,2],"same"),i=To(i,r.conv2),i=Zn(i,[2,2],[2,2],"same"),i=To(i,r.conv3),i=Zn(i,[2,2],[2,2],"same"),i=To(i,r.conv4),i=Zn(i,[2,2],[2,2],"same"),i=To(i,r.conv5),i=Zn(i,[2,2],[1,1],"same"),i=To(i,r.conv6),i=To(i,r.conv7),oa(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?sw(oa(t,r.conv0,"valid",!1)):Co(t,r.conv0);return i=Zn(i,[2,2],[2,2],"same"),i=Co(i,r.conv1),i=Zn(i,[2,2],[2,2],"same"),i=Co(i,r.conv2),i=Zn(i,[2,2],[2,2],"same"),i=Co(i,r.conv3),i=Zn(i,[2,2],[2,2],"same"),i=Co(i,r.conv4),i=Zn(i,[2,2],[2,2],"same"),i=Co(i,r.conv5),i=Zn(i,[2,2],[1,1],"same"),i=r.conv6?Co(i,r.conv6):i,i=r.conv7?Co(i,r.conv7):i,oa(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return Me(function(){var s=t.toBatchTensor(r,!1).toFloat();return s=i.config.meanRgb?jd(s,i.config.meanRgb):s,s=s.div(Ae(256)),i.config.withSeparableConvs?i.runMobilenet(s,a):i.runTinyYolov2(s,a)})},e.prototype.forward=function(t,r){return ze(this,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,ir(t)];case 1:return[4,i.apply(this,[a.sent(),r])];case 2:return[2,a.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i,a,s,u,c,h,d,p,g,v,b,E,w,C,S=this;return He(this,function(I){switch(I.label){case 0:return i=new ow(r),a=i.inputSize,s=i.scoreThreshold,[4,ir(t)];case 1:return u=I.sent(),[4,this.forwardInput(u,a)];case 2:return c=I.sent(),h=Me(function(){return Hn(c)[0].expandDims()}),d={width:u.getInputWidth(0),height:u.getInputHeight(0)},[4,this.extractBoxes(h,u.getReshapedInputDimensions(0),s)];case 3:return p=I.sent(),c.dispose(),h.dispose(),g=p.map(function(D){return D.box}),v=p.map(function(D){return D.score}),b=p.map(function(D){return D.classScore}),E=p.map(function(D){return S.config.classes[D.label]}),w=fd(g.map(function(D){return D.rescale(a)}),v,this.config.iouThreshold,!0),C=w.map(function(D){return new IM(v[D],b[D],E[D],g[D],d)}),[2,C]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return GW(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return zW(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return ze(this,void 0,void 0,function(){var a,s,u,c,h,d,p,g,v,b,E,w,C,S,I,D,O,B,N,R,k,P,V,j,L,Z,ne,q,X,ee=this;return He(this,function(ue){switch(ue.label){case 0:return a=r.width,s=r.height,u=Math.max(a,s),c=u/a,h=u/s,d=t.shape[1],p=this.config.anchors.length,g=Me(function(){var fe=t.reshape([d,d,p,ee.boxEncodingSize]),W=fe.slice([0,0,0,0],[d,d,p,4]),$=fe.slice([0,0,0,4],[d,d,p,1]),ce=ee.withClassScores?js(fe.slice([0,0,0,5],[d,d,p,ee.config.classes.length]),3):Ae(0);return[W,$,ce]}),v=g[0],b=g[1],E=g[2],w=[],[4,b.array()];case 1:return C=ue.sent(),[4,v.array()];case 2:S=ue.sent(),I=0,ue.label=3;case 3:if(!(I<d))return[3,12];D=0,ue.label=4;case 4:if(!(D<d))return[3,11];O=0,ue.label=5;case 5:return O<p?(B=U_(C[I][D][O][0]),!i||B>i?(N=(D+U_(S[I][D][O][0]))/d*c,R=(I+U_(S[I][D][O][1]))/d*h,k=Math.exp(S[I][D][O][2])*this.config.anchors[O].x/d*c,P=Math.exp(S[I][D][O][3])*this.config.anchors[O].y/d*h,V=N-k/2,j=R-P/2,L={row:I,col:D,anchor:O},this.withClassScores?[4,this.extractPredictedClass(E,L)]:[3,7]):[3,9]):[3,10];case 6:return X=ue.sent(),[3,8];case 7:X={classScore:1,label:0},ue.label=8;case 8:Z=X,ne=Z.classScore,q=Z.label,w.push(Tr({box:new Ev(V,j,V+k,j+P),score:B,classScore:B*ne,label:q},L)),ue.label=9;case 9:return O++,[3,5];case 10:return D++,[3,4];case 11:return I++,[3,3];case 12:return v.dispose(),b.dispose(),E.dispose(),[2,w]}})})},e.prototype.extractPredictedClass=function(t,r){return ze(this,void 0,void 0,function(){var i,a,s,u;return He(this,function(c){switch(c.label){case 0:return i=r.row,a=r.col,s=r.anchor,[4,t.array()];case 1:return u=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(h,d){return u[i][a][s][d]}).map(function(h,d){return{classScore:h,label:d}}).reduce(function(h,d){return h.classScore>d.classScore?h:d})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(zs),WW=(function(n){nt(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:OW,classes:["face"]},t?{anchors:FW,meanRgb:VW}:{anchors:PW,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ze(this,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return[4,this.detect(t,r)];case 1:return i=a.sent(),[2,i.map(function(s){return new rs(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?BW:LW},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(r3),i3=(function(n){nt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(ow),Ud=(function(){function n(){}return n.prototype.then=function(e){return ze(this,void 0,void 0,function(){var t;return He(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return ze(this,void 0,void 0,function(){return He(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n})();function Av(n,e,t,r,i){return i===void 0&&(i=function(a){var s=a.alignedRect;return s}),ze(this,void 0,void 0,function(){var a,s,u,c,h;return He(this,function(d){switch(d.label){case 0:return a=n.map(function(p){return JG(p)?i(p):p.detection}),u=r,u?[3,5]:e instanceof sn?[4,ew(e,a)]:[3,2];case 1:return c=d.sent(),[3,4];case 2:return[4,Jx(e,a)];case 3:c=d.sent(),d.label=4;case 4:u=c,d.label=5;case 5:return s=u,[4,t(s)];case 6:return h=d.sent(),s.forEach(function(p){return p instanceof sn&&p.dispose()}),[2,h]}})})}function uw(n,e,t,r,i){return ze(this,void 0,void 0,function(){var a=this;return He(this,function(s){return[2,Av([n],e,function(u){return ze(a,void 0,void 0,function(){return He(this,function(c){return[2,t(u[0])]})})},r,i)]})})}function qW(n){return Me(function(){return yi(Hn(n,3).reverse(),3)})}var zm=2,Vg=12;function KW(n,e){var t=Cv(n,e),r=tw(n,e);function i(h,d){var p=Mn(n(h));return e.push({paramPath:d}),p}function a(h,d,p){p===void 0&&(p=!1);var g=t(h[0],h[1],3,d+"/conv1"),v=i(h[1],d+"/prelu1_alpha"),b=t(h[1],h[2],3,d+"/conv2"),E=i(h[2],d+"/prelu2_alpha"),w=t(h[2],h[3],p?2:3,d+"/conv3"),C=i(h[3],d+"/prelu3_alpha");return{conv1:g,prelu1_alpha:v,conv2:b,prelu2_alpha:E,conv3:w,prelu3_alpha:C}}function s(){var h=a([3,10,16,32],"pnet"),d=t(32,2,1,"pnet/conv4_1"),p=t(32,4,1,"pnet/conv4_2");return Tr(Tr({},h),{conv4_1:d,conv4_2:p})}function u(){var h=a([3,28,48,64],"rnet",!0),d=r(576,128,"rnet/fc1"),p=i(128,"rnet/prelu4_alpha"),g=r(128,2,"rnet/fc2_1"),v=r(128,4,"rnet/fc2_2");return Tr(Tr({},h),{fc1:d,prelu4_alpha:p,fc2_1:g,fc2_2:v})}function c(){var h=a([3,32,64,64],"onet"),d=t(64,128,2,"onet/conv4"),p=i(128,"onet/prelu4_alpha"),g=r(1152,256,"onet/fc1"),v=i(256,"onet/prelu5_alpha"),b=r(256,2,"onet/fc2_1"),E=r(256,4,"onet/fc2_2"),w=r(256,10,"onet/fc2_3");return Tr(Tr({},h),{conv4:d,prelu4_alpha:p,fc1:g,prelu5_alpha:v,fc2_1:b,fc2_2:E,fc2_3:w})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function XW(n){var e=Gs(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],a=KW(t,i),s=a.extractPNetParams,u=a.extractRNetParams,c=a.extractONetParams,h=s(),d=u(),p=c();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:h,rnet:d,onet:p},paramMappings:i}}function YW(n,e){var t=tu(n,e);function r(d){var p=t(d+"/weights",4,d+"/filters"),g=t(d+"/bias",1);return{filters:p,bias:g}}function i(d){var p=t(d+"/weights",2),g=t(d+"/bias",1);return{weights:p,bias:g}}function a(d){return t(d,1)}function s(d){var p=r(d+"/conv1"),g=a(d+"/prelu1_alpha"),v=r(d+"/conv2"),b=a(d+"/prelu2_alpha"),E=r(d+"/conv3"),w=a(d+"/prelu3_alpha");return{conv1:p,prelu1_alpha:g,conv2:v,prelu2_alpha:b,conv3:E,prelu3_alpha:w}}function u(){var d=s("pnet"),p=r("pnet/conv4_1"),g=r("pnet/conv4_2");return Tr(Tr({},d),{conv4_1:p,conv4_2:g})}function c(){var d=s("rnet"),p=i("rnet/fc1"),g=a("rnet/prelu4_alpha"),v=i("rnet/fc2_1"),b=i("rnet/fc2_2");return Tr(Tr({},d),{fc1:p,prelu4_alpha:g,fc2_1:v,fc2_2:b})}function h(){var d=s("onet"),p=r("onet/conv4"),g=a("onet/prelu4_alpha"),v=i("onet/fc1"),b=a("onet/prelu5_alpha"),E=i("onet/fc2_1"),w=i("onet/fc2_2"),C=i("onet/fc2_3");return Tr(Tr({},d),{conv4:p,prelu4_alpha:g,fc1:v,prelu5_alpha:b,fc2_1:E,fc2_2:w,fc2_3:C})}return{extractPNetParams:u,extractRNetParams:c,extractONetParams:h}}function $W(n){var e=[],t=YW(n,e),r=t.extractPNetParams,i=t.extractRNetParams,a=t.extractONetParams,s=r(),u=i(),c=a();return Hs(n,e),{params:{pnet:s,rnet:u,onet:c},paramMappings:e}}function Zb(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function QW(n,e,t){for(var r=t[0],i=t[1],a=Vg/n,s=[],u=Math.min(r,i)*a,c=0;u>=12;)s.push(a*Math.pow(e,c)),u=u*e,c+=1;return s}var lw=(function(n){nt(e,n);function e(t,r,i,a){return n.call(this,{left:t,top:r,right:i,bottom:a},!0)||this}return e})(Go);function a3(n){return Me(function(){return Dr(qn(n,Ae(127.5)),Ae(.0078125))})}function Vc(n,e){return Me(function(){return ft(un(n),Dr(e,Ng(un(Ng(n)))))})}function cw(n,e,t){return t===void 0&&(t=!1),Me(function(){var r=oa(n,e.conv1,"valid");return r=Vc(r,e.prelu1_alpha),r=Zn(r,t?[2,2]:[3,3],[2,2],"same"),r=oa(r,e.conv2,"valid"),r=Vc(r,e.prelu2_alpha),r=t?r:Zn(r,[3,3],[2,2],"valid"),r=oa(r,e.conv3,"valid"),r=Vc(r,e.prelu3_alpha),r})}function ZW(n,e){return Me(function(){var t=cw(n,e,!0),r=oa(t,e.conv4_1,"valid"),i=Oi(_v(r,3),3),a=js(qn(r,i),3),s=oa(t,e.conv4_2,"valid");return{prob:a,regions:s}})}function JW(n,e){return Me(function(){var t=Zb(e,n.shape.slice(1)),r=t.height,i=t.width,a=Ux.resizeBilinear(n,[r,i]),s=a3(a);return Ho(s,[0,2,1,3])})}function eq(n,e,t,r){for(var i=[],a=n.arraySync(),s=0;s<n.shape[0];s++)for(var u=0;u<n.shape[1];u++)a[s][u]>=r&&i.push(new Mt(u,s));var c=i.map(function(h){var d=new Ev(Math.round((h.y*zm+1)/t),Math.round((h.x*zm+1)/t),Math.round((h.y*zm+Vg)/t),Math.round((h.x*zm+Vg)/t)),p=a[h.y][h.x],g=e.arraySync(),v=new lw(g[h.y][h.x][0],g[h.y][h.x][1],g[h.y][h.x][2],g[h.y][h.x][3]);return{cell:d,score:p,region:v}});return c}function tq(n,e,t,r,i){i.stage1=[];var a=e.map(function(g){return Me(function(){var v={scale:g},b=JW(n,g),E=Date.now(),w=ZW(b,r),C=w.prob,S=w.regions;v.pnet=Date.now()-E;var I=Hn(Hn(C,3)[1])[0],D=Hn(S)[0];return{scoresTensor:I,regionsTensor:D,scale:g,statsForScale:v}})}),s=a.map(function(g){var v=g.scoresTensor,b=g.regionsTensor,E=g.scale,w=g.statsForScale,C=eq(v,b,E,t);if(v.dispose(),b.dispose(),!C.length)return i.stage1.push(w),[];var S=Date.now(),I=fd(C.map(function(D){return D.cell}),C.map(function(D){return D.score}),.5);return w.nms=Date.now()-S,w.numBoxes=I.length,i.stage1.push(w),I.map(function(D){return C[D]})}),u=s.reduce(function(g,v){return g.concat(v)},[]),c=[],h=[];if(u.length>0){var d=Date.now(),p=fd(u.map(function(g){return g.cell}),u.map(function(g){return g.score}),.7);i.stage1_nms=Date.now()-d,h=p.map(function(g){return u[g].score}),c=p.map(function(g){return u[g]}).map(function(g){var v=g.cell,b=g.region;return new Ev(v.left+b.left*v.width,v.top+b.top*v.height,v.right+b.right*v.width,v.bottom+b.bottom*v.height).toSquare().round()})}return{boxes:c,scores:h}}function s3(n,e,t){var r=t.width,i=t.height;return ze(this,void 0,void 0,function(){var a,s,u,c=this;return He(this,function(h){switch(h.label){case 0:return a=tl(n),[4,Promise.all(e.map(function(d){return ze(c,void 0,void 0,function(){var p,g,v,b,E,w,C,S;return He(this,function(I){return p=d.padAtBorders(n.height,n.width),g=p.y,v=p.ey,b=p.x,E=p.ex,w=b-1,C=g-1,S=a.getImageData(w,C,E-w,v-C),[2,Mr.isNodejs()?Zx(S):createImageBitmap(S)]})})}))];case 1:return s=h.sent(),u=[],s.forEach(function(d){var p=Tv({width:r,height:i}),g=tl(p);g.drawImage(d,0,0,r,i);for(var v=g.getImageData(0,0,r,i).data,b=[],E=0;E<v.length;E+=4)b.push(v[E+2]),b.push(v[E+1]),b.push(v[E]);u.push(b)}),[2,u.map(function(d){var p=Me(function(){var g=Ho(Yr(d,[1,r,i,3]),[0,2,1,3]).toFloat();return a3(g)});return p})]}})})}function nq(n,e){return Me(function(){var t=cw(n,e),r=aa(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Ua(r,e.fc1),a=Vc(i,e.prelu4_alpha),s=Ua(a,e.fc2_1),u=Oi(_v(s,1),1),c=js(qn(s,u),1),h=Ua(a,e.fc2_2),d=Hn(c,1)[1];return{scores:d,regions:h}})}function rq(n,e,t,r,i){return ze(this,void 0,void 0,function(){var a,s,u,c,h,d,p,g,v,b,E,w,C,S;return He(this,function(I){switch(I.label){case 0:return a=Date.now(),[4,s3(n,e,{width:24,height:24})];case 1:return s=I.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),u=s.map(function(D){var O=nq(D,r);return D.dispose(),O}),i.stage2_rnet=Date.now()-a,c=u.length>1?zn(u.map(function(D){return D.scores})):u[0].scores,p=(d=Array).from,[4,c.data()];case 2:return h=p.apply(d,[I.sent()]),c.dispose(),g=h.map(function(D,O){return{score:D,idx:O}}).filter(function(D){return D.score>t}).map(function(D){var O=D.idx;return O}),v=g.map(function(D){return e[D]}),b=g.map(function(D){return h[D]}),E=[],w=[],v.length>0&&(a=Date.now(),C=fd(v,b,.7),i.stage2_nms=Date.now()-a,S=C.map(function(D){var O=u[g[D]].regions.arraySync();return new lw(O[0][0],O[0][1],O[0][2],O[0][3])}),w=C.map(function(D){return b[D]}),E=C.map(function(D,O){return v[D].calibrate(S[O])})),u.forEach(function(D){D.regions.dispose(),D.scores.dispose()}),[2,{boxes:E,scores:w}]}})})}function iq(n,e){return Me(function(){var t=cw(n,e);t=Zn(t,[2,2],[2,2],"same"),t=oa(t,e.conv4,"valid"),t=Vc(t,e.prelu4_alpha);var r=aa(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Ua(r,e.fc1),a=Vc(i,e.prelu5_alpha),s=Ua(a,e.fc2_1),u=Oi(_v(s,1),1),c=js(qn(s,u),1),h=Ua(a,e.fc2_2),d=Ua(a,e.fc2_3),p=Hn(c,1)[1];return{scores:p,regions:h,points:d}})}function aq(n,e,t,r,i){return ze(this,void 0,void 0,function(){var a,s,u,c,h,d,p,g,v,b,E,w,C,S,I;return He(this,function(D){switch(D.label){case 0:return a=Date.now(),[4,s3(n,e,{width:48,height:48})];case 1:return s=D.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),u=s.map(function(O){var B=iq(O,r);return O.dispose(),B}),i.stage3_onet=Date.now()-a,c=u.length>1?zn(u.map(function(O){return O.scores})):u[0].scores,p=(d=Array).from,[4,c.data()];case 2:return h=p.apply(d,[D.sent()]),c.dispose(),g=h.map(function(O,B){return{score:O,idx:B}}).filter(function(O){return O.score>t}).map(function(O){var B=O.idx;return B}),v=g.map(function(O){var B=u[O].regions.arraySync();return new lw(B[0][0],B[0][1],B[0][2],B[0][3])}),b=g.map(function(O,B){return e[O].calibrate(v[B])}),E=g.map(function(O){return h[O]}),w=[],C=[],S=[],b.length>0&&(a=Date.now(),I=fd(b,E,.7,!1),i.stage3_nms=Date.now()-a,w=I.map(function(O){return b[O]}),C=I.map(function(O){return E[O]}),S=I.map(function(O,B){return Array(5).fill(0).map(function(N,R){var k=u[O].points.arraySync();return new Mt(k[0][R]*(w[B].width+1)+w[B].left,k[0][R+5]*(w[B].height+1)+w[B].top)})})),u.forEach(function(O){O.regions.dispose(),O.scores.dispose(),O.points.dispose()}),[2,{boxes:w,scores:C,points:S}]}})})}var sq=(function(n){nt(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return ze(this,void 0,void 0,function(){return He(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return ze(this,void 0,void 0,function(){return He(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i,a,s,u,c,h,d,p,g,v,b,E,w,C,S,I,D,O,B,N,R;return He(this,function(k){switch(k.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(a=t.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},u=Date.now(),c=Me(function(){return qW(Oi(Kx.fromPixels(a)).toFloat())}),h=function(P){return c.dispose(),s.total=Date.now()-u,P},d=c.shape.slice(1),p=d[0],g=d[1],v=new t3(r),b=v.minFaceSize,E=v.scaleFactor,w=v.maxNumScales,C=v.scoreThresholds,S=v.scaleSteps,I=(S||QW(b,E,[p,g])).filter(function(P){var V=Zb(P,[p,g]);return Math.min(V.width,V.height)>Vg}).slice(0,w),s.scales=I,s.pyramid=I.map(function(P){return Zb(P,[p,g])}),D=Date.now(),[4,tq(c,I,C[0],i.pnet,s)];case 1:return O=k.sent(),s.total_stage1=Date.now()-D,O.boxes.length?(s.stage2_numInputBoxes=O.boxes.length,D=Date.now(),[4,rq(a,O.boxes,C[1],i.rnet,s)]):[2,h({results:[],stats:s})];case 2:return B=k.sent(),s.total_stage2=Date.now()-D,B.boxes.length?(s.stage3_numInputBoxes=B.boxes.length,D=Date.now(),[4,aq(a,B.boxes,C[2],i.onet,s)]):[2,h({results:[],stats:s})];case 3:return N=k.sent(),s.total_stage3=Date.now()-D,R=N.boxes.map(function(P,V){return iw($x({},new rs(N.scores[V],new Yx(P.left/g,P.top/p,P.width/g,P.height/p),{height:p,width:g})),new FG(N.points[V].map(function(j){return j.sub(new Mt(P.left,P.top)).div(new Mt(P.width,P.height))}),{width:P.width,height:P.height}))}),[2,h({results:R,stats:s})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,ir(t)];case 1:return[4,i.apply(this,[a.sent(),r])];case 2:return[2,a.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),ze(this,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,ir(t)];case 1:return[2,i.apply(this,[a.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return $W(t)},e.prototype.extractParams=function(t){return XW(t)},e})(zs),oq=.4,uq=[new Mt(1.603231,2.094468),new Mt(6.041143,7.080126),new Mt(2.882459,3.518061),new Mt(4.266906,5.178857),new Mt(9.041765,10.66308)],lq=[117.001,114.697,97.404],cq=(function(n){nt(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:oq,classes:["face"],anchors:uq,meanRgb:lq,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ze(this,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return[4,this.detect(t,r)];case 1:return i=a.sent(),[2,i.map(function(s){return new rs(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(r3),Lr={ssdMobilenetv1:new n3,tinyFaceDetector:new cq,tinyYolov2:new WW,mtcnn:new sq,faceLandmark68Net:new YM,faceLandmark68TinyNet:new fW,faceRecognitionNet:new _W,faceExpressionNet:new ZG,ageGenderNet:new uW},o3=(function(n){nt(e,n);function e(t,r,i){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.extractedFaces=i,a}return e})(Ud),hw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i=this;return He(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,Av(t,this.input,function(s){return ze(i,void 0,void 0,function(){return He(this,function(u){switch(u.label){case 0:return[4,Promise.all(s.map(function(c){return Lr.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,t.map(function(s,u){return qM(s,r[u])})]}})})},e.prototype.withAgeAndGender=function(){return new mw(this,this.input)},e})(o3),fw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return He(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,uw(t,this.input,function(a){return Lr.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,qM(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new gw(this,this.input)},e})(o3),dw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new vw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new _w(this,this.input)},e})(hw),pw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new yw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new bw(this,this.input)},e})(fw),u3=(function(n){nt(e,n);function e(t,r,i){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.extractedFaces=i,a}return e})(Ud),mw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i=this;return He(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,Av(t,this.input,function(s){return ze(i,void 0,void 0,function(){return He(this,function(u){switch(u.label){case 0:return[4,Promise.all(s.map(function(c){return Lr.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,t.map(function(s,u){var c=r[u],h=c.age,d=c.gender,p=c.genderProbability;return JM(e3(s,d,p),h)})]}})})},e.prototype.withFaceExpressions=function(){return new hw(this,this.input)},e})(u3),gw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a,s;return He(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),t?[4,uw(t,this.input,function(c){return Lr.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=u.sent(),i=r.age,a=r.gender,s=r.genderProbability,[2,JM(e3(t,a,s),i)]}})})},e.prototype.withFaceExpressions=function(){return new fw(this,this.input)},e})(u3),vw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new dw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new _w(this,this.input)},e})(mw),yw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new pw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new bw(this,this.input)},e})(gw),l3=(function(n){nt(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e})(Ud),_w=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return He(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Av(t,this.input,function(a){return Promise.all(a.map(function(s){return Lr.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(a,s){return ZM(t[s],a)})]}})})},e.prototype.withFaceExpressions=function(){return new dw(this,this.input)},e.prototype.withAgeAndGender=function(){return new vw(this,this.input)},e})(l3),bw=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return He(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,uw(t,this.input,function(a){return Lr.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,ZM(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new pw(this,this.input)},e.prototype.withAgeAndGender=function(){return new yw(this,this.input)},e})(l3),c3=(function(n){nt(e,n);function e(t,r,i){var a=n.call(this)||this;return a.parentTask=t,a.input=r,a.useTinyLandmarkNet=i,a}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Lr.faceLandmark68TinyNet:Lr.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(Ud),hq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a,s,u=this;return He(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),r=t.map(function(h){return h.detection}),this.input instanceof sn?[4,ew(this.input,r)]:[3,3];case 2:return a=c.sent(),[3,5];case 3:return[4,Jx(this.input,r)];case 4:a=c.sent(),c.label=5;case 5:return i=a,[4,Promise.all(i.map(function(h){return u.landmarkNet.detectLandmarks(h)}))];case 6:return s=c.sent(),i.forEach(function(h){return h instanceof sn&&h.dispose()}),[2,t.map(function(h,d){return iw(h,s[d])})]}})})},e.prototype.withFaceExpressions=function(){return new dw(this,this.input)},e.prototype.withAgeAndGender=function(){return new vw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new _w(this,this.input)},e})(c3),fq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a,s;return He(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),t?(r=t.detection,this.input instanceof sn?[4,ew(this.input,[r])]:[3,3]):[2];case 2:return a=u.sent(),[3,5];case 3:return[4,Jx(this.input,[r])];case 4:a=u.sent(),u.label=5;case 5:return i=a,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return s=u.sent(),i.forEach(function(c){return c instanceof sn&&c.dispose()}),[2,iw(t,s)]}})})},e.prototype.withFaceExpressions=function(){return new pw(this,this.input)},e.prototype.withAgeAndGender=function(){return new yw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new bw(this,this.input)},e})(c3),h3=(function(n){nt(e,n);function e(t,r){r===void 0&&(r=new Sv);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e})(Ud),dq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r,i,a;return He(this,function(s){switch(s.label){case 0:return t=this,r=t.input,i=t.options,i instanceof t3?[4,Lr.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(u){return u.detection})];case 2:if(a=i instanceof i3?function(u){return Lr.tinyFaceDetector.locateFaces(u,i)}:i instanceof Sv?function(u){return Lr.ssdMobilenetv1.locateFaces(u,i)}:i instanceof ow?function(u){return Lr.tinyYolov2.locateFaces(u,i)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ze(t,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,r(i.map(function(s){return $x({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new hq(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new hw(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new mw(this.runAndExtendWithFaceDetections(),this.input)},e})(h3),pq=(function(n){nt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ze(this,void 0,void 0,function(){var t,r;return He(this,function(i){switch(i.label){case 0:return[4,new dq(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(a){a.score>r.score&&(r=a)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ze(t,void 0,void 0,function(){var i;return He(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,r(i?$x({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new fq(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new fw(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new gw(this.runAndExtendWithFaceDetection(),this.input)},e})(h3);function mq(n,e){return e===void 0&&(e=new Sv),new pq(n,e)}function gq(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,a){return i-r[a]}).reduce(function(i,a){return i+Math.pow(a,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,a=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof Lm)return s;if(s instanceof Float32Array)return new Lm(a(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new Lm(a(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return gq(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,a=r.label;return new pR(a,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new pR("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return Lm.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();const Cc={apiKey:"AIzaSyBD7qwPXdRdzdKTKE9XgT20g1dV7iH49Jo",authDomain:"smart-papr-kiosk.firebaseapp.com",projectId:"smart-papr-kiosk",storageBucket:"smart-papr-kiosk.appspot.com",messagingSenderId:"139324926582",appId:"1:139324926582:web:98889c32aacc42ff634d57",databaseURL:"https://smart-papr-kiosk-default-rtdb.asia-southeast1.firebasedatabase.app",measurementId:"G-7EWY7J8VS1"},vq="AIzaSyBfeYBUKx7re4wOj7drifj4oXZbPe99Q0o",yq={usePiCamera:!1},cc={enabled:!0,defaultLanguage:"th",thai:{voice:"Thai Female",rate:1.1,pitch:1.2,volume:1},english:{voice:"US English Female",rate:1.15,pitch:1.1,volume:1},chinese:{voice:"Chinese Female",rate:1,pitch:1,volume:1}},Nf={KIDS_3_7:{ageRange:[3,7],uiType:"KidsMode",features:["simple_animation","big_buttons","emoji_focused","no_text"],requiresConsent:!0,layout:"fullscreen_simplified",colors:["#FF6B6B","#4ECDC4","#FFE66D","#95E1D3"]},KIDS_8_12:{ageRange:[8,12],uiType:"ExploreMode",features:["interactive_games","career_exploration","simple_content","animation"],requiresConsent:!0,layout:"grid_cards",colors:["#3498db","#2ecc71","#f39c12","#e74c3c"]},TEENS_13_18:{ageRange:[13,18],uiType:"StandardMode",features:["career_cards","avatar_chat","tuition_info","analytics"],requiresConsent:!1,layout:"standard",colors:["#667eea","#764ba2","#f093fb","#4facfe"]},ADULTS_18_PLUS:{ageRange:[18,100],uiType:"ParentMode",features:["scholarship_info","roi_data","admission_requirements","career_stats"],requiresConsent:!1,layout:"parent_dashboard",colors:["#2c3e50","#34495e","#3498db","#2ecc71"]}},_q=n=>n>=3&&n<=7?Nf.KIDS_3_7:n>=8&&n<=12?Nf.KIDS_8_12:n>=13&&n<=18?Nf.TEENS_13_18:n>=18?Nf.ADULTS_18_PLUS:Nf.KIDS_3_7,Lg=[{id:"au",name:"",code:"Au",category:"",icon:"",color:"#ef4444",gradient:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",description:"    3 /     ",keywords:["","","","","","auto","car"]},{id:"ev",name:"",code:"Ev",category:"",icon:"",color:"#22c55e",gradient:"linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",description:"  EV    EV  ",keywords:["EV","","","","","electric","battery"]},{id:"ep",name:"",code:"Ep",category:"",icon:"",color:"#fbbf24",gradient:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",description:"      ",keywords:["","","","","PLC","electric","power"]},{id:"el",name:"",code:"El",category:"",icon:"",color:"#3b82f6",gradient:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",description:"          ",keywords:["","","Arduino","IoT","","electronics","circuit"]},{id:"co",name:"",code:"Co",category:"",icon:"",color:"#78716c",gradient:"linear-gradient(135deg, #78716c 0%, #57534e 100%)",description:"    Draftman   ",keywords:["","","","","","construction","building"]},{id:"ar",name:"",code:"Ar",category:"",icon:"",color:"#8b5cf6",gradient:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",description:"           ",keywords:["","","","3D","Revit","architecture","design"]},{id:"ct",name:"",code:"Ct",category:"",icon:"",color:"#06b6d4",gradient:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",description:"    C, Java, Python     IoT ",keywords:["","code","Python","Java","","coding","programming"]},{id:"it",name:"",code:"It",category:"",icon:"",color:"#14b8a6",gradient:"linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)",description:"  .      IT    e-Commerce  IT     ",keywords:["IT","network","server","","","tech","computer",""]},{id:"ac",name:"",code:"Ac",category:"",icon:"",color:"#10b981",gradient:"linear-gradient(135deg, #10b981 0%, #059669 100%)",description:"       ",keywords:["","","","","SAP","accounting","finance"]},{id:"mk",name:"",code:"Mk",category:"",icon:"",color:"#ec4899",gradient:"linear-gradient(135deg, #ec4899 0%, #db2777 100%)",description:" E-Commerce           ",keywords:["","","digital","content","","marketing","social"]},{id:"dt",name:"",code:"Dt",category:"",icon:"",color:"#f97316",gradient:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",description:"       ",keywords:["","","startup","ecommerce","social","digital","business"]},{id:"tg",name:"",code:"Tg",category:"",icon:"",color:"#0ea5e9",gradient:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",description:"       ",keywords:["","","","","","tourism","travel"]},{id:"hm",name:"",code:"Hm",category:"",icon:"",color:"#a855f7",gradient:"linear-gradient(135deg, #a855f7 0%, #9333ea 100%)",description:"      ",keywords:["","","","","","hotel","hospitality"]}],Fa={certificate:{industrial:{tuition:9e3,entrance:3100,total:12100,name:""},business:{tuition:7e3,entrance:3100,total:10100,name:""},tourism:{tuition:7e3,entrance:3100,total:10100,name:""}},diploma:{industrial:{tuition:18700,entrance:3e3,total:21700,name:""},business:{tuition:16e3,entrance:3e3,total:19e3,name:""},tourism:{tuition:16e3,entrance:3e3,total:19e3,name:""}},scholarships:[{id:"cert-m3",name:" .3  .",description:" .3",icon:"",color:"#10b981"},{id:"quota-m6",name:" .6",description:" .6",icon:"",color:"#f59e0b"},{id:"quota-diploma",name:" .",description:" .",icon:"",color:"#8b5cf6"},{id:"student-loan",name:" (.)",description:" ",icon:"",color:"#3b82f6"},{id:"kalyanamitr",name:"",description:"",icon:"",color:"#ec4899"}],benefits:[" 1 ",""," 2 "," 1 "],documents:[".1 "," (, , )"," (, , )",""],applicationMethods:[{method:"walk-in",name:"",icon:"",description:""},{method:"online",name:"",icon:"",description:" "}],notes:["","  "," "]},bq=()=>{};var bR={};const f3={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const Ie=function(n,e){if(!n)throw hh(e)},hh=function(n){return new Error("Firebase Database ("+f3.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const d3=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},xq=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=n[t++];e[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=n[t++],s=n[t++],u=n[t++],c=((i&7)<<18|(a&63)<<12|(s&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const a=n[t++],s=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|s&63)}}return e.join("")},xw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const a=n[i],s=i+1<n.length,u=s?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,d=a>>2,p=(a&3)<<4|u>>4;let g=(u&15)<<2|h>>6,v=h&63;c||(v=64,s||(g=64)),r.push(t[d],t[p],t[g],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(d3(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):xq(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const a=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,a==null||u==null||h==null||p==null)throw new wq;const g=a<<2|u>>4;if(r.push(g),h!==64){const v=u<<4&240|h>>2;if(r.push(v),p!==64){const b=h<<6&192|p;r.push(b)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class wq extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p3=function(n){const e=d3(n);return xw.encodeByteArray(e,!0)},Bg=function(n){return p3(n).replace(/\./g,"")},Jb=function(n){try{return xw.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Eq(n){return m3(void 0,n)}function m3(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Tq(t)||(n[t]=m3(n[t],e[t]));return n}function Tq(n){return n!=="__proto__"}function Cq(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Sq=()=>Cq().__FIREBASE_DEFAULTS__,Aq=()=>{if(typeof process>"u"||typeof bR>"u")return;const n=bR.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Rq=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Jb(n[1]);return e&&JSON.parse(e)},ww=()=>{try{return bq()||Sq()||Aq()||Rq()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Iq=n=>ww()?.emulatorHosts?.[n],g3=n=>{const e=Iq(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},v3=()=>ww()?.config;class Ew{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function zd(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function y3(n){return(await fetch(n,{credentials:"include"})).ok}function _3(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Bg(JSON.stringify(t)),Bg(JSON.stringify(s)),""].join(".")}const qf={};function Nq(){const n={prod:[],emulator:[]};for(const e of Object.keys(qf))qf[e]?n.emulator.push(e):n.prod.push(e);return n}function Dq(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let xR=!1;function b3(n,e){if(typeof window>"u"||typeof document>"u"||!zd(window.location.host)||qf[n]===e||qf[n]||xR)return;qf[n]=e;function t(g){return`__firebase__banner__${g}`}const r="__firebase__banner",a=Nq().prod.length>0;function s(){const g=document.getElementById(r);g&&g.remove()}function u(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function c(g,v){g.setAttribute("width","24"),g.setAttribute("id",v),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function h(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{xR=!0,s()},g}function d(g,v){g.setAttribute("id",v),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){const g=Dq(r),v=t("text"),b=document.getElementById(v)||document.createElement("span"),E=t("learnmore"),w=document.getElementById(E)||document.createElement("a"),C=t("preprendIcon"),S=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const I=g.element;u(I),d(w,E);const D=h();c(S,C),I.append(S,b,w,D),document.body.appendChild(I)}a?(b.innerText="Preview backend disconnected.",S.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(S.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function x3(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function w3(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x3())}function kq(){const n=ww()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Mq(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Oq(){return f3.NODE_ADMIN===!0}function Pq(){return!kq()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Fq(){try{return typeof indexedDB=="object"}catch{return!1}}function Vq(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const Lq="FirebaseError";class fh extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Lq,Object.setPrototypeOf(this,fh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E3.prototype.create)}}class E3{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],s=a?Bq(a,r):"Error",u=`${this.serviceName}: ${s} (${i}).`;return new fh(i,u,r)}}function Bq(n,e){return n.replace(jq,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const jq=/\{\$([^}]+)}/g;function dd(n){return JSON.parse(n)}function mr(n){return JSON.stringify(n)}const T3=function(n){let e={},t={},r={},i="";try{const a=n.split(".");e=dd(Jb(a[0])||""),t=dd(Jb(a[1])||""),i=a[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:i}},Uq=function(n){const e=T3(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},zq=function(n){const e=T3(n).claims;return typeof e=="object"&&e.admin===!0};function Ws(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function $c(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function wR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function jg(n,e,t){const r={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=e.call(t,n[i],i,n));return r}function pd(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const a=n[i],s=e[i];if(ER(a)&&ER(s)){if(!pd(a,s))return!1}else if(a!==s)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function ER(n){return n!==null&&typeof n=="object"}function Hq(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}class Gq{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)r[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)r[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const g=r[p-3]^r[p-8]^r[p-14]^r[p-16];r[p]=(g<<1|g>>>31)&4294967295}let i=this.chain_[0],a=this.chain_[1],s=this.chain_[2],u=this.chain_[3],c=this.chain_[4],h,d;for(let p=0;p<80;p++){p<40?p<20?(h=u^a&(s^u),d=1518500249):(h=a^s^u,d=1859775393):p<60?(h=a&s|u&(a|s),d=2400959708):(h=a^s^u,d=3395469782);const g=(i<<5|i>>>27)+h+c+d+r[p]&4294967295;c=u,u=s,s=(a<<30|a>>>2)&4294967295,a=i,i=g}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+s&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let i=0;const a=this.buf_;let s=this.inbuf_;for(;i<t;){if(s===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(a[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(a),s=0;break}}else for(;i<t;)if(a[s]=e[i],++s,++i,s===this.blockSize){this.compress_(a),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let a=24;a>=0;a-=8)e[r]=this.chain_[i]>>a&255,++r;return e}}function Wq(n,e){return`${n} failed: ${e} argument `}const qq=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i>=55296&&i<=56319){const a=i-55296;r++,Ie(r<n.length,"Surrogate pair missing trail surrogate.");const s=n.charCodeAt(r)-56320;i=65536+(a<<10)+s}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Rv=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};function la(n){return n&&n._delegate?n._delegate:n}class Qc{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Bu="[DEFAULT]";class Kq{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ew;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Yq(e))try{this.getOrInitializeService({instanceIdentifier:Bu})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});r.resolve(a)}catch{}}}}clearInstance(e=Bu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Bu){return this.instances.has(e)}getOptions(e=Bu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[a,s]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(a);r===u&&s.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Xq(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Bu){return this.component?this.component.multipleInstances?e:Bu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Xq(n){return n===Bu?void 0:n}function Yq(n){return n.instantiationMode==="EAGER"}class $q{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Kq(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var xt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(xt||(xt={}));const Qq={debug:xt.DEBUG,verbose:xt.VERBOSE,info:xt.INFO,warn:xt.WARN,error:xt.ERROR,silent:xt.SILENT},Zq=xt.INFO,Jq={[xt.DEBUG]:"log",[xt.VERBOSE]:"log",[xt.INFO]:"info",[xt.WARN]:"warn",[xt.ERROR]:"error"},e7=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=Jq[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Tw{constructor(e){this.name=e,this._logLevel=Zq,this._logHandler=e7,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Qq[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xt.DEBUG,...e),this._logHandler(this,xt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xt.VERBOSE,...e),this._logHandler(this,xt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xt.INFO,...e),this._logHandler(this,xt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xt.WARN,...e),this._logHandler(this,xt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xt.ERROR,...e),this._logHandler(this,xt.ERROR,...e)}}const t7=(n,e)=>e.some(t=>n instanceof t);let TR,CR;function n7(){return TR||(TR=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function r7(){return CR||(CR=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const C3=new WeakMap,e1=new WeakMap,S3=new WeakMap,G_=new WeakMap,Cw=new WeakMap;function i7(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",a),n.removeEventListener("error",s)},a=()=>{t(Mo(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",a),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&C3.set(t,n)}).catch(()=>{}),Cw.set(e,n),e}function a7(n){if(e1.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",s),n.removeEventListener("abort",s)},a=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",a),n.addEventListener("error",s),n.addEventListener("abort",s)});e1.set(n,e)}let t1={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return e1.get(n);if(e==="objectStoreNames")return n.objectStoreNames||S3.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Mo(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function s7(n){t1=n(t1)}function o7(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(W_(this),e,...t);return S3.set(r,e.sort?e.sort():[e]),Mo(r)}:r7().includes(n)?function(...e){return n.apply(W_(this),e),Mo(C3.get(this))}:function(...e){return Mo(n.apply(W_(this),e))}}function u7(n){return typeof n=="function"?o7(n):(n instanceof IDBTransaction&&a7(n),t7(n,n7())?new Proxy(n,t1):n)}function Mo(n){if(n instanceof IDBRequest)return i7(n);if(G_.has(n))return G_.get(n);const e=u7(n);return e!==n&&(G_.set(n,e),Cw.set(e,n)),e}const W_=n=>Cw.get(n);function l7(n,e,{blocked:t,upgrade:r,blocking:i,terminated:a}={}){const s=indexedDB.open(n,e),u=Mo(s);return r&&s.addEventListener("upgradeneeded",c=>{r(Mo(s.result),c.oldVersion,c.newVersion,Mo(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),u.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const c7=["get","getKey","getAll","getAllKeys","count"],h7=["put","add","delete","clear"],q_=new Map;function SR(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(q_.get(e))return q_.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=h7.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||c7.includes(t)))return;const a=async function(s,...u){const c=this.transaction(s,i?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(u.shift())),(await Promise.all([h[t](...u),i&&c.done]))[0]};return q_.set(e,a),a}s7(n=>({...n,get:(e,t,r)=>SR(e,t)||n.get(e,t,r),has:(e,t)=>!!SR(e,t)||n.has(e,t)}));class f7{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(d7(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function d7(n){return n.getComponent()?.type==="VERSION"}const n1="@firebase/app",AR="0.14.6";const Os=new Tw("@firebase/app"),p7="@firebase/app-compat",m7="@firebase/analytics-compat",g7="@firebase/analytics",v7="@firebase/app-check-compat",y7="@firebase/app-check",_7="@firebase/auth",b7="@firebase/auth-compat",x7="@firebase/database",w7="@firebase/data-connect",E7="@firebase/database-compat",T7="@firebase/functions",C7="@firebase/functions-compat",S7="@firebase/installations",A7="@firebase/installations-compat",R7="@firebase/messaging",I7="@firebase/messaging-compat",N7="@firebase/performance",D7="@firebase/performance-compat",k7="@firebase/remote-config",M7="@firebase/remote-config-compat",O7="@firebase/storage",P7="@firebase/storage-compat",F7="@firebase/firestore",V7="@firebase/ai",L7="@firebase/firestore-compat",B7="firebase",j7="12.6.0";const r1="[DEFAULT]",U7={[n1]:"fire-core",[p7]:"fire-core-compat",[g7]:"fire-analytics",[m7]:"fire-analytics-compat",[y7]:"fire-app-check",[v7]:"fire-app-check-compat",[_7]:"fire-auth",[b7]:"fire-auth-compat",[x7]:"fire-rtdb",[w7]:"fire-data-connect",[E7]:"fire-rtdb-compat",[T7]:"fire-fn",[C7]:"fire-fn-compat",[S7]:"fire-iid",[A7]:"fire-iid-compat",[R7]:"fire-fcm",[I7]:"fire-fcm-compat",[N7]:"fire-perf",[D7]:"fire-perf-compat",[k7]:"fire-rc",[M7]:"fire-rc-compat",[O7]:"fire-gcs",[P7]:"fire-gcs-compat",[F7]:"fire-fst",[L7]:"fire-fst-compat",[V7]:"fire-vertex","fire-js":"fire-js",[B7]:"fire-js-all"};const Ug=new Map,z7=new Map,i1=new Map;function RR(n,e){try{n.container.addComponent(e)}catch(t){Os.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function md(n){const e=n.name;if(i1.has(e))return Os.debug(`There were multiple attempts to register component ${e}.`),!1;i1.set(e,n);for(const t of Ug.values())RR(t,n);for(const t of z7.values())RR(t,n);return!0}function A3(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function R3(n){return n==null?!1:n.settings!==void 0}const H7={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oo=new E3("app","Firebase",H7);class G7{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Qc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Oo.create("app-deleted",{appName:this._name})}}const I3=j7;function N3(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:r1,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Oo.create("bad-app-name",{appName:String(i)});if(t||(t=v3()),!t)throw Oo.create("no-options");const a=Ug.get(i);if(a){if(pd(t,a.options)&&pd(r,a.config))return a;throw Oo.create("duplicate-app",{appName:i})}const s=new $q(i);for(const c of i1.values())s.addComponent(c);const u=new G7(t,r,s);return Ug.set(i,u),u}function D3(n=r1){const e=Ug.get(n);if(!e&&n===r1&&v3())return N3();if(!e)throw Oo.create("no-app",{appName:n});return e}function Po(n,e,t){let r=U7[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const s=[`Unable to register library "${r}" with version "${e}":`];i&&s.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&s.push("and"),a&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Os.warn(s.join(" "));return}md(new Qc(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const W7="firebase-heartbeat-database",q7=1,gd="firebase-heartbeat-store";let K_=null;function k3(){return K_||(K_=l7(W7,q7,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(gd)}catch(t){console.warn(t)}}}}).catch(n=>{throw Oo.create("idb-open",{originalErrorMessage:n.message})})),K_}async function K7(n){try{const t=(await k3()).transaction(gd),r=await t.objectStore(gd).get(M3(n));return await t.done,r}catch(e){if(e instanceof fh)Os.warn(e.message);else{const t=Oo.create("idb-get",{originalErrorMessage:e?.message});Os.warn(t.message)}}}async function IR(n,e){try{const r=(await k3()).transaction(gd,"readwrite");await r.objectStore(gd).put(e,M3(n)),await r.done}catch(t){if(t instanceof fh)Os.warn(t.message);else{const r=Oo.create("idb-set",{originalErrorMessage:t?.message});Os.warn(r.message)}}}function M3(n){return`${n.name}!${n.options.appId}`}const X7=1024,Y7=30;class $7{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Z7(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=NR();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Y7){const i=J7(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Os.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=NR(),{heartbeatsToSend:t,unsentEntries:r}=Q7(this._heartbeatsCache.heartbeats),i=Bg(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Os.warn(e),""}}}function NR(){return new Date().toISOString().substring(0,10)}function Q7(n,e=X7){const t=[];let r=n.slice();for(const i of n){const a=t.find(s=>s.agent===i.agent);if(a){if(a.dates.push(i.date),DR(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),DR(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Z7{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Fq()?Vq().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await K7(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return IR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return IR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function DR(n){return Bg(JSON.stringify({version:2,heartbeats:n})).length}function J7(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function eK(n){md(new Qc("platform-logger",e=>new f7(e),"PRIVATE")),md(new Qc("heartbeat",e=>new $7(e),"PRIVATE")),Po(n1,AR,n),Po(n1,AR,"esm2020"),Po("fire-js","")}eK("");var tK="firebase",nK="12.7.0";Po(tK,nK,"app");var kR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Fo,O3;(function(){var n;function e(N,R){function k(){}k.prototype=R.prototype,N.F=R.prototype,N.prototype=new k,N.prototype.constructor=N,N.D=function(P,V,j){for(var L=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)L[Z-2]=arguments[Z];return R.prototype[V].apply(P,L)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(N,R,k){k||(k=0);const P=Array(16);if(typeof R=="string")for(var V=0;V<16;++V)P[V]=R.charCodeAt(k++)|R.charCodeAt(k++)<<8|R.charCodeAt(k++)<<16|R.charCodeAt(k++)<<24;else for(V=0;V<16;++V)P[V]=R[k++]|R[k++]<<8|R[k++]<<16|R[k++]<<24;R=N.g[0],k=N.g[1],V=N.g[2];let j=N.g[3],L;L=R+(j^k&(V^j))+P[0]+3614090360&4294967295,R=k+(L<<7&4294967295|L>>>25),L=j+(V^R&(k^V))+P[1]+3905402710&4294967295,j=R+(L<<12&4294967295|L>>>20),L=V+(k^j&(R^k))+P[2]+606105819&4294967295,V=j+(L<<17&4294967295|L>>>15),L=k+(R^V&(j^R))+P[3]+3250441966&4294967295,k=V+(L<<22&4294967295|L>>>10),L=R+(j^k&(V^j))+P[4]+4118548399&4294967295,R=k+(L<<7&4294967295|L>>>25),L=j+(V^R&(k^V))+P[5]+1200080426&4294967295,j=R+(L<<12&4294967295|L>>>20),L=V+(k^j&(R^k))+P[6]+2821735955&4294967295,V=j+(L<<17&4294967295|L>>>15),L=k+(R^V&(j^R))+P[7]+4249261313&4294967295,k=V+(L<<22&4294967295|L>>>10),L=R+(j^k&(V^j))+P[8]+1770035416&4294967295,R=k+(L<<7&4294967295|L>>>25),L=j+(V^R&(k^V))+P[9]+2336552879&4294967295,j=R+(L<<12&4294967295|L>>>20),L=V+(k^j&(R^k))+P[10]+4294925233&4294967295,V=j+(L<<17&4294967295|L>>>15),L=k+(R^V&(j^R))+P[11]+2304563134&4294967295,k=V+(L<<22&4294967295|L>>>10),L=R+(j^k&(V^j))+P[12]+1804603682&4294967295,R=k+(L<<7&4294967295|L>>>25),L=j+(V^R&(k^V))+P[13]+4254626195&4294967295,j=R+(L<<12&4294967295|L>>>20),L=V+(k^j&(R^k))+P[14]+2792965006&4294967295,V=j+(L<<17&4294967295|L>>>15),L=k+(R^V&(j^R))+P[15]+1236535329&4294967295,k=V+(L<<22&4294967295|L>>>10),L=R+(V^j&(k^V))+P[1]+4129170786&4294967295,R=k+(L<<5&4294967295|L>>>27),L=j+(k^V&(R^k))+P[6]+3225465664&4294967295,j=R+(L<<9&4294967295|L>>>23),L=V+(R^k&(j^R))+P[11]+643717713&4294967295,V=j+(L<<14&4294967295|L>>>18),L=k+(j^R&(V^j))+P[0]+3921069994&4294967295,k=V+(L<<20&4294967295|L>>>12),L=R+(V^j&(k^V))+P[5]+3593408605&4294967295,R=k+(L<<5&4294967295|L>>>27),L=j+(k^V&(R^k))+P[10]+38016083&4294967295,j=R+(L<<9&4294967295|L>>>23),L=V+(R^k&(j^R))+P[15]+3634488961&4294967295,V=j+(L<<14&4294967295|L>>>18),L=k+(j^R&(V^j))+P[4]+3889429448&4294967295,k=V+(L<<20&4294967295|L>>>12),L=R+(V^j&(k^V))+P[9]+568446438&4294967295,R=k+(L<<5&4294967295|L>>>27),L=j+(k^V&(R^k))+P[14]+3275163606&4294967295,j=R+(L<<9&4294967295|L>>>23),L=V+(R^k&(j^R))+P[3]+4107603335&4294967295,V=j+(L<<14&4294967295|L>>>18),L=k+(j^R&(V^j))+P[8]+1163531501&4294967295,k=V+(L<<20&4294967295|L>>>12),L=R+(V^j&(k^V))+P[13]+2850285829&4294967295,R=k+(L<<5&4294967295|L>>>27),L=j+(k^V&(R^k))+P[2]+4243563512&4294967295,j=R+(L<<9&4294967295|L>>>23),L=V+(R^k&(j^R))+P[7]+1735328473&4294967295,V=j+(L<<14&4294967295|L>>>18),L=k+(j^R&(V^j))+P[12]+2368359562&4294967295,k=V+(L<<20&4294967295|L>>>12),L=R+(k^V^j)+P[5]+4294588738&4294967295,R=k+(L<<4&4294967295|L>>>28),L=j+(R^k^V)+P[8]+2272392833&4294967295,j=R+(L<<11&4294967295|L>>>21),L=V+(j^R^k)+P[11]+1839030562&4294967295,V=j+(L<<16&4294967295|L>>>16),L=k+(V^j^R)+P[14]+4259657740&4294967295,k=V+(L<<23&4294967295|L>>>9),L=R+(k^V^j)+P[1]+2763975236&4294967295,R=k+(L<<4&4294967295|L>>>28),L=j+(R^k^V)+P[4]+1272893353&4294967295,j=R+(L<<11&4294967295|L>>>21),L=V+(j^R^k)+P[7]+4139469664&4294967295,V=j+(L<<16&4294967295|L>>>16),L=k+(V^j^R)+P[10]+3200236656&4294967295,k=V+(L<<23&4294967295|L>>>9),L=R+(k^V^j)+P[13]+681279174&4294967295,R=k+(L<<4&4294967295|L>>>28),L=j+(R^k^V)+P[0]+3936430074&4294967295,j=R+(L<<11&4294967295|L>>>21),L=V+(j^R^k)+P[3]+3572445317&4294967295,V=j+(L<<16&4294967295|L>>>16),L=k+(V^j^R)+P[6]+76029189&4294967295,k=V+(L<<23&4294967295|L>>>9),L=R+(k^V^j)+P[9]+3654602809&4294967295,R=k+(L<<4&4294967295|L>>>28),L=j+(R^k^V)+P[12]+3873151461&4294967295,j=R+(L<<11&4294967295|L>>>21),L=V+(j^R^k)+P[15]+530742520&4294967295,V=j+(L<<16&4294967295|L>>>16),L=k+(V^j^R)+P[2]+3299628645&4294967295,k=V+(L<<23&4294967295|L>>>9),L=R+(V^(k|~j))+P[0]+4096336452&4294967295,R=k+(L<<6&4294967295|L>>>26),L=j+(k^(R|~V))+P[7]+1126891415&4294967295,j=R+(L<<10&4294967295|L>>>22),L=V+(R^(j|~k))+P[14]+2878612391&4294967295,V=j+(L<<15&4294967295|L>>>17),L=k+(j^(V|~R))+P[5]+4237533241&4294967295,k=V+(L<<21&4294967295|L>>>11),L=R+(V^(k|~j))+P[12]+1700485571&4294967295,R=k+(L<<6&4294967295|L>>>26),L=j+(k^(R|~V))+P[3]+2399980690&4294967295,j=R+(L<<10&4294967295|L>>>22),L=V+(R^(j|~k))+P[10]+4293915773&4294967295,V=j+(L<<15&4294967295|L>>>17),L=k+(j^(V|~R))+P[1]+2240044497&4294967295,k=V+(L<<21&4294967295|L>>>11),L=R+(V^(k|~j))+P[8]+1873313359&4294967295,R=k+(L<<6&4294967295|L>>>26),L=j+(k^(R|~V))+P[15]+4264355552&4294967295,j=R+(L<<10&4294967295|L>>>22),L=V+(R^(j|~k))+P[6]+2734768916&4294967295,V=j+(L<<15&4294967295|L>>>17),L=k+(j^(V|~R))+P[13]+1309151649&4294967295,k=V+(L<<21&4294967295|L>>>11),L=R+(V^(k|~j))+P[4]+4149444226&4294967295,R=k+(L<<6&4294967295|L>>>26),L=j+(k^(R|~V))+P[11]+3174756917&4294967295,j=R+(L<<10&4294967295|L>>>22),L=V+(R^(j|~k))+P[2]+718787259&4294967295,V=j+(L<<15&4294967295|L>>>17),L=k+(j^(V|~R))+P[9]+3951481745&4294967295,N.g[0]=N.g[0]+R&4294967295,N.g[1]=N.g[1]+(V+(L<<21&4294967295|L>>>11))&4294967295,N.g[2]=N.g[2]+V&4294967295,N.g[3]=N.g[3]+j&4294967295}r.prototype.v=function(N,R){R===void 0&&(R=N.length);const k=R-this.blockSize,P=this.C;let V=this.h,j=0;for(;j<R;){if(V==0)for(;j<=k;)i(this,N,j),j+=this.blockSize;if(typeof N=="string"){for(;j<R;)if(P[V++]=N.charCodeAt(j++),V==this.blockSize){i(this,P),V=0;break}}else for(;j<R;)if(P[V++]=N[j++],V==this.blockSize){i(this,P),V=0;break}}this.h=V,this.o+=R},r.prototype.A=function(){var N=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);N[0]=128;for(var R=1;R<N.length-8;++R)N[R]=0;R=this.o*8;for(var k=N.length-8;k<N.length;++k)N[k]=R&255,R/=256;for(this.v(N),N=Array(16),R=0,k=0;k<4;++k)for(let P=0;P<32;P+=8)N[R++]=this.g[k]>>>P&255;return N};function a(N,R){var k=u;return Object.prototype.hasOwnProperty.call(k,N)?k[N]:k[N]=R(N)}function s(N,R){this.h=R;const k=[];let P=!0;for(let V=N.length-1;V>=0;V--){const j=N[V]|0;P&&j==R||(k[V]=j,P=!1)}this.g=k}var u={};function c(N){return-128<=N&&N<128?a(N,function(R){return new s([R|0],R<0?-1:0)}):new s([N|0],N<0?-1:0)}function h(N){if(isNaN(N)||!isFinite(N))return p;if(N<0)return w(h(-N));const R=[];let k=1;for(let P=0;N>=k;P++)R[P]=N/k|0,k*=4294967296;return new s(R,0)}function d(N,R){if(N.length==0)throw Error("number format error: empty string");if(R=R||10,R<2||36<R)throw Error("radix out of range: "+R);if(N.charAt(0)=="-")return w(d(N.substring(1),R));if(N.indexOf("-")>=0)throw Error('number format error: interior "-" character');const k=h(Math.pow(R,8));let P=p;for(let j=0;j<N.length;j+=8){var V=Math.min(8,N.length-j);const L=parseInt(N.substring(j,j+V),R);V<8?(V=h(Math.pow(R,V)),P=P.j(V).add(h(L))):(P=P.j(k),P=P.add(h(L)))}return P}var p=c(0),g=c(1),v=c(16777216);n=s.prototype,n.m=function(){if(E(this))return-w(this).m();let N=0,R=1;for(let k=0;k<this.g.length;k++){const P=this.i(k);N+=(P>=0?P:4294967296+P)*R,R*=4294967296}return N},n.toString=function(N){if(N=N||10,N<2||36<N)throw Error("radix out of range: "+N);if(b(this))return"0";if(E(this))return"-"+w(this).toString(N);const R=h(Math.pow(N,6));var k=this;let P="";for(;;){const V=D(k,R).g;k=C(k,V.j(R));let j=((k.g.length>0?k.g[0]:k.h)>>>0).toString(N);if(k=V,b(k))return j+P;for(;j.length<6;)j="0"+j;P=j+P}},n.i=function(N){return N<0?0:N<this.g.length?this.g[N]:this.h};function b(N){if(N.h!=0)return!1;for(let R=0;R<N.g.length;R++)if(N.g[R]!=0)return!1;return!0}function E(N){return N.h==-1}n.l=function(N){return N=C(this,N),E(N)?-1:b(N)?0:1};function w(N){const R=N.g.length,k=[];for(let P=0;P<R;P++)k[P]=~N.g[P];return new s(k,~N.h).add(g)}n.abs=function(){return E(this)?w(this):this},n.add=function(N){const R=Math.max(this.g.length,N.g.length),k=[];let P=0;for(let V=0;V<=R;V++){let j=P+(this.i(V)&65535)+(N.i(V)&65535),L=(j>>>16)+(this.i(V)>>>16)+(N.i(V)>>>16);P=L>>>16,j&=65535,L&=65535,k[V]=L<<16|j}return new s(k,k[k.length-1]&-2147483648?-1:0)};function C(N,R){return N.add(w(R))}n.j=function(N){if(b(this)||b(N))return p;if(E(this))return E(N)?w(this).j(w(N)):w(w(this).j(N));if(E(N))return w(this.j(w(N)));if(this.l(v)<0&&N.l(v)<0)return h(this.m()*N.m());const R=this.g.length+N.g.length,k=[];for(var P=0;P<2*R;P++)k[P]=0;for(P=0;P<this.g.length;P++)for(let V=0;V<N.g.length;V++){const j=this.i(P)>>>16,L=this.i(P)&65535,Z=N.i(V)>>>16,ne=N.i(V)&65535;k[2*P+2*V]+=L*ne,S(k,2*P+2*V),k[2*P+2*V+1]+=j*ne,S(k,2*P+2*V+1),k[2*P+2*V+1]+=L*Z,S(k,2*P+2*V+1),k[2*P+2*V+2]+=j*Z,S(k,2*P+2*V+2)}for(N=0;N<R;N++)k[N]=k[2*N+1]<<16|k[2*N];for(N=R;N<2*R;N++)k[N]=0;return new s(k,0)};function S(N,R){for(;(N[R]&65535)!=N[R];)N[R+1]+=N[R]>>>16,N[R]&=65535,R++}function I(N,R){this.g=N,this.h=R}function D(N,R){if(b(R))throw Error("division by zero");if(b(N))return new I(p,p);if(E(N))return R=D(w(N),R),new I(w(R.g),w(R.h));if(E(R))return R=D(N,w(R)),new I(w(R.g),R.h);if(N.g.length>30){if(E(N)||E(R))throw Error("slowDivide_ only works with positive integers.");for(var k=g,P=R;P.l(N)<=0;)k=O(k),P=O(P);var V=B(k,1),j=B(P,1);for(P=B(P,2),k=B(k,2);!b(P);){var L=j.add(P);L.l(N)<=0&&(V=V.add(k),j=L),P=B(P,1),k=B(k,1)}return R=C(N,V.j(R)),new I(V,R)}for(V=p;N.l(R)>=0;){for(k=Math.max(1,Math.floor(N.m()/R.m())),P=Math.ceil(Math.log(k)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),j=h(k),L=j.j(R);E(L)||L.l(N)>0;)k-=P,j=h(k),L=j.j(R);b(j)&&(j=g),V=V.add(j),N=C(N,L)}return new I(V,N)}n.B=function(N){return D(this,N).h},n.and=function(N){const R=Math.max(this.g.length,N.g.length),k=[];for(let P=0;P<R;P++)k[P]=this.i(P)&N.i(P);return new s(k,this.h&N.h)},n.or=function(N){const R=Math.max(this.g.length,N.g.length),k=[];for(let P=0;P<R;P++)k[P]=this.i(P)|N.i(P);return new s(k,this.h|N.h)},n.xor=function(N){const R=Math.max(this.g.length,N.g.length),k=[];for(let P=0;P<R;P++)k[P]=this.i(P)^N.i(P);return new s(k,this.h^N.h)};function O(N){const R=N.g.length+1,k=[];for(let P=0;P<R;P++)k[P]=N.i(P)<<1|N.i(P-1)>>>31;return new s(k,N.h)}function B(N,R){const k=R>>5;R%=32;const P=N.g.length-k,V=[];for(let j=0;j<P;j++)V[j]=R>0?N.i(j+k)>>>R|N.i(j+k+1)<<32-R:N.i(j+k);return new s(V,N.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,O3=r,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=h,s.fromString=d,Fo=s}).apply(typeof kR<"u"?kR:typeof self<"u"?self:typeof window<"u"?window:{});var Hm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var P3,Ff,F3,ng,a1,V3,L3,B3;(function(){var n,e=Object.defineProperty;function t(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Hm=="object"&&Hm];for(var A=0;A<y.length;++A){var F=y[A];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=t(this);function i(y,A){if(A)e:{var F=r;y=y.split(".");for(var H=0;H<y.length-1;H++){var ie=y[H];if(!(ie in F))break e;F=F[ie]}y=y[y.length-1],H=F[y],A=A(H),A!=H&&A!=null&&e(F,y,{configurable:!0,writable:!0,value:A})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(A){var F=[],H;for(H in A)Object.prototype.hasOwnProperty.call(A,H)&&F.push([H,A[H]]);return F}});var a=a||{},s=this||self;function u(y){var A=typeof y;return A=="object"&&y!=null||A=="function"}function c(y,A,F){return y.call.apply(y.bind,arguments)}function h(y,A,F){return h=c,h.apply(null,arguments)}function d(y,A){var F=Array.prototype.slice.call(arguments,1);return function(){var H=F.slice();return H.push.apply(H,arguments),y.apply(this,H)}}function p(y,A){function F(){}F.prototype=A.prototype,y.Z=A.prototype,y.prototype=new F,y.prototype.constructor=y,y.Ob=function(H,ie,he){for(var Ce=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)Ce[ut-2]=arguments[ut];return A.prototype[ie].apply(H,Ce)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function v(y){const A=y.length;if(A>0){const F=Array(A);for(let H=0;H<A;H++)F[H]=y[H];return F}return[]}function b(y,A){for(let H=1;H<arguments.length;H++){const ie=arguments[H];var F=typeof ie;if(F=F!="object"?F:ie?Array.isArray(ie)?"array":F:"null",F=="array"||F=="object"&&typeof ie.length=="number"){F=y.length||0;const he=ie.length||0;y.length=F+he;for(let Ce=0;Ce<he;Ce++)y[F+Ce]=ie[Ce]}else y.push(ie)}}class E{constructor(A,F){this.i=A,this.j=F,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function w(y){s.setTimeout(()=>{throw y},0)}function C(){var y=N;let A=null;return y.g&&(A=y.g,y.g=y.g.next,y.g||(y.h=null),A.next=null),A}class S{constructor(){this.h=this.g=null}add(A,F){const H=I.get();H.set(A,F),this.h?this.h.next=H:this.g=H,this.h=H}}var I=new E(()=>new D,y=>y.reset());class D{constructor(){this.next=this.g=this.h=null}set(A,F){this.h=A,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let O,B=!1,N=new S,R=()=>{const y=Promise.resolve(void 0);O=()=>{y.then(k)}};function k(){for(var y;y=C();){try{y.h.call(y.g)}catch(F){w(F)}var A=I;A.j(y),A.h<100&&(A.h++,y.next=A.g,A.g=y)}B=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(y,A){this.type=y,this.g=this.target=A,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!s.addEventListener||!Object.defineProperty)return!1;var y=!1,A=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const F=()=>{};s.addEventListener("test",F,A),s.removeEventListener("test",F,A)}catch{}return y})();function L(y){return/^[\s\xa0]*$/.test(y)}function Z(y,A){V.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,A)}p(Z,V),Z.prototype.init=function(y,A){const F=this.type=y.type,H=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=A,A=y.relatedTarget,A||(F=="mouseover"?A=y.fromElement:F=="mouseout"&&(A=y.toElement)),this.relatedTarget=A,H?(this.clientX=H.clientX!==void 0?H.clientX:H.pageX,this.clientY=H.clientY!==void 0?H.clientY:H.pageY,this.screenX=H.screenX||0,this.screenY=H.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&Z.Z.h.call(this)},Z.prototype.h=function(){Z.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var ne="closure_listenable_"+(Math.random()*1e6|0),q=0;function X(y,A,F,H,ie){this.listener=y,this.proxy=null,this.src=A,this.type=F,this.capture=!!H,this.ha=ie,this.key=++q,this.da=this.fa=!1}function ee(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function ue(y,A,F){for(const H in y)A.call(F,y[H],H,y)}function fe(y,A){for(const F in y)A.call(void 0,y[F],F,y)}function W(y){const A={};for(const F in y)A[F]=y[F];return A}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(y,A){let F,H;for(let ie=1;ie<arguments.length;ie++){H=arguments[ie];for(F in H)y[F]=H[F];for(let he=0;he<$.length;he++)F=$[he],Object.prototype.hasOwnProperty.call(H,F)&&(y[F]=H[F])}}function ve(y){this.src=y,this.g={},this.h=0}ve.prototype.add=function(y,A,F,H,ie){const he=y.toString();y=this.g[he],y||(y=this.g[he]=[],this.h++);const Ce=Se(y,A,H,ie);return Ce>-1?(A=y[Ce],F||(A.fa=!1)):(A=new X(A,this.src,he,!!H,ie),A.fa=F,y.push(A)),A};function Te(y,A){const F=A.type;if(F in y.g){var H=y.g[F],ie=Array.prototype.indexOf.call(H,A,void 0),he;(he=ie>=0)&&Array.prototype.splice.call(H,ie,1),he&&(ee(A),y.g[F].length==0&&(delete y.g[F],y.h--))}}function Se(y,A,F,H){for(let ie=0;ie<y.length;++ie){const he=y[ie];if(!he.da&&he.listener==A&&he.capture==!!F&&he.ha==H)return ie}return-1}var _e="closure_lm_"+(Math.random()*1e6|0),De={};function Re(y,A,F,H,ie){if(Array.isArray(A)){for(let he=0;he<A.length;he++)Re(y,A[he],F,H,ie);return null}return F=xn(F),y&&y[ne]?y.J(A,F,u(H)?!!H.capture:!1,ie):qe(y,A,F,!1,H,ie)}function qe(y,A,F,H,ie,he){if(!A)throw Error("Invalid event type");const Ce=u(ie)?!!ie.capture:!!ie;let ut=ot(y);if(ut||(y[_e]=ut=new ve(y)),F=ut.add(A,F,H,Ce,he),F.proxy)return F;if(H=et(),F.proxy=H,H.src=y,H.listener=F,y.addEventListener)j||(ie=Ce),ie===void 0&&(ie=!1),y.addEventListener(A.toString(),H,ie);else if(y.attachEvent)y.attachEvent(st(A.toString()),H);else if(y.addListener&&y.removeListener)y.addListener(H);else throw Error("addEventListener and attachEvent are unavailable.");return F}function et(){function y(F){return A.call(y.src,y.listener,F)}const A=Qe;return y}function Ze(y,A,F,H,ie){if(Array.isArray(A))for(var he=0;he<A.length;he++)Ze(y,A[he],F,H,ie);else H=u(H)?!!H.capture:!!H,F=xn(F),y&&y[ne]?(y=y.i,he=String(A).toString(),he in y.g&&(A=y.g[he],F=Se(A,F,H,ie),F>-1&&(ee(A[F]),Array.prototype.splice.call(A,F,1),A.length==0&&(delete y.g[he],y.h--)))):y&&(y=ot(y))&&(A=y.g[A.toString()],y=-1,A&&(y=Se(A,F,H,ie)),(F=y>-1?A[y]:null)&&Xe(F))}function Xe(y){if(typeof y!="number"&&y&&!y.da){var A=y.src;if(A&&A[ne])Te(A.i,y);else{var F=y.type,H=y.proxy;A.removeEventListener?A.removeEventListener(F,H,y.capture):A.detachEvent?A.detachEvent(st(F),H):A.addListener&&A.removeListener&&A.removeListener(H),(F=ot(A))?(Te(F,y),F.h==0&&(F.src=null,A[_e]=null)):ee(y)}}}function st(y){return y in De?De[y]:De[y]="on"+y}function Qe(y,A){if(y.da)y=!0;else{A=new Z(A,this);const F=y.listener,H=y.ha||y.src;y.fa&&Xe(y),y=F.call(H,A)}return y}function ot(y){return y=y[_e],y instanceof ve?y:null}var Xn="__closure_events_fn_"+(Math.random()*1e9>>>0);function xn(y){return typeof y=="function"?y:(y[Xn]||(y[Xn]=function(A){return y.handleEvent(A)}),y[Xn])}function Ye(){P.call(this),this.i=new ve(this),this.M=this,this.G=null}p(Ye,P),Ye.prototype[ne]=!0,Ye.prototype.removeEventListener=function(y,A,F,H){Ze(this,y,A,F,H)};function Rt(y,A){var F,H=y.G;if(H)for(F=[];H;H=H.G)F.push(H);if(y=y.M,H=A.type||A,typeof A=="string")A=new V(A,y);else if(A instanceof V)A.target=A.target||y;else{var ie=A;A=new V(H,y),ce(A,ie)}ie=!0;let he,Ce;if(F)for(Ce=F.length-1;Ce>=0;Ce--)he=A.g=F[Ce],ie=wn(he,H,!0,A)&&ie;if(he=A.g=y,ie=wn(he,H,!0,A)&&ie,ie=wn(he,H,!1,A)&&ie,F)for(Ce=0;Ce<F.length;Ce++)he=A.g=F[Ce],ie=wn(he,H,!1,A)&&ie}Ye.prototype.N=function(){if(Ye.Z.N.call(this),this.i){var y=this.i;for(const A in y.g){const F=y.g[A];for(let H=0;H<F.length;H++)ee(F[H]);delete y.g[A],y.h--}}this.G=null},Ye.prototype.J=function(y,A,F,H){return this.i.add(String(y),A,!1,F,H)},Ye.prototype.K=function(y,A,F,H){return this.i.add(String(y),A,!0,F,H)};function wn(y,A,F,H){if(A=y.i.g[String(A)],!A)return!0;A=A.concat();let ie=!0;for(let he=0;he<A.length;++he){const Ce=A[he];if(Ce&&!Ce.da&&Ce.capture==F){const ut=Ce.listener,gn=Ce.ha||Ce.src;Ce.fa&&Te(y.i,Ce),ie=ut.call(gn,H)!==!1&&ie}}return ie&&!H.defaultPrevented}function jr(y,A){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=h(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:s.setTimeout(y,A||0)}function yr(y){y.g=jr(()=>{y.g=null,y.i&&(y.i=!1,yr(y))},y.l);const A=y.h;y.h=null,y.m.apply(null,A)}class tn extends P{constructor(A,F){super(),this.m=A,this.l=F,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:yr(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ar(y){P.call(this),this.h=y,this.g={}}p(ar,P);var is=[];function bi(y){ue(y.g,function(A,F){this.g.hasOwnProperty(F)&&Xe(A)},y),y.g={}}ar.prototype.N=function(){ar.Z.N.call(this),bi(this)},ar.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ln=s.JSON.stringify,au=s.JSON.parse,gl=class{stringify(y){return s.JSON.stringify(y,void 0)}parse(y){return s.JSON.parse(y,void 0)}};function vl(){}function yl(){}var Or={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function pn(){V.call(this,"d")}p(pn,V);function _r(){V.call(this,"c")}p(_r,V);var mn={},ep=null;function _l(){return ep=ep||new Ye}mn.Ia="serverreachability";function tp(y){V.call(this,mn.Ia,y)}p(tp,V);function da(y){const A=_l();Rt(A,new tp(A))}mn.STAT_EVENT="statevent";function su(y,A){V.call(this,mn.STAT_EVENT,y),this.stat=A}p(su,V);function En(y){const A=_l();Rt(A,new su(A,y))}mn.Ja="timingevent";function pa(y,A){V.call(this,mn.Ja,y),this.size=A}p(pa,V);function ma(y,A){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){y()},A)}function Gi(){this.g=!0}Gi.prototype.ua=function(){this.g=!1};function ey(y,A,F,H,ie,he){y.info(function(){if(y.g)if(he){var Ce="",ut=he.split("&");for(let Dt=0;Dt<ut.length;Dt++){var gn=ut[Dt].split("=");if(gn.length>1){const nn=gn[0];gn=gn[1];const Ti=nn.split("_");Ce=Ti.length>=2&&Ti[1]=="type"?Ce+(nn+"="+gn+"&"):Ce+(nn+"=redacted&")}}}else Ce=null;else Ce=he;return"XMLHTTP REQ ("+H+") [attempt "+ie+"]: "+A+`
`+F+`
`+Ce})}function np(y,A,F,H,ie,he,Ce){y.info(function(){return"XMLHTTP RESP ("+H+") [ attempt "+ie+"]: "+A+`
`+F+`
`+he+" "+Ce})}function ga(y,A,F,H){y.info(function(){return"XMLHTTP TEXT ("+A+"): "+ty(y,F)+(H?" "+H:"")})}function ou(y,A){y.info(function(){return"TIMEOUT: "+A})}Gi.prototype.info=function(){};function ty(y,A){if(!y.g)return A;if(!A)return null;try{const he=JSON.parse(A);if(he){for(y=0;y<he.length;y++)if(Array.isArray(he[y])){var F=he[y];if(!(F.length<2)){var H=F[1];if(Array.isArray(H)&&!(H.length<1)){var ie=H[0];if(ie!="noop"&&ie!="stop"&&ie!="close")for(let Ce=1;Ce<H.length;Ce++)H[Ce]=""}}}}return Ln(he)}catch{return A}}var uu={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Eh={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Th;function lu(){}p(lu,vl),lu.prototype.g=function(){return new XMLHttpRequest},Th=new lu;function as(y){return encodeURIComponent(String(y))}function rp(y){var A=1;y=y.split(":");const F=[];for(;A>0&&y.length;)F.push(y.shift()),A--;return y.length&&F.push(y.join(":")),F}function Wi(y,A,F,H){this.j=y,this.i=A,this.l=F,this.S=H||1,this.V=new ar(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qi}function qi(){this.i=null,this.g="",this.h=!1}var Tn={},Yn={};function va(y,A,F){y.M=1,y.A=cu(Sn(A)),y.u=F,y.R=!0,bl(y,null)}function bl(y,A){y.F=Date.now(),ya(y),y.B=Sn(y.A);var F=y.B,H=y.S;Array.isArray(H)||(H=[String(H)]),Tl(F.i,"t",H),y.C=0,F=y.j.L,y.h=new qi,y.g=yp(y.j,F?A:null,!y.u),y.P>0&&(y.O=new tn(h(y.Y,y,y.g),y.P)),A=y.V,F=y.g,H=y.ba;var ie="readystatechange";Array.isArray(ie)||(ie&&(is[0]=ie.toString()),ie=is);for(let he=0;he<ie.length;he++){const Ce=Re(F,ie[he],H||A.handleEvent,!1,A.h||A);if(!Ce)break;A.g[Ce.key]=Ce}A=y.J?W(y.J):{},y.u?(y.v||(y.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,A)):(y.v="GET",y.g.ea(y.B,y.v,null,A)),da(),ey(y.i,y.v,y.B,y.l,y.S,y.u)}Wi.prototype.ba=function(y){y=y.target;const A=this.O;A&&Yi(y)==3?A.j():this.Y(y)},Wi.prototype.Y=function(y){try{if(y==this.g)e:{const ut=Yi(this.g),gn=this.g.ya(),Dt=this.g.ca();if(!(ut<3)&&(ut!=3||this.g&&(this.h.h||this.g.la()||sr(this.g)))){this.K||ut!=4||gn==7||(gn==8||Dt<=0?da(3):da(2)),_a(this);var A=this.g.ca();this.X=A;var F=ny(this);if(this.o=A==200,np(this.i,this.v,this.B,this.l,this.S,ut,A),this.o){if(this.U&&!this.L){t:{if(this.g){var H,ie=this.g;if((H=ie.g?ie.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(H)){var he=H;break t}}he=null}if(y=he)ga(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ba(this,y);else{this.o=!1,this.m=3,En(12),ri(this),xi(this);break e}}if(this.R){y=!0;let nn;for(;!this.K&&this.C<F.length;)if(nn=ap(this,F),nn==Yn){ut==4&&(this.m=4,En(14),y=!1),ga(this.i,this.l,null,"[Incomplete Response]");break}else if(nn==Tn){this.m=4,En(15),ga(this.i,this.l,F,"[Invalid Chunk]"),y=!1;break}else ga(this.i,this.l,nn,null),ba(this,nn);if(ip(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ut!=4||F.length!=0||this.h.h||(this.m=1,En(16),y=!1),this.o=this.o&&y,!y)ga(this.i,this.l,F,"[Invalid Chunked Response]"),ri(this),xi(this);else if(F.length>0&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.aa&&!Ce.P&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Bh(Ce),Ce.P=!0,En(11))}}else ga(this.i,this.l,F,null),ba(this,F);ut==4&&ri(this),this.o&&!this.K&&(ut==4?pp(this.j,this):(this.o=!1,ya(this)))}else os(this.g),A==400&&F.indexOf("Unknown SID")>0?(this.m=3,En(12)):(this.m=0,En(13)),ri(this),xi(this)}}}catch{}};function ny(y){if(!ip(y))return y.g.la();const A=sr(y.g);if(A==="")return"";let F="";const H=A.length,ie=Yi(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return ri(y),xi(y),"";y.h.i=new s.TextDecoder}for(let he=0;he<H;he++)y.h.h=!0,F+=y.h.i.decode(A[he],{stream:!(ie&&he==H-1)});return A.length=0,y.h.g+=F,y.C=0,y.h.g}function ip(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function ap(y,A){var F=y.C,H=A.indexOf(`
`,F);return H==-1?Yn:(F=Number(A.substring(F,H)),isNaN(F)?Tn:(H+=1,H+F>A.length?Yn:(A=A.slice(H,H+F),y.C=H+F,A)))}Wi.prototype.cancel=function(){this.K=!0,ri(this)};function ya(y){y.T=Date.now()+y.H,xl(y,y.H)}function xl(y,A){if(y.D!=null)throw Error("WatchDog timer not null");y.D=ma(h(y.aa,y),A)}function _a(y){y.D&&(s.clearTimeout(y.D),y.D=null)}Wi.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(ou(this.i,this.B),this.M!=2&&(da(),En(17)),ri(this),this.m=2,xi(this)):xl(this,this.T-y)};function xi(y){y.j.I==0||y.K||pp(y.j,y)}function ri(y){_a(y);var A=y.O;A&&typeof A.dispose=="function"&&A.dispose(),y.O=null,bi(y.V),y.g&&(A=y.g,y.g=null,A.abort(),A.dispose())}function ba(y,A){try{var F=y.j;if(F.I!=0&&(F.g==y||wa(F.h,y))){if(!y.L&&wa(F.h,y)&&F.I==3){try{var H=F.Ba.g.parse(A)}catch{H=null}if(Array.isArray(H)&&H.length==3){var ie=H;if(ie[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<y.F)Il(F),Js(F);else break e;vu(F),En(18)}}else F.xa=ie[1],0<F.xa-F.K&&ie[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=ma(h(F.Va,F),6e3));xa(F.h)<=1&&F.ta&&(F.ta=void 0)}else Ra(F,11)}else if((y.L||F.g==y)&&Il(F),!L(A))for(ie=F.Ba.g.parse(A),A=0;A<ie.length;A++){let Dt=ie[A];const nn=Dt[0];if(!(nn<=F.K))if(F.K=nn,Dt=Dt[1],F.I==2)if(Dt[0]=="c"){F.M=Dt[1],F.ba=Dt[2];const Ti=Dt[3];Ti!=null&&(F.ka=Ti,F.j.info("VER="+F.ka));const Ia=Dt[4];Ia!=null&&(F.za=Ia,F.j.info("SVER="+F.za));const $i=Dt[5];$i!=null&&typeof $i=="number"&&$i>0&&(H=1.5*$i,F.O=H,F.j.info("backChannelRequestTimeoutMs_="+H)),H=F;const Qi=y.g;if(Qi){const yu=Qi.g?Qi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yu){var he=H.h;he.g||yu.indexOf("spdy")==-1&&yu.indexOf("quic")==-1&&yu.indexOf("h2")==-1||(he.j=he.l,he.g=new Set,he.h&&(Ah(he,he.h),he.h=null))}if(H.G){const Nl=Qi.g?Qi.g.getResponseHeader("X-HTTP-Session-Id"):null;Nl&&(H.wa=Nl,Vt(H.J,H.G,Nl))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-y.F,F.j.info("Handshake RTT: "+F.T+"ms")),H=F;var Ce=y;if(H.na=vp(H,H.L?H.ba:null,H.W),Ce.L){Rh(H.h,Ce);var ut=Ce,gn=H.O;gn&&(ut.H=gn),ut.D&&(_a(ut),ya(ut)),H.g=Ce}else fp(H);F.i.length>0&&Aa(F)}else Dt[0]!="stop"&&Dt[0]!="close"||Ra(F,7);else F.I==3&&(Dt[0]=="stop"||Dt[0]=="close"?Dt[0]=="stop"?Ra(F,7):Vh(F):Dt[0]!="noop"&&F.l&&F.l.qa(Dt),F.A=0)}}da(4)}catch{}}var Cn=class{constructor(y,A){this.g=y,this.map=A}};function Ch(y){this.l=y||10,s.PerformanceNavigationTiming?(y=s.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Sh(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function xa(y){return y.h?1:y.g?y.g.size:0}function wa(y,A){return y.h?y.h==A:y.g?y.g.has(A):!1}function Ah(y,A){y.g?y.g.add(A):y.h=A}function Rh(y,A){y.h&&y.h==A?y.h=null:y.g&&y.g.has(A)&&y.g.delete(A)}Ch.prototype.cancel=function(){if(this.i=Ih(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Ih(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let A=y.i;for(const F of y.g.values())A=A.concat(F.G);return A}return v(y.i)}var sp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wl(y,A){if(y){y=y.split("&");for(let F=0;F<y.length;F++){const H=y[F].indexOf("=");let ie,he=null;H>=0?(ie=y[F].substring(0,H),he=y[F].substring(H+1)):ie=y[F],A(ie,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}function ii(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;y instanceof ii?(this.l=y.l,$n(this,y.j),this.o=y.o,this.g=y.g,qs(this,y.u),this.h=y.h,Nh(this,cp(y.i)),this.m=y.m):y&&(A=String(y).match(sp))?(this.l=!1,$n(this,A[1]||"",!0),this.o=Ea(A[2]||""),this.g=Ea(A[3]||"",!0),qs(this,A[4]),this.h=Ea(A[5]||"",!0),Nh(this,A[6]||"",!0),this.m=Ea(A[7]||"")):(this.l=!1,this.i=new Xs(null,this.l))}ii.prototype.toString=function(){const y=[];var A=this.j;A&&y.push(hu(A,El,!0),":");var F=this.g;return(F||A=="file")&&(y.push("//"),(A=this.o)&&y.push(hu(A,El,!0),"@"),y.push(as(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&y.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&y.push("/"),y.push(hu(F,F.charAt(0)=="/"?Dh:op,!0))),(F=this.i.toString())&&y.push("?",F),(F=this.m)&&y.push("#",hu(F,up)),y.join("")},ii.prototype.resolve=function(y){const A=Sn(this);let F=!!y.j;F?$n(A,y.j):F=!!y.o,F?A.o=y.o:F=!!y.g,F?A.g=y.g:F=y.u!=null;var H=y.h;if(F)qs(A,y.u);else if(F=!!y.h){if(H.charAt(0)!="/")if(this.g&&!this.h)H="/"+H;else{var ie=A.h.lastIndexOf("/");ie!=-1&&(H=A.h.slice(0,ie+1)+H)}if(ie=H,ie==".."||ie==".")H="";else if(ie.indexOf("./")!=-1||ie.indexOf("/.")!=-1){H=ie.lastIndexOf("/",0)==0,ie=ie.split("/");const he=[];for(let Ce=0;Ce<ie.length;){const ut=ie[Ce++];ut=="."?H&&Ce==ie.length&&he.push(""):ut==".."?((he.length>1||he.length==1&&he[0]!="")&&he.pop(),H&&Ce==ie.length&&he.push("")):(he.push(ut),H=!0)}H=he.join("/")}else H=ie}return F?A.h=H:F=y.i.toString()!=="",F?Nh(A,cp(y.i)):F=!!y.m,F&&(A.m=y.m),A};function Sn(y){return new ii(y)}function $n(y,A,F){y.j=F?Ea(A,!0):A,y.j&&(y.j=y.j.replace(/:$/,""))}function qs(y,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);y.u=A}else y.u=null}function Nh(y,A,F){A instanceof Xs?(y.i=A,Cl(y.i,y.l)):(F||(A=hu(A,Ks)),y.i=new Xs(A,y.l))}function Vt(y,A,F){y.i.set(A,F)}function cu(y){return Vt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function Ea(y,A){return y?A?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function hu(y,A,F){return typeof y=="string"?(y=encodeURI(y).replace(A,Ur),F&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function Ur(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var El=/[#\/\?@]/g,op=/[#\?:]/g,Dh=/[#\?]/g,Ks=/[#\?@]/g,up=/#/g;function Xs(y,A){this.h=this.g=null,this.i=y||null,this.j=!!A}function zr(y){y.g||(y.g=new Map,y.h=0,y.i&&wl(y.i,function(A,F){y.add(decodeURIComponent(A.replace(/\+/g," ")),F)}))}n=Xs.prototype,n.add=function(y,A){zr(this),this.i=null,y=Ys(this,y);let F=this.g.get(y);return F||this.g.set(y,F=[]),F.push(A),this.h+=1,this};function lp(y,A){zr(y),A=Ys(y,A),y.g.has(A)&&(y.i=null,y.h-=y.g.get(A).length,y.g.delete(A))}function kh(y,A){return zr(y),A=Ys(y,A),y.g.has(A)}n.forEach=function(y,A){zr(this),this.g.forEach(function(F,H){F.forEach(function(ie){y.call(A,ie,H,this)},this)},this)};function Mh(y,A){zr(y);let F=[];if(typeof A=="string")kh(y,A)&&(F=F.concat(y.g.get(Ys(y,A))));else for(y=Array.from(y.g.values()),A=0;A<y.length;A++)F=F.concat(y[A]);return F}n.set=function(y,A){return zr(this),this.i=null,y=Ys(this,y),kh(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[A]),this.h+=1,this},n.get=function(y,A){return y?(y=Mh(this,y),y.length>0?String(y[0]):A):A};function Tl(y,A,F){lp(y,A),F.length>0&&(y.i=null,y.g.set(Ys(y,A),v(F)),y.h+=F.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],A=Array.from(this.g.keys());for(let H=0;H<A.length;H++){var F=A[H];const ie=as(F);F=Mh(this,F);for(let he=0;he<F.length;he++){let Ce=ie;F[he]!==""&&(Ce+="="+as(F[he])),y.push(Ce)}}return this.i=y.join("&")};function cp(y){const A=new Xs;return A.i=y.i,y.g&&(A.g=new Map(y.g),A.h=y.h),A}function Ys(y,A){return A=String(A),y.j&&(A=A.toLowerCase()),A}function Cl(y,A){A&&!y.j&&(zr(y),y.i=null,y.g.forEach(function(F,H){const ie=H.toLowerCase();H!=ie&&(lp(this,H),Tl(this,ie,F))},y)),y.j=A}function Ki(y,A){const F=new Gi;if(s.Image){const H=new Image;H.onload=d(wi,F,"TestLoadImage: loaded",!0,A,H),H.onerror=d(wi,F,"TestLoadImage: error",!1,A,H),H.onabort=d(wi,F,"TestLoadImage: abort",!1,A,H),H.ontimeout=d(wi,F,"TestLoadImage: timeout",!1,A,H),s.setTimeout(function(){H.ontimeout&&H.ontimeout()},1e4),H.src=y}else A(!1)}function Oh(y,A){const F=new Gi,H=new AbortController,ie=setTimeout(()=>{H.abort(),wi(F,"TestPingServer: timeout",!1,A)},1e4);fetch(y,{signal:H.signal}).then(he=>{clearTimeout(ie),he.ok?wi(F,"TestPingServer: ok",!0,A):wi(F,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(ie),wi(F,"TestPingServer: error",!1,A)})}function wi(y,A,F,H,ie){try{ie&&(ie.onload=null,ie.onerror=null,ie.onabort=null,ie.ontimeout=null),H(F)}catch{}}function $s(){this.g=new gl}function Ta(y){this.i=y.Sb||null,this.h=y.ab||!1}p(Ta,vl),Ta.prototype.g=function(){return new fu(this.i,this.h)};function fu(y,A){Ye.call(this),this.H=y,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(fu,Ye),n=fu.prototype,n.open=function(y,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=A,this.readyState=1,Xi(this)},n.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(A.body=y),(this.H||s).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Qs(this)),this.readyState=0},n.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Xi(this)),this.g&&(this.readyState=3,Xi(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Sl(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Sl(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}n.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var A=y.value?y.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!y.done}))&&(this.response=this.responseText+=A)}y.done?Qs(this):Xi(this),this.readyState==3&&Sl(this)}},n.Oa=function(y){this.g&&(this.response=this.responseText=y,Qs(this))},n.Na=function(y){this.g&&(this.response=y,Qs(this))},n.ga=function(){this.g&&Qs(this)};function Qs(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Xi(y)}n.setRequestHeader=function(y,A){this.A.append(y,A)},n.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],A=this.h.entries();for(var F=A.next();!F.done;)F=F.value,y.push(F[0]+": "+F[1]),F=A.next();return y.join(`\r
`)};function Xi(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(fu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Ei(y){let A="";return ue(y,function(F,H){A+=H,A+=":",A+=F,A+=`\r
`}),A}function du(y,A,F){e:{for(H in F){var H=!1;break e}H=!0}H||(F=Ei(F),typeof y=="string"?F!=null&&as(F):Vt(y,A,F))}function jt(y){Ye.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(jt,Ye);var Ca=/^https?$/i,Ph=["POST","PUT"];n=jt.prototype,n.Fa=function(y){this.H=y},n.ea=function(y,A,F,H){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);A=A?A.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Th.g(),this.g.onreadystatechange=g(h(this.Ca,this));try{this.B=!0,this.g.open(A,String(y),!0),this.B=!1}catch(he){pu(this,he);return}if(y=F||"",F=new Map(this.headers),H)if(Object.getPrototypeOf(H)===Object.prototype)for(var ie in H)F.set(ie,H[ie]);else if(typeof H.keys=="function"&&typeof H.get=="function")for(const he of H.keys())F.set(he,H.get(he));else throw Error("Unknown input type for opt_headers: "+String(H));H=Array.from(F.keys()).find(he=>he.toLowerCase()=="content-type"),ie=s.FormData&&y instanceof s.FormData,!(Array.prototype.indexOf.call(Ph,A,void 0)>=0)||H||ie||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[he,Ce]of F)this.g.setRequestHeader(he,Ce);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(he){pu(this,he)}};function pu(y,A){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=A,y.o=5,Fh(y),ss(y)}function Fh(y){y.A||(y.A=!0,Rt(y,"complete"),Rt(y,"error"))}n.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Rt(this,"complete"),Rt(this,"abort"),ss(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ss(this,!0)),jt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?mu(this):this.Xa())},n.Xa=function(){mu(this)};function mu(y){if(y.h&&typeof a<"u"){if(y.v&&Yi(y)==4)setTimeout(y.Ca.bind(y),0);else if(Rt(y,"readystatechange"),Yi(y)==4){y.h=!1;try{const he=y.ca();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var F;if(!(F=A)){var H;if(H=he===0){let Ce=String(y.D).match(sp)[1]||null;!Ce&&s.self&&s.self.location&&(Ce=s.self.location.protocol.slice(0,-1)),H=!Ca.test(Ce?Ce.toLowerCase():"")}F=H}if(F)Rt(y,"complete"),Rt(y,"success");else{y.o=6;try{var ie=Yi(y)>2?y.g.statusText:""}catch{ie=""}y.l=ie+" ["+y.ca()+"]",Fh(y)}}finally{ss(y)}}}}function ss(y,A){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const F=y.g;y.g=null,A||Rt(y,"ready");try{F.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yi(y){return y.g?y.g.readyState:0}n.ca=function(){try{return Yi(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(y){if(this.g){var A=this.g.responseText;return y&&A.indexOf(y)==0&&(A=A.substring(y.length)),au(A)}};function sr(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function os(y){const A={};y=(y.g&&Yi(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let H=0;H<y.length;H++){if(L(y[H]))continue;var F=rp(y[H]);const ie=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const he=A[ie]||[];A[ie]=he,he.push(F)}fe(A,function(H){return H.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sa(y,A,F){return F&&F.internalChannelParams&&F.internalChannelParams[y]||A}function Zs(y){this.za=0,this.i=[],this.j=new Gi,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Sa("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Sa("baseRetryDelayMs",5e3,y),this.Za=Sa("retryDelaySeedMs",1e4,y),this.Ta=Sa("forwardChannelMaxRetries",2,y),this.va=Sa("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new Ch(y&&y.concurrentRequestLimit),this.Ba=new $s,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Zs.prototype,n.ka=8,n.I=1,n.connect=function(y,A,F,H){En(0),this.W=y,this.H=A||{},F&&H!==void 0&&(this.H.OSID=F,this.H.OAID=H),this.F=this.X,this.J=vp(this,null,this.W),Aa(this)};function Vh(y){if(Al(y),y.I==3){var A=y.V++,F=Sn(y.J);if(Vt(F,"SID",y.M),Vt(F,"RID",A),Vt(F,"TYPE","terminate"),gu(y,F),A=new Wi(y,y.j,A),A.M=2,A.A=cu(Sn(F)),F=!1,s.navigator&&s.navigator.sendBeacon)try{F=s.navigator.sendBeacon(A.A.toString(),"")}catch{}!F&&s.Image&&(new Image().src=A.A,F=!0),F||(A.g=yp(A.j,null),A.g.ea(A.A)),A.F=Date.now(),ya(A)}gp(y)}function Js(y){y.g&&(Bh(y),y.g.cancel(),y.g=null)}function Al(y){Js(y),y.v&&(s.clearTimeout(y.v),y.v=null),Il(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&s.clearTimeout(y.m),y.m=null)}function Aa(y){if(!Sh(y.h)&&!y.m){y.m=!0;var A=y.Ea;O||R(),B||(O(),B=!0),N.add(A,y),y.D=0}}function Rl(y,A){return xa(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=A.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=ma(h(y.Ea,y,A),mp(y,y.D)),y.D++,!0)}n.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const ie=new Wi(this,this.j,y);let he=this.o;if(this.U&&(he?(he=W(he),ce(he,this.U)):he=this.U),this.u!==null||this.R||(ie.J=he,he=null),this.S)e:{for(var A=0,F=0;F<this.i.length;F++){t:{var H=this.i[F];if("__data__"in H.map&&(H=H.map.__data__,typeof H=="string")){H=H.length;break t}H=void 0}if(H===void 0)break;if(A+=H,A>4096){A=F;break e}if(A===4096||F===this.i.length-1){A=F+1;break e}}A=1e3}else A=1e3;A=hp(this,ie,A),F=Sn(this.J),Vt(F,"RID",y),Vt(F,"CVER",22),this.G&&Vt(F,"X-HTTP-Session-Id",this.G),gu(this,F),he&&(this.R?A="headers="+as(Ei(he))+"&"+A:this.u&&du(F,this.u,he)),Ah(this.h,ie),this.Ra&&Vt(F,"TYPE","init"),this.S?(Vt(F,"$req",A),Vt(F,"SID","null"),ie.U=!0,va(ie,F,null)):va(ie,F,A),this.I=2}}else this.I==3&&(y?Lh(this,y):this.i.length==0||Sh(this.h)||Lh(this))};function Lh(y,A){var F;A?F=A.l:F=y.V++;const H=Sn(y.J);Vt(H,"SID",y.M),Vt(H,"RID",F),Vt(H,"AID",y.K),gu(y,H),y.u&&y.o&&du(H,y.u,y.o),F=new Wi(y,y.j,F,y.D+1),y.u===null&&(F.J=y.o),A&&(y.i=A.G.concat(y.i)),A=hp(y,F,1e3),F.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),Ah(y.h,F),va(F,H,A)}function gu(y,A){y.H&&ue(y.H,function(F,H){Vt(A,H,F)}),y.l&&ue({},function(F,H){Vt(A,H,F)})}function hp(y,A,F){F=Math.min(y.i.length,F);const H=y.l?h(y.l.Ka,y.l,y):null;e:{var ie=y.i;let ut=-1;for(;;){const gn=["count="+F];ut==-1?F>0?(ut=ie[0].g,gn.push("ofs="+ut)):ut=0:gn.push("ofs="+ut);let Dt=!0;for(let nn=0;nn<F;nn++){var he=ie[nn].g;const Ti=ie[nn].map;if(he-=ut,he<0)ut=Math.max(0,ie[nn].g-100),Dt=!1;else try{he="req"+he+"_"||"";try{var Ce=Ti instanceof Map?Ti:Object.entries(Ti);for(const[Ia,$i]of Ce){let Qi=$i;u($i)&&(Qi=Ln($i)),gn.push(he+Ia+"="+encodeURIComponent(Qi))}}catch(Ia){throw gn.push(he+"type="+encodeURIComponent("_badmap")),Ia}}catch{H&&H(Ti)}}if(Dt){Ce=gn.join("&");break e}}Ce=void 0}return y=y.i.splice(0,F),A.G=y,Ce}function fp(y){if(!y.g&&!y.v){y.Y=1;var A=y.Da;O||R(),B||(O(),B=!0),N.add(A,y),y.A=0}}function vu(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=ma(h(y.Da,y),mp(y,y.A)),y.A++,!0)}n.Da=function(){if(this.v=null,dp(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=ma(h(this.Wa,this),y)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,En(10),Js(this),dp(this))};function Bh(y){y.B!=null&&(s.clearTimeout(y.B),y.B=null)}function dp(y){y.g=new Wi(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var A=Sn(y.na);Vt(A,"RID","rpc"),Vt(A,"SID",y.M),Vt(A,"AID",y.K),Vt(A,"CI",y.F?"0":"1"),!y.F&&y.ia&&Vt(A,"TO",y.ia),Vt(A,"TYPE","xmlhttp"),gu(y,A),y.u&&y.o&&du(A,y.u,y.o),y.O&&(y.g.H=y.O);var F=y.g;y=y.ba,F.M=1,F.A=cu(Sn(A)),F.u=null,F.R=!0,bl(F,y)}n.Va=function(){this.C!=null&&(this.C=null,Js(this),vu(this),En(19))};function Il(y){y.C!=null&&(s.clearTimeout(y.C),y.C=null)}function pp(y,A){var F=null;if(y.g==A){Il(y),Bh(y),y.g=null;var H=2}else if(wa(y.h,A))F=A.G,Rh(y.h,A),H=1;else return;if(y.I!=0){if(A.o)if(H==1){F=A.u?A.u.length:0,A=Date.now()-A.F;var ie=y.D;H=_l(),Rt(H,new pa(H,F)),Aa(y)}else fp(y);else if(ie=A.m,ie==3||ie==0&&A.X>0||!(H==1&&Rl(y,A)||H==2&&vu(y)))switch(F&&F.length>0&&(A=y.h,A.i=A.i.concat(F)),ie){case 1:Ra(y,5);break;case 4:Ra(y,10);break;case 3:Ra(y,6);break;default:Ra(y,2)}}}function mp(y,A){let F=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(F*=2),F*A}function Ra(y,A){if(y.j.info("Error code "+A),A==2){var F=h(y.bb,y),H=y.Ua;const ie=!H;H=new ii(H||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||$n(H,"https"),cu(H),ie?Ki(H.toString(),F):Oh(H.toString(),F)}else En(2);y.I=0,y.l&&y.l.pa(A),gp(y),Al(y)}n.bb=function(y){y?(this.j.info("Successfully pinged google.com"),En(2)):(this.j.info("Failed to ping google.com"),En(1))};function gp(y){if(y.I=0,y.ja=[],y.l){const A=Ih(y.h);(A.length!=0||y.i.length!=0)&&(b(y.ja,A),b(y.ja,y.i),y.h.i.length=0,v(y.i),y.i.length=0),y.l.oa()}}function vp(y,A,F){var H=F instanceof ii?Sn(F):new ii(F);if(H.g!="")A&&(H.g=A+"."+H.g),qs(H,H.u);else{var ie=s.location;H=ie.protocol,A=A?A+"."+ie.hostname:ie.hostname,ie=+ie.port;const he=new ii(null);H&&$n(he,H),A&&(he.g=A),ie&&qs(he,ie),F&&(he.h=F),H=he}return F=y.G,A=y.wa,F&&A&&Vt(H,F,A),Vt(H,"VER",y.ka),gu(y,H),H}function yp(y,A,F){if(A&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=y.Aa&&!y.ma?new jt(new Ta({ab:F})):new jt(y.ma),A.Fa(y.L),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _p(){}n=_p.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function eo(){}eo.prototype.g=function(y,A){return new Pr(y,A)};function Pr(y,A){Ye.call(this),this.g=new Zs(A),this.l=y,this.h=A&&A.messageUrlParams||null,y=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(y?y["X-WebChannel-Content-Type"]=A.messageContentType:y={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(y?y["X-WebChannel-Client-Profile"]=A.sa:y={"X-WebChannel-Client-Profile":A.sa}),this.g.U=y,(y=A&&A.Qb)&&!L(y)&&(this.g.u=y),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!L(A)&&(this.g.G=A,y=this.h,y!==null&&A in y&&(y=this.h,A in y&&delete y[A])),this.j=new us(this)}p(Pr,Ye),Pr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Pr.prototype.close=function(){Vh(this.g)},Pr.prototype.o=function(y){var A=this.g;if(typeof y=="string"){var F={};F.__data__=y,y=F}else this.v&&(F={},F.__data__=Ln(y),y=F);A.i.push(new Cn(A.Ya++,y)),A.I==3&&Aa(A)},Pr.prototype.N=function(){this.g.l=null,delete this.j,Vh(this.g),delete this.g,Pr.Z.N.call(this)};function bp(y){pn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var A=y.__sm__;if(A){e:{for(const F in A){y=F;break e}y=void 0}(this.i=y)&&(y=this.i,A=A!==null&&y in A?A[y]:void 0),this.data=A}else this.data=y}p(bp,pn);function xp(){_r.call(this),this.status=1}p(xp,_r);function us(y){this.g=y}p(us,_p),us.prototype.ra=function(){Rt(this.g,"a")},us.prototype.qa=function(y){Rt(this.g,new bp(y))},us.prototype.pa=function(y){Rt(this.g,new xp)},us.prototype.oa=function(){Rt(this.g,"b")},eo.prototype.createWebChannel=eo.prototype.g,Pr.prototype.send=Pr.prototype.o,Pr.prototype.open=Pr.prototype.m,Pr.prototype.close=Pr.prototype.close,B3=function(){return new eo},L3=function(){return _l()},V3=mn,a1={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},uu.NO_ERROR=0,uu.TIMEOUT=8,uu.HTTP_ERROR=6,ng=uu,Eh.COMPLETE="complete",F3=Eh,yl.EventType=Or,Or.OPEN="a",Or.CLOSE="b",Or.ERROR="c",Or.MESSAGE="d",Ye.prototype.listen=Ye.prototype.J,Ff=yl,jt.prototype.listenOnce=jt.prototype.K,jt.prototype.getLastError=jt.prototype.Ha,jt.prototype.getLastErrorCode=jt.prototype.ya,jt.prototype.getStatus=jt.prototype.ca,jt.prototype.getResponseJson=jt.prototype.La,jt.prototype.getResponseText=jt.prototype.la,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Fa,P3=jt}).apply(typeof Hm<"u"?Hm:typeof self<"u"?self:typeof window<"u"?window:{});const MR="@firebase/firestore",OR="4.9.3";class Er{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Er.UNAUTHENTICATED=new Er(null),Er.GOOGLE_CREDENTIALS=new Er("google-credentials-uid"),Er.FIRST_PARTY=new Er("first-party-uid"),Er.MOCK_USER=new Er("mock-user");let dh="12.7.0";const nl=new Tw("@firebase/firestore");function gc(){return nl.logLevel}function ke(n,...e){if(nl.logLevel<=xt.DEBUG){const t=e.map(Sw);nl.debug(`Firestore (${dh}): ${n}`,...t)}}function Ps(n,...e){if(nl.logLevel<=xt.ERROR){const t=e.map(Sw);nl.error(`Firestore (${dh}): ${n}`,...t)}}function Zc(n,...e){if(nl.logLevel<=xt.WARN){const t=e.map(Sw);nl.warn(`Firestore (${dh}): ${n}`,...t)}}function Sw(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $e(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,j3(n,r,t)}function j3(n,e,t){let r=`FIRESTORE (${dh}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ps(r),new Error(r)}function Pt(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||j3(e,i,r)}function at(n,e){return n}const be={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ne extends fh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Vo{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class U3{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rK{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Er.UNAUTHENTICATED)))}shutdown(){}}class iK{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class aK{constructor(e){this.t=e,this.currentUser=Er.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Pt(this.o===void 0,42304);let r=this.i;const i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let a=new Vo;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Vo,e.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const c=a;e.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},u=c=>{ke("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((c=>u(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(ke("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Vo)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(ke("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Pt(typeof r.accessToken=="string",31837,{l:r}),new U3(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Pt(e===null||typeof e=="string",2055,{h:e}),new Er(e)}}class sK{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Er.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class oK{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new sK(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Er.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class PR{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uK{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,R3(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Pt(this.o===void 0,3512);const r=a=>{a.error!=null&&ke("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const s=a.token!==this.m;return this.m=a.token,ke("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable((()=>r(a)))};const i=a=>{ke("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((a=>i(a))),setTimeout((()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?i(a):ke("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new PR(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Pt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new PR(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function lK(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Aw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=lK(40);for(let a=0;a<i.length;++a)r.length<20&&i[a]<t&&(r+=e.charAt(i[a]%62))}return r}}function yt(n,e){return n<e?-1:n>e?1:0}function s1(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),a=e.charAt(r);if(i!==a)return X_(i)===X_(a)?yt(i,a):X_(i)?1:-1}return yt(n.length,e.length)}const cK=55296,hK=57343;function X_(n){const e=n.charCodeAt(0);return e>=cK&&e<=hK}function Jc(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}const FR="__name__";class Va{constructor(e,t,r){t===void 0?t=0:t>e.length&&$e(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$e(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Va.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Va?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const a=Va.compareSegments(e.get(i),t.get(i));if(a!==0)return a}return yt(e.length,t.length)}static compareSegments(e,t){const r=Va.isNumericId(e),i=Va.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Va.extractNumericId(e).compare(Va.extractNumericId(t)):s1(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Fo.fromString(e.substring(4,e.length-2))}}class qt extends Va{construct(e,t,r){return new qt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ne(be.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new qt(t)}static emptyPath(){return new qt([])}}const fK=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gr extends Va{construct(e,t,r){return new gr(e,t,r)}static isValidIdentifier(e){return fK.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===FR}static keyField(){return new gr([FR])}static fromServerFormat(e){const t=[];let r="",i=0;const a=()=>{if(r.length===0)throw new Ne(be.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let s=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Ne(be.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Ne(be.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else u==="`"?(s=!s,i++):u!=="."||s?(r+=u,i++):(a(),i++)}if(a(),s)throw new Ne(be.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new gr(t)}static emptyPath(){return new gr([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We(qt.fromString(e))}static fromName(e){return new We(qt.fromString(e).popFirst(5))}static empty(){return new We(qt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&qt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return qt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new qt(e.slice()))}}function z3(n,e,t){if(!t)throw new Ne(be.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dK(n,e,t,r){if(e===!0&&r===!0)throw new Ne(be.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function VR(n){if(!We.isDocumentKey(n))throw new Ne(be.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function LR(n){if(We.isDocumentKey(n))throw new Ne(be.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function H3(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Iv(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$e(12329,{type:typeof n})}function Fs(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ne(be.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Iv(n);throw new Ne(be.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function pK(n,e){if(e<=0)throw new Ne(be.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Pn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Hd(n,e){if(!H3(n))throw new Ne(be.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,a="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const s=n[r];if(i&&typeof s!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(a!==void 0&&s!==a.value){t=`Expected '${r}' field to equal '${a.value}'`;break}}if(t)throw new Ne(be.INVALID_ARGUMENT,t);return!0}const BR=-62135596800,jR=1e6;class Jt{static now(){return Jt.fromMillis(Date.now())}static fromDate(e){return Jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*jR);return new Jt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ne(be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ne(be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<BR)throw new Ne(be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ne(be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/jR}_compareTo(e){return this.seconds===e.seconds?yt(this.nanoseconds,e.nanoseconds):yt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Jt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Hd(e,Jt._jsonSchema))return new Jt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-BR;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Jt._jsonSchemaVersion="firestore/timestamp/1.0",Jt._jsonSchema={type:Pn("string",Jt._jsonSchemaVersion),seconds:Pn("number"),nanoseconds:Pn("number")};class tt{static fromTimestamp(e){return new tt(e)}static min(){return new tt(new Jt(0,0))}static max(){return new tt(new Jt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const vd=-1;function mK(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=tt.fromTimestamp(r===1e9?new Jt(t+1,0):new Jt(t,r));return new Wo(i,We.empty(),e)}function gK(n){return new Wo(n.readTime,n.key,vd)}class Wo{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Wo(tt.min(),We.empty(),vd)}static max(){return new Wo(tt.max(),We.empty(),vd)}}function vK(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=We.comparator(n.documentKey,e.documentKey),t!==0?t:yt(n.largestBatchId,e.largestBatchId))}const yK="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _K{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ph(n){if(n.code!==be.FAILED_PRECONDITION||n.message!==yK)throw n;ke("LocalStore","Unexpectedly lost primary lease")}class we{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$e(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new we(((r,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,i)},this.catchCallback=a=>{this.wrapFailure(t,a).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof we?t:we.resolve(t)}catch(t){return we.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):we.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):we.reject(t)}static resolve(e){return new we(((t,r)=>{t(e)}))}static reject(e){return new we(((t,r)=>{r(e)}))}static waitFor(e){return new we(((t,r)=>{let i=0,a=0,s=!1;e.forEach((u=>{++i,u.next((()=>{++a,s&&a===i&&t()}),(c=>r(c)))})),s=!0,a===i&&t()}))}static or(e){let t=we.resolve(!1);for(const r of e)t=t.next((i=>i?we.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,a)=>{r.push(t.call(this,i,a))})),this.waitFor(r)}static mapArray(e,t){return new we(((r,i)=>{const a=e.length,s=new Array(a);let u=0;for(let c=0;c<a;c++){const h=c;t(e[h]).next((d=>{s[h]=d,++u,u===a&&r(s)}),(d=>i(d)))}}))}static doWhile(e,t){return new we(((r,i)=>{const a=()=>{e()===!0?t().next((()=>{a()}),i):r()};a()}))}}function bK(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function mh(n){return n.name==="IndexedDbTransactionError"}class Nv{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Nv.ce=-1;const Rw=-1;function Dv(n){return n==null}function zg(n){return n===0&&1/n==-1/0}function xK(n){return typeof n=="number"&&Number.isInteger(n)&&!zg(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const G3="";function wK(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=UR(e)),e=EK(n.get(t),e);return UR(e)}function EK(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const a=n.charAt(i);switch(a){case"\0":t+="";break;case G3:t+="";break;default:t+=a}}return t}function UR(n){return n+G3+""}function zR(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function nu(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function W3(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}let Vn=class o1{constructor(e,t){this.comparator=e,this.root=t||Lo.EMPTY}insert(e,t){return new o1(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Lo.BLACK,null,null))}remove(e){return new o1(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Lo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gm(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gm(this.root,e,this.comparator,!0)}},Gm=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?r(e.key,t):1,t&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Lo=class Ss{constructor(e,t,r,i,a){this.key=e,this.value=t,this.color=r??Ss.RED,this.left=i??Ss.EMPTY,this.right=a??Ss.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,a){return new Ss(e??this.key,t??this.value,r??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const a=r(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,t,r),null):a===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ss.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ss.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ss.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ss.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $e(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $e(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $e(27949);return e+(this.isRed()?0:1)}};Lo.EMPTY=null,Lo.RED=!0,Lo.BLACK=!1;Lo.EMPTY=new class{constructor(){this.size=0}get key(){throw $e(57766)}get value(){throw $e(16141)}get color(){throw $e(16727)}get left(){throw $e(29726)}get right(){throw $e(36894)}copy(e,t,r,i,a){return this}insert(e,t,r){return new Lo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Gn{constructor(e){this.comparator=e,this.data=new Vn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new HR(this.data.getIterator())}getIteratorFrom(e){return new HR(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Gn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=r.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Gn(this.comparator);return t.data=e,t}}class HR{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class vi{constructor(e){this.fields=e,e.sort(gr.comparator)}static empty(){return new vi([])}unionWith(e){let t=new Gn(gr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new vi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jc(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class q3 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class vr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new q3("Invalid base64 string: "+a):a}})(e);return new vr(t)}static fromUint8Array(e){const t=(function(i){let a="";for(let s=0;s<i.length;++s)a+=String.fromCharCode(i[s]);return a})(e);return new vr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return yt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vr.EMPTY_BYTE_STRING=new vr("");const TK=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qo(n){if(Pt(!!n,39018),typeof n=="string"){let e=0;const t=TK.exec(n);if(Pt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_n(n.seconds),nanos:_n(n.nanos)}}function _n(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ko(n){return typeof n=="string"?vr.fromBase64String(n):vr.fromUint8Array(n)}const K3="server_timestamp",X3="__type__",Y3="__previous_value__",$3="__local_write_time__";function Iw(n){return(n?.mapValue?.fields||{})[X3]?.stringValue===K3}function kv(n){const e=n.mapValue.fields[Y3];return Iw(e)?kv(e):e}function yd(n){const e=qo(n.mapValue.fields[$3].timestampValue);return new Jt(e.seconds,e.nanos)}class CK{constructor(e,t,r,i,a,s,u,c,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=s,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=d}}const Hg="(default)";class _d{constructor(e,t){this.projectId=e,this.database=t||Hg}static empty(){return new _d("","")}get isDefaultDatabase(){return this.database===Hg}isEqual(e){return e instanceof _d&&e.projectId===this.projectId&&e.database===this.database}}const Q3="__type__",SK="__max__",Wm={mapValue:{}},Z3="__vector__",Gg="value";function Xo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Iw(n)?4:RK(n)?9007199254740991:AK(n)?10:11:$e(28295,{value:n})}function Ja(n,e){if(n===e)return!0;const t=Xo(n);if(t!==Xo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yd(n).isEqual(yd(e));case 3:return(function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const s=qo(i.timestampValue),u=qo(a.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,a){return Ko(i.bytesValue).isEqual(Ko(a.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,a){return _n(i.geoPointValue.latitude)===_n(a.geoPointValue.latitude)&&_n(i.geoPointValue.longitude)===_n(a.geoPointValue.longitude)})(n,e);case 2:return(function(i,a){if("integerValue"in i&&"integerValue"in a)return _n(i.integerValue)===_n(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const s=_n(i.doubleValue),u=_n(a.doubleValue);return s===u?zg(s)===zg(u):isNaN(s)&&isNaN(u)}return!1})(n,e);case 9:return Jc(n.arrayValue.values||[],e.arrayValue.values||[],Ja);case 10:case 11:return(function(i,a){const s=i.mapValue.fields||{},u=a.mapValue.fields||{};if(zR(s)!==zR(u))return!1;for(const c in s)if(s.hasOwnProperty(c)&&(u[c]===void 0||!Ja(s[c],u[c])))return!1;return!0})(n,e);default:return $e(52216,{left:n})}}function bd(n,e){return(n.values||[]).find((t=>Ja(t,e)))!==void 0}function eh(n,e){if(n===e)return 0;const t=Xo(n),r=Xo(e);if(t!==r)return yt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return yt(n.booleanValue,e.booleanValue);case 2:return(function(a,s){const u=_n(a.integerValue||a.doubleValue),c=_n(s.integerValue||s.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1})(n,e);case 3:return GR(n.timestampValue,e.timestampValue);case 4:return GR(yd(n),yd(e));case 5:return s1(n.stringValue,e.stringValue);case 6:return(function(a,s){const u=Ko(a),c=Ko(s);return u.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(a,s){const u=a.split("/"),c=s.split("/");for(let h=0;h<u.length&&h<c.length;h++){const d=yt(u[h],c[h]);if(d!==0)return d}return yt(u.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(a,s){const u=yt(_n(a.latitude),_n(s.latitude));return u!==0?u:yt(_n(a.longitude),_n(s.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return WR(n.arrayValue,e.arrayValue);case 10:return(function(a,s){const u=a.fields||{},c=s.fields||{},h=u[Gg]?.arrayValue,d=c[Gg]?.arrayValue,p=yt(h?.values?.length||0,d?.values?.length||0);return p!==0?p:WR(h,d)})(n.mapValue,e.mapValue);case 11:return(function(a,s){if(a===Wm.mapValue&&s===Wm.mapValue)return 0;if(a===Wm.mapValue)return 1;if(s===Wm.mapValue)return-1;const u=a.fields||{},c=Object.keys(u),h=s.fields||{},d=Object.keys(h);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){const g=s1(c[p],d[p]);if(g!==0)return g;const v=eh(u[c[p]],h[d[p]]);if(v!==0)return v}return yt(c.length,d.length)})(n.mapValue,e.mapValue);default:throw $e(23264,{he:t})}}function GR(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return yt(n,e);const t=qo(n),r=qo(e),i=yt(t.seconds,r.seconds);return i!==0?i:yt(t.nanos,r.nanos)}function WR(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const a=eh(t[i],r[i]);if(a)return a}return yt(t.length,r.length)}function th(n){return u1(n)}function u1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=qo(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ko(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return We.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const a of t.values||[])i?i=!1:r+=",",r+=u1(a);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",a=!0;for(const s of r)a?a=!1:i+=",",i+=`${s}:${u1(t.fields[s])}`;return i+"}"})(n.mapValue):$e(61005,{value:n})}function rg(n){switch(Xo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=kv(n);return e?16+rg(e):16;case 5:return 2*n.stringValue.length;case 6:return Ko(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,a)=>i+rg(a)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return nu(r.fields,((a,s)=>{i+=a.length+rg(s)})),i})(n.mapValue);default:throw $e(13486,{value:n})}}function qR(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function l1(n){return!!n&&"integerValue"in n}function Nw(n){return!!n&&"arrayValue"in n}function KR(n){return!!n&&"nullValue"in n}function XR(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ig(n){return!!n&&"mapValue"in n}function AK(n){return(n?.mapValue?.fields||{})[Q3]?.stringValue===Z3}function Kf(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return nu(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Kf(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Kf(n.arrayValue.values[t]);return e}return{...n}}function RK(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===SK}class Qr{constructor(e){this.value=e}static empty(){return new Qr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ig(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Kf(t)}setAll(e){let t=gr.emptyPath(),r={},i=[];e.forEach(((s,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=u.popLast()}s?r[u.lastSegment()]=Kf(s):i.push(u.lastSegment())}));const a=this.getFieldsMap(t);this.applyChanges(a,r,i)}delete(e){const t=this.field(e.popLast());ig(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ja(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ig(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){nu(t,((i,a)=>e[i]=a));for(const i of r)delete e[i]}clone(){return new Qr(Kf(this.value))}}function J3(n){const e=[];return nu(n.fields,((t,r)=>{const i=new gr([t]);if(ig(r)){const a=J3(r.mapValue).fields;if(a.length===0)e.push(i);else for(const s of a)e.push(i.child(s))}else e.push(i)})),new vi(e)}class Cr{constructor(e,t,r,i,a,s,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=a,this.data=s,this.documentState=u}static newInvalidDocument(e){return new Cr(e,0,tt.min(),tt.min(),tt.min(),Qr.empty(),0)}static newFoundDocument(e,t,r,i){return new Cr(e,1,t,tt.min(),r,i,0)}static newNoDocument(e,t){return new Cr(e,2,t,tt.min(),tt.min(),Qr.empty(),0)}static newUnknownDocument(e,t){return new Cr(e,3,t,tt.min(),tt.min(),Qr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(tt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Cr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Cr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Wg{constructor(e,t){this.position=e,this.inclusive=t}}function YR(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const a=e[i],s=n.position[i];if(a.field.isKeyField()?r=We.comparator(We.fromName(s.referenceValue),t.key):r=eh(s,t.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function $R(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ja(n.position[t],e.position[t]))return!1;return!0}class xd{constructor(e,t="asc"){this.field=e,this.dir=t}}function IK(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class e4{}class On extends e4{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new DK(e,t,r):t==="array-contains"?new OK(e,r):t==="in"?new PK(e,r):t==="not-in"?new FK(e,r):t==="array-contains-any"?new VK(e,r):new On(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new kK(e,r):new MK(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(eh(t,this.value)):t!==null&&Xo(this.value)===Xo(t)&&this.matchesComparison(eh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $e(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ca extends e4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ca(e,t)}matches(e){return t4(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function t4(n){return n.op==="and"}function n4(n){return NK(n)&&t4(n)}function NK(n){for(const e of n.filters)if(e instanceof ca)return!1;return!0}function c1(n){if(n instanceof On)return n.field.canonicalString()+n.op.toString()+th(n.value);if(n4(n))return n.filters.map((e=>c1(e))).join(",");{const e=n.filters.map((t=>c1(t))).join(",");return`${n.op}(${e})`}}function r4(n,e){return n instanceof On?(function(r,i){return i instanceof On&&r.op===i.op&&r.field.isEqual(i.field)&&Ja(r.value,i.value)})(n,e):n instanceof ca?(function(r,i){return i instanceof ca&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((a,s,u)=>a&&r4(s,i.filters[u])),!0):!1})(n,e):void $e(19439)}function i4(n){return n instanceof On?(function(t){return`${t.field.canonicalString()} ${t.op} ${th(t.value)}`})(n):n instanceof ca?(function(t){return t.op.toString()+" {"+t.getFilters().map(i4).join(" ,")+"}"})(n):"Filter"}class DK extends On{constructor(e,t,r){super(e,t,r),this.key=We.fromName(r.referenceValue)}matches(e){const t=We.comparator(e.key,this.key);return this.matchesComparison(t)}}class kK extends On{constructor(e,t){super(e,"in",t),this.keys=a4("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class MK extends On{constructor(e,t){super(e,"not-in",t),this.keys=a4("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function a4(n,e){return(e.arrayValue?.values||[]).map((t=>We.fromName(t.referenceValue)))}class OK extends On{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Nw(t)&&bd(t.arrayValue,this.value)}}class PK extends On{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&bd(this.value.arrayValue,t)}}class FK extends On{constructor(e,t){super(e,"not-in",t)}matches(e){if(bd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!bd(this.value.arrayValue,t)}}class VK extends On{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Nw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>bd(this.value.arrayValue,r)))}}class LK{constructor(e,t=null,r=[],i=[],a=null,s=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=s,this.endAt=u,this.Te=null}}function QR(n,e=null,t=[],r=[],i=null,a=null,s=null){return new LK(n,e,t,r,i,a,s)}function Dw(n){const e=at(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>c1(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(a){return a.field.canonicalString()+a.dir})(r))).join(","),Dv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>th(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>th(r))).join(",")),e.Te=t}return e.Te}function kw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!IK(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!r4(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$R(n.startAt,e.startAt)&&$R(n.endAt,e.endAt)}function h1(n){return We.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class gh{constructor(e,t=null,r=[],i=[],a=null,s="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=s,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function BK(n,e,t,r,i,a,s,u){return new gh(n,e,t,r,i,a,s,u)}function s4(n){return new gh(n)}function ZR(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function o4(n){return n.collectionGroup!==null}function Xf(n){const e=at(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),t.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let u=new Gn(gr.comparator);return s.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(u=u.add(h.field))}))})),u})(e).forEach((a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new xd(a,r))})),t.has(gr.keyField().canonicalString())||e.Ie.push(new xd(gr.keyField(),r))}return e.Ie}function Xa(n){const e=at(n);return e.Ee||(e.Ee=jK(e,Xf(n))),e.Ee}function jK(n,e){if(n.limitType==="F")return QR(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const a=i.dir==="desc"?"asc":"desc";return new xd(i.field,a)}));const t=n.endAt?new Wg(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Wg(n.startAt.position,n.startAt.inclusive):null;return QR(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function f1(n,e){const t=n.filters.concat([e]);return new gh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function qg(n,e,t){return new gh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Mv(n,e){return kw(Xa(n),Xa(e))&&n.limitType===e.limitType}function u4(n){return`${Dw(Xa(n))}|lt:${n.limitType}`}function vc(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>i4(i))).join(", ")}]`),Dv(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(s){return`${s.field.canonicalString()} (${s.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>th(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>th(i))).join(",")),`Target(${r})`})(Xa(n))}; limitType=${n.limitType})`}function Ov(n,e){return e.isFoundDocument()&&(function(r,i){const a=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):We.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)})(n,e)&&(function(r,i){for(const a of Xf(r))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const a of r.filters)if(!a.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(s,u,c){const h=YR(s,u,c);return s.inclusive?h<=0:h<0})(r.startAt,Xf(r),i)||r.endAt&&!(function(s,u,c){const h=YR(s,u,c);return s.inclusive?h>=0:h>0})(r.endAt,Xf(r),i))})(n,e)}function UK(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function l4(n){return(e,t)=>{let r=!1;for(const i of Xf(n)){const a=zK(i,e,t);if(a!==0)return a;r=r||i.field.isKeyField()}return 0}}function zK(n,e,t){const r=n.field.isKeyField()?We.comparator(e.key,t.key):(function(a,s,u){const c=s.data.field(a),h=u.data.field(a);return c!==null&&h!==null?eh(c,h):$e(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $e(19790,{direction:n.dir})}}class fl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,a]of r)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){nu(this.inner,((t,r)=>{for(const[i,a]of r)e(i,a)}))}isEmpty(){return W3(this.inner)}size(){return this.innerSize}}const HK=new Vn(We.comparator);function Vs(){return HK}const c4=new Vn(We.comparator);function Vf(...n){let e=c4;for(const t of n)e=e.insert(t.key,t);return e}function h4(n){let e=c4;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function qu(){return Yf()}function f4(){return Yf()}function Yf(){return new fl((n=>n.toString()),((n,e)=>n.isEqual(e)))}const GK=new Vn(We.comparator),WK=new Gn(We.comparator);function _t(...n){let e=WK;for(const t of n)e=e.add(t);return e}const qK=new Gn(yt);function KK(){return qK}function Mw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zg(e)?"-0":e}}function d4(n){return{integerValue:""+n}}function XK(n,e){return xK(e)?d4(e):Mw(n,e)}class Pv{constructor(){this._=void 0}}function YK(n,e,t){return n instanceof wd?(function(i,a){const s={fields:{[X3]:{stringValue:K3},[$3]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&Iw(a)&&(a=kv(a)),a&&(s.fields[Y3]=a),{mapValue:s}})(t,e):n instanceof Ed?m4(n,e):n instanceof Td?g4(n,e):(function(i,a){const s=p4(i,a),u=JR(s)+JR(i.Ae);return l1(s)&&l1(i.Ae)?d4(u):Mw(i.serializer,u)})(n,e)}function $K(n,e,t){return n instanceof Ed?m4(n,e):n instanceof Td?g4(n,e):t}function p4(n,e){return n instanceof Kg?(function(r){return l1(r)||(function(a){return!!a&&"doubleValue"in a})(r)})(e)?e:{integerValue:0}:null}class wd extends Pv{}class Ed extends Pv{constructor(e){super(),this.elements=e}}function m4(n,e){const t=v4(e);for(const r of n.elements)t.some((i=>Ja(i,r)))||t.push(r);return{arrayValue:{values:t}}}class Td extends Pv{constructor(e){super(),this.elements=e}}function g4(n,e){let t=v4(e);for(const r of n.elements)t=t.filter((i=>!Ja(i,r)));return{arrayValue:{values:t}}}class Kg extends Pv{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function JR(n){return _n(n.integerValue||n.doubleValue)}function v4(n){return Nw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class QK{constructor(e,t){this.field=e,this.transform=t}}function ZK(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Ed&&i instanceof Ed||r instanceof Td&&i instanceof Td?Jc(r.elements,i.elements,Ja):r instanceof Kg&&i instanceof Kg?Ja(r.Ae,i.Ae):r instanceof wd&&i instanceof wd})(n.transform,e.transform)}class JK{constructor(e,t){this.version=e,this.transformResults=t}}class Ui{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ui}static exists(e){return new Ui(void 0,e)}static updateTime(e){return new Ui(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ag(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Fv{}function y4(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ow(n.key,Ui.none()):new Gd(n.key,n.data,Ui.none());{const t=n.data,r=Qr.empty();let i=new Gn(gr.comparator);for(let a of e.fields)if(!i.has(a)){let s=t.field(a);s===null&&a.length>1&&(a=a.popLast(),s=t.field(a)),s===null?r.delete(a):r.set(a,s),i=i.add(a)}return new ru(n.key,r,new vi(i.toArray()),Ui.none())}}function eX(n,e,t){n instanceof Gd?(function(i,a,s){const u=i.value.clone(),c=tI(i.fieldTransforms,a,s.transformResults);u.setAll(c),a.convertToFoundDocument(s.version,u).setHasCommittedMutations()})(n,e,t):n instanceof ru?(function(i,a,s){if(!ag(i.precondition,a))return void a.convertToUnknownDocument(s.version);const u=tI(i.fieldTransforms,a,s.transformResults),c=a.data;c.setAll(_4(i)),c.setAll(u),a.convertToFoundDocument(s.version,c).setHasCommittedMutations()})(n,e,t):(function(i,a,s){a.convertToNoDocument(s.version).setHasCommittedMutations()})(0,e,t)}function $f(n,e,t,r){return n instanceof Gd?(function(a,s,u,c){if(!ag(a.precondition,s))return u;const h=a.value.clone(),d=nI(a.fieldTransforms,c,s);return h.setAll(d),s.convertToFoundDocument(s.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof ru?(function(a,s,u,c){if(!ag(a.precondition,s))return u;const h=nI(a.fieldTransforms,c,s),d=s.data;return d.setAll(_4(a)),d.setAll(h),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),u===null?null:u.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map((p=>p.field)))})(n,e,t,r):(function(a,s,u){return ag(a.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u})(n,e,t)}function tX(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),a=p4(r.transform,i||null);a!=null&&(t===null&&(t=Qr.empty()),t.set(r.field,a))}return t||null}function eI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Jc(r,i,((a,s)=>ZK(a,s)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Gd extends Fv{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ru extends Fv{constructor(e,t,r,i,a=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function _4(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function tI(n,e,t){const r=new Map;Pt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const a=n[i],s=a.transform,u=e.data.field(a.field);r.set(a.field,$K(s,u,t[i]))}return r}function nI(n,e,t){const r=new Map;for(const i of n){const a=i.transform,s=t.data.field(i.field);r.set(i.field,YK(a,s,e))}return r}class Ow extends Fv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nX extends Fv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rX{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&eX(a,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=$f(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=$f(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=f4();return this.mutations.forEach((i=>{const a=e.get(i.key),s=a.overlayedDocument;let u=this.applyToLocalView(s,a.mutatedFields);u=t.has(i.key)?null:u;const c=y4(s,u);c!==null&&r.set(i.key,c),s.isValidDocument()||s.convertToNoDocument(tt.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),_t())}isEqual(e){return this.batchId===e.batchId&&Jc(this.mutations,e.mutations,((t,r)=>eI(t,r)))&&Jc(this.baseMutations,e.baseMutations,((t,r)=>eI(t,r)))}}class Pw{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Pt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return GK})();const a=e.mutations;for(let s=0;s<a.length;s++)i=i.insert(a[s].key,r[s].version);return new Pw(e,t,r,i)}}class iX{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class aX{constructor(e,t){this.count=e,this.unchangedNames=t}}var Dn,Tt;function sX(n){switch(n){case be.OK:return $e(64938);case be.CANCELLED:case be.UNKNOWN:case be.DEADLINE_EXCEEDED:case be.RESOURCE_EXHAUSTED:case be.INTERNAL:case be.UNAVAILABLE:case be.UNAUTHENTICATED:return!1;case be.INVALID_ARGUMENT:case be.NOT_FOUND:case be.ALREADY_EXISTS:case be.PERMISSION_DENIED:case be.FAILED_PRECONDITION:case be.ABORTED:case be.OUT_OF_RANGE:case be.UNIMPLEMENTED:case be.DATA_LOSS:return!0;default:return $e(15467,{code:n})}}function b4(n){if(n===void 0)return Ps("GRPC error has no .code"),be.UNKNOWN;switch(n){case Dn.OK:return be.OK;case Dn.CANCELLED:return be.CANCELLED;case Dn.UNKNOWN:return be.UNKNOWN;case Dn.DEADLINE_EXCEEDED:return be.DEADLINE_EXCEEDED;case Dn.RESOURCE_EXHAUSTED:return be.RESOURCE_EXHAUSTED;case Dn.INTERNAL:return be.INTERNAL;case Dn.UNAVAILABLE:return be.UNAVAILABLE;case Dn.UNAUTHENTICATED:return be.UNAUTHENTICATED;case Dn.INVALID_ARGUMENT:return be.INVALID_ARGUMENT;case Dn.NOT_FOUND:return be.NOT_FOUND;case Dn.ALREADY_EXISTS:return be.ALREADY_EXISTS;case Dn.PERMISSION_DENIED:return be.PERMISSION_DENIED;case Dn.FAILED_PRECONDITION:return be.FAILED_PRECONDITION;case Dn.ABORTED:return be.ABORTED;case Dn.OUT_OF_RANGE:return be.OUT_OF_RANGE;case Dn.UNIMPLEMENTED:return be.UNIMPLEMENTED;case Dn.DATA_LOSS:return be.DATA_LOSS;default:return $e(39323,{code:n})}}(Tt=Dn||(Dn={}))[Tt.OK=0]="OK",Tt[Tt.CANCELLED=1]="CANCELLED",Tt[Tt.UNKNOWN=2]="UNKNOWN",Tt[Tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Tt[Tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Tt[Tt.NOT_FOUND=5]="NOT_FOUND",Tt[Tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Tt[Tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Tt[Tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Tt[Tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Tt[Tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Tt[Tt.ABORTED=10]="ABORTED",Tt[Tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Tt[Tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Tt[Tt.INTERNAL=13]="INTERNAL",Tt[Tt.UNAVAILABLE=14]="UNAVAILABLE",Tt[Tt.DATA_LOSS=15]="DATA_LOSS";function oX(){return new TextEncoder}const uX=new Fo([4294967295,4294967295],0);function rI(n){const e=oX().encode(n),t=new O3;return t.update(e),new Uint8Array(t.digest())}function iI(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Fo([t,r],0),new Fo([i,a],0)]}class Fw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Lf(`Invalid padding: ${t}`);if(r<0)throw new Lf(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Lf(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Lf(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Fo.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Fo.fromNumber(r)));return i.compare(uX)===1&&(i=new Fo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=rI(e),[r,i]=iI(t);for(let a=0;a<this.hashCount;a++){const s=this.ye(r,i,a);if(!this.we(s))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),s=new Fw(a,i,t);return r.forEach((u=>s.insert(u))),s}insert(e){if(this.ge===0)return;const t=rI(e),[r,i]=iI(t);for(let a=0;a<this.hashCount;a++){const s=this.ye(r,i,a);this.Se(s)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Lf extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Vv{constructor(e,t,r,i,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Wd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Vv(tt.min(),i,new Vn(yt),Vs(),_t())}}class Wd{constructor(e,t,r,i,a){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Wd(r,t,_t(),_t(),_t())}}class sg{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class x4{constructor(e,t){this.targetId=e,this.Ce=t}}class w4{constructor(e,t,r=vr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class aI{constructor(){this.ve=0,this.Fe=sI(),this.Me=vr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=_t(),t=_t(),r=_t();return this.Fe.forEach(((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:$e(38017,{changeType:a})}})),new Wd(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=sI()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Pt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class lX{constructor(e){this.Ge=e,this.ze=new Map,this.je=Vs(),this.Je=qm(),this.He=qm(),this.Ye=new Vn(yt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$e(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const a=i.target;if(h1(a))if(r===0){const s=new We(a.path);this.et(t,s,Cr.newNoDocument(s,tt.min()))}else Pt(r===1,20013,{expectedCount:r});else{const s=this._t(t);if(s!==r){const u=this.ut(e),c=u?this.ct(u,e,s):1;if(c!==0){this.it(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:a=0}=t;let s,u;try{s=Ko(r).toUint8Array()}catch(c){if(c instanceof q3)return Zc("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Fw(s,i,a)}catch(c){return Zc(c instanceof Lf?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((a=>{const s=this.Ge.ht(),u=`projects/${s.projectId}/databases/${s.database}/documents/${a.path.canonicalString()}`;e.mightContain(u)||(this.et(t,a,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((a,s)=>{const u=this.ot(s);if(u){if(a.current&&h1(u.target)){const c=new We(u.target.path);this.It(c).has(s)||this.Et(s,c)||this.et(s,c,Cr.newNoDocument(c,e))}a.Be&&(t.set(s,a.ke()),a.qe())}}));let r=_t();this.He.forEach(((a,s)=>{let u=!0;s.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(a))})),this.je.forEach(((a,s)=>s.setReadTime(e)));const i=new Vv(e,t,this.Ye,this.je,r);return this.je=Vs(),this.Je=qm(),this.He=qm(),this.Ye=new Vn(yt),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new aI,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Gn(yt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Gn(yt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ke("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new aI),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function qm(){return new Vn(We.comparator)}function sI(){return new Vn(We.comparator)}const cX={asc:"ASCENDING",desc:"DESCENDING"},hX={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fX={and:"AND",or:"OR"};class dX{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function d1(n,e){return n.useProto3Json||Dv(e)?e:{value:e}}function Xg(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function E4(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pX(n,e){return Xg(n,e.toTimestamp())}function Ya(n){return Pt(!!n,49232),tt.fromTimestamp((function(t){const r=qo(t);return new Jt(r.seconds,r.nanos)})(n))}function Vw(n,e){return p1(n,e).canonicalString()}function p1(n,e){const t=(function(i){return new qt(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function T4(n){const e=qt.fromString(n);return Pt(I4(e),10190,{key:e.toString()}),e}function m1(n,e){return Vw(n.databaseId,e.path)}function Y_(n,e){const t=T4(e);if(t.get(1)!==n.databaseId.projectId)throw new Ne(be.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ne(be.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new We(S4(t))}function C4(n,e){return Vw(n.databaseId,e)}function mX(n){const e=T4(n);return e.length===4?qt.emptyPath():S4(e)}function g1(n){return new qt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function S4(n){return Pt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function oI(n,e,t){return{name:m1(n,e),fields:t.value.mapValue.fields}}function gX(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$e(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=(function(h,d){return h.useProto3Json?(Pt(d===void 0||typeof d=="string",58123),vr.fromBase64String(d||"")):(Pt(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),vr.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&(function(h){const d=h.code===void 0?be.UNKNOWN:b4(h.code);return new Ne(d,h.message||"")})(s);t=new w4(r,i,a,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Y_(n,r.document.name),a=Ya(r.document.updateTime),s=r.document.createTime?Ya(r.document.createTime):tt.min(),u=new Qr({mapValue:{fields:r.document.fields}}),c=Cr.newFoundDocument(i,a,s,u),h=r.targetIds||[],d=r.removedTargetIds||[];t=new sg(h,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Y_(n,r.document),a=r.readTime?Ya(r.readTime):tt.min(),s=Cr.newNoDocument(i,a),u=r.removedTargetIds||[];t=new sg([],u,s.key,s)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Y_(n,r.document),a=r.removedTargetIds||[];t=new sg([],a,i,null)}else{if(!("filter"in e))return $e(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:a}=r,s=new aX(i,a),u=r.targetId;t=new x4(u,s)}}return t}function vX(n,e){let t;if(e instanceof Gd)t={update:oI(n,e.key,e.value)};else if(e instanceof Ow)t={delete:m1(n,e.key)};else if(e instanceof ru)t={update:oI(n,e.key,e.data),updateMask:SX(e.fieldMask)};else{if(!(e instanceof nX))return $e(16599,{Vt:e.type});t={verify:m1(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(a,s){const u=s.transform;if(u instanceof wd)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ed)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Td)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Kg)return{fieldPath:s.field.canonicalString(),increment:u.Ae};throw $e(20930,{transform:s.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,a){return a.updateTime!==void 0?{updateTime:pX(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:$e(27497)})(n,e.precondition)),t}function yX(n,e){return n&&n.length>0?(Pt(e!==void 0,14353),n.map((t=>(function(i,a){let s=i.updateTime?Ya(i.updateTime):Ya(a);return s.isEqual(tt.min())&&(s=Ya(a)),new JK(s,i.transformResults||[])})(t,e)))):[]}function _X(n,e){return{documents:[C4(n,e.path)]}}function bX(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=C4(n,i);const a=(function(h){if(h.length!==0)return R4(ca.create(h,"and"))})(e.filters);a&&(t.structuredQuery.where=a);const s=(function(h){if(h.length!==0)return h.map((d=>(function(g){return{field:yc(g.field),direction:EX(g.dir)}})(d)))})(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=d1(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function xX(n){let e=mX(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Pt(r===1,65062);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let a=[];t.where&&(a=(function(p){const g=A4(p);return g instanceof ca&&n4(g)?g.getFilters():[g]})(t.where));let s=[];t.orderBy&&(s=(function(p){return p.map((g=>(function(b){return new xd(_c(b.field),(function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(g)))})(t.orderBy));let u=null;t.limit&&(u=(function(p){let g;return g=typeof p=="object"?p.value:p,Dv(g)?null:g})(t.limit));let c=null;t.startAt&&(c=(function(p){const g=!!p.before,v=p.values||[];return new Wg(v,g)})(t.startAt));let h=null;return t.endAt&&(h=(function(p){const g=!p.before,v=p.values||[];return new Wg(v,g)})(t.endAt)),BK(e,i,s,a,u,"F",c,h)}function wX(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $e(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function A4(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=_c(t.unaryFilter.field);return On.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=_c(t.unaryFilter.field);return On.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=_c(t.unaryFilter.field);return On.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=_c(t.unaryFilter.field);return On.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $e(61313);default:return $e(60726)}})(n):n.fieldFilter!==void 0?(function(t){return On.create(_c(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $e(58110);default:return $e(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ca.create(t.compositeFilter.filters.map((r=>A4(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $e(1026)}})(t.compositeFilter.op))})(n):$e(30097,{filter:n})}function EX(n){return cX[n]}function TX(n){return hX[n]}function CX(n){return fX[n]}function yc(n){return{fieldPath:n.canonicalString()}}function _c(n){return gr.fromServerFormat(n.fieldPath)}function R4(n){return n instanceof On?(function(t){if(t.op==="=="){if(XR(t.value))return{unaryFilter:{field:yc(t.field),op:"IS_NAN"}};if(KR(t.value))return{unaryFilter:{field:yc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(XR(t.value))return{unaryFilter:{field:yc(t.field),op:"IS_NOT_NAN"}};if(KR(t.value))return{unaryFilter:{field:yc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yc(t.field),op:TX(t.op),value:t.value}}})(n):n instanceof ca?(function(t){const r=t.getFilters().map((i=>R4(i)));return r.length===1?r[0]:{compositeFilter:{op:CX(t.op),filters:r}}})(n):$e(54877,{filter:n})}function SX(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function I4(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Io{constructor(e,t,r,i,a=tt.min(),s=tt.min(),u=vr.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Io(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Io(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Io(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Io(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class AX{constructor(e){this.yt=e}}function RX(n){const e=xX({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qg(e,e.limit,"L"):e}class IX{constructor(){this.Cn=new NX}addToCollectionParentIndex(e,t){return this.Cn.add(t),we.resolve()}getCollectionParents(e,t){return we.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return we.resolve()}deleteFieldIndex(e,t){return we.resolve()}deleteAllFieldIndexes(e){return we.resolve()}createTargetIndexes(e,t){return we.resolve()}getDocumentsMatchingTarget(e,t){return we.resolve(null)}getIndexType(e,t){return we.resolve(0)}getFieldIndexes(e,t){return we.resolve([])}getNextCollectionGroupToUpdate(e){return we.resolve(null)}getMinOffset(e,t){return we.resolve(Wo.min())}getMinOffsetFromCollectionGroup(e,t){return we.resolve(Wo.min())}updateCollectionGroup(e,t,r){return we.resolve()}updateIndexEntries(e,t){return we.resolve()}}class NX{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Gn(qt.comparator),a=!i.has(r);return this.index[t]=i.add(r),a}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Gn(qt.comparator)).toArray()}}const uI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},N4=41943040;class Xr{static withCacheSize(e){return new Xr(e,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Xr.DEFAULT_COLLECTION_PERCENTILE=10,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xr.DEFAULT=new Xr(N4,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xr.DISABLED=new Xr(-1,0,0);class nh{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new nh(0)}static cr(){return new nh(-1)}}const lI="LruGarbageCollector",DX=1048576;function cI([n,e],[t,r]){const i=yt(n,t);return i===0?yt(e,r):i}class kX{constructor(e){this.Ir=e,this.buffer=new Gn(cI),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();cI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class MX{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ke(lI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){mh(t)?ke(lI,"Ignoring IndexedDB error during garbage collection: ",t):await ph(t)}await this.Vr(3e5)}))}}class OX{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return we.resolve(Nv.ce);const r=new kX(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ke("LruGarbageCollector","Garbage collection skipped; disabled"),we.resolve(uI)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(ke("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uI):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,a,s,u,c,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(ke("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,s=Date.now(),this.nthSequenceNumber(e,i)))).next((p=>(r=p,u=Date.now(),this.removeTargets(e,r,t)))).next((p=>(a=p,c=Date.now(),this.removeOrphanedDocuments(e,r)))).next((p=>(h=Date.now(),gc()<=xt.DEBUG&&ke("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-d}ms
	Determined least recently used ${i} in `+(u-s)+`ms
	Removed ${a} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-d}ms`),we.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:p}))))}}function PX(n,e){return new OX(n,e)}class FX{constructor(){this.changes=new fl((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Cr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?we.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class VX{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class LX{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&$f(r.mutation,i,vi.empty(),Jt.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,_t()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=_t()){const i=qu();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((a=>{let s=Vf();return a.forEach(((u,c)=>{s=s.insert(u,c.overlayedDocument)})),s}))))}getOverlayedDocuments(e,t){const r=qu();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,_t())))}populateOverlays(e,t,r){const i=[];return r.forEach((a=>{t.has(a)||i.push(a)})),this.documentOverlayCache.getOverlays(e,i).next((a=>{a.forEach(((s,u)=>{t.set(s,u)}))}))}computeViews(e,t,r,i){let a=Vs();const s=Yf(),u=(function(){return Yf()})();return t.forEach(((c,h)=>{const d=r.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof ru)?a=a.insert(h.key,h):d!==void 0?(s.set(h.key,d.mutation.getFieldMask()),$f(d.mutation,h,d.mutation.getFieldMask(),Jt.now())):s.set(h.key,vi.empty())})),this.recalculateAndSaveOverlays(e,a).next((c=>(c.forEach(((h,d)=>s.set(h,d))),t.forEach(((h,d)=>u.set(h,new VX(d,s.get(h)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=Yf();let i=new Vn(((s,u)=>s-u)),a=_t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((s=>{for(const u of s)u.keys().forEach((c=>{const h=t.get(c);if(h===null)return;let d=r.get(c)||vi.empty();d=u.applyToLocalView(h,d),r.set(c,d);const p=(i.get(u.batchId)||_t()).add(c);i=i.insert(u.batchId,p)}))})).next((()=>{const s=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,d=c.value,p=f4();d.forEach((g=>{if(!a.has(g)){const v=y4(t.get(g),r.get(g));v!==null&&p.set(g,v),a=a.add(g)}})),s.push(this.documentOverlayCache.saveOverlays(e,h,p))}return we.waitFor(s)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(s){return We.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):o4(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((a=>{const s=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-a.size):we.resolve(qu());let u=vd,c=a;return s.next((h=>we.forEach(h,((d,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),a.get(d)?we.resolve():this.remoteDocumentCache.getEntry(e,d).next((g=>{c=c.insert(d,g)}))))).next((()=>this.populateOverlays(e,h,a))).next((()=>this.computeViews(e,c,h,_t()))).next((d=>({batchId:u,changes:h4(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new We(t)).next((r=>{let i=Vf();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const a=t.collectionGroup;let s=Vf();return this.indexManager.getCollectionParents(e,a).next((u=>we.forEach(u,(c=>{const h=(function(p,g){return new gh(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next((d=>{d.forEach(((p,g)=>{s=s.insert(p,g)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((s=>(a=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,a,i)))).next((s=>{a.forEach(((c,h)=>{const d=h.getKey();s.get(d)===null&&(s=s.insert(d,Cr.newInvalidDocument(d)))}));let u=Vf();return s.forEach(((c,h)=>{const d=a.get(c);d!==void 0&&$f(d.mutation,h,vi.empty(),Jt.now()),Ov(t,h)&&(u=u.insert(c,h))})),u}))}}class BX{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return we.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Ya(i.createTime)}})(t)),we.resolve()}getNamedQuery(e,t){return we.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:RX(i.bundledQuery),readTime:Ya(i.readTime)}})(t)),we.resolve()}}class jX{constructor(){this.overlays=new Vn(We.comparator),this.qr=new Map}getOverlay(e,t){return we.resolve(this.overlays.get(t))}getOverlays(e,t){const r=qu();return we.forEach(t,(i=>this.getOverlay(e,i).next((a=>{a!==null&&r.set(i,a)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,a)=>{this.St(e,t,a)})),we.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((a=>this.overlays=this.overlays.remove(a))),this.qr.delete(r)),we.resolve()}getOverlaysForCollection(e,t,r){const i=qu(),a=t.length+1,s=new We(t.child("")),u=this.overlays.getIteratorFrom(s);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===a&&c.largestBatchId>r&&i.set(c.getKey(),c)}return we.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let a=new Vn(((h,d)=>h-d));const s=this.overlays.getIterator();for(;s.hasNext();){const h=s.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=a.get(h.largestBatchId);d===null&&(d=qu(),a=a.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const u=qu(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,d)=>u.set(h,d))),!(u.size()>=i)););return we.resolve(u)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const s=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,s)}this.overlays=this.overlays.insert(r.key,new iX(t,r));let a=this.qr.get(t);a===void 0&&(a=_t(),this.qr.set(t,a)),this.qr.set(t,a.add(r.key))}}class UX{constructor(){this.sessionToken=vr.EMPTY_BYTE_STRING}getSessionToken(e){return we.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,we.resolve()}}class Lw{constructor(){this.Qr=new Gn(er.$r),this.Ur=new Gn(er.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new er(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new er(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new We(new qt([])),r=new er(t,e),i=new er(t,e+1),a=[];return this.Ur.forEachInRange([r,i],(s=>{this.Gr(s),a.push(s.key)})),a}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new We(new qt([])),r=new er(t,e),i=new er(t,e+1);let a=_t();return this.Ur.forEachInRange([r,i],(s=>{a=a.add(s.key)})),a}containsKey(e){const t=new er(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class er{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return We.comparator(e.key,t.key)||yt(e.Yr,t.Yr)}static Kr(e,t){return yt(e.Yr,t.Yr)||We.comparator(e.key,t.key)}}class zX{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Gn(er.$r)}checkEmpty(e){return we.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new rX(a,t,r,i);this.mutationQueue.push(s);for(const u of i)this.Zr=this.Zr.add(new er(u.key,a)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return we.resolve(s)}lookupMutationBatch(e,t){return we.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),a=i<0?0:i;return we.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return we.resolve(this.mutationQueue.length===0?Rw:this.tr-1)}getAllMutationBatches(e){return we.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new er(t,0),i=new er(t,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([r,i],(s=>{const u=this.Xr(s.Yr);a.push(u)})),we.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Gn(yt);return t.forEach((i=>{const a=new er(i,0),s=new er(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,s],(u=>{r=r.add(u.Yr)}))})),we.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let a=r;We.isDocumentKey(a)||(a=a.child(""));const s=new er(new We(a),0);let u=new Gn(yt);return this.Zr.forEachWhile((c=>{const h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Yr)),!0)}),s),we.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){Pt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return we.forEach(t.mutations,(i=>{const a=new er(i.key,t.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new er(t,0),i=this.Zr.firstAfterOrEqual(r);return we.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,we.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class HX{constructor(e){this.ri=e,this.docs=(function(){return new Vn(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),a=i?i.size:0,s=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return we.resolve(r?r.document.mutableCopy():Cr.newInvalidDocument(t))}getEntries(e,t){let r=Vs();return t.forEach((i=>{const a=this.docs.get(i);r=r.insert(i,a?a.document.mutableCopy():Cr.newInvalidDocument(i))})),we.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let a=Vs();const s=t.path,u=new We(s.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:d}}=c.getNext();if(!s.isPrefixOf(h.path))break;h.path.length>s.length+1||vK(gK(d),r)<=0||(i.has(d.key)||Ov(t,d))&&(a=a.insert(d.key,d.mutableCopy()))}return we.resolve(a)}getAllFromCollectionGroup(e,t,r,i){$e(9500)}ii(e,t){return we.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new GX(this)}getSize(e){return we.resolve(this.size)}}class GX extends FX{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),we.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class WX{constructor(e){this.persistence=e,this.si=new fl((t=>Dw(t)),kw),this.lastRemoteSnapshotVersion=tt.min(),this.highestTargetId=0,this.oi=0,this._i=new Lw,this.targetCount=0,this.ai=nh.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),we.resolve()}getLastRemoteSnapshotVersion(e){return we.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return we.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),we.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),we.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new nh(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,we.resolve()}updateTargetData(e,t){return this.Pr(t),we.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,we.resolve()}removeTargets(e,t,r){let i=0;const a=[];return this.si.forEach(((s,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(s),a.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),we.waitFor(a).next((()=>i))}getTargetCount(e){return we.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return we.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),we.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,a=[];return i&&t.forEach((s=>{a.push(i.markPotentiallyOrphaned(e,s))})),we.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),we.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return we.resolve(r)}containsKey(e,t){return we.resolve(this._i.containsKey(t))}}class D4{constructor(e,t){this.ui={},this.overlays={},this.ci=new Nv(0),this.li=!1,this.li=!0,this.hi=new UX,this.referenceDelegate=e(this),this.Pi=new WX(this),this.indexManager=new IX,this.remoteDocumentCache=(function(i){return new HX(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new AX(t),this.Ii=new BX(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new jX,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new zX(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){ke("MemoryPersistence","Starting transaction:",e);const i=new qX(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((a=>this.referenceDelegate.di(i).next((()=>a)))).toPromise().then((a=>(i.raiseOnCommittedEvent(),a)))}Ai(e,t){return we.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class qX extends _K{constructor(e){super(),this.currentSequenceNumber=e}}class Bw{constructor(e){this.persistence=e,this.Ri=new Lw,this.Vi=null}static mi(e){return new Bw(e)}get fi(){if(this.Vi)return this.Vi;throw $e(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),we.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),we.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),we.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((a=>this.fi.add(a.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return we.forEach(this.fi,(r=>{const i=We.fromPath(r);return this.gi(e,i).next((a=>{a||t.removeEntry(i,tt.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return we.or([()=>we.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Yg{constructor(e,t){this.persistence=e,this.pi=new fl((r=>wK(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=PX(this,t)}static mi(e,t){return new Yg(e,t)}Ei(){}di(e){return we.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return we.forEach(this.pi,((r,i)=>this.br(e,r,i).next((a=>a?we.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.ii(e,(s=>this.br(e,s,t).next((u=>{u||(r++,a.removeEntry(s,tt.min()))})))).next((()=>a.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),we.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),we.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),we.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),we.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=rg(e.data.value)),t}br(e,t,r){return we.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return we.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class jw{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=_t(),i=_t();for(const a of t.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new jw(e,t.fromCache,r,i)}}class KX{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class XX{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Pq()?8:bK(x3())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const a={result:null};return this.ys(e,t).next((s=>{a.result=s})).next((()=>{if(!a.result)return this.ws(e,t,i,r).next((s=>{a.result=s}))})).next((()=>{if(a.result)return;const s=new KX;return this.Ss(e,t,s).next((u=>{if(a.result=u,this.Vs)return this.bs(e,t,s,u.size)}))})).next((()=>a.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(gc()<=xt.DEBUG&&ke("QueryEngine","SDK will not create cache indexes for query:",vc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),we.resolve()):(gc()<=xt.DEBUG&&ke("QueryEngine","Query:",vc(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(gc()<=xt.DEBUG&&ke("QueryEngine","The SDK decides to create cache indexes for query:",vc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xa(t))):we.resolve())}ys(e,t){if(ZR(t))return we.resolve(null);let r=Xa(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=qg(t,null,"F"),r=Xa(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((a=>{const s=_t(...a);return this.ps.getDocuments(e,s).next((u=>this.indexManager.getMinOffset(e,r).next((c=>{const h=this.Ds(t,u);return this.Cs(t,h,s,c.readTime)?this.ys(e,qg(t,null,"F")):this.vs(e,h,t,c)}))))})))))}ws(e,t,r,i){return ZR(t)||i.isEqual(tt.min())?we.resolve(null):this.ps.getDocuments(e,r).next((a=>{const s=this.Ds(t,a);return this.Cs(t,s,r,i)?we.resolve(null):(gc()<=xt.DEBUG&&ke("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),vc(t)),this.vs(e,s,t,mK(i,vd)).next((u=>u)))}))}Ds(e,t){let r=new Gn(l4(e));return t.forEach(((i,a)=>{Ov(e,a)&&(r=r.add(a))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Ss(e,t,r){return gc()<=xt.DEBUG&&ke("QueryEngine","Using full collection scan to execute query:",vc(t)),this.ps.getDocumentsMatchingQuery(e,t,Wo.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((a=>(t.forEach((s=>{a=a.insert(s.key,s)})),a)))}}const Uw="LocalStore",YX=3e8;class $X{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Vn(yt),this.xs=new fl((a=>Dw(a)),kw),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LX(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function QX(n,e,t,r){return new $X(n,e,t,r)}async function k4(n,e){const t=at(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((a=>(i=a,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((a=>{const s=[],u=[];let c=_t();for(const h of i){s.push(h.batchId);for(const d of h.mutations)c=c.add(d.key)}for(const h of a){u.push(h.batchId);for(const d of h.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next((h=>({Ls:h,removedBatchIds:s,addedBatchIds:u})))}))}))}function ZX(n,e){const t=at(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),a=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,c,h,d){const p=h.batch,g=p.keys();let v=we.resolve();return g.forEach((b=>{v=v.next((()=>d.getEntry(c,b))).next((E=>{const w=h.docVersions.get(b);Pt(w!==null,48541),E.version.compareTo(w)<0&&(p.applyToRemoteDocument(E,h),E.isValidDocument()&&(E.setReadTime(h.commitVersion),d.addEntry(E)))}))})),v.next((()=>u.mutationQueue.removeMutationBatch(c,p)))})(t,r,e,a).next((()=>a.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let c=_t();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function M4(n){const e=at(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function JX(n,e){const t=at(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(a=>{const s=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const u=[];e.targetChanges.forEach(((d,p)=>{const g=i.get(p);if(!g)return;u.push(t.Pi.removeMatchingKeys(a,d.removedDocuments,p).next((()=>t.Pi.addMatchingKeys(a,d.addedDocuments,p))));let v=g.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(p)!==null?v=v.withResumeToken(vr.EMPTY_BYTE_STRING,tt.min()).withLastLimboFreeSnapshotVersion(tt.min()):d.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(d.resumeToken,r)),i=i.insert(p,v),(function(E,w,C){return E.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=YX?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(g,v,d)&&u.push(t.Pi.updateTargetData(a,v))}));let c=Vs(),h=_t();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(a,d))})),u.push(eY(a,s,e.documentUpdates).next((d=>{c=d.ks,h=d.qs}))),!r.isEqual(tt.min())){const d=t.Pi.getLastRemoteSnapshotVersion(a).next((p=>t.Pi.setTargetsMetadata(a,a.currentSequenceNumber,r)));u.push(d)}return we.waitFor(u).next((()=>s.apply(a))).next((()=>t.localDocuments.getLocalViewOfDocuments(a,c,h))).next((()=>c))})).then((a=>(t.Ms=i,a)))}function eY(n,e,t){let r=_t(),i=_t();return t.forEach((a=>r=r.add(a))),e.getEntries(n,r).next((a=>{let s=Vs();return t.forEach(((u,c)=>{const h=a.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(tt.min())?(e.removeEntry(u,c.readTime),s=s.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),s=s.insert(u,c)):ke(Uw,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)})),{ks:s,qs:i}}))}function tY(n,e){const t=at(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Rw),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function nY(n,e){const t=at(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((a=>a?(i=a,we.resolve(i)):t.Pi.allocateTargetId(r).next((s=>(i=new Io(e,s,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function v1(n,e,t){const r=at(n),i=r.Ms.get(e),a=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",a,(s=>r.persistence.referenceDelegate.removeTarget(s,i)))}catch(s){if(!mh(s))throw s;ke(Uw,`Failed to update sequence numbers for target ${e}: ${s}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function hI(n,e,t){const r=at(n);let i=tt.min(),a=_t();return r.persistence.runTransaction("Execute query","readwrite",(s=>(function(c,h,d){const p=at(c),g=p.xs.get(d);return g!==void 0?we.resolve(p.Ms.get(g)):p.Pi.getTargetData(h,d)})(r,s,Xa(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(s,u.targetId).next((c=>{a=c}))})).next((()=>r.Fs.getDocumentsMatchingQuery(s,e,t?i:tt.min(),t?a:_t()))).next((u=>(rY(r,UK(e),u),{documents:u,Qs:a})))))}function rY(n,e,t){let r=n.Os.get(e)||tt.min();t.forEach(((i,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)})),n.Os.set(e,r)}class fI{constructor(){this.activeTargetIds=KK()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class iY{constructor(){this.Mo=new fI,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new fI,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class aY{Oo(e){}shutdown(){}}const dI="ConnectivityMonitor";class pI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ke(dI,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ke(dI,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Km=null;function y1(){return Km===null?Km=(function(){return 268435456+Math.round(2147483648*Math.random())})():Km++,"0x"+Km.toString(16)}const $_="RestConnection",sY={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class oY{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Hg?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,a){const s=y1(),u=this.zo(e,t.toUriEncodedString());ke($_,`Sending RPC '${e}' ${s}:`,u,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,a);const{host:h}=new URL(u),d=zd(h);return this.Jo(e,u,c,r,d).then((p=>(ke($_,`Received RPC '${e}' ${s}: `,p),p)),(p=>{throw Zc($_,`RPC '${e}' ${s} failed with error: `,p,"url: ",u,"request:",r),p}))}Ho(e,t,r,i,a,s){return this.Go(e,t,r,i,a)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+dh})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,a)=>e[a]=i)),r&&r.headers.forEach(((i,a)=>e[a]=i))}zo(e,t){const r=sY[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class uY{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const xr="WebChannelConnection";class lY extends oY{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,a){const s=y1();return new Promise(((u,c)=>{const h=new P3;h.setWithCredentials(!0),h.listenOnce(F3.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case ng.NO_ERROR:const p=h.getResponseJson();ke(xr,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(p)),u(p);break;case ng.TIMEOUT:ke(xr,`RPC '${e}' ${s} timed out`),c(new Ne(be.DEADLINE_EXCEEDED,"Request time out"));break;case ng.HTTP_ERROR:const g=h.getStatus();if(ke(xr,`RPC '${e}' ${s} failed with status:`,g,"response text:",h.getResponseText()),g>0){let v=h.getResponseJson();Array.isArray(v)&&(v=v[0]);const b=v?.error;if(b&&b.status&&b.message){const E=(function(C){const S=C.toLowerCase().replace(/_/g,"-");return Object.values(be).indexOf(S)>=0?S:be.UNKNOWN})(b.status);c(new Ne(E,b.message))}else c(new Ne(be.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new Ne(be.UNAVAILABLE,"Connection failed."));break;default:$e(9055,{l_:e,streamId:s,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{ke(xr,`RPC '${e}' ${s} completed.`)}}));const d=JSON.stringify(i);ke(xr,`RPC '${e}' ${s} sending request:`,i),h.send(t,"POST",d,r,15)}))}T_(e,t,r){const i=y1(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=B3(),u=L3(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const d=a.join("");ke(xr,`Creating RPC '${e}' stream ${i}: ${d}`,c);const p=s.createWebChannel(d,c);this.I_(p);let g=!1,v=!1;const b=new uY({Yo:w=>{v?ke(xr,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(g||(ke(xr,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),ke(xr,`RPC '${e}' stream ${i} sending:`,w),p.send(w))},Zo:()=>p.close()}),E=(w,C,S)=>{w.listen(C,(I=>{try{S(I)}catch(D){setTimeout((()=>{throw D}),0)}}))};return E(p,Ff.EventType.OPEN,(()=>{v||(ke(xr,`RPC '${e}' stream ${i} transport opened.`),b.o_())})),E(p,Ff.EventType.CLOSE,(()=>{v||(v=!0,ke(xr,`RPC '${e}' stream ${i} transport closed`),b.a_(),this.E_(p))})),E(p,Ff.EventType.ERROR,(w=>{v||(v=!0,Zc(xr,`RPC '${e}' stream ${i} transport errored. Name:`,w.name,"Message:",w.message),b.a_(new Ne(be.UNAVAILABLE,"The operation could not be completed")))})),E(p,Ff.EventType.MESSAGE,(w=>{if(!v){const C=w.data[0];Pt(!!C,16349);const S=C,I=S?.error||S[0]?.error;if(I){ke(xr,`RPC '${e}' stream ${i} received error:`,I);const D=I.status;let O=(function(R){const k=Dn[R];if(k!==void 0)return b4(k)})(D),B=I.message;O===void 0&&(O=be.INTERNAL,B="Unknown error status: "+D+" with message "+I.message),v=!0,b.a_(new Ne(O,B)),p.close()}else ke(xr,`RPC '${e}' stream ${i} received:`,C),b.u_(C)}})),E(u,V3.STAT_EVENT,(w=>{w.stat===a1.PROXY?ke(xr,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===a1.NOPROXY&&ke(xr,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Q_(){return typeof document<"u"?document:null}function Lv(n){return new dX(n,!0)}class O4{constructor(e,t,r=1e3,i=1.5,a=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&ke("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const mI="PersistentStream";class P4{constructor(e,t,r,i,a,s,u,c){this.Mi=e,this.S_=r,this.b_=i,this.connection=a,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new O4(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===be.RESOURCE_EXHAUSTED?(Ps(t.toString()),Ps("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===be.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new Ne(be.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return ke(mI,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(ke(mI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class cY extends P4{constructor(e,t,r,i,a,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,s),this.serializer=a}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=gX(this.serializer,e),r=(function(a){if(!("targetChange"in a))return tt.min();const s=a.targetChange;return s.targetIds&&s.targetIds.length?tt.min():s.readTime?Ya(s.readTime):tt.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=g1(this.serializer),t.addTarget=(function(a,s){let u;const c=s.target;if(u=h1(c)?{documents:_X(a,c)}:{query:bX(a,c).ft},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){u.resumeToken=E4(a,s.resumeToken);const h=d1(a,s.expectedCount);h!==null&&(u.expectedCount=h)}else if(s.snapshotVersion.compareTo(tt.min())>0){u.readTime=Xg(a,s.snapshotVersion.toTimestamp());const h=d1(a,s.expectedCount);h!==null&&(u.expectedCount=h)}return u})(this.serializer,e);const r=wX(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=g1(this.serializer),t.removeTarget=e,this.q_(t)}}class hY extends P4{constructor(e,t,r,i,a,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,s),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Pt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Pt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Pt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=yX(e.writeResults,e.commitTime),r=Ya(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=g1(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>vX(this.serializer,r)))};this.q_(t)}}class fY{}class dY extends fY{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Ne(be.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,s])=>this.connection.Go(e,p1(t,r),i,a,s))).catch((a=>{throw a.name==="FirebaseError"?(a.code===be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Ne(be.UNKNOWN,a.toString())}))}Ho(e,t,r,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,u])=>this.connection.Ho(e,p1(t,r),i,s,u,a))).catch((s=>{throw s.name==="FirebaseError"?(s.code===be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Ne(be.UNKNOWN,s.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class pY{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ps(t),this.aa=!1):ke("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const rl="RemoteStore";class mY{constructor(e,t,r,i,a){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo((s=>{r.enqueueAndForget((async()=>{dl(this)&&(ke(rl,"Restarting streams for network reachability change."),await(async function(c){const h=at(c);h.Ea.add(4),await qd(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Bv(h)})(this))}))})),this.Ra=new pY(r,i)}}async function Bv(n){if(dl(n))for(const e of n.da)await e(!0)}async function qd(n){for(const e of n.da)await e(!1)}function F4(n,e){const t=at(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ww(t)?Gw(t):vh(t).O_()&&Hw(t,e))}function zw(n,e){const t=at(n),r=vh(t);t.Ia.delete(e),r.O_()&&V4(t,e),t.Ia.size===0&&(r.O_()?r.L_():dl(t)&&t.Ra.set("Unknown"))}function Hw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}vh(n).Y_(e)}function V4(n,e){n.Va.Ue(e),vh(n).Z_(e)}function Gw(n){n.Va=new lX({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),vh(n).start(),n.Ra.ua()}function Ww(n){return dl(n)&&!vh(n).x_()&&n.Ia.size>0}function dl(n){return at(n).Ea.size===0}function L4(n){n.Va=void 0}async function gY(n){n.Ra.set("Online")}async function vY(n){n.Ia.forEach(((e,t)=>{Hw(n,e)}))}async function yY(n,e){L4(n),Ww(n)?(n.Ra.ha(e),Gw(n)):n.Ra.set("Unknown")}async function _Y(n,e,t){if(n.Ra.set("Online"),e instanceof w4&&e.state===2&&e.cause)try{await(async function(i,a){const s=a.cause;for(const u of a.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,s),i.Ia.delete(u),i.Va.removeTarget(u))})(n,e)}catch(r){ke(rl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await $g(n,r)}else if(e instanceof sg?n.Va.Ze(e):e instanceof x4?n.Va.st(e):n.Va.tt(e),!t.isEqual(tt.min()))try{const r=await M4(n.localStore);t.compareTo(r)>=0&&await(function(a,s){const u=a.Va.Tt(s);return u.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const d=a.Ia.get(h);d&&a.Ia.set(h,d.withResumeToken(c.resumeToken,s))}})),u.targetMismatches.forEach(((c,h)=>{const d=a.Ia.get(c);if(!d)return;a.Ia.set(c,d.withResumeToken(vr.EMPTY_BYTE_STRING,d.snapshotVersion)),V4(a,c);const p=new Io(d.target,c,h,d.sequenceNumber);Hw(a,p)})),a.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){ke(rl,"Failed to raise snapshot:",r),await $g(n,r)}}async function $g(n,e,t){if(!mh(e))throw e;n.Ea.add(1),await qd(n),n.Ra.set("Offline"),t||(t=()=>M4(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{ke(rl,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Bv(n)}))}function B4(n,e){return e().catch((t=>$g(n,t,e)))}async function jv(n){const e=at(n),t=Yo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Rw;for(;bY(e);)try{const i=await tY(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,xY(e,i)}catch(i){await $g(e,i)}j4(e)&&U4(e)}function bY(n){return dl(n)&&n.Ta.length<10}function xY(n,e){n.Ta.push(e);const t=Yo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function j4(n){return dl(n)&&!Yo(n).x_()&&n.Ta.length>0}function U4(n){Yo(n).start()}async function wY(n){Yo(n).ra()}async function EY(n){const e=Yo(n);for(const t of n.Ta)e.ea(t.mutations)}async function TY(n,e,t){const r=n.Ta.shift(),i=Pw.from(r,e,t);await B4(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await jv(n)}async function CY(n,e){e&&Yo(n).X_&&await(async function(r,i){if((function(s){return sX(s)&&s!==be.ABORTED})(i.code)){const a=r.Ta.shift();Yo(r).B_(),await B4(r,(()=>r.remoteSyncer.rejectFailedWrite(a.batchId,i))),await jv(r)}})(n,e),j4(n)&&U4(n)}async function gI(n,e){const t=at(n);t.asyncQueue.verifyOperationInProgress(),ke(rl,"RemoteStore received new credentials");const r=dl(t);t.Ea.add(3),await qd(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Bv(t)}async function SY(n,e){const t=at(n);e?(t.Ea.delete(2),await Bv(t)):e||(t.Ea.add(2),await qd(t),t.Ra.set("Unknown"))}function vh(n){return n.ma||(n.ma=(function(t,r,i){const a=at(t);return a.sa(),new cY(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)})(n.datastore,n.asyncQueue,{Xo:gY.bind(null,n),t_:vY.bind(null,n),r_:yY.bind(null,n),H_:_Y.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Ww(n)?Gw(n):n.Ra.set("Unknown")):(await n.ma.stop(),L4(n))}))),n.ma}function Yo(n){return n.fa||(n.fa=(function(t,r,i){const a=at(t);return a.sa(),new hY(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:wY.bind(null,n),r_:CY.bind(null,n),ta:EY.bind(null,n),na:TY.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await jv(n)):(await n.fa.stop(),n.Ta.length>0&&(ke(rl,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class qw{constructor(e,t,r,i,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Vo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((s=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,a){const s=Date.now()+r,u=new qw(e,t,s,i,a);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ne(be.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kw(n,e){if(Ps("AsyncQueue",`${e}: ${n}`),mh(n))return new Ne(be.UNAVAILABLE,`${e}: ${n}`);throw n}class Lc{static emptySet(e){return new Lc(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||We.comparator(t.key,r.key):(t,r)=>We.comparator(t.key,r.key),this.keyedMap=Vf(),this.sortedSet=new Vn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Lc)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Lc;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class vI{constructor(){this.ga=new Vn(We.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$e(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class rh{constructor(e,t,r,i,a,s,u,c,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,a){const s=[];return t.forEach((u=>{s.push({type:0,doc:u})})),new rh(e,t,Lc.emptySet(t),s,r,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class AY{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class RY{constructor(){this.queries=yI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=at(t),a=i.queries;i.queries=yI(),a.forEach(((s,u)=>{for(const c of u.Sa)c.onError(r)}))})(this,new Ne(be.ABORTED,"Firestore shutting down"))}}function yI(){return new fl((n=>u4(n)),Mv)}async function IY(n,e){const t=at(n);let r=3;const i=e.query;let a=t.queries.get(i);a?!a.ba()&&e.Da()&&(r=2):(a=new AY,r=e.Da()?0:1);try{switch(r){case 0:a.wa=await t.onListen(i,!0);break;case 1:a.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(s){const u=Kw(s,`Initialization of query '${vc(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,a),a.Sa.push(e),e.va(t.onlineState),a.wa&&e.Fa(a.wa)&&Xw(t)}async function NY(n,e){const t=at(n),r=e.query;let i=3;const a=t.queries.get(r);if(a){const s=a.Sa.indexOf(e);s>=0&&(a.Sa.splice(s,1),a.Sa.length===0?i=e.Da()?0:1:!a.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function DY(n,e){const t=at(n);let r=!1;for(const i of e){const a=i.query,s=t.queries.get(a);if(s){for(const u of s.Sa)u.Fa(i)&&(r=!0);s.wa=i}}r&&Xw(t)}function kY(n,e,t){const r=at(n),i=r.queries.get(e);if(i)for(const a of i.Sa)a.onError(t);r.queries.delete(e)}function Xw(n){n.Ca.forEach((e=>{e.next()}))}var _1,_I;(_I=_1||(_1={})).Ma="default",_I.Cache="cache";class MY{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new rh(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=rh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_1.Cache}}class z4{constructor(e){this.key=e}}class H4{constructor(e){this.key=e}}class OY{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=_t(),this.mutatedKeys=_t(),this.eu=l4(e),this.tu=new Lc(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new vI,i=t?t.tu:this.tu;let a=t?t.mutatedKeys:this.mutatedKeys,s=i,u=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((d,p)=>{const g=i.get(d),v=Ov(this.query,p)?p:null,b=!!g&&this.mutatedKeys.has(g.key),E=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let w=!1;g&&v?g.data.isEqual(v.data)?b!==E&&(r.track({type:3,doc:v}),w=!0):this.su(g,v)||(r.track({type:2,doc:v}),w=!0,(c&&this.eu(v,c)>0||h&&this.eu(v,h)<0)&&(u=!0)):!g&&v?(r.track({type:0,doc:v}),w=!0):g&&!v&&(r.track({type:1,doc:g}),w=!0,(c||h)&&(u=!0)),w&&(v?(s=s.add(v),a=E?a.add(d):a.delete(d)):(s=s.delete(d),a=a.delete(d)))})),this.query.limit!==null)for(;s.size>this.query.limit;){const d=this.query.limitType==="F"?s.last():s.first();s=s.delete(d.key),a=a.delete(d.key),r.track({type:1,doc:d})}return{tu:s,iu:r,Cs:u,mutatedKeys:a}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort(((d,p)=>(function(v,b){const E=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $e(20277,{Rt:w})}};return E(v)-E(b)})(d.type,p.type)||this.eu(d.doc,p.doc))),this.ou(r),i=i??!1;const u=t&&!i?this._u():[],c=this.Xa.size===0&&this.current&&!i?1:0,h=c!==this.Za;return this.Za=c,s.length!==0||h?{snapshot:new rh(this.query,e.tu,a,s,e.mutatedKeys,c===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new vI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=_t(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new H4(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new z4(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=_t();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return rh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Yw="SyncEngine";class PY{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class FY{constructor(e){this.key=e,this.hu=!1}}class VY{constructor(e,t,r,i,a,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new fl((u=>u4(u)),Mv),this.Iu=new Map,this.Eu=new Set,this.du=new Vn(We.comparator),this.Au=new Map,this.Ru=new Lw,this.Vu={},this.mu=new Map,this.fu=nh.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function LY(n,e,t=!0){const r=Y4(n);let i;const a=r.Tu.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await G4(r,e,t,!0),i}async function BY(n,e){const t=Y4(n);await G4(t,e,!0,!1)}async function G4(n,e,t,r){const i=await nY(n.localStore,Xa(e)),a=i.targetId,s=n.sharedClientState.addLocalQueryTarget(a,t);let u;return r&&(u=await jY(n,e,a,s==="current",i.resumeToken)),n.isPrimaryClient&&t&&F4(n.remoteStore,i),u}async function jY(n,e,t,r,i){n.pu=(p,g,v)=>(async function(E,w,C,S){let I=w.view.ru(C);I.Cs&&(I=await hI(E.localStore,w.query,!1).then((({documents:N})=>w.view.ru(N,I))));const D=S&&S.targetChanges.get(w.targetId),O=S&&S.targetMismatches.get(w.targetId)!=null,B=w.view.applyChanges(I,E.isPrimaryClient,D,O);return xI(E,w.targetId,B.au),B.snapshot})(n,p,g,v);const a=await hI(n.localStore,e,!0),s=new OY(e,a.Qs),u=s.ru(a.documents),c=Wd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=s.applyChanges(u,n.isPrimaryClient,c);xI(n,t,h.au);const d=new PY(e,t,s);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function UY(n,e,t){const r=at(n),i=r.Tu.get(e),a=r.Iu.get(i.targetId);if(a.length>1)return r.Iu.set(i.targetId,a.filter((s=>!Mv(s,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await v1(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&zw(r.remoteStore,i.targetId),b1(r,i.targetId)})).catch(ph)):(b1(r,i.targetId),await v1(r.localStore,i.targetId,!0))}async function zY(n,e){const t=at(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zw(t.remoteStore,r.targetId))}async function HY(n,e,t){const r=$Y(n);try{const i=await(function(s,u){const c=at(s),h=Jt.now(),d=u.reduce(((v,b)=>v.add(b.key)),_t());let p,g;return c.persistence.runTransaction("Locally write mutations","readwrite",(v=>{let b=Vs(),E=_t();return c.Ns.getEntries(v,d).next((w=>{b=w,b.forEach(((C,S)=>{S.isValidDocument()||(E=E.add(C))}))})).next((()=>c.localDocuments.getOverlayedDocuments(v,b))).next((w=>{p=w;const C=[];for(const S of u){const I=tX(S,p.get(S.key).overlayedDocument);I!=null&&C.push(new ru(S.key,I,J3(I.value.mapValue),Ui.exists(!0)))}return c.mutationQueue.addMutationBatch(v,h,C,u)})).next((w=>{g=w;const C=w.applyToLocalDocumentSet(p,E);return c.documentOverlayCache.saveOverlays(v,w.batchId,C)}))})).then((()=>({batchId:g.batchId,changes:h4(p)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(s,u,c){let h=s.Vu[s.currentUser.toKey()];h||(h=new Vn(yt)),h=h.insert(u,c),s.Vu[s.currentUser.toKey()]=h})(r,i.batchId,t),await Kd(r,i.changes),await jv(r.remoteStore)}catch(i){const a=Kw(i,"Failed to persist write");t.reject(a)}}async function W4(n,e){const t=at(n);try{const r=await JX(t.localStore,e);e.targetChanges.forEach(((i,a)=>{const s=t.Au.get(a);s&&(Pt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?s.hu=!0:i.modifiedDocuments.size>0?Pt(s.hu,14607):i.removedDocuments.size>0&&(Pt(s.hu,42227),s.hu=!1))})),await Kd(t,r,e)}catch(r){await ph(r)}}function bI(n,e,t){const r=at(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((a,s)=>{const u=s.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(s,u){const c=at(s);c.onlineState=u;let h=!1;c.queries.forEach(((d,p)=>{for(const g of p.Sa)g.va(u)&&(h=!0)})),h&&Xw(c)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function GY(n,e,t){const r=at(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),a=i&&i.key;if(a){let s=new Vn(We.comparator);s=s.insert(a,Cr.newNoDocument(a,tt.min()));const u=_t().add(a),c=new Vv(tt.min(),new Map,new Vn(yt),s,u);await W4(r,c),r.du=r.du.remove(a),r.Au.delete(e),$w(r)}else await v1(r.localStore,e,!1).then((()=>b1(r,e,t))).catch(ph)}async function WY(n,e){const t=at(n),r=e.batch.batchId;try{const i=await ZX(t.localStore,e);K4(t,r,null),q4(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Kd(t,i)}catch(i){await ph(i)}}async function qY(n,e,t){const r=at(n);try{const i=await(function(s,u){const c=at(s);return c.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let d;return c.mutationQueue.lookupMutationBatch(h,u).next((p=>(Pt(p!==null,37113),d=p.keys(),c.mutationQueue.removeMutationBatch(h,p)))).next((()=>c.mutationQueue.performConsistencyCheck(h))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(h,d,u))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d))).next((()=>c.localDocuments.getDocuments(h,d)))}))})(r.localStore,e);K4(r,e,t),q4(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Kd(r,i)}catch(i){await ph(i)}}function q4(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function K4(n,e,t){const r=at(n);let i=r.Vu[r.currentUser.toKey()];if(i){const a=i.get(e);a&&(t?a.reject(t):a.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function b1(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||X4(n,r)}))}function X4(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(zw(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),$w(n))}function xI(n,e,t){for(const r of t)r instanceof z4?(n.Ru.addReference(r.key,e),KY(n,r)):r instanceof H4?(ke(Yw,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||X4(n,r.key)):$e(19791,{wu:r})}function KY(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(ke(Yw,"New document in limbo: "+t),n.Eu.add(r),$w(n))}function $w(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new We(qt.fromString(e)),r=n.fu.next();n.Au.set(r,new FY(t)),n.du=n.du.insert(t,r),F4(n.remoteStore,new Io(Xa(s4(t.path)),r,"TargetPurposeLimboResolution",Nv.ce))}}async function Kd(n,e,t){const r=at(n),i=[],a=[],s=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,c)=>{s.push(r.pu(c,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const d=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;r.sharedClientState.updateQueryState(c.targetId,d?"current":"not-current")}if(h){i.push(h);const d=jw.As(c.targetId,h);a.push(d)}})))})),await Promise.all(s),r.Pu.H_(i),await(async function(c,h){const d=at(c);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>we.forEach(h,(g=>we.forEach(g.Es,(v=>d.persistence.referenceDelegate.addReference(p,g.targetId,v))).next((()=>we.forEach(g.ds,(v=>d.persistence.referenceDelegate.removeReference(p,g.targetId,v)))))))))}catch(p){if(!mh(p))throw p;ke(Uw,"Failed to update sequence numbers: "+p)}for(const p of h){const g=p.targetId;if(!p.fromCache){const v=d.Ms.get(g),b=v.snapshotVersion,E=v.withLastLimboFreeSnapshotVersion(b);d.Ms=d.Ms.insert(g,E)}}})(r.localStore,a))}async function XY(n,e){const t=at(n);if(!t.currentUser.isEqual(e)){ke(Yw,"User change. New user:",e.toKey());const r=await k4(t.localStore,e);t.currentUser=e,(function(a,s){a.mu.forEach((u=>{u.forEach((c=>{c.reject(new Ne(be.CANCELLED,s))}))})),a.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Kd(t,r.Ls)}}function YY(n,e){const t=at(n),r=t.Au.get(e);if(r&&r.hu)return _t().add(r.key);{let i=_t();const a=t.Iu.get(e);if(!a)return i;for(const s of a){const u=t.Tu.get(s);i=i.unionWith(u.view.nu)}return i}}function Y4(n){const e=at(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=W4.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=YY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=GY.bind(null,e),e.Pu.H_=DY.bind(null,e.eventManager),e.Pu.yu=kY.bind(null,e.eventManager),e}function $Y(n){const e=at(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=WY.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qY.bind(null,e),e}class Qg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Lv(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return QX(this.persistence,new XX,e.initialUser,this.serializer)}Cu(e){return new D4(Bw.mi,this.serializer)}Du(e){return new iY}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Qg.provider={build:()=>new Qg};class QY extends Qg{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Pt(this.persistence.referenceDelegate instanceof Yg,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new MX(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Xr.withCacheSize(this.cacheSizeBytes):Xr.DEFAULT;return new D4((r=>Yg.mi(r,t)),this.serializer)}}class x1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>bI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=XY.bind(null,this.syncEngine),await SY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new RY})()}createDatastore(e){const t=Lv(e.databaseInfo.databaseId),r=(function(a){return new lY(a)})(e.databaseInfo);return(function(a,s,u,c){return new dY(a,s,u,c)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,a,s,u){return new mY(r,i,a,s,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>bI(this.syncEngine,t,0)),(function(){return pI.v()?new pI:new aY})())}createSyncEngine(e,t){return(function(i,a,s,u,c,h,d){const p=new VY(i,a,s,u,c,h);return d&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=at(t);ke(rl,"RemoteStore shutting down."),r.Ea.add(5),await qd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}x1.provider={build:()=>new x1};class ZY{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ps("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const $o="FirestoreClient";class JY{constructor(e,t,r,i,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Er.UNAUTHENTICATED,this.clientId=Aw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,(async s=>{ke($o,"Received user=",s.uid),await this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,(s=>(ke($o,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Kw(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Z_(n,e){n.asyncQueue.verifyOperationInProgress(),ke($o,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await k4(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function wI(n,e){n.asyncQueue.verifyOperationInProgress();const t=await e$(n);ke($o,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>gI(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>gI(e.remoteStore,i))),n._onlineComponents=e}async function e$(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ke($o,"Using user provided OfflineComponentProvider");try{await Z_(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===be.FAILED_PRECONDITION||i.code===be.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Zc("Error using user provided cache. Falling back to memory cache: "+t),await Z_(n,new Qg)}}else ke($o,"Using default OfflineComponentProvider"),await Z_(n,new QY(void 0));return n._offlineComponents}async function $4(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ke($o,"Using user provided OnlineComponentProvider"),await wI(n,n._uninitializedComponentsProvider._online)):(ke($o,"Using default OnlineComponentProvider"),await wI(n,new x1))),n._onlineComponents}function t$(n){return $4(n).then((e=>e.syncEngine))}async function n$(n){const e=await $4(n),t=e.eventManager;return t.onListen=LY.bind(null,e.syncEngine),t.onUnlisten=UY.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=BY.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zY.bind(null,e.syncEngine),t}function r$(n,e,t={}){const r=new Vo;return n.asyncQueue.enqueueAndForget((async()=>(function(a,s,u,c,h){const d=new ZY({next:g=>{d.Nu(),s.enqueueAndForget((()=>NY(a,p))),g.fromCache&&c.source==="server"?h.reject(new Ne(be.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(g)},error:g=>h.reject(g)}),p=new MY(u,d,{includeMetadataChanges:!0,qa:!0});return IY(a,p)})(await n$(n),n.asyncQueue,e,t,r))),r.promise}function Q4(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const EI=new Map;const Z4="firestore.googleapis.com",TI=!0;class CI{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Ne(be.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Z4,this.ssl=TI}else this.host=e.host,this.ssl=e.ssl??TI;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=N4;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<DX)throw new Ne(be.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dK("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Q4(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Ne(be.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Ne(be.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Ne(be.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Uv{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new CI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ne(be.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ne(be.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new CI(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new rK;switch(r.type){case"firstParty":return new oK(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ne(be.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=EI.get(t);r&&(ke("ComponentProvider","Removing Datastore"),EI.delete(t),r.terminate())})(this),Promise.resolve()}}function i$(n,e,t,r={}){n=Fs(n,Uv);const i=zd(e),a=n._getSettings(),s={...a,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;i&&(y3(`https://${u}`),b3("Firestore",!0)),a.host!==Z4&&a.host!==u&&Zc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...a,host:u,ssl:i,emulatorOptions:r};if(!pd(c,s)&&(n._setSettings(c),r.mockUserToken)){let h,d;if(typeof r.mockUserToken=="string")h=r.mockUserToken,d=Er.MOCK_USER;else{h=_3(r.mockUserToken,n._app?.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new Ne(be.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Er(p)}n._authCredentials=new iK(new U3(h,d))}}class iu{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new iu(this.firestore,e,this._query)}}class Fn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Fn(this.firestore,e,this._key)}toJSON(){return{type:Fn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Hd(t,Fn._jsonSchema))return new Fn(e,r||null,new We(qt.fromString(t.referencePath)))}}Fn._jsonSchemaVersion="firestore/documentReference/1.0",Fn._jsonSchema={type:Pn("string",Fn._jsonSchemaVersion),referencePath:Pn("string")};class Bo extends iu{constructor(e,t,r){super(e,t,s4(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Fn(this.firestore,null,new We(e))}withConverter(e){return new Bo(this.firestore,e,this._path)}}function Br(n,e,...t){if(n=la(n),z3("collection","path",e),n instanceof Uv){const r=qt.fromString(e,...t);return LR(r),new Bo(n,null,r)}{if(!(n instanceof Fn||n instanceof Bo))throw new Ne(be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qt.fromString(e,...t));return LR(r),new Bo(n.firestore,null,r)}}function Rs(n,e,...t){if(n=la(n),arguments.length===1&&(e=Aw.newId()),z3("doc","path",e),n instanceof Uv){const r=qt.fromString(e,...t);return VR(r),new Fn(n,null,new We(r))}{if(!(n instanceof Fn||n instanceof Bo))throw new Ne(be.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qt.fromString(e,...t));return VR(r),new Fn(n.firestore,n instanceof Bo?n.converter:null,new We(r))}}const SI="AsyncQueue";class AI{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new O4(this,"async_queue_retry"),this._c=()=>{const r=Q_();r&&ke(SI,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Q_();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Q_();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Vo;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!mh(e))throw e;ke(SI,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ps("INTERNAL UNHANDLED ERROR: ",RI(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=qw.createAndSchedule(this,e,t,r,(a=>this.hc(a)));return this.tc.push(i),i}uc(){this.nc&&$e(47125,{Pc:RI(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function RI(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class yh extends Uv{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new AI,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new AI(e),this._firestoreClient=void 0,await e}}}function a$(n,e){const t=typeof n=="object"?n:D3(),r=typeof n=="string"?n:Hg,i=A3(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const a=g3("firestore");a&&i$(i,...a)}return i}function J4(n){if(n._terminated)throw new Ne(be.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||s$(n),n._firestoreClient}function s$(n){const e=n._freezeSettings(),t=(function(i,a,s,u){return new CK(i,a,s,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Q4(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new JY(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const a=i?._online.build();return{_offline:i?._offline.build(a),_online:a}})(n._componentsProvider))}class Fi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fi(vr.fromBase64String(e))}catch(t){throw new Ne(be.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fi(vr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Hd(e,Fi._jsonSchema))return Fi.fromBase64String(e.bytes)}}Fi._jsonSchemaVersion="firestore/bytes/1.0",Fi._jsonSchema={type:Pn("string",Fi._jsonSchemaVersion),bytes:Pn("string")};class zv{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ne(be.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Hv{constructor(e){this._methodName=e}}class $a{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ne(be.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ne(be.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return yt(this._lat,e._lat)||yt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$a._jsonSchemaVersion}}static fromJSON(e){if(Hd(e,$a._jsonSchema))return new $a(e.latitude,e.longitude)}}$a._jsonSchemaVersion="firestore/geoPoint/1.0",$a._jsonSchema={type:Pn("string",$a._jsonSchemaVersion),latitude:Pn("number"),longitude:Pn("number")};class Qa{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==i[a])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Qa._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Hd(e,Qa._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Qa(e.vectorValues);throw new Ne(be.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Qa._jsonSchemaVersion="firestore/vectorValue/1.0",Qa._jsonSchema={type:Pn("string",Qa._jsonSchemaVersion),vectorValues:Pn("object")};const o$=/^__.*__$/;class u${constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ru(e,this.data,this.fieldMask,t,this.fieldTransforms):new Gd(e,this.data,t,this.fieldTransforms)}}class eO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ru(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function tO(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $e(40011,{Ac:n})}}class Qw{constructor(e,t,r,i,a,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Qw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Zg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(tO(this.Ac)&&o$.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class l${constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Lv(e)}Cc(e,t,r,i=!1){return new Qw({Ac:e,methodName:t,Dc:r,path:gr.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Gv(n){const e=n._freezeSettings(),t=Lv(n._databaseId);return new l$(n._databaseId,!!e.ignoreUndefinedProperties,t)}function nO(n,e,t,r,i,a={}){const s=n.Cc(a.merge||a.mergeFields?2:0,e,t,i);Jw("Data must be an object, but it was:",s,r);const u=rO(r,s);let c,h;if(a.merge)c=new vi(s.fieldMask),h=s.fieldTransforms;else if(a.mergeFields){const d=[];for(const p of a.mergeFields){const g=w1(e,p,t);if(!s.contains(g))throw new Ne(be.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);aO(d,g)||d.push(g)}c=new vi(d),h=s.fieldTransforms.filter((p=>c.covers(p.field)))}else c=null,h=s.fieldTransforms;return new u$(new Qr(u),c,h)}class Wv extends Hv{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Wv}}class Zw extends Hv{_toFieldTransform(e){return new QK(e.path,new wd)}isEqual(e){return e instanceof Zw}}function c$(n,e,t,r){const i=n.Cc(1,e,t);Jw("Data must be an object, but it was:",i,r);const a=[],s=Qr.empty();nu(r,((c,h)=>{const d=eE(e,c,t);h=la(h);const p=i.yc(d);if(h instanceof Wv)a.push(d);else{const g=Xd(h,p);g!=null&&(a.push(d),s.set(d,g))}}));const u=new vi(a);return new eO(s,u,i.fieldTransforms)}function h$(n,e,t,r,i,a){const s=n.Cc(1,e,t),u=[w1(e,r,t)],c=[i];if(a.length%2!=0)throw new Ne(be.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<a.length;g+=2)u.push(w1(e,a[g])),c.push(a[g+1]);const h=[],d=Qr.empty();for(let g=u.length-1;g>=0;--g)if(!aO(h,u[g])){const v=u[g];let b=c[g];b=la(b);const E=s.yc(v);if(b instanceof Wv)h.push(v);else{const w=Xd(b,E);w!=null&&(h.push(v),d.set(v,w))}}const p=new vi(h);return new eO(d,p,s.fieldTransforms)}function f$(n,e,t,r=!1){return Xd(t,n.Cc(r?4:3,e))}function Xd(n,e){if(iO(n=la(n)))return Jw("Unsupported field value:",e,n),rO(n,e);if(n instanceof Hv)return(function(r,i){if(!tO(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(i);a&&i.fieldTransforms.push(a)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const a=[];let s=0;for(const u of r){let c=Xd(u,i.wc(s));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),s++}return{arrayValue:{values:a}}})(n,e)}return(function(r,i){if((r=la(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return XK(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=Jt.fromDate(r);return{timestampValue:Xg(i.serializer,a)}}if(r instanceof Jt){const a=new Jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xg(i.serializer,a)}}if(r instanceof $a)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Fi)return{bytesValue:E4(i.serializer,r._byteString)};if(r instanceof Fn){const a=i.databaseId,s=r.firestore._databaseId;if(!s.isEqual(a))throw i.Sc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Vw(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Qa)return(function(s,u){return{mapValue:{fields:{[Q3]:{stringValue:Z3},[Gg]:{arrayValue:{values:s.toArray().map((h=>{if(typeof h!="number")throw u.Sc("VectorValues must only contain numeric values.");return Mw(u.serializer,h)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Iv(r)}`)})(n,e)}function rO(n,e){const t={};return W3(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):nu(n,((r,i)=>{const a=Xd(i,e.mc(r));a!=null&&(t[r]=a)})),{mapValue:{fields:t}}}function iO(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Jt||n instanceof $a||n instanceof Fi||n instanceof Fn||n instanceof Hv||n instanceof Qa)}function Jw(n,e,t){if(!iO(t)||!H3(t)){const r=Iv(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function w1(n,e,t){if((e=la(e))instanceof zv)return e._internalPath;if(typeof e=="string")return eE(n,e);throw Zg("Field path arguments must be of type string or ",n,!1,void 0,t)}const d$=new RegExp("[~\\*/\\[\\]]");function eE(n,e,t){if(e.search(d$)>=0)throw Zg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new zv(...e.split("."))._internalPath}catch{throw Zg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Zg(n,e,t,r,i){const a=r&&!r.isEmpty(),s=i!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(a||s)&&(c+=" (found",a&&(c+=` in field ${r}`),s&&(c+=` in document ${i}`),c+=")"),new Ne(be.INVALID_ARGUMENT,u+n+c)}function aO(n,e){return n.some((t=>t.isEqual(e)))}class sO{constructor(e,t,r,i,a){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Fn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new p$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(qv("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class p$ extends sO{data(){return super.data()}}function qv(n,e){return typeof e=="string"?eE(n,e):e instanceof zv?e._internalPath:e._delegate._internalPath}function m$(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ne(be.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tE{}class nE extends tE{}function Qu(n,e,...t){let r=[];e instanceof tE&&r.push(e),r=r.concat(t),(function(a){const s=a.filter((c=>c instanceof rE)).length,u=a.filter((c=>c instanceof Kv)).length;if(s>1||s>0&&u>0)throw new Ne(be.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class Kv extends nE{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Kv(e,t,r)}_apply(e){const t=this._parse(e);return oO(e._query,t),new iu(e.firestore,e.converter,f1(e._query,t))}_parse(e){const t=Gv(e.firestore);return(function(a,s,u,c,h,d,p){let g;if(h.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Ne(be.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){DI(p,d);const b=[];for(const E of p)b.push(NI(c,a,E));g={arrayValue:{values:b}}}else g=NI(c,a,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||DI(p,d),g=f$(u,s,p,d==="in"||d==="not-in");return On.create(h,d,g)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function II(n,e,t){const r=e,i=qv("where",n);return Kv._create(i,r,t)}class rE extends tE{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new rE(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:ca.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,a){let s=i;const u=a.getFlattenedFilters();for(const c of u)oO(s,c),s=f1(s,c)})(e._query,t),new iu(e.firestore,e.converter,f1(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class iE extends nE{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new iE(e,t)}_apply(e){const t=(function(i,a,s){if(i.startAt!==null)throw new Ne(be.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Ne(be.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new xd(a,s)})(e._query,this._field,this._direction);return new iu(e.firestore,e.converter,(function(i,a){const s=i.explicitOrderBy.concat([a]);return new gh(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}}function Zu(n,e="asc"){const t=e,r=qv("orderBy",n);return iE._create(r,t)}class aE extends nE{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new aE(e,t,r)}_apply(e){return new iu(e.firestore,e.converter,qg(e._query,this._limit,this._limitType))}}function Bc(n){return pK("limit",n),aE._create("limit",n,"F")}function NI(n,e,t){if(typeof(t=la(t))=="string"){if(t==="")throw new Ne(be.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!o4(e)&&t.indexOf("/")!==-1)throw new Ne(be.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(qt.fromString(t));if(!We.isDocumentKey(r))throw new Ne(be.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qR(n,new We(r))}if(t instanceof Fn)return qR(n,t._key);throw new Ne(be.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Iv(t)}.`)}function DI(n,e){if(!Array.isArray(n)||n.length===0)throw new Ne(be.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function oO(n,e){const t=(function(i,a){for(const s of i)for(const u of s.getFlattenedFilters())if(a.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Ne(be.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ne(be.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class g${convertValue(e,t="none"){switch(Xo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _n(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ko(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $e(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return nu(e,((i,a)=>{r[i]=this.convertValue(a,t)})),r}convertVectorValue(e){const t=e.fields?.[Gg].arrayValue?.values?.map((r=>_n(r.doubleValue)));return new Qa(t)}convertGeoPoint(e){return new $a(_n(e.latitude),_n(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=kv(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yd(e));default:return null}}convertTimestamp(e){const t=qo(e);return new Jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=qt.fromString(e);Pt(I4(r),9688,{name:e});const i=new _d(r.get(1),r.get(3)),a=new We(r.popFirst(5));return i.isEqual(t)||Ps(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}function uO(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class Xm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jc extends sO{constructor(e,t,r,i,a,s){super(e,t,r,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new og(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(qv("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ne(be.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=jc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}jc._jsonSchemaVersion="firestore/documentSnapshot/1.0",jc._jsonSchema={type:Pn("string",jc._jsonSchemaVersion),bundleSource:Pn("string","DocumentSnapshot"),bundleName:Pn("string"),bundle:Pn("string")};class og extends jc{data(e={}){return super.data(e)}}class Uc{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Xm(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new og(this._firestore,this._userDataWriter,r.key,r,new Xm(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ne(be.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,a){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map((u=>{const c=new og(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Xm(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:s++}}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>a||u.type!==3)).map((u=>{const c=new og(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Xm(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return u.type!==0&&(h=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),u.type!==1&&(s=s.add(u.doc),d=s.indexOf(u.doc.key)),{type:v$(u.type),doc:c,oldIndex:h,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ne(be.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Uc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Aw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((a=>{a._document!==null&&(t.push(a._document),r.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),i.push(a.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function v$(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $e(61501,{type:n})}}Uc._jsonSchemaVersion="firestore/querySnapshot/1.0",Uc._jsonSchema={type:Pn("string",Uc._jsonSchemaVersion),bundleSource:Pn("string","QuerySnapshot"),bundleName:Pn("string"),bundle:Pn("string")};class y$ extends g${constructor(e){super(),this.firestore=e}convertBytes(e){return new Fi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fn(this.firestore,null,t)}}function Ns(n){n=Fs(n,iu);const e=Fs(n.firestore,yh),t=J4(e),r=new y$(e);return m$(n._query),r$(t,n._query).then((i=>new Uc(e,r,n,i)))}function kI(n,e,t){n=Fs(n,Fn);const r=Fs(n.firestore,yh),i=uO(n.converter,e);return Xv(r,[nO(Gv(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ui.none())])}function E1(n,e,t,...r){n=Fs(n,Fn);const i=Fs(n.firestore,yh),a=Gv(i);let s;return s=typeof(e=la(e))=="string"||e instanceof zv?h$(a,"updateDoc",n._key,e,t,r):c$(a,"updateDoc",n._key,e),Xv(i,[s.toMutation(n._key,Ui.exists(!0))])}function T1(n){return Xv(Fs(n.firestore,yh),[new Ow(n._key,Ui.none())])}function _h(n,e){const t=Fs(n.firestore,yh),r=Rs(n),i=uO(n.converter,e);return Xv(t,[nO(Gv(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ui.exists(!1))]).then((()=>r))}function Xv(n,e){return(function(r,i){const a=new Vo;return r.asyncQueue.enqueueAndForget((async()=>HY(await t$(r),i,a))),a.promise})(J4(n),e)}function lO(){return new Zw("serverTimestamp")}(function(e,t=!0){(function(i){dh=i})(I3),md(new Qc("firestore",((r,{instanceIdentifier:i,options:a})=>{const s=r.getProvider("app").getImmediate(),u=new yh(new aK(r.getProvider("auth-internal")),new uK(s,r.getProvider("app-check-internal")),(function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Ne(be.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _d(h.options.projectId,d)})(s,i),s);return a={useFetchStreams:t,...a},u._setSettings(a),u}),"PUBLIC").setMultipleInstances(!0)),Po(MR,OR,e),Po(MR,OR,"esm2020")})();var MI={};const OI="@firebase/database",PI="1.1.0";let cO="";function _$(n){cO=n}class b${constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),mr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:dd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class x${constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ws(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const hO=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new b$(e)}}catch{}return new x$},Ku=hO("localStorage"),w$=hO("sessionStorage");const zc=new Tw("@firebase/database"),E$=(function(){let n=1;return function(){return n++}})(),fO=function(n){const e=qq(n),t=new Gq;t.update(e);const r=t.digest();return xw.encodeByteArray(r)},Yd=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Yd.apply(null,r):typeof r=="object"?e+=mr(r):e+=r,e+=" "}return e};let Qf=null,FI=!0;const T$=function(n,e){Ie(!0,"Can't turn on custom loggers persistently."),zc.logLevel=xt.VERBOSE,Qf=zc.log.bind(zc)},Sr=function(...n){if(FI===!0&&(FI=!1,Qf===null&&w$.get("logging_enabled")===!0&&T$()),Qf){const e=Yd.apply(null,n);Qf(e)}},$d=function(n){return function(...e){Sr(n,...e)}},C1=function(...n){const e="FIREBASE INTERNAL ERROR: "+Yd(...n);zc.error(e)},Ls=function(...n){const e=`FIREBASE FATAL ERROR: ${Yd(...n)}`;throw zc.error(e),new Error(e)},_i=function(...n){const e="FIREBASE WARNING: "+Yd(...n);zc.warn(e)},C$=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&_i("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},dO=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},S$=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ih="[MIN_NAME]",il="[MAX_NAME]",bh=function(n,e){if(n===e)return 0;if(n===ih||e===il)return-1;if(e===ih||n===il)return 1;{const t=VI(n),r=VI(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},A$=function(n,e){return n===e?0:n<e?-1:1},Df=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+mr(e))},sE=function(n){if(typeof n!="object"||n===null)return mr(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=mr(e[r]),t+=":",t+=sE(n[e[r]]);return t+="}",t},pO=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function zi(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const mO=function(n){Ie(!dO(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let i,a,s,u,c;n===0?(a=0,s=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(u=Math.min(Math.floor(Math.log(n)/Math.LN2),r),a=u+r,s=Math.round(n*Math.pow(2,t-u)-Math.pow(2,t))):(a=0,s=Math.round(n/Math.pow(2,1-r-t))));const h=[];for(c=t;c;c-=1)h.push(s%2?1:0),s=Math.floor(s/2);for(c=e;c;c-=1)h.push(a%2?1:0),a=Math.floor(a/2);h.push(i?1:0),h.reverse();const d=h.join("");let p="";for(c=0;c<64;c+=8){let g=parseInt(d.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),p=p+g}return p.toLowerCase()},R$=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},I$=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},N$=new RegExp("^-?(0*)\\d{1,10}$"),D$=-2147483648,k$=2147483647,VI=function(n){if(N$.test(n)){const e=Number(n);if(e>=D$&&e<=k$)return e}return null},Qd=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw _i("Exception was thrown by user callback.",t),e},Math.floor(0))}},M$=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zf=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class O${constructor(e,t){this.appCheckProvider=t,this.appName=e.name,R3(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){_i(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class P${constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Sr("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',_i(e)}}class ug{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ug.OWNER="owner";const oE="5",gO="v",vO="s",yO="r",_O="f",bO=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,xO="ls",wO="p",S1="ac",EO="websocket",TO="long_polling";class CO{constructor(e,t,r,i,a=!1,s="",u=!1,c=!1,h=null){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=a,this.persistenceKey=s,this.includeNamespaceInQueryParams=u,this.isUsingEmulator=c,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ku.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ku.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function F$(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function SO(n,e,t){Ie(typeof e=="string","typeof type must == string"),Ie(typeof t=="object","typeof params must == object");let r;if(e===EO)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===TO)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);F$(n)&&(t.ns=n.namespace);const i=[];return zi(t,(a,s)=>{i.push(a+"="+s)}),r+i.join("&")}class V${constructor(){this.counters_={}}incrementCounter(e,t=1){Ws(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Eq(this.counters_)}}const J_={},eb={};function uE(n){const e=n.toString();return J_[e]||(J_[e]=new V$),J_[e]}function L$(n,e){const t=n.toString();return eb[t]||(eb[t]=e()),eb[t]}class B${constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Qd(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const LI="start",j$="close",U$="pLPCommand",z$="pRTLPCB",AO="id",RO="pw",IO="ser",H$="cb",G$="seg",W$="ts",q$="d",K$="dframe",NO=1870,DO=30,X$=NO-DO,Y$=25e3,$$=3e4;class Sc{constructor(e,t,r,i,a,s,u){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.transportSessionId=s,this.lastSessionId=u,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=$d(e),this.stats_=uE(t),this.urlFn=c=>(this.appCheckToken&&(c[S1]=this.appCheckToken),SO(t,TO,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new B$(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor($$)),S$(()=>{if(this.isClosed_)return;this.scriptTagHolder=new lE((...a)=>{const[s,u,c,h,d]=a;if(this.incrementIncomingBytes_(a),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,s===LI)this.id=u,this.password=c;else if(s===j$)u?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(u,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+s)},(...a)=>{const[s,u]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(s,u)},()=>{this.onClosed_()},this.urlFn);const r={};r[LI]="t",r[IO]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[H$]=this.scriptTagHolder.uniqueCallbackIdentifier),r[gO]=oE,this.transportSessionId&&(r[vO]=this.transportSessionId),this.lastSessionId&&(r[xO]=this.lastSessionId),this.applicationId&&(r[wO]=this.applicationId),this.appCheckToken&&(r[S1]=this.appCheckToken),typeof location<"u"&&location.hostname&&bO.test(location.hostname)&&(r[yO]=_O);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Sc.forceAllow_=!0}static forceDisallow(){Sc.forceDisallow_=!0}static isAvailable(){return Sc.forceAllow_?!0:!Sc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!R$()&&!I$()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=mr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=p3(t),i=pO(r,X$);for(let a=0;a<i.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[a]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[K$]="t",r[AO]=e,r[RO]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=mr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class lE{constructor(e,t,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=E$(),window[U$+this.uniqueCallbackIdentifier]=e,window[z$+this.uniqueCallbackIdentifier]=t,this.myIFrame=lE.createIFrame_();let a="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(a='<script>document.domain="'+document.domain+'";<\/script>');const s="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(u){Sr("frame writing exception"),u.stack&&Sr(u.stack),Sr(u)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Sr("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[AO]=this.myID,e[RO]=this.myPW,e[IO]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+DO+r.length<=NO;){const s=this.pendingSegs.shift();r=r+"&"+G$+i+"="+s.seg+"&"+W$+i+"="+s.ts+"&"+q$+i+"="+s.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(Y$)),a=()=>{clearTimeout(i),r()};this.addTag(e,a)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Sr("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}const Q$=16384,Z$=45e3;let Jg=null;typeof MozWebSocket<"u"?Jg=MozWebSocket:typeof WebSocket<"u"&&(Jg=WebSocket);class ia{constructor(e,t,r,i,a,s,u){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=$d(this.connId),this.stats_=uE(t),this.connURL=ia.connectionURL_(t,s,u,i,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,i,a){const s={};return s[gO]=oE,typeof location<"u"&&location.hostname&&bO.test(location.hostname)&&(s[yO]=_O),t&&(s[vO]=t),r&&(s[xO]=r),i&&(s[S1]=i),a&&(s[wO]=a),SO(e,EO,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ku.set("previous_websocket_failure",!0);try{let r;Oq(),this.mySock=new Jg(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){ia.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Jg!==null&&!ia.forceDisallow_}static previouslyFailed(){return Ku.isInMemoryStorage||Ku.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ku.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=dd(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Ie(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=mr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=pO(t,Q$);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Z$))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ia.responsesRequiredToBeHealthy=2;ia.healthyTimeout=3e4;class Cd{static get ALL_TRANSPORTS(){return[Sc,ia]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=ia&&ia.isAvailable();let r=t&&!ia.previouslyFailed();if(e.webSocketOnly&&(t||_i("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ia];else{const i=this.transports_=[];for(const a of Cd.ALL_TRANSPORTS)a&&a.isAvailable()&&i.push(a);Cd.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Cd.globalTransportInitialized_=!1;const J$=6e4,eQ=5e3,tQ=10*1024,nQ=100*1024,tb="t",BI="d",rQ="s",jI="r",iQ="e",UI="o",zI="a",HI="n",GI="p",aQ="h";class sQ{constructor(e,t,r,i,a,s,u,c,h,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=a,this.onMessage_=s,this.onReady_=u,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=$d("c:"+this.id+":"),this.transportManager_=new Cd(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Zf(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>nQ?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>tQ?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(tb in e){const t=e[tb];t===zI?this.upgradeIfSecondaryHealthy_():t===jI?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===UI&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Df("t",e),r=Df("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:GI,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:zI,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:HI,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Df("t",e),r=Df("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Df(tb,e);if(BI in e){const r=e[BI];if(t===aQ){const i={...r};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===HI){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===rQ?this.onConnectionShutdown_(r):t===jI?this.onReset_(r):t===iQ?C1("Server Error: "+r):t===UI?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):C1("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),oE!==r&&_i("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Zf(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(J$))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zf(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(eQ))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:GI,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ku.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class kO{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class MO{constructor(e){this.allowedEvents_=e,this.listeners_={},Ie(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let a=0;a<i.length;a++)if(i[a].callback===t&&(!r||r===i[a].context)){i.splice(a,1);return}}validateEventType_(e){Ie(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ev extends MO{static getInstance(){return new ev}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!w3()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Ie(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const WI=32,qI=768;class en{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Gt(){return new en("")}function Ct(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Qo(n){return n.pieces_.length-n.pieceNum_}function Zt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new en(n.pieces_,e)}function OO(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function oQ(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function PO(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function FO(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new en(e,0)}function nr(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof en)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new en(t,0)}function Et(n){return n.pieceNum_>=n.pieces_.length}function Bi(n,e){const t=Ct(n),r=Ct(e);if(t===null)return e;if(t===r)return Bi(Zt(n),Zt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function VO(n,e){if(Qo(n)!==Qo(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function sa(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Qo(n)>Qo(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class uQ{constructor(e,t){this.errorPrefix_=t,this.parts_=PO(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Rv(this.parts_[r]);LO(this)}}function lQ(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Rv(e),LO(n)}function cQ(n){const e=n.parts_.pop();n.byteLength_-=Rv(e),n.parts_.length>0&&(n.byteLength_-=1)}function LO(n){if(n.byteLength_>qI)throw new Error(n.errorPrefix_+"has a key path longer than "+qI+" bytes ("+n.byteLength_+").");if(n.parts_.length>WI)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+WI+") or object contains a cycle "+ju(n))}function ju(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class cE extends MO{static getInstance(){return new cE}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Ie(e==="visible","Unknown event type: "+e),[this.visible_]}}const kf=1e3,hQ=300*1e3,KI=30*1e3,fQ=1.3,dQ=3e4,pQ="server_kill",XI=3;class Ds extends kO{constructor(e,t,r,i,a,s,u,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=a,this.authTokenProvider_=s,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=Ds.nextPersistentConnectionId_++,this.log_=$d("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=kf,this.maxReconnectDelay_=hQ,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");cE.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ev.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,a={r:i,a:e,b:t};this.log_(mr(a)),Ie(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new Ew,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:s=>{const u=s.d;s.s==="ok"?t.resolve(u):t.reject(u)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const a=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(a),t.promise}listen(e,t,r,i){this.initConnection_();const a=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+a),this.listens.has(s)||this.listens.set(s,new Map),Ie(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Ie(!this.listens.get(s).has(a),"listen() called twice for same path/queryId.");const u={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(s).set(a,u),this.connected_&&this.sendListen_(u)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+r+" for "+i);const a={p:r},s="q";e.tag&&(a.q=t._queryObject,a.t=e.tag),a.h=e.hashFn(),this.sendRequest(s,a,u=>{const c=u.d,h=u.s;Ds.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",u),h!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ws(e,"w")){const r=$c(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();_i(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||zq(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=KI)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Uq(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,i=>{const a=i.s,s=i.d||"error";this.authToken_===e&&(a==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,s))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),Ie(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,r,i){this.log_("Unlisten on "+e+" for "+t);const a={p:e},s="n";i&&(a.q=r,a.t=i),this.sendRequest(s,a)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,i){const a={p:t,d:r};this.log_("onDisconnect "+e,a),this.sendRequest(e,a,s=>{i&&setTimeout(()=>{i(s.s,s.d)},Math.floor(0))})}put(e,t,r,i){this.putInternal("p",e,t,r,i)}merge(e,t,r,i){this.putInternal("m",e,t,r,i)}putInternal(e,t,r,i,a){this.initConnection_();const s={p:t,d:r};a!==void 0&&(s.h=a),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const a=r.d;this.log_("reportStats","Error sending stats: "+a)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+mr(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):C1("Unrecognized action received from server: "+mr(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Ie(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=kf,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=kf,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>dQ&&(this.reconnectDelay_=kf),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*fQ)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ds.nextConnectionId_++,a=this.lastSessionId;let s=!1,u=null;const c=function(){u?u.close():(s=!0,r())},h=function(p){Ie(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:c,sendRequest:h};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,g]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);s?Sr("getToken() completed but was canceled"):(Sr("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=g&&g.token,u=new sQ(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,v=>{_i(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(pQ)},a))}catch(p){this.log_("Failed to get token: "+p),s||(this.repoInfo_.nodeAdmin&&_i(p),c())}}}interrupt(e){Sr("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Sr("Resuming connection for reason: "+e),delete this.interruptReasons_[e],wR(this.interruptReasons_)&&(this.reconnectDelay_=kf,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(a=>sE(a)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const r=new en(e).toString();let i;if(this.listens.has(r)){const a=this.listens.get(r);i=a.get(t),a.delete(t),a.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,t){Sr("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=XI&&(this.reconnectDelay_=KI,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Sr("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=XI&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+cO.replace(/\./g,"-")]=1,w3()?e["framework.cordova"]=1:Mq()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ev.getInstance().currentlyOnline();return wR(this.interruptReasons_)&&e}}Ds.nextPersistentConnectionId_=0;Ds.nextConnectionId_=0;class St{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new St(e,t)}}class Yv{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new St(ih,e),i=new St(ih,t);return this.compare(r,i)!==0}minPost(){return St.MIN}}let Ym;class BO extends Yv{static get __EMPTY_NODE(){return Ym}static set __EMPTY_NODE(e){Ym=e}compare(e,t){return bh(e.name,t.name)}isDefinedOn(e){throw hh("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return St.MIN}maxPost(){return new St(il,Ym)}makePost(e,t){return Ie(typeof e=="string","KeyIndex indexValue must always be a string."),new St(e,Ym)}toString(){return".key"}}const Hc=new BO;class $m{constructor(e,t,r,i,a=null){this.isReverse_=i,this.resultGenerator_=a,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?r(e.key,t):1,i&&(s*=-1),s<0)this.isReverse_?e=e.left:e=e.right;else if(s===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class tr{constructor(e,t,r,i,a){this.key=e,this.value=t,this.color=r??tr.RED,this.left=i??Jr.EMPTY_NODE,this.right=a??Jr.EMPTY_NODE}copy(e,t,r,i,a){return new tr(e??this.key,t??this.value,r??this.color,i??this.left,a??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const a=r(e,i.key);return a<0?i=i.copy(null,null,null,i.left.insert(e,t,r),null):a===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Jr.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,i;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Jr.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,tr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,tr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}tr.RED=!0;tr.BLACK=!1;class mQ{copy(e,t,r,i,a){return this}insert(e,t,r){return new tr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Jr{constructor(e,t=Jr.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Jr(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,tr.BLACK,null,null))}remove(e){return new Jr(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,tr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new $m(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new $m(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new $m(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new $m(this.root_,null,this.comparator_,!0,e)}}Jr.EMPTY_NODE=new mQ;function gQ(n,e){return bh(n.name,e.name)}function hE(n,e){return bh(n,e)}let A1;function vQ(n){A1=n}const jO=function(n){return typeof n=="number"?"number:"+mO(n):"string:"+n},UO=function(n){if(n.isLeafNode()){const e=n.val();Ie(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ws(e,".sv"),"Priority must be a string or number.")}else Ie(n===A1||n.isEmpty(),"priority of unexpected type.");Ie(n===A1||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let YI;class Jn{static set __childrenNodeConstructor(e){YI=e}static get __childrenNodeConstructor(){return YI}constructor(e,t=Jn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Ie(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),UO(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Jn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Jn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Et(e)?this:Ct(e)===".priority"?this.priorityNode_:Jn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Jn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=Ct(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(Ie(r!==".priority"||Qo(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Jn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Zt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+jO(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=mO(this.value_):e+=this.value_,this.lazyHash_=fO(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Jn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Jn.__childrenNodeConstructor?-1:(Ie(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=Jn.VALUE_TYPE_ORDER.indexOf(t),a=Jn.VALUE_TYPE_ORDER.indexOf(r);return Ie(i>=0,"Unknown leaf type: "+t),Ie(a>=0,"Unknown leaf type: "+r),i===a?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Jn.VALUE_TYPE_ORDER=["object","boolean","number","string"];let zO,HO;function yQ(n){zO=n}function _Q(n){HO=n}class bQ extends Yv{compare(e,t){const r=e.node.getPriority(),i=t.node.getPriority(),a=r.compareTo(i);return a===0?bh(e.name,t.name):a}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return St.MIN}maxPost(){return new St(il,new Jn("[PRIORITY-POST]",HO))}makePost(e,t){const r=zO(e);return new St(t,new Jn("[PRIORITY-POST]",r))}toString(){return".priority"}}const kr=new bQ;const xQ=Math.log(2);class wQ{constructor(e){const t=a=>parseInt(Math.log(a)/xQ,10),r=a=>parseInt(Array(a+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const tv=function(n,e,t,r){n.sort(e);const i=function(c,h){const d=h-c;let p,g;if(d===0)return null;if(d===1)return p=n[c],g=t?t(p):p,new tr(g,p.node,tr.BLACK,null,null);{const v=parseInt(d/2,10)+c,b=i(c,v),E=i(v+1,h);return p=n[v],g=t?t(p):p,new tr(g,p.node,tr.BLACK,b,E)}},a=function(c){let h=null,d=null,p=n.length;const g=function(b,E){const w=p-b,C=p;p-=b;const S=i(w+1,C),I=n[w],D=t?t(I):I;v(new tr(D,I.node,E,null,S))},v=function(b){h?(h.left=b,h=b):(d=b,h=b)};for(let b=0;b<c.count;++b){const E=c.nextBitIsOne(),w=Math.pow(2,c.count-(b+1));E?g(w,tr.BLACK):(g(w,tr.BLACK),g(w,tr.RED))}return d},s=new wQ(n.length),u=a(s);return new Jr(r||e,u)};let nb;const hc={};class Is{static get Default(){return Ie(hc&&kr,"ChildrenNode.ts has not been loaded"),nb=nb||new Is({".priority":hc},{".priority":kr}),nb}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=$c(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Jr?t:null}hasIndex(e){return Ws(this.indexSet_,e.toString())}addIndex(e,t){Ie(e!==Hc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const a=t.getIterator(St.Wrap);let s=a.getNext();for(;s;)i=i||e.isDefinedOn(s.node),r.push(s),s=a.getNext();let u;i?u=tv(r,e.getCompare()):u=hc;const c=e.toString(),h={...this.indexSet_};h[c]=e;const d={...this.indexes_};return d[c]=u,new Is(d,h)}addToIndexes(e,t){const r=jg(this.indexes_,(i,a)=>{const s=$c(this.indexSet_,a);if(Ie(s,"Missing index implementation for "+a),i===hc)if(s.isDefinedOn(e.node)){const u=[],c=t.getIterator(St.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&u.push(h),h=c.getNext();return u.push(e),tv(u,s.getCompare())}else return hc;else{const u=t.get(e.name);let c=i;return u&&(c=c.remove(new St(e.name,u))),c.insert(e,e.node)}});return new Is(r,this.indexSet_)}removeFromIndexes(e,t){const r=jg(this.indexes_,i=>{if(i===hc)return i;{const a=t.get(e.name);return a?i.remove(new St(e.name,a)):i}});return new Is(r,this.indexSet_)}}let Mf;class Ot{static get EMPTY_NODE(){return Mf||(Mf=new Ot(new Jr(hE),null,Is.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&UO(this.priorityNode_),this.children_.isEmpty()&&Ie(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Mf}updatePriority(e){return this.children_.isEmpty()?this:new Ot(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Mf:t}}getChild(e){const t=Ct(e);return t===null?this:this.getImmediateChild(t).getChild(Zt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Ie(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new St(e,t);let i,a;t.isEmpty()?(i=this.children_.remove(e),a=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),a=this.indexMap_.addToIndexes(r,this.children_));const s=i.isEmpty()?Mf:this.priorityNode_;return new Ot(i,s,a)}}updateChild(e,t){const r=Ct(e);if(r===null)return t;{Ie(Ct(e)!==".priority"||Qo(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Zt(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,i=0,a=!0;if(this.forEachChild(kr,(s,u)=>{t[s]=u.val(e),r++,a&&Ot.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):a=!1}),!e&&a&&i<2*r){const s=[];for(const u in t)s[u]=t[u];return s}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+jO(this.getPriority().val())+":"),this.forEachChild(kr,(t,r)=>{const i=r.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":fO(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const i=this.resolveIndex_(r);if(i){const a=i.getPredecessorKey(new St(e,t));return a?a.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new St(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new St(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,St.Wrap);let a=i.peek();for(;a!=null&&t.compare(a,e)<0;)i.getNext(),a=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,St.Wrap);let a=i.peek();for(;a!=null&&t.compare(a,e)>0;)i.getNext(),a=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Zd?-1:0}withIndex(e){if(e===Hc||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ot(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Hc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(kr),i=t.getIterator(kr);let a=r.getNext(),s=i.getNext();for(;a&&s;){if(a.name!==s.name||!a.node.equals(s.node))return!1;a=r.getNext(),s=i.getNext()}return a===null&&s===null}else return!1;else return!1}}resolveIndex_(e){return e===Hc?null:this.indexMap_.get(e.toString())}}Ot.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class EQ extends Ot{constructor(){super(new Jr(hE),Ot.EMPTY_NODE,Is.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ot.EMPTY_NODE}isEmpty(){return!1}}const Zd=new EQ;Object.defineProperties(St,{MIN:{value:new St(ih,Ot.EMPTY_NODE)},MAX:{value:new St(il,Zd)}});BO.__EMPTY_NODE=Ot.EMPTY_NODE;Jn.__childrenNodeConstructor=Ot;vQ(Zd);_Q(Zd);const TQ=!0;function Ar(n,e=null){if(n===null)return Ot.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Ie(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Jn(t,Ar(e))}if(!(n instanceof Array)&&TQ){const t=[];let r=!1;if(zi(n,(s,u)=>{if(s.substring(0,1)!=="."){const c=Ar(u);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new St(s,c)))}}),t.length===0)return Ot.EMPTY_NODE;const a=tv(t,gQ,s=>s.name,hE);if(r){const s=tv(t,kr.getCompare());return new Ot(a,Ar(e),new Is({".priority":s},{".priority":kr}))}else return new Ot(a,Ar(e),Is.Default)}else{let t=Ot.EMPTY_NODE;return zi(n,(r,i)=>{if(Ws(n,r)&&r.substring(0,1)!=="."){const a=Ar(i);(a.isLeafNode()||!a.isEmpty())&&(t=t.updateImmediateChild(r,a))}}),t.updatePriority(Ar(e))}}yQ(Ar);class CQ extends Yv{constructor(e){super(),this.indexPath_=e,Ie(!Et(e)&&Ct(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),i=this.extractChild(t.node),a=r.compareTo(i);return a===0?bh(e.name,t.name):a}makePost(e,t){const r=Ar(e),i=Ot.EMPTY_NODE.updateChild(this.indexPath_,r);return new St(t,i)}maxPost(){const e=Ot.EMPTY_NODE.updateChild(this.indexPath_,Zd);return new St(il,e)}toString(){return PO(this.indexPath_,0).join("/")}}class SQ extends Yv{compare(e,t){const r=e.node.compareTo(t.node);return r===0?bh(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return St.MIN}maxPost(){return St.MAX}makePost(e,t){const r=Ar(e);return new St(t,r)}toString(){return".value"}}const AQ=new SQ;function RQ(n){return{type:"value",snapshotNode:n}}function IQ(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function NQ(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function $I(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function DQ(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class fE{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=kr}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Ie(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Ie(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ih}hasEnd(){return this.endSet_}getIndexEndValue(){return Ie(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Ie(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:il}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Ie(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===kr}copy(){const e=new fE;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function QI(n){const e={};if(n.isDefault())return e;let t;if(n.index_===kr?t="$priority":n.index_===AQ?t="$value":n.index_===Hc?t="$key":(Ie(n.index_ instanceof CQ,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=mr(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=mr(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+mr(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=mr(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+mr(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function ZI(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==kr&&(e.i=n.index_.toString()),e}class nv extends kO{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Ie(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=$d("p:rest:"),this.listens_={}}listen(e,t,r,i){const a=e._path.toString();this.log_("Listen called for "+a+" "+e._queryIdentifier);const s=nv.getListenId_(e,r),u={};this.listens_[s]=u;const c=QI(e._queryParams);this.restRequest_(a+".json",c,(h,d)=>{let p=d;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(a,p,!1,r),$c(this.listens_,s)===u){let g;h?h===401?g="permission_denied":g="rest_error:"+h:g="ok",i(g,null)}})}unlisten(e,t){const r=nv.getListenId_(e,t);delete this.listens_[r]}get(e){const t=QI(e._queryParams),r=e._path.toString(),i=new Ew;return this.restRequest_(r+".json",t,(a,s)=>{let u=s;a===404&&(u=null,a=null),a===null?(this.onDataUpdate_(r,u,!1,null),i.resolve(u)):i.reject(new Error(u))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,a])=>{i&&i.accessToken&&(t.auth=i.accessToken),a&&a.token&&(t.ac=a.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Hq(t);this.log_("Sending REST request for "+s);const u=new XMLHttpRequest;u.onreadystatechange=()=>{if(r&&u.readyState===4){this.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);let c=null;if(u.status>=200&&u.status<300){try{c=dd(u.responseText)}catch{_i("Failed to parse JSON response for "+s+": "+u.responseText)}r(null,c)}else u.status!==401&&u.status!==404&&_i("Got unsuccessful REST response for "+s+" Status: "+u.status),r(u.status);r=null}},u.open("GET",s,!0),u.send()})}}class kQ{constructor(){this.rootNode_=Ot.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function rv(){return{value:null,children:new Map}}function GO(n,e,t){if(Et(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=Ct(e);n.children.has(r)||n.children.set(r,rv());const i=n.children.get(r);e=Zt(e),GO(i,e,t)}}function R1(n,e,t){n.value!==null?t(e,n.value):MQ(n,(r,i)=>{const a=new en(e.toString()+"/"+r);R1(i,a,t)})}function MQ(n,e){n.children.forEach((t,r)=>{e(r,t)})}class OQ{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&zi(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}}const JI=10*1e3,PQ=30*1e3,FQ=300*1e3;class VQ{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new OQ(e);const r=JI+(PQ-JI)*Math.random();Zf(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;zi(e,(i,a)=>{a>0&&Ws(this.statsToReport_,i)&&(t[i]=a,r=!0)}),r&&this.server_.reportStats(t),Zf(this.reportStats_.bind(this),Math.floor(Math.random()*2*FQ))}}var za;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(za||(za={}));function WO(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function qO(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function KO(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class iv{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=za.ACK_USER_WRITE,this.source=WO()}operationForChild(e){if(Et(this.path)){if(this.affectedTree.value!=null)return Ie(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new en(e));return new iv(Gt(),t,this.revert)}}else return Ie(Ct(this.path)===e,"operationForChild called for unrelated child."),new iv(Zt(this.path),this.affectedTree,this.revert)}}class al{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=za.OVERWRITE}operationForChild(e){return Et(this.path)?new al(this.source,Gt(),this.snap.getImmediateChild(e)):new al(this.source,Zt(this.path),this.snap)}}class Sd{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=za.MERGE}operationForChild(e){if(Et(this.path)){const t=this.children.subtree(new en(e));return t.isEmpty()?null:t.value?new al(this.source,Gt(),t.value):new Sd(this.source,Gt(),t)}else return Ie(Ct(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Sd(this.source,Zt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class dE{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Et(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ct(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function LQ(n,e,t,r){const i=[],a=[];return e.forEach(s=>{s.type==="child_changed"&&n.index_.indexedValueChanged(s.oldSnap,s.snapshotNode)&&a.push(DQ(s.childName,s.snapshotNode))}),Of(n,i,"child_removed",e,r,t),Of(n,i,"child_added",e,r,t),Of(n,i,"child_moved",a,r,t),Of(n,i,"child_changed",e,r,t),Of(n,i,"value",e,r,t),i}function Of(n,e,t,r,i,a){const s=r.filter(u=>u.type===t);s.sort((u,c)=>jQ(n,u,c)),s.forEach(u=>{const c=BQ(n,u,a);i.forEach(h=>{h.respondsTo(u.type)&&e.push(h.createEvent(c,n.query_))})})}function BQ(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function jQ(n,e,t){if(e.childName==null||t.childName==null)throw hh("Should only compare child_ events.");const r=new St(e.childName,e.snapshotNode),i=new St(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function XO(n,e){return{eventCache:n,serverCache:e}}function Jf(n,e,t,r){return XO(new dE(e,t,r),n.serverCache)}function YO(n,e,t,r){return XO(n.eventCache,new dE(e,t,r))}function I1(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function sl(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let rb;const UQ=()=>(rb||(rb=new Jr(A$)),rb);class Qt{static fromObject(e){let t=new Qt(null);return zi(e,(r,i)=>{t=t.set(new en(r),i)}),t}constructor(e,t=UQ()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Gt(),value:this.value};if(Et(e))return null;{const r=Ct(e),i=this.children.get(r);if(i!==null){const a=i.findRootMostMatchingPathAndValue(Zt(e),t);return a!=null?{path:nr(new en(r),a.path),value:a.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Et(e))return this;{const t=Ct(e),r=this.children.get(t);return r!==null?r.subtree(Zt(e)):new Qt(null)}}set(e,t){if(Et(e))return new Qt(t,this.children);{const r=Ct(e),a=(this.children.get(r)||new Qt(null)).set(Zt(e),t),s=this.children.insert(r,a);return new Qt(this.value,s)}}remove(e){if(Et(e))return this.children.isEmpty()?new Qt(null):new Qt(null,this.children);{const t=Ct(e),r=this.children.get(t);if(r){const i=r.remove(Zt(e));let a;return i.isEmpty()?a=this.children.remove(t):a=this.children.insert(t,i),this.value===null&&a.isEmpty()?new Qt(null):new Qt(this.value,a)}else return this}}get(e){if(Et(e))return this.value;{const t=Ct(e),r=this.children.get(t);return r?r.get(Zt(e)):null}}setTree(e,t){if(Et(e))return t;{const r=Ct(e),a=(this.children.get(r)||new Qt(null)).setTree(Zt(e),t);let s;return a.isEmpty()?s=this.children.remove(r):s=this.children.insert(r,a),new Qt(this.value,s)}}fold(e){return this.fold_(Gt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((i,a)=>{r[i]=a.fold_(nr(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Gt(),t)}findOnPath_(e,t,r){const i=this.value?r(t,this.value):!1;if(i)return i;if(Et(e))return null;{const a=Ct(e),s=this.children.get(a);return s?s.findOnPath_(Zt(e),nr(t,a),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Gt(),t)}foreachOnPath_(e,t,r){if(Et(e))return this;{this.value&&r(t,this.value);const i=Ct(e),a=this.children.get(i);return a?a.foreachOnPath_(Zt(e),nr(t,i),r):new Qt(null)}}foreach(e){this.foreach_(Gt(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(nr(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class ua{constructor(e){this.writeTree_=e}static empty(){return new ua(new Qt(null))}}function ed(n,e,t){if(Et(e))return new ua(new Qt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let a=r.value;const s=Bi(i,e);return a=a.updateChild(s,t),new ua(n.writeTree_.set(i,a))}else{const i=new Qt(t),a=n.writeTree_.setTree(e,i);return new ua(a)}}}function eN(n,e,t){let r=n;return zi(t,(i,a)=>{r=ed(r,nr(e,i),a)}),r}function tN(n,e){if(Et(e))return ua.empty();{const t=n.writeTree_.setTree(e,new Qt(null));return new ua(t)}}function N1(n,e){return pl(n,e)!=null}function pl(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Bi(t.path,e)):null}function nN(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(kr,(r,i)=>{e.push(new St(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new St(r,i.value))}),e}function jo(n,e){if(Et(e))return n;{const t=pl(n,e);return t!=null?new ua(new Qt(t)):new ua(n.writeTree_.subtree(e))}}function D1(n){return n.writeTree_.isEmpty()}function ah(n,e){return $O(Gt(),n.writeTree_,e)}function $O(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,a)=>{i===".priority"?(Ie(a.value!==null,"Priority writes must always be leaf nodes"),r=a.value):t=$O(nr(n,i),a,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(nr(n,".priority"),r)),t}}function QO(n,e){return nP(e,n)}function zQ(n,e,t,r,i){Ie(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=ed(n.visibleWrites,e,t)),n.lastWriteId=r}function HQ(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function GQ(n,e){const t=n.allWrites.findIndex(u=>u.writeId===e);Ie(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,a=!1,s=n.allWrites.length-1;for(;i&&s>=0;){const u=n.allWrites[s];u.visible&&(s>=t&&WQ(u,r.path)?i=!1:sa(r.path,u.path)&&(a=!0)),s--}if(i){if(a)return qQ(n),!0;if(r.snap)n.visibleWrites=tN(n.visibleWrites,r.path);else{const u=r.children;zi(u,c=>{n.visibleWrites=tN(n.visibleWrites,nr(r.path,c))})}return!0}else return!1}function WQ(n,e){if(n.snap)return sa(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&sa(nr(n.path,t),e))return!0;return!1}function qQ(n){n.visibleWrites=ZO(n.allWrites,KQ,Gt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function KQ(n){return n.visible}function ZO(n,e,t){let r=ua.empty();for(let i=0;i<n.length;++i){const a=n[i];if(e(a)){const s=a.path;let u;if(a.snap)sa(t,s)?(u=Bi(t,s),r=ed(r,u,a.snap)):sa(s,t)&&(u=Bi(s,t),r=ed(r,Gt(),a.snap.getChild(u)));else if(a.children){if(sa(t,s))u=Bi(t,s),r=eN(r,u,a.children);else if(sa(s,t))if(u=Bi(s,t),Et(u))r=eN(r,Gt(),a.children);else{const c=$c(a.children,Ct(u));if(c){const h=c.getChild(Zt(u));r=ed(r,Gt(),h)}}}else throw hh("WriteRecord should have .snap or .children")}}return r}function JO(n,e,t,r,i){if(!r&&!i){const a=pl(n.visibleWrites,e);if(a!=null)return a;{const s=jo(n.visibleWrites,e);if(D1(s))return t;if(t==null&&!N1(s,Gt()))return null;{const u=t||Ot.EMPTY_NODE;return ah(s,u)}}}else{const a=jo(n.visibleWrites,e);if(!i&&D1(a))return t;if(!i&&t==null&&!N1(a,Gt()))return null;{const s=function(h){return(h.visible||i)&&(!r||!~r.indexOf(h.writeId))&&(sa(h.path,e)||sa(e,h.path))},u=ZO(n.allWrites,s,e),c=t||Ot.EMPTY_NODE;return ah(u,c)}}}function XQ(n,e,t){let r=Ot.EMPTY_NODE;const i=pl(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(kr,(a,s)=>{r=r.updateImmediateChild(a,s)}),r;if(t){const a=jo(n.visibleWrites,e);return t.forEachChild(kr,(s,u)=>{const c=ah(jo(a,new en(s)),u);r=r.updateImmediateChild(s,c)}),nN(a).forEach(s=>{r=r.updateImmediateChild(s.name,s.node)}),r}else{const a=jo(n.visibleWrites,e);return nN(a).forEach(s=>{r=r.updateImmediateChild(s.name,s.node)}),r}}function YQ(n,e,t,r,i){Ie(r||i,"Either existingEventSnap or existingServerSnap must exist");const a=nr(e,t);if(N1(n.visibleWrites,a))return null;{const s=jo(n.visibleWrites,a);return D1(s)?i.getChild(t):ah(s,i.getChild(t))}}function $Q(n,e,t,r){const i=nr(e,t),a=pl(n.visibleWrites,i);if(a!=null)return a;if(r.isCompleteForChild(t)){const s=jo(n.visibleWrites,i);return ah(s,r.getNode().getImmediateChild(t))}else return null}function QQ(n,e){return pl(n.visibleWrites,e)}function ZQ(n,e,t,r,i,a,s){let u;const c=jo(n.visibleWrites,e),h=pl(c,Gt());if(h!=null)u=h;else if(t!=null)u=ah(c,t);else return[];if(u=u.withIndex(s),!u.isEmpty()&&!u.isLeafNode()){const d=[],p=s.getCompare(),g=a?u.getReverseIteratorFrom(r,s):u.getIteratorFrom(r,s);let v=g.getNext();for(;v&&d.length<i;)p(v,r)!==0&&d.push(v),v=g.getNext();return d}else return[]}function JQ(){return{visibleWrites:ua.empty(),allWrites:[],lastWriteId:-1}}function k1(n,e,t,r){return JO(n.writeTree,n.treePath,e,t,r)}function eP(n,e){return XQ(n.writeTree,n.treePath,e)}function rN(n,e,t,r){return YQ(n.writeTree,n.treePath,e,t,r)}function av(n,e){return QQ(n.writeTree,nr(n.treePath,e))}function eZ(n,e,t,r,i,a){return ZQ(n.writeTree,n.treePath,e,t,r,i,a)}function pE(n,e,t){return $Q(n.writeTree,n.treePath,e,t)}function tP(n,e){return nP(nr(n.treePath,e),n.writeTree)}function nP(n,e){return{treePath:n,writeTree:e}}class tZ{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;Ie(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Ie(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const a=i.type;if(t==="child_added"&&a==="child_removed")this.changeMap.set(r,$I(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&a==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&a==="child_changed")this.changeMap.set(r,NQ(r,i.oldSnap));else if(t==="child_changed"&&a==="child_added")this.changeMap.set(r,IQ(r,e.snapshotNode));else if(t==="child_changed"&&a==="child_changed")this.changeMap.set(r,$I(r,e.snapshotNode,i.oldSnap));else throw hh("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class nZ{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const rP=new nZ;class mE{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new dE(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return pE(this.writes_,e,r)}}getChildAfterChild(e,t,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:sl(this.viewCache_),a=eZ(this.writes_,i,t,1,r,e);return a.length===0?null:a[0]}}function rZ(n,e){Ie(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Ie(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function iZ(n,e,t,r,i){const a=new tZ;let s,u;if(t.type===za.OVERWRITE){const h=t;h.source.fromUser?s=M1(n,e,h.path,h.snap,r,i,a):(Ie(h.source.fromServer,"Unknown source."),u=h.source.tagged||e.serverCache.isFiltered()&&!Et(h.path),s=sv(n,e,h.path,h.snap,r,i,u,a))}else if(t.type===za.MERGE){const h=t;h.source.fromUser?s=sZ(n,e,h.path,h.children,r,i,a):(Ie(h.source.fromServer,"Unknown source."),u=h.source.tagged||e.serverCache.isFiltered(),s=O1(n,e,h.path,h.children,r,i,u,a))}else if(t.type===za.ACK_USER_WRITE){const h=t;h.revert?s=lZ(n,e,h.path,r,i,a):s=oZ(n,e,h.path,h.affectedTree,r,i,a)}else if(t.type===za.LISTEN_COMPLETE)s=uZ(n,e,t.path,r,a);else throw hh("Unknown operation type: "+t.type);const c=a.getChanges();return aZ(e,s,c),{viewCache:s,changes:c}}function aZ(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=I1(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&t.push(RQ(I1(e)))}}function iP(n,e,t,r,i,a){const s=e.eventCache;if(av(r,t)!=null)return e;{let u,c;if(Et(t))if(Ie(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=sl(e),d=h instanceof Ot?h:Ot.EMPTY_NODE,p=eP(r,d);u=n.filter.updateFullNode(e.eventCache.getNode(),p,a)}else{const h=k1(r,sl(e));u=n.filter.updateFullNode(e.eventCache.getNode(),h,a)}else{const h=Ct(t);if(h===".priority"){Ie(Qo(t)===1,"Can't have a priority with additional path components");const d=s.getNode();c=e.serverCache.getNode();const p=rN(r,t,d,c);p!=null?u=n.filter.updatePriority(d,p):u=s.getNode()}else{const d=Zt(t);let p;if(s.isCompleteForChild(h)){c=e.serverCache.getNode();const g=rN(r,t,s.getNode(),c);g!=null?p=s.getNode().getImmediateChild(h).updateChild(d,g):p=s.getNode().getImmediateChild(h)}else p=pE(r,h,e.serverCache);p!=null?u=n.filter.updateChild(s.getNode(),h,p,d,i,a):u=s.getNode()}}return Jf(e,u,s.isFullyInitialized()||Et(t),n.filter.filtersNodes())}}function sv(n,e,t,r,i,a,s,u){const c=e.serverCache;let h;const d=s?n.filter:n.filter.getIndexedFilter();if(Et(t))h=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){const v=c.getNode().updateChild(t,r);h=d.updateFullNode(c.getNode(),v,null)}else{const v=Ct(t);if(!c.isCompleteForPath(t)&&Qo(t)>1)return e;const b=Zt(t),w=c.getNode().getImmediateChild(v).updateChild(b,r);v===".priority"?h=d.updatePriority(c.getNode(),w):h=d.updateChild(c.getNode(),v,w,b,rP,null)}const p=YO(e,h,c.isFullyInitialized()||Et(t),d.filtersNodes()),g=new mE(i,p,a);return iP(n,p,t,i,g,u)}function M1(n,e,t,r,i,a,s){const u=e.eventCache;let c,h;const d=new mE(i,e,a);if(Et(t))h=n.filter.updateFullNode(e.eventCache.getNode(),r,s),c=Jf(e,h,!0,n.filter.filtersNodes());else{const p=Ct(t);if(p===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),r),c=Jf(e,h,u.isFullyInitialized(),u.isFiltered());else{const g=Zt(t),v=u.getNode().getImmediateChild(p);let b;if(Et(g))b=r;else{const E=d.getCompleteChild(p);E!=null?OO(g)===".priority"&&E.getChild(FO(g)).isEmpty()?b=E:b=E.updateChild(g,r):b=Ot.EMPTY_NODE}if(v.equals(b))c=e;else{const E=n.filter.updateChild(u.getNode(),p,b,g,d,s);c=Jf(e,E,u.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function iN(n,e){return n.eventCache.isCompleteForChild(e)}function sZ(n,e,t,r,i,a,s){let u=e;return r.foreach((c,h)=>{const d=nr(t,c);iN(e,Ct(d))&&(u=M1(n,u,d,h,i,a,s))}),r.foreach((c,h)=>{const d=nr(t,c);iN(e,Ct(d))||(u=M1(n,u,d,h,i,a,s))}),u}function aN(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function O1(n,e,t,r,i,a,s,u){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;Et(t)?h=r:h=new Qt(null).setTree(t,r);const d=e.serverCache.getNode();return h.children.inorderTraversal((p,g)=>{if(d.hasChild(p)){const v=e.serverCache.getNode().getImmediateChild(p),b=aN(n,v,g);c=sv(n,c,new en(p),b,i,a,s,u)}}),h.children.inorderTraversal((p,g)=>{const v=!e.serverCache.isCompleteForChild(p)&&g.value===null;if(!d.hasChild(p)&&!v){const b=e.serverCache.getNode().getImmediateChild(p),E=aN(n,b,g);c=sv(n,c,new en(p),E,i,a,s,u)}}),c}function oZ(n,e,t,r,i,a,s){if(av(i,t)!=null)return e;const u=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(Et(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return sv(n,e,t,c.getNode().getChild(t),i,a,u,s);if(Et(t)){let h=new Qt(null);return c.getNode().forEachChild(Hc,(d,p)=>{h=h.set(new en(d),p)}),O1(n,e,t,h,i,a,u,s)}else return e}else{let h=new Qt(null);return r.foreach((d,p)=>{const g=nr(t,d);c.isCompleteForPath(g)&&(h=h.set(d,c.getNode().getChild(g)))}),O1(n,e,t,h,i,a,u,s)}}function uZ(n,e,t,r,i){const a=e.serverCache,s=YO(e,a.getNode(),a.isFullyInitialized()||Et(t),a.isFiltered());return iP(n,s,t,r,rP,i)}function lZ(n,e,t,r,i,a){let s;if(av(r,t)!=null)return e;{const u=new mE(r,e,i),c=e.eventCache.getNode();let h;if(Et(t)||Ct(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=k1(r,sl(e));else{const p=e.serverCache.getNode();Ie(p instanceof Ot,"serverChildren would be complete if leaf node"),d=eP(r,p)}d=d,h=n.filter.updateFullNode(c,d,a)}else{const d=Ct(t);let p=pE(r,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?h=n.filter.updateChild(c,d,p,Zt(t),u,a):e.eventCache.getNode().hasChild(d)?h=n.filter.updateChild(c,d,Ot.EMPTY_NODE,Zt(t),u,a):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(s=k1(r,sl(e)),s.isLeafNode()&&(h=n.filter.updateFullNode(h,s,a)))}return s=e.serverCache.isFullyInitialized()||av(r,Gt())!=null,Jf(e,h,s,n.filter.filtersNodes())}}function cZ(n,e){const t=sl(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Et(e)&&!t.getImmediateChild(Ct(e)).isEmpty())?t.getChild(e):null}function sN(n,e,t,r){e.type===za.MERGE&&e.source.queryId!==null&&(Ie(sl(n.viewCache_),"We should always have a full cache before handling merges"),Ie(I1(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,a=iZ(n.processor_,i,e,t,r);return rZ(n.processor_,a.viewCache),Ie(a.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=a.viewCache,hZ(n,a.changes,a.viewCache.eventCache.getNode())}function hZ(n,e,t,r){const i=n.eventRegistrations_;return LQ(n.eventGenerator_,e,t,i)}let oN;function fZ(n){Ie(!oN,"__referenceConstructor has already been defined"),oN=n}function gE(n,e,t,r){const i=e.source.queryId;if(i!==null){const a=n.views.get(i);return Ie(a!=null,"SyncTree gave us an op for an invalid query."),sN(a,e,t,r)}else{let a=[];for(const s of n.views.values())a=a.concat(sN(s,e,t,r));return a}}function vE(n,e){let t=null;for(const r of n.views.values())t=t||cZ(r,e);return t}let uN;function dZ(n){Ie(!uN,"__referenceConstructor has already been defined"),uN=n}class lN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Qt(null),this.pendingWriteTree_=JQ(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function pZ(n,e,t,r,i){return zQ(n.pendingWriteTree_,e,t,r,i),i?Qv(n,new al(WO(),e,t)):[]}function Ac(n,e,t=!1){const r=HQ(n.pendingWriteTree_,e);if(GQ(n.pendingWriteTree_,e)){let a=new Qt(null);return r.snap!=null?a=a.set(Gt(),!0):zi(r.children,s=>{a=a.set(new en(s),!0)}),Qv(n,new iv(r.path,a,t))}else return[]}function $v(n,e,t){return Qv(n,new al(qO(),e,t))}function mZ(n,e,t){const r=Qt.fromObject(t);return Qv(n,new Sd(qO(),e,r))}function gZ(n,e,t,r){const i=uP(n,r);if(i!=null){const a=lP(i),s=a.path,u=a.queryId,c=Bi(s,e),h=new al(KO(u),c,t);return cP(n,s,h)}else return[]}function vZ(n,e,t,r){const i=uP(n,r);if(i){const a=lP(i),s=a.path,u=a.queryId,c=Bi(s,e),h=Qt.fromObject(t),d=new Sd(KO(u),c,h);return cP(n,s,d)}else return[]}function aP(n,e,t){const i=n.pendingWriteTree_,a=n.syncPointTree_.findOnPath(e,(s,u)=>{const c=Bi(s,e),h=vE(u,c);if(h)return h});return JO(i,e,a,t,!0)}function Qv(n,e){return sP(e,n.syncPointTree_,null,QO(n.pendingWriteTree_,Gt()))}function sP(n,e,t,r){if(Et(n.path))return oP(n,e,t,r);{const i=e.get(Gt());t==null&&i!=null&&(t=vE(i,Gt()));let a=[];const s=Ct(n.path),u=n.operationForChild(s),c=e.children.get(s);if(c&&u){const h=t?t.getImmediateChild(s):null,d=tP(r,s);a=a.concat(sP(u,c,h,d))}return i&&(a=a.concat(gE(i,n,r,t))),a}}function oP(n,e,t,r){const i=e.get(Gt());t==null&&i!=null&&(t=vE(i,Gt()));let a=[];return e.children.inorderTraversal((s,u)=>{const c=t?t.getImmediateChild(s):null,h=tP(r,s),d=n.operationForChild(s);d&&(a=a.concat(oP(d,u,c,h)))}),i&&(a=a.concat(gE(i,n,r,t))),a}function uP(n,e){return n.tagToQueryMap.get(e)}function lP(n){const e=n.indexOf("$");return Ie(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new en(n.substr(0,e))}}function cP(n,e,t){const r=n.syncPointTree_.get(e);Ie(r,"Missing sync point for query tag that we're tracking");const i=QO(n.pendingWriteTree_,e);return gE(r,t,i,null)}class yE{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new yE(t)}node(){return this.node_}}class _E{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=nr(this.path_,e);return new _E(this.syncTree_,t)}node(){return aP(this.syncTree_,this.path_)}}const yZ=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},cN=function(n,e,t){if(!n||typeof n!="object")return n;if(Ie(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return _Z(n[".sv"],e,t);if(typeof n[".sv"]=="object")return bZ(n[".sv"],e);Ie(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},_Z=function(n,e,t){if(n==="timestamp")return t.timestamp;Ie(!1,"Unexpected server value: "+n)},bZ=function(n,e,t){n.hasOwnProperty("increment")||Ie(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&Ie(!1,"Unexpected increment value: "+r);const i=e.node();if(Ie(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return typeof s!="number"?r:s+r},xZ=function(n,e,t,r){return bE(e,new _E(t,n),r)},wZ=function(n,e,t){return bE(n,new yE(e),t)};function bE(n,e,t){const r=n.getPriority().val(),i=cN(r,e.getImmediateChild(".priority"),t);let a;if(n.isLeafNode()){const s=n,u=cN(s.getValue(),e,t);return u!==s.getValue()||i!==s.getPriority().val()?new Jn(u,Ar(i)):n}else{const s=n;return a=s,i!==s.getPriority().val()&&(a=a.updatePriority(new Jn(i))),s.forEachChild(kr,(u,c)=>{const h=bE(c,e.getImmediateChild(u),t);h!==c&&(a=a.updateImmediateChild(u,h))}),a}}class xE{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function wE(n,e){let t=e instanceof en?e:new en(e),r=n,i=Ct(t);for(;i!==null;){const a=$c(r.node.children,i)||{children:{},childCount:0};r=new xE(i,r,a),t=Zt(t),i=Ct(t)}return r}function xh(n){return n.node.value}function hP(n,e){n.node.value=e,P1(n)}function fP(n){return n.node.childCount>0}function EZ(n){return xh(n)===void 0&&!fP(n)}function Zv(n,e){zi(n.node.children,(t,r)=>{e(new xE(t,n,r))})}function dP(n,e,t,r){t&&e(n),Zv(n,i=>{dP(i,e,!0)})}function TZ(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Jd(n){return new en(n.parent===null?n.name:Jd(n.parent)+"/"+n.name)}function P1(n){n.parent!==null&&CZ(n.parent,n.name,n)}function CZ(n,e,t){const r=EZ(t),i=Ws(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,P1(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,P1(n))}const SZ=/[\[\].#$\/\u0000-\u001F\u007F]/,AZ=/[\[\].#$\u0000-\u001F\u007F]/,ib=10*1024*1024,pP=function(n){return typeof n=="string"&&n.length!==0&&!SZ.test(n)},RZ=function(n){return typeof n=="string"&&n.length!==0&&!AZ.test(n)},IZ=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),RZ(n)},mP=function(n,e,t){const r=t instanceof en?new uQ(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ju(r));if(typeof e=="function")throw new Error(n+"contains a function "+ju(r)+" with contents = "+e.toString());if(dO(e))throw new Error(n+"contains "+e.toString()+" "+ju(r));if(typeof e=="string"&&e.length>ib/3&&Rv(e)>ib)throw new Error(n+"contains a string greater than "+ib+" utf8 bytes "+ju(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,a=!1;if(zi(e,(s,u)=>{if(s===".value")i=!0;else if(s!==".priority"&&s!==".sv"&&(a=!0,!pP(s)))throw new Error(n+" contains an invalid key ("+s+") "+ju(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);lQ(r,s),mP(n,u,r),cQ(r)}),i&&a)throw new Error(n+' contains ".value" child '+ju(r)+" in addition to actual children.")}},NZ=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!pP(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!IZ(t))throw new Error(Wq(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class DZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function kZ(n,e){let t=null;for(let r=0;r<e.length;r++){const i=e[r],a=i.getPath();t!==null&&!VO(a,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:a}),t.events.push(i)}t&&n.eventLists_.push(t)}function ml(n,e,t){kZ(n,t),MZ(n,r=>sa(r,e)||sa(e,r))}function MZ(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const i=n.eventLists_[r];if(i){const a=i.path;e(a)?(OZ(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function OZ(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Qf&&Sr("event: "+t.toString()),Qd(r)}}}const PZ="repo_interrupt",FZ=25;class VZ{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new DZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=rv(),this.transactionQueueTree_=new xE,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function LZ(n,e,t){if(n.stats_=uE(n.repoInfo_),n.forceRestClient_||M$())n.server_=new nv(n.repoInfo_,(r,i,a,s)=>{hN(n,r,i,a,s)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>fN(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{mr(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Ds(n.repoInfo_,e,(r,i,a,s)=>{hN(n,r,i,a,s)},r=>{fN(n,r)},r=>{jZ(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=L$(n.repoInfo_,()=>new VQ(n.stats_,n.server_)),n.infoData_=new kQ,n.infoSyncTree_=new lN({startListening:(r,i,a,s)=>{let u=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(u=$v(n.infoSyncTree_,r._path,c),setTimeout(()=>{s("ok")},0)),u},stopListening:()=>{}}),EE(n,"connected",!1),n.serverSyncTree_=new lN({startListening:(r,i,a,s)=>(n.server_.listen(r,a,i,(u,c)=>{const h=s(u,c);ml(n.eventQueue_,r._path,h)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function BZ(n){const t=n.infoData_.getNode(new en(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function gP(n){return yZ({timestamp:BZ(n)})}function hN(n,e,t,r,i){n.dataUpdateCount++;const a=new en(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let s=[];if(i)if(r){const c=jg(t,h=>Ar(h));s=vZ(n.serverSyncTree_,a,c,i)}else{const c=Ar(t);s=gZ(n.serverSyncTree_,a,c,i)}else if(r){const c=jg(t,h=>Ar(h));s=mZ(n.serverSyncTree_,a,c)}else{const c=Ar(t);s=$v(n.serverSyncTree_,a,c)}let u=a;s.length>0&&(u=CE(n,a)),ml(n.eventQueue_,u,s)}function fN(n,e){EE(n,"connected",e),e===!1&&zZ(n)}function jZ(n,e){zi(e,(t,r)=>{EE(n,t,r)})}function EE(n,e,t){const r=new en("/.info/"+e),i=Ar(t);n.infoData_.updateSnapshot(r,i);const a=$v(n.infoSyncTree_,r,i);ml(n.eventQueue_,r,a)}function UZ(n){return n.nextWriteId_++}function zZ(n){vP(n,"onDisconnectEvents");const e=gP(n),t=rv();R1(n.onDisconnect_,Gt(),(i,a)=>{const s=xZ(i,a,n.serverSyncTree_,e);GO(t,i,s)});let r=[];R1(t,Gt(),(i,a)=>{r=r.concat($v(n.serverSyncTree_,i,a));const s=qZ(n,i);CE(n,s)}),n.onDisconnect_=rv(),ml(n.eventQueue_,Gt(),r)}function HZ(n){n.persistentConnection_&&n.persistentConnection_.interrupt(PZ)}function vP(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Sr(t,...e)}function yP(n,e,t){return aP(n.serverSyncTree_,e,t)||Ot.EMPTY_NODE}function TE(n,e=n.transactionQueueTree_){if(e||Jv(n,e),xh(e)){const t=bP(n,e);Ie(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&GZ(n,Jd(e),t)}else fP(e)&&Zv(e,t=>{TE(n,t)})}function GZ(n,e,t){const r=t.map(h=>h.currentWriteId),i=yP(n,e,r);let a=i;const s=i.hash();for(let h=0;h<t.length;h++){const d=t[h];Ie(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const p=Bi(e,d.path);a=a.updateChild(p,d.currentOutputSnapshotRaw)}const u=a.val(!0),c=e;n.server_.put(c.toString(),u,h=>{vP(n,"transaction put response",{path:c.toString(),status:h});let d=[];if(h==="ok"){const p=[];for(let g=0;g<t.length;g++)t[g].status=2,d=d.concat(Ac(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&p.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Jv(n,wE(n.transactionQueueTree_,e)),TE(n,n.transactionQueueTree_),ml(n.eventQueue_,e,d);for(let g=0;g<p.length;g++)Qd(p[g])}else{if(h==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{_i("transaction at "+c.toString()+" failed: "+h);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=h}CE(n,e)}},s)}function CE(n,e){const t=_P(n,e),r=Jd(t),i=bP(n,t);return WZ(n,i,r),r}function WZ(n,e,t){if(e.length===0)return;const r=[];let i=[];const s=e.filter(u=>u.status===0).map(u=>u.currentWriteId);for(let u=0;u<e.length;u++){const c=e[u],h=Bi(t,c.path);let d=!1,p;if(Ie(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,i=i.concat(Ac(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=FZ)d=!0,p="maxretry",i=i.concat(Ac(n.serverSyncTree_,c.currentWriteId,!0));else{const g=yP(n,c.path,s);c.currentInputSnapshot=g;const v=e[u].update(g.val());if(v!==void 0){mP("transaction failed: Data returned ",v,c.path);let b=Ar(v);typeof v=="object"&&v!=null&&Ws(v,".priority")||(b=b.updatePriority(g.getPriority()));const w=c.currentWriteId,C=gP(n),S=wZ(b,g,C);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=S,c.currentWriteId=UZ(n),s.splice(s.indexOf(w),1),i=i.concat(pZ(n.serverSyncTree_,c.path,S,c.currentWriteId,c.applyLocally)),i=i.concat(Ac(n.serverSyncTree_,w,!0))}else d=!0,p="nodata",i=i.concat(Ac(n.serverSyncTree_,c.currentWriteId,!0))}ml(n.eventQueue_,t,i),i=[],d&&(e[u].status=2,(function(g){setTimeout(g,Math.floor(0))})(e[u].unwatcher),e[u].onComplete&&(p==="nodata"?r.push(()=>e[u].onComplete(null,!1,e[u].currentInputSnapshot)):r.push(()=>e[u].onComplete(new Error(p),!1,null))))}Jv(n,n.transactionQueueTree_);for(let u=0;u<r.length;u++)Qd(r[u]);TE(n,n.transactionQueueTree_)}function _P(n,e){let t,r=n.transactionQueueTree_;for(t=Ct(e);t!==null&&xh(r)===void 0;)r=wE(r,t),e=Zt(e),t=Ct(e);return r}function bP(n,e){const t=[];return xP(n,e,t),t.sort((r,i)=>r.order-i.order),t}function xP(n,e,t){const r=xh(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Zv(e,i=>{xP(n,i,t)})}function Jv(n,e){const t=xh(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,hP(e,t.length>0?t:void 0)}Zv(e,r=>{Jv(n,r)})}function qZ(n,e){const t=Jd(_P(n,e)),r=wE(n.transactionQueueTree_,e);return TZ(r,i=>{ab(n,i)}),ab(n,r),dP(r,i=>{ab(n,i)}),t}function ab(n,e){const t=xh(e);if(t){const r=[];let i=[],a=-1;for(let s=0;s<t.length;s++)t[s].status===3||(t[s].status===1?(Ie(a===s-1,"All SENT items should be at beginning of queue."),a=s,t[s].status=3,t[s].abortReason="set"):(Ie(t[s].status===0,"Unexpected transaction status in abort"),t[s].unwatcher(),i=i.concat(Ac(n.serverSyncTree_,t[s].currentWriteId,!0)),t[s].onComplete&&r.push(t[s].onComplete.bind(null,new Error("set"),!1,null))));a===-1?hP(e,void 0):t.length=a+1,ml(n.eventQueue_,Jd(e),i);for(let s=0;s<r.length;s++)Qd(r[s])}}function KZ(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function XZ(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):_i(`Invalid query segment '${t}' in query '${n}'`)}return e}const dN=function(n,e){const t=YZ(n),r=t.namespace;t.domain==="firebase.com"&&Ls(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Ls("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||C$();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new CO(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new en(t.pathString)}},YZ=function(n){let e="",t="",r="",i="",a="",s=!0,u="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(u=n.substring(0,h-1),n=n.substring(h+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(i=KZ(n.substring(d,p)));const g=XZ(n.substring(Math.min(n.length,p)));h=e.indexOf(":"),h>=0?(s=u==="https"||u==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const v=e.slice(0,h);if(v.toLowerCase()==="localhost")t="localhost";else if(v.split(".").length<=2)t=v;else{const b=e.indexOf(".");r=e.substring(0,b).toLowerCase(),t=e.substring(b+1),a=r}"ns"in g&&(a=g.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:s,scheme:u,pathString:i,namespace:a}};class SE{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return Et(this._path)?null:OO(this._path)}get ref(){return new wh(this._repo,this._path)}get _queryIdentifier(){const e=ZI(this._queryParams),t=sE(e);return t==="{}"?"default":t}get _queryObject(){return ZI(this._queryParams)}isEqual(e){if(e=la(e),!(e instanceof SE))return!1;const t=this._repo===e._repo,r=VO(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+oQ(this._path)}}class wh extends SE{constructor(e,t){super(e,t,new fE,!1)}get parent(){const e=FO(this._path);return e===null?null:new wh(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}fZ(wh);dZ(wh);const $Z="FIREBASE_DATABASE_EMULATOR_HOST",F1={};let QZ=!1;function ZZ(n,e,t,r){const i=e.lastIndexOf(":"),a=e.substring(0,i),s=zd(a);n.repoInfo_=new CO(e,s,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function JZ(n,e,t,r,i){let a=r||n.options.databaseURL;a===void 0&&(n.options.projectId||Ls("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Sr("Using default host for project ",n.options.projectId),a=`${n.options.projectId}-default-rtdb.firebaseio.com`);let s=dN(a,i),u=s.repoInfo,c;typeof process<"u"&&MI&&(c=MI[$Z]),c?(a=`http://${c}?ns=${u.namespace}`,s=dN(a,i),u=s.repoInfo):s.repoInfo.secure;const h=new P$(n.name,n.options,e);NZ("Invalid Firebase Database URL",s),Et(s.path)||Ls("Database URL must point to the root of a Firebase Database (not including a child path).");const d=tJ(u,n,h,new O$(n,t));return new nJ(d,n)}function eJ(n,e){const t=F1[e];(!t||t[n.key]!==n)&&Ls(`Database ${e}(${n.repoInfo_}) has already been deleted.`),HZ(n),delete t[n.key]}function tJ(n,e,t,r){let i=F1[e.name];i||(i={},F1[e.name]=i);let a=i[n.toURLString()];return a&&Ls("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new VZ(n,QZ,t,r),i[n.toURLString()]=a,a}class nJ{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(LZ(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new wh(this._repo,Gt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(eJ(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ls("Cannot call "+e+" on a deleted database.")}}function rJ(n=D3(),e){const t=A3(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=g3("database");r&&iJ(t,...r)}return t}function iJ(n,e,t,r={}){n=la(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,a=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&pd(r,a.repoInfo_.emulatorOptions))return;Ls("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let s;if(a.repoInfo_.nodeAdmin)r.mockUserToken&&Ls('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new ug(ug.OWNER);else if(r.mockUserToken){const u=typeof r.mockUserToken=="string"?r.mockUserToken:_3(r.mockUserToken,n.app.options.projectId);s=new ug(u)}zd(e)&&(y3(e),b3("Database",!0)),ZZ(a,i,r,s)}function aJ(n){_$(I3),md(new Qc("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return JZ(r,i,a,t)},"PUBLIC").setMultipleInstances(!0)),Po(OI,PI,n),Po(OI,PI,"esm2020")}Ds.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ds.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};aJ();const Ad=Cc.apiKey&&Cc.apiKey!=="YOUR_API_KEY"&&Cc.projectId&&Cc.projectId!=="YOUR_PROJECT_ID";let sb,wt,sJ;if(Ad)try{sb=N3(Cc),wt=a$(sb),sJ=rJ(sb),console.log(" Firebase initialized successfully")}catch(n){console.warn(" Firebase initialization failed:",n.message)}else console.warn(" Firebase not configured - using default configuration");const V1=async(n,e,t)=>{if(console.log(" recordHeatmapClick called:",{x:n,y:e,page:t,hasDB:!!wt,isConfigured:Ad}),!Ad||!wt){console.warn(" Firebase not configured - skipping heatmap recording");return}try{const r=await _h(Br(wt,"heatmap_clicks"),{x:n,y:e,category:t,timestamp:lO()});console.log(" Heatmap click recorded:",{id:r.id,x:n,y:e,page:t})}catch(r){console.error(" Error recording heatmap:",r)}},wP=async n=>{if(console.log(" saveSession called:",{hasDB:!!wt,isConfigured:Ad,data:n}),!Ad||!wt){console.warn(" Firebase not configured - skipping session save");return}try{const e=await _h(Br(wt,"face_scan_sessions"),{...n,timestamp:lO(),faceDetected:!0});console.log(" Session saved successfully:",e.id)}catch(e){console.error(" Error saving session:",e)}},oJ=Cc.projectId!=="YOUR_PROJECT_ID",AE=async(n,e=null)=>{if(!oJ||!wt)return e;try{return await n()}catch(t){return t.code==="permission-denied"||t.message?.includes("permissions")?console.warn(" Firebase operation skipped (insufficient permissions)"):console.error("Firebase operation error:",t),e}},uJ=async(n,e,t="unknown")=>AE(async()=>{const r=Br(wt,"heatmap");await _h(r,{x:n,y:e,page:t,timestamp:new Date}),console.log(` Logged heatmap click at (${n}, ${e})`)}),ov=async(n,e,t={})=>AE(async()=>{await _h(Br(wt,"conversion_funnel"),{step:n,sessionId:e,timestamp:new Date,...t}),console.log(` Logged conversion step: ${n}`)}),lJ=async(n,e,t)=>AE(async()=>{await _h(Br(wt,"page_transitions"),{sessionId:n,from:e,to:t,timestamp:new Date}),console.log(` Logged page transition: ${e}  ${t}`)});class cJ{constructor(){this.isEnabled=cc.enabled,this.currentLanguage=cc.defaultLanguage,this.isSpeaking=!1,this.initialized=!1,this.userInteracted=!1}init(){return typeof responsiveVoice>"u"?(console.warn(" ResponsiveVoice not loaded"),this.isEnabled=!1,!1):(responsiveVoice.clickEvent=!1,responsiveVoice.enableEstimationTimeout=!1,responsiveVoice.enableWindowClickHook=!1,responsiveVoice.isPlaying()&&responsiveVoice.cancel(),this.initialized=!0,console.log(" VoiceService ready (silent mode - waiting for user interaction)"),this.setupInteractionListener(),!0)}setupInteractionListener(){const e=()=>{this.userInteracted||(this.userInteracted=!0,typeof responsiveVoice<"u"&&(typeof responsiveVoice.init=="function"&&responsiveVoice.init(),responsiveVoice.speak(" ","Thai Female",{volume:0,onend:()=>{console.log(" Audio context unlocked - Voice feedback NOW enabled")}})),console.log(" ResponsiveVoice initialized after user interaction"),document.removeEventListener("click",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e))};document.addEventListener("click",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("keydown",e,{once:!0})}detectLanguage(e){return/[\u0E00-\u0E7F]/.test(e)?"th":/[\u4E00-\u9FFF]/.test(e)?"zh":"en"}getVoiceSettings(e){switch(e){case"th":return cc.thai;case"en":return cc.english;case"zh":return cc.chinese;default:return cc.thai}}async speakInChunks(e,t=null){const i=[];if(console.log(`  ${e.length}  - `),/[\u0E00-\u0E7F]/.test(e)){const a=e.split(/([,;.!?]\s*|\s+)/);let s="";for(const u of a)(s+u).length>100&&s.trim()?(i.push(s.trim()),console.log(`   : "${s.substring(0,40)}..." (${s.length} )`),s=u):s+=u;s.trim()&&(i.push(s.trim()),console.log(`   : "${s.substring(0,40)}..." (${s.length} )`))}else{const a=e.match(/[^.!?]+[.!?]+/g)||[e];let s="";for(const u of a)(s+u).length>100&&s?(i.push(s.trim()),console.log(`   Chunk: "${s.substring(0,40)}..."`),s=u):s+=u;s.trim()&&(i.push(s.trim()),console.log(`   Chunk: "${s.substring(0,40)}..."`))}console.log(`  ${i.length} `);for(let a=0;a<i.length;a++){console.log(`  ${a+1}/${i.length}`),typeof window<"u"&&window.resetIdleTimer&&window.resetIdleTimer();try{await this.speakSingle(i[a],t),console.log(`  ${a+1} `)}catch(s){console.error(` Error  ${a+1}:`,s)}a<i.length-1&&(console.log("  500ms ..."),await new Promise(s=>setTimeout(s,500)))}console.log(`  ${i.length} `)}speakSingle(e,t=null){return new Promise((r,i)=>{const a=t||this.detectLanguage(e),s=this.getVoiceSettings(a);console.log(`   Speaking: "${e.substring(0,50)}..."`);try{responsiveVoice.speak(e,s.voice,{pitch:s.pitch,rate:s.rate,volume:s.volume,onstart:()=>{console.log("   ")},onend:()=>{console.log("   "),r()},onerror:u=>{console.error("   Speech error:",u),r()}})}catch(u){console.error("   ResponsiveVoice error:",u),r()}setTimeout(()=>{console.warn("   Speech timeout for chunk"),r()},15e3)})}speak(e,t=null){if(!this.isEnabled||!this.initialized||!e||typeof e!="string"||e.trim()===""||!this.userInteracted)return Promise.resolve();console.log("  ()"),this.stop(),typeof window<"u"&&window.resetIdleTimer&&(window.resetIdleTimer(),console.log(" Reset idle timer"));const r=100;return console.log(` : "${e.substring(0,60)}..." (${e.length} )`),e.length>r?(console.log(`  (>${r}) - `),this.speakInChunks(e,t)):new Promise(i=>{const a=t||this.detectLanguage(e),s=this.getVoiceSettings(a);this.stop(),console.log(`Speaking in ${a}:`,e),console.log("Voice settings:",s),this.isSpeaking=!0;try{responsiveVoice.speak(e,s.voice,{pitch:s.pitch,rate:s.rate,volume:s.volume,onstart:()=>{console.log(" :",e.substring(0,50)+"...")},onend:()=>{this.isSpeaking=!1,console.log(" "),i()},onerror:u=>{console.warn(" Speech error:",u),this.isSpeaking=!1,i()}})}catch(u){console.warn(" Speech exception:",u),this.isSpeaking=!1,i()}})}stop(){this.isSpeaking&&typeof responsiveVoice<"u"&&(responsiveVoice.cancel(),this.isSpeaking=!1)}pause(){typeof responsiveVoice<"u"&&responsiveVoice.pause()}resume(){typeof responsiveVoice<"u"&&responsiveVoice.resume()}getVoices(){return typeof responsiveVoice<"u"?responsiveVoice.getVoices():[]}isSpeakingNow(){return this.isSpeaking}setLanguage(e){["th","en","zh"].includes(e)&&(this.currentLanguage=e)}getLanguage(){return this.currentLanguage}}const Ju=new cJ;typeof window<"u"&&window.addEventListener("load",()=>{setTimeout(()=>{Ju.init()},1e3)});const EP=(n,e=null)=>Ju.speak(n,e),pN=()=>{Ju.stop()},ob={Au:{th:" (Au) -     3        ",en:"Automotive Technology (Au) - Thailand's automotive industry ranks among the world's top producers, with projected output of 3 million vehicles annually. Graduates can work as mechanics, vehicle inspectors, or own auto repair businesses, or continue to automotive or mechanical engineering degrees.",zh:" (Au) - 300"},Ev:{th:" (Ev) -        ",en:"Electric Vehicle Technology (Ev) - Vehicle technology is constantly evolving. Thailand's automotive industry ranks among the world's top. Graduates can work as EV mechanics, service center supervisors, or continue to automotive or mechanical engineering degrees.",zh:" (Ev) - "},Ep:{th:" (Ep) -          ",en:"Electrical Power (Ep) - Electrical engineering is fundamental to modern life. Graduates can work as electrical installers, air conditioning and refrigeration technicians, or continue to electrical engineering, education, or industrial degrees.",zh:" (Ep) - "},El:{th:" (El) -             ",en:"Electronics (El) - Study video systems, audio systems, communications, industrial control systems, and robotics. Graduates can work at airports, aviation companies, telecommunications, or continue to communications, electronics and telecommunications, or multimedia engineering degrees.",zh:" (El) - "},Co:{th:" (Co) -       Draft man    ",en:"Construction (Co) - Learn construction techniques and innovations. Graduates can work as construction supervisors, contractors, civil technicians, draftsmen, or in construction materials business, or continue to civil engineering or industrial education degrees.",zh:" (Co) - "},Ar:{th:" (Ar) -               ",en:"Architecture (Ar) - Study design, construction drawing, cost estimation, model making, and structural calculations. Graduates can work as industrial product designers, decorators, interior designers, furniture designers, graphic designers, architects, or continue to architecture degrees.",zh:" (Ar) - "},Ct:{th:" (Ct) -     C, Java, Python       IoT ",en:"Computer Programming (Ct) - Think, code, and innovate. Learn programming with C, Java, Python, web development, mobile apps, system analysis and design, database management, and IoT programming. Programming skills are essential in the technology era.",zh:" (Ct) - CJavaPythonWeb"},It:{th:" (It) -  .         IT    ",en:"Information Technology (It) - Diploma level only. Study computer maintenance, software and hardware. Graduates can work in IT organizations, software companies, network services, internet, e-commerce, IT consulting, animation and gaming, or continue to database, network, or security studies.",zh:" (It) - ITIT"},Ac:{th:" (Ac) -            ",en:"Accounting (Ac) - Businesses need financial data. Lanna Polytechnic College develops curricula to produce efficient accounting professionals. Graduates can work as accountants, accounting consultants, auditors, cost analysts, financial officers, or bank employees.",zh:" (Ac) - "},Mk:{th:" (Mk) -  E-Commerce             ",en:"Marketing (Mk) - In the era of technology and E-Commerce, high competition creates demand for marketing professionals. Graduates can work as market researchers, analysts, brand builders, marketers, strategists, sales managers, in retail, wholesale, or import-export businesses.",zh:" (Mk) - "},Dt:{th:" (Dt) -          ",en:"Digital Business (Dt) - Computer technology plays a role in daily life. Business operations relate to information systems. Graduates can work as computer officers, data analysts, system developers and designers, programmers, IT managers, or webmasters.",zh:" (Dt) - IT"},Tg:{th:" (Tg) -          ",en:"Tourism (Tg) - Blends science and art. Students gain knowledge in various fields. As ASEAN integrates, Thailand becomes the hub for transportation and tourism. Graduates can work as tour guides, tourism business managers, attraction site managers, or recreation business managers.",zh:" (Tg) - "},Hm:{th:" (Hm) -       ",en:"Hotel Management (Hm) - Blends science and art. Students learn communication skills to entertain guests. As ASEAN integrates, Thailand becomes a tourism business hub. Graduates can work in hotel management, tourism business management, or attraction site management.",zh:" (Hm) - "}},hJ=({onDetected:n})=>{const e=re.useRef(null),t=re.useRef(null),[r,i]=re.useState(!0),[a,s]=re.useState(!1),[u,c]=re.useState(null),[h,d]=re.useState(0),[p,g]=re.useState(""),[v,b]=re.useState(0),[E,w]=re.useState(!0),[C,S]=re.useState(!1),[I,D]=re.useState(0),[O,B]=re.useState(null),[N,R]=re.useState(null),[k,P]=re.useState(!1),[V,j]=re.useState(!1),[L,Z]=re.useState(null),[ne,q]=re.useState(!1),[X,ee]=re.useState(0),ue=re.useRef(null);re.useRef(null);const fe=re.useRef(null);re.useEffect(()=>(C&&(console.log(" Consent accepted, starting setup chain..."),Ju.init(),console.log(" Using Web Camera"),$().then(()=>(console.log(" Video started successfully"),W())).then(()=>{console.log(" Models loaded successfully, ready to detect face"),alert(" AI Models ! ..."),setTimeout(()=>{console.log(" Auto-starting face detection..."),ve()},1500)}).catch(_e=>{console.error(" Error in setup chain:",_e)})),()=>{e.current&&e.current.srcObject&&e.current.srcObject.getTracks().forEach(_e=>_e.stop()),ue.current&&clearInterval(ue.current),fe.current&&clearInterval(fe.current)}),[C]);const W=async()=>{try{console.log(" Starting to load Face-API models...");const _e="/models";console.log(" Loading tinyFaceDetector from:",_e),await Lr.tinyFaceDetector.loadFromUri(_e),console.log(" tinyFaceDetector loaded"),console.log(" Loading ageGenderNet from:",_e),await Lr.ageGenderNet.loadFromUri(_e),console.log(" ageGenderNet loaded"),console.log(" Loading faceExpressionNet from:",_e),await Lr.faceExpressionNet.loadFromUri(_e),console.log(" faceExpressionNet loaded"),console.log(" Models loaded successfully"),i(!1)}catch(_e){console.error(" Error loading models:",_e),console.error("Error details:",_e.message),alert(`  AI models 
 model  /public/models/

Error: ${_e.message}`),i(!1)}},$=async()=>{try{console.log(" Requesting camera access...");const _e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});if(console.log(" Camera opened successfully"),e.current){e.current.srcObject=_e,console.log(" Camera started, waiting for video to be ready...");try{await e.current.play(),console.log(" Video play() started")}catch(De){console.warn(" Video play error (might autoplay):",De.message)}return new Promise((De,Re)=>{const qe=setInterval(()=>{e.current&&e.current.readyState>=e.current.HAVE_CURRENT_DATA&&(console.log(" Video is ready to use, readyState:",e.current.readyState),clearInterval(qe),De())},100);setTimeout(()=>{clearInterval(qe),e.current&&e.current.readyState>0?(console.log(" Video stream available (readyState="+e.current.readyState+")"),De()):Re(new Error("Video did not become ready in time"))},1e4)})}}catch(_e){throw console.error(" Error accessing camera:",_e),console.error("Camera error code:",_e.name),alert(` :
${_e.message}`),_e}},ce=()=>{c(null),s(!1),d(0),g(""),D(0),b(0),B(null),t.current&&t.current.getContext("2d").clearRect(0,0,t.current.width,t.current.height)},ve=async()=>{if(a){console.warn(" detectFace already in progress");return}if(!e.current){console.warn(" detectFace: videoRef not ready");return}if(e.current.readyState<e.current.HAVE_CURRENT_DATA){console.warn(" Video not ready, readyState:",e.current.readyState),g(" ..."),setTimeout(()=>ve(),500);return}if(!e.current.videoWidth||!e.current.videoHeight){console.warn(" Video dimensions not available"),setTimeout(()=>ve(),500);return}s(!0),d(0),g("");try{console.log(" Starting face detection..."),console.log(" Video dimensions:",e.current.videoWidth,"x",e.current.videoHeight),g(" ..."),d(20);const _e=await mq(e.current,new i3({inputSize:416,scoreThreshold:.3})).withAgeAndGender().withFaceExpressions();if(!_e){if(console.log(" No face detected, retrying..."),g("  ..."),s(!1),b(Ye=>Ye+1),v>10){console.warn(" Max attempts reached, stopping auto-scan"),g('   "Start Scan" '),alert('   "Start Scan" ');return}setTimeout(()=>{ve()},1e3);return}console.log(" Face detected:",_e),Ju.speak(" ");const De=e.current,Re=document.createElement("canvas");Re.width=200,Re.height=200,Re.getContext("2d").drawImage(De,0,0,200,200);const et=Re.toDataURL("image/jpeg",.8);B(et),g(" ..."),d(60),await new Promise(Ye=>setTimeout(Ye,1e3));const Ze=Math.round(_e.age),Xe=_e.gender,st=_e.expressions;console.log(" Detected:",{age:Ze,gender:Xe,expressions:st}),g(" "),d(90),await new Promise(Ye=>setTimeout(Ye,500));const Qe=Te(Ze,Xe,st);console.log(" Interests:",Qe);const ot=Object.keys(st).reduce((Ye,Rt)=>st[Ye]>st[Rt]?Ye:Rt);R(ot),d(100),g(" "),Ju.speak(""),await new Promise(Ye=>setTimeout(Ye,400));const Xn={age:Ze,gender:Xe,expressions:st,interests:Qe,emotion:ot,source:"web_camera",timestamp:new Date().toISOString()},xn=sessionStorage.getItem("sessionId")||`web_${Date.now()}`;if(sessionStorage.setItem("sessionId",xn),await wP({sessionId:xn,type:"face_scan_web",age:Ze,gender:Xe,emotion:ot,demographics:{age:Ze,gender:Xe,emotion:ot},interests:Qe,device:"web_camera"}),await ov("scanned",xn,{age:Ze,gender:Xe,emotion:ot,source:"web_camera"}),c(Xn),_e&&_e.detection&&_e.detection.box){const Ye=_e.detection.box,Rt=e.current,wn=(Ye.x+Ye.width/2)/(Rt.videoWidth||1),jr=(Ye.y+Ye.height/2)/(Rt.videoHeight||1),yr=Math.min(100,Math.max(0,wn*100)),tn=Math.min(100,Math.max(0,jr*100));V1(yr,tn,"face-scan")}else V1(50,50,"face-scan");Ze<13?(P(!0),D(0)):(setTimeout(()=>D(1),1e3),setTimeout(()=>D(2),3e3),setTimeout(()=>D(3),5500),setTimeout(()=>{D(4),n&&(console.log(" Sending detected interests to parent:",Qe),n(Qe))},8e3))}catch(_e){console.error(" Error detecting face:",_e),g(" ")}s(!1)},Te=(_e,De,Re)=>{const qe=[];switch(_e<=16?qe.push("co","it","dt"):_e<=18?qe.push("ev","it","mk"):_e<=20?qe.push("ac","mk","au"):qe.push("au","ep","ac"),De==="male"?qe.push("au","ev","ep","el","co","ct","it"):qe.push("ac","mk","dt","hm","tg","it","co"),Object.keys(Re).reduce((Qe,ot)=>Re[Qe]>Re[ot]?Qe:ot)){case"happy":qe.push("hm","tg","mk","dt");break;case"neutral":qe.push("ep","el","ac","au","co");break;case"surprised":qe.push("it","dt","co","ev","ar");break;case"sad":qe.push("ar","ct","el","ep");break;default:qe.push("co","au","ac","mk")}const Ze={};qe.forEach(Qe=>{Ze[Qe]=(Ze[Qe]||0)+1});const Xe=Object.entries(Ze).sort((Qe,ot)=>ot[1]-Qe[1]).slice(0,3).map(([Qe])=>Qe),st=["au","ev","ep","el","co","ar","ct","it","ac","mk","dt","tg","hm"];for(;Xe.length<3;){const Qe=st[Math.floor(Math.random()*st.length)];Xe.includes(Qe)||Xe.push(Qe)}return Xe},Se=_e=>{switch(Object.keys(_e).reduce((Re,qe)=>_e[Re]>_e[qe]?Re:qe)){case"happy":return"  ";case"neutral":return"  ";case"surprised":return"  ";default:return"  "}};return T.jsxs("div",{className:"face-detection-container",children:[E&&!C&&T.jsxs(Pe.div,{className:"consent-card",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:[T.jsxs("div",{className:"consent-header",children:[T.jsx("div",{className:"consent-icon",children:""}),T.jsx("h2",{className:"consent-title",children:"Privacy & Data Protection"}),T.jsx("p",{className:"consent-subtitle",children:"PDPA Compliance Notice"})]}),T.jsxs("div",{className:"consent-body",children:[T.jsx("p",{className:"consent-text",children:T.jsx("strong",{children:"We will use the following data:"})}),T.jsxs("ul",{className:"consent-list",children:[T.jsx("li",{className:"consent-item",children:"Facial scan for age and gender detection"}),T.jsx("li",{className:"consent-item",children:"Facial expression analysis"}),T.jsx("li",{className:"consent-item",children:"Temporary video recording during scan"})]}),T.jsx("p",{className:"consent-text",children:T.jsx("strong",{children:"We do NOT:"})}),T.jsxs("ul",{className:"consent-list",children:[T.jsx("li",{className:"consent-item",children:"Store your personal data"}),T.jsx("li",{className:"consent-item",children:"Use microphone or record audio"}),T.jsx("li",{className:"consent-item",children:"Share information with third parties"})]}),T.jsx("p",{className:"consent-text",children:"By accepting, you consent to temporary facial analysis for career recommendations."})]}),T.jsxs("div",{className:"consent-actions",children:[T.jsx("button",{className:"btn btn-decline",onClick:()=>{w(!1),n&&n({skipScan:!0,goToInfo:!0})},children:"Decline"}),T.jsx("button",{className:"btn btn-accept",onClick:()=>{console.log(" User accepted consent, starting video and models..."),alert("   AI models..."),S(!0),w(!1)},children:"Accept & Proceed"})]})]}),k&&u&&u.age<13&&T.jsx(Pe.div,{className:"parental-consent-modal",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:T.jsxs("div",{className:"parental-consent-card",children:[T.jsxs("div",{className:"parental-header",children:[T.jsx("div",{className:"parental-icon",children:""}),T.jsx("h2",{className:"parental-title",children:"Parent/Guardian Permission Required"}),T.jsx("p",{className:"parental-subtitle",children:"This feature requires parental consent"})]}),T.jsxs("div",{className:"parental-body",children:[T.jsxs("div",{className:"child-info",children:[T.jsx("h3",{children:"Detected Information:"}),T.jsxs("p",{children:[T.jsx("strong",{children:"Age:"})," ",u.age," years old"]}),T.jsxs("p",{children:[T.jsx("strong",{children:"Gender:"})," ",u.gender==="male"?"Male":"Female"]}),T.jsxs("p",{children:[T.jsx("strong",{children:"Mood:"})," ",Se(u.expressions)]})]}),T.jsxs("div",{className:"parental-notice",children:[T.jsx("p",{children:T.jsx("strong",{children:" What We Will Do:"})}),T.jsxs("ul",{children:[T.jsx("li",{children:"Show age-appropriate career recommendations"}),T.jsx("li",{children:"Track engagement with interactive content"}),T.jsx("li",{children:"Display gamified learning interface"})]})]}),T.jsxs("div",{className:"parental-privacy",children:[T.jsx("p",{children:T.jsx("strong",{children:" Privacy Assurance:"})}),T.jsxs("ul",{children:[T.jsx("li",{children:"No personal data is permanently stored"}),T.jsx("li",{children:"Face image deleted after analysis"}),T.jsx("li",{children:"No external data sharing"}),T.jsx("li",{children:"PDPA compliant"})]})]}),T.jsxs("label",{className:"parental-checkbox",children:[T.jsx("input",{type:"checkbox",onChange:_e=>{_e.target.checked&&j(!0)}}),T.jsx("span",{children:"I am the parent/guardian and I consent to this experience"})]})]}),T.jsxs("div",{className:"parental-actions",children:[T.jsx("button",{className:"btn btn-decline",onClick:()=>{P(!1),ce(),n&&n({skipScan:!0,goToInfo:!0})},children:"Not Now"}),T.jsx("button",{className:"btn btn-accept",disabled:!V,onClick:()=>{P(!1),setTimeout(()=>D(1),500),setTimeout(()=>D(2),2e3),setTimeout(()=>D(3),4e3),setTimeout(()=>{D(4),n&&n(u.interests)},6e3)},children:"I Agree & Continue"})]})]})}),C&&!u&&!k&&T.jsxs("div",{className:"scanning-view",children:[T.jsxs("div",{className:"scan-header",children:[T.jsx("h2",{className:"scan-title",children:"Face Detection"}),T.jsx("p",{className:"scan-subtitle",children:"Look at the camera for personalized recommendations"})]}),T.jsxs("div",{className:"video-scanner",children:[T.jsxs("div",{className:"scanner-frame",children:[T.jsx("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0,className:"scanner-video"}),yq.usePiCamera,T.jsx("div",{className:"scan-circle",children:a&&T.jsxs(T.Fragment,{children:[T.jsx("div",{className:"scan-line"}),T.jsxs("div",{className:"scan-corners",children:[T.jsx("div",{className:"corner corner-tl"}),T.jsx("div",{className:"corner corner-tr"}),T.jsx("div",{className:"corner corner-bl"}),T.jsx("div",{className:"corner corner-br"})]}),T.jsx("div",{className:"scan-grid"}),T.jsx("div",{className:"scan-particles",children:[...Array(20)].map((_e,De)=>T.jsx("div",{className:"particle",style:{"--delay":`${De*.1}s`,"--angle":`${De*18}deg`}},De))})]})})]}),T.jsx("p",{className:"scan-status",children:a?p||"Analyzing...":r?"Loading AI Models...":"Ready to Scan"}),!a&&!r&&T.jsx("button",{className:"btn-scan-manual",onClick:ve,children:" Start Scan"})]}),T.jsx("canvas",{ref:t,style:{display:"none"}})]}),u&&T.jsxs(Pe.div,{className:"detection-result",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[T.jsx("div",{className:"result-hero",children:T.jsxs("h2",{className:"hero-title",children:["FIND YOUR PATH.",T.jsx("br",{}),T.jsx("span",{className:"hero-highlight",children:"UNLOCK & FUTURE."})]})}),T.jsxs("div",{className:"recommendation-card",children:[T.jsx("div",{className:"card-header",children:"PERSONALIZED RECOMMENDATION"}),T.jsx("div",{className:"card-body",children:T.jsxs("div",{className:"profile-section",children:[T.jsx("div",{className:"profile-avatar",children:T.jsx("div",{className:"avatar-circle",children:O?T.jsx("img",{src:O,alt:"Scanned face",className:"avatar-image"}):T.jsx("span",{className:"avatar-placeholder",children:""})})}),T.jsxs("div",{className:"profile-info",children:[I>=1&&T.jsxs(Pe.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[T.jsx("span",{className:"info-label",children:"Age:"}),T.jsx("span",{className:"info-value",children:u.age})]}),I>=2&&T.jsxs(Pe.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:[T.jsx("span",{className:"info-label",children:"Gender:"}),T.jsx("span",{className:"info-value",children:u.gender==="male"?"Male":"Female"})]}),I>=3&&T.jsxs(Pe.div,{className:"info-row",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:[T.jsx("span",{className:"info-label",children:"Mood:"}),T.jsx("span",{className:"info-value",children:Se(u.expressions)})]}),I>=4&&T.jsxs(Pe.div,{className:"interests-section",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[T.jsx("p",{className:"interests-title",children:"Based on your profile, you might interested in:"}),T.jsx("ul",{className:"interests-list",children:u.interests.map((_e,De)=>{const Re=Lg.find(qe=>qe.id===_e);return T.jsx(Pe.li,{className:"interest-item",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:De*.1},children:Re?.name},_e)})})]})]})]})})]}),I>=4&&T.jsxs(Pe.div,{className:"reset-actions",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[T.jsx("button",{className:"btn-reset",onClick:ce,children:"Not Interested, Explore All"}),T.jsx("button",{className:"btn-next",onClick:()=>{n&&n(u.interests)},children:"Show Me!"})]}),I>=4&&T.jsxs(Pe.div,{className:"result-footer",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:[T.jsx("div",{className:"footer-note",children:"AI-Powered Career Recommendations"}),T.jsx("div",{className:"footer-icon",children:""})]})]})]})};class fJ{constructor(){this.apiKey=vq,this.endpoint="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent",this.conversationHistory=[],this.systemContext=this.buildSystemContext()}buildSystemContext(){const e=Lg.map(i=>`- ${i.name} (${i.code}): ${i.description}`).join(`
`),r=(Fa||{}).contact||{phone:"053-277-777",email:"lannapoly@edu.th",website:"www.lannapoly.ac.th"};return` ""   
  

**:**
- ****
- ** 1-2  ( 30 )**
- **  **
-  
-  

 (14 ):
${e}

:
-  . : 12,100 /
-  . : 21,700 /
- / 

:
- : ${r.phone}
- : ${r.email}
- : ${r.website}`}async ask(e){try{this.conversationHistory.push({role:"user",parts:[{text:e}]});const t=this.conversationHistory.length===1?`${this.systemContext}

: ${e}`:e,r=await fetch(`${this.endpoint}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:t}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:150}})});if(!r.ok)throw new Error(`Gemini API error: ${r.status}`);const a=(await r.json()).candidates?.[0]?.content?.parts?.[0]?.text||"  ? ";return this.conversationHistory.push({role:"model",parts:[{text:a}]}),a}catch(t){return console.error("Gemini API Error:",t),this.getFallbackResponse(e)}}getFallbackResponse(e){const t=e.toLowerCase();if(t.includes("")||t.includes(""))return" 14    ";if(t.includes("")||t.includes(""))return" . 12,100 /, . 21,700 / ()  ";if(t.includes("")){const r=Fa?.contact||{phone:"053-277-777",website:"www.lannapoly.ac.th"};return` ${r.website}  ${r.phone}  `}if(t.includes("")||t.includes("")){const r=Fa?.contact||{phone:"053-277-777",email:"lannapoly@edu.th"};return`  ${r.phone}  ${r.email}  `}return"? "}getGreeting(){const e=["! ? ","! ? ","! ? "];return e[Math.floor(Math.random()*e.length)]}resetConversation(){this.conversationHistory=[]}}const RE=new fJ,dJ=n=>RE.ask(n),pJ=()=>RE.resetConversation(),mJ=()=>RE.getGreeting();function gJ({onClose:n,interests:e=[]}){const[t,r]=re.useState([]),[i,a]=re.useState(""),[s,u]=re.useState(!1),[c,h]=re.useState(!1),[d,p]=re.useState("idle"),[g,v]=re.useState(!1),[b,E]=re.useState(!1),[w,C]=re.useState(!1),S=re.useRef(null),I=re.useRef(null),D=re.useRef(null),O=()=>{S.current?.scrollIntoView({behavior:"smooth"})};re.useEffect(()=>{O()},[t]),re.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const L=window.SpeechRecognition||window.webkitSpeechRecognition,Z=new L;Z.continuous=!1,Z.interimResults=!1,Z.lang="th-TH",Z.onresult=ne=>{const q=ne.results[0][0].transcript;a(q),C(!1)},Z.onerror=ne=>{console.error("Speech recognition error:",ne.error),C(!1)},Z.onend=()=>{C(!1)},D.current=Z}},[]),re.useEffect(()=>{["idle","talk","bye"].forEach(Z=>{const ne=document.createElement("video");ne.src=`/VDO/${Z}.mp4`,ne.preload="auto"})},[]),re.useEffect(()=>(I.current&&I.current.play(),b||setTimeout(()=>{const L=mJ();B("talk",L),r([{role:"assistant",content:L}]),E(!0)},500),()=>{pN(),pJ()}),[]);const B=(L,Z)=>{const ne=I.current;ne&&(ne.style.transition="opacity 0.2s ease",ne.style.opacity="0.5",setTimeout(()=>{p(L),h(!0),ne.loop=!0,ne.play().then(()=>{ne.style.opacity="1"})},200)),EP(Z,"th")},N=()=>{d==="idle"||c?I.current&&I.current.play():p("idle")},R=async()=>{if(!i.trim())return;const L=i.trim();a(""),r(Z=>[...Z,{role:"user",content:L}]),u(!0),p("idle");try{const Z=await dJ(L);r(ne=>[...ne,{role:"assistant",content:Z}]),B("talk",Z)}catch(Z){console.error("Error asking Gemini:",Z);const ne="   ";r(q=>[...q,{role:"assistant",content:ne}]),B("talk",ne)}finally{u(!1)}},k=(L,Z="talk")=>{a(L),setTimeout(()=>R(),100)},P=()=>{if(!D.current){alert("  Google Chrome");return}if(w)D.current.stop(),C(!1);else try{D.current.start(),C(!0),p("idle")}catch(L){console.error("Error starting recognition:",L),C(!1)}},V=()=>{p("bye"),B("bye","  !"),setTimeout(()=>{pN(),n()},3e3)},j=[{text:" ?",video:"talk"},{text:" ?",video:"talk"},{text:" ?",video:"talk"},{text:" ?",video:"talk"}];return T.jsx(Rc,{children:T.jsx(Pe.div,{className:"avatar-video-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:V,children:T.jsxs(Pe.div,{className:"avatar-video-container",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onClick:L=>L.stopPropagation(),children:[T.jsxs("div",{className:"video-avatar-section",children:[T.jsx("video",{ref:I,className:"avatar-video",src:`/VDO/${d}.mp4`,loop:d==="idle",autoPlay:!0,muted:!1,playsInline:!0,onEnded:N,onError:L=>{console.error("Video error:",L),d!=="idle"&&p("idle")}}),T.jsxs("div",{className:"avatar-status",children:[w&&T.jsx(Pe.div,{className:"status-badge listening",initial:{scale:0},animate:{scale:1},children:" ..."}),c&&T.jsx(Pe.div,{className:"status-badge speaking",initial:{scale:0},animate:{scale:1},children:" ..."}),s&&T.jsx(Pe.div,{className:"status-badge thinking",initial:{scale:0},animate:{scale:1},children:" ..."})]}),T.jsx("div",{className:"video-info",children:T.jsxs("p",{className:"video-state",children:[": ",d]})})]}),T.jsxs("div",{className:"chat-section",children:[T.jsxs("div",{className:"chat-header",children:[T.jsxs("div",{className:"header-info",children:[T.jsx("h3",{children:" "}),T.jsx("p",{className:"header-subtitle",children:""})]}),T.jsx("button",{className:"close-btn",onClick:V,children:""})]}),T.jsxs("div",{className:"messages-container",children:[t.map((L,Z)=>T.jsxs(Pe.div,{className:`message ${L.role}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:Z*.1},children:[T.jsx("div",{className:"message-avatar",children:L.role==="assistant"?"":""}),T.jsx("div",{className:"message-content",children:L.content})]},Z)),s&&T.jsxs(Pe.div,{className:"message assistant thinking",initial:{opacity:0},animate:{opacity:1},children:[T.jsx("div",{className:"message-avatar",children:""}),T.jsx("div",{className:"message-content",children:T.jsxs("div",{className:"typing-indicator",children:[T.jsx("span",{}),T.jsx("span",{}),T.jsx("span",{})]})})]}),T.jsx("div",{ref:S})]}),t.length<=2&&T.jsxs("div",{className:"quick-questions",children:[T.jsx("p",{className:"quick-label",children:":"}),T.jsx("div",{className:"quick-buttons",children:j.map((L,Z)=>T.jsx("button",{className:"quick-btn",onClick:()=>k(L.text,L.video),disabled:s,children:L.text},Z))})]}),T.jsxs("div",{className:"chat-input",children:[T.jsx("button",{onClick:P,className:`voice-btn ${w?"listening":""}`,disabled:s,title:"",children:w?"":""}),T.jsx("input",{type:"text",value:i,onChange:L=>a(L.target.value),onKeyPress:L=>L.key==="Enter"&&R(),placeholder:w?"...":"...",disabled:s}),T.jsx("button",{onClick:R,disabled:!i.trim()||s,className:"send-btn",children:s?"":""})]})]})]})})})}const vJ=({suggestedInterests:n=[],onAvatarClick:e})=>{const[t,r]=re.useState(null),[i,a]=re.useState("all"),[s,u]=re.useState(!1);re.useEffect(()=>{wP({suggestedInterests:n,timestamp:new Date().toISOString()})},[n]);const c=(d,p)=>{r(d);const g=p.currentTarget.getBoundingClientRect(),v=(p.clientX-g.left)/g.width*100,b=(p.clientY-g.top)/g.height*100;setTimeout(()=>{const C=document.querySelector(".detail-modal");C&&C.scrollIntoView({behavior:"smooth",block:"center"})},100),V1(v,b,`career-${d.id}`);const E=sessionStorage.getItem("sessionId");ov("clicked",E,{careerClicked:d.id,careerName:d.name});const w=ob[d.code];w&&EP(w.th,"th")},h=i==="all"?Lg:Lg.filter(d=>n.includes(d.id));return T.jsxs("div",{className:"career-cards-container",children:[T.jsxs("div",{className:"cards-header",children:[T.jsx(Pe.h2,{className:"section-title",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:" "}),T.jsxs("div",{className:"filter-buttons",children:[T.jsx("button",{className:`filter-btn ${i==="all"?"active":""}`,onClick:()=>a("all"),children:""}),T.jsx("button",{className:`filter-btn ${i==="suggested"?"active":""}`,onClick:()=>a("suggested"),disabled:n.length===0,children:" "})]}),T.jsx("button",{className:"avatar-btn",onClick:e,children:" "})]}),T.jsx("div",{className:"cards-grid",children:h.map(d=>{const p=n.includes(d.id);return T.jsxs("div",{className:`career-card ${p?"suggested":""}`,onClick:g=>c(d,g),style:{borderColor:p?d.color:"transparent",color:d.color},children:[T.jsx("div",{className:"card-category",children:d.category}),T.jsx("div",{className:"card-code",style:{color:d.color},children:d.code}),T.jsx("div",{className:"card-icon",children:d.icon}),T.jsx("div",{className:"card-name",children:d.name}),T.jsx("div",{className:"card-description",children:d.description}),p&&T.jsx("div",{className:"suggested-badge",style:{background:d.gradient},children:" "})]},d.id)})}),t&&T.jsx(Pe.div,{className:"detail-overlay",initial:{opacity:0},animate:{opacity:1},onClick:()=>r(null),children:T.jsxs(Pe.div,{className:"detail-modal",initial:{scale:.8,y:50},animate:{scale:1,y:0},onClick:d=>d.stopPropagation(),children:[T.jsx("button",{className:"close-btn",onClick:()=>r(null),children:""}),T.jsxs("div",{className:"modal-header",style:{borderColor:t.color},children:[T.jsx("div",{className:"modal-icon",style:{color:t.color},children:yJ(t.id)}),T.jsx("h2",{style:{color:t.color},children:t.name})]}),T.jsxs("div",{className:"modal-content",children:[T.jsxs("section",{className:"modal-section",children:[T.jsx("h3",{children:" "}),T.jsx("p",{children:t.description})]}),T.jsxs("section",{className:"modal-section",children:[T.jsx("h3",{children:" "}),ob[t.code]&&T.jsx("p",{style:{lineHeight:"1.8",textAlign:"justify"},children:ob[t.code].th})]}),T.jsxs("section",{className:"modal-section",children:[T.jsx("h3",{children:" "}),T.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[T.jsxs("div",{style:{padding:"0.75rem",background:"rgba(126, 200, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(126, 200, 69, 0.3)"},children:[T.jsx("strong",{children:" . ()"}),T.jsx("br",{})," 3 "]}),T.jsxs("div",{style:{padding:"0.75rem",background:"rgba(0, 166, 81, 0.1)",borderRadius:"8px",border:"1px solid rgba(0, 166, 81, 0.3)"},children:[T.jsx("strong",{children:" . ()"}),T.jsx("br",{})," 2 ",t.code==="It"&&T.jsx("span",{style:{color:"#f59e0b",marginLeft:"0.5rem"},children:" ( .)"})]})]})]}),T.jsx("button",{className:"modal-btn",style:{background:`linear-gradient(135deg, ${t.color} 0%, ${t.color}80 100%)`},onClick:()=>{/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?window.location.href="https://www.lannapoly.ac.th/admission/#/?from=website":window.open("https://www.lannapoly.ac.th/admission/#/?from=website","_blank")},children:" "})]})]})}),T.jsx(Rc,{children:s&&T.jsx(Pe.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>u(!1),children:T.jsxs(Pe.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:d=>d.stopPropagation(),children:[T.jsxs("div",{className:"external-header",children:[T.jsx("h3",{children:" "}),T.jsx("button",{className:"back-btn",onClick:()=>u(!1),children:" "})]}),T.jsx("iframe",{src:"https://www.lannapoly.ac.th/admission/#/?from=website",className:"admission-iframe",title:"Online Admission",allowFullScreen:!0,loading:"lazy",style:{width:"100%",height:"500px",border:"none"},onError:d=>{const p=document.getElementById("admission-fallback-btn");p&&(p.style.display="block")}}),T.jsx("button",{id:"admission-fallback-btn",style:{display:"none",marginTop:"16px"},onClick:()=>window.open("https://www.lannapoly.ac.th/admission/#/?from=website","_blank"),children:""})]})})})]})},yJ=n=>({tech:"",business:"",design:"",health:"",engineering:"",hospitality:""})[n]||"",_J=({onClose:n})=>{const[e,t]=re.useState("certificate"),[r,i]=re.useState(!1),[a,s]=re.useState(!1),u=g=>new Intl.NumberFormat("th-TH").format(g),c=()=>{i(!0)},h=()=>{i(!1)},d=()=>{s(!0)},p=()=>{s(!1)};return T.jsxs(Pe.div,{className:"tuition-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,children:[T.jsxs(Pe.div,{className:"tuition-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:g=>g.stopPropagation(),children:[T.jsxs("div",{className:"tuition-header",children:[T.jsx("h2",{children:"  & "}),T.jsx("button",{className:"close-btn",onClick:n,children:""})]}),T.jsxs("div",{className:"tuition-tabs",children:[T.jsx("button",{className:`tab-btn ${e==="certificate"?"active":""}`,onClick:()=>t("certificate"),children:" ."}),T.jsx("button",{className:`tab-btn ${e==="diploma"?"active":""}`,onClick:()=>t("diploma"),children:" ."}),T.jsx("button",{className:`tab-btn ${e==="scholarships"?"active":""}`,onClick:()=>t("scholarships"),children:" "})]}),T.jsx("div",{className:"tuition-content",children:T.jsxs(Rc,{mode:"wait",children:[e==="certificate"&&T.jsxs(Pe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[T.jsx("h3",{children:"  . ( .3 )"}),T.jsx("div",{className:"fee-cards",children:Object.entries(Fa.certificate).map(([g,v])=>T.jsxs("div",{className:"fee-card",children:[T.jsx("h4",{children:v.name}),T.jsxs("div",{className:"fee-details",children:[T.jsxs("div",{className:"fee-row",children:[T.jsx("span",{children:":"}),T.jsxs("strong",{children:[u(v.tuition)," /"]})]}),T.jsxs("div",{className:"fee-row",children:[T.jsx("span",{children:" +  + :"}),T.jsxs("strong",{children:[u(v.entrance)," "]})]}),T.jsxs("div",{className:"fee-row total",children:[T.jsx("span",{children:":"}),T.jsxs("strong",{className:"total-price",children:[u(v.total)," "]})]})]})]},g))})]},"certificate"),e==="diploma"&&T.jsxs(Pe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[T.jsx("h3",{children:"  . ( .3, .6 )"}),T.jsx("div",{className:"fee-cards",children:Object.entries(Fa.diploma).map(([g,v])=>T.jsxs("div",{className:"fee-card",children:[T.jsx("h4",{children:v.name}),T.jsxs("div",{className:"fee-details",children:[T.jsxs("div",{className:"fee-row",children:[T.jsx("span",{children:":"}),T.jsxs("strong",{children:[u(v.tuition)," /"]})]}),T.jsxs("div",{className:"fee-row",children:[T.jsx("span",{children:" +  + :"}),T.jsxs("strong",{children:[u(v.entrance)," "]})]}),T.jsxs("div",{className:"fee-row total",children:[T.jsx("span",{children:":"}),T.jsxs("strong",{className:"total-price",children:[u(v.total)," "]})]})]})]},g))})]},"diploma"),e==="scholarships"&&T.jsxs(Pe.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[T.jsx("h3",{children:" "}),T.jsx("div",{className:"scholarship-grid",children:Fa.scholarships.map(g=>T.jsxs("div",{className:"scholarship-card",style:{borderColor:g.color},children:[T.jsx("div",{className:"scholarship-icon",style:{color:g.color},children:g.icon}),T.jsx("h4",{children:g.name}),T.jsx("p",{children:g.description})]},g.id))}),T.jsxs("div",{className:"benefits-section",children:[T.jsx("h4",{children:" "}),T.jsx("ul",{className:"benefits-list",children:Fa.benefits.map((g,v)=>T.jsxs("li",{children:[" ",g]},v))})]})]},"scholarships")]})}),T.jsxs("div",{className:"tuition-footer",children:[T.jsxs("div",{className:"footer-section",children:[T.jsx("h4",{children:" "}),T.jsx("ul",{className:"doc-list",children:Fa.documents.map((g,v)=>T.jsx("li",{children:g},v))})]}),T.jsxs("div",{className:"footer-section",children:[T.jsx("h4",{children:" "}),T.jsx("div",{className:"method-list",children:Fa.applicationMethods.map(g=>T.jsxs("div",{className:"method-item clickable",onClick:()=>{g.method==="walk-in"?c():g.method==="online"&&d()},children:[T.jsx("span",{className:"method-icon",children:g.icon}),T.jsxs("div",{children:[T.jsx("strong",{children:g.name}),T.jsx("p",{children:g.description})]}),T.jsx("span",{className:"method-arrow",children:""})]},g.method))})]}),T.jsx("div",{className:"notes-section",children:Fa.notes.map((g,v)=>T.jsxs("div",{className:"note-item",children:[" ",g]},v))})]})]}),T.jsx(Rc,{children:a&&T.jsx(Pe.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,children:T.jsxs(Pe.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:g=>g.stopPropagation(),children:[T.jsxs("div",{className:"external-header",children:[T.jsx("h3",{children:" "}),T.jsx("button",{className:"back-btn",onClick:p,children:" "})]}),T.jsx("iframe",{src:"https://www.lannapoly.ac.th/admission/#/?from=website",className:"admission-iframe",title:"Online Admission",allowFullScreen:!0,loading:"lazy"})]})})}),T.jsx(Rc,{children:r&&T.jsx(Pe.div,{className:"external-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h,children:T.jsxs(Pe.div,{className:"external-modal",initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:g=>g.stopPropagation(),children:[T.jsxs("div",{className:"external-header",children:[T.jsx("h3",{children:" "}),T.jsx("button",{className:"back-btn",onClick:h,children:" "})]}),T.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d15107.211230282383!2d98.9912912!3d18.8069393!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da3bcb57f2cda3%3A0x5a42c69f9e85016a!2z4Lin4Li04LiX4Lii4Liy4Lil4Lix4Lii4LmA4LiX4LiE4LmC4LiZ4LmC4Lil4Lii4Li14LmC4Lib4Lil4Li04LmA4LiX4LiE4LiZ4Li04LiE4Lil4Liy4LiZ4LiZ4LiyIOC5gOC4iuC4teC4ouC4h-C5g-C4q-C4oeC5iA!5e0!3m2!1sth!2sth!4v1766587427769!5m2!1sth!2sth",className:"admission-iframe",title:"Google Maps - ",allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{border:0}})]})})})]})},bJ=({onInteraction:n})=>{const[e,t]=re.useState(0),[r,i]=re.useState("fade"),a=[{type:"fade",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},{type:"slide",initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:-100,opacity:0}},{type:"zoom",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.2,opacity:0}},{type:"rotate",initial:{rotateY:90,opacity:0},animate:{rotateY:0,opacity:1},exit:{rotateY:-90,opacity:0}},{type:"flip",initial:{rotateX:-90,opacity:0},animate:{rotateX:0,opacity:1},exit:{rotateX:90,opacity:0}}],s=[{id:1,type:"image",title:"",subtitle:" ",description:"",image:"/images/activities/1.jpg",gradient:"linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(118, 75, 162, 0.7) 100%)",icon:""},{id:2,type:"image",title:"14 ",subtitle:"",description:" |  |  | ",image:"/images/activities/2.jpg",gradient:"linear-gradient(135deg, rgba(240, 147, 251, 0.7) 0%, rgba(245, 87, 108, 0.7) 100%)",icon:""},{id:3,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/3.jpg",gradient:"linear-gradient(135deg, rgba(79, 172, 254, 0.7) 0%, rgba(0, 242, 254, 0.7) 100%)",icon:""},{id:4,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/4.jpg",gradient:"linear-gradient(135deg, rgba(250, 112, 154, 0.7) 0%, rgba(254, 225, 64, 0.7) 100%)",icon:""},{id:5,type:"image",title:"",subtitle:"95%  6 ",description:" 200 ",image:"/images/activities/5.jpg",gradient:"linear-gradient(135deg, rgba(48, 207, 208, 0.7) 0%, rgba(51, 8, 103, 0.7) 100%)",icon:""},{id:6,type:"image",title:"",subtitle:" 2568",description:" |  | ",image:"/images/activities/6.jpg",gradient:"linear-gradient(135deg, rgba(168, 237, 234, 0.7) 0%, rgba(254, 214, 227, 0.7) 100%)",icon:""},{id:7,type:"image",title:"",subtitle:"",description:"  ",image:"/images/activities/7.jpg",gradient:"linear-gradient(135deg, rgba(255, 159, 124, 0.7) 0%, rgba(255, 95, 109, 0.7) 100%)",icon:""},{id:8,type:"image",title:"",subtitle:"",description:"",image:"/images/activities/8.jpg",gradient:"linear-gradient(135deg, rgba(67, 198, 172, 0.7) 0%, rgba(25, 22, 84, 0.7) 100%)",icon:""},{id:9,type:"image",title:"",subtitle:"",description:" ",image:"/images/activities/9.jpg",gradient:"linear-gradient(135deg, rgba(255, 175, 189, 0.7) 0%, rgba(255, 195, 160, 0.7) 100%)",icon:""},{id:10,type:"image",title:"",subtitle:"",description:"",image:"/images/activities/10.jpg",gradient:"linear-gradient(135deg, rgba(132, 250, 176, 0.7) 0%, rgba(143, 211, 244, 0.7) 100%)",icon:""},{id:11,type:"cta",title:"!",subtitle:"",description:" ",gradient:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",icon:"",pulse:!0}];re.useEffect(()=>{const c=setInterval(()=>{const h=a[Math.floor(Math.random()*a.length)];i(h.type),t(d=>(d+1)%s.length)},5e3);return()=>clearInterval(c)},[s.length]);const u=()=>{n&&n()};return T.jsxs("div",{className:"ad-slideshow",onClick:u,children:[T.jsx("div",{className:"inf-grid-hero-container",children:T.jsx("div",{className:"inf-grid-perspective",children:T.jsxs("div",{className:"grid-lines",children:[[...Array(20)].map((c,h)=>T.jsx("div",{className:"grid-line-horizontal",style:{top:`${h*5}%`}},`h-${h}`)),[...Array(20)].map((c,h)=>T.jsx("div",{className:"grid-line-vertical",style:{left:`${h*5}%`}},`v-${h}`))]})})}),T.jsx(Rc,{mode:"wait",children:T.jsxs(Pe.div,{className:"slide",style:{background:s[e].gradient,backgroundImage:s[e].image?`url(${s[e].image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:a.find(c=>c.type===r)?.initial||{opacity:0},animate:a.find(c=>c.type===r)?.animate||{opacity:1},exit:a.find(c=>c.type===r)?.exit||{opacity:0},transition:{duration:.9,ease:[.43,.13,.23,.96]},children:[T.jsx("div",{className:"floating-images-3d",children:s.filter(c=>c.image).slice(0,8).map((c,h)=>T.jsx(Pe.div,{className:"floating-image-card",style:{backgroundImage:`url(${c.image})`,left:`${Math.random()*80+10}%`,top:`${Math.random()*60+20}%`},initial:{rotateX:Math.random()*30-15,rotateY:Math.random()*30-15,z:Math.random()*-500-100,opacity:0},animate:{rotateX:[null,Math.random()*20-10],rotateY:[null,Math.random()*360],z:[null,Math.random()*-300],opacity:[0,.7,.7,0]},transition:{duration:8+Math.random()*4,repeat:1/0,delay:h*.5,ease:"easeInOut"}},`float-${h}`))}),T.jsx("div",{className:"particles",children:[...Array(20)].map((c,h)=>T.jsx(Pe.div,{className:"particle",initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,scale:Math.random()*.5+.5,opacity:0},animate:{y:[null,Math.random()*-200-100],opacity:[0,.6,0],scale:[null,Math.random()*1.5+.5]},transition:{duration:Math.random()*3+2,repeat:1/0,delay:Math.random()*2}},h))}),T.jsx("div",{className:"grid-bg"}),s[e].image&&T.jsx("div",{className:"slide-overlay",style:{background:s[e].gradient}}),T.jsxs("div",{className:"slide-content",children:[T.jsx(Pe.div,{className:`slide-icon ${s[e].pulse?"pulse":""}`,initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},children:s[e].icon}),T.jsx(Pe.h1,{className:"slide-title",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},children:s[e].title}),T.jsx(Pe.h2,{className:"slide-subtitle",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:s[e].subtitle}),T.jsx(Pe.p,{className:"slide-description",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},children:s[e].description}),s[e].type==="cta"&&T.jsxs(Pe.div,{className:"cta-hint",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},children:[T.jsx("div",{className:"hand-wave",children:""}),T.jsx("p",{children:""})]})]}),T.jsx("div",{className:"slide-dots",children:s.map((c,h)=>T.jsx("div",{className:`dot ${h===e?"active":""}`,onClick:d=>{d.stopPropagation(),t(h)}},h))})]},e)}),T.jsx("div",{className:"interaction-hint",children:T.jsx("p",{children:" "})})]})};function xJ({onComplete:n,careerSuggestions:e=[]}){const[t,r]=re.useState("welcome"),[i,a]=re.useState(null),s=h=>{const d=new(window.AudioContext||window.webkitAudioContext),p=d.createOscillator(),g=d.createGain();p.connect(g),g.connect(d.destination),h==="click"?(p.frequency.value=800,g.gain.setValueAtTime(.1,d.currentTime),g.gain.exponentialRampToValueAtTime(.01,d.currentTime+.1),p.start(d.currentTime),p.stop(d.currentTime+.1)):h==="success"&&(p.frequency.value=1200,g.gain.setValueAtTime(.1,d.currentTime),g.gain.exponentialRampToValueAtTime(.01,d.currentTime+.2),p.start(d.currentTime),p.stop(d.currentTime+.2))},u=h=>{s("click"),h==="start"?r("explore"):h==="back"?r("welcome"):h==="finish"&&n&&n()},c=h=>{s("success"),a(h),r("career")};return T.jsxs("div",{className:"kids-mode",children:[t==="welcome"&&T.jsxs(Pe.div,{className:"kids-screen welcome-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[T.jsx(Pe.h1,{className:"kids-title",children:" ! "}),T.jsx(Pe.div,{className:"emoji-bounce",animate:{y:[0,-20,0]},transition:{duration:1.5,repeat:1/0},children:""}),T.jsx(Pe.p,{className:"kids-subtitle",children:"  !"}),T.jsxs(Pe.button,{className:"big-button start-button",onClick:()=>u("start"),whileHover:{scale:1.1},whileTap:{scale:.95},children:[T.jsx("span",{className:"button-text",children:"!"}),T.jsx("span",{className:"button-emoji",children:""})]})]}),t==="explore"&&T.jsxs(Pe.div,{className:"kids-screen explore-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[T.jsx(Pe.h2,{className:"kids-title",children:"! "}),T.jsx("div",{className:"kids-career-grid",children:e.length>0?e.map(h=>T.jsxs(Pe.div,{className:"kids-career-card",onClick:()=>c(h),whileHover:{scale:1.05},whileTap:{scale:.95},animate:{boxShadow:["0 5px 15px rgba(0, 0, 0, 0.1)","0 8px 25px rgba(0, 0, 0, 0.2)","0 5px 15px rgba(0, 0, 0, 0.1)"]},transition:{duration:2,repeat:1/0},children:[T.jsx("div",{className:"big-emoji",children:h.icon}),T.jsx("div",{className:"career-name",children:h.name})]},h.id)):T.jsx("p",{className:"placeholder",children:"..."})}),T.jsxs(Pe.button,{className:"big-button back-button",onClick:()=>u("back"),whileHover:{scale:1.1},whileTap:{scale:.95},children:[T.jsx("span",{className:"button-emoji",children:""}),T.jsx("span",{className:"button-text",children:""})]})]}),t==="career"&&i&&T.jsxs(Pe.div,{className:"kids-screen career-screen",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},children:[T.jsx(Pe.div,{className:"big-emoji-large",animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:i.icon}),T.jsx(Pe.h2,{className:"kids-title",children:i.name}),T.jsx(Pe.p,{className:"kids-description",children:i.description}),T.jsxs("div",{className:"kids-buttons-row",children:[T.jsx(Pe.button,{className:"big-button back-button",onClick:()=>u("back"),whileHover:{scale:1.1},whileTap:{scale:.95},children:T.jsx("span",{className:"button-emoji",children:""})}),T.jsx(Pe.button,{className:"big-button finish-button",onClick:()=>u("finish"),whileHover:{scale:1.1},whileTap:{scale:.95},children:T.jsx("span",{className:"button-emoji",children:""})})]})]}),t!=="welcome"&&T.jsx("div",{className:"confetti",children:[...Array(10)].map((h,d)=>T.jsx(Pe.div,{className:"confetti-piece",initial:{x:Math.random()*300-150,y:-20,opacity:1},animate:{y:400,opacity:0},transition:{duration:2+Math.random()*1,repeat:1/0},children:["","","","",""][Math.floor(Math.random()*5)]},d))})]})}const wJ=()=>{const[n,e]=re.useState([]),[t,r]=re.useState(!0);re.useEffect(()=>{i()},[]);const i=async()=>{try{let a=[];try{const u=Br(wt,"heatmap_clicks"),c=Qu(u,Zu("timestamp","desc"),Bc(100));a=(await Ns(c)).docs.map(d=>{const p=d.data();return{...p,id:d.id,timestamp:p.timestamp?.toDate?p.timestamp.toDate():new Date(p.timestamp||Date.now())}})}catch{console.log("heatmap_clicks not found, trying heatmap collection...");try{const c=Br(wt,"heatmap"),h=Qu(c,Zu("timestamp","desc"),Bc(100));a=(await Ns(h)).docs.map(p=>{const g=p.data();return{...g,id:p.id,timestamp:g.timestamp?.toDate?g.timestamp.toDate():new Date(g.timestamp||Date.now())}})}catch{console.log("No heatmap data available"),a=[]}}const s=a.filter(u=>u.x!==void 0&&u.y!==void 0&&u.x>=0&&u.x<=100&&u.y>=0&&u.y<=100&&u.timestamp&&u.category&&u.category!=="test"&&!(u.x===0&&u.y===0)&&!(u.x===50&&u.y===50&&u.category==="default"));console.log(` Filtered heatmap: ${a.length} total  ${s.length} valid`),e(s),r(!1)}catch(a){console.error("Error fetching heatmap data:",a),e([]),r(!1)}};return t?T.jsxs("div",{className:"analytics-loading",children:[T.jsx("div",{className:"loading-spinner"}),T.jsx("h2",{children:"  Heatmap..."}),T.jsx("p",{children:" Firebase"})]}):n.length===0?T.jsxs("div",{className:"analytics-dashboard",children:[T.jsxs("div",{className:"analytics-header",children:[T.jsx("h1",{children:" Heatmap"}),T.jsx("p",{children:""})]}),T.jsxs("div",{className:"no-data-state",children:[T.jsx("div",{className:"no-data-icon",children:""}),T.jsx("h3",{children:""}),T.jsx("p",{children:" Heatmap "}),T.jsx("button",{className:"refresh-btn",onClick:i,children:" "})]})]}):T.jsxs("div",{className:"analytics-dashboard",children:[T.jsxs("div",{className:"analytics-header",children:[T.jsx("h1",{children:" Click Heatmap"}),T.jsx("p",{children:" ( 100 )"})]}),T.jsxs("div",{className:"metrics-grid",children:[T.jsxs("div",{className:"metric-card",children:[T.jsx("div",{className:"metric-label",children:" "}),T.jsx("div",{className:"metric-value",children:n.length})]}),T.jsxs("div",{className:"metric-card",children:[T.jsx("div",{className:"metric-label",children:" "}),T.jsx("div",{className:"metric-value",children:n[0]?.timestamp?new Date(n[0].timestamp).toLocaleDateString("th-TH"):"-"})]})]}),T.jsxs("div",{className:"analytics-section",children:[T.jsx("h2",{children:"  Heatmap"}),T.jsx("p",{className:"section-note",children:" Firebase - "}),T.jsxs("div",{className:"heatmap-stats",children:[T.jsxs("div",{className:"heatmap-stat",children:[T.jsx("span",{className:"stat-label",children:"Total Clicks:"}),T.jsx("span",{className:"stat-value",children:n.length})]}),T.jsxs("div",{className:"heatmap-stat",children:[T.jsx("span",{className:"stat-label",children:":"}),T.jsx("span",{className:"stat-value",children:n[0]?.timestamp?new Date(n[0].timestamp).toLocaleTimeString("th-TH"):"N/A"})]})]}),T.jsxs("div",{className:"heatmap-visualization",children:[T.jsx("div",{className:"heatmap-canvas",children:n.slice(0,100).map((a,s)=>T.jsx("div",{className:"heatmap-point",style:{left:`${a.x||Math.random()*100}%`,top:`${a.y||Math.random()*100}%`,opacity:Math.max(.2,.8-s/100)},title:`: ${a.page||"Unknown"} | : ${a.timestamp?new Date(a.timestamp).toLocaleString("th-TH"):"N/A"}`},a.id||s))}),T.jsxs("div",{className:"heatmap-legend",children:[T.jsx("span",{children:" "}),T.jsx("span",{children:" "}),T.jsx("span",{children:" "})]})]})]}),T.jsxs("div",{className:"analytics-footer",children:[T.jsx("button",{className:"refresh-btn",onClick:i,children:" "}),T.jsx("p",{className:"refresh-note",children:" Firebase "})]})]})};function EJ({onClose:n,standalone:e=!1}){const[t,r]=re.useState([]),[i,a]=re.useState(!0),[s,u]=re.useState(null),[c,h]=re.useState(!1),[d,p]=re.useState({title:"",description:"",type:"scholarship",ageGroupId:"",priority:5,tags:"",imageUrl:"",isActive:!0}),g=[{id:"scholarship",name:"",icon:""},{id:"news",name:"",icon:""},{id:"sports",name:"",icon:""},{id:"event",name:"",icon:""},{id:"competition",name:"",icon:""},{id:"promotion",name:"",icon:""},{id:"career",name:"",icon:""},{id:"activity",name:"",icon:""},{id:"workshop",name:"/",icon:""},{id:"seminar",name:"",icon:""},{id:"kids_program",name:"",icon:""},{id:"announcement",name:"",icon:""}],[v,b]=re.useState([]),[E,w]=re.useState(!1);re.useEffect(()=>{E||(w(!0),S(),C())},[E]);const C=async()=>{if(!wt){console.warn(" Firebase not configured - using default age groups"),b([{id:"KIDS_3_12",name:"",emoji:"",ageMin:3,ageMax:12},{id:"TEENS_13_17",name:"",emoji:"",ageMin:13,ageMax:17},{id:"ADULTS_18_PLUS",name:"",emoji:"",ageMin:18,ageMax:100}]);return}try{const N=Br(wt,"age_groups"),k=(await Ns(N)).docs.map(P=>({id:P.id,...P.data()}));k.sort((P,V)=>P.ageMin-V.ageMin),b(k),k.length===0&&console.warn(" No age groups found, please add them in Firebase")}catch(N){console.error("Error fetching age groups:",N)}},S=async()=>{if(!wt){a(!1),alert(` Firebase 

 Firebase  src/config.js  Admin Panel

: FIREBASE_SETUP.md`);return}try{a(!0);const N=Br(wt,"content_items"),R=Qu(N,Zu("createdAt","desc")),P=(await Ns(R)).docs.map(V=>({id:V.id,...V.data()}));r(P)}catch(N){console.error("Error fetching contents:",N),alert(": "+N.message)}finally{a(!1)}},I=async N=>{if(N.preventDefault(),!wt){alert(" Firebase ");return}try{const R={...d,tags:d.tags.split(",").map(k=>k.trim()).filter(k=>k),createdAt:s?s.createdAt:new Date,updatedAt:new Date,viewCount:s?s.viewCount:0,clickCount:s?s.clickCount:0};if(s){const k=Rs(wt,"content_items",s.id);await E1(k,R),alert(" !")}else await _h(Br(wt,"content_items"),R),alert(" !");p({title:"",description:"",type:"scholarship",ageGroupId:"",priority:5,tags:"",imageUrl:"",isActive:!0}),u(null),h(!1),S()}catch(R){console.error("Error saving content:",R),alert(" : "+R.message)}},D=N=>{u(N),p({title:N.title,description:N.description,type:N.type,ageGroupId:N.ageGroupId||"",priority:N.priority,tags:N.tags?N.tags.join(", "):"",imageUrl:N.imageUrl||"",isActive:N.isActive}),h(!0)},O=async N=>{if(confirm("?"))try{await T1(Rs(wt,"content_items",N)),alert(" !"),S()}catch(R){console.error("Error deleting content:",R),alert(" : "+R.message)}},B=async N=>{try{const R=Rs(wt,"content_items",N.id);await E1(R,{isActive:!N.isActive}),S()}catch(R){console.error("Error toggling active:",R)}};return T.jsx("div",{className:`content-admin-overlay ${e?"standalone":""}`,children:T.jsxs("div",{className:`content-admin ${e?"standalone":""}`,children:[T.jsxs("div",{className:"admin-header",children:[T.jsx("h1",{children:"  Content Management"}),!e&&T.jsx("button",{className:"close-btn",onClick:n,children:""})]}),T.jsxs("div",{className:"admin-actions",children:[T.jsx("button",{className:"btn-add",onClick:()=>{h(!c),u(null),p({title:"",description:"",type:"scholarship",ageGroupId:"",priority:5,tags:"",imageUrl:"",isActive:!0})},children:c?" ":" "}),T.jsx("button",{className:"btn-refresh",onClick:S,children:" "})]}),c&&T.jsxs("form",{className:"content-form",onSubmit:I,children:[T.jsx("h2",{children:s?" ":" "}),T.jsx("div",{className:"form-row",children:T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" *"}),T.jsx("input",{type:"text",value:d.title,onChange:N=>p({...d,title:N.target.value}),required:!0,placeholder:"  100%"})]})}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" *"}),T.jsx("textarea",{value:d.description,onChange:N=>p({...d,description:N.target.value}),required:!0,rows:"4",placeholder:"..."})]}),T.jsxs("div",{className:"form-row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:""}),T.jsx("select",{value:d.type,onChange:N=>p({...d,type:N.target.value}),children:g.map(N=>T.jsxs("option",{value:N.id,children:[N.icon," ",N.name]},N.id))})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" *"}),T.jsxs("select",{value:d.ageGroupId,onChange:N=>p({...d,ageGroupId:N.target.value}),required:!0,children:[T.jsx("option",{value:"",children:"--  --"}),v.map(N=>T.jsxs("option",{value:N.id,children:[N.emoji," ",N.name," (",N.ageMin,"-",N.ageMax," )"]},N.id))]})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" (1-10)"}),T.jsx("input",{type:"number",min:"1",max:"10",value:d.priority,onChange:N=>p({...d,priority:parseInt(N.target.value)})})]})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Tags ()"}),T.jsx("input",{type:"text",value:d.tags,onChange:N=>p({...d,tags:N.target.value}),placeholder:", , "})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"URL  ()"}),T.jsx("input",{type:"url",value:d.imageUrl,onChange:N=>p({...d,imageUrl:N.target.value}),placeholder:"https://example.com/image.jpg"})]}),T.jsx("div",{className:"form-group checkbox",children:T.jsxs("label",{children:[T.jsx("input",{type:"checkbox",checked:d.isActive,onChange:N=>p({...d,isActive:N.target.checked})}),""]})}),T.jsxs("div",{className:"form-actions",children:[T.jsx("button",{type:"submit",className:"btn-save",children:s?" ":" "}),T.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>{h(!1),u(null)},children:""})]})]}),T.jsxs("div",{className:"content-list",children:[T.jsxs("h2",{children:["  (",t.length,")"]}),i?T.jsxs("div",{className:"loading",children:[T.jsx("div",{className:"spinner"}),T.jsx("p",{children:"..."})]}):t.length===0?T.jsxs("div",{className:"empty-state",children:[T.jsx("p",{children:""}),T.jsx("p",{children:' "" '})]}):T.jsx("div",{className:"content-grid",children:t.map(N=>T.jsxs("div",{className:`content-card ${N.isActive?"":"inactive"}`,children:[T.jsxs("div",{className:"card-header",children:[T.jsxs("span",{className:"type-badge",children:[g.find(R=>R.id===N.type)?.icon," ",N.type]}),T.jsxs("span",{className:"age-badge",children:[v.find(R=>R.id===N.ageGroupId)?.emoji||"",v.find(R=>R.id===N.ageGroupId)?.name||N.ageGroupId]})]}),T.jsx("h3",{children:N.title}),T.jsx("p",{className:"description",children:N.description}),T.jsxs("div",{className:"card-meta",children:[T.jsxs("span",{children:[" Priority: ",N.priority]}),T.jsxs("span",{children:[" Views: ",N.viewCount||0]}),T.jsxs("span",{children:[" Clicks: ",N.clickCount||0]})]}),N.tags&&N.tags.length>0&&T.jsx("div",{className:"tags",children:N.tags.map((R,k)=>T.jsxs("span",{className:"tag",children:["#",R]},k))}),T.jsxs("div",{className:"card-actions",children:[T.jsx("button",{className:"btn-toggle",onClick:()=>B(N),children:N.isActive?" ":" "}),T.jsx("button",{className:"btn-edit",onClick:()=>D(N),children:" "}),T.jsx("button",{className:"btn-delete",onClick:()=>O(N.id),children:" "})]})]},N.id))})]})]})})}function TJ({onClose:n,standalone:e=!1}){const[t,r]=re.useState([]),[i,a]=re.useState(!0),[s,u]=re.useState(null),[c,h]=re.useState(!1),[d,p]=re.useState({id:"",name:"",ageMin:0,ageMax:100,description:"",emoji:"",color:"#3b82f6"});re.useEffect(()=>{g()},[]);const g=async()=>{if(!wt){a(!1),alert(` Firebase 

 Firebase  src/config.js  Admin Panel

: FIREBASE_SETUP.md`);return}try{a(!0);const S=Br(wt,"age_groups"),D=(await Ns(S)).docs.map(O=>({id:O.id,...O.data()}));D.sort((O,B)=>O.ageMin-B.ageMin),r(D)}catch(S){console.error("Error fetching age groups:",S),alert(": "+S.message)}finally{a(!1)}},v=()=>d.id.trim()?d.name.trim()?d.ageMin<0||d.ageMax<0?(alert(" 0"),!1):d.ageMin>=d.ageMax?(alert(""),!1):!s&&t.some(S=>S.id===d.id)?(alert("ID   ID "),!1):!0:(alert(""),!1):(alert(" ID ( )"),!1),b=async S=>{if(S.preventDefault(),!wt){alert(" Firebase ");return}if(v())try{const I={id:d.id,name:d.name,ageMin:parseInt(d.ageMin),ageMax:parseInt(d.ageMax),description:d.description,emoji:d.emoji||"",color:d.color||"#3b82f6"};if(s)if(s.id!==d.id){const D=Rs(wt,"age_groups",s.id);await T1(D),await kI(Rs(wt,"age_groups",d.id),I),alert("  ID !")}else{const D=Rs(wt,"age_groups",s.id);await E1(D,I),alert(" !")}else await kI(Rs(wt,"age_groups",d.id),I),alert(" !");p({id:"",name:"",ageMin:0,ageMax:100,description:"",emoji:"",color:"#3b82f6"}),u(null),h(!1),g()}catch(I){console.error("Error saving age group:",I),alert(" : "+I.message)}},E=S=>{u(S),p({id:S.id,name:S.name,ageMin:S.ageMin,ageMax:S.ageMax,description:S.description||"",emoji:S.emoji||"",color:S.color||"#3b82f6"}),h(!0)},w=async S=>{if(confirm(` "${S}"?

 : !`))try{await T1(Rs(wt,"age_groups",S)),alert(" !"),g()}catch(I){console.error("Error deleting age group:",I),alert(" : "+I.message)}},C=()=>{p({id:"",name:"",ageMin:0,ageMax:100,description:"",emoji:"",color:"#3b82f6"}),u(null),h(!1)};return T.jsx(Pe.div,{className:`age-group-admin-overlay ${e?"standalone":""}`,initial:e?!1:{opacity:0},animate:e?!1:{opacity:1},children:T.jsxs(Pe.div,{className:`age-group-admin ${e?"standalone":""}`,initial:e?!1:{scale:.9,opacity:0},animate:e?!1:{scale:1,opacity:1},children:[T.jsxs("div",{className:"admin-header",children:[T.jsx("h1",{children:"  (Age Groups)"}),!e&&T.jsx("button",{className:"close-btn",onClick:n,children:""})]}),T.jsxs("div",{className:"admin-actions",children:[T.jsx("button",{className:"btn-add",onClick:()=>{C(),h(!c)},children:c?" ":" "}),T.jsx("button",{className:"btn-refresh",onClick:g,children:" "})]}),c&&T.jsxs(Pe.form,{className:"age-group-form",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},onSubmit:b,children:[T.jsx("h2",{children:s?" ":" "}),T.jsxs("div",{className:"form-row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"ID () *"}),T.jsx("input",{type:"text",value:d.id,onChange:S=>p({...d,id:S.target.value.toUpperCase().replace(/\s/g,"_")}),placeholder:"GEN_ALPHA",required:!0,pattern:"[A-Z_]+",title:"  _ "}),T.jsx("small",{className:s?"warning":"",children:s?"  ID  document ":" Key  database"})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" *"}),T.jsx("input",{type:"text",value:d.name,onChange:S=>p({...d,name:S.target.value}),placeholder:"Gen Alpha",required:!0})]})]}),T.jsxs("div",{className:"form-row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" *"}),T.jsx("input",{type:"number",min:"0",max:"150",value:d.ageMin,onChange:S=>p({...d,ageMin:S.target.value===""?"":Number(S.target.value)}),onBlur:S=>p({...d,ageMin:Number(S.target.value)||0}),required:!0})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:" *"}),T.jsx("input",{type:"number",min:"0",max:"150",value:d.ageMax,onChange:S=>p({...d,ageMax:S.target.value===""?"":Number(S.target.value)}),onBlur:S=>p({...d,ageMax:Number(S.target.value)||0}),required:!0})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Emoji"}),T.jsx("input",{type:"text",value:d.emoji,onChange:S=>p({...d,emoji:S.target.value}),placeholder:"",maxLength:"2"})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:""}),T.jsx("input",{type:"color",value:d.color,onChange:S=>p({...d,color:S.target.value})})]})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:""}),T.jsx("textarea",{value:d.description,onChange:S=>p({...d,description:S.target.value}),rows:"3",placeholder:"    "})]}),T.jsxs("div",{className:"form-actions",children:[T.jsx("button",{type:"submit",className:"btn-save",children:s?" ":" "}),T.jsx("button",{type:"button",className:"btn-cancel",onClick:C,children:""})]})]}),T.jsxs("div",{className:"age-groups-list",children:[T.jsxs("h2",{children:["  (",t.length,")"]}),i?T.jsxs("div",{className:"loading",children:[T.jsx("div",{className:"spinner"}),T.jsx("p",{children:"..."})]}):t.length===0?T.jsxs("div",{className:"empty-state",children:[T.jsx("p",{children:""}),T.jsx("p",{children:' "" '})]}):T.jsx("div",{className:"age-groups-grid",children:t.map(S=>T.jsxs(Pe.div,{className:"age-group-card",style:{borderLeftColor:S.color},whileHover:{scale:1.02},children:[T.jsxs("div",{className:"card-header",children:[T.jsxs("div",{className:"group-info",children:[T.jsx("span",{className:"emoji",children:S.emoji}),T.jsxs("div",{children:[T.jsx("h3",{children:S.name}),T.jsxs("span",{className:"group-id",children:["ID: ",S.id]})]})]}),T.jsxs("div",{className:"age-range",style:{backgroundColor:S.color},children:[S.ageMin,"-",S.ageMax," "]})]}),S.description&&T.jsx("p",{className:"description",children:S.description}),T.jsxs("div",{className:"card-actions",children:[T.jsx("button",{className:"btn-edit",onClick:()=>E(S),children:" "}),T.jsx("button",{className:"btn-delete",onClick:()=>w(S.id),children:" "})]})]},S.id))})]})]})})}const CJ=({onClose:n,standalone:e=!1})=>{const[t,r]=re.useState([]),[i,a]=re.useState(!0),[s,u]=re.useState("all"),[c,h]=re.useState({total:0,today:0,thisWeek:0,avgAge:0,maleCount:0,femaleCount:0});re.useEffect(()=>{d()},[]);const d=async()=>{try{a(!0);let w,C;try{C=Br(wt,"face_scan_sessions");const j=Qu(C,Zu("timestamp","desc"),Bc(100));w=await Ns(j)}catch{console.log("face_scan_sessions collection not found, trying user_sessions...");try{C=Br(wt,"user_sessions");const L=Qu(C,Zu("timestamp","desc"),Bc(100));w=await Ns(L)}catch{console.log("user_sessions collection not found, trying scan_logs...");try{C=Br(wt,"scan_logs");const Z=Qu(C,Zu("timestamp","desc"),Bc(100));w=await Ns(Z)}catch{console.log("No face scan session data available"),w={docs:[]}}}}const S=[],I=new Date,D=new Date(I.getFullYear(),I.getMonth(),I.getDate()),O=new Date(D);O.setDate(O.getDate()-7);let B=0,N=0,R=0,k=0,P=0,V=0;w.docs.forEach(j=>{const L=j.data();if(!L.age||!L.gender){console.log(" Skipping entry - missing age/gender:",L);return}const Z=Number(L.age);if(isNaN(Z)||Z<1||Z>120){console.log(" Skipping entry - invalid age:",Z);return}if(!["male","female","unknown"].includes(L.gender.toLowerCase())){console.log(" Skipping entry - invalid gender:",L.gender);return}let q=L.timestamp;q&&typeof q.toDate=="function"?q=q.toDate():q&&typeof q=="string"?q=new Date(q):q&&typeof q=="number"?q=new Date(q):q=new Date,S.push({id:j.id,...L,timestamp:q,age:Number(L.age),gender:L.gender.toLowerCase()}),q>=D&&B++,q>=O&&N++;const X=Number(L.age);isNaN(X)||(R+=X,k++);const ee=L.gender.toLowerCase();ee==="male"&&P++,ee==="female"&&V++}),S.sort((j,L)=>new Date(L.timestamp)-new Date(j.timestamp)),r(S),h({total:S.length,today:B,thisWeek:N,avgAge:k>0?Math.round(R/k):0,maleCount:P,femaleCount:V}),console.log(` SessionLogs loaded: ${S.length} sessions`,{total:S.length,today:B,thisWeek:N,avgAge:k>0?Math.round(R/k):0})}catch(w){console.error("Error fetching logs:",w),r([]),h({total:0,today:0,thisWeek:0,avgAge:0,maleCount:0,femaleCount:0})}finally{a(!1)}},p=()=>{if(s==="all")return t;const w=new Date,C=new Date(w.getFullYear(),w.getMonth(),w.getDate());if(s==="today")return t.filter(S=>S.timestamp>=C);if(s==="week"){const S=new Date(C);return S.setDate(S.getDate()-7),t.filter(I=>I.timestamp>=S)}return t},g=w=>w?new Date(w).toLocaleString("th-TH",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",v=w=>w==="male"?"":w==="female"?"":"",b=w=>({happy:"",neutral:"",sad:"",angry:"",surprised:""})[w]||"",E=p();return T.jsx("div",{className:`session-logs-overlay ${e?"standalone":""}`,onClick:e?void 0:n,children:T.jsxs("div",{className:`session-logs-panel ${e?"standalone":""}`,onClick:w=>w.stopPropagation(),children:[T.jsxs("div",{className:`session-logs-header ${e?"standalone":""}`,children:[T.jsx("h2",{children:" Session Logs"}),T.jsx("button",{className:"close-btn",onClick:n,children:""})]}),i?T.jsxs("div",{className:"loading-state",children:[T.jsx("div",{className:"spinner"}),T.jsx("p",{children:"..."})]}):t.length===0?T.jsxs("div",{className:"empty-state",children:[T.jsx("div",{className:"empty-icon",children:""}),T.jsx("h3",{children:""}),T.jsx("p",{children:" Session Logs"})]}):T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"stats-grid",children:[T.jsxs("div",{className:"stat-card",children:[T.jsx("div",{className:"stat-icon",children:""}),T.jsxs("div",{className:"stat-content",children:[T.jsx("div",{className:"stat-value",children:c.total}),T.jsx("div",{className:"stat-label",children:""})]})]}),T.jsxs("div",{className:"stat-card",children:[T.jsx("div",{className:"stat-icon",children:""}),T.jsxs("div",{className:"stat-content",children:[T.jsx("div",{className:"stat-value",children:c.today}),T.jsx("div",{className:"stat-label",children:""})]})]}),T.jsxs("div",{className:"stat-card",children:[T.jsx("div",{className:"stat-icon",children:""}),T.jsxs("div",{className:"stat-content",children:[T.jsx("div",{className:"stat-value",children:c.thisWeek}),T.jsx("div",{className:"stat-label",children:""})]})]}),T.jsxs("div",{className:"stat-card",children:[T.jsx("div",{className:"stat-icon",children:""}),T.jsxs("div",{className:"stat-content",children:[T.jsxs("div",{className:"stat-value",children:[c.avgAge," "]}),T.jsx("div",{className:"stat-label",children:""})]})]}),T.jsxs("div",{className:"stat-card",children:[T.jsx("div",{className:"stat-icon",children:""}),T.jsxs("div",{className:"stat-content",children:[T.jsx("div",{className:"stat-value",children:c.maleCount}),T.jsx("div",{className:"stat-label",children:""})]})]}),T.jsxs("div",{className:"stat-card",children:[T.jsx("div",{className:"stat-icon",children:""}),T.jsxs("div",{className:"stat-content",children:[T.jsx("div",{className:"stat-value",children:c.femaleCount}),T.jsx("div",{className:"stat-label",children:""})]})]})]}),T.jsxs("div",{className:"filter-buttons",children:[T.jsxs("button",{className:`filter-btn ${s==="all"?"active":""}`,onClick:()=>u("all"),children:[" (",t.length,")"]}),T.jsxs("button",{className:`filter-btn ${s==="today"?"active":""}`,onClick:()=>u("today"),children:[" (",c.today,")"]}),T.jsxs("button",{className:`filter-btn ${s==="week"?"active":""}`,onClick:()=>u("week"),children:[" (",c.thisWeek,")"]})]}),T.jsx("div",{className:"logs-container",children:E.length===0?T.jsx("div",{className:"empty-state",children:T.jsx("p",{children:""})}):T.jsxs("table",{className:"logs-table",children:[T.jsx("thead",{children:T.jsxs("tr",{children:[T.jsx("th",{children:""}),T.jsx("th",{children:""}),T.jsx("th",{children:""}),T.jsx("th",{children:""}),T.jsx("th",{children:""}),T.jsx("th",{children:""})]})}),T.jsx("tbody",{children:E.map(w=>T.jsxs("tr",{children:[T.jsx("td",{className:"timestamp-cell",children:g(w.timestamp)}),T.jsx("td",{className:"age-cell",children:w.age?`${w.age} `:"-"}),T.jsxs("td",{className:"gender-cell",children:[v(w.gender)," ",w.gender||"-"]}),T.jsxs("td",{className:"emotion-cell",children:[b(w.emotion)," ",w.emotion||"-"]}),T.jsx("td",{className:"page-cell",children:w.page||""}),T.jsx("td",{className:"position-cell",children:w.x?`(${Math.round(w.x)}, ${Math.round(w.y)})`:"-"})]},w.id))})]})}),T.jsx("div",{className:"logs-footer",children:T.jsx("button",{className:"refresh-btn",onClick:d,children:" "})})]})]})})},SJ=({onClose:n})=>{const[e,t]=re.useState("analytics"),r=[{id:"analytics",name:" Analytics & Heatmap",icon:""},{id:"sessions",name:" Session Logs",icon:""},{id:"content",name:" ",icon:""},{id:"agegroups",name:" ",icon:""}];return T.jsx("div",{className:"admin-dashboard-overlay",onClick:n,children:T.jsxs("div",{className:"admin-dashboard-panel",onClick:i=>i.stopPropagation(),children:[T.jsxs("div",{className:"admin-dashboard-header",children:[T.jsx("h2",{children:" Admin Dashboard"}),T.jsx("button",{className:"close-btn",onClick:n,children:""})]}),T.jsx("div",{className:"admin-tabs",children:r.map(i=>T.jsxs("button",{className:`tab-btn ${e===i.id?"active":""}`,onClick:()=>t(i.id),children:[T.jsx("span",{className:"tab-icon",children:i.icon}),T.jsx("span",{className:"tab-name",children:i.name})]},i.id))}),T.jsxs("div",{className:"admin-content",children:[e==="analytics"&&T.jsx("div",{className:"tab-content",children:T.jsx(wJ,{})}),e==="sessions"&&T.jsx("div",{className:"tab-content",children:T.jsx(CJ,{standalone:!0})}),e==="content"&&T.jsx("div",{className:"tab-content",children:T.jsx(EJ,{standalone:!0})}),e==="agegroups"&&T.jsx("div",{className:"tab-content",children:T.jsx(TJ,{standalone:!0})})]})]})})},TP=re.createContext(),AJ=()=>{const n=re.useContext(TP);if(!n)throw new Error("useTheme must be used within ThemeProvider");return n},RJ=({children:n})=>{const[e,t]=re.useState("cyberpunk"),r={cyberpunk:{name:" Cyberpunk",colors:{"--primary-green":"#00FF41","--primary-yellow":"#39FF14","--primary-blue":"#00FFFF","--accent-red":"#FF0080","--bg-dark":"#000000","--bg-card":"#0A0A0A","--text-primary":"#FFFFFF","--text-secondary":"#A0A0A0"}},ocean:{name:" Ocean",colors:{"--primary-green":"#00D9FF","--primary-yellow":"#1E90FF","--primary-blue":"#4169E1","--accent-red":"#FF6B9D","--bg-dark":"#001B2E","--bg-card":"#003459","--text-primary":"#FFFFFF","--text-secondary":"#00D9FF"}},sunset:{name:" Sunset",colors:{"--primary-green":"#FF6B35","--primary-yellow":"#FFB347","--primary-blue":"#FF1744","--accent-red":"#D32F2F","--bg-dark":"#1A0F0F","--bg-card":"#2D1515","--text-primary":"#FFFFFF","--text-secondary":"#FFB347"}},forest:{name:" Forest",colors:{"--primary-green":"#2ECC71","--primary-yellow":"#27AE60","--primary-blue":"#F39C12","--accent-red":"#E74C3C","--bg-dark":"#0F1C14","--bg-card":"#1A2F21","--text-primary":"#FFFFFF","--text-secondary":"#2ECC71"}},purple:{name:" Purple Dream",colors:{"--primary-green":"#9B59B6","--primary-yellow":"#8E44AD","--primary-blue":"#E91E63","--accent-red":"#F44336","--bg-dark":"#1A0F21","--bg-card":"#2D1B3D","--text-primary":"#FFFFFF","--text-secondary":"#9B59B6"}},golden:{name:" Golden",colors:{"--primary-green":"#FFD700","--primary-yellow":"#FFA500","--primary-blue":"#FF6347","--accent-red":"#DC143C","--bg-dark":"#1C1810","--bg-card":"#2D2418","--text-primary":"#FFFFFF","--text-secondary":"#FFD700"}}};re.useEffect(()=>{const s=localStorage.getItem("kioskTheme")||"cyberpunk";t(s),i(s)},[]);const i=s=>{const u=r[s];if(!u)return;const c=document.documentElement;Object.entries(u.colors).forEach(([h,d])=>{c.style.setProperty(h,d)}),console.log(" Theme applied:",u.name)},a=s=>{if(!r[s]){console.warn("Theme not found:",s);return}t(s),localStorage.setItem("kioskTheme",s),i(s)};return T.jsx(TP.Provider,{value:{currentTheme:e,themes:r,changeTheme:a},children:n})},IJ=({onNavigate:n})=>{const[e,t]=re.useState(!1),[r,i]=re.useState(""),[a,s]=re.useState(!1),[u,c]=re.useState(!1),{currentTheme:h,themes:d,changeTheme:p}=AJ(),g="2025",v=()=>{r===g?(s(!0),i("")):(alert(" "),i(""))},b=w=>{t(!1),n(w)},E=()=>{s(!1),t(!1)};return T.jsxs(T.Fragment,{children:[T.jsx("button",{className:"admin-toggle-btn",onClick:()=>t(!e),title:"Admin Panel",children:T.jsx("span",{className:"admin-icon",children:a?"":""})}),e&&T.jsx("div",{className:"admin-menu-backdrop",onClick:()=>t(!1),children:T.jsx("div",{className:"admin-menu-popup",onClick:w=>w.stopPropagation(),children:a?T.jsxs("div",{className:"admin-menu-content",children:[T.jsxs("div",{className:"admin-header",children:[T.jsx("h2",{children:" Admin Dashboard"}),T.jsx("p",{children:"Select what you want to view"})]}),T.jsxs("div",{className:"admin-menu-items",children:[T.jsxs("button",{className:"menu-item analytics",onClick:()=>{t(!1),c(!0)},children:[T.jsx("span",{className:"menu-icon",children:""}),T.jsxs("div",{className:"menu-text",children:[T.jsx("h3",{children:"Admin Dashboard"}),T.jsx("p",{children:""})]}),T.jsx("span",{className:"menu-arrow",children:""})]}),T.jsxs("button",{className:"menu-item careers",onClick:()=>b("home"),children:[T.jsx("span",{className:"menu-icon",children:""}),T.jsxs("div",{className:"menu-text",children:[T.jsx("h3",{children:"Back to Kiosk"}),T.jsx("p",{children:"Return to main application"})]}),T.jsx("span",{className:"menu-arrow",children:""})]}),T.jsxs("button",{className:"menu-item firebasedb",onClick:()=>window.open("https://console.firebase.google.com","_blank"),children:[T.jsx("span",{className:"menu-icon",children:""}),T.jsxs("div",{className:"menu-text",children:[T.jsx("h3",{children:"Firebase Console"}),T.jsx("p",{children:"Manage database directly"})]}),T.jsx("span",{className:"menu-arrow",children:""})]})]}),T.jsxs("div",{className:"theme-section",children:[T.jsx("h3",{children:" "}),T.jsx("div",{className:"theme-grid",children:Object.entries(d).map(([w,C])=>T.jsx("button",{className:`theme-option ${h===w?"active":""}`,onClick:()=>{p(w)},children:C.name},w))})]}),T.jsx("div",{className:"admin-footer",children:T.jsx("button",{className:"btn-logout",onClick:E,children:" Logout"})}),T.jsx("div",{className:"admin-info",children:T.jsxs("p",{children:[" Logged in as: ",T.jsx("strong",{children:"Administrator"})]})})]}):T.jsxs("div",{className:"admin-login",children:[T.jsx("h2",{children:" Admin Access"}),T.jsx("p",{children:""}),T.jsx("input",{type:"password",placeholder:"Enter Admin Code",value:r,onChange:w=>i(w.target.value),onKeyPress:w=>w.key==="Enter"&&v(),autoFocus:!0,className:"admin-input"}),T.jsx("button",{className:"btn-admin",onClick:v,children:""}),T.jsx("button",{className:"btn-close",onClick:()=>t(!1),children:""}),T.jsx("div",{className:"admin-hint",children:T.jsx("p",{children:" Hint: Enter the year Lanna Polythentic was founded"})})]})})}),u&&T.jsx(SJ,{onClose:()=>c(!1)})]})},NJ=({userProfile:n,onClose:e})=>{const[t,r]=re.useState([]),[i,a]=re.useState(!0),[s,u]=re.useState(0);re.useEffect(()=>{n&&d()},[n]);const c=S=>S>=3&&S<=12?"KIDS_3_12":S>=13&&S<=17?"TEENS_13_17":(S>=18,"ADULTS_18_PLUS"),h=(S,I,D)=>{const O=[];return S>=3&&S<=12?O.push("activity","event","kids_program"):S>=13&&S<=17?O.push("scholarship","event","sports","competition"):O.push("scholarship","career","news","promotion"),D==="happy"?O.push("event","promotion","activity"):D==="neutral"&&O.push("news","career","scholarship"),[...new Set(O)]},d=async()=>{if(!wt||!n){a(!1);return}try{a(!0);const{age:S,gender:I,expression:D}=n,O=c(S),B=h(S,I,D);console.log(" Fetching personalized content for:",{age:S,gender:I,expression:D,ageGroupId:O,categories:B});const N=Br(wt,"content_items"),R=Qu(N,II("ageGroupId","==",O),II("isActive","==",!0),Zu("priority","desc"),Bc(10));let P=(await Ns(R)).docs.map(V=>({id:V.id,...V.data()}));if(B.length>0){const V=P.filter(j=>B.includes(j.type));V.length>0&&(P=V)}P.sort((V,j)=>(j.priority||0)-(V.priority||0)),r(P.slice(0,5)),console.log(` Found ${P.length} personalized contents`)}catch(S){console.error(" Error fetching personalized content:",S)}finally{a(!1)}},p=()=>{const S=n?.expression||"neutral";n?.age,n?.gender;const I={happy:" ! ",sad:"  ",angry:"  ",surprised:" ! ",neutral:"  "};return I[S]||I.neutral},g=()=>{const S=n?.age||20;return S>=3&&S<=12?" ":S>=13&&S<=17?" ":" "},v=S=>({scholarship:"",news:"",event:"",promotion:"",career:"",activity:"",sports:"",competition:"",kids_program:"",workshop:"",seminar:""})[S]||"",b=S=>({scholarship:"",news:"",event:"",promotion:"",career:"",activity:"",sports:"",competition:"",kids_program:"",workshop:"",seminar:""})[S]||S,E=()=>{s<t.length-1&&u(s+1)},w=()=>{s>0&&u(s-1)},C=t[s];return n?T.jsx("div",{className:"personalized-popup-overlay",onClick:e,children:T.jsxs("div",{className:"personalized-popup-container",onClick:S=>S.stopPropagation(),children:[T.jsxs("div",{className:"popup-header",children:[T.jsxs("div",{className:"popup-header-content",children:[T.jsx("h2",{children:p()}),T.jsxs("div",{className:"user-profile-info",children:[T.jsx("span",{className:"profile-badge",children:g()}),T.jsx("span",{className:"profile-badge",children:n.gender==="male"?" ":" "}),T.jsxs("span",{className:"profile-badge age-badge",children:[n.age," "]})]})]}),T.jsx("button",{className:"popup-close-btn",onClick:e,children:""})]}),T.jsx("div",{className:"popup-content",children:i?T.jsxs("div",{className:"popup-loading",children:[T.jsx("div",{className:"loading-spinner"}),T.jsx("p",{children:" ..."})]}):t.length===0?T.jsxs("div",{className:"popup-no-content",children:[T.jsx("div",{className:"no-content-icon",children:""}),T.jsx("h3",{children:""}),T.jsx("p",{children:""}),T.jsx("p",{className:"hint-text",children:"  !"})]}):T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"content-card",children:[T.jsxs("div",{className:"content-card-header",children:[T.jsxs("span",{className:"content-type-badge",children:[v(C.type)," ",b(C.type)]}),C.priority>=8&&T.jsx("span",{className:"priority-badge",children:" "})]}),C.imageUrl&&T.jsx("div",{className:"content-image",children:T.jsx("img",{src:C.imageUrl,alt:C.title})}),T.jsxs("div",{className:"content-body",children:[T.jsx("h3",{className:"content-title",children:C.title}),T.jsx("p",{className:"content-description",children:C.description}),C.tags&&T.jsx("div",{className:"content-tags",children:C.tags.split(" ").filter(S=>S).map((S,I)=>T.jsxs("span",{className:"tag",children:["#",S]},I))})]}),T.jsxs("div",{className:"content-footer",children:[T.jsx("button",{className:"btn-interested",children:" "}),T.jsx("button",{className:"btn-more-info",children:" "})]})]}),t.length>1&&T.jsxs("div",{className:"popup-navigation",children:[T.jsx("button",{className:"nav-btn",onClick:w,disabled:s===0,children:" "}),T.jsxs("span",{className:"nav-indicator",children:[s+1," / ",t.length]}),T.jsx("button",{className:"nav-btn",onClick:E,disabled:s===t.length-1,children:" "})]})]})}),T.jsx("div",{className:"popup-footer",children:T.jsx("p",{children:" "})})]})}):null};function DJ(){const[n,e]=re.useState(!1),[t,r]=re.useState("home"),[i,a]=re.useState([]),[s,u]=re.useState(!1),[c,h]=re.useState(!1),[d,p]=re.useState(!0),[g,v]=re.useState(null),[b,E]=re.useState(null),[w,C]=re.useState(null),[S,I]=re.useState(null),[D,O]=re.useState(null),[B,N]=re.useState("ADULTS_18_PLUS"),[R,k]=re.useState(!1),P=re.useRef(null),V=re.useRef(null),j=re.useRef(null),L=12e4;re.useEffect(()=>{(async()=>{const ce="session-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);I(ce),O(Date.now()),sessionStorage.setItem("sessionId",ce),await ov("visit",ce,{timestamp:new Date().toISOString(),userAgent:navigator.userAgent})})()},[]);const Z=re.useCallback(()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{console.log(" Idle timeout reached - returning to home"),p(!0),r("home"),u(!1),h(!1)},L)},[]);V.current=Z;const ne=()=>{d&&(p(!1),r("home")),Z()},q=$=>{const ce=$.clientX/window.innerWidth*100,ve=$.clientY/window.innerHeight*100;uJ(ce,ve,t),ne()};re.useEffect(()=>(setTimeout(()=>{Ju.init()},1e3),window.resetIdleTimer=Z,()=>{window.resetIdleTimer=null}),[]),re.useEffect(()=>{const $=["mousedown","mousemove","keypress","scroll","touchstart","click"],ce=ve=>{V.current&&V.current()};return $.forEach(ve=>{document.addEventListener(ve,ce,{passive:!0})}),console.log(" Event listeners registered for idle timer reset"),()=>{$.forEach(ve=>{document.removeEventListener(ve,ce)}),console.log(" Event listeners cleaned up")}},[]),re.useEffect(()=>{},[]);const X=$=>{if(Z(),$.skipScan&&$.goToInfo){r("explore"),a([]);return}if($.age){v($.age);const ce=_q($.age);N(ce.id)}$.gender&&E($.gender),$.emotion&&C($.emotion),a($),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{$.age&&$.gender&&$.emotion&&(console.log(" Showing personalized content popup with:",{age:$.age,gender:$.gender,emotion:$.emotion}),k(!0))},5e3),$.length>0&&(lJ(S,"home","explore"),r("explore"))},ee=()=>{r("home"),a([]),u(!1),k(!1),j.current&&clearTimeout(j.current),Z()},ue=()=>{u(!0),Z()},fe=()=>{u(!1),Z()},W=$=>{$==="home"&&ee()};return T.jsxs("div",{className:"app",onClick:d?ne:q,children:[T.jsx(IJ,{onNavigate:W}),T.jsxs("div",{className:"app-background",children:[T.jsx("div",{className:"gradient-orb orb-1"}),T.jsx("div",{className:"gradient-orb orb-2"}),T.jsx("div",{className:"gradient-orb orb-3"}),T.jsx("div",{className:"grid-overlay"})]}),T.jsxs("header",{className:"app-header",style:{display:d?"none":"flex"},children:[T.jsxs(Pe.div,{className:"logo",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[T.jsx("div",{className:"logo-icon",children:""}),T.jsxs("div",{className:"logo-text",children:[T.jsx("h1",{children:"Lanna Polytechnic Chiangmai"}),T.jsx("p",{className:"logo-subtitle",children:"Technological College"})]})]}),T.jsx("div",{className:"header-actions",children:T.jsx("button",{className:"scholarships-btn",onClick:()=>h(!0),children:" Scholarships & Fees"})})]}),d&&T.jsx(bJ,{onInteraction:ne}),T.jsxs("main",{className:"app-main",style:{display:d?"none":"block"},children:[t==="home"&&T.jsx(Pe.div,{className:"home-page",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:T.jsxs("div",{className:"hero-content",children:[T.jsxs(Pe.h2,{className:"hero-title",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2},children:["",T.jsx("span",{className:"gradient-text",children:" "})]}),T.jsx(Pe.p,{className:"hero-subtitle",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.4},children:""}),T.jsx(Pe.div,{className:"scan-area",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.6},children:T.jsx(hJ,{onDetected:X})}),T.jsx(Pe.button,{className:"btn-primary",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.8},onClick:()=>r("explore"),whileHover:{scale:1.05},whileTap:{scale:.95},children:""})]})}),t==="explore"&&T.jsx(Pe.div,{className:"explore-page",initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:g&&g>=3&&g<13?T.jsx(xJ,{careerSuggestions:i,onComplete:$=>{ov("clicked",S,{careers:$,ageGroup:"KIDS_3_12"}),u(!0)}}):T.jsx(vJ,{suggestedInterests:i,onAvatarClick:ue})})]}),s&&T.jsx(gJ,{onClose:fe,interests:i}),c&&T.jsx(_J,{onClose:()=>h(!1)}),R&&g&&b&&w&&T.jsx(NJ,{userProfile:{age:g,gender:b,expression:w},onClose:()=>k(!1)}),T.jsxs("footer",{className:"app-footer",style:{display:d?"none":"block"},children:[T.jsx("p",{children:" 2026  "}),T.jsx("p",{style:{fontSize:"0.85rem",marginTop:"0.25rem",opacity:.8},children:"  | Information Technology"})]})]})}pV.createRoot(document.getElementById("root")).render(T.jsx(sV.StrictMode,{children:T.jsx(RJ,{children:T.jsx(DJ,{})})}))});export default kJ();
