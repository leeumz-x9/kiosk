rules_version='2'

service cloud.firestore {
  match /databases/{database}/documents {
    // Careers collection - Read only (public)
    match /careers/{document=**} {
      allow read: if true;
      allow write: if false;
    }

    // Tuition collection - Read only (public)
    match /tuition/{document=**} {
      allow read: if true;
      allow write: if false;
    }

    // Sessions collection - Only write from client (immutable logs)
    match /sessions/{sessionId} {
      allow read: if request.auth != null;
      allow create: if true;
      allow update, delete: if false;
    }

    // Analytics collection - Read only (admin dashboard)
    match /analytics/{document=**} {
      allow read: if true;
      allow write: if false;
    }

    // Heatmap collection - Write from kiosk app
    match /heatmap/{document=**} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if false;
    }
    
    // Heatmap clicks collection - Allow write + DELETE for cleanup
    match /heatmap_clicks/{document=**} {
      allow read, create, delete: if true;
      allow update: if false;
    }
    
    // Face scan sessions - Allow write + DELETE for cleanup
    match /face_scan_sessions/{document=**} {
      allow read, create, delete: if true;
      allow update: if false;
    }
    
    // User sessions - Allow write + DELETE for cleanup
    match /user_sessions/{document=**} {
      allow read, create, delete: if true;
      allow update: if false;
    }
    
    // Scan logs - Allow write + DELETE for cleanup
    match /scan_logs/{document=**} {
      allow read, create, delete: if true;
      allow update: if false;
    }
    
    // Conversion steps - Allow write + DELETE for cleanup
    match /conversion_steps/{document=**} {
      allow read, create, delete: if true;
      allow update: if false;
    }

    // LED status collection - Write from Pi5 server
    match /led_status/{document=**} {
      allow read: if true;
      allow write: if true;
    }

    // Presence collection - Write from Pi5 server
    match /presence/{document=**} {
      allow read: if true;
      allow write: if true;
    }
    
    // ===== NEW: Content Management =====
    // Content items - Public read, restricted write
    match /content_items/{contentId} {
      allow read: if true;
      allow create, update, delete: if true; // TODO: เปลี่ยนเป็น auth ในภายหลัง
    }
    
    // Content types - Read only
    match /content_types/{typeId} {
      allow read: if true;
      allow write: if false;
    }
    
    // Age groups - Public read, allow write for setup
    match /age_groups/{groupId} {
      allow read: if true;
      allow create, update, delete: if true; // Allow for initial setup and admin management
    }
    
    // User interactions - Log only
    match /user_interactions/{interactionId} {
      allow read: if false;
      allow create: if true;
      allow update, delete: if false;
    }
  }
}
